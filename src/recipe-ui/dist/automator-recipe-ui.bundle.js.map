{"version":3,"sources":["webpack:///webpack/bootstrap f509f2ab4d55f66ebe3f","webpack:///./src/components/Utilities.js","webpack:///external \"jQuery\"","webpack:///./src/components/Actions.js","webpack:///./src/components/Field.js","webpack:///./src/components/Triggers.js","webpack:///./src/components/Validation.js","webpack:///./src/components/ItemCreatorIntegrations.js","webpack:///./src/components/ItemHeaderMenu.js","webpack:///./src/components/RecipeNotices.js","webpack:///./src/components/Modal.js","webpack:///./src/components/MetaboxItems.js","webpack:///./src/components/ItemHeaderIcon.js","webpack:///./src/components/ItemHeaderTag.js","webpack:///./src/components/Publish.js","webpack:///./src/components/RecipeTypeSelector.js","webpack:///./src/components/ItemHeaderSentence.js","webpack:///./src/components/MetaboxFooter.js","webpack:///./src/index.js","webpack:///./src/css/uncannyowl-automator.svg","webpack:///./src/css/uncannyowl-automator.ttf","webpack:///./src/css/uncannyowl-automator.woff","webpack:///./src/css/main.scss","webpack:///./src/components/FieldsGroup.js","webpack:///./src/components/FieldsRepeater.js","webpack:///./node_modules/html5sortable/dist/html5sortable.cjs.js","webpack:///./node_modules/sprintf-js/src/sprintf.js","webpack:///./src/components/UserSelector.js","webpack:///./src/components/ItemOptions.js","webpack:///./src/components/Markdown.js","webpack:///./src/components/ItemCreatorAdd.js","webpack:///./src/components/Closures.js","webpack:///./src/components/itemCreatorTaskSelector.js","webpack:///./src/components/MetaboxNotice.js","webpack:///./src/components/SendFeedback.js","webpack:///./src/components/RecipeTitle.js","webpack:///./src/components/Taxonomies.js"],"names":["createDataOnLoad","recipeObject","itemsObject","groupItemsByIntegration","sortArrayOfObjectsAlphabetically","getItemsByIntegration","userSelectorObject","filterAutomatorItemsByRecipeType","restCall","AJAXRequest","getCurrentFieldsValues","getField","getGlobalItem","getDOMElements","getTokens","getFieldTypes","parseStringWithTokens","isDefined","isEmpty","compareStrings","inArray","arrayDifference","vsprintf","isString","isObject","removeSpaces","replaceCurlyBraces","consoleLogLabel","consoleLogResult","escapeHTML","abbreviateText","getUniqueId","addParametersToURL","decodeEntities","callback","completeProcess","allRecipes","UncannyAutomator","recipes_object","triggers","actions","wp","recipe","type","RecipeTypeSelector","action","attributes","response","validActions","requiredData","Object","keys","$","each","index","theRecipe","ID","id","trigger","itemType","closures","closure","items","concat","apply","recipeIsAnonymous","item","itemToAdd","globalItem","meta","integration","code","itemCode","options","option","option_code","options_group","extend","groupsOfOptions","groupKey","fields","allFieldsOnThisGroup","hasMoreThanOneOption","length","field","sanitizeFieldData","fieldObject","isGroup","itemId","isRequired","required","isReadOnly","read_only","supportsTinyMCE","supports_tinymce","supportsCopyToClipboard","copy_to_clipboard","isAjax","is_ajax","groupId","optionCode","fieldType","input_type","label","description","placeholder","isHidden","is_hidden","tokenName","token_name","defaultValue","default_value","currentValue","relevant_tokens","includes","supportsTokens","supports_tokens","targetField","fill_values_in","endpoint","integrationId","fieldInstance","map","fieldData","FieldsGroup","JSON","parse","e","add_row_button","addRowButtonLabel","remove_row_button","removeRowButtonLabel","FieldsRepeater","Field","push","buttons","button","show_in","isValid","integrationCode","isLive","post_status","isMissing","tokens","inlineCss","inline_css","filterTokens","filter_tokens","support","optionKey","getAttributes","fieldAttributes","canLogNewUserIn","can_log_in_new_user","integrationName","integration_name","sentence","recipeTriggers","filter","validate","missingAttributes","stringify","console","error","isRecipeValid","hasLive","has","itemID","itemData","itemIsValid","optionsGroupID","optionsGroupData","groupIsValid","fieldValidation","message","i18n","validation","oneTrigger","userSelector","oneAction","liveItems","value","matchFilters","key","entries","integrations","forEach","integrationID","available","unavailable","proFeatures","allItemsArePro","every","is_pro","hasAvailableItems","hasUnavailableItems","hasTriggers","hasActions","propertyToCompare","Array","isArray","sort","a","b","compare","valueA","valueB","localeCompare","step","source","existingUser","newUser","dev","debugMode","collapseGroup","log","groupEnd","endPoint","data","onSuccess","onFail","validEndpoints","ajax","method","url","restURL","param","doing_rest","beforeSend","xhr","setRequestHeader","nonce","success","requiresRecipesObject","renderUI","statusCode","fail","join","dataType","ajaxurl","status","location","reload","bgColor","values","groupOfFields","fieldId","getFieldID","fieldValue","getValue","optionsGroupId","optionsGroup","theItem","integrationItems","element","validElements","cssSelector__metabox","$metabox","metabox","$items","find","cssSelector","$item","$contentContainer","contentContainer","cssSelector__tokenInSentence","groupID","cssSelector__fieldsContainer","$tokenInSentence","$fieldsContainer","$optionsContainer","tokenInSentence","fieldsContainer","optionsContainer","lastItem","last","tokensList","commonTokens","name","global","common","icon","siteName","userID","userUsername","userFirstName","userLastName","userEmail","userDisplay","userResetPassLink","adminEmail","siteUrl","recipeName","currentDate","currentTime","tokensGroupAdvanced","advanced","userMetaKey","jQuery","itemTokens","group","fieldRows","row","rowIndex","rowNumber","title","token","tokenIdentifier","tokenId","tokenType","itemSentence","tokensGroup","html","eval","replace","trim","filteredTokensList","tokenGroup","filteredTokens","validFieldTypes","string","plain","elements","normal","parts","tokensRegex","RegExp","normals","mappedString","tokenNumber","full_match","tokenParts","split","tokenPlaceholderText","tokenValueID","optionsID","text","hasFields","readableText","originalText","stringParts","normalNumber","sentenceSection","match","exec","part","elementAttributes","startsWithSpace","slice","endsWithSpace","CSSClass","abbreviatedText","isAbbreviated","append","get","variable","isEmptyObject","string1","string2","settings","caseSensitive","toString","toLowerCase","needle","haystack","array1","array2","not","format","arguments_array","require","start","end","labelStyle","groupCollapsed","tagsToReplace","replaceTag","tag","partLengths","Math","floor","textParts","substring","random","substr","parameters","window","href","URL","urlParameters","search","encodeURI","i","x","parameter","setAsURL","refresh","pageTitle","document","history","pushState","encodedString","$textarea","createElement","innerHTML","Actions","empty","UserSelector","MetaboxItems","ItemCreatorAdd","MetaboxFooter","Closures","createDOMelements","customValidationFunction","setAttributes","createFormElement","formElement","formElementClass","addClass","fieldContainer","hasSelectedOption","numberOfOptions","defaultOptionExists","hasDefaultValue","option_value","option_name","option_data","selectOption","prop","hasValue","appendTo","defaultOption","prependTo","hasPlaceholder","prepend","selectHasSelectedOption","noResults","Option","on","fieldContainerClass","checkboxLabel","checkboxPseudo","hasLabel","isToggle","toggle","checkboxToggleOn","off","checkboxToggleOff","color","align","$fields","$fieldContainers","$formRadioContainer","$field","add","$fakeRadio","formVariable","formVariableFieldContainer","formVariableFieldContainerRender","formVariableToggle","formVariableToggleIcon","formVariableDropdown","fieldLabel","fieldLabelAsterisk","fieldError","hasDescription","fieldDescription","initLibraries","onChange","onFocus","renderError","getFieldContainer","doAJAX","event","currentTarget","select","ready","getMetaValue","startLoadingAnimation","recipe_id","integration_id","item_id","group_id","field_id","target_field","stopLoadingAnimation","targetFieldAttributes","setSelectOptions","setValue","isReady","val","is","trueLabel","falseLabel","$checkedRadio","$radioContainer","closest","metaValue","doTrigger","allOptions","wantsToCheck","isChecked","removeSelectOptions","optionsDOM","optionDOM","hasClass","CSSclass","removeClass","initSelect2","initTokenSelector","theme","searchInputPlaceholder","language","templateResult","Number","isInteger","parseInt","templateSelection","escapeMarkup","markUp","select2","$input","TokenSelector","editor","tinymce","remove","initialize","mediaButtons","wpautop","toolbar1","toolbar2","quicktags","getContent","Defaults","fn","amd","defaults","SearchDropdown","_renderSearchDropdown","prototype","render","decorated","$rendered","arguments","$search","attr","fieldTokens","$this","responsive","margin","fieldElementType","classes","tokenReady","hiddenField","isTinyMCEinstance","TinyMCEinstanceID","list","getTokenList","hasTokens","config","inputHeight","init","mainFormElement","input","formDropdown","formDropdownContainer","formDropdownSearch","formDropdownSearchInput","formGroups","tokenGroupID","groupContainer","groupSource","groupIcon","groupName","groupToggle","groupToggleIcon","$tokenIcon","icon_svg","icon_16","icon_32","tokenGroups","individualTokenID","individualToken","tokenItem","getPosition","usefulElements","space","above","container","offset","top","scrollTop","below","height","dropdown","container_relative","dropDownHeight","hasSpaceBelow","setDirection","position","setScroll","open","maxHeight","css","addToken","cursorPosition","selectionStart","newCursorPosition","instance","newValue","focus","setSelectionRange","execCommand","hideDropdown","focusInput","resetDropdown","groups","no_results","search_input","bind","toggles","insert_tokens","resize","mirrorContent","toggleClass","bindClicksOutside","groups_title","target","hasResults","optionName","input_area","Triggers","ItemCreatorIntegrations","validateRecipe","validateItem","validateItemFields","validateField","getTokensFromString","replaceTokensInString","getExampleValueByFieldType","parseURL","initURLChecker","canSubmit","itemElement","optionsGroupElements","setTimeout","form","isFormValid","radioInput","first","selectedRadio","radioValue","field_type","fieldTypes","messages","invalid","textarea","int","multipleTokens","float","email","single","multiple","checkbox","radio","invalidType","tokensInString","customValidation","int_regex","simulate_int","test","float_regex","simulate_float","email_regex","emails","simulate_email","allEmailsAreValid","hasMultipleEmails","hasMultipleVariables","validateURL","simulatedURL","$container","$error_container","regex","allTokens","matchedToken","output","regexCondition","changed","newURL","regexURL","tokensInValue","simulate_url","siteURL","checkURL","input_attributes","validationNotice","validationNoticeHeader","validationNoticeURL","preURL","$currentItem","header","createHeader","itemContent","createIntegrations","discoverMore","createDiscoverMoreIntegrations","replaceWith","insertAfter","itemCreatorAdd","titleContainer","titleContent","ItemHeaderMenu","filterByNonEmptyIntegrations","sortIntegrationsAlphabetically","integrationElement","createIntegration","itemCreatorTaskSelector","logo","isProOnly","proOnly","pro","isAvailable","requiresPro","uncannyAutomatorPro","$logoImg","icon_64","learnMore","hasItems","createItemActions","btn","btnIcon","dropdownUl","deleteAction","deleteText","delete","globalItemData","support_link","supportAction","supportText","isOpen","modal","Modal","confirmationModal","warning","deleteWarning","cancel","confirm","setEvents","afterSetEvents","show","onConfirm","getElements","confirmButton","box","destroy","publish","statusToggle","afterHide","RecipeNotices","createContainer","emptyContainer","createWarning","errorMode","createError","noticeContainer","class","thisRecipeNotices","notice","content","automatorContainer","isVisible","fadeDuration","create","modalBox","size","modalTitle","modalContent","modalWarning","modalButtons","cancelButton","events","emptyFunction","afterShow","onCancel","hide","thisModal","unbind","fadeIn","fadeOut","createItem","createNotice","ItemHeaderIcon","itemTag","ItemHeaderTag","titleSentence","ItemHeaderSentence","itemMissing","createItemIcon","$icon","createItemTag","Publish","timesPerUser","editLink","hiddenBox","saveButton","createMetabox","footer","timesRow","timesRowVisible","timesRowIconBox","timesRowIcon","timesRowName","timesValue","unlimited","timesRowValue","timesRowEdit","edit","timesRowHidden","timesRowHiddenBox","timesRowField","leaveEmpty","simulatedValue","oneOrBigger","timesField","timesRowButtons","timesRowSaveBtn","save","timesRowCancelBtn","getFormElement","recipeTypeRow","recipeTypeRowVisible","recipeTypeRowIconBox","recipeTypeRowIcon","recipeTypeRowName","recipeType","recipeTypeRowValue","recipeTypeLearnMore","userRecipeName","anonymousRecipeName","createdRow","createdRowVisible","createdRowIconBox","createdRowIcon","createdRowName","createdOn","createdRowValue","footerRow","footerRowLeft","footerMoveToDraft","moveToTrash","footerRowRight","recipeStatusToggle","liveRecipe","draftRecipe","recipeStatusToggleDOM","validateStatus","slideToggle","numberOfTimes","post_ID","recipe_completions_allowed","keyCode","makeLive","postStatus","canMakeLive","proToPublish","doWhenReady","listenSubmission","$recipeTypeSelector","userRecipeDescription","anonymousRecipeDescription","cantChangeLaterNotice","$elements","submitButton","preventDefault","saveRecipeType","showError","errorTryingToSaveOtherValue","errorDidNotSelectType","recipe_type","$triggersMetaboxTitle","triggersMetaboxTitle","userTriggers","anonymousTrigger","errorSomethingWentWrong","errorMessage","$error","$oldErrorContainer","createItemSentence","$token","optionGroupDOM","ItemOptions","itemToggle","liveRecipeItem","draftRecipeItem","itemStatusToggle","isValidItem","statusWarning","shouldCreateMetaboxFooter","createFooter","recipeActions","addAnother","$anonymousNotice","createAnonymousNotice","$notice","anonymousOnlyOneTrigger","SendFeedback","RecipeTitle","Taxonomies","createFields","$label","$formGroup","$fieldElement","$description","fieldsValue","validationObject","sortable","rowFieldsTemplate","fieldsRows","rowFields","emptyRow","$table","getFieldsTable","makeRowsSortable","listenSave","updateAttributesFieldsFromRow","forcePlaceholderSize","handle","itemSerializer","serializedItem","sortableContainer","newOrder","detail","destination","newFieldRowsOrder","oldIndex","reRender","heading","$heading","headingColumn","$headingColumn","$headingContainer","$rows","numberOfRows","$row","$fieldCell","$actions","removeRowLabel","removeRow","$removeRowButton","deleteRow","$addRowButton","addRow","$actionsContainer","fieldsData","splice","rowsValidation","rowValidation","$content","getSelectSourceNodes","getOptionsNodes","getSentenceNodes","$userSelector","userType","existing","new","getHeaderNodes","$userTypeButtons","$option","userSource","getOptionsFields","optionsFields","roles","resources","administrator","$groupOfFields","uniqueField","uniqueFieldLabel","uniqueFieldOptionEmail","uniqueFieldOptionId","uniqueFieldOptionUsername","valueField","uniqueFieldValue","valueFieldLabel","valueFieldPlaceholder","$uniqueFieldFormElement","$valueFieldFormElement","fallbackField","createNewUserFieldLabel","fallback","createNewUserFieldOptionCreateUser","createNewUserFieldOptionDoNothing","$fallbackFieldFormElement","$doNothingNotice","doNothingMessage","$subOptionsContainer","newUserFields","firstName","lastName","username","displayName","password","passwordDescription","logUserIn","yes","no","$fieldFormElement","newUserFallbackField","existingUserFieldLabel","existingUserFieldOptionExisting","existingUserFieldOptionDoNothing","$newUserfallbackFieldFormElement","fieldsValues","prioritizedField","prioritizedFieldLabel","prioritizedFieldDescription","$prioritizedField","$buttonsContainer","$saveButton","$cancelButton","areAllFieldsValid","isFieldValid","recipeId","$summaryContainer","$sourceRow","$sourceRowToken","$dataRow","$dataRowSentence","summary","matches","withEmail","$fallbackRow","otherwiseText","createNewUser","doNothing","selectExistingUser","$fallbackRowSentence","otherwise","sentenceTitle","setOptions","$output","optionId","initTinyMCE","itemOptions","createButtons","automatorButtons","developerButtons","$buttonElement","css_classes","doOnClick","on_click","modules","Markdown","formValidation","optionValue","getOptionValue","hasSelect","hasRepeater","getReadableValue","parseItalicsAndBold","parseAnchors","wholeMatch","m1","m2","m3","m4","m5","m6","m7","linkText","linkId","result","$containerBox","$button","createClosure","wasAdded","checkboxAttributes","select_option_name","closureInRecipe","getClosureByCodeFromItemsObject","itemid","checkboxField","$checkbox","recipePostID","item_code","$newItem","$toggleContent","$itemHeader","$itemContent","$title","$itemTag","$titleSentence","createItemsList","$header","$itemActions","$itemIcon","$integrationTag","searchPlaceholder","unlockItems","unlockTriggers","unlockActions","$taskSelector","$searchField","$itemsList","isPro","restRequestCode","defaultMeta","default_meta","query","createCancelButton","MetaboxNotice","noticeType","noticeMessage","build","sendFeedbackContainer","version","utmSource","sendFeedbackButton","sendFeedback","sendFeedbackButtonIcon","close_btn","dont_show_again_checkbox","overlay","mainContainer","localStorage","uapSendFeedbackWelcome","publishedTitle","createStatus","bindChanges","notSavedAlert","uapContainer","saving","savingIcon","savingText","saved","savedIcon","savedText","stop","typingTimeout","clearTimeout","setStatusSaving","updateTitle","post_title","getTitle","setStatusSaved","revertChanges","Categories","Tags","allCategories","listenCheckboxes","saveCategory","MutationObserver","mutations","mutation","addedNodes","addedNode","observe","childList","checkboxData","getCheckboxData","setStatus","term_id","category_id","set_category","revertCheckboxValue","enable","tagsTextarea","listenModificationsToTags","tagsList","saveTags","tags","getTags","tagsCommaSeparated","tagsArray","asArray","commaSeparated"],"mappings":"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A;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,YAAY;AACvB,WAAW,OAAO;AAClB,WAAW,IAAI;AACf,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,8BAA8B;AACzC,WAAW,OAAO;AAClB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,sDAAsD,EAAE;AAC7G,CAAC;;AAED;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA,iCAAiC;AACjC,sCAAsC;AACtC,+BAA+B;AAC/B;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA,+CAA+C;AAC/C;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,mBAAmB,YAAY;AAC/B,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,eAAe,OAAO;AACtB,eAAe,IAAI;AACnB,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA,WAAW,YAAY;AACvB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA,WAAW,kBAAkB;AAC7B,WAAW,SAAS;AACpB,WAAW,OAAO;AAClB;AACA;AACA;AACA,uBAAuB,oBAAoB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,+BAA+B;AAC1C,WAAW,OAAO;AAClB;AACA;AACA;AACA,uBAAuB,oBAAoB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,WAAW,+BAA+B;AAC1C,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA,uBAAuB,oBAAoB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,kBAAkB;AAC7B,WAAW,OAAO;AAClB;AACA;AACA;AACA,uBAAuB,oBAAoB;AAC3C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,WAAW,YAAY;AACvB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA,WAAW,SAAS;AACpB,WAAW,OAAO;AAClB,aAAa,SAAS;AACtB;AACA;AACA,0BAA0B,UAAU;AACpC;AACA;AACA;AACA,wBAAwB,uBAAuB;AAC/C;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,CAAC;;AAED;AACA;AACA;AACA,WAAW,YAAY;AACvB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,WAAW,YAAY;AACvB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,WAAW,YAAY;AACvB,WAAW,YAAY;AACvB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB,WAAW,YAAY;AACvB;AACA,+CAA+C,8CAA8C;AAC7F;AACA;AACA,WAAW,YAAY;AACvB,WAAW,YAAY;AACvB;AACA,8CAA8C,6CAA6C;;AAE3F;AACA;AACA;AACA,WAAW,YAAY;AACvB,WAAW,SAAS;AACpB,aAAa;AACb;AACA;AACA,0CAA0C,sEAAsE,uBAAuB,GAAG;AAC1I,+CAA+C,6DAA6D,4BAA4B,GAAG;AAC3I;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,sDAAsD,EAAE;AAC5G;AACA,CAAC;;AAED;AACA;AACA;AACA,WAAW,YAAY;AACvB,WAAW,iBAAiB;AAC5B,WAAW,OAAO;AAClB;AACA;AACA;AACA,sCAAsC,2CAA2C;AACjF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,uCAAuC,oBAAoB,EAAE;AAC7D,CAAC;;AAED;AACA;AACA;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,uCAAuC,oBAAoB,EAAE;AAC7D,CAAC;;AAED;AACA;AACA;AACA,WAAW,mBAAmB;AAC9B,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,CAAC;;AAED;AACA,WAAW,MAAM;AACjB,aAAa;AACb;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,WAAW,YAAY;AACvB,WAAW,OAAO;AAClB,WAAW,MAAM;AACjB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,MAAM;AACjB,WAAW,YAAY;AACvB,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA,WAAW,SAAS;AACpB,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA,+BAA+B,iBAAiB;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,uBAAuB;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,eAAe;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,+BAA+B;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB,WAAW,MAAM;AACjB;AACA;AACA;AACA;AACA,wDAAwD,sBAAsB,EAAE;AAChF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,eAAe;AAC1B,WAAW,cAAc;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,oDAAoD,EAAE;AACnG;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sFAAsF,yBAAyB,EAAE;AACjH,gDAAgD,2CAA2C,EAAE;AAC7F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,gDAAgD,2CAA2C,EAAE;AAC7F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,aAAa;AACb;AACA;AACA,yCAAyC,6BAA6B,EAAE;AACxE;AACA;AACA,yCAAyC,6BAA6B,EAAE;AACxE;AACA,yCAAyC,6BAA6B,EAAE;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,uCAAuC,EAAE;AACtF;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,6CAA6C,uCAAuC,EAAE;AACtF;AACA;AACA,iBAAiB;AACjB;AACA;AACA,6DAA6D,yBAAyB,EAAE;AACxF;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;AC/tCA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,EAAE;AACzB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA,+BAA+B,oBAAoB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC;AACvC;AACA;AACA,sBAAsB;AACtB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AAAA;AACb;AACA;AACA;AACA,CAAC,GAAG;;;;;;;;;;;;;;;;ACtOJ;;AAUA;;;;AAEA;;;;AAEA;;;;;;;;IAEMmR,Y;AACL,yBAAa;AAAA;;AACZ;AACAlX,mBAAiBK,MAAjB,CAAwBwI,YAAxB,CAAqC8B,IAArC,GAA4C,mCAAoB,UAApB,CAA5C;;AAEA;AACA,OAAK4U,MAAL;AACA;;;;2BAEO;AACP;AACA,OAAIka,aAAJ;;AAEA;AACA,WAASz5B,iBAAiBK,MAAjB,CAAwBwI,YAAxB,CAAqC8B,IAA9C;AACC,SAAK,eAAL;AACC;AACA;AACA;AACA;AACA3K,sBAAiBK,MAAjB,CAAwBwI,YAAxB,CAAqCxC,OAArC,GAA+C,KAA/C;;AAEA;AACA,kCAAc,UAAd;;AAEA;AACA;AACAozB,gBAAW,KAAKC,oBAAL,EAAX;AACA;;AAED,SAAK,aAAL;AACC;A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","file":"automator-recipe-ui.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 17);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f509f2ab4d55f66ebe3f","import {\r\n    validateField\r\n} from './Validation';\r\n\r\nimport RecipeTypeSelector from './RecipeTypeSelector';\r\nimport Field from './Field';\r\nimport FieldsGroup from './FieldsGroup';\r\nimport FieldsRepeater from './FieldsRepeater';\r\n\r\n/**\r\n * Create the data required for Automator to render\r\n * \r\n * @since 2.1.6\r\n * \r\n * @param  {Function} callback The function to invoke after the data is ready\r\n * @return undefined\r\n */\r\nexport function createDataOnLoad( callback = '' ){\r\n\tconsoleLogLabel( 'Start creating the main object' );\r\n\r\n\t// Check if there is a callback defined\r\n\tcallback = ! isEmpty( callback ) ? callback : () => {};\r\n\r\n\t// Create a function to continue with the process once we know what's\r\n\t// the recipe type\r\n\tconst completeProcess = () => {\r\n\t\t// Filter Automator items\r\n\t\tfilterAutomatorItemsByRecipeType();\r\n\t\t// Group the triggers and actions by integration\r\n\t\tgroupItemsByIntegration();\r\n\r\n\t\t// Get recipe items on page load\r\n\t\trecipeObject( 'create', {\r\n\t\t\tallRecipes: UncannyAutomator.recipes_object\r\n\t\t});\r\n\r\n\t\t// Remove unnecessary data\r\n\t\tdelete UncannyAutomator.recipes_object;\r\n\t    delete UncannyAutomator.triggers;\r\n\t    delete UncannyAutomator.actions;\r\n\r\n\t    consoleLogLabel( 'Ended creating the main object' );\r\n\r\n\t    // Invoke the callback\r\n\t    callback();\r\n\t}\r\n\t\r\n\t// Check if WP is ready\r\n\tif ( ! isDefined( UncannyAutomator.wp ) || ! UncannyAutomator.wp ){\r\n\t\t// Define recipe type manually\r\n\t\tUncannyAutomator.recipe.type = 'user';\r\n\r\n\t\t// Complete the process\r\n\t\tcompleteProcess();\r\n\t}\r\n\telse {\r\n\t\tif ( ! isEmpty( UncannyAutomator.recipe.type ) ){\r\n\t\t\t// Complete the process\r\n\t\t\tcompleteProcess();\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Call to Recipe Type Selector\r\n\t\t\tnew RecipeTypeSelector(() => {\r\n\t\t\t\t// Complete the process\r\n\t\t\t\tcompleteProcess();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Update all the objects used for the UI using the recipes_object object\r\n *\r\n * @since 0.5\r\n *\r\n * @param {string}   action - Action to perform. Valid actions: 'create', 'delete',\r\n * @param {object}   attributes - Data, check each switch to see the required data\r\n *\r\n * @return {boolean} TRUE if the action was made successfully\r\n */\r\n\r\nexport function recipeObject( action = null, attributes = {} ){\r\n    // Create response variable and set default value\r\n    let response     = false;\r\n\r\n    // Define valid actions\r\n    let validActions = [ 'create', 'validate' ];\r\n\r\n    // Check if the action is not undefined and if it's a valid action\r\n    if ( isDefined( action ) && inArray( action, validActions ) ){\r\n        switch ( action ){\r\n            case 'create':\r\n                // Define required attributes properties\r\n                let requiredData = [ 'allRecipes' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Get this recipe in the allRecipes object\r\n                    let recipe;\r\n\r\n                    // Create allRecipes variable\r\n                    let allRecipes = attributes.allRecipes;\r\n\r\n                    $.each( allRecipes, function( index, theRecipe ){\r\n                        if ( theRecipe.ID == UncannyAutomator.recipe.id ){\r\n                            recipe = theRecipe;\r\n                        }\r\n                    });\r\n\r\n                    // Add element to all triggers, actions and closures to define the itemType. We're going to need this later\r\n                    $.each( recipe.triggers, ( index, trigger ) => trigger.itemType = 'trigger' );\r\n                    $.each( recipe.actions,  ( index, action  ) => action.itemType  = 'action'  );\r\n                    $.each( recipe.closures, ( index, closure ) => closure.itemType = 'closure' );\r\n\r\n                    // Merge all the recipe triggers, actions and closures into one array\r\n                    let items = [].concat.apply( [], [ recipe.triggers, recipe.actions, recipe.closures ] );\r\n\r\n                    // Reset items object\r\n                    itemsObject( 'reset' );\r\n\r\n                    // Check if the recipe is anonymous\r\n                    const recipeIsAnonymous = UncannyAutomator.recipe.type == 'anonymous';\r\n\r\n                    // Iterate each item and add it to the itemsObject\r\n                    $.each( items, function( index, item ){\r\n                        // We're going to get all the required information to before adding the item to the items object\r\n                        let itemToAdd;\r\n\r\n                        // Get the data from the global item\r\n                        let globalItem = getGlobalItem( item.meta.integration, item.itemType, item.meta.code );\r\n\r\n                        // Get the item code in this variable\r\n                        let itemCode = item.meta.code;\r\n\r\n                        // Check if the required PHP code for this item exists\r\n                        if ( isDefined( globalItem ) ){\r\n                            // Create variable to save all the options\r\n                            let options = {};\r\n\r\n                            // Check if it has simple options (options that aren't part of a group of options)\r\n                            if ( isDefined( globalItem.options ) ){\r\n                                $.each( globalItem.options, function( index, option ){\r\n                                    options[ option.option_code ] = [ option ];\r\n                                });\r\n                            }\r\n\r\n                            // Add group of options\r\n                            if ( isDefined( globalItem.options_group ) ){\r\n                                $.extend( true, options, globalItem.options_group );\r\n                            }\r\n\r\n                            // We're going to create another options variable to create the options object as we're going to add it to the item object\r\n                            let groupsOfOptions = {}\r\n\r\n                            $.each( options, function( groupKey, fields ){\r\n                                let allFieldsOnThisGroup = [];\r\n\r\n                                // Check if it has more this group of fields has more than one option\r\n                                let hasMoreThanOneOption = fields.length > 1;\r\n\r\n                                $.each( fields, function( index, field ){\r\n                                    // Check if value is undefined but has a default value\r\n                                    /*\r\n                                    if ( ! isDefined( item.meta[ field.option_code ] ) && isDefined( item.meta.default_value ) ){\r\n                                        item.meta[ field.option_code ] = field.default_value;\r\n                                    }\r\n                                    */\r\n\r\n                                    // Sanitize field data\r\n                                    const sanitizeFieldData = ( field ) => {\r\n                                        // Create field object\r\n                                        let fieldObject = {\r\n                                            isGroup:            hasMoreThanOneOption,\r\n                                            itemId:             item.ID,\r\n                                            itemType:           item.itemType,\r\n\r\n                                            isRequired:         isDefined( field.required ) ? field.required : false,\r\n                                            isReadOnly:         isDefined( field.read_only ) ? field.read_only : false,\r\n                                            supportsTinyMCE:    isDefined( field.supports_tinymce ) ? field.supports_tinymce : false,\r\n                                            supportsCopyToClipboard: isDefined( field.copy_to_clipboard ) ? field.copy_to_clipboard : false,\r\n\r\n                                            isAjax:             isDefined( field.is_ajax ) ? field.is_ajax : false,\r\n\r\n                                            groupId:            groupKey,\r\n                                            optionCode:         field.option_code,\r\n                                            fieldType:          field.input_type,\r\n\r\n                                            label:              field.label,\r\n                                            description:        field.description,\r\n                                            placeholder:        field.placeholder,\r\n                                            isHidden:           isDefined( field.is_hidden ) ? field.is_hidden : false,\r\n                                            tokenName:          isDefined( field.token_name ) ? field.token_name : field.label,\r\n\r\n                                            defaultValue:       field.default_value,\r\n                                            currentValue:       isDefined( item.meta[ field.option_code ] ) ? item.meta[ field.option_code ] : field.default_value,\r\n                                            relevant_tokens:    isDefined( field.relevant_tokens ) ? field.relevant_tokens : false,\r\n                                        }\r\n\r\n                                        /**\r\n                                         * We want to make supportsTokens true by\r\n                                         * default, but we have to check if the field\r\n                                         * should support tokens first.\r\n                                         * \r\n                                         * - Field type: For now, the token selector\r\n                                         * only supports text, textarea, integer, float,\r\n                                         * email, and URL fields. Check if this field\r\n                                         * is one of those.\r\n                                         * \r\n                                         * - Item type: The tokens are rendered only in\r\n                                         * the user selector, actions and closures. \r\n                                         * Check if the item type if one of those.\r\n                                         * \r\n                                         * - Read-only property: Check if the field is\r\n                                         * not read-only. Even if the field meets the\r\n                                         * previous conditions, it doesn't make sense\r\n                                         * to render the token selector on a field\r\n                                         * which value is supposed to be unmodifiable.\r\n                                         * \r\n                                         * If the field meets all the previous\r\n                                         * conditions, check if it has a defined value\r\n                                         * for the supportsTokens property. Otherwise,\r\n                                         * set it true. If it doesn't meet at least\r\n                                         * one of the conditions, make it false.\r\n                                         */\r\n                                        \r\n                                        if (\r\n                                            [ 'text', 'textarea', 'int', 'float', 'email', 'url' ].includes( fieldObject.fieldType ) &&\r\n                                            [ 'action', 'closure' ].includes( fieldObject.itemType ) &&\r\n                                            ! fieldObject.isReadOnly\r\n                                        ){\r\n                                            fieldObject.supportsTokens = isDefined( field.supports_tokens ) ? field.supports_tokens : true;\r\n                                        }\r\n                                        else {\r\n                                            fieldObject.supportsTokens = false;\r\n                                        }\r\n\r\n                                        // Check if it an AJAX field\r\n                                        if ( fieldObject.isAjax ){\r\n                                            fieldObject.targetField   = isDefined( field.fill_values_in ) ? field.fill_values_in : '';\r\n                                            fieldObject.endpoint      = isDefined( field.endpoint ) ? field.endpoint : '';\r\n                                            fieldObject.integrationId = globalItem.integration;\r\n\r\n                                            // Check if it's an ajax field without target field\r\n                                            // This means no other field will change when this one changes\r\n                                            // and that we have to do an AJAX request when rendering the field, on page load \r\n                                            if ( isEmpty( fieldObject.targetField ) ){\r\n                                                fieldObject.targetField = field.option_code;\r\n                                            }\r\n                                        }\r\n\r\n                                        // Check if it's select or radio. In that case, add the options\r\n                                        if ( [ 'select', 'radio' ].includes( fieldObject.fieldType ) ){\r\n                                            fieldObject.options = isDefined( field.options ) ? field.options : [];\r\n                                        }\r\n\r\n                                        // Return field object\r\n                                        return fieldObject;\r\n                                    }\r\n                                    \r\n                                    let fieldObject, fieldInstance;\r\n\r\n                                    // Check if it's a group of fields\r\n                                    if ( field.input_type == 'group' ){\r\n                                        // Get the field data\r\n                                        fieldObject = {\r\n                                            groupId:          groupKey,\r\n                                            optionCode:       field.option_code,\r\n                                            fieldType:        field.input_type,\r\n\r\n                                            isGroup:          hasMoreThanOneOption,\r\n                                            itemId:           item.ID,\r\n                                            itemType:         item.itemType,\r\n\r\n                                            label:            field.label,\r\n                                            description:      field.description,\r\n\r\n                                            tokenName:        isDefined( field.token_name ) ? field.token_name : field.label,\r\n\r\n                                            isRequired:       isDefined( field.required ) ? field.required : false,\r\n\r\n                                            fields: field.fields.map(( fieldData ) => {\r\n                                                return sanitizeFieldData( fieldData );\r\n                                            })\r\n                                        }\r\n\r\n                                        // Create field instance\r\n                                        fieldInstance = new FieldsGroup( fieldObject );\r\n                                    }\r\n                                    else if ( field.input_type == 'repeater' ){\r\n                                        // Try to parse the value of the repeater\r\n                                        try {\r\n                                            item.meta[ field.option_code ] = JSON.parse( item.meta[ field.option_code ] );\r\n                                        } catch ( e ){}\r\n\r\n                                        // Get field data\r\n                                        fieldObject = {\r\n                                            groupId:          groupKey,\r\n                                            optionCode:       field.option_code,\r\n                                            fieldType:        field.input_type,\r\n\r\n                                            isGroup:          hasMoreThanOneOption,\r\n                                            itemId:           item.ID,\r\n                                            itemType:         item.itemType,\r\n\r\n                                            label:            field.label,\r\n                                            description:      field.description,\r\n\r\n                                            tokenName:        isDefined( field.token_name ) ? field.token_name : field.label,\r\n\r\n                                            defaultValue:     field.default_value,\r\n                                            currentValue:     isDefined( item.meta[ field.option_code ] ) ? item.meta[ field.option_code ] : field.default_value,\r\n\r\n                                            isRequired:       isDefined( field.required ) ? field.required : false,\r\n\r\n                                            fields: field.fields.map(( fieldData ) => {\r\n                                                return sanitizeFieldData( fieldData );\r\n                                            })\r\n                                        }\r\n\r\n                                        // Check if this one has a custom \"Add row\" label\r\n                                        if ( isDefined( field.add_row_button ) ){\r\n                                            fieldObject.addRowButtonLabel = field.add_row_button;\r\n                                        }\r\n\r\n                                        // Check if this one has a custom \"Remove row\" label\r\n                                        if ( isDefined( field.remove_row_button ) ){\r\n                                            fieldObject.removeRowButtonLabel = field.remove_row_button;\r\n                                        }\r\n\r\n                                        // Create field instance\r\n                                        fieldInstance = new FieldsRepeater( fieldObject );\r\n                                    }\r\n                                    // Otherwise, treat it as a normal field\r\n                                    else {\r\n                                        // Get the field data\r\n                                        fieldObject = sanitizeFieldData( field );\r\n\r\n                                        // Create the field instance\r\n                                        fieldInstance = new Field( fieldObject.fieldType, fieldObject, false );\r\n                                    }\r\n                                   \r\n                                    // Add field to the group of fields\r\n                                    allFieldsOnThisGroup.push( fieldInstance );\r\n                                });\r\n\r\n                                // Array where we're going to save the buttons of this item\r\n                                let buttons = [];\r\n\r\n                                // Check if this group of options has buttons\r\n                                if ( isDefined( globalItem.buttons ) ){\r\n                                    // Iterate buttons\r\n                                    $.each( globalItem.buttons, ( index, button ) => {\r\n                                        // Check if we have to add the button to this group\r\n                                        if ( button.show_in == groupKey ){\r\n                                            buttons.push( button );\r\n                                        }\r\n                                    });\r\n                                }\r\n\r\n                                // Push fields to the groupsOfOptions object\r\n                                groupsOfOptions[ groupKey ] = {\r\n                                    fields:  allFieldsOnThisGroup,\r\n                                    isValid: false, // FALSE by default, but we're going to do a validation later\r\n                                    buttons: buttons\r\n                                }\r\n                            });\r\n\r\n                            // Create object with the item data\r\n                            itemToAdd = {\r\n                                id:              item.ID,\r\n                                itemType:        item.itemType,\r\n                                itemCode:        itemCode,\r\n                                integrationCode: globalItem.integration,\r\n                                isLive:          item.post_status == 'publish' ? true : false,\r\n                                options:         groupsOfOptions,\r\n                                meta:            item.meta,\r\n                                isMissing:       false,\r\n                                tokens:          isDefined( item.tokens ) ? item.tokens : [],\r\n                                inlineCss:       isDefined( globalItem.inline_css ) ? globalItem.inline_css : '',\r\n                                filterTokens:    isDefined( globalItem.filter_tokens ) ? globalItem.filter_tokens : '',\r\n                            }\r\n\r\n                            // Check if the support link is defined\r\n                            if ( isDefined( globalItem.support ) ){\r\n                                itemToAdd.support = globalItem.support;\r\n                            }\r\n\r\n                            // Create meta for those field that don't have a value saved in the database but have a default value\r\n\r\n                            // Get all fields\r\n                            let fields = {};\r\n\r\n                            // Create an object with all the options from the field\r\n                            $.each( groupsOfOptions, function( optionKey, options ){\r\n                                $.each( options.fields, function( index, field ){\r\n                                    fields[ field.getAttributes().optionCode ] = field;\r\n                                });\r\n                            });\r\n\r\n                            $.each( fields, ( index, field ) => {\r\n                                let fieldAttributes = field.getAttributes();\r\n                                if ( ( ! isDefined( itemToAdd.meta[ fieldAttributes.optionCode ] ) || isEmpty( itemToAdd.meta[ fieldAttributes.optionCode ] ) ) && ! isEmpty( fieldAttributes.currentValue ) ){\r\n                                    itemToAdd.meta[ fieldAttributes.optionCode ] = fieldAttributes.currentValue;\r\n                                }\r\n                            });\r\n\r\n                            // If it's anonymous, add the \"canLogUserIn\" property\r\n                            // Also set the default value\r\n                            if ( recipeIsAnonymous ){\r\n                                itemToAdd.canLogNewUserIn = isDefined( globalItem.can_log_in_new_user ) ? globalItem.can_log_in_new_user : true;\r\n                            }\r\n\r\n                            /*\r\n\r\n                            // Create readable meta\r\n                            itemToAdd.metaReadable = jQuery.extend( true, {}, itemToAdd.meta );\r\n\r\n                            // Iterate each meta and search for a readable value\r\n                            $.each( itemToAdd.metaReadable, ( metaKey, metaValue ) => {\r\n                                let field = fields[ metaKey ];\r\n\r\n                                // Check if there is a field with that ID\r\n                                if ( isDefined( field ) ){\r\n                                    field = field.getAttributes();\r\n\r\n                                    // Check if it's a select\r\n                                    if ( field.fieldType == 'select' ){\r\n                                        let value;\r\n\r\n                                        // Iterate each option of the select and search for the text instead of the value\r\n                                        $.each( field.options, function( index, selectOption ){\r\n                                            // Compare the value with the metaValue\r\n                                            if ( selectOption.value == metaValue ){\r\n                                                // Set new metaValue\r\n                                                itemToAdd.metaReadable[ metaKey ] = selectOption.text;\r\n                                            }\r\n                                        });\r\n                                    }\r\n                                }\r\n                            });\r\n\r\n                            // Check if we have to add default values\r\n                            $.each( fields, function( index, field ){\r\n                                if ( ! isDefined( itemToAdd.metaReadable[ field.optionCode ] ) && ! isEmpty( field.defaultValue ) ){\r\n                                    if ( field.fieldType == 'select' ){\r\n\r\n                                        // Iterate each option of the select and search for the text instead of the value\r\n                                        $.each( field.options, function( index, selectOption ){\r\n                                            // Compare the value with the metaValue\r\n                                            if ( selectOption.value == metaValue ){\r\n                                                // Set new metaValue\r\n                                                itemToAdd.metaReadable[ field.optionCode ] = selectOption.text;\r\n                                            }\r\n                                        });\r\n                                    }\r\n                                    else {\r\n                                        itemToAdd.metaReadable[ field.optionCode ] = field.defaultValue;\r\n                                    }\r\n                                }\r\n                            });\r\n\r\n                            */\r\n                        }\r\n                        else {\r\n                            // Create object with the item data\r\n                            itemToAdd = {\r\n                                id:              item.ID,\r\n                                itemType:        item.itemType,\r\n                                itemCode:        item.meta.code,\r\n                                integrationCode: item.meta.integration,\r\n                                integrationName: item.meta.integration_name,\r\n                                sentence:        item.meta.sentence,\r\n                                isLive:          item.post_status == 'publish' ? true : false,\r\n                                tokens:          [],\r\n                                options:         {},\r\n                                meta:            item.meta,\r\n                                isMissing:       true,\r\n                            }\r\n\r\n                            // If it's anonymous, add the \"canLogUserIn\" property\r\n                            // Also set the default value\r\n                            if ( recipeIsAnonymous ){\r\n                                itemToAdd.canLogNewUserIn = isDefined( item.meta.can_log_in_new_user ) ? ( item.meta.can_log_in_new_user == 'true' ) : true;\r\n                            }\r\n                        }\r\n\r\n                        // We have to add it\r\n                        itemsObject( 'add', itemToAdd );\r\n                    });\r\n\r\n                    // Check if the recipe is anonymous and can log the new user in\r\n                    if ( recipeIsAnonymous ){\r\n                        // Set the default value\r\n                        UncannyAutomator.recipe.canLogNewUserIn = false;\r\n\r\n                        // Get the recipe items\r\n                        const recipeTriggers = itemsObject( 'get', {\r\n                            filter: {\r\n                                itemType: 'trigger'\r\n                            }\r\n                        });\r\n\r\n                        // Check if it has items\r\n                        if ( Object.keys( recipeTriggers ) > 0 ){\r\n                            // Change the default value\r\n                            UncannyAutomator.recipe.canLogNewUserIn = true;\r\n\r\n                            // Iterate the triggers\r\n                            $.each( recipeTriggers, ( index, trigger ) => {\r\n                                // Check if this trigger allows the recipe\r\n                                // to log the new user in\r\n                                UncannyAutomator.recipe.canLogNewUserIn = UncannyAutomator.recipe.canLogNewUserIn && trigger.canLogNewUserIn;\r\n                            });\r\n                        }\r\n                    }\r\n\r\n\t\t\t\t\t// Check if we should validate the data\r\n\t\t\t\t\tif ( ! isDefined( attributes.validate ) || ( isDefined( attributes.validate ) && attributes.validate ) ){\r\n\t\t\t\t\t\t// Validate the recipe to update the isValid elements\r\n                    \trecipeObject( 'validate' );\r\n\t\t\t\t\t}\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'recipeObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'validate':\r\n                // Valid by default, will be changed to false if we find an error\r\n                let isRecipeValid = true;\r\n\r\n                // Check if the recipe has triggers, actions and/or closures\r\n                // Update UncannyAutomator.recipe.hasLive\r\n                $.each( UncannyAutomator.recipe.hasLive, function( itemType, has ){\r\n                    // All false\r\n                    UncannyAutomator.recipe.hasLive[ itemType ] = false;\r\n                });\r\n\r\n                // Check if there is at least one item of that type in the main object\r\n                $.each( UncannyAutomator.recipe.items, function( itemID, itemData ){\r\n                    // If at least one live item, then set TRUE\r\n                    if ( itemData.isLive ){\r\n                        UncannyAutomator.recipe.hasLive[ itemData.itemType ] = true;\r\n                    }\r\n                });\r\n\r\n                // Iterate each item\r\n                $.each( UncannyAutomator.recipe.items, function( itemID, itemData ){\r\n\r\n                    // We will use this variable to decide if the item is valid or not\r\n                    let itemIsValid = true;\r\n\r\n                    // Iterate each group of fields\r\n                    $.each( itemData.options, function( optionsGroupID, optionsGroupData ){\r\n\r\n                        // We will use this variable to decide if the group of fields is valid or not\r\n                        let groupIsValid = true;\r\n\r\n                        // Iterate each field\r\n                        $.each( optionsGroupData.fields, function( index, field ){\r\n                            // Validate the field. Read validateField comments to learn more.\r\n                            let fieldValidation = field.validate( false );\r\n\r\n                            // Check if the option is invalid, if at least one field is invalid make all the group invalid\r\n                            if ( ! fieldValidation.isValid ){\r\n                                groupIsValid = false;\r\n                            }\r\n                        });\r\n\r\n                        // Set result\r\n                        UncannyAutomator.recipe.items[ itemID ].options[ optionsGroupID ].isValid = groupIsValid;\r\n\r\n                        // Check if the group is invalid, if at least on group of fields is invalid make all the item invalid\r\n                        if ( ! groupIsValid ){\r\n                            itemIsValid = false;\r\n                        }\r\n                    });\r\n\r\n                    UncannyAutomator.recipe.items[ itemID ].isValid = itemIsValid;\r\n\r\n                    // Check if the item is invalid. If at least one item is invalid make all the recipe invalid\r\n                    if ( itemData.isLive && ! itemIsValid ){\r\n                        isRecipeValid = false;\r\n                    }\r\n                });\r\n\r\n                // Now check what items we have in the object\r\n                // We must have at least one trigger and an action or closure\r\n                // Check if it has at least one trigger\r\n                if ( ! UncannyAutomator.recipe.hasLive.trigger ){\r\n                    isRecipeValid = false;\r\n\r\n                    // Set error message\r\n                    UncannyAutomator.recipe.message.error = UncannyAutomator.i18n.validation.recipe.oneTrigger;\r\n                }\r\n                else {\r\n                    // Validate user selector\r\n                    if ( UncannyAutomator.recipe.type == 'anonymous' && ! UncannyAutomator.recipe.userSelector.isValid ){\r\n                        // Then the recipe is not valid\r\n                        isRecipeValid = false;\r\n\r\n                        // Add message\r\n                        UncannyAutomator.recipe.message.error = UncannyAutomator.i18n.validation.recipe.userSelector;\r\n                    }\r\n                    else {\r\n                        // Check if it has at least one action or closure\r\n                        if ( ! UncannyAutomator.recipe.hasLive.action && ! UncannyAutomator.recipe.hasLive.closure ){\r\n                            isRecipeValid = false;\r\n\r\n                            // Set error message\r\n                            UncannyAutomator.recipe.message.error = UncannyAutomator.i18n.validation.recipe.oneAction;\r\n                        }\r\n                        else {\r\n                            // Check if the message has to be more generic\r\n                            if ( ! UncannyAutomator.recipe.hasLive.trigger && ( ! UncannyAutomator.recipe.hasLive.action && ! UncannyAutomator.recipe.hasLive.closure ) ){\r\n                                // Set error message\r\n                                UncannyAutomator.recipe.message.error = UncannyAutomator.i18n.validation.recipe.liveItems;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                UncannyAutomator.recipe.isValid = isRecipeValid;\r\n\r\n                // Reset message if recipe is valid\r\n                if ( isRecipeValid ){\r\n                    // Reset message, we don't need it\r\n                    UncannyAutomator.recipe.message.error = '';\r\n                }\r\n\r\n                // Everything is ok, return true\r\n                response = true;\r\n\r\n                break;\r\n        }\r\n    }\r\n    else {\r\n        // Has to add error code\r\n        console.error( vsprintf( '%s: The action \"%s\" isn\\'t defined', [ 'recipeObject', action ] ) );\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Add, update, delete, update, validate and clean the main recipe object\r\n *\r\n * @since 0.2\r\n *\r\n * @param {string}   action - Action to perform. Valid actions: 'add', 'update', 'delete', 'reset', 'get', and 'clean'.\r\n * @param {object}   attributes\r\n * The required properties depend of the requested action.\r\n * For the 'update' action it have to include the properties that need to be updated in the items object.\r\n * For the 'add' action:\r\n * @param {int}      attributes.id        Item ID\r\n * @param {string}   attributes.itemType  The item type. The valid types are 'trigger', 'action' and 'closure'\r\n *\r\n * @return {boolean} TRUE if the action was made successfully\r\n */\r\n\r\nexport function itemsObject( action = null, attributes = {} ){\r\n    // Create response variable and set default value\r\n    let response     = false;\r\n\r\n    // Define valid actions\r\n    let validActions = [ 'add', 'delete', 'clean', 'reset', 'update', 'get' ];\r\n\r\n    // Check if the action is not undefined and if it's a valid action\r\n    if ( isDefined( action ) && inArray( action, validActions ) ){\r\n\r\n        switch ( action ){\r\n            case 'add':\r\n                // Extend default attributes object with default values\r\n                attributes = $.extend({\r\n                    isValid: false, // Because it's going to be empty\r\n                    isLive: false, // Draft by default\r\n                }, attributes );\r\n\r\n                // Define required attributes properties\r\n                let requiredData = [ 'id', 'itemType' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n\r\n                    // Has ID, check if it wasn't added\r\n                    if ( ! isDefined( UncannyAutomator.recipe.items[ attributes.id ] ) ){\r\n\r\n                        // Create property\r\n                        UncannyAutomator.recipe.items[ attributes.id ] = attributes;\r\n\r\n                        // Clean undefined properties\r\n                        itemsObject( 'clean', {} );\r\n\r\n                        // Everything is ok, return true\r\n                        response = true;\r\n                    }\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'itemsObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'delete':\r\n                attributes = $.extend({\r\n                    isValid: false,\r\n                }, attributes );\r\n\r\n                if ( ! isEmpty( attributes.id ) ){\r\n\r\n                    if ( isDefined( UncannyAutomator.recipe.items[ attributes.id ] ) ){\r\n                        delete UncannyAutomator.recipe.items[ attributes.id ];\r\n\r\n                        // Everything is ok, return true\r\n                        response = true;\r\n                    }\r\n                    else {\r\n                        console.error( vsprintf( '%s: We didn\\'t find an item with this the ID %s', [ 'itemsObject', attributes.id ] ) );\r\n                    }\r\n\r\n                }\r\n                else {\r\n                    console.error( vsprintf( '%s: Invalid item ID', [ 'itemsObject' ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'clean':\r\n                // Delete undefined and null properties\r\n\r\n                let items = {};\r\n\r\n                $.each( UncannyAutomator.recipe.items, function( index, value ){\r\n                    if ( isDefined( value ) ){\r\n                        items[ index ] = value;\r\n                    }\r\n                });\r\n\r\n                UncannyAutomator.recipe.items = items;\r\n\r\n                // Everything is ok, return true\r\n                response = true;\r\n\r\n                break;\r\n\r\n            case 'update':\r\n                // Update item attributes\r\n\r\n                if ( ! isEmpty( attributes.id ) ){\r\n\r\n                    if ( isDefined( UncannyAutomator.recipe.items[ attributes.id ] ) ){\r\n\r\n                        // Extend item object properties with new ones\r\n                        UncannyAutomator.recipe.items[ attributes.id ] = $.extend( {}, UncannyAutomator.recipe.items[ attributes.id ], attributes );\r\n\r\n                        // Everything is ok, return true\r\n                        response = true;\r\n\r\n                    }\r\n                    else {\r\n                        console.error( vsprintf( '%s: We didn\\'t find an item with this the ID %s', [ 'itemsObject', attributes.id ] ) );\r\n                    }\r\n\r\n                }\r\n                else {\r\n                    console.error( vsprintf( '%s: Invalid item ID', [ 'itemsObject' ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'reset':\r\n                // Delete all the items in the items object\r\n                UncannyAutomator.recipe.items = {}\r\n\r\n                // Return true\r\n                response = true;\r\n                break;\r\n\r\n            case 'get':\r\n                // Check if we have to filter items\r\n                if ( ! isEmpty( attributes.filter ) ){\r\n                    // Create a new items object. We're going to add items to this one if the filters match\r\n                    let items = {}\r\n\r\n                    // Iterate all current items\r\n                    $.each( UncannyAutomator.recipe.items, function( itemId, item ){\r\n                        let matchFilters = true;\r\n\r\n                        $.each( attributes.filter, function( key, value ){\r\n                            if ( item[ key ] != value ){\r\n                                matchFilters = false;\r\n                            }\r\n                        });\r\n\r\n                        // Check if we have to add this item\r\n                        if ( matchFilters ){\r\n                            items[ itemId ] = item;\r\n                        }\r\n                    });\r\n\r\n                    // Return the new items object\r\n                    response = items;\r\n                }\r\n                else {\r\n                    response = UncannyAutomator.recipe.items;\r\n                }\r\n\r\n                break;\r\n        }\r\n    }\r\n    else {\r\n        // Has to add error code\r\n        console.error( vsprintf( '%s: The action \"%s\" isn\\'t defined', [ 'itemsObject', action ] ) );\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Add the triggers and actions to each integration.\r\n * Change the data structure so it's possible to know\r\n * what items and integrations are pro\r\n *\r\n * @since 2.1.4\r\n */\r\nexport function groupItemsByIntegration(){\r\n    // Iterate the integrations\r\n    Object.entries( UncannyAutomator.integrations ).forEach(([ integrationID, integration ]) => {\r\n        // Get the list of available triggers and actions\r\n        // Sort them alphabetically\r\n        let triggers = {\r\n                available:   sortArrayOfObjectsAlphabetically( UncannyAutomator.triggers.filter( item => item.integration == integrationID ), 'select_option_name', sentence => replaceCurlyBraces( sentence ) ),\r\n                unavailable: [],\r\n            },\r\n            actions  = {\r\n                available:   sortArrayOfObjectsAlphabetically( UncannyAutomator.actions.filter( item => item.integration == integrationID ), 'select_option_name', sentence => replaceCurlyBraces( sentence ) ),\r\n                unavailable: []\r\n            };\r\n\r\n        if ( ! isDefined( UncannyAutomator.wp ) || ! UncannyAutomator.wp ){\r\n            // Check if there are PRO items for this integration\r\n            if (\r\n                isDefined( UncannyAutomator.proFeatures ) && \r\n                isDefined( UncannyAutomator.proFeatures[ integrationID ] )\r\n            ){\r\n                // Push the pro logged-in triggers to the unavailable triggers array\r\n                // Sort them alphabetically\r\n                triggers.unavailable = sortArrayOfObjectsAlphabetically( UncannyAutomator.proFeatures[ integrationID ].triggers.filter( trigger => trigger.type == 'logged-in' ), 'name', sentence => replaceCurlyBraces( sentence ) );\r\n\r\n                // Push the pro actions to the unavailable actions array\r\n                // Sort them alphabetically\r\n                actions.unavailable  = sortArrayOfObjectsAlphabetically( UncannyAutomator.proFeatures[ integrationID ].actions, 'name', sentence => replaceCurlyBraces( sentence ) );\r\n            }\r\n        }\r\n\r\n        // Evaluate if all the available items are pro\r\n        // To do that, iterate every element using the method every\r\n        // and return the value of \"is_pro\"\r\n        triggers.allItemsArePro     = triggers.available.every( item => isDefined( item.is_pro ) ? item.is_pro : false );\r\n        actions.allItemsArePro      = actions.available.every( item => isDefined( item.is_pro ) ? item.is_pro : false );\r\n\r\n        // Check if the integration has available triggers and actions\r\n        triggers.hasAvailableItems  = triggers.available.length > 0;\r\n        actions.hasAvailableItems   = actions.available.length > 0;\r\n\r\n        // Check if the integration has unavailable triggers and actions\r\n        triggers.hasUnavailableItems = triggers.unavailable.length > 0;\r\n        actions.hasUnavailableItems  = actions.unavailable.length > 0;\r\n\r\n        // Check if it has any kind of items\r\n        triggers.hasTriggers = triggers.hasAvailableItems || triggers.unavailable.length > 0;\r\n        actions.hasActions   = actions.hasAvailableItems || actions.unavailable.length > 0;\r\n\r\n        // Add the items to the integration\r\n        UncannyAutomator.integrations[ integrationID ].items = {\r\n            triggers: triggers,\r\n            actions:  actions\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Sort an array of objects using one of the properties\r\n *\r\n * @since  2.1.4\r\n * @param  {Array}  items             The array\r\n * @param  {String} propertyToCompare The property used to compare the elements\r\n * @return {Array}                    The array, sorted\r\n */\r\nexport function sortArrayOfObjectsAlphabetically( items = [], propertyToCompare = '', filter ){\r\n    // Check if there isn't a filter defined\r\n    if ( ! isDefined( filter ) ){\r\n        filter = value => value;\r\n    }\r\n\r\n    // Check if it's an array and it's not empty\r\n    if ( Array.isArray( items ) && ! isEmpty( items ) ){\r\n        // Sort the array of integrations using the integration name\r\n        items = items.sort(( a, b ) => {\r\n            // Define the default value\r\n            let compare = 0;\r\n\r\n            // Check if the elements have the properties we're going to use to compare\r\n            if ( isDefined( a[ propertyToCompare ] ) && isDefined( b[ propertyToCompare ] ) ){\r\n                // Filter the values\r\n                let valueA = filter( a[ propertyToCompare ] ),\r\n                    valueB = filter( b[ propertyToCompare ] );\r\n\r\n                // Check which integration name should go first\r\n                compare = valueA.localeCompare( valueB );\r\n\r\n                // Validate the value\r\n                // Do NOT rely on exact return values of -1 or 1\r\n                // Negative and positive integer results vary between browsers (as well as between browser versions) because the W3C specification only mandates negative and positive values. Some browsers may return -2 or 2, or even some other negative or positive value.\r\n                compare = compare > 0 ? 1 : compare;\r\n                compare = compare < 0 ? -1 : compare;\r\n            }  \r\n\r\n            // Return result\r\n            return compare;\r\n        });\r\n    }\r\n\r\n    // Return the new array\r\n    return items;\r\n}\r\n\r\n/**\r\n * Get a list of triggers or actions by integration\r\n * @param  {String} integrationID The integration ID\r\n * @param  {String} itemType      The item type. Valid values: \"trigger\", \"triggers\", \"action\" and \"actions\"\r\n * @return {Object}               And object with the available and unavailable items\r\n *\r\n * @since 2.1.4\r\n */\r\nexport function getItemsByIntegration( integrationID = '', itemType = 'triggers' ){\r\n    // Create the array where we're going to save the items\r\n    let items = {\r\n        available: {},\r\n        unavailable: {}\r\n    };\r\n\r\n    // Convert itemType \"trigger\" to \"triggers\"\r\n    itemType = itemType == 'trigger' ? 'triggers' : itemType;\r\n    // Convert itemType \"action\" to \"actions\"\r\n    itemType = itemType == 'action' ? 'actions' : itemType;\r\n\r\n    // Validate the parameter itemType\r\n    if ( [ 'triggers', 'actions' ].includes( itemType ) ){\r\n        // Check if the integration ID is defined\r\n        if ( ! isEmpty( integrationID ) ){\r\n            // Check if the integration exists\r\n            if ( isDefined( UncannyAutomator.integrations[ integrationID ] ) ){\r\n                // Get the requested items\r\n                items = UncannyAutomator.integrations[ integrationID ].items[ itemType ];\r\n            }\r\n        }\r\n    }\r\n\r\n    // Return the triggers\r\n    return items;\r\n}\r\n\r\n/**\r\n * Update user selector data\r\n *\r\n * @since  2.0\r\n */\r\n\r\nexport function userSelectorObject( action = null, attributes = {} ){\r\n    // Create response variable and set default value\r\n    let response     = false;\r\n\r\n    // Define valid actions\r\n    let validActions = [ 'set-step', 'get-step', 'set-source', 'update-fields', 'reset-fields' ];\r\n\r\n    // Create shortcut of the user selector object\r\n    const userSelector = UncannyAutomator.recipe.userSelector;\r\n\r\n    // Check if the action is not undefined and if it's a valid action\r\n    if ( isDefined( action ) && inArray( action, validActions ) ){\r\n        // Create empty array to check if the actions have the required data\r\n        let requiredData = [];\r\n\r\n        switch ( action ){\r\n            /**\r\n             * Get the current step so we know what we have to render\r\n             * There are 4 steps:\r\n             *\r\n             * 1. select-source: Where the recipe creator select the source of the user.\r\n             *                   The options are \"Existing user\" and \"New user\".\r\n             * 2. set-options: Where the recipe creator defines values of the fields.\r\n             * 3. show-sentence: When the data is complete and valid.\r\n             */\r\n    \r\n            case 'set-step':\r\n                // Define required attributes properties\r\n                requiredData = [ 'step' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Set status\r\n                    UncannyAutomator.recipe.userSelector.step = attributes.step;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'userSelectorObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'get-step':\r\n                // Create the variable we're going to return\r\n                // Set default value\r\n                let step = 'select-source';\r\n\r\n                // Check if the step property is defined\r\n                if ( isDefined( UncannyAutomator.recipe.userSelector.step ) ){\r\n                    // If it is, then return that value\r\n                    step = UncannyAutomator.recipe.userSelector.step;\r\n                }\r\n                else {\r\n                    // Try to get step\r\n                    // Check if there are fields saved\r\n                    if ( ! isEmpty( UncannyAutomator.recipe.userSelector.fields[ UncannyAutomator.recipe.userSelector.source ] ) ){\r\n                        // Show sentence\r\n                        step = 'show-sentence';\r\n\r\n                        // If we have fields it's because we already valid them before,\r\n                        // thus the user selector is valid\r\n                        UncannyAutomator.recipe.userSelector.isValid = true;\r\n                    }\r\n                }\r\n\r\n                // Return step\r\n                response = step;\r\n\r\n                break;\r\n\r\n            case 'set-source':\r\n                // Define required attributes properties\r\n                requiredData = [ 'source' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Set status\r\n                    UncannyAutomator.recipe.userSelector.source = attributes.source;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'userSelectorObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'update-fields':\r\n                // Define required attributes properties\r\n                requiredData = [ 'source', 'fields' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Check if the source parameter is valid\r\n                    if ( [ 'existingUser', 'newUser' ].includes( attributes.source ) ){\r\n                        // Check if we already have fields\r\n                        if ( isEmpty( UncannyAutomator.recipe.userSelector.fields ) ){\r\n                            UncannyAutomator.recipe.userSelector.fields = {\r\n                                existingUser: {},\r\n                                newUser: {}\r\n                            }\r\n                        }\r\n\r\n                        // Update fields\r\n                        UncannyAutomator.recipe.userSelector.fields[ attributes.source ] = $.extend( {}, UncannyAutomator.recipe.userSelector.fields[ attributes.source ], attributes.fields );\r\n                    }\r\n                    else {\r\n                        // Show to the developer what's wrong\r\n                        console.error( vsprintf( '%s: The source parameter is invalid. Valid values are: %s', [ 'userSelectorObject', [ 'existingUser', 'newUser' ] ] ) );\r\n                    }  \r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'userSelectorObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'reset-fields':\r\n                // Return boolean\r\n                UncannyAutomator.recipe.userSelector.fields = {\r\n                    existingUser: {},\r\n                    newUser: {}\r\n                }\r\n                break;\r\n        }\r\n    }\r\n    else {\r\n        // Has to add error code\r\n        console.error( vsprintf( '%s: The action \"%s\" isn\\'t defined', [ 'userSelectorObject', action ] ) );\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Filter triggers, actions and closures by recipe type.\r\n * This won't filter the items of a recipe, but the available\r\n * items in Automator\r\n *\r\n * @since 2.0\r\n * \r\n * @return null \r\n */\r\n\r\nexport function filterAutomatorItemsByRecipeType(){\r\n    // Check if the type attribute has a valid value\r\n    if ( [ 'user', 'anonymous' ].includes( UncannyAutomator.recipe.type ) ){\r\n        // Check if debug mode is enabled\r\n        if ( UncannyAutomator.dev.debugMode ){\r\n            // Start group\r\n            consoleLogLabel( 'Filter Automator items', true, {\r\n                collapseGroup: true\r\n            });\r\n\r\n            // Show current recipe type\r\n            console.log( vsprintf( 'Current recipe type: %s', [ UncannyAutomator.recipe.type ] ) );\r\n        }\r\n\r\n        // Filter triggers\r\n        UncannyAutomator.triggers = UncannyAutomator.triggers.filter(( trigger ) => {\r\n            // Check if debug mode is enabled\r\n            if ( UncannyAutomator.dev.debugMode ){\r\n                // Show trigger\r\n                console.log( trigger );\r\n\r\n                // Show decision\r\n                if ( trigger.type == UncannyAutomator.recipe.type ){\r\n                    consoleLogResult( 'success', 'Keep' );\r\n                }\r\n                else {\r\n                    consoleLogResult( 'error', 'Remove' );\r\n                }\r\n            }\r\n\r\n            // Check if it matches the recipe type\r\n            return trigger.type == UncannyAutomator.recipe.type;\r\n        });\r\n\r\n        // Check if debug mode is enabled\r\n        if ( UncannyAutomator.dev.debugMode ){\r\n            // Start group\r\n            console.groupEnd();\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Performs a REST Call\r\n *\r\n * @since     0.1\r\n * @modified  0.5\r\n *\r\n * @param {string}    endPoint - Endpoint of the REST call\r\n * @param {object}    data - Data to be sent in the call\r\n * @param {callback}  [onSuccess] - Function to be invoked if the call is successful\r\n * @param {callback}  [onFail] - Function to be invoked if the call fails\r\n *\r\n * @return null\r\n */\r\n\r\nexport function restCall( endPoint = null, data = null, onSuccess = null, onFail = null, options = {} ){\r\n    // Define the valid endpoints\r\n    let validEndpoints = [ 'add', 'delete', 'update', 'change_post_status', 'recipe_completions_allowed', 'change_post_title', 'change_post_recipe_type', 'user-selector', 'set_recipe_terms' ];\r\n\r\n    // Check custom options\r\n    options = $.extend({}, {\r\n        'requiresRecipesObject': true,\r\n        'renderUI':              true\r\n    }, options );\r\n\r\n    // Check if the endPoint parameter is a valid endpoint\r\n    if ( inArray( endPoint, validEndpoints ) ){\r\n\r\n        // Do AJAX\r\n        $.ajax({\r\n            method: 'POST',\r\n            url:    `${ UncannyAutomator.restURL }/${endPoint}/`,\r\n            data:   $.param( data ) + '&' + $.param({ doing_rest: 1 }),\r\n\r\n            // Attach Nonce the the header of the request\r\n            beforeSend: function( xhr ){\r\n                xhr.setRequestHeader( 'X-WP-Nonce', UncannyAutomator.nonce );\r\n            },\r\n\r\n            success: function( response ){\r\n                // Show console messages if debug is enabled\r\n                if ( UncannyAutomator.dev.debugMode ){\r\n                    consoleLogLabel( 'REST call ✅', true, {\r\n                        collapseGroup: true\r\n                    });\r\n                    console.log( `Endpoint: ${ endPoint }` );\r\n                    console.log( 'Data:' );\r\n                    console.log( data );\r\n                    console.log( 'Response:' );\r\n                    console.log( response );\r\n                    console.groupEnd();\r\n                }\r\n\r\n                // Check if the request succeeded\r\n                if ( response.success ){\r\n                    // Check if we have the new recipes_object, otherwise the data will change on the server but not in the UI\r\n                    if ( isDefined( response.recipes_object ) || ! options.requiresRecipesObject ){\r\n                        // Check if onSuccess\r\n                        if ( isDefined( onSuccess ) ){\r\n                            // Check if we have to render the UI again\r\n                            if ( options.renderUI ){\r\n                                recipeObject( 'create', {\r\n                                    allRecipes: response.recipes_object\r\n                                });\r\n                            }\r\n\r\n                            // Invoke callback\r\n                            onSuccess( response );\r\n                        }\r\n                    }\r\n                    else {\r\n                        // The call was successful, but the new recipes_object is missing\r\n                        console.error( 'The call was successful, but the new recipes_object is missing.' );\r\n\r\n                        // Check if the onFail callback is defined\r\n                        if ( isDefined( onFail ) ){\r\n                            // Invoke callback\r\n                            onFail( response );\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    // The call was successful, but there were errors,\r\n                    console.error( 'The call was successful, but there were errors.' );\r\n                    // console.log( response );\r\n\r\n                    // Check if the onFail callback is defined\r\n                    if ( isDefined( onFail ) ){\r\n                        // Invoke callback\r\n                        onFail( response );\r\n                    }\r\n                }\r\n            },\r\n\r\n            statusCode: {\r\n                403: function( response ){\r\n                    // Show console messages if debug is enabled\r\n                    if ( UncannyAutomator.dev.debugMode ){\r\n                        consoleLogLabel( 'REST call 🔴', true, {\r\n                            collapseGroup: true\r\n                        });\r\n                        console.log( 'Data:' );\r\n                        console.log( data );\r\n                        console.log( 'Response' );\r\n                        console.log( '%c403: Access denied', 'color: red' );\r\n                        console.groupEnd();\r\n                    }\r\n\r\n                    if ( isDefined( onFail ) ){\r\n                        onFail( response );\r\n                    }\r\n                }\r\n            },\r\n\r\n            fail: function ( response ){\r\n                // Show console messages if debug is enabled\r\n                if ( UncannyAutomator.dev.debugMode ){\r\n                    consoleLogLabel( 'REST call 🔴', true, {\r\n                        collapseGroup: true\r\n                    });\r\n                    console.log( 'Data:' );\r\n                    console.log( data );\r\n                    console.log( 'Response' );\r\n                    console.log( '%cUnknown error', 'color: red' );\r\n                    console.groupEnd();\r\n                }\r\n\r\n                if ( isDefined( onFail ) ){\r\n                    onFail( response );\r\n                }\r\n            },\r\n        });\r\n    }\r\n    else {\r\n        console.error( vsprintf( 'The %s endPoint does not exists. The valid endpoints are %s', [ endPoint, validEndpoints.join( ', ' ) ] ) );\r\n    }\r\n}\r\n\r\n/**\r\n * Performs an AJAX request\r\n *\r\n * @since 0.5\r\n *\r\n * @param {object}    data - Data to be sent in the request\r\n * @param {callback}  [onSuccess] - Function to be invoked if the request is successful\r\n * @param {callback}  [onFail] - Function to be invoked if the request fails\r\n *\r\n * @return null\r\n */\r\n\r\nexport function AJAXRequest( action = null, data = null, onSuccess = null, onFail = null ){\r\n\r\n    // Check that {action} is defined\r\n    if ( isDefined( action ) ){\r\n        // Add {action} to the data object\r\n        data = $.extend( true, data, {\r\n            action: action,\r\n            nonce: UncannyAutomator.nonce\r\n        });\r\n\r\n        // Do AJAX\r\n        $.ajax({\r\n            method:   'POST',\r\n            dataType: 'json',\r\n            url:      ajaxurl,\r\n            data:     data,\r\n\r\n            success: function( response  ){\r\n                // Show console messages if debug is enabled\r\n                if ( UncannyAutomator.dev.debugMode ){\r\n                    consoleLogLabel( 'AJAX call ✅', true, {\r\n                        collapseGroup: true\r\n                    });\r\n                    console.log( 'Data:' );\r\n                    console.log( data );\r\n                    console.log( 'Response' );\r\n                    console.log( response );\r\n                    console.groupEnd();\r\n                }\r\n\r\n                // Reload page if user authentication fails\r\n                if ( isDefined( response.status ) && response.status == 'auth-failed' ){\r\n                    location.reload();\r\n                }\r\n                else {\r\n                    // Check if onSuccess is defined\r\n                    if ( isDefined( onSuccess ) ){\r\n                        // Invoke callback\r\n                        onSuccess( response, data );\r\n                    }\r\n                }\r\n            },\r\n\r\n            statusCode: {\r\n                403: function(){\r\n                    // Show console messages if debug is enabled\r\n                    if ( UncannyAutomator.dev.debugMode ){\r\n                        consoleLogLabel( 'AJAX call 🔴', true, {\r\n                            collapseGroup: true\r\n                        });\r\n                        console.log( 'Data:' );\r\n                        console.log( data );\r\n                        console.log( 'Response' );\r\n                        consoleLogLabel( '403: Access denied', false, { bgColor: '#ff0000' });\r\n                        console.groupEnd();\r\n                    }\r\n\r\n                    if ( isDefined( onFail ) ){\r\n                        onFail( response );\r\n                    }\r\n\r\n                    // Check if the onFail callback is defined\r\n                    if ( isDefined( onFail ) ){\r\n                        // Invoke callback\r\n                        onFail( response );\r\n                    }\r\n                }\r\n            },\r\n\r\n            fail: function ( response ){\r\n                // Show console messages if debug is enabled\r\n                if ( UncannyAutomator.dev.debugMode ){\r\n                    consoleLogLabel( 'AJAX call 🔴', true, {\r\n                        collapseGroup: true\r\n                    });\r\n                    console.log( 'Data:' );\r\n                    console.log( data );\r\n                    console.log( 'Response' );\r\n                    console.log( '%cUnknown error', 'color: red' );\r\n                    console.groupEnd();\r\n                }\r\n\r\n                if ( isDefined( onFail ) ){\r\n                    onFail( response );\r\n                }\r\n\r\n                // console.log( '%c Failed ', 'background: #ba3535; padding: 2px; color: #fff' );\r\n                // console.log( response );\r\n            }\r\n        });\r\n    }\r\n    else {\r\n        console.error( 'We cannot do this AJAX request. {action} is not defined.' );\r\n    }\r\n}\r\n\r\n/**\r\n * This will return all the current value of the field, even if they aren't saved on the database\r\n * This will use .val() to get the values\r\n *\r\n * @since  1.0\r\n *\r\n * @param {int} itemId - The ID of the item\r\n */\r\n\r\nexport function getCurrentFieldsValues( itemId ){\r\n    let values = {};\r\n\r\n    // Iterate the items' group of fields\r\n    $.each( UncannyAutomator.recipe.items[ itemId ].options, ( index, groupOfFields) => {\r\n        // Iterate each field\r\n        $.each( groupOfFields.fields, ( index, field ) => {\r\n            // Get value\r\n            let fieldId    = field.getFieldID(),\r\n                fieldValue = field.getValue();\r\n\r\n            // Check if it isn't defined. In that case get the current value from the currentValue attribute\r\n            if ( ! isDefined( fieldValue ) ){\r\n                fieldValue = field.getAttributes().currentValue;\r\n            }\r\n\r\n            // Save value\r\n            values[ fieldId ] = fieldValue;\r\n        });\r\n    });\r\n\r\n    return values;\r\n}\r\n\r\n/**\r\n * Get a Field instance\r\n *\r\n * @since 0.5\r\n *\r\n * @param {int}     itemId - The item ID\r\n * @param {string}  fieldId - The field ID\r\n *\r\n * @return {Field}  a Field instance\r\n */\r\n\r\nexport function getField( itemId, fieldId ){\r\n    let field;\r\n\r\n    $.each( UncannyAutomator.recipe.items[ itemId ].options, function( optionsGroupId, optionsGroup ){\r\n        $.each( optionsGroup.fields, function( index, fieldInstance ){\r\n            if ( fieldId == fieldInstance.getFieldID() ){\r\n                field = fieldInstance;\r\n            }\r\n        });\r\n    });\r\n\r\n    return field;\r\n}\r\n\r\n/**\r\n * Get data about a trigger, action or closure\r\n *\r\n * @since 0.5\r\n *\r\n * @param {string}   itemType - The item type. Valid values are trigger, action and closure\r\n * @param {string}   itemCode - The item code\r\n *\r\n * @return {object}  Item's data\r\n */\r\n\r\nexport function getGlobalItem( integrationID = '', itemType = '', itemCode = '' ){\r\n\tlet theItem;\r\n\r\n\t// Check if all are defined\r\n\tif ( ! isEmpty( integrationID ) && ! isEmpty( itemType ) && ! isEmpty( itemCode ) ){\r\n\t\tlet integrationItems = {};\r\n\r\n\t\t// Check if the we're trying to get a trigger or action\r\n\t\tif ( itemType == 'trigger' || itemType == 'action' ){\r\n\t\t\t// Check if the integration exists\r\n\t\t\tif ( isDefined( UncannyAutomator.integrations[ integrationID ] ) ){\r\n\t\t\t\t// Create a reference to the integration\r\n\t\t\t\tlet integration = UncannyAutomator.integrations[ integrationID ];\r\n\r\n\t\t\t\t// Check if the items are defined\r\n\t\t\t\tif ( isDefined( integration.items ) ){\r\n\t\t\t\t\t// Set integrationItems\r\n\t\t\t\t\tintegrationItems = itemType == 'trigger' ? integration.items.triggers.available : integration.items.actions.available;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconsole.log( '%cNot ready, who is calling this?', 'background: red; color: #fff; font-weight: 500; padding: 2px 6px;' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ( itemType == 'closure' ){\r\n\t\t\tintegrationItems = UncannyAutomator.closures;\r\n\t\t}\r\n\r\n\t\t// Search for the item\r\n\t\t$.each( integrationItems, function( index, item ){\r\n\t\t\tif ( item.code == itemCode ){\r\n\t\t\t\t// Save the item\r\n\t\t\t\ttheItem = item;\r\n\r\n\t\t\t\t// Return false in the loop callback to break the loop\r\n\t\t \t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Return the item\r\n\treturn theItem;\r\n}\r\n\r\n/**\r\n * In Automator DOM elements are deleted and created in each step, so the reference to a DOM element change.\r\n * Use this method to get a metabox, item of optionGroup\r\n *\r\n * @since 0.2\r\n *\r\n * @param {string}   element - Code of the element that you want to get\r\n * @param {object}   attributes - Contains required data to get the elements. Depends of the \"element\" value. Check the variable requiredData in each case.\r\n *\r\n * @return {object}  Object with DOM elements. The properties depend of \"element\"\r\n */\r\n\r\nexport function getDOMElements( element, attributes = {} ){\r\n    // Create response object\r\n    let response = {}\r\n\r\n    // Define valid actions\r\n    let validElements = [ 'metabox', 'items', 'item', 'optionGroup', 'lastItem', 'user-selector' ];\r\n\r\n    // Check if the action is not undefined and if it's a valid action\r\n    if ( isDefined( element ) && inArray( element, validElements ) ){\r\n        // Create array that will store all the requires attributes properties based on the requested element\r\n        let requiredData = [];\r\n\r\n        switch ( element ){\r\n            case 'metabox':\r\n                // Extend default attributes object with default values\r\n                attributes = $.extend({}, attributes );\r\n\r\n                // Define required attributes properties\r\n                requiredData = [ 'type' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    attributes.cssSelector__metabox;\r\n\r\n                    // Check the itemType\r\n                    if ( attributes.type == 'trigger' ){\r\n                        attributes.cssSelector__metabox = '#recipe-triggers-ui';\r\n                    }\r\n                    else if ( attributes.type == 'action' ){\r\n                        attributes.cssSelector__metabox = '#recipe-actions-ui';\r\n                    }\r\n\r\n                    let $metabox = $( attributes.cssSelector__metabox )\r\n\r\n                    response = $metabox;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'itemsObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'items':\r\n                // Extend default attributes object with default values\r\n                attributes = $.extend({}, attributes );\r\n\r\n                // Define required attributes properties\r\n                requiredData = [ 'type' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    let metabox = getDOMElements( 'metabox', {\r\n                        type: attributes.type\r\n                    });\r\n\r\n                    // Get jQuery DOM element\r\n                    let $items = metabox.find( '.item:not(.item--user-selector):not(.item--start):not(.item--closure)' );\r\n\r\n                    // Add element to the response\r\n                    response = $items;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'itemsObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'item':\r\n                // Extend default attributes object with default values\r\n                attributes = $.extend({}, attributes );\r\n\r\n                // Define required attributes properties\r\n                requiredData = [ 'id' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Define CSS Selector\r\n                    attributes.cssSelector = '.uap .item[data-id=\"' + attributes.id + '\"]';\r\n\r\n                    // Get jQuery DOM element\r\n                    let $item = $( attributes.cssSelector ),\r\n                        $contentContainer = $item.find( '.item__content' );\r\n\r\n                    // Add element to the response\r\n                    response.item = $item;\r\n                    response.contentContainer = $contentContainer;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'itemsObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'optionGroup':\r\n                // Extend default attributes object with default values\r\n                attributes = $.extend({}, attributes );\r\n\r\n                // Define required attributes properties\r\n                requiredData = [ 'itemID', 'groupID' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Get main object\r\n                    let item = getDOMElements( 'item', { id: attributes.itemID } ).item;\r\n\r\n                    // Define CSS Selector\r\n                    attributes.cssSelector__tokenInSentence = '.item-title__token[data-token-id=\"' + attributes.groupID + '\"]';\r\n                    attributes.cssSelector__fieldsContainer = '.item-options__group[data-optiongroup=\"' + attributes.groupID + '\"]';\r\n\r\n                    let $tokenInSentence  = item.find( attributes.cssSelector__tokenInSentence ),\r\n                        $fieldsContainer  = item.find( attributes.cssSelector__fieldsContainer ),\r\n                        $optionsContainer = item.find( '.item-options' );\r\n\r\n                    response.tokenInSentence  = $tokenInSentence;\r\n                    response.fieldsContainer  = $fieldsContainer;\r\n                    response.optionsContainer = $optionsContainer;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'itemsObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'lastItem':\r\n                // Extend default attributes object with default values\r\n                attributes = $.extend({}, attributes );\r\n\r\n                // Define required attributes properties\r\n                requiredData = [ 'type' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Get metabox\r\n                    let metabox = getDOMElements( 'metabox', {\r\n                        type: attributes.type\r\n                    });\r\n\r\n                    // Get last item\r\n                    let lastItem = metabox.find( '.item:not(.item--user-selector):not(.item--start):not(.item--closure)' ).last();\r\n\r\n                    response = lastItem;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'itemsObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'user-selector':\r\n                // Get user selector container\r\n                response = $( '.user-selector' );\r\n\r\n                break;\r\n        }\r\n    }\r\n    else {\r\n         // Has to add error code\r\n        console.error( vsprintf( '%s: The element \"%s\" isn\\'t defined', [ 'getDOMElements', element ] ) );\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Get tokens object\r\n * To be changed soon\r\n *\r\n * @since 0.5\r\n *\r\n * @param {string}  itemType - The item type, 'trigger', 'action' or 'closure'\r\n *\r\n * @return {object} Object with all the tokens\r\n */\r\n\r\nexport function getTokens( itemType, dataType ){\r\n    let tokensList = [];\r\n\r\n    // Create common tokens\r\n    const commonTokens = {\r\n        id:     'common',\r\n        name:   UncannyAutomator.i18n.tokens.global.common,\r\n        icon:   'uo-icon--bolt',\r\n        tokens: [\r\n            {\r\n                id:   'site_name',\r\n                type: 'text',\r\n                name:  UncannyAutomator.i18n.tokens.global.siteName,\r\n            },\r\n        ]\r\n    }\r\n\r\n    // Check if it's a field in a trigger or user-selector section,\r\n    // in an anonymous recipe then don't add user related tokens\r\n    if ( ! ( UncannyAutomator.recipe.type == 'anonymous' && ( itemType == 'trigger' || itemType == 'user-selector' ) ) ){\r\n        // Add user related tokens\r\n        commonTokens.tokens.push(\r\n            {\r\n                id:   'user_id',\r\n                type: 'int',\r\n                name:  UncannyAutomator.i18n.tokens.global.userID,\r\n            },\r\n            {\r\n                id:   'user_username',\r\n                type: 'text',\r\n                name:  UncannyAutomator.i18n.tokens.global.userUsername,\r\n            },\r\n            {\r\n                id:   'user_firstname',\r\n                type: 'text',\r\n                name:  UncannyAutomator.i18n.tokens.global.userFirstName,\r\n            },\r\n            {\r\n                id:   'user_lastname',\r\n                type: 'text',\r\n                name:  UncannyAutomator.i18n.tokens.global.userLastName,\r\n            },\r\n            {\r\n                id:   'user_email',\r\n                type: 'email',\r\n                name:  UncannyAutomator.i18n.tokens.global.userEmail,\r\n            },\r\n            {\r\n                id:   'user_displayname',\r\n                type: 'text',\r\n                name:  UncannyAutomator.i18n.tokens.global.userDisplay,\r\n            },\r\n            {\r\n                id:   'reset_pass_link',\r\n                type: 'url',\r\n                name:  UncannyAutomator.i18n.tokens.global.userResetPassLink,\r\n            }\r\n        );\r\n    }\r\n\r\n    // Add other common tokens\r\n    commonTokens.tokens.push(\r\n        {\r\n            id:   'admin_email',\r\n            type: 'email',\r\n            name:  UncannyAutomator.i18n.tokens.global.adminEmail,\r\n        },\r\n        {\r\n            id:   'site_url',\r\n            type: 'url',\r\n            name:  UncannyAutomator.i18n.tokens.global.siteUrl,\r\n        },\r\n        {\r\n            id:   'recipe_name',\r\n            type: 'text',\r\n            name:  UncannyAutomator.i18n.tokens.global.recipeName,\r\n        },\r\n        {\r\n            id:   'current_date',\r\n            type: 'text',\r\n            name:  UncannyAutomator.i18n.tokens.global.currentDate,\r\n        },\r\n        {\r\n            id:   'current_time',\r\n            type: 'text',\r\n            name:  UncannyAutomator.i18n.tokens.global.currentTime,\r\n        }\r\n    );\r\n\r\n    // Global tokens\r\n    tokensList.push( commonTokens );\r\n\r\n    // Check if it's a field in a trigger or user-selector section,\r\n    // in an anonymous recipe then don't add user related tokens\r\n    if ( ! ( UncannyAutomator.recipe.type == 'anonymous' && ( itemType == 'trigger' || itemType == 'user-selector' ) ) ){\r\n        let tokensGroupAdvanced = {\r\n            id:         'advanced',\r\n            name:       UncannyAutomator.i18n.tokens.global.advanced,\r\n            icon:       'uo-icon--bolt',\r\n            tokens:         [\r\n                {\r\n                    id:   'USERMETA:KEY',\r\n                    type: 'text',\r\n                    name:  UncannyAutomator.i18n.tokens.global.userMetaKey,\r\n                },\r\n            ]\r\n        }\r\n\r\n        tokensList.push( tokensGroupAdvanced );\r\n    }\r\n\r\n    let items = {};\r\n\r\n    // Filter by itemType\r\n    // If it isn't defined then return all items\r\n    if ( isDefined( itemType ) ){\r\n        if ( itemType == 'action' || itemType == 'closure' || itemType == 'user-selector' ){\r\n            items = $.extend( {}, items, itemsObject( 'get', {\r\n                filter: {\r\n                    itemType: 'trigger'\r\n                }\r\n            }));\r\n        }\r\n\r\n        if ( itemType == 'closure' ){\r\n            items = $.extend( {}, items, itemsObject( 'get', {\r\n                filter: {\r\n                    itemType: 'action'\r\n                }\r\n            }));\r\n        }\r\n    }\r\n    else {\r\n        items = jQuery.extend( true, {}, UncannyAutomator.recipe.items );\r\n    }\r\n\r\n    $.each( items, function( itemId, item ){\r\n        let itemTokens = [];\r\n\r\n        // Automatic tokens from the fields\r\n        $.each( item.options, function( groupId, group ){\r\n            $.each( group.fields, function( index, field ){\r\n                let fieldAttributes = field.getAttributes();\r\n\r\n                // Check the field type\r\n                if ( fieldAttributes.fieldType == 'repeater' ){\r\n                    // Iterate the rows\r\n                    field.fieldRows.forEach(( row, index ) => {\r\n                        // Get the row index\r\n                        const rowIndex = index;\r\n\r\n                        // Iterate the row fields\r\n                        row.forEach(( Field ) => {\r\n                            // Add field\r\n                            itemTokens.push({\r\n                                // Create the token\r\n                                // ITEM_ID : ITEM_CODE : REPEATER_FIELD_ID : ROW_INDEX : FIELD_ID\r\n                                id:      `${ item.id }:${ item.itemCode }:${ fieldAttributes.optionCode }:${ rowIndex }:${ Field.getAttributes().optionCode }`,\r\n                                // Field name:\r\n                                // REPEATER_FIELD_NAME - \"Row\" ROW_INDEX - FIELD_NAME\r\n                                name:    `${ fieldAttributes.tokenName } - ${ vsprintf( UncannyAutomator.i18n.rowNumber, [ ( rowIndex + 1 ) ] ) } - ${ Field.getAttributes().tokenName }`,\r\n                                type:    Field.getAttributes().fieldType == 'select' || Field.getAttributes().fieldType == 'textarea' ? 'text' : Field.getAttributes().fieldType,\r\n                                value:   Field.getValue(),\r\n                                fieldId: Field.getAttributes().optionCode\r\n                            });\r\n                        });\r\n                    });\r\n                }\r\n                else if ( fieldAttributes.fieldType == 'group' ){\r\n                    // Nothing here yet\r\n                }\r\n                else {\r\n                    if( fieldAttributes.relevant_tokens ) {\r\n                        $.each( fieldAttributes.relevant_tokens, function( index, title){\r\n                            itemTokens.push({\r\n                                id:      item.id + ':' + item.itemCode + ':' + index,\r\n                                name:    title,\r\n                                type:    fieldAttributes.fieldType == 'select' || fieldAttributes.fieldType == 'textarea' ? 'text' : fieldAttributes.fieldType,\r\n                                value:   field.getValue(),\r\n                                fieldId: fieldAttributes.optionCode\r\n                            });\r\n                        });\r\n                    } else {\r\n                        itemTokens.push({\r\n                            id:      item.id + ':' + item.itemCode + ':' + fieldAttributes.optionCode,\r\n                            name:    fieldAttributes.tokenName,\r\n                            type:    fieldAttributes.fieldType == 'select' || fieldAttributes.fieldType == 'textarea' ? 'text' : fieldAttributes.fieldType,\r\n                            value:   field.getValue(),\r\n                            fieldId: fieldAttributes.optionCode\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n        // Custom tokens\r\n        $.each( item.tokens, function( index, token ){\r\n            itemTokens.push({\r\n                id:   item.id + ':' + token.tokenIdentifier + ':' + token.tokenId,\r\n                name: token.tokenName,\r\n                type: isDefined( token.tokenType ) ? token.tokenType : 'text',\r\n            });\r\n        });\r\n\r\n        // Get sentence\r\n        let itemSentence;\r\n        if ( ! item.isMissing ){\r\n            itemSentence = getGlobalItem( item.integrationCode, item.itemType, item.itemCode ).sentence;\r\n        }\r\n        else {\r\n            itemSentence = item.sentence;\r\n        }\r\n\r\n        let tokensGroup = {\r\n            id:             item.itemCode,\r\n            name:           parseStringWithTokens( item, itemSentence, UncannyAutomator.recipe.items[ item.id ].meta ).html,\r\n            integrationId:  item.integrationCode,\r\n            tokens:         itemTokens\r\n        }\r\n\r\n        // Filter tokens using a custom function\r\n        let filterTokens = ( tokensGroup, item ) => tokensGroup;\r\n        if ( ! isEmpty( item.filterTokens ) ){\r\n            // Try to overwrite empty function\r\n            try {\r\n                // Try to convert the string to function, but first remove the <script> tags and trim the string\r\n                filterTokens = eval( `(${ item.filterTokens.replace( '<script>', '' ).replace( '</script>', '' ).trim() })` ); \r\n            } catch ( e ){ console.log( e ); console.log( item.filterTokens ); }\r\n        }\r\n        tokensGroup = filterTokens( tokensGroup, item );\r\n\r\n        // Add the group of tokens\r\n        tokensList.push( tokensGroup );\r\n    });\r\n\r\n    // Filter by field type\r\n    // We're not filtering tokens if the {fieldType} is 'text' or 'url', those accepts all tokens\r\n    if ( isDefined( dataType ) && ! inArray( dataType, [ 'text', 'textarea', 'url' ] ) ){\r\n\r\n        let filteredTokensList = [];\r\n\r\n        $.each( tokensList, function( index, tokenGroup ){\r\n            let filteredTokens = [];\r\n\r\n            $.each( tokenGroup.tokens, function( index, token ){\r\n                // If we're filtering floats, then promote int tokens to float\r\n                token.type = dataType != 'float' ? token.type : token.type == 'int' ? 'float' : token.type;\r\n\r\n                // Check if the fieldType matchs\r\n                // Remember that we're not filtering tokens if the {fieldType} is 'text' or 'url',\r\n                // AND we are promoting int to float if {fieldType} is 'float'\r\n                if ( dataType == token.type ){\r\n                    filteredTokens.push( token );\r\n                }\r\n            });\r\n\r\n            if ( filteredTokens.length > 0 ){\r\n                tokenGroup.tokens = filteredTokens;\r\n                filteredTokensList.push( tokenGroup );\r\n            }\r\n        });\r\n\r\n        tokensList = filteredTokensList;\r\n    }\r\n\r\n    return tokensList;\r\n}\r\n\r\n/**\r\n * Get all valid field types.\r\n * Used for validation\r\n *\r\n * @since 0.4\r\n *\r\n * @return {array} All the valid field types\r\n */\r\n\r\nexport function getFieldTypes(){\r\n    // Set valid field types\r\n    let validFieldTypes = [ 'select', 'textarea', 'text', 'url', 'email', 'int', 'float', 'checkbox', 'radio', 'group', 'repeater' ];\r\n\r\n    return validFieldTypes;\r\n}\r\n\r\n/**\r\n * Parse string with tokens\r\n *\r\n * @since 0.5\r\n *\r\n * @param {object}   item - The item\r\n * @param {string}   string - The string with the tokens\r\n * @param {object}   data - Object with the data to replace the text in the tokens.\r\n *\r\n * @return {object}  Object with information about the string\r\n *         {string}  response.plain - The string with the tokens replaced with the data\r\n *         {string}  response.html - The string with the tokens replaced with the data and enclosed in HTML tags\r\n *         {object}  response.elements\r\n *         {array}   response.elements.normal - Array of jQuery object. All the non-tokens part of the sentence\r\n *         {array}   response.elements.tokens - Array of jQuery object. All the tokens part of the sentence\r\n *         {array}   response.parts\r\n *         {object}  response.parts[ n ] - Object with information about each part of the sentence\r\n */\r\n\r\nexport function parseStringWithTokens( item = null, string = '', data = {} ){\r\n    // Create response object\r\n    let response = {\r\n        plain:      '',\r\n        html:       $( '<div/>' ),\r\n        elements:   {\r\n            normal: [],\r\n            token: []\r\n        },\r\n        parts: []\r\n    }\r\n\r\n    // Trim string\r\n    string = string.trim();\r\n\r\n    // Check if the string isn't empty\r\n    if ( ! isEmpty( string ) ){\r\n        // Create regex\r\n        let tokensRegex  = new RegExp( /\\{\\{(.*?)\\}\\}/gm ),\r\n            normals      = [],\r\n            tokens       = [],\r\n            mappedString = string;\r\n\r\n        // Get tokens\r\n        let tokenNumber = 0,\r\n            token;\r\n\r\n        string = string.replace( tokensRegex, function( full_match, token ){\r\n            let tokenParts = token.split( ':' );\r\n\r\n            // Get the token placeholder text\r\n            const tokenPlaceholderText = tokenParts[ 0 ];\r\n\r\n            // Get the token value ID\r\n            const tokenValueID = tokenParts[ 1 ];\r\n\r\n            // Get the ID of the group of fields this token has to open\r\n            // Check if the token should open a different group of options\r\n            const optionsID = isDefined( tokenParts[ 2 ] ) ? tokenParts[ 2 ] : tokenValueID;\r\n\r\n            token = {\r\n                type:      'token',\r\n                id:        tokenValueID,\r\n                text:      tokenPlaceholderText,\r\n                optionsID: optionsID,\r\n                hasFields: isDefined( item.options[ optionsID ] )\r\n            }\r\n\r\n            // Check if we have data for the token\r\n            if ( isDefined( data[ vsprintf( '%s_readable', [ token.id ] ) ] ) || isDefined( data[ token.id ] ) ){\r\n                let readableText = data[ vsprintf( '%s_readable', [ token.id ] ) ];\r\n                token.originalText  = token.text;\r\n                token.text          = isDefined( readableText ) ? readableText : data[ token.id ];\r\n            }\r\n\r\n            // Add token\r\n            tokens.push( token );\r\n\r\n            // Add token to the mapped string\r\n            mappedString = mappedString.replace( full_match, '{{token:' + tokenNumber + '}}' );\r\n            tokenNumber++;\r\n\r\n            return '{{v}}';\r\n        });\r\n\r\n        let stringParts = string.split( '{{v}}' );\r\n\r\n        // Get normals\r\n        let normalNumber = 0;\r\n        $.each( stringParts, function( key, sentenceSection ){\r\n            if ( sentenceSection != '' ){\r\n                // Create normal part\r\n                let normal = {\r\n                    type: 'normal',\r\n                    text: sentenceSection\r\n                }\r\n\r\n                // Add normal text\r\n                normals.push( normal );\r\n\r\n                // Add \"normal\" part to the mapped string\r\n                mappedString = mappedString.replace( sentenceSection, '{{normal:' + normalNumber + '}}' );\r\n                normalNumber++;\r\n            }\r\n        });\r\n\r\n        // Create response.parts\r\n        let match;\r\n\r\n        while ( ( match = tokensRegex.exec( mappedString ) ) !== null ){\r\n            // Get info\r\n            let part = match[ 1 ].split( ':' );\r\n\r\n            part = {\r\n                type:  part[ 0 ],\r\n                index: part[ 1 ]\r\n            }\r\n\r\n            // Get part object and add to parts\r\n            if ( part.type == 'normal' ){\r\n                response.parts.push( normals[ part.index ] );\r\n            }\r\n            else {\r\n                response.parts.push( tokens[ part.index ] );\r\n            }\r\n        }\r\n\r\n        // Create plain text and HTML versions\r\n        $.each( response.parts, function( index, part ){\r\n            // Plain text\r\n            response.plain += part.text;\r\n\r\n            // HTML\r\n            if ( part.text != ' ' ){\r\n                let elementAttributes,\r\n                    text = part.text;\r\n\r\n                // Check if first character is a space\r\n                let startsWithSpace = text[ 0 ] == ' ';\r\n                if ( startsWithSpace ){\r\n                    text = text.slice( 1 );\r\n                }\r\n\r\n                // Check if last character is a space\r\n                let endsWithSpace   = text[ text.length - 1 ] == ' ';\r\n                if ( endsWithSpace ){\r\n                    text = text.slice( 0, -1 );\r\n                }\r\n\r\n                if ( ( part.type == 'normal' ) || ( part.type == 'token' && ! part.hasFields && ! item.isMissing ) ){\r\n                    elementAttributes = {\r\n                        'class': 'item-title__normal'\r\n                    }\r\n                }\r\n                else {\r\n                    let CSSClass = 'item-title__token';\r\n\r\n                    elementAttributes = {\r\n                        'class':           CSSClass,\r\n                        'data-token-id':   part.id,\r\n                        'data-options-id': part.optionsID\r\n                    }\r\n\r\n                    // Check if it's using a valid ID\r\n                    if ( isDefined( item.options[ part.optionsID ] ) ){\r\n                        // Check if the section is valid\r\n                        if ( item.options[ part.optionsID ].isValid ){\r\n                            // Add filled class\r\n                            elementAttributes[ 'class' ] += ' item-title__token--filled';\r\n                        }\r\n                    }\r\n\r\n                    // Check if it's filled\r\n                    if ( isDefined( part.originalText ) ){\r\n                        // Add filled class\r\n                        // elementAttributes[ 'class' ] += ' item-title__token--filled';\r\n\r\n                        // Define text of the token\r\n                        let abbreviatedText = abbreviateText( text, 30 );\r\n\r\n                        // Check if the text was long enough to abbreviate it\r\n                        if ( abbreviatedText.isAbbreviated ){\r\n                            // Add tooltip with the complete text\r\n                            elementAttributes[ 'uap-tooltip' ] = text;\r\n\r\n                            // Replace original text\r\n                            text = abbreviatedText.text;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                let element = $( '<span/>', elementAttributes ).text( decodeEntities( text ) );\r\n\r\n                // Add to the elements array\r\n                response.elements[ part.type ].push( element );\r\n\r\n                // Check if we have to preppend a space\r\n                if ( startsWithSpace ){\r\n                    // response.html.append( ' ' );\r\n                }\r\n\r\n                // Append HTML\r\n                response.html.append( element ); \r\n\r\n                /*\r\n\r\n                // Append to the HTML\r\n                // 2.0, remove \"item-title__normal\"\r\n                // If it's a token, add the element\r\n                if ( part.type == 'token' ){\r\n                    response.html.append( element ); \r\n                }\r\n                // Otherwise, add the text\r\n                else {\r\n                    response.html.append( text );\r\n                }\r\n\r\n                */\r\n\r\n                // Check if we have to append a space\r\n                if ( endsWithSpace ){\r\n                    // response.html.append( ' ' );\r\n                }\r\n            }\r\n            else {\r\n                // response.html.append( ' ' );\r\n            }\r\n        });\r\n\r\n        // Convert array of jQuery elements into wrapped set of elements\r\n        response.elements.normal = $( response.elements.normal ).map( function(){ return this.get() });\r\n        response.elements.token  = $( response.elements.token ).map( function(){ return this.get() }).filter( ':not(.item-title__normal)' );\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Determine if a variable is set and is not NULL\r\n *\r\n * @since 0.2\r\n *\r\n * @param  {mixed}      variable - The variable being evaluated\r\n * @return {boolean}    TRUE if the variable is defined\r\n */\r\n\r\nexport function isDefined( variable ){\r\n    // Returns true if the variable is undefined\r\n    return typeof variable !== 'undefined' && variable !== null;\r\n}\r\n\r\n/**\r\n * Determine whether a variable is empty\r\n *\r\n * @since 0.2\r\n *\r\n * @param   {mixed}     variable - The variable being evaluated\r\n * @return  {boolean}   TRUE if the variable is empty\r\n */\r\n\r\nexport function isEmpty( variable ){\r\n    let response = true;\r\n\r\n    // Check if the variable is defined, otherwise is empty\r\n    if ( isDefined( variable ) ){\r\n        // Check if it's array\r\n        if ( $.isArray( variable ) ){\r\n            response = variable.length == 0;\r\n        }\r\n        else if ( isObject( variable ) ){\r\n            response = $.isEmptyObject( variable );\r\n        }\r\n        else {\r\n            response = variable == '';\r\n        }\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Check if two strings are equal\r\n *\r\n * @since 0.2\r\n *\r\n * @param   {string}    string1 - String to be compared\r\n * @param   {string}    string2 - String to be compared\r\n * @param   {object}    settings - Object with settings\r\n * @param   {boolean}   settings.caseSensitive=true - If true, uppercase and lowercase chars will be treated as distinct\r\n *\r\n * @return  {boolean} TRUE if both strings are equal\r\n */\r\n\r\nexport function compareStrings( string1, string2, settings = { caseSensitive: true } ){\r\n    // Create response variable\r\n    let response = false;\r\n\r\n    // Check if it's case sensitive\r\n    if ( ! settings.caseSensitive ){\r\n        response = string1.toString().toLowerCase() == string2.toString().toLowerCase();\r\n    }\r\n    else {\r\n        response = string1.toString() == string2.toString();\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Check if a value exists in an array\r\n * If the needle is an array then it will check if all his elements exists in the haystack\r\n *\r\n * @since 0.2\r\n *\r\n * @param   {mixed}     needle - The searched value. The comparison between values is strict. If the needle is an array then it will check if all his elements exists in the haystack\r\n * @param   {array}     haystack - An array through which to search.\r\n *\r\n * @return  {boolean} TRUE if needle is found in the array or if needle is an array, TRUE if all the elements from the needle are in haystack\r\n */\r\n\r\nexport function inArray( needle, haystack ){\r\n    let response = false;\r\n\r\n    if ( Array.isArray( needle ) ){\r\n        // Check that all the elements from the array \"value\" are in the array \"array\"\r\n        response = arrayDifference( needle, haystack ).length == 0;\r\n    }\r\n    else {\r\n        // Check if one element is in an array\r\n        response = $.inArray( needle, haystack ) !== -1;\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Compare the values of two arrays and get the difference\r\n * Compares array1 against one array and returns the values in array1 that are not present in array2.\r\n * Examples:\r\n * +-------------------+-------------+--------------+\r\n * |      array1       |   array2    |    return    |\r\n * +-------------------+-------------+--------------+\r\n * | [ 1, 2, 3, 4, 5 ] | [ 1, 3, 4 ] | [ 2, 5]      |\r\n * | [ 1, 2, 3 ]       | [ 2, 3 ]    | [ 1 ]        |\r\n * | [ 2, 3 ]          | [ 1, 2, 3 ] | []           |\r\n * | [ 1, 2 ]          | [ 1, 2 ]    | []           |\r\n * | [ '1', '2' ]      | [ 1, 2 ]    | [ '1', '2' ] |\r\n * +-------------------+-------------+--------------+\r\n *\r\n * @since 0.2\r\n *\r\n * @param   {array} array1 - The array to compare from\r\n * @param   {array} array2 - An array to compare against\r\n *\r\n * @return  {array} Array containing all the entries from array1 that are not present in array2\r\n */\r\n\r\nexport function arrayDifference( array1, array2 ){\r\n    return $( array1 ).not( array2 ).get();\r\n}\r\n\r\n/**\r\n * JavaScript vsprintf implementation\r\n * Return a formatted string\r\n *\r\n * @requires sprintf-js\r\n *\r\n * @since 0.2\r\n *\r\n * @param {string}  format - The placeholders in the format string are marked by % and are followed by one or more of these elements, in this order:\r\n *    1. An optional number followed by a $ sign that selects which argument index to use for the value.\r\n *       If not specified, arguments will be placed in the same order as the placeholders in the input string.\r\n *    2. An optional + sign that forces to preceed the result with a plus or minus sign on numeric values. By default, only the - sign is used on negative numbers.\r\n *    3. An optional padding specifier that says what character to use for padding (if specified).\r\n *       Possible values are 0 or any other character precedeed by a ' (single quote). The default is to pad with spaces.\r\n *    4. An optional - sign, that causes sprintf to left-align the result of this placeholder. The default is to right-align the result.\r\n *    5. An optional number, that says how many characters the result should have.\r\n *       If the value to be returned is shorter than this number, the result will be padded.\r\n *       When used with the j (JSON) type specifier, the padding length specifies the tab size used for indentation.\r\n *    6. An optional precision modifier, consisting of a . (dot) followed by a number, that says how many digits should be displayed for floating point numbers.\r\n *       When used with the g type specifier, it specifies the number of significant digits. When used on a string, it causes the result to be truncated.\r\n *    7. A type specifier that can be any of:\r\n *    7.1  % — yields a literal % character\r\n *    7.2  b — yields an integer as a binary number\r\n *    7.3  c — yields an integer as the character with that ASCII value\r\n *    7.4  d or i — yields an integer as a signed decimal number\r\n *    7.5  e — yields a float using scientific notation\r\n *    7.6  u — yields an integer as an unsigned decimal number\r\n *    7.7  f — yields a float as is; see notes on precision above\r\n *    7.8  g — yields a float as is; see notes on precision above\r\n *    7.9  o — yields an integer as an octal number\r\n *    7.10 s — yields a string as is\r\n *    7.11 t — yields true or false\r\n *    7.12 T — yields the type of the argument1\r\n *    7.13 v — yields the primitive value of the specified argument\r\n *    7.14 x — yields an integer as a hexadecimal number (lower-case)\r\n *    7.15 X — yields an integer as a hexadecimal number (upper-case)\r\n *    7.16 j — yields a JavaScript object or array as a JSON encoded string\r\n * @param {array}  arguments_array - array of arguments\r\n *\r\n * @return {string} Return array values as a formatted string according to format.\r\n */\r\n\r\nexport function vsprintf( format, arguments_array ){\r\n    var vsprintf = require('sprintf-js').vsprintf;\r\n    return vsprintf( format, arguments_array );\r\n}\r\n\r\n/**\r\n * Find whether a variable is a string\r\n *\r\n * @since 0.2\r\n *\r\n * @param   {mixed}     variable - The variable being evaluated\r\n * @return  {boolean}   TRUE if the variable is an string\r\n */\r\n\r\nexport function isString( string ){\r\n    return typeof string === 'string';\r\n}\r\n\r\n/**\r\n * Find whether a variable is an object\r\n *\r\n * @since 0.2\r\n *\r\n * @param   {mixed}     variable - The variable being evaluated\r\n * @return  {boolean}   TRUE if the variable is an object\r\n */\r\n\r\nexport function isObject( variable ){\r\n    return variable !== null && typeof variable === 'object';\r\n}\r\n\r\n/**\r\n * Remove all spaces from a string\r\n *\r\n * @since 0.3\r\n *\r\n * @param   {string}    String\r\n * @return  {string}    String without spaces\r\n */\r\n\r\nexport function removeSpaces( string ){\r\n    return string.replace( /\\s/g, '' );\r\n}\r\n\r\n/**\r\n * Replace curly braces\r\n *\r\n * @since 0.5\r\n *\r\n * @param {string} string - The string to be searched\r\n * @param {string} start - The value to replace the for {{\r\n * @param {string} end - The value to replace the for }}\r\n *\r\n * @return {string} The value with the replaced values\r\n */\r\n\r\nexport function replaceCurlyBraces( string = '', start = '', end = '' ){\r\n    string = string.replace( /{{/g, start );\r\n    string = string.replace( /}}/g, end );\r\n    return string;\r\n}\r\n\r\n/**\r\n * Creates a console log label\r\n *\r\n * @since  1.1\r\n *\r\n * @param  {String} text - Text to show after the label\r\n * @param  {Boolean} isGroup - Define if we have to do a console.group instead of console.log\r\n */\r\n\r\nexport function consoleLogLabel( text = '', isGroup = false, options = {} ){\r\n\t// Check if the user defined a custom background color\r\n\tif ( ! isDefined( options.bgColor ) ){\r\n\t\toptions.bgColor = '#0790e8';\r\n\t}\r\n\r\n    // Define console log Automator style\r\n    let labelStyle = `background: ${ options.bgColor }; color: #fff; font-weight: 500; padding: 2px 6px; font-family: -apple-system, system-ui, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;`;\r\n\r\n    // Do console log\r\n    if ( isGroup ){\r\n        if ( isDefined( options.collapseGroup ) && options.collapseGroup ){\r\n            console.groupCollapsed( '%c🤖Automator', labelStyle, text );\r\n        }\r\n        else {\r\n            console.group( '%c🤖Automator', labelStyle, text );\r\n        }\r\n    }\r\n    else {\r\n        console.log( '%c🤖Automator', labelStyle, text );\r\n    }\r\n}\r\n\r\n/**\r\n * Creates a custom console log with colors to\r\n * represent success and failure\r\n *\r\n * @since  2.0\r\n *\r\n * @param  {String} status - Message type. Use 'success' or 'error'\r\n * @param  {String} text - Text to show after the label\r\n */\r\n\r\nexport function consoleLogResult( status = 'error', text = '' ){\r\n    // Define console log Automator style\r\n    let labelStyle = 'color: #fff; padding: 2px 7px; font-family: -apple-system, system-ui, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif; font-weight: normal';\r\n\r\n    // Add error or success colors\r\n    if ( status == 'error' ){\r\n        labelStyle = `background: #f13c3c; ${ labelStyle }`;\r\n    }\r\n\r\n    if ( status == 'success' ){\r\n        labelStyle = `background: #40b528; ${ labelStyle }`;\r\n    }\r\n\r\n    // Do console log\r\n    console.log( `%c${ text }`, labelStyle );\r\n}\r\n\r\n/**\r\n * Escape HTML characters\r\n *\r\n * @since  1.1\r\n * @param  {String} html The HTML\r\n * @return {String}      Scaped HTML\r\n */\r\n\r\nexport function escapeHTML( html = '' ){\r\n    let tagsToReplace = {\r\n        '&': '&amp;',\r\n        '<': '&lt;',\r\n        '>': '&gt;'\r\n    };\r\n\r\n    let replaceTag = function( tag ){\r\n        return tagsToReplace[ tag ] || tag;\r\n    }\r\n\r\n    return html.replace( /[&<>]/g, replaceTag );\r\n}\r\n\r\n/**\r\n * Abbreviate long texts. This function will convert a string\r\n * like \"123456789\" to \"123...789\"\r\n * \r\n * @param  {String} text    The string\r\n * @param  {Int}    length  The max length of the string\r\n * @return {Object}         Response two properties, isAbbreviated and text\r\n */\r\n\r\nexport function abbreviateText( text = '', length = 10 ){\r\n    // Default response\r\n    let response = {\r\n        isAbbreviated: false,\r\n        text: text\r\n    }\r\n\r\n    // Only abbreviate the text if the text is longer than the length\r\n    if ( text.length > length ){\r\n        // Get length of each parts (start and end)\r\n        let partLengths = Math.floor( length / 2 );\r\n\r\n        // Get parts\r\n        let textParts = {\r\n            start: text.substring( 0, partLengths ),\r\n            end:   text.slice( -partLengths )\r\n        }\r\n\r\n        // Create abbrevited text\r\n        response.text = `${ textParts.start } ... ${ textParts.end }`;\r\n        response.isAbbreviated = true;\r\n    }\r\n\r\n    // Return response\r\n    return response;\r\n}\r\n\r\n/**\r\n * Get an unique ID\r\n */\r\n\r\nexport function getUniqueId(){\r\n    // Math.random should be unique because of its seeding algorithm.\r\n    // Convert it to base 36 (numbers + letters), and grab the first 9 characters\r\n    // after the decimal.\r\n    return '_' + Math.random().toString( 36 ).substr( 2, 9 );\r\n}\r\n\r\n/**\r\n * Insert parameter to an URL.\r\n * If the parameter already exists it will update it\r\n * \r\n * @param  {String} url        The URL\r\n * @param  {Object} parameters The parameters\r\n * @param  {Object} options    The options. It supports two properties, \"setAsURL\" and \"refresh\"\r\n * @return {String}            The URL with the parameters\r\n */\r\nexport function addParametersToURL( url = '', parameters = {}, options = {} ){\r\n    // If the URL is empty, use the site URL\r\n    if ( isEmpty( url ) ){\r\n        url = window.location.href;\r\n    }\r\n    \r\n    // Try to get an URL object\r\n    try {\r\n        url = new URL( url );\r\n    } catch ( e ){\r\n        // If something goes wrong, just return the original URL\r\n        return url;\r\n    }\r\n\r\n    // Get the current parameters in the URL\r\n    let urlParameters = url.search.substr( 1 ).split( '&' );\r\n\r\n    // Iterate the parameters\r\n    for ( let [ key, value ] of Object.entries( parameters ) ){\r\n        key   = encodeURI( key );\r\n        value = encodeURI( value );\r\n\r\n        let i = urlParameters.length;\r\n        let x;\r\n\r\n        while ( i-- ){\r\n            x = urlParameters[ i ].split( '=' );\r\n\r\n            if ( x[ 0 ] == key ){\r\n                x[ 1 ] = value;\r\n                urlParameters[i] = x.join( '=' );\r\n                break;\r\n            }\r\n        }\r\n\r\n        if ( i < 0 ){\r\n            urlParameters[ urlParameters.length ] = [ key, value ].join( '=' );\r\n        }\r\n    }\r\n\r\n    // Remove empty parameters\r\n    urlParameters = urlParameters.filter( parameter => ! isEmpty( parameter ) );\r\n\r\n    // Add parameters to the URL\r\n    url.search = urlParameters.join( '&' );\r\n\r\n    // Set default options\r\n    options = $.extend({}, {\r\n        setAsURL: false,\r\n        refresh:  false\r\n    }, options );\r\n\r\n    // Check if we have to set it as the current URL\r\n    if ( options.setAsURL ){\r\n        // Check if we have to reload\r\n        if ( options.refresh ){\r\n            // This will reload the page, it's likely better to store this until finished\r\n            window.location.href = url.href; \r\n        }\r\n        else {\r\n            // Get title of the current page\r\n            let pageTitle = document.title;\r\n\r\n            // Push history and update URL\r\n            window.history.pushState({}, pageTitle, url.href );\r\n        }\r\n    }\r\n\r\n    // Return URL\r\n    return url.href;\r\n}\r\n\r\n/**\r\n * Decodes HTML entities\r\n *\r\n * @since  2.1.4\r\n * @param  {String} encodedString The string with encoded entities\r\n * @return {String}               The same string, with the entities decoded\r\n */\r\nexport function decodeEntities( encodedString = '' ){\r\n    const $textarea = document.createElement( 'textarea' );\r\n    $textarea.innerHTML = encodedString;\r\n    return $textarea.value;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/components/Utilities.js","module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 1\n// module chunks = 0","import {\r\n    itemsObject,\r\n    getDOMElements,\r\n    isEmpty,\r\n    isDefined\r\n}                     from './Utilities.js';\r\nimport UserSelector   from './UserSelector.js';\r\nimport MetaboxItems   from './MetaboxItems.js';\r\nimport MetaboxFooter  from './MetaboxFooter.js';\r\nimport ItemCreatorAdd from './ItemCreatorAdd.js';\r\nimport Closures       from './Closures.js';\r\n\r\nclass Actions {\r\n\r\n    /**\r\n     * Renders all the actions in the UI\r\n     * @class\r\n     *\r\n     */\r\n\r\n    constructor(){\r\n        // Debugging: Create console group\r\n        // console.group( 'Actions' );\r\n\r\n        // Get and clear metabox\r\n        let $metabox = getDOMElements( 'metabox', { type: 'action' });\r\n        $metabox.empty();\r\n\r\n        // Check if we have to create the User Selector\r\n        if ( UncannyAutomator.recipe.type == 'anonymous' && isDefined( UncannyAutomator.wp ) && UncannyAutomator.wp ){\r\n            // Create User Selector\r\n            new UserSelector();\r\n        }\r\n\r\n        // Get recipe actions\r\n        let actions = itemsObject( 'get', {\r\n            filter: {\r\n                itemType: 'action'\r\n            }\r\n        });\r\n\r\n        // Check if it has actions\r\n        if ( ! isEmpty( actions ) ){\r\n            // Render actions\r\n            new MetaboxItems( 'action' );\r\n        }\r\n        else {\r\n            // Render the first step of the item creator\r\n            new ItemCreatorAdd( 'action' );\r\n        }\r\n\r\n        // Create metabox footer\r\n        new MetaboxFooter( 'action' );\r\n\r\n        // Debugging: Close console group\r\n        // console.groupEnd();\r\n\r\n        // Add Closures\r\n        new Closures();\r\n    }\r\n}\r\n\r\nexport default Actions;\n\n\n// WEBPACK FOOTER //\n// ./src/components/Actions.js","import {\r\n\tAJAXRequest,\r\n\tcompareStrings,\r\n\tgetCurrentFieldsValues,\r\n\tgetField,\r\n\tgetFieldTypes,\r\n\tgetTokens,\r\n\tgetUniqueId,\r\n\tinArray,\r\n\tisDefined,\r\n\tisEmpty,\r\n\tremoveSpaces,\r\n\tvsprintf\r\n} from './Utilities.js';\r\n\r\nimport {\r\n\tinitURLChecker,\r\n\tvalidateField\r\n} from './Validation.js'\r\n\r\n/**\r\n * Create a field\r\n *\r\n * @since 0.4\r\n *\r\n * @param {string}              type - Field type\r\n * @param {object}              attributes - Object with information about the field\r\n * @param {string}              attributes.itemType             Item type. Valid values are trigger, action and closure.\r\n * @param {int}                 attributes.itemID               ID of the recipe item\r\n * @param {(null|string|array)} attributes.defaultValue         Default value of the field\r\n * @param {string}              attributes.currentValue         Current value of the field\r\n * @param {string}              attributes.placeholder          Placeholder of the field\r\n * @param {string}              attributes.isHidden             Defines if the field should be hidden\r\n * @param {string}              attributes.label                Label of the field\r\n * @param {string}              attributes.description          Description of the field\r\n * @param {object}              attributes.options              Only used if the field is a select. All the options of the select.\r\n * @param {null|string}         [attributes.color]              Only used for checkboxes. Valid values are null, 'gutenberg' or 'green'\r\n * @param {null|string}         [attributes.align]              Only used for checkboxes. Valid values are null, 'left' or 'right'\r\n * @param {object}              [attributes.toggle]             Only used for checkboxes. Has On and Off strings\r\n * @param {string}              [attributes.toggle.on]          String shown when the toggle is selected\r\n * @param {string}              [attributes.toggle.off]         String shown when the toggle is unselected\r\n *\r\n * @param {boolean}             attributes.isAjax               Only used if the field is a select. Add listner for the AJAX request.\r\n * @param {(null|string|array)} attributes.targetField          Only used if the field is a select. AJAX return values and populate this field.\r\n * @param {string}              attributes.integrationID        Integration of plugin\r\n * @param {string}              attributes.endPoint             endPoint for Ajax Call\r\n */\r\n\r\nclass Field {\r\n\tconstructor( type, attributes, createDOMelements = true, customValidationFunction = null ){\r\n\t\tthis.type = type;\r\n\t\t\r\n\t\tthis.attributes \t\t\t  = this.setAttributes( attributes );\r\n\t\tthis.customValidationFunction = customValidationFunction;\r\n\r\n\t\tif ( createDOMelements ){\r\n\t\t\tthis.createFormElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Create a jQuery DOM element with the field\r\n\t *\r\n\t * @since 0.3\r\n\t */\r\n\r\n\tcreateFormElement(){\r\n\t\t// Create response object\r\n\t\tlet response = null;\r\n\r\n\t\t// Local variables\r\n\t\tlet type = this.type;\r\n\t  \tlet attributes = this.attributes;\r\n\r\n\t\t// Check if it's a valid field type\r\n\t\tif ( inArray( type, getFieldTypes() ) ){\r\n\t\t\t// Create form element container, this is global\r\n\t\t\tlet formElement = $( '<div/>', { 'class': 'form-element' } );\r\n\r\n\t\t\t// Check the user is trying to add a custom class to the formElement element\r\n\t\t\tif ( isDefined( attributes.formElementClass ) ){\r\n\t\t\t\tformElement.addClass( attributes.formElementClass );\r\n\t\t\t}\r\n\r\n\t\t\t// Fields attributes, those will be added to the field jQuery object\r\n\t\t\tlet fieldAttributes = {\r\n\t\t\t\t'name':\t\t\t\t     attributes.optionCode,\r\n\t\t\t\t'id':\t\t\t\t\t `${ attributes.optionCode }__${ getUniqueId() }`,\r\n\r\n\t\t\t\t'data-isajax':\t\t     attributes.isAjax,\r\n\t\t\t\t'data-targetfield':\t     attributes.targetField,\r\n\t\t\t\t'data-integrationid':\t attributes.integrationID,\r\n\t\t\t\t'data-endPoint':\t\t attributes.endPoint,\r\n\r\n\t\t\t\t'data-supportsTokens':   attributes.supportsTokens,\r\n\t\t\t\t'data-supportsTinymce':  attributes.supportsTinyMCE,\r\n\t\t\t\t'data-required':\t\t attributes.isRequired,\r\n\t\t\t\t'data-item_type':\t\t attributes.itemType,\r\n\r\n\t\t\t\t'data-is-hidden':        attributes.isHidden,\r\n\t\t\t}\r\n\r\n\t\t\t// Define field container variable once. An different jQuery object will be created based on the field type\r\n\t\t\tlet fieldContainer, field;\r\n\r\n\t\t\t// Create field based in field type\r\n\t\t\tswitch ( type ){\r\n\t\t\t\tcase 'select':\r\n\t\t\t\t\t// Field container\r\n\t\t\t\t\tfieldContainer = $( '<div/>', {'class': 'form-select'} );\r\n\r\n\t\t\t\t\tthis.fieldContainer = fieldContainer;\r\n\r\n\t\t\t\t\t// Create select element and add fieldAttributes to jQuery object. Merge second object into fieldAttributes, recursively\r\n\t\t\t\t\tfield = $( '<select/>', $.extend( {}, fieldAttributes, {\r\n\t\t\t\t\t\t'data-type': 'select',\r\n\t\t\t\t\t\t'class':\t 'form-element__select',\r\n\t\t\t\t\t}));\r\n\r\n\t\t\t\t\tthis.field = field;\r\n\r\n\t\t\t\t\tlet hasSelectedOption = false,\r\n\t\t\t\t\t\tnumberOfOptions = 0,\r\n\t\t\t\t\t\tdefaultValue,\r\n\t\t\t\t\t\tdefaultOptionExists;\r\n\r\n\t\t\t\t\t// Check if it has default option and get the default option's value\r\n\t\t\t\t\tif ( attributes.hasDefaultValue ){\r\n\t\t\t\t\t\tif ( ! isEmpty( attributes.defaultValue.option_value ) && ! isEmpty( attributes.defaultValue.option_name ) ){\r\n\t\t\t\t\t\t\t// The default option has value and name, so we have to add a new option instead of searching for one\r\n\t\t\t\t\t\t\tdefaultValue = attributes.defaultValue.option_value.toString();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tdefaultValue = attributes.defaultValue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Create select options\r\n\t\t\t\t\t$.each( attributes.options, function ( value, option_data ){\r\n\t\t\t\t\t\tconsole.log(option_data.value);\r\n\t\t\t\t\t\tlet selectOption = $( '<option/>', {\r\n\t\t\t\t\t\t\t'value':  option_data.value.toString(),\r\n\t\t\t\t\t\t\t'text':\t  option_data.text\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Check if one of the options value match with the default value. In that case, just select it instead of creating another one with the same value\r\n\t\t\t\t\t\tif ( attributes.hasDefaultValue && compareStrings( defaultValue, value ) ){\r\n\t\t\t\t\t\t\tselectOption.prop( 'selected', true );\r\n\t\t\t\t\t\t\tdefaultOptionExists = true;\r\n\t\t\t\t\t\t\thasSelectedOption   = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// But also check if the select has a value (and it's not empty), in that case we have to select that one\r\n\t\t\t\t\t\tif ( attributes.hasValue && compareStrings( attributes.currentValue, option_data.value.toString() ) ){\r\n\t\t\t\t\t\t\tselectOption.prop( 'selected', true );\r\n\t\t\t\t\t\t\thasSelectedOption = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tselectOption.appendTo( field );\r\n\t\t\t\t\t\tnumberOfOptions++;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Check if this select supports the token selector\r\n\t\t\t\t\t// If it does, create the \"Custom value\" field\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tif ( attributes.supportsCustomValue ){\r\n\t\t\t\t\t\t// Create \"Other options\" section\r\n\t\t\t\t\t\tconst $otherOptions = $( `\r\n\t\t\t\t\t\t\t\t<optgroup label=\"${ UncannyAutomator.i18n.validation.field.select.otherOptions }\">\r\n\t\t\t\t\t\t\t\t\t<option value=\"automator_custom_value\" class=\"test\" data-custom=\"asdasdasdas\">${ UncannyAutomator.i18n.validation.field.select.customValue }</option>\r\n\t\t\t\t\t\t\t\t</optgroup>\r\n\t\t\t\t\t\t\t` );\r\n\r\n\t\t\t\t\t\t// Append \"Other options\" to the field\r\n\t\t\t\t\t\tfield.append( $otherOptions );\r\n\r\n\t\t\t\t\t\t// Create custom value field\r\n\t\t\t\t\t\tlet customValueField = new Field( 'text', {});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Check if \r\n\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\t*/\r\n\r\n\t\t\t\t\t// Check if an option was selected, if not then check if we have a default option that doesn't exist in the select, in that case, create one\r\n\t\t\t\t\tif ( attributes.hasDefaultValue && ! defaultOptionExists ){\r\n\t\t\t\t\t\t// Create option\r\n\r\n\t\t\t\t\t\tif ( ! isEmpty( attributes.defaultValue.option_value ) && ! isEmpty( attributes.defaultValue.option_name ) ){\r\n\r\n\t\t\t\t\t\t\tlet defaultOption = $( '<option/>', {\r\n\t\t\t\t\t\t\t\t'value':\t attributes.defaultValue.option_value,\r\n\t\t\t\t\t\t\t\t'text':\t attributes.defaultValue.option_name\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif ( ! attributes.hasValue && ! compareStrings( attributes.defaultValue.option_value, attributes.currentValue ) ){\r\n\t\t\t\t\t\t\t\tdefaultOption.prop( 'selected', true );\r\n\t\t\t\t\t\t\t\thasSelectedOption = true;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Add first (or second, if the select has a placeholder)\r\n\t\t\t\t\t\t\tdefaultOption.prependTo( field );\r\n\t\t\t\t\t\t\tnumberOfOptions++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if we have to add a placeholder\r\n\t\t\t\t\tif ( attributes.hasPlaceholder ){\r\n\t\t\t\t\t\t// Add empty option at the top\r\n\t\t\t\t\t\tfield.prepend( '<option></option>' );\r\n\r\n\t\t\t\t\t\t// If nothing else is selected, then remove the selected\r\n\t\t\t\t\t\t// value of the select\r\n\t\t\t\t\t\tif ( ! attributes.hasDefaultValue && ! attributes.hasValue ){\r\n\t\t\t\t\t\t\tfield.find( 'option:selected' ).prop( 'selected', false );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Has a selected option\r\n\t\t\t\t\tthis.selectHasSelectedOption = hasSelectedOption;\r\n\r\n\t\t\t\t\t// Check if it has options, if it doesn't then add one and disable\r\n\t\t\t\t\tif ( numberOfOptions == 0 ){\r\n\t\t\t\t\t\tlet noResults = new Option( UncannyAutomator.i18n.noResults, '', true, true );\r\n\t\t\t\t\t\tthis.field.append( noResults );\r\n\t\t\t\t\t\tthis.field.prop( 'disabled', true );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Bind changes\r\n\t\t\t\t\tfield.on( 'change', function(){\r\n\t\t\t\t\t\tformElement.trigger( 'automator:field:change' );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'text':\r\n\t\t\t\tcase 'url':\r\n\t\t\t\tcase 'email':\r\n\t\t\t\tcase 'int':\r\n\t\t\t\tcase 'float':\r\n\t\t\t\t\t// FALLTHROUGH: These fields share the same structure as all of them are input text. The validation is done by another function. For now, these fields types only have two differences, the CSS class added in fieldContainer and the type property of the attributes object added to the field variable.\r\n\r\n\t\t\t\t\t// Create CSS classes that will be used by the field container element. This will create classes like \"form-input--url\". They are not used for validation but are useful to add custom CSS to each field\r\n\t\t\t\t\tlet fieldContainerClass = 'form-input form-input--' + type;\r\n\r\n\t\t\t\t\t// Field container\r\n\t\t\t\t\tfieldContainer = $( '<div/>', { 'class': fieldContainerClass } );\r\n\r\n\t\t\t\t\tthis.fieldContainer = fieldContainer;\r\n\r\n\t\t\t\t\t// Create input element and add fieldAttributes to jQuery object. Merge second object into fieldAttributes, recursively\r\n\t\t\t\t\tfield = $( '<input/>', $.extend( {}, fieldAttributes, {\r\n\t\t\t\t\t\t'class':\t\t'form-element__input',\r\n\t\t\t\t\t\t'type':\t\t 'text',\r\n\t\t\t\t\t\t'data-type':\ttype,\r\n\t\t\t\t\t}));\r\n\r\n\t\t\t\t\tthis.field = field;\r\n\r\n\t\t\t\t\t// Add tokens CSS class to field. This will be used to render the Token Selector once the element is added to the DOM\r\n\t\t\t\t\tif ( attributes.supportsTokens ){\r\n\t\t\t\t\t\tfieldContainer.addClass( 'form-input--token' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if the field has a placeholder and add it\r\n\t\t\t\t\tif ( attributes.hasPlaceholder ){\r\n\t\t\t\t\t\tfield.prop( 'placeholder', attributes.placeholder );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if the field has a value and add it\r\n\t\t\t\t\tif ( attributes.hasValue ){\r\n\t\t\t\t\t\tfield.prop( 'value', attributes.currentValue );\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Now that we now that the field doesn't have a value we can check if the developer defined a default value\r\n\t\t\t\t\t\tif ( attributes.hasDefaultValue ){\r\n\t\t\t\t\t\t\tfield.prop( 'value', attributes.defaultValue );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Bind changes\r\n\t\t\t\t\tfield.on( 'input', function(){\r\n\t\t\t\t\t\tformElement.trigger( 'automator:field:change' );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'textarea':\r\n\t\t\t\t\t// Field container\r\n\t\t\t\t\tfieldContainer = $( '<div/>', {'class': 'form-textarea'} );\r\n\r\n\t\t\t\t\tthis.fieldContainer = fieldContainer;\r\n\r\n\t\t\t\t\t// Create textarea\r\n\t\t\t\t\tfield = $( '<textarea/>', $.extend( true, fieldAttributes, {\r\n\t\t\t\t\t\t'data-type':\t\t 'text',\r\n\t\t\t\t\t\t'class':\t\t\t 'form-element__textarea',\r\n\t\t\t\t\t\t'data-item_type':\t attributes.itemType\r\n\t\t\t\t\t}));\r\n\r\n\t\t\t\t\tthis.field = field;\r\n\r\n\t\t\t\t\t// Add tokens CSS class to field. This will be used to render the Token Selector once the element is added to the DOM\r\n\t\t\t\t\tif ( attributes.supportsTokens ){\r\n\t\t\t\t\t\tfieldContainer.addClass( 'form-textarea--token' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if the field has a placeholder and add it\r\n\t\t\t\t\tif ( attributes.hasPlaceholder ){\r\n\t\t\t\t\t\tfield.prop( 'placeholder', attributes.placeholder );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if the field has a value and add it\r\n\t\t\t\t\tif ( attributes.hasValue ){\r\n\t\t\t\t\t\tfield.text( attributes.currentValue );\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Now that we now that the field doesn't have a value we can check if the developer defined a default value\r\n\t\t\t\t\t\tif ( attributes.hasDefaultValue ){\r\n\t\t\t\t\t\t\tfield.text( attributes.defaultValue );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Bind changes\r\n\t\t\t\t\tfield.on( 'input', function(){\r\n\t\t\t\t\t\tformElement.trigger( 'automator:field:change' );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t   \r\n\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\t// Field container\r\n\t\t\t\t\tfieldContainer = $( '<div/>', {'class': 'form-checkbox' } );\r\n\r\n\t\t\t\t\tthis.fieldContainer = fieldContainer;\r\n\r\n\t\t\t\t\tlet checkboxLabel = $( '<label/>', {'class': 'form-checkbox__container' } );\r\n\t\t\t\t\tlet checkboxPseudo = $( '<div/>', {'class': 'checkbox--show' } );\r\n\r\n\t\t\t\t\t// Create checkbox\r\n\t\t\t\t\tfield = $( '<input/>', $.extend( {}, fieldAttributes, {\r\n\t\t\t\t\t\t'type':\t     'checkbox',\r\n\t\t\t\t\t\t'data-type': 'checkbox',\r\n\t\t\t\t\t\t'class':\t 'checkbox--hidden checkbox--primary',\r\n\t\t\t\t\t}));\r\n\r\n\t\t\t\t\t// Check if checked by default\r\n\t\t\t\t\tif ( attributes.hasValue && attributes.currentValue ){\r\n\t\t\t\t\t\tfield.prop( 'checked', true );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.field = field;\r\n\r\n\t\t\t\t\t// Add label\r\n\t\t\t\t\tif ( attributes.hasLabel ){\r\n\t\t\t\t\t\tcheckboxLabel.text( attributes.label );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Append elements\r\n\t\t\t\t\tfieldContainer.append( checkboxLabel );\r\n\t\t\t\t\tcheckboxLabel.append( field );\r\n\t\t\t\t\tcheckboxLabel.append( checkboxPseudo );\r\n\r\n\t\t\t\t\t// Check if we have to render a Toggle\r\n\t\t\t\t\tif ( isDefined( attributes.isToggle ) && attributes.isToggle ){\r\n\t\t\t\t\t\tfieldContainer.addClass( 'form-checkbox--toggle' );\r\n\r\n\t\t\t\t\t\t// Check if we have to add on and off strings divs\r\n\t\t\t\t\t\tif ( isDefined( attributes.toggle ) ){\r\n\t\t\t\t\t\t\t// Check \"on\"\r\n\t\t\t\t\t\t\tif ( isDefined( attributes.toggle.on ) ){\r\n\t\t\t\t\t\t\t\tlet checkboxToggleOn = $( '<span/>', { 'class': 'checkbox-label checkbox-label--on' }).text( attributes.toggle.on );\r\n\t\t\t\t\t\t\t\tcheckboxLabel.append( checkboxToggleOn );\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Check \"off\"\r\n\t\t\t\t\t\t\tif ( isDefined( attributes.toggle.off ) ){\r\n\t\t\t\t\t\t\t\tlet checkboxToggleOff = $( '<span/>', { 'class': 'checkbox-label checkbox-label--off' }).text( attributes.toggle.off );\r\n\t\t\t\t\t\t\t\tcheckboxLabel.append( checkboxToggleOff );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Define color\r\n\t\t\t\t\tif ( isDefined( attributes.color ) ){\r\n\t\t\t\t\t\t// Check if the color is valid\r\n\t\t\t\t\t\tif ( inArray( attributes.color, [ 'gutenberg', 'green' ] ) ){\r\n\t\t\t\t\t\t\t// Add class\r\n\t\t\t\t\t\t\tswitch ( attributes.color ){\r\n\t\t\t\t\t\t\t\tcase 'gutenberg':\r\n\t\t\t\t\t\t\t\t\tfieldContainer.addClass( 'form-checkbox--toggle-gutenberg' );\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\tcase 'green':\r\n\t\t\t\t\t\t\t\t\tfieldContainer.addClass( 'form-checkbox--toggle-green' );\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tconsole.error( vsprintf( 'The color %s does not exists. Default color will be used instead.', [ attributes.color ] ) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Define align\r\n\t\t\t\t\tif ( isDefined( attributes.align ) ){\r\n\t\t\t\t\t\t// Check if it's a valid value\r\n\t\t\t\t\t\tif ( inArray( attributes.align, [ 'left', 'right' ] ) ){\r\n\t\t\t\t\t\t\t// Check if it's 'right', otherwise ignore, since 'left' doesn't needs a class\r\n\t\t\t\t\t\t\tif ( attributes.align == 'right' ){\r\n\t\t\t\t\t\t\t\t// Add class\r\n\t\t\t\t\t\t\t\tfieldContainer.addClass( 'form-checkbox--toggle-right' );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tconsole.error( vsprintf( 'The alignment %s does not exists. %s will be used instead.', [ attributes.align, '\"left\"' ] ) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Bind changes\r\n\t\t\t\t\tfield.on( 'change', function(){\r\n\t\t\t\t\t\tformElement.trigger( 'automator:field:change' );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Change field variable with all the container\r\n\t\t\t\t\tfield = checkboxLabel;\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'radio':\r\n\t\t\t\t\t// Field container\r\n\t\t\t\t\tfieldContainer = $( '<div/>', {'class': 'form-radio' } );\r\n\t\t\t\t\tthis.fieldContainer = fieldContainer;\r\n\r\n\t\t\t\t\t// Create array to save all the jQuery DOM elements\r\n\t\t\t\t\tlet $fields = $(),\r\n\t\t\t\t\t\t$fieldContainers = $();\r\n\r\n\t\t\t\t\t// Iterate options\r\n\t\t\t\t\t$.each( attributes.options, function( index, option ){\r\n\t\t\t\t\t\t// Create container\r\n\t\t\t\t\t\tconst $formRadioContainer = $( '<label/>', { 'class': 'form-radio__container' });\r\n\r\n\t\t\t\t\t\t// Add label\r\n\t\t\t\t\t\t$formRadioContainer.text( option.text );\r\n\r\n\t\t\t\t\t\t// Create radio\r\n\t\t\t\t\t\tconst $field = $( '<input/>', $.extend( {}, fieldAttributes, {\r\n\t\t\t\t\t\t\t'type':\t     'radio',\r\n\t\t\t\t\t\t\t'data-type': 'radio',\r\n\t\t\t\t\t\t\t'class':\t 'radio--hidden radio--primary',\r\n\r\n\t\t\t\t\t\t\t'value':      option.value,\r\n\t\t\t\t\t\t\t'name':       fieldAttributes.id\r\n\t\t\t\t\t\t}));\r\n\r\n\t\t\t\t\t\t// Save radio\r\n\t\t\t\t\t\t$fields = $fields.add( $field );\r\n\r\n\t\t\t\t\t\t// Create fake radio\r\n\t\t\t\t\t\tconst $fakeRadio = $( '<div/>', { 'class': 'radio--show' });\r\n\r\n\t\t\t\t\t\t// Append elements\r\n\t\t\t\t\t\t$formRadioContainer.append( $field );\r\n\t\t\t\t\t\t$formRadioContainer.append( $fakeRadio );\r\n\r\n\t\t\t\t\t\t// Check if this field has a value, if it does, and the value\r\n\t\t\t\t\t\t// matches the input radio name, then check it\r\n\t\t\t\t\t\tif ( attributes.hasValue && attributes.currentValue == option.value ){\r\n\t\t\t\t\t\t\t$field.prop( 'checked', true );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Otherwise, check if it has a default value and use that\r\n\t\t\t\t\t\telse if ( ! attributes.hasValue && attributes.hasDefaultValue && attributes.defaultValue == option.value ){\r\n\t\t\t\t\t\t\t$field.prop( 'checked', true );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Save container\r\n\t\t\t\t\t\t$fieldContainers = $fieldContainers.add( $formRadioContainer );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Save fields\r\n\t\t\t\t\tthis.field = $fieldContainers;\r\n\t\t\t\t\tfield = $fieldContainers;\r\n\r\n\t\t\t\t\t// Bind changes\r\n\t\t\t\t\t$fields.on( 'change', () => {\r\n\t\t\t\t\t\t// Check if the value is different\r\n\t\t\t\t\t\tformElement.trigger( 'automator:field:change' );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\t\r\n\r\n\t\t\t// Check if it supports tokens and render the token selector\r\n\t\t\tif ( attributes.supportsTokens ){\r\n\t\t\t\tlet formVariable = $( '<div/>', { 'class': 'form-variable' } );\r\n\r\n\t\t\t\tlet formVariableFieldContainer = $( '<div/>', { 'class': 'form-variable__element' } );\r\n\t\t\t\tlet formVariableFieldContainerRender = $( '<div/>', { 'class': 'form-variable__render-container' } );\r\n\t\t\t\tlet formVariableToggle = $( '<div/>', { 'class': 'form-variable__toggle' } );\r\n\t\t\t\tlet formVariableToggleIcon = $( '<span/>', { 'class': 'uo-icon uo-icon--asterisk' } );\r\n\t\t\t\tformVariableFieldContainerRender.append( field );\r\n\t\t\t\tformVariableFieldContainer.append( formVariableFieldContainerRender );\r\n\t\t\t\tformVariableToggle.append( formVariableToggleIcon );\r\n\t\t\t\tformVariableFieldContainer.append( formVariableToggle );\r\n\t\t\t\tformVariable.append( formVariableFieldContainer );\r\n\r\n\t\t\t\tlet formVariableDropdown = $( '<div/>', { 'class': 'form-variable__dropdown' } );\r\n\t\t\t\tformVariable.append( formVariableDropdown );\r\n\r\n\t\t\t\t// Replace original field\r\n\t\t\t\tfield = formVariable;\r\n\t\t\t}\r\n\r\n\t\t\t// Append field jQuery object to field container\r\n\t\t\tfieldContainer.append( field );\r\n\r\n\t\t\t// Create label\r\n\r\n\t\t\t// Create Label, even if it's empty but the field is required, so we can add the asterisk\r\n\t\t\tlet fieldLabel;\r\n\r\n\t\t\tif ( type != 'checkbox' && ( attributes.hasLabel || attributes.isRequired ) ){\r\n\t\t\t\tfieldLabel = $( '<label/>', {\r\n\t\t\t\t\t'class': 'form-element__label',\r\n\t\t\t\t\t'for': \t attributes.optionCode\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Add label text\r\n\t\t\t\tif ( attributes.hasLabel ){\r\n\t\t\t\t\tfieldLabel.text( attributes.label );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it's a required field\r\n\t\t\tif ( attributes.isRequired ){\r\n\t\t\t\t// Add required class to the field container\r\n\t\t\t\tfieldContainer.addClass( 'form-element--required' );\r\n\r\n\t\t\t\t// Check if it's a checkbox\r\n\t\t\t\tif ( attributes.fieldType == 'checkbox' ){\r\n\t\t\t\t\t// Add required attribute to the field\r\n\t\t\t\t\tfield.find( 'input' ).prop( 'required', true );\r\n\r\n\t\t\t\t\t// Add asterisk to the label\r\n\t\t\t\t\tif ( attributes.hasLabel ){\r\n\t\t\t\t\t\t// Add required icon next to label\r\n\t\t\t\t\t\tlet fieldLabelAsterisk = $( '<span/>', { 'class': 'form-element-label__required' } );\r\n\t\t\t\t\t\tfield.append( fieldLabelAsterisk );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Add required attribute to the field\r\n\t\t\t\t\tfield.prop( 'required', true );\r\n\r\n\t\t\t\t\t// Add asterisk to the label\r\n\t\t\t\t\tif ( attributes.hasLabel ){\r\n\t\t\t\t\t\t// Add required icon next to label\r\n\t\t\t\t\t\tlet fieldLabelAsterisk = $( '<span/>', { 'class': 'form-element-label__required' } );\r\n\t\t\t\t\t\tfieldLabel.append( fieldLabelAsterisk );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it's\r\n\t\t\tif ( isDefined( attributes.isReadOnly ) && attributes.isReadOnly ){\r\n\t\t\t\t// Check if it's a select\r\n\t\t\t\tif ( attributes.fieldType == 'select' ){\r\n\t\t\t\t\t// Disable the select\r\n\t\t\t\t\tfield.prop( 'disabled', true );\r\n\t\t\t\t}\r\n\t\t\t\telse if ( [ 'checkbox', 'radio' ].includes( attributes.fieldType ) ){\r\n\t\t\t\t\t// Disable the radio and checkbox\r\n\t\t\t\t\tfield.find( 'input' ).prop( 'disabled', true );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Add read only attribute to the field\r\n\t\t\t\t\tfield.prop( 'readonly', true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Append label element if is defined\r\n\t\t\tif ( attributes.hasLabel || attributes.isRequired ){\r\n\t\t\t\tfieldContainer.prepend( fieldLabel);\r\n\t\t\t}\r\n\r\n\t\t\t// Error container\r\n\t\t\tlet fieldError = $( '<div/>', { 'class': 'form-element__error' });\r\n\t\t\tfieldContainer.append( fieldError );\r\n\r\n\t\t\tthis.fieldContainer = fieldContainer;\r\n\r\n\t\t\t// Field description\r\n\t\t\tif ( attributes.hasDescription ){\r\n\t\t\t\tlet fieldDescription = $( '<div/>', { 'class': 'description' } );\r\n\t\t\t\tfieldDescription.html( attributes.description );\r\n\t\t\t\tfieldContainer.append( fieldDescription );\r\n\t\t\t}\r\n\r\n\t\t\t// Check if the field is hidden\r\n\t\t\tif ( attributes.isHidden ){\r\n\t\t\t\t// Add class to hide the field container\r\n\t\t\t\tfieldContainer.addClass( 'form-element--hidden' );\r\n\t\t\t}\r\n\r\n\t\t\t// Append everything to the form element container\r\n\t\t\tformElement.append( fieldContainer );\r\n\r\n\t\t\t// Response\r\n\t\t\tresponse = formElement;\r\n\r\n\t\t\t// Save Form Element\r\n\t\t\tthis.formElement = formElement;\r\n\r\n\t\t\t// Init libraries\r\n\t\t\tthis.initLibraries();\r\n\r\n\t\t\t// Trigger methods on change\r\n\t\t\tthis.onChange();\r\n\r\n\t\t\t// Trigger methods on focus\r\n\t\t\tthis.onFocus();\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Error: Invalid field type\r\n\t\t\tconsole.error( vsprintf( 'The field type %s is invalid. The valid ones are %s', [ type, getFieldTypes().join( ', ' ) ] ) );\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Set attributes. It add properties like hasValue, hasPlaceholder, etc, automatically\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @param  {object} attributes - The field attributes\r\n\t *\r\n\t * @return {object} attributes - The field attributes\r\n\t */\r\n\r\n\tsetAttributes( attributes ){\r\n\t\t// Check if it's a checkbox and sanitaze the current value\r\n\t\tif ( attributes.fieldType == 'checkbox' && ! isEmpty( attributes.currentValue ) ){\r\n\t\t\t// Check if the value is \"true\" or \"false\"\r\n\t\t\tif ( [ 'true', 'false' ].includes( attributes.currentValue ) ){\r\n\t\t\t\t// Make it a boolean\r\n\t\t\t\tattributes.currentValue = attributes.currentValue == 'true' ? true : false;\r\n\r\n\t\t\t\t// If it's false, set hasValue to false\r\n\t\t\t\tif ( ! attributes.currentValue ){\r\n\t\t\t\t\tattributes.hasValue = false;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tattributes.hasValue = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has value\r\n\t\tif ( ! isDefined( attributes.hasValue ) ){\r\n\t\t\tif ( ! isEmpty( attributes.currentValue ) ){\r\n\t\t\t\tattributes.hasValue = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasValue = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has placeholder\r\n\t\tif ( ! isDefined( attributes.hasPlaceholder ) ){\r\n\t\t\tif ( ! isEmpty( attributes.placeholder ) ){\r\n\t\t\t\tattributes.hasPlaceholder = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasPlaceholder = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has default value\r\n\t\tif ( ! isDefined( attributes.hasDefaultValue ) ){\r\n\t\t\tif ( ! isEmpty( attributes.defaultValue ) ){\r\n\t\t\t\tattributes.hasDefaultValue = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasDefaultValue = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has label\r\n\t\tif ( ! isDefined( attributes.hasLabel ) ){\r\n\t\t\tif ( ! isEmpty( attributes.label ) ){\r\n\t\t\t\tattributes.hasLabel = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasLabel = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has description\r\n\t\tif ( ! isDefined( attributes.hasDescription ) ){\r\n\t\t\tif ( ! isEmpty( attributes.description ) ){\r\n\t\t\t\tattributes.hasDescription = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasDescription = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Is Required\r\n\t\tif ( ! isDefined( attributes.isRequired ) ){\r\n\t\t\tattributes.isRequired = false;\r\n\t\t}\r\n\r\n\t\t// Supports tokens\r\n\t\tif ( ! isDefined( attributes.supportsTokens ) ){\r\n\t\t\tattributes.supportsTokens = false;\r\n\t\t}\r\n\r\n\t\t// Check if it can support tokens\r\n\t\tif ( attributes.supportsTokens && attributes.fieldType == 'select' ){\r\n\t\t\tattributes.supportsTokens = false;\r\n\t\t}\r\n\r\n\t\t// Supports tinyMCE\r\n\t\tif ( ! isDefined( attributes.supportsTinyMCE ) ){\r\n\t\t\tattributes.supportsTinyMCE = false;\r\n\t\t}\r\n\r\n\t\t// Is Toggle\r\n\t\tif ( ! isDefined( attributes.isToggle ) && isDefined( attributes.toggle ) ){\r\n\t\t\tattributes.isToggle = true;\r\n\t\t}\r\n\r\n\t\t// Set the default value for isHidden\r\n\t\tif ( ! isDefined( attributes.isHidden ) ){\r\n\t\t\tattributes.isHidden = false;\r\n\t\t}\r\n\r\n\t\treturn attributes;\r\n\t}\r\n\r\n\t/**\r\n\t * Validate field\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @param  {boolean} renderError - TRUE if you want to render the field errors, FALSE if you only want to return the response object\r\n\t *\r\n\t * @return {validateField} validateField object. Read the comments on Validation.js to learn more\r\n\t */\r\n\r\n\tvalidate( renderError = true ){\r\n\t\t// Parameters\r\n\r\n\t\t// Field (DOM)\r\n\t\tlet field = null,\r\n\t\t\tvalue;\r\n\r\n\t\tif ( renderError ){\r\n\t\t\tfield = this.getFieldContainer();\r\n\t\t\tvalue = this.getValue();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvalue = this.attributes.currentValue;\r\n\t\t}\r\n\r\n\t\t// Type\r\n\t\tlet fieldType = this.type;\r\n\r\n\t\t// Attributes\r\n\t\tlet attributes = {\r\n\t\t\tsupportsTokens: this.attributes.supportsTokens,\r\n\t\t\trequired:  \t    this.attributes.isRequired\r\n\t\t}\r\n\r\n\t\t// This uses the validateField function. Check Validation.js for more information\r\n\t\treturn validateField( field, this.type, value, attributes, this.customValidationFunction );\r\n\t}\r\n\r\n\t/**\r\n\t * Invoke functions on field change\r\n\t * Those functions are global for all the Field objects\r\n\t * Don't use directly, use 'automator:field:change' instead\r\n\t */\r\n\r\n\tonChange(){\r\n\t\tthis.formElement.on( 'automator:field:change', () => {\r\n\t\t\t// Check if it's an AJAX field, but the target field is a different field\r\n\t\t\tif ( this.attributes.isAjax && this.attributes.targetField !== this.attributes.optionCode ){\r\n\t\t\t\tthis.doAJAX();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Invoke functions on field change\r\n\t * Those functions are global for all the Field objects\r\n\t * Don't use directly, use 'automator:field:change' instead\r\n\t */\r\n\r\n\tonFocus(){\r\n\t\tthis.field.on( 'focusin', ( event ) => {\r\n\t\t\t// Check if it's a read-only field\r\n\t\t\tif ( this.attributes.isReadOnly ){\r\n\t\t\t\t// Select the text\r\n\t\t\t\t$( event.currentTarget ).select();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.field.on( 'focusout', () => {});\r\n\t}\r\n\r\n\t/**\r\n\t * Check if the item's object has all the required properties\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tisReady(){\r\n\t\tlet ready = false;\r\n\r\n\t\tif ( isDefined( UncannyAutomator.recipe.items[ this.attributes.itemId ] ) ){\r\n\t\t\tready = true;\r\n\t\t}\r\n\r\n\t\treturn ready;\r\n\t}\r\n\r\n\t/**\r\n\t * Do AJAX\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tdoAJAX(){\r\n\t\t// Get field value. If it isn't defined in the DOM then get the default value\r\n\t\tlet fieldValue = isDefined( this.getValue() ) ? this.getValue() : this.getMetaValue();\r\n\r\n\t\t// Check if we have to do an AJAX call on this field\r\n\t\tif ( this.attributes.isAjax ){\r\n\t\t\t// Get the target field\r\n\t\t\tlet targetField = this;\r\n\r\n\t\t\tif ( this.attributes.optionCode != this.attributes.targetField ){\r\n\t\t\t\ttargetField = getField( this.attributes.itemId, this.attributes.targetField );\r\n\t\t\t}\r\n\r\n\t\t\t// Check that we have everything\r\n\t\t\tif ( ! isEmpty( this.attributes.integrationId ) && ! isEmpty( this.attributes.endpoint ) ){\r\n\t\t\t\t// Before doing the request, show a loading animation in the changed field\r\n\t\t\t\tthis.startLoadingAnimation();\r\n\t\t\t\t// And show animation in the target field too\r\n\t\t\t\ttargetField.startLoadingAnimation();\r\n\r\n\t\t\t\tAJAXRequest( this.attributes.endpoint, {\r\n\t\t\t\t\trecipe_id:      UncannyAutomator.recipe.id,\r\n\t\t\t\t\tintegration_id: this.attributes.integrationId,\r\n\t\t\t\t\titem_id: \t    this.attributes.itemId,\t\t\t\r\n\t\t\t\t\tgroup_id: \t    this.attributes.groupId,\r\n\t\t\t\t\tfield_id: \t    this.attributes.optionCode,\r\n\t\t\t\t\ttarget_field:   this.attributes.targetField,\r\n\t\t\t\t\tvalue: \t\t    this.getValue(),\r\n\t\t\t\t\tvalues: \t\tgetCurrentFieldsValues( this.attributes.itemId )\r\n\t\t\t\t}, ( response ) => {\r\n\t\t\t\t\t// Stop loading animation in both fields\r\n\t\t\t\t\tthis.stopLoadingAnimation();\r\n\t\t\t\t\ttargetField.stopLoadingAnimation();\r\n\r\n\t\t\t\t\tlet targetFieldAttributes = targetField.getAttributes();\r\n\r\n\t\t\t\t\t// Check if the target field is a select and the response is an array\r\n\t\t\t\t\tif ( targetFieldAttributes.fieldType == 'select' && $.isArray( response ) ){\r\n\t\t\t\t\t\t// The developer wants to set new options for a select\r\n\t\t\t\t\t\ttargetField.setSelectOptions( response );\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Try to set the value\r\n\t\t\t\t\t\ttargetField.setValue( response );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Get form element\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @return {object} jQuery object of the field's container\r\n\t */\r\n\r\n\tgetFormElement(){\r\n\t\tif ( this.isReady() ){\r\n\t\t\tthis.doAJAX();\r\n\t\t}\r\n\r\n\t\treturn this.formElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Get field container\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @return {object} jQuery object of the field's container\r\n\t */\r\n\r\n\tgetFieldContainer(){\r\n\t\treturn this.fieldContainer;\r\n\t}\r\n\r\n\t/**\r\n\t * Get field ID\r\n\t * \r\n\t * @since 0.5\r\n\t *\r\n\t * @return {string} The field ID\r\n\t */\r\n\r\n\tgetFieldID(){\r\n\t\treturn this.attributes.optionCode;\r\n\t}\r\n\r\n\t/**\r\n\t * Get field\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @return {object} jQuery object of the field\r\n\t */\r\n\r\n\tgetField(){\r\n\t\treturn this.field;\r\n\t}\r\n\r\n\t/**\r\n\t * Get attributes\r\n\t * \r\n\t * @since 0.5\r\n\t *\r\n\t * @return {object} Field attributes\r\n\t */\r\n\r\n\tgetAttributes(){\r\n\t\treturn this.attributes;\r\n\t}\r\n\r\n\t/**\r\n\t * Get field's value FROM THE DOM ELEMENT\r\n\t * If you want to get the value from the main object then check {attributes.currentValue}\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @return {string|int} Value of the field\r\n\t */\r\n\r\n\tgetValue(){\r\n\t\tlet response = null;\r\n\r\n\t\tif ( isDefined( this.field ) ){\r\n\t\t\tswitch ( this.type ){\r\n\t\t\t\tcase 'select':\r\n\t\t\t\t\t/*\r\n\t\t\t\t\t// Get the value of the custom field\r\n\t\t\t\t\tlet fieldValue       = this.field.val(),\r\n\t\t\t\t\t\tcustomFieldValue = this.getCustomValue();\r\n\r\n\t\t\t\t\tresponse = {\r\n\t\t\t\t\t\tvalue:    ( fieldValue == 'automator_custom_value' ) ? customFieldValue : fieldValue,\r\n\t\t\t\t\t\tisCustom: fieldValue == 'automator_custom_value'\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\t*/\r\n\r\n\t\t\t\tcase 'text':\r\n\t\t\t\tcase 'url':\r\n\t\t\t\tcase 'email':\r\n\t\t\t\tcase 'int':\r\n\t\t\t\tcase 'float':\r\n\t\t\t\tcase 'textarea':\r\n\t\t\t\t\tresponse = this.field.val();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\tresponse = this.field.is( ':checked' );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'radio':\r\n\t\t\t\t\tresponse = this.field.find( 'input:checked' ).val();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Get custom value\r\n\t * Only for selects\r\n\t *\r\n\t * @since  2.0.3\r\n\t */\r\n\t\r\n\tgetCustomValue(){\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Get readable value\r\n\t *\r\n\t * @since 0.6\r\n\t *\r\n\t * @return string with the value\r\n\t */\r\n\r\n\tgetReadableValue(){\r\n\t\tlet response = null,\r\n\t\t\tvalue \t = this.getValue();\r\n\r\n\t\tswitch ( this.type ){\r\n\t\t\tcase 'select':\r\n\t\t\t\tresponse = this.field.find( vsprintf( 'option[value=\"%s\"]', [ value ] ) ).text();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'url':\r\n\t\t\tcase 'email':\r\n\t\t\tcase 'int':\r\n\t\t\tcase 'float':\r\n\t\t\tcase 'textarea':\r\n\t\t\t\t// Create DOM element to remove the HTML tags\r\n\t\t\t\tvalue = $( '<p/>' ).html( value ).text();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'checkbox':\r\n\t\t\t\tif ( value ){\r\n\t\t\t\t\tresponse = UncannyAutomator.i18n.trueLabel;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tresponse = UncannyAutomator.i18n.falseLabel;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'radio':\r\n\t\t\t\t// Get checked radio\r\n\t\t\t\tconst $checkedRadio = this.field.find( 'input:checked' );\r\n\r\n\t\t\t\t// Check if there is a checked radio\r\n\t\t\t\tif ( $checkedRadio.length == 1 ){\r\n\t\t\t\t\t// Get container\r\n\t\t\t\t\tconst $radioContainer = $checkedRadio.closest( '.form-radio__container' );\r\n\r\n\t\t\t\t\t// Get text\r\n\t\t\t\t\tresponse = $radioContainer.text().trim();\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Get field's meta value\r\n\t * \r\n\t * @since 0.5\r\n\t *\r\n\t * @return {string|int} Value of the field\r\n\t */\r\n\r\n\tgetMetaValue(){\r\n\t\tlet response;\r\n\r\n\t\t// If the item is defined\r\n\t\tif ( isDefined( UncannyAutomator.recipe.items[ this.attributes.itemId ] ) ){\r\n\t\t\tlet metaValue = UncannyAutomator.recipe.items[ this.attributes.itemId ].meta[ this.attributes.optionCode ];\r\n\r\n\t\t\tif ( isDefined( metaValue ) ){\r\n\t\t\t\tresponse = metaValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Set value\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @param {string} Value of the field\r\n\t */\r\n\r\n\tsetValue( value, doTrigger = true ){\r\n\r\n\t\tswitch ( this.type ){\r\n\t\t\tcase 'select':\r\n\t\t\t\t// Get option\r\n\t\t\t\tlet option = this.field.find( 'option[value=\"' + value + '\"]' );\r\n\r\n\t\t\t\t// Check if option exists\r\n\t\t\t\tif ( option.length > 0 ){\r\n\t\t\t\t\t// Get all options and unselect them\r\n\t\t\t\t\tlet allOptions = this.field.find( 'option' );\r\n\t\t\t\t\tallOptions.prop( 'selected', false );\r\n\r\n\t\t\t\t\t// Select option\r\n\t\t\t\t\toption.prop( 'selected', true );\r\n\r\n\t\t\t\t\t// Trigger change\r\n\t\t\t\t\tif ( doTrigger ){\r\n\t\t\t\t\t\tthis.field.trigger( 'automator:field:change' );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconsole.error( vsprintf( 'The option with ID %s does not exists', [ value ] ) );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'url':\r\n\t\t\tcase 'email':\r\n\t\t\tcase 'int':\r\n\t\t\tcase 'float':\r\n\t\t\tcase 'textarea':\r\n\t\t\t\t// Set value\r\n\t\t\t\tthis.field.val( value );\r\n\r\n\t\t\t\t// Trigger change\r\n\t\t\t\tif ( doTrigger ){\r\n\t\t\t\t\tthis.field.trigger( 'automator:field:change' );\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'checkbox':\r\n\t\t\t\tlet wantsToCheck = value, // Just for readability\r\n\t\t\t\t\tisChecked = this.getValue();\r\n\r\n\t\t\t\t// If true, check\r\n\t\t\t\tif ( wantsToCheck && ! isChecked ){\r\n\t\t\t\t\tthis.field.prop( 'checked', true );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( ! wantsToCheck && isChecked ) {\r\n\t\t\t\t\tthis.field.prop( 'checked', false );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( doTrigger && ( ( wantsToCheck && ! isChecked ) || ( ! wantsToCheck && isChecked ) ) ){\r\n\t\t\t\t\t// Trigger change\r\n\t\t\t\t\tthis.field.trigger( 'automator:field:change' );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'radio':\r\n\t\t\t\t// Search for the radio and check it\r\n\t\t\t\tthis.field.filter( `[name=\"${ value }\"]` ).prop( 'checked', true );\r\n\r\n\t\t\t\t// Trigger change\r\n\t\t\t\tif ( doTrigger ){\r\n\t\t\t\t\t// Trigger change\r\n\t\t\t\t\tthis.field.trigger( 'automator:field:change' );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Check if a select has a selected option\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\thasSelectedOption(){\r\n\t\treturn this.selectHasSelectedOption;\r\n\t}\r\n\r\n\t/**\r\n\t * Set select options\r\n\t *\r\n\t * @since 0.5\r\n\t *\r\n\t * @param {array} \r\n\t */\r\n\r\n\tsetSelectOptions( options ){\r\n\t\t// Remove current options\r\n\t\tthis.removeSelectOptions();\r\n\r\n\t\tif ( isDefined( this.field ) ){\r\n\t\t\tif ( options.length > 0 ){\r\n\t\t\t\t// Remove disabled\r\n\t\t\t\tthis.field.prop( 'disabled', false );\r\n\r\n\t\t\t\t// Get value\r\n\t\t\t\tlet value = isDefined( this.getValue() ) ? this.getValue() : this.getMetaValue();\r\n\r\n\t\t\t\t// Create array to save all options\r\n\t\t\t\tlet optionsDOM = [];\r\n\r\n\t\t\t\t// Create and append options\r\n\t\t\t\t$.each( options, ( index, option ) => {\r\n\t\t\t\t\tlet optionDOM = new Option( option.text, option.value, false, false );\r\n\r\n\t\t\t\t\tthis.field.append( optionDOM );\r\n\t\t\t\t\toptionsDOM.push( optionDOM );\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif ( ! isEmpty( value ) ){\r\n\t\t\t\t\t$.each( optionsDOM, ( index, option ) => {\r\n\t\t\t\t\t\tif ( option.value == value ){\r\n\t\t\t\t\t\t\t$( option ).prop( 'selected', true );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet noResults = new Option( UncannyAutomator.i18n.noResults, '', true, true );\r\n\t\t\t\tthis.field.append( noResults );\r\n\t\t\t\tthis.field.prop( 'disabled', true );\r\n\t\t\t}\r\n\r\n\t\t\tthis.field.trigger( 'change' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Remove select options\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tremoveSelectOptions(){\r\n\t\tif ( isDefined( this.field ) ){\r\n\t\t\tthis.field.empty();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Check if field has loading animation\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @return {boolean} TRUE if the field has the loading animation\r\n\t */\r\n\r\n\tisLoading(){\r\n\t\treturn this.formElement.hasClass( 'form-element--loading' );\r\n\t}\r\n\r\n\t/**\r\n\t * Add loading animation to field\r\n\t * \r\n\t * @since 0.4\r\n\t */\r\n\r\n\tstartLoadingAnimation(){\r\n\t\t// Check if has class\r\n\t\tlet CSSclass = 'form-element--loading';\r\n\r\n\t\tif ( isDefined( this.formElement ) && ! this.formElement.hasClass( CSSclass ) ){\r\n\t\t\t\r\n\t\t\t// Add class\r\n\t\t\tthis.formElement.addClass( CSSclass );\r\n\r\n\t\t\t// Check if it's a checkbox\r\n\t\t\tif ( this.type == 'checkbox' && ! isDefined( this.attributes.isToggle ) ){\r\n\t\t\t\tthis.fieldContainer.addClass( 'form-checkbox--loading-inline' );\r\n\t\t\t}\r\n\r\n\t\t\t// Trigger\r\n\t\t\tthis.formElement.trigger( 'automator:field:loading' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Remove loading animation to field\r\n\t * \r\n\t * @since 0.4\r\n\t */\r\n\r\n\tstopLoadingAnimation(){\r\n\t\t// Check if has class\r\n\t\tlet CSSclass = 'form-element--loading';\r\n\r\n\t\tif ( isDefined( this.formElement ) && this.formElement.hasClass( CSSclass ) ){\r\n\t\t\t\r\n\t\t\t// Remove class\r\n\t\t\tthis.formElement.removeClass( CSSclass );\r\n\r\n\t\t\t// Remove checkbox class\r\n\t\t\tthis.fieldContainer.removeClass( 'form-checkbox--loading-inline' );\r\n\r\n\t\t\t// Trigger\r\n\t\t\tthis.formElement.trigger( 'automator:field:loading' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Init field libraries, like Select2\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tinitLibraries(){\r\n\t\tswitch ( this.type ){\r\n\t\t\tcase 'select':\r\n\t\t\t\t// Select2\r\n\t\t\t\tthis.initSelect2( this.field );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'url':\r\n\t\t\tcase 'email':\r\n\t\t\tcase 'int':\r\n\t\t\tcase 'float':\r\n\t\t\tcase 'textarea':\r\n\t\t\t\t// Tokens\r\n\t\t\t\tif ( this.attributes.supportsTokens ){\r\n\t\t\t\t\tthis.initTokenSelector( this.fieldContainer );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// URL Checker\r\n\t\t\t\tif ( this.attributes.fieldType == 'url' ){\r\n\t\t\t\t\tinitURLChecker( this.fieldContainer );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Init Select2\r\n\t * \r\n\t * @since 0.5\r\n\t */\r\n\r\n\tinitSelect2( $field ){\r\n\t\t// Define select2 settings\r\n\t\tlet settings = {\r\n\t\t\ttheme: 'default uap-select2',\r\n\t        searchInputPlaceholder: UncannyAutomator.i18n.search,\r\n\t        language: {\r\n\t            noResults: function () {\r\n\t                return UncannyAutomator.i18n.noResults;\r\n\t            },\r\n\t        },\r\n            templateResult: function ( data ) {\r\n                if ( typeof data.id !== \"undefined\" ) {\r\n                    if ( Number.isInteger( parseInt( data.id ) ) && parseInt( data.id ) > 0 ) {\r\n                        return '<span class=\"uap-select2-item__meta\">(ID: ' + data.id + ')</span> ' + data.text;\r\n                    } else {\r\n                        return data.text;\r\n                    }\r\n                } else {\r\n                    return data.text;\r\n                }\r\n            },\r\n            templateSelection: function ( data ) {\r\n                if ( typeof data.id !== \"undefined\" ) {\r\n                    if ( Number.isInteger( parseInt( data.id ) ) && parseInt( data.id ) > 0 ) {\r\n                        return '<span class=\"uap-select2-item__meta\">(ID: ' + data.id + ')</span> ' + data.text;\r\n                    } else {\r\n                        return data.text;\r\n                    }\r\n                } else {\r\n                    return data.text;\r\n                }\r\n            },\r\n            escapeMarkup: function ( markUp ) {\r\n                return markUp;\r\n            }\r\n\t    };\r\n\r\n\t    // Check if we have to add a placeholder\r\n\t\tif ( this.attributes.hasPlaceholder ){\r\n\t\t\t// Add placeholder\r\n\t\t\tsettings.placeholder = this.attributes.placeholder;\r\n\t\t}\r\n\r\n\t\tif ( ! $field.hasClass( 'select2-hidden-accessible' ) ){\r\n\t\t\t$field.select2( settings );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Init Token Selector\r\n\t * This is temporal and will be removed in the next version\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tinitTokenSelector( $input ){\r\n\t    // Get all inputs with token selectors and init\r\n\t    let tokens = getTokens( this.attributes.itemType, this.attributes.fieldType );\r\n\t    $input.TokenSelector( tokens );\r\n\t}\r\n\r\n\t/**\r\n\t * Init TinyMCE\r\n\t * We're going to call this in ItemOptions.js because TinyMCE needs the item in the DOM before changing it\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tinitTinyMCE(){\r\n\t\tlet $textarea = this.field;\r\n\r\n\t\t// TinyMCE\r\n\t\tif ( isDefined( this.field ) && this.attributes.fieldType == 'textarea' && this.attributes.supportsTinyMCE ){\r\n\t\t\t// Get field ID\r\n\t\t\tconst fieldId = this.field.prop( 'id' );\r\n\r\n\t\t\t// Get editor\r\n\t        let editor = tinymce.get( fieldId );\r\n\r\n\t        if ( isDefined( editor ) ){\r\n\t        \twp.editor.remove( fieldId );\r\n\t        }\r\n\r\n\t\t\twp.editor.initialize( fieldId, {\r\n\t\t\t\tmediaButtons: true,\r\n\t\t\t\ttinymce: { \r\n\t\t\t\t\twpautop: true, \r\n\t\t\t\t\ttoolbar1: 'formatselect bold italic bullist numlist blockquote alignleft aligncenter alignright link unlink wp_more',\r\n\t\t\t\t\ttoolbar2: 'strikethrough hr forecolor pastetext removeformat visualchars outdent indent undo redo'\r\n\t\t\t\t}, \r\n\t\t\t\tquicktags: true,\r\n\t\t\t});\r\n\r\n\t\t\t// Get editor\r\n\t        editor = tinymce.get( fieldId );\r\n\t        \r\n\t        editor.on( 'input change paste', () => {\r\n\t        \tthis.field.text( editor.getContent() );\r\n\t        });\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default Field;\r\n\r\n/**\r\n * Extend Select2 to add a placeholder in the search input\r\n *\r\n * @since 0.1\r\n *\r\n * @param   {object} Select2 Instance\r\n *\r\n * @return  {object} Select2 Instance\r\n */\r\n\r\n(function ($){\r\n    // Get default settings\r\n    var Defaults = $.fn.select2.amd.require( 'select2/defaults' );\r\n\r\n    // Set default value for searchInputPlaceholder\r\n    $.extend(Defaults.defaults, {\r\n        searchInputPlaceholder: ''\r\n    });\r\n\r\n    // Get search element\r\n    var SearchDropdown = $.fn.select2.amd.require( 'select2/dropdown/search' );\r\n\r\n    // Save instance of search element\r\n    var _renderSearchDropdown = SearchDropdown.prototype.render;\r\n\r\n    SearchDropdown.prototype.render = function ( decorated ){\r\n        // Add placeholder attribute\r\n        var $rendered = _renderSearchDropdown.apply( this, Array.prototype.slice.apply( arguments ) );\r\n        this.$search.attr( 'placeholder', this.options.get( 'searchInputPlaceholder' ) );\r\n\r\n        // Return search element\r\n        return $rendered;\r\n    };\r\n})(window.jQuery);\r\n\r\n/*** To-do: Move to the Field class as a method **/\r\n\r\n(function( $ ){\r\n    $.fn.TokenSelector = function( fieldTokens ){\r\n        return this.each( function(){\r\n            let $this = $(this);\r\n\r\n            let settings = {\r\n                noResults: UncannyAutomator.i18n.noResults,\r\n                responsive: {\r\n                    margin: 30, // min space the dropdown and the limit of the viewport\r\n                },\r\n            };\r\n\r\n            let fieldElementType = $this.hasClass( 'form-input' ) ? 'input' : 'textarea';\r\n\r\n            // Define CSS classes\r\n            settings.classes = {};\r\n\r\n            switch ( fieldElementType ){\r\n                case 'input':\r\n                    settings.classes.tokenReady  = 'form-input--token-ready';\r\n                    settings.classes.field       = 'form-element__input';\r\n                    settings.classes.hiddenField = 'form-element__input--hidden';\r\n                    break;\r\n\r\n                case 'textarea':\r\n                    settings.classes.tokenReady  = 'form-textarea--token-ready';\r\n                    settings.classes.field       = 'form-element__textarea';\r\n                    settings.classes.hiddenField = 'form-element__textarea--hidden';\r\n\r\n                    let $field = $this.find( 'textarea' );\r\n                    settings.isTinyMCEinstance   = $field.data( 'supportstinymce' );\r\n                    settings.TinyMCEinstanceID   = $field.prop( 'id' );\r\n                    break;\r\n            }\r\n\r\n            // Init\r\n            if ( ! $this.hasClass( settings.classes.tokenReady ) ){\r\n\r\n                let itemType = $this.find( '.' + settings.classes.field ).data( 'item_type' );\r\n\r\n                let tokens = {\r\n                    list: fieldTokens,\r\n\r\n                    getTokenList: function(){\r\n                        return this.list;\r\n                    },\r\n\r\n                    hasTokens: function(){\r\n                        let list = this.list;\r\n                        return ! $.isEmptyObject( list );\r\n                    }\r\n                }\r\n\r\n                let tokensList = tokens.getTokenList();\r\n\r\n                if ( tokens.hasTokens() ){\r\n                    let render = {\r\n                        config: {\r\n                            inputHeight: 35,\r\n                        },\r\n\r\n                        init: function(){\r\n                            this.createElement();\r\n                        },\r\n\r\n                        createElement: function(){\r\n                            let mainFormElement = $this,\r\n                                input = mainFormElement.find( '.' + settings.classes.field );\r\n\r\n                            let fieldType = input.data( 'type' );\r\n                            /* Dropdown section */\r\n\r\n                            let formDropdown = mainFormElement.find( '.form-variable__dropdown' ),\r\n                                formDropdownContainer = $( '<div/>', { 'class': 'form-variable__dropdown-container' }),\r\n                                formDropdownSearch = $( '<div/>', { 'class': 'form-variable__search' }),\r\n                                formDropdownSearchInput = $( '<input/>', {\r\n                                \t'class': 'form-variable__search-input', 'placeholder': UncannyAutomator.i18n.tokens.search\r\n                                });\r\n\r\n                            formDropdownSearch.append( formDropdownSearchInput );\r\n\r\n                            // Token groups\r\n\r\n                            let formGroups = $('<div/>', { 'class': 'form-variable__groups' });\r\n\r\n                            $.each( tokensList, function( tokenGroupID, tokenGroup ){\r\n                                let groupContainer = $('<div/>', { 'class': 'form-variable__group' });\r\n\r\n                                /* Group - header */\r\n\r\n                                let groupSource = $('<div/>', { 'class': 'form-variable__group-source' }),\r\n                                    groupIcon = $('<div/>', { 'class': 'form-variable-group-source__icon' }),\r\n                                    groupName = $('<div/>', { 'class': 'form-variable-group-source__description' }),\r\n                                    groupToggle = $('<div/>', { 'class': 'form-variable-group-source__toggle' }),\r\n                                    groupToggleIcon = $('<span/>', { 'class': 'form-variable-group-source__toggle-icon' });\r\n\r\n                                // Create the variable where we're going to save the icon\r\n                                let $tokenIcon;\r\n\r\n                                if ( isDefined( UncannyAutomator.integrations[ tokenGroup.integrationId ] ) ){\r\n                                     // Search for an icon\r\n                                    let integration = UncannyAutomator.integrations[ tokenGroup.integrationId ];\r\n\r\n\t\t\t\t\t\t\t\t\t// Check if it has a svg image\r\n\t\t\t\t\t\t\t\t\tif ( isDefined( integration.icon_svg ) ){\r\n\t\t\t\t\t\t\t\t\t\t$tokenIcon = $( `<img src=\"${ integration.icon_svg }\" alt=\"${ integration.name }\">` );\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// Check if it has a png image\r\n\t\t\t\t\t\t\t\t\telse if ( isDefined( integration.icon_16 ) && isDefined( integration.icon_32 ) ){\r\n\t\t\t\t\t\t\t\t\t\t$tokenIcon = $( `<img src=\"${ integration.icon_16 }\" srcset=\"${ vsprintf( '%s 1x, %s 2x', [ integration.icon_16, integration.icon_32 ]) }\" alt=\"${ integration.name }\">` );\r\n\t\t\t\t\t\t\t\t\t}\r\n                                }\r\n                                else {\r\n                                    // Use default icon\r\n                                    $tokenIcon = $('<i/>', { 'class': 'uo-icon ' + tokenGroup.icon });\r\n                                }\r\n\r\n                                groupIcon.append( $tokenIcon );\r\n\r\n                                // Name\r\n                                groupName.append( tokenGroup.name );\r\n\r\n                                // Toggle\r\n                                groupToggle.append( groupToggleIcon );\r\n\r\n                                // Append everything to main container\r\n                                groupSource.append( groupIcon );\r\n                                groupSource.append( groupName );\r\n                                groupSource.append( groupToggle );\r\n\r\n                                /* Tokens */\r\n                                let tokenGroups = $('<span/>', { 'class': 'form-variable__group-children' });\r\n\r\n                                $.each( tokenGroup.tokens, function( individualTokenID, individualToken ){\r\n                                    let tokenItem = $('<div/>', {\r\n                                    \t'class':      'form-variable__group-item',\r\n                                    \t'data-token': '{{' + individualToken.id + '}}',\r\n                                    \t'data-type':  individualToken.type });\r\n\r\n                                    tokenItem.html( individualToken.name );\r\n                                    tokenGroups.append( tokenItem );\r\n                                });\r\n\r\n                                groupContainer.append( groupSource );\r\n                                groupContainer.append( tokenGroups );\r\n\r\n                                formGroups.append( groupContainer );\r\n                            });\r\n\r\n                            let noResults = $( '<div/>', { 'class': 'form-variable__group-item-no-results form-variable__group-item-no-results--hide' } );\r\n                            noResults.text( settings.noResults );\r\n                            formGroups.append( noResults );\r\n\r\n                            // Add containers to main dropdown container\r\n                            formDropdownContainer.append( formDropdownSearch );\r\n                            formDropdownContainer.append( formGroups );\r\n                            formDropdown.append( formDropdownContainer );\r\n\r\n                            mainFormElement.addClass( settings.classes.tokenReady );\r\n                        },\r\n\r\n                        getPosition: function(){\r\n                            let usefulElements = {\r\n                                window: $(window)\r\n                            }\r\n\r\n                            let space = {\r\n                                above: elements.container.offset().top - usefulElements.window.scrollTop(),\r\n                                below: usefulElements.window.height() - ( elements.container.offset().top - usefulElements.window.scrollTop() ) - this.config.inputHeight,\r\n                            }\r\n\r\n                            elements.dropdown.container_relative.addClass('uo-realsize');\r\n                            let dropDownHeight = elements.dropdown.container_relative.height() + 75; // + 75px to show at least 1 option\r\n                            elements.dropdown.container_relative.removeClass('uo-realsize');\r\n\r\n                            // Show dropdown always below for textareas\r\n                            if ( fieldElementType == 'textarea' ){\r\n                                space.hasSpaceBelow = true;\r\n                            }\r\n                            else {\r\n                                space.hasSpaceBelow = space.below >= dropDownHeight;\r\n                            }\r\n\r\n                            return space;\r\n                        },\r\n\r\n                        setDirection: function(){\r\n                            let position = this.getPosition();\r\n\r\n                            // Reset before adding another class\r\n\r\n                            elements.container.removeClass( 'form-variable--above form-variable--below' );\r\n\r\n                            // Decide\r\n\r\n                            if ( position.below > position.above || position.hasSpaceBelow ){\r\n                                // Let's show it below\r\n                                elements.container.addClass( 'form-variable--below' );\r\n                                status.position = 'below';\r\n                            }\r\n                            else {\r\n                                // Let's show it above\r\n                                elements.container.addClass( 'form-variable--above' );\r\n                                status.position = 'above';\r\n                            }\r\n                        },\r\n\r\n                        setScroll: function(){\r\n                            if ( status.open ){\r\n                                let maxHeight = this.getPosition()[ status.position ] - this.config.inputHeight - settings.responsive.margin;\r\n                                elements.dropdown.options.container.css({ 'max-height' : maxHeight + 'px' });\r\n                            }\r\n                        },\r\n\r\n                        addToken: function( token ){\r\n                        \tlet cursorPosition \t  = elements.input.get( 0 ).selectionStart,\r\n                        \t\tnewCursorPosition = cursorPosition + token.length;\r\n\r\n                            if ( settings.isTinyMCEinstance ){\r\n                                // TinyMCE\r\n                                let instance = tinymce.get( settings.TinyMCEinstanceID );\r\n\r\n                                if ( isDefined( instance ) ){\r\n                                \t// Remove possible spaces from token\r\n                                \ttoken = removeSpaces( token );\r\n\r\n                                    // Check if \"Text\" view is selected\r\n                                    if ( elements.input.is( ':visible' ) ){\r\n                                        // Get content\r\n                                        let currentValue = elements.input.val(),\r\n                                        \tnewValue \t = currentValue.substr( 0, cursorPosition ) + token + currentValue.substr( cursorPosition );\r\n\r\n                                        // Set new value and focus\r\n\t\t                                elements.input.val( newValue ).focus();\r\n\r\n\t\t                                // Trigger input event\r\n\t\t                                elements.input.trigger( 'input' );\r\n\r\n\t\t                                // Set position of the cursor\r\n\t\t                                elements.input.get( 0 ).setSelectionRange( newCursorPosition, newCursorPosition );\r\n                                    }\r\n                                    else {\r\n                                    \t// Insert token\r\n                                    \tinstance.execCommand( 'mceInsertContent', false, token );\r\n                                    }\r\n                                }\r\n                            }\r\n                            else {\r\n                                // A normal HTML form element\r\n                                let currentValue \t  = elements.input.val(),\r\n                                \tnewValue \t \t  = currentValue.substr( 0, cursorPosition ) + token + currentValue.substr( cursorPosition );\r\n\r\n                                // Set new value and focus\r\n                                elements.input.val( newValue ).focus();\r\n\r\n                                // Trigger input event\r\n                                elements.input.trigger( 'input' );\r\n\r\n                                // Set position of the cursor\r\n                                elements.input.get( 0 ).setSelectionRange( newCursorPosition, newCursorPosition );\r\n                            }\r\n\r\n                            this.hideDropdown();\r\n                            this.focusInput();\r\n                        },\r\n\r\n                        resetDropdown: function(){\r\n                            elements.dropdown.options.groups.removeClass( 'form-variable__group--hide form-variable__group--open' );\r\n                            elements.dropdown.options.groups.removeClass( 'form-variable__group--open' );\r\n                            elements.dropdown.options.items.removeClass( 'form-variable__group-item--hide' );\r\n                            elements.dropdown.options.no_results.addClass( 'form-variable__group-item-no-results--hide' );\r\n                        },\r\n\r\n                        hideDropdown: function(){\r\n                            elements.container.removeClass( 'form-variable--open' );\r\n\r\n                            // Save status\r\n                            status.open = false;\r\n\r\n                            // Rest input value and trigger 'input' event\r\n                            elements.dropdown.search_input.val('').trigger('input');\r\n                        },\r\n\r\n                        focusInput: function(){\r\n                            elements.input.focus();\r\n                        },\r\n                    }\r\n\r\n                    let status = {\r\n                        open: false,\r\n                        position: null\r\n                    }\r\n\r\n                    let bind = {\r\n                        init: function(){\r\n                            this.toggles();\r\n                            this.insert_tokens();\r\n                            this.search();\r\n                            this.resize();\r\n                            this.mirrorContent();\r\n                        },\r\n\r\n                        toggles: function(){\r\n                            /* Main dropdown */\r\n                            elements.dropdown.button.on( 'click', () => {\r\n                                elements.container.toggleClass( 'form-variable--open' );\r\n\r\n                                // Get and save status\r\n                                status.open = elements.container.hasClass( 'form-variable--open' );\r\n\r\n                                // If the user tried to opened it, bind click outside\r\n                                if ( status.open ){\r\n                                \t// Listen clicks outside\r\n                                \tthis.bindClicksOutside();\r\n                                }\r\n                                else {\r\n                                \t// Otherwise, remove the listener\r\n                            \t\t$( document ).off( 'mouseup.uap-token-selector-click-outside' );\r\n                                }\r\n\r\n                                // Rest input value and trigger 'input' event\r\n                                elements.dropdown.search_input.val('').trigger('input');\r\n\r\n                                // Focus search\r\n                                elements.dropdown.search_input.focus();\r\n\r\n                                // Decide position\r\n                                render.setDirection();\r\n\r\n                                // Set scroll\r\n                                render.setScroll();\r\n                            });\r\n\r\n                            /* Each group */\r\n                            elements.dropdown.options.groups_title.on( 'click', function(){\r\n                                let $this = $(this),\r\n                                    group = $this.closest('.form-variable__group');\r\n\r\n                                group.toggleClass( 'form-variable__group--open' );\r\n                            });\r\n                        },\r\n\r\n                        bindClicksOutside: function(){\r\n                        \t// Bind clicks outside\r\n                        \t// Add event listener to listen clicks outside\r\n\t                        $( document ).on( 'mouseup.uap-token-selector-click-outside', function( event ){\r\n\t                            // Set the targetted container\r\n\t                            let container = elements.container;\r\n\r\n\t                            if ( ! container.is( event.target ) && container.has( event.target ).length === 0 ){\r\n\t                                // Hide bubble\r\n\t                                elements.container.removeClass( 'form-variable--open' );\r\n\r\n\t\t                            // Save status\r\n\t\t                            status.open = false;\r\n\r\n\t\t                            // Rest input value and trigger 'input' event\r\n\t\t                            elements.dropdown.search_input.val('').trigger('input');\r\n\t                            }\r\n\t                        });\r\n                        },\r\n\r\n                        resize: function(){\r\n                            $(window).resize( function(){\r\n                                render.setScroll();\r\n                            });\r\n                        },\r\n\r\n                        insert_tokens: function(){\r\n                            /* Insert tokens */\r\n\r\n                            elements.dropdown.options.items.on( 'click', function(){\r\n                                let $this = $(this),\r\n                                    token = $this.data('token');\r\n\r\n                                render.addToken( token );\r\n                            });\r\n                        },\r\n\r\n                        search: function(){\r\n                            elements.dropdown.search_input.on( 'input', function(){\r\n                                let $this = $(this),\r\n                                    value = $this.val();\r\n\r\n                                if ( value != '' ){\r\n                                    // Search\r\n\r\n                                    // Prepare string. Remove spaces and convert all characters to lowercase\r\n                                    value = value.toLowerCase().replace(/\\s/g, '');\r\n\r\n                                    // Open all groups\r\n                                    elements.dropdown.options.groups.addClass( 'form-variable__group--open' );\r\n\r\n                                    // Hide all groups and options\r\n                                    elements.dropdown.options.groups.addClass( 'form-variable__group--hide' );\r\n                                    elements.dropdown.options.items.addClass( 'form-variable__group-item--hide' );\r\n\r\n                                    // Hide \"No Results\" container\r\n                                    elements.dropdown.options.no_results.addClass( 'form-variable__group-item-no-results--hide' );\r\n\r\n                                    // Create variable to search if there were results\r\n                                    let hasResults = false;\r\n\r\n                                    // Search matches and show group if there is at least one result\r\n                                    elements.dropdown.options.items.each( function(){\r\n                                        let $this = $(this),\r\n                                            optionName = $this.text().toLowerCase().replace(/\\s/g, '');\r\n\r\n                                        if ( optionName.search( value ) !== -1 ){\r\n                                            // Match! show option and group\r\n\r\n                                            // Find group first\r\n                                            let group = $this.closest( '.form-variable__group' );\r\n\r\n                                            // Show group\r\n                                            group.removeClass( 'form-variable__group--hide' );\r\n\r\n                                            // Show option\r\n                                            $this.removeClass( 'form-variable__group-item--hide' );\r\n\r\n                                            // Change hasResults\r\n                                            hasResults = true;\r\n                                        }\r\n                                    });\r\n\r\n                                    // Check if there results, if not, then show no results container\r\n                                    if ( ! hasResults ){\r\n                                        elements.dropdown.options.no_results.removeClass( 'form-variable__group-item-no-results--hide' );\r\n                                    }\r\n                                }\r\n                                else {\r\n                                    // Reset\r\n                                    render.resetDropdown();\r\n                                }\r\n                            });\r\n                        },\r\n\r\n                        mirrorContent: function(){\r\n                            /*\r\n                            elements.input.on( 'input', function(){\r\n                                elements.input.val( elements.input.val() );\r\n                            });\r\n                            */\r\n                        }\r\n                    }\r\n\r\n                    render.init();\r\n\r\n                    let elements = {\r\n                        container:              $this.find( '.form-variable' ),\r\n                        input_area:             $this.find( '.form-variable__element' ),\r\n                        input:                  $this.find( '.' + settings.classes.field ),\r\n                        dropdown: {\r\n                            container:          $this.find( '.form-variable__dropdown' ),\r\n                            container_relative: $this.find( '.form-variable__dropdown-container' ),\r\n                            button:             $this.find( '.form-variable__toggle' ),\r\n                            search_input:       $this.find( '.form-variable__search-input' ),\r\n                            options: {\r\n                                container:      $this.find( '.form-variable__groups' ),\r\n                                groups:         $this.find( '.form-variable__group' ),\r\n                                groups_title:   $this.find( '.form-variable__group-source' ),\r\n                                items:          $this.find( '.form-variable__group-item' ),\r\n                                no_results:     $this.find( '.form-variable__group-item-no-results' ),\r\n                            },\r\n                        }\r\n                    }\r\n\r\n                    bind.init();\r\n                }\r\n                else {\r\n                    $this.find( '.form-variable__element' ).addClass( 'form-variable__element--empty' );\r\n                }\r\n            }\r\n\r\n            return this;\r\n        });\r\n    }\r\n}( jQuery ));\n\n\n// WEBPACK FOOTER //\n// ./src/components/Field.js","import {\r\n    itemsObject,\r\n    getDOMElements,\r\n    isEmpty,\r\n    isDefined,\r\n    vsprintf\r\n} from './Utilities.js';\r\nimport ItemCreatorIntegrations  from './ItemCreatorIntegrations.js';\r\nimport MetaboxNotice            from './MetaboxNotice.js';\r\nimport MetaboxItems             from './MetaboxItems.js';\r\nimport MetaboxFooter            from './MetaboxFooter.js';\r\n\r\nclass Triggers {\r\n    constructor(){\r\n        // Create console group\r\n        // console.group( 'Triggers' );\r\n\r\n        // Get and clear metabox\r\n        let metabox = getDOMElements( 'metabox', { type: 'trigger' });\r\n        metabox.empty();\r\n\r\n        // Get recipe triggers\r\n        let triggers = itemsObject( 'get', {\r\n            filter: {\r\n                itemType: 'trigger'\r\n            }\r\n        });\r\n\r\n        // Check if it has triggers\r\n        if ( ! isEmpty( triggers ) ){\r\n            // Render items\r\n            new MetaboxItems( 'trigger' );\r\n        }\r\n        else {\r\n            new ItemCreatorIntegrations( 'trigger' );\r\n        }\r\n\r\n        // Create metabox footer\r\n        new MetaboxFooter( 'trigger' );\r\n\r\n        // Close console group\r\n        // console.groupEnd();\r\n    }\r\n}\r\n\r\nexport default Triggers;\n\n\n// WEBPACK FOOTER //\n// ./src/components/Triggers.js","import {\r\n\titemsObject,\r\n\tisString,\r\n\tisEmpty,\r\n\tisDefined,\r\n\tinArray,\r\n\tgetTokens,\r\n\tgetDOMElements,\r\n\tgetFieldTypes,\r\n\trestCall,\r\n\tvsprintf\r\n} from './Utilities.js';\r\nimport Publish from './Publish.js';\r\n\r\n/**\r\n * Validate form using the global object UncannyAutomator.recipe, which contains\r\n * all the recipe items \r\n *\r\n * @since 0.3\r\n *\r\n * @return {object}\r\n * @return {boolean}  response.canSubmit - TRUE if the recipe is valid\r\n */\r\n\r\nexport function validateRecipe(){\r\n\t// Set response object\r\n\tlet response = {\r\n\t\tcanSubmit: UncannyAutomator.recipe.isValid\r\n\t}\r\n\t\r\n\t// Check if the recipe is not valid\r\n\tif ( ! UncannyAutomator.recipe.isValid ){\r\n\r\n\t\t// Enable error mode\r\n\t\t// UncannyAutomator.recipe.errorMode = true;\r\n\r\n\t\t// Iterate each item\r\n\t\t$.each( UncannyAutomator.recipe.items, function( itemID, itemData ){\r\n\r\n\t\t\t// Validate each item\r\n\t\t\tvalidateItem( itemID );\r\n\t\t});\r\n\t}\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Validate item using the itemID\r\n *\r\n * @since 0.4\r\n *\r\n * @param  {int} \t  itemID - ID of the item\r\n * @param  {object}   [$item] - jQuery object of the item. Necessary only if itemID is undefined\r\n *\r\n * @return {object}\r\n * @return {boolean}  response.isValid - TRUE if the item is valid\r\n */\r\n\r\nexport function validateItem( itemID, $item = null ){\r\n\t// Create response object\r\n\tlet response = {\r\n\t\tisValid: false\r\n\t}\r\n\r\n\t// Check if the itemID is defined\r\n\tif ( isDefined( itemID ) ){\r\n\t\t// Get item\r\n\t\tlet item = UncannyAutomator.recipe.items[ itemID ];\r\n\r\n\t\t// Check if the item exists, otherwise do nothing, isValid will be false (because of the default value)\r\n\t\tif ( ! item.isMissing && ! isEmpty( item ) ){\r\n\t\t\t// Save result\r\n\t\t\tresponse.isValid = item.isValid;\r\n\r\n\t\t\t// Check if this item is invalid\r\n\t\t\tif ( ! item.isValid ){\r\n\r\n\t\t\t\t// Get DOM element of the item\r\n\t\t\t\tlet itemElement = getDOMElements( 'item', {\r\n\t\t\t\t\tid: itemID\r\n\t\t\t\t}).item;\r\n\r\n\t\t\t\t// Add CSS class to it\r\n\t\t\t\titemElement.addClass( 'item--error' );\r\n\r\n\t\t\t\t// Iterate each group of fields\r\n\t\t\t\t$.each( item.options, function( optionsGroupID, optionsGroupData ){\r\n\r\n\t\t\t\t\t// Check if a group of fields is invalid\r\n\t\t\t\t\tif ( ! optionsGroupData.isValid ){\r\n\r\n\t\t\t\t\t\t// Get DOM elements of the container with all the fields\r\n\t\t\t\t\t\tlet optionsGroupElements = getDOMElements( 'optionGroup', {\r\n\t\t\t\t\t\t\titemID: \titemID,\r\n\t\t\t\t\t\t\tgroupID: \toptionsGroupID\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Add error classes\r\n\t\t\t\t\t\toptionsGroupElements.tokenInSentence.addClass( 'item-title__token--error item-title__token--error-shake' );\r\n\t\t\t\t\t\toptionsGroupElements.fieldsContainer.addClass( 'item-options__group--error' );\r\n\t\t\t\t\t\toptionsGroupElements.optionsContainer.addClass( 'item-options--error' );\r\n\r\n\t\t\t\t\t\t// Remove \"shake\" class from tokenInSentence so the element can shake if the user clicks again\r\n\t\t\t\t\t\tsetTimeout( function(){\r\n\t\t\t\t\t\t\toptionsGroupElements.tokenInSentence.removeClass( 'item-title__variable--error-shake' );\r\n\t\t\t\t\t\t}, 1000 );\r\n\r\n\t\t\t\t\t\t// Show errors in the UI for each invalid field\r\n\t\t\t\t\t\tif ( isDefined( optionsGroupElements.optionsContainer ) ){\r\n\r\n\t\t\t\t\t\t\t// Validate the form of the group of fields. Check validateItemFields comments for more information.\r\n\t\t\t\t\t\t\tvalidateItemFields( optionsGroupElements.optionsContainer );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\t// ID is not defined, the item doesn't have an ID yet\r\n\t\tresponse.isValid = false;\r\n\r\n\t\t// Check if $item is defined \r\n\t\tif ( ! isEmpty( $item ) ){\r\n\t\t\t\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.error( 'Neither itemID nor the $item are defined. One of them must be defined.' );\t\r\n\t\t}\r\n\t}\r\n\r\n\t// Return response\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Validate form using a DOM element that contains the fields\r\n * \r\n * @since 0.1\r\n *\r\n * @param {object}\t form - jQuery DOM element that contains the fields\r\n *\r\n * @return {object}\r\n * @return {boolean}  response.isValid - TRUE if the form is valid\r\n */\r\n\r\nexport function validateItemFields( form ){\r\n\t// Create response object\r\n\tlet response = {\r\n\t\tisValid: false\r\n\t}\r\n\r\n\t// Get all fields, input, textareas and selects\r\n\tlet fields = form.find( 'input.form-element__input, textarea.form-element__textarea, select.form-element__select, .form-checkbox input, .form-radio' );\r\n\r\n\t// Set the variable that will be used to decide if the form is valid or not\r\n\t// It's true by default, but it will changed to false if at least one field has an error\r\n\tlet isFormValid = true;\r\n\r\n\t// Go through all fields\r\n\tfields.each(function(){\r\n\t\t// Save $(this) jQuery element (from the each loop) in the field variable\r\n\t\t// form-element__input, form-element__textarea or form-element__select\r\n\t\tlet field = $( this );\r\n\r\n\t\t// Get field type\r\n\t\tlet fieldType = field.data( 'type' );\r\n\r\n\t\t// Define field data\r\n\t\tlet fieldData = {}\r\n\r\n\t\t// Check if it's a radio\r\n\t\tif ( field.hasClass( 'form-radio' ) ){\r\n\t\t\t// Overwrite field type\r\n\t\t\tfieldType = 'radio';\r\n\r\n\t\t\t// Get one of the radios\r\n\t\t\tlet radioInput     = field.find( 'input' ).first();\r\n\r\n\t\t\t// Get value of the selected radio (if there is any)\r\n\t\t\tlet selectedRadio  = field.find( 'input:checked' ),\r\n\t\t\t    radioValue     = selectedRadio.length > 0 ? selectedRadio.val() : '';\r\n\r\n\t\t\t// Create object with the data that will be used in the verification process\r\n\t\t\tfieldData = {\r\n\t\t\t\tfield_type: \t\t 'radio',\r\n\t\t\t\tvalue: \t\t\t\t radioValue,\r\n\t\t\t\tattributes: {\r\n\t\t\t\t\tsupportsTokens:  radioInput.data( 'supportstokens' ),\r\n\t\t\t\t\trequired: \t\t radioInput.data( 'required' ),\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Create object with the data that will be used in the verification process\r\n\t\t\tfieldData = {\r\n\t\t\t\tfield_type: \t\t field.data( 'type' ),\r\n\t\t\t\tvalue: \t\t\t\t field.val(),\r\n\t\t\t\tattributes: {\r\n\t\t\t\t\tsupportsTokens:  field.data( 'supportstokens' ),\r\n\t\t\t\t\trequired: \t\t field.data( 'required' ),\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check if it's a checkbox and overwrite the value\r\n\t\tif ( fieldData.field_type == 'checkbox' ){\r\n\t\t\tfieldData.value = field.is( ':checked' );\r\n\t\t}\r\n\r\n\t\t// Check if the field is required, the value is undefined but has a default value in the settings\r\n\t\t/*\r\n\t\tif ( fieldData.attributes.required && ! isDefined( fieldData.value ) && isDefined( fieldData.defaultValue ) ){\r\n\t\t\t// Set default value as value\r\n\t\t\tfieldData.value = fieldData.attributes.defaultValue;\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t// Validate form. Read validateField comments for more information\r\n\t\tlet fieldValidation = validateField( field, fieldData.field_type, fieldData.value, fieldData.attributes );\r\n\r\n\t\t// Check if the field is invalid\r\n\t\tif ( ! fieldValidation.isValid ){\r\n\t\t\tisFormValid = false;\r\n\r\n\t\t\t// Add error class to form container\r\n\t\t\tform.addClass( 'item-options--error' );\r\n\t\t}\r\n\t});\r\n\r\n\tresponse.isValid = isFormValid;\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Validates the value of a field.\r\n * Supports all field types\r\n *\r\n * Only supports one token. The object is prepared to support more than one, we only have to remove the if statement\r\n * that checks the number of tokens per string. This functionality will be change in another version\r\n *\r\n * @since 0.1\r\n *\r\n * @param {object} \t\tfield - jQuery object of the field used to add CSS classes. Use null if you just want to get the validation response\r\n * @param {string} \t\tfieldType - A valid field type\r\n * @param {string} \t\tvalue - The value of the field.\r\n * @param {object}   \tattributes - Object with some of the field attributes\r\n * @param {boolean} \tattributes.supportsTokens - TRUE if the field should support tokens\r\n * @param {boolean} \tattributes.required - TRUE if the field is required\r\n * @param {object} \t\t[customValidationFunction] Just in case you want to add a custom validation function. Must return an object with two properties { isValid: {boolean}, message: {string} }\r\n *\r\n * @return {object}\r\n * @return {boolean} \tresponse.isValid - TRUE if the field is valid\r\n * @return {string}  \tresponse.message - Message showing the reason the field is invalid\r\n */\r\n\r\nexport function validateField( field, fieldType, value, attributes = { supportsTokens: false, required: false }, customValidationFunction ){\r\n\t// Create response object\r\n\tlet response = {\r\n\t\tisValid: false,\r\n\t\tmessage: '',\r\n\t}\r\n\r\n\t// Define valid field types\r\n\tlet fieldTypes = getFieldTypes();\r\n\r\n\t// Set messages\r\n\tlet messages = {\r\n\t\tselect: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.select.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.select.invalid,\r\n\t\t},\r\n\t\ttext: {\r\n\t\t\tempty:   UncannyAutomator.i18n.validation.field.text.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.text.invalid,\r\n\t\t},\r\n\t\ttextarea: {\r\n\t\t\tempty:   UncannyAutomator.i18n.validation.field.textarea.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.textarea.invalid,\r\n\t\t},\r\n\t\tint: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.int.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.int.invalid,\r\n\t\t\tmultipleTokens: UncannyAutomator.i18n.validation.field.int.multipleTokens,\r\n\t\t},\r\n\t\tfloat: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.float.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.float.invalid,\r\n\t\t\tmultipleTokens: UncannyAutomator.i18n.validation.field.float.multipleTokens,\r\n\t\t},\r\n\t\temail: {\r\n\t\t\tempty:   UncannyAutomator.i18n.validation.field.email.empty,\r\n\t\t\tsingle:  {\r\n\t\t\t\tinvalid: UncannyAutomator.i18n.validation.field.email.single.invalid,\r\n\t\t\t\tmultipleTokens: UncannyAutomator.i18n.validation.field.email.single.multipleTokens,\r\n\t\t\t},\r\n\t\t\tmultiple: {\r\n\t\t\t\tinvalid: UncannyAutomator.i18n.validation.field.email.multiple.invalid,\r\n\t\t\t\tmultipleTokens: UncannyAutomator.i18n.validation.field.email.multiple.multipleTokens,\r\n\t\t\t}\t\r\n\t\t},\r\n\t\turl: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.url.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.url.invalid,\r\n\t\t},\r\n\t\tcheckbox: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.checkbox.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.checkbox.invalid,\r\n\t\t},\r\n\t\tradio: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.radio.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.radio.invalid,\r\n\t\t},\r\n\t\tinvalidType: UncannyAutomator.i18n.validation.field.invalidType,\r\n\t}\r\n\r\n\t// Check if it's a valid field type\r\n\tif ( inArray( fieldType, fieldTypes ) ){\r\n\t\t// Check if it's a checkbox and sanitaze the current value\r\n\t\tif ( fieldType == 'checkbox' && ! isEmpty( value ) ){\r\n\t\t\t// Check if the value is \"true\" or \"false\"\r\n\t\t\tif ( [ 'true', 'false' ].includes( value ) ){\r\n\t\t\t\t// Make it a boolean\r\n\t\t\t\tvalue = value == 'true' ? true : false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check if it's a required field and it's empty.\r\n\t\t// Show \"empty\" error\r\n\t\tif ( attributes.required && ( isEmpty( value ) || fieldType == 'checkbox' && value === false ) ){\r\n\t\t\tresponse.message = messages[ fieldType ].empty;\r\n\t\t}\r\n\t\t// Check if it isn't a required field and it's empty.\r\n\t\t// We don't have to validate it\r\n\t\telse if ( ! attributes.required && isEmpty( value ) ){\r\n\t\t\tresponse.isValid = true;\r\n\t\t}\r\n\t\t// The field has a value\r\n\t\telse if ( value != '' ){\r\n\t\t\t// This variable will be used multiple times in the following code. Let's define it here.\r\n\t\t\tlet tokensInString;\r\n\r\n\t\t\t// Check what's our field type.\r\n\t\t\tswitch ( fieldType ){\r\n\r\n\t\t\t\tcase 'select':\r\n\t\t\t\t\tresponse.isValid = true; \r\n\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'text':\r\n\t\t\t\tcase 'textarea':\r\n\t\t\t\t\tresponse.isValid = true;\r\n\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'int':\r\n\t\t\t\t\t// Regular expression to check if it's a valid int number\r\n\t\t\t\t\t// https://regex101.com/r/Gz3RvN/4\r\n\t\t\t\t\tlet int_regex = new RegExp(/^([+-]?[1-9]\\d*|0)$/gm);\r\n\r\n\t\t\t\t\t// Get tokens. Read getTokensFromString comments for more information\r\n\t\t\t\t\ttokensInString = getTokensFromString( value );\r\n\r\n\t\t\t\t\t// Create variable to simulate int (replace tokens)\r\n\t\t\t\t\tlet simulate_int;\r\n\r\n\t\t\t\t\t// Check if the string has tokens (and if it should support them)\r\n\t\t\t\t\tif ( attributes.supportsTokens && tokensInString.hasTokens ){\r\n\t\t\t\t\t\t// Check if the string has only one token. As we said before, this can be easily changed in future versions\r\n\t\t\t\t\t\tif ( tokensInString.tokens.length == 1 ){\r\n\t\t\t\t\t\t\t// Replace tokens in string with a dummy value. Read replaceTokensInString comments for more information\r\n\t\t\t\t\t\t\tsimulate_int = replaceTokensInString( value );\r\n\r\n\t\t\t\t\t\t\t// Perform regular expression test\r\n\t\t\t\t\t\t\tif ( int_regex.test( simulate_int ) ){\r\n\t\t\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t// Show \"invalid\" message\r\n\t\t\t\t\t\t\t\tresponse.message = messages.int.invalid;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// We only support one token for now. Show multiple tokens error.\r\n\t\t\t\t\t\t\tresponse.message = messages.int.multipleTokens;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Doesn't have tokens, so we only have to perform the regular expression test\r\n\t\t\t\t\t\tif ( int_regex.test( value ) ){\r\n\t\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// Show \"invalid\" message\r\n\t\t\t\t\t\t\tresponse.message = messages.int.invalid;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Custom validation. Check if it's valid, if it isn't then do nothing\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( response.isValid && isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value, simulate_int );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'float':\r\n\t\t\t\t\t// Regular expression to check if it's a valid float number\r\n\t\t\t\t\t// https://regex101.com/r/KDLmre/2/\r\n\t\t\t\t\tlet float_regex = new RegExp(/^[+-]?((\\d+(\\.|\\,)?\\d*)|(\\.\\d+))$/gm);\r\n\r\n\t\t\t\t\t// Get tokens. Read getTokensFromString comments for more information\r\n\t\t\t\t\ttokensInString = getTokensFromString( value );\r\n\r\n\t\t\t\t\t// Create variable to simulate the float (replace tokens)\r\n\t\t\t\t\tlet simulate_float;\r\n\r\n\t\t\t\t\t// Check if the string has tokens (and if it should support them)\r\n\t\t\t\t\tif ( attributes.supportsTokens && tokensInString.hasTokens ){\r\n\t\t\t\t\t\t// Check if the string has only one token. As we said before, this can be easily changed in future versions\r\n\t\t\t\t\t\tif ( tokensInString.tokens.length == 1 ){\r\n\t\t\t\t\t\t\t// Replace tokens in string with a dummy value. Read replaceTokensInString comments for more information\r\n\t\t\t\t\t\t\tsimulate_float = replaceTokensInString( value );\r\n\r\n\t\t\t\t\t\t\t// Perform regular expression test\r\n\t\t\t\t\t\t\tif ( float_regex.test( simulate_float ) ){\r\n\t\t\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t// Show \"invalid\" message\r\n\t\t\t\t\t\t\t\tresponse.message = messages.float.invalid;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// We only support one token for now. Show multiple tokens error.\r\n\t\t\t\t\t\t\tresponse.message = messages.float.multipleTokens;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Doesn't have tokens, so we only have to perform the regular expression test\r\n\t\t\t\t\t\tif ( float_regex.test( value ) ){\r\n\t\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// Show \"invalid\" message\r\n\t\t\t\t\t\t\tresponse.message = messages.float.invalid;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Custom validation. Check if it's valid, if it isn't then do nothing\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( response.isValid && isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value, simulate_float );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'email':\r\n\t\t\t\t\t// Regular expression to check if it's a valid email address\r\n\t\t\t\t\t// https://regex101.com/r/ThUWEz/1/\r\n\t\t\t\t\tlet email_regex = new RegExp(/^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/);\r\n\r\n\t\t\t\t\t// Create array with all the emails we have to validate\r\n\t\t\t\t\t// We're going to check if the user is trying to validate more than one searching for a comma in the input value\r\n\t\t\t\t\t// In that case, we're going to split the value and get an array with emails, otherwise we're going to create an array with one element: the input value\r\n\t\t\t\t\t// Doing that we can use the same code for both cases\r\n\t\t\t\t\tlet emails = [];\r\n\r\n\t\t\t\t\t// Check if the user wants to validate multiple emails\r\n\t\t\t\t\tif ( value.includes( ',' ) ){\r\n\t\t\t\t\t\temails = value.split( ',' );\r\n\r\n\t\t\t\t\t\t// Remove whitespace from both sides of each email, just in case the user wrote \", \" or \" ,\" instead of \",\"\r\n\t\t\t\t\t\t$.each( emails, function( index, email ){\r\n\t\t\t\t\t\t\temails[ index ] = email.trim();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Add value, but remove whitespace from both sides before\r\n\t\t\t\t\t\temails.push( value.trim() );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get tokens. Read getTokensFromString comments for more information\r\n\t\t\t\t\ttokensInString = getTokensFromString( value );\r\n\r\n\t\t\t\t\t// Create variable to simulate the email (replace tokens)\r\n\t\t\t\t\tlet simulate_email;\r\n\t\t\t\t\t\r\n\t\t\t\t\t// We're going to use this variable to validate all the emails in a loop. TRUE by default, FALSE if at least one of them fails.\r\n\t\t\t\t\tlet allEmailsAreValid = true;\r\n\r\n\t\t\t\t\t// Create variable used to know if there is more than one email\r\n\t\t\t\t\tlet hasMultipleEmails = emails.length > 1;\r\n\r\n\t\t\t\t\t// Check if the string has tokens\r\n\t\t\t\t\tif ( attributes.supportsTokens && tokensInString.hasTokens ){\r\n\t\t\t\t\t\t// Create variable to check if the error was due to multiple variables\r\n\t\t\t\t\t\tlet hasMultipleVariables = false;\r\n\r\n\t\t\t\t\t\t// Iterate each email\r\n\t\t\t\t\t\t$.each( emails, function( index, email ){\r\n\t\t\t\t\t\t\t// Get tokens from this specific email\r\n\t\t\t\t\t\t\ttokensInString = getTokensFromString( email );\r\n\r\n\t\t\t\t\t\t\t// Check if the string has only one token. As we said before, this can be easily changed in future versions\r\n\t\t\t\t\t\t\tif ( tokensInString.tokens.length <= 1 ){\r\n\t\t\t\t\t\t\t\t// Replace tokens in string with a dummy value. Read replaceTokensInString comments for more information\r\n\t\t\t\t\t\t\t\tsimulate_email = replaceTokensInString( email );\r\n\r\n\t\t\t\t\t\t\t\t// Perform regular expression test\r\n\t\t\t\t\t\t\t\tif ( ! email_regex.test( simulate_email ) ){\r\n\t\t\t\t\t\t\t\t\t// Do this field invalid\r\n\t\t\t\t\t\t\t\t\tallEmailsAreValid = false;\r\n\r\n\t\t\t\t\t\t\t\t\t// Return false, we don't have to continue checking\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t// Change value of hasMultipleVariables. We're going to use this to show a \"Multiple Tokens\" error\r\n\t\t\t\t\t\t\t\thasMultipleVariables = true;\r\n\r\n\t\t\t\t\t\t\t\t// Return false, we don't have to continue checking\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Check result of iteration\r\n\t\t\t\t\t\tif ( allEmailsAreValid && ! hasMultipleVariables ){\r\n\t\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tif ( hasMultipleVariables ){\r\n\t\t\t\t\t\t\t\t// We only support one token for now. Show multiple tokens error.\r\n\t\t\t\t\t\t\t\tif ( hasMultipleEmails ){\r\n\t\t\t\t\t\t\t\t\tresponse.message = messages.email.multiple.multipleTokens;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tresponse.message = messages.email.single.multipleTokens;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t// Show \"invalid\" message\r\n\t\t\t\t\t\t\t\tif ( hasMultipleEmails ){\r\n\t\t\t\t\t\t\t\t\tresponse.message = messages.email.multiple.invalid;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tresponse.message = messages.email.single.invalid;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Doesn't have tokens, so we only have to perform the regular expression test in each email\r\n\t\t\t\t\t\t$.each( emails, function( index, email ){\r\n\t\t\t\t\t\t\t// Do regex\r\n\t\t\t\t\t\t\tif ( ! email_regex.test( email ) ){\r\n\t\t\t\t\t\t\t\t// If one is valid, all are invalid\r\n\t\t\t\t\t\t\t\tallEmailsAreValid = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Check result of iteration\r\n\t\t\t\t\t\tif ( allEmailsAreValid ){\r\n\t\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// Show \"invalid\" message\r\n\t\t\t\t\t\t\tif ( hasMultipleEmails ){\r\n\t\t\t\t\t\t\t\tresponse.message = messages.email.multiple.invalid;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tresponse.message = messages.email.single.invalid;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Custom validation. Check if it's valid, if it isn't then do nothing\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( response.isValid && isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value, simulate_email );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'url':\r\n\t\t\t\t\t// This will try to return a valid URL, but can fail, so we have to verify. Read parseURL comments for more information\r\n\t\t\t\t\tlet validateURL = parseURL( value, attributes );\r\n\r\n\t\t\t\t\t// Check if the URL is valid\r\n\t\t\t\t\tif ( validateURL.isValid ){\r\n\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Show \"invalid\" message\r\n\t\t\t\t\t\tresponse.message = messages.invalidType;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Custom validation. Check if it's valid, if it isn't then do nothing\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( response.isValid && isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value, validateURL.simulatedURL );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\tresponse.isValid = true;\r\n\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'radio':\r\n\t\t\t\t\tresponse.isValid = true;\r\n\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t// The field type doesn't match\r\n\t\t\t\t\tresponse.isValid = false;\r\n\t\t\t\t\tresponse.message = '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tresponse.message = messages[ 'invalidType' ];\r\n\t}\r\n\r\n\t// Add CSS classes to elements showing or hiding the error state\r\n\t// .form-element will have form-element--success or form-element--error classes\r\n\t// The message will be shown in the .form-element__error element\r\n\tif ( ! isEmpty( field ) ){\r\n\t\tlet $container = field.closest( '.form-element' );\r\n\t\tlet $error_container = $container.find( '.form-element__error' );\r\n\r\n\t\tif ( ! response.isValid ){\r\n\t\t\t$container.removeClass( 'form-element--success' );\r\n\t\t\t$container.addClass( 'form-element--error' );\r\n\t\t}\r\n\t\telse {\r\n\t\t\t$container.removeClass( 'form-element--error' );\r\n\t\t\t$container.addClass( 'form-element--success' );\r\n\t\t}\r\n\r\n\t\tif ( response.message != '' ){\r\n\t\t\t$error_container.addClass( 'form-element__error--show' );\r\n\t\t\t$error_container.text( response.message );\r\n\t\t}\r\n\t\telse {\r\n\t\t\t$error_container.removeClass( 'form-element__error--show' );\r\n\t\t\t$error_container.text('');\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Get all the valid tokens from a string.\r\n * It compares the tokens in the string with the valid tokens in the system and only returns the valid ones.\r\n * Ex: \"Lorem ipsum {{valid_token}} dolor {{invalid_token}}\" returns tokens = [ 'valid_token' ]\r\n *\r\n * @since 0.1\r\n *\r\n * @param  {string} \tstring - A normal string with tokens (or not, response.tokens will return an empty array, that's all)\r\n *\r\n * @return {object}\r\n * @return {boolean} \tresponse.hasTokens - TRUE if there is at least one token\r\n * @return {array} \t\tresponse.tokens - Array with all the tokens on the string\r\n */\r\n\r\nexport function getTokensFromString( string ){\r\n\t// Create response object\r\n\tlet response = {\r\n\t\thasTokens: false,\r\n\t\ttokens: [],\r\n\t};\r\n\r\n\t// Regex to find text between double curly brackets\r\n\t// https://regex101.com/r/TecqPq/1\r\n\tlet regex = new RegExp(/\\{\\{(.*?)\\}\\}/gm);\r\n\t\r\n\t// Get all valid tokens. Read getTokens comments for more information\r\n\tlet allTokens = getTokens();\r\n\r\n\t// Check if the string attribute is defined\r\n\tif ( isDefined( string ) ){\r\n\t\t// Check if the string attribute is empty, in that case just ignore it\r\n\t\tif ( ! isEmpty( string ) ){\r\n\t\t\t// Check if the token is a string, if not, convert it\r\n\t\t\tif ( ! isString( string ) ){\r\n\t\t\t\tstring = string.toString();\r\n\t\t\t}\r\n\r\n\t\t\t// Create array that will store the tokens\r\n\t\t\tlet tokens = [];\r\n\r\n\t\t\t// Perform the regex check.\r\n\t\t\tlet match;\r\n\t\t\twhile ( ( match = regex.exec( string ) ) !== null ){\r\n\t\t\t\tlet matchedToken = match[ 1 ];\r\n\r\n\t\t\t\t// Check if the token is defined in the main tokens object, if it's is then it's a valid token and we have to add it to the tokens array\r\n\t\t\t\t$.each( allTokens, ( index, tokenGroup ) => {\r\n\t\t\t\t\t$.each( tokenGroup.tokens, ( index, token ) => {\r\n\t\t\t\t\t\tif ( matchedToken == token.id ){\r\n\t\t\t\t\t\t\ttokens.push( token );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tresponse.tokens = tokens;\r\n\r\n\t\t\t// Check if the string has at least one token\r\n\t\t\tif ( response.tokens.length > 0 ){\r\n\t\t\t\tresponse.hasTokens = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\t// Show error in the console\r\n\t\tconsole.error( 'Undefined string attribute' );\r\n\t}\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Replace tokens in a string with dummy valid values to check if it's valid.\r\n * This is a simple way to validate if strings like {{site_url}} is a valid URL.\r\n * There is going to be another validation in the backend before doing actions\r\n * Ex: {{site_url}}/relative_path gets converted to https://example.com/relative_path\r\n *\r\n * @since 0.1\r\n *\r\n * @param  {string} string - A normal string with tokens (or not, the returned string will be the same, that's all)\r\n *\r\n * @return {string}\tThe new string with dummy data\r\n */\r\n\r\nexport function replaceTokensInString( string ){\r\n\t// Create variable that will hold the new string\r\n\t// The default value is the original string. We are going to check if the string has tokens,\r\n\t// and if it doesn't then we just return the same original string\r\n\tlet output = string;\r\n\r\n\t// Get tokens. Read getTokensFromString comments for more information\r\n\tlet tokensInString = getTokensFromString( string );\r\n\r\n\t// Check if this string has tokens\r\n\tif ( tokensInString.hasTokens ){\r\n\r\n\t\t// Iterate through each token\r\n\t\t$.each( tokensInString.tokens, function( index, token ){\r\n\t\t\t// Remember that each token has a token group id and a token id\r\n\t\t\t// For example, in {{WORDPRESS_1:order_id}} WORDPRESS_1 is the token group id and order_id is the token id\r\n\t\t\t// We have the token group id and the token id in different object properties, and we need to create the original (complete) token string again\r\n\r\n\t\t\t// Escape regex characters\r\n\t\t\tlet regexCondition = token.id.replace( /[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&' );\r\n\r\n\t\t\t// Create tokenCode variable, this will store the first part (token group id)\r\n\t\t\tregexCondition = vsprintf( '{{%s}}', [ regexCondition ] );\r\n\r\n\t\t\t// Create regular expression to find all appearances of the token in the string\r\n\t\t\t// https://regex101.com/r/AWKmKp/1\r\n\t\t\tlet regex = new RegExp( regexCondition, 'g' );\r\n\r\n\t\t\t// Use regex to replace all appaerences with a dummy value\r\n\t\t\toutput = output.replace( regex, function( full_match, group ){\r\n\t\t\t\t// Get dummy value using the fieldType. Read getExampleValueByFieldType comments for more information\r\n\r\n\t\t\t\treturn getExampleValueByFieldType( token.type );\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\treturn output;\r\n}\r\n\r\n/**\r\n * Get a dummy value given a fieldType\r\n * This function is useful for validation functions. We don't know in the recipe creating process if a token will store a correct value,\r\n * but we can use the token type to check if an email, url, int, float or other field type values are valid when they include a token.\r\n * For example, using this function we can know that {{site_url}}/profile/?user_id={{user_id}} is a valid url\r\n * \r\n * @since 0.1\r\n * \r\n * @param {string} \tfieldType - A valid field type\r\n *\r\n * @return {string} A valid dummy value for that field type\r\n */\r\n\r\nexport function getExampleValueByFieldType( fieldType ){\r\n\tlet value = '';\r\n\r\n\tswitch( fieldType ){\r\n\r\n\t\tcase 'select':\r\n\t\t\tvalue = 'option';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'text':\r\n\t\t\tvalue = 'lorem-ipsum';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'textarea':\r\n\t\t\tvalue = '<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum finibus eros nunc, et posuere libero posuere a. Nam viverra mattis finibus. Aenean purus lorem, mollis vel ullamcorper ac</p>';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'int':\r\n\t\t\tvalue = 1;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'float':\r\n\t\t\tvalue = 1.1;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'url':\r\n\t\t\tvalue = 'https://example.com';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'email':\r\n\t\t\tvalue = 'example@example.com';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'checkbox':\r\n\t\t\tvalue = true;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'radio':\r\n\t\t\tvalue = 'option';\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn value;\r\n}\r\n\r\n/**\r\n * Convert an invalid url into a valid one.\r\n * This function checks if the url is valid, if it is then it returns the url without modifying it, but if it is not then adds\r\n * the {{site_url}} before the string. It also checks if the string starts with / or not to recognize relative paths\r\n * Examples:\r\n * string \t\t\t\t=> {{site_url}}/string\r\n * /string \t\t\t\t=> {{site_url}}/string\r\n * https://google.com \t=> https://google.com\r\n * {{non_url_token}} \t=> {{site_url}}/{{non_url_token}}\r\n * /?id={{id}} \t\t\t=> {{site_url}}/?id={{id}}\r\n * \r\n * @since 0.1\r\n *\r\n * @param {string} \t\turl - The url\r\n * @param {object} \t\tattributes - URL attributes\r\n * @param {boolean} \tattributes.supportsTokens - TRUE if the URL should support tokens\r\n *\r\n * @return {object}\r\n * @return {boolean} \tresponse.changed - TRUE if the returned URL is different from the original one\r\n * @return {boolean} \tresponse.isValid - TRUE if the URL is valid\r\n * @return {string} \tresponse.newURL - New valid URL. If the URL was already valid then it just have the original URL\r\n * @return {string} \tresponse.simulatedURL - Simulated URL\r\n */\r\n\r\nexport function parseURL( url, attributes = { supportsTokens: false } ){\r\n\t// Create response object\r\n\tlet response = {\r\n\t\tchanged: false,\r\n\t\tisValid: false,\r\n\t\tnewURL: null,\r\n\t\tsimulatedURL: null\r\n\t}\r\n\r\n\t// Replace all spaces with %20\r\n\turl = url.replace( / /g, '%20' );\r\n\r\n\t// Create regular expression to be used to check if an URL is valid\r\n\t// https://regex101.com/r/0TFlPM/1/\r\n\tlet regexURL = new RegExp( \"^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?\" );\r\n\r\n\t// Get tokens. Read getTokensFromString comments for more information\r\n\tlet tokensInValue = getTokensFromString( url );\r\n\r\n\t// Create variable that will store the new URL. The default value is the original URL because we're going to compare\r\n\t// this variable with the \"url\" variable. If both are the same then we know that the original value wasn't modified and it was already valid\r\n\tlet newURL = url;\r\n\r\n\t// Check if it supports tokens and has tokens\r\n\tif ( attributes.supportsTokens && tokensInValue.hasTokens ){\r\n\t\t// Replace tokens in string with dummy values. Read replaceTokensInString comments for more information\r\n\t\tlet simulate_url = replaceTokensInString( url );\r\n\t\tresponse.simulatedURL = simulate_url;\r\n\r\n\t\t// Check if it's a valid URL\r\n\t\tif ( regexURL.test( simulate_url ) ){\r\n\t\t\tresponse.isValid = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// It's not valid, so now we have to create a valid one\r\n\t\t\t// Check if it starts with /\r\n\t\t\tif ( url[0] == '/' ){\r\n\t\t\t\t// In that case we only have to prepend the site URL to it\r\n\t\t\t\tnewURL = UncannyAutomator.siteURL + url;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// If it doesn't start with / then add it\r\n\t\t\t\tnewURL = UncannyAutomator.siteURL + '/' + url;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it's a valid URL now\r\n\t\t\tif ( regexURL.test( newURL ) ){\r\n\t\t\t\tresponse.isValid = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\t// URL without tokens, check if it's a valid\r\n\t\tif ( regexURL.test( url ) ){\r\n\t\t\tresponse.isValid = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// It's not valid, so now we have to create a valid one\r\n\t\t\t// Check if it starts with /\r\n\t\t\tif ( url[0] == '/' ){\r\n\t\t\t\t// In that case we only have to prepend the site URL to it\r\n\t\t\t\tnewURL = UncannyAutomator.siteURL + url;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// If it doesn't start with / then add it\r\n\t\t\t\tnewURL = UncannyAutomator.siteURL + '/' + url;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it's a valid URL now\r\n\t\t\tif ( regexURL.test( newURL ) ){\r\n\t\t\t\tresponse.isValid = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tresponse.newURL = newURL;\r\n\r\n\t// Check if the newURL it's the same as the original URL. \r\n\t// If both are the same then we know that the original value wasn't modified and it was already valid\r\n\tif ( response.newURL != url ){\r\n\t\tresponse.changed = true;\r\n\t}\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * jQuery plugin used to validate the URL fields while user writes a value (input event)\r\n * If the value is not valid then it shows to the user how the URL is going to be converted\r\n * in the plugin to make it valid. Check parseURL comments to learn more about how a URL can be changed.\r\n *\r\n * @since 0.1\r\n *\r\n * @return {object} jQuery Object\r\n */\r\n\r\n(function ($){\r\n\t$.fn.checkURL = function ( options ){\r\n\t\treturn this.each( function (){\r\n\t\t\t// Just for version 0.1 and 0.2 we are not fixing the URL, instead we're only checking if the original value is a valid URL\r\n\t\t\t// This has to be uncommented\r\n\r\n\t\t\t// Get current jQuery object\r\n\t\t\tlet $this = $(this);\r\n\r\n\t\t\t// Overwrite default settings with the ones given by the user\r\n\t\t\tlet settings = $.extend({\r\n\t\t\t\t'preURL': 'Final URL: '\r\n\t\t\t}, options);\r\n\r\n\t\t\t// Create object with useful jQuery objects\r\n\t\t\tlet elements = {\r\n\t\t\t\tcontainer:  $this,\r\n\t\t\t\tinput: \t\t$this.find( '.form-element__input' ),\r\n\t\t\t}\r\n\r\n\t\t\t// Get input attributes\r\n\t\t\tlet input_attributes = {\r\n\t\t\t\trequired: \t\t\telements.input.data( 'required' ),\r\n\t\t\t\tsupportsTokens: \telements.input.data( 'supportstokens' )\r\n\t\t\t}\r\n\r\n\t\t\t// Create DOM elements that will show the final URL to the user\r\n\t\t\tlet validationNotice = $( '<div/>', { 'class': 'form-input-url-notice' });\r\n\t\t\tlet validationNoticeHeader = $( '<div/>', { 'class': 'form-input-url-notice__header' });\r\n\t\t\tlet validationNoticeURL = $( '<div/>', { 'class': 'form-input-url-notice__url' });\r\n\r\n\t\t\tvalidationNoticeHeader.text( settings.preURL );\r\n\t\t\tvalidationNoticeHeader.appendTo( validationNotice );\r\n\t\t\tvalidationNoticeURL.appendTo( validationNotice );\r\n\t\t\tvalidationNotice.appendTo( elements.container );\r\n\r\n\t\t\t// Function to check if the URL is valid\r\n\t\t\tfunction validate( value ){\r\n\t\t\t\tlet url = parseURL( value, input_attributes );\r\n\r\n\t\t\t\t// If the URL is different then show the \"Final URL\" container\r\n\t\t\t\tif ( value != '' && url.isValid && url.changed ){\r\n\t\t\t\t\tvalidationNotice.addClass( 'form-input-url-notice--show' );\r\n\t\t\t\t\tvalidationNoticeURL.text( url.newURL );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvalidationNotice.removeClass( 'form-input-url-notice--show' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check on page load to verify if the default value will be converted\r\n\t\t\tif ( elements.input.val() != '' ){\r\n\t\t\t\tvalidate( elements.input.val() );\r\n\t\t\t}\r\n\r\n\t\t\t// Bind input event and invoke validate\r\n\t\t\telements.input.on( 'input', function(){\r\n\t\t\t\tvalidate( elements.input.val() );\r\n\t\t\t});\r\n\r\n\t\t\treturn this;\r\n\t\t});\r\n\t}\r\n}(jQuery));\r\n\r\n/**\r\n * Call checkURL jQuery plugin in each URL field\r\n *\r\n * @since 0.1\r\n *\r\n * @param {...objects} \tfields - jQuery objects \r\n *\r\n * @return {object} jQuery object\r\n */\r\n\r\nexport function initURLChecker( fields ){\r\n\tfields.checkURL();\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/components/Validation.js","import {\r\n    sortArrayOfObjectsAlphabetically,\r\n    addParametersToURL,\r\n    getDOMElements,\r\n    isDefined,\r\n    vsprintf\r\n} from './Utilities.js';\r\nimport ItemHeaderMenu          from './ItemHeaderMenu.js';\r\nimport itemCreatorTaskSelector from './itemCreatorTaskSelector.js';\r\n\r\nclass ItemCreatorIntegrations {\r\n    constructor( itemType, $currentItem ){\r\n        this.itemType     = itemType;\r\n        this.$currentItem = $currentItem;\r\n        this.integrations = [];\r\n\r\n        // Render DOM elements\r\n        this.render();\r\n    }\r\n\r\n    render(){\r\n        // Create container\r\n        let container = $( '<div/>', { 'class': 'item' });\r\n        this.$item    = container;\r\n\r\n        let header       = this.createHeader(),\r\n            itemContent  = $( '<div/>', {'class': 'item__content' }),\r\n            integrations = this.createIntegrations(),\r\n            discoverMore = this.createDiscoverMoreIntegrations();\r\n\r\n        container.append( header );\r\n\r\n        itemContent.append( integrations );\r\n        itemContent.append( discoverMore );\r\n\r\n        container.append( itemContent );\r\n\r\n        // Check if the $item is defined, in that case we're going to replace the item element instead of creating a new one\r\n        if ( isDefined( this.$currentItem ) ){\r\n            // Empty container\r\n            this.$currentItem.replaceWith( container );\r\n        }\r\n        else {\r\n            // Get last item and append next to it\r\n            let lastItem = getDOMElements( 'lastItem', {\r\n                type: this.itemType\r\n            });\r\n\r\n            if ( this.itemType == 'trigger' ){\r\n                // Check if there is a last item\r\n                if ( lastItem.length > 0 ){\r\n                    container.insertAfter( lastItem );\r\n                }\r\n                else {\r\n                    // Otherwise append the item to the metabox\r\n                    let metabox = getDOMElements( 'metabox', {\r\n                        type: this.itemType\r\n                    });\r\n\r\n                    metabox.append( container );\r\n                }\r\n            }\r\n            \r\n            if ( this.itemType == 'action' ){\r\n                // Check if there is at least one item\r\n                let items = getDOMElements( 'items', {\r\n                    type: this.itemType\r\n                });\r\n\r\n                if ( items.length > 0 ){\r\n                    // Insert after the last item\r\n                    container.insertAfter( lastItem );\r\n                }\r\n                else {\r\n                    // Otherwise replace the itemCreatorAdd container with the new container\r\n                    let metabox = getDOMElements( 'metabox', {\r\n                        type: this.itemType\r\n                    });\r\n                    let itemCreatorAdd = metabox.find( '.item.item--start' );\r\n                    itemCreatorAdd.replaceWith( container );\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    createHeader(){\r\n        let header  = $( '<div/>' );\r\n\r\n        let icon           = $( '<div/>', { 'class': 'item-icon' }),\r\n            titleContainer = $( '<div/>', { 'class': 'item-title clear' }),\r\n            titleContent   = $( '<div/>', { 'class': 'item-title__describe' }),\r\n            title          = $( '<div/>', { 'class': 'item-title__non-editable' }).text( UncannyAutomator.i18n.integration.select );\r\n\r\n        let actions        = new ItemHeaderMenu( this.itemType );\r\n        header.append( actions );\r\n\r\n        header.append( icon );\r\n\r\n        titleContent.append( title );\r\n        titleContainer.append( titleContent );\r\n        header.append( titleContainer );\r\n\r\n        return header;\r\n    }\r\n\r\n    createIntegrations(){\r\n        let container    = $( '<div/>', { 'class': 'item-integrations' });\r\n\r\n        // Get non empty integrations\r\n        this.filterByNonEmptyIntegrations( this.itemType );\r\n\r\n        // Order integrations alphabetically\r\n        this.sortIntegrationsAlphabetically();\r\n\r\n        // Iterate integrations\r\n        this.integrations.forEach(( integration ) => {\r\n            // Get integration ID\r\n            const integrationID = integration.id;\r\n\r\n            // Create integration element\r\n            let integrationElement = this.createIntegration( integrationID, integration );\r\n\r\n            // Bind\r\n            integrationElement.on( 'click', () => {\r\n                new itemCreatorTaskSelector( this.itemType, integrationID, this.$item );\r\n            });\r\n\r\n            // Append\r\n            container.append( integrationElement );\r\n        });\r\n\r\n        // Return jQuery element\r\n        return container;\r\n    }\r\n\r\n    createIntegration( integrationID, integration ){\r\n        let container   = $( '<div/>', { 'class': 'item-integration' }),\r\n            logo        = $( '<div/>', { 'class': 'item-integration__logo' }),\r\n            name        = $( '<div/>', { 'class': 'item-integration__name' });\r\n\r\n        // Check if it's a Pro only integration\r\n        if ( integration.isProOnly ){\r\n            // Add a class to identify it\r\n            container.addClass( 'item-integration--pro' );\r\n\r\n            // Add PRO tag\r\n            container.append( $( `\r\n                <div class=\"item-integration__badge\">${ UncannyAutomator.i18n.proOnly.pro }</div>\r\n            ` ) );\r\n        }\r\n        \r\n        // Check if the integration is not available\r\n        if ( ! integration.isAvailable ){\r\n            // Add a class to identify it\r\n            container.addClass( 'item-integration--unavailable' );\r\n\r\n            // Add tooltip\r\n            container.attr( 'uap-tooltip', vsprintf( UncannyAutomator.i18n.proOnly.requiresPro, [ UncannyAutomator.i18n.uncannyAutomatorPro ] ) );\r\n        }\r\n        else {\r\n            // Add a class to identify it\r\n            container.addClass( 'item-integration--available' );\r\n        }\r\n\r\n        // Create the variable where we're going to save the logo\r\n        let $logoImg;\r\n\r\n        // Check if it has a svg image\r\n        if ( isDefined( integration.icon_svg ) ){\r\n            $logoImg = $( `<img src=\"${ integration.icon_svg }\" alt=\"${ integration.name }\">` );\r\n        }\r\n        // Check if it has a png image\r\n        else if ( isDefined( integration.icon_32 ) && isDefined( integration.icon_64 ) ){\r\n            $logoImg = $( `<img src=\"${ integration.icon_32 }\" srcset=\"${ vsprintf( '%s 1x, %s 2x', [ integration.icon_32, integration.icon_64 ]) }\" alt=\"${ integration.name }\">` );\r\n        }\r\n\r\n        // TO-DO\r\n        // Improve UI/UX\r\n        // Set integration name\r\n        name.text( integration.name );\r\n\r\n        // Append\r\n        logo.append( $logoImg );\r\n        container.append( logo );\r\n        container.append( name );\r\n\r\n        // Return jQuery element\r\n        return container;\r\n    }\r\n\r\n    createDiscoverMoreIntegrations(){\r\n        return $( `\r\n            <div class=\"item-content__description\">\r\n                ${ UncannyAutomator.i18n.integration.discoverMore } <a href=\"${ addParametersToURL( 'https://automatorplugin.com/integrations/', {\r\n                        'utm_source':  'uncanny_automator',\r\n                        'utm_medium':  'select_an_integration',\r\n                        'utm_content': 'discover_more_integrations'\r\n                    }) }\" target=\"_blank\">${ UncannyAutomator.i18n.learnMore } <span class=\"uo-icon uo-icon--external-link-alt\"></span></a>\r\n            </div>\r\n        ` );\r\n    }\r\n\r\n    filterByNonEmptyIntegrations( itemType ){\r\n        // Check if it's a valid item type\r\n        if ( [ 'trigger', 'action' ].includes( itemType ) ){\r\n            // Iterate each integration\r\n            Object.entries( UncannyAutomator.integrations ).forEach(([ integrationID, integration ]) => {\r\n                // Evaluate if it has the requested items by item type\r\n                let hasItems = false;\r\n                // Also evaluate if it has available items\r\n                let isProOnly = false;\r\n                // Also evaluate if it has available items\r\n                let isAvailable = false;\r\n\r\n                if ( itemType == 'trigger' ){\r\n                    hasItems    = integration.items.triggers.hasTriggers;\r\n                    isAvailable = integration.items.triggers.hasAvailableItems;\r\n                    isProOnly   = integration.items.triggers.allItemsArePro;\r\n                }\r\n                else if ( itemType == 'action' ){\r\n                    hasItems    = integration.items.actions.hasActions;\r\n                    isAvailable = integration.items.actions.hasAvailableItems;\r\n                    isProOnly   = integration.items.actions.allItemsArePro;\r\n                }\r\n\r\n                // Check if it has the requested items by item type\r\n                if ( hasItems ){\r\n                    // Add integration to the list of integrations\r\n                    this.integrations.push( $.extend({}, integration, {\r\n                        id:          integrationID,\r\n                        isAvailable: isAvailable,\r\n                        isProOnly:   isProOnly\r\n                    }) );\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    sortIntegrationsAlphabetically(){\r\n        // Sort the array of integrations using the integration name\r\n        this.integrations = sortArrayOfObjectsAlphabetically( this.integrations, 'name' );\r\n    }\r\n}\r\n\r\nexport default ItemCreatorIntegrations;\n\n\n// WEBPACK FOOTER //\n// ./src/components/ItemCreatorIntegrations.js","import {\r\n    restCall,\r\n    getGlobalItem,\r\n    isDefined,\r\n    replaceCurlyBraces,\r\n    addParametersToURL\r\n} from './Utilities.js';\r\n\r\nimport Modal from './Modal.js';\r\n\r\nimport Triggers from './Triggers.js';\r\nimport Actions  from './Actions.js';\r\n\r\nclass ItemHeaderMenu {\r\n    /**\r\n     * Create item actions\r\n     *\r\n     * @since 0.5\r\n     *\r\n     * @return jQuery DOM element with the item actions\r\n     */\r\n\r\n    constructor( itemType, integrationID, itemCode, itemId ){\r\n        this.itemType      = itemType;\r\n        this.integrationID = integrationID;\r\n        this.itemCode      = itemCode;\r\n        this.itemId        = itemId;\r\n        this.item          = UncannyAutomator.recipe.items[ itemId ];\r\n\r\n        return this.createItemActions();\r\n    }\r\n\r\n    createItemActions(){\r\n        // Create elements\r\n        let container     = $( '<div/>', { 'class': 'item-actions' }),\r\n            btn           = $( '<div/>', { 'class': 'item-actions__btn' }),\r\n            btnIcon       = $( '<i/>', { 'class': 'uo-icon uo-icon--ellipsis-h-alt' }),\r\n            dropdown      = $( '<div/>', { 'class': 'item-actions__dropdown' }),\r\n            dropdownUl    = $( '<ul/>', { 'class': 'item-actions-dropdown__ul' });\r\n\r\n        btn.append( btnIcon );\r\n        container.append( btn );\r\n\r\n        // Delete\r\n        let deleteAction  = $( '<li/>', { 'class': 'item-actions-dropdown__action' }),\r\n            deleteText    = $( '<span/>' ).text( UncannyAutomator.i18n.delete );\r\n\r\n        deleteAction.append( deleteText );\r\n        dropdownUl.append( deleteAction );\r\n\r\n        // Support\r\n        if ( isDefined( this.itemType ) && isDefined( this.itemCode ) ) {\r\n            if ( ! isDefined( this.item) || isDefined( this.item ) && ! this.item.isMissing ){\r\n                let globalItemData = getGlobalItem( this.integrationID, this.itemType, this.itemCode );\r\n\r\n                if ( isDefined( globalItemData.support_link ) ){\r\n                    let supportAction = $( '<a/>', {\r\n                        'href':  addParametersToURL( globalItemData.support_link, {\r\n                            'utm_source':  'uncanny_automator',\r\n                            'utm_medium':  'action_menu',\r\n                            'utm_content': 'support_menu_link'\r\n                        }),\r\n                        'class': 'item-actions-dropdown__action',\r\n                        'target': '_blank'\r\n                    }),\r\n                        supportText   = $( '<span/>' ).text( UncannyAutomator.i18n.support );\r\n\r\n                    supportAction.append( supportText );\r\n                    dropdownUl.append( supportAction );\r\n                }\r\n            }\r\n        }\r\n\r\n        dropdown.append( dropdownUl );\r\n        container.append( dropdown );\r\n\r\n        // Listen clicks to the open button\r\n        btn.on( 'click', () => {\r\n            // Evaluate if it's open\r\n            const isOpen = container.hasClass( 'item-actions--open' );\r\n\r\n            // Check if it's not open\r\n            if ( ! isOpen ){\r\n                // Open the dropdown\r\n                container.addClass( 'item-actions--open' );\r\n\r\n                // Listen clicks outside the dropdown\r\n                $( document ).on( 'mouseup.uap-actions-click-outside', ( event ) => {\r\n                    if ( ! container.is( event.target ) && container.has( event.target ).length === 0 ){\r\n                        // Close dropdown\r\n                        container.removeClass( 'item-actions--open' );\r\n\r\n                        // Remove event listener to listen clicks outside the dropdown\r\n                        $( document ).off( 'mouseup.uap-actions-click-outside' );\r\n                    }\r\n                });           \r\n            }\r\n            else {\r\n                // Close dropdown\r\n                container.removeClass( 'item-actions--open' );\r\n\r\n                // Remove event listener to listen clicks outside the dropdown\r\n                $( document ).off( 'mouseup.uap-actions-click-outside' );\r\n            }\r\n        });\r\n\r\n        // Delete\r\n        deleteAction.on( 'click', () => {\r\n            if ( isDefined( this.itemId ) && UncannyAutomator.recipe.isLive && UncannyAutomator.recipe.items[ this.itemId ].isLive ){\r\n                // Hide dropdown with options\r\n                container.removeClass( 'item-actions--open' );\r\n\r\n                // Create modal box\r\n                // Read Modal.js comments for more information\r\n                let modal = new Modal({\r\n                    title:       UncannyAutomator.i18n.confirmationModal.title,\r\n                    warning:     replaceCurlyBraces( UncannyAutomator.i18n.confirmationModal.deleteWarning, '<strong>', '</strong>' ),\r\n                    buttons: {\r\n                        cancel:  UncannyAutomator.i18n.cancel,\r\n                        confirm: UncannyAutomator.i18n.confirm,\r\n                    }\r\n                });\r\n\r\n                modal.setEvents({\r\n                    afterSetEvents: () => {\r\n                        modal.show();\r\n                    },\r\n                    onConfirm: () => {\r\n                        let elements        = modal.getElements();\r\n                        let confirmButton   = elements.modal.box.buttons.confirm;\r\n\r\n                        // Add loading class to button\r\n                        confirmButton.addClass( 'uap-btn--loading' ).prop( 'disabled', true );\r\n\r\n                        // Do call and hide\r\n                        restCall( 'delete', {\r\n                            'ID': this.itemId\r\n                        }, () => {\r\n                            // Destroy modal\r\n                            modal.destroy();\r\n\r\n                            // Refresh UI\r\n                            if ( this.itemType == 'trigger' ){\r\n                                new Triggers();\r\n\r\n                                // Check if it's an anonymous recipe\r\n                                if ( UncannyAutomator.recipe.type == 'anonymous' ){\r\n                                    // Render the Actions metabox again\r\n                                    // We're doing this because we need to update the user selector\r\n                                    new Actions();\r\n                                }\r\n                            }\r\n                            \r\n                            if ( this.itemType == 'action' || this.itemType == 'closure' ){\r\n                                new Actions();\r\n                            }\r\n\r\n                            // Check if the recipe is still valid, if it isn't then make the recipe draft\r\n                            if ( ! UncannyAutomator.recipe.isValid ){\r\n                                UncannyAutomator.recipe.publish.statusToggle.setValue( false );\r\n                            }\r\n                        }, () => {\r\n                            // Destroy modal\r\n                            modal.destroy();\r\n\r\n                            console.log( '‼️ ERROR-TODO. Couldn\\'t delete the item' );\r\n\r\n                            // Refresh UI\r\n                            if ( this.itemType == 'trigger' ){\r\n                                new Triggers();\r\n                            }\r\n                            \r\n                            if ( this.itemType == 'action' || this.itemType == 'closure' ){\r\n                                new Actions();\r\n                            }\r\n                        });\r\n                    },\r\n                    afterHide: function(){\r\n                        modal.destroy();\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                // Delete without warning\r\n                if ( isDefined( this.itemId ) ){\r\n                    // Set loading to the \"delete\" option\r\n                    deleteAction.addClass( 'item-actions-dropdown__action--loading' );\r\n\r\n                    // Do the AJAX request to delete it\r\n                    restCall( 'delete', {\r\n                        'ID': this.itemId\r\n                    }, () => {\r\n                        // Reset UI\r\n                        if ( this.itemType == 'trigger' ){\r\n                            new Triggers();\r\n\r\n                            // Check if it's an anonymous recipe\r\n                            if ( UncannyAutomator.recipe.type == 'anonymous' ){\r\n                                // Render the Actions metabox again\r\n                                // We're doing this because we need to update the user selector\r\n                                new Actions();\r\n                            }\r\n                        }\r\n                        \r\n                        if ( this.itemType == 'action' || this.itemType == 'closure' ){\r\n                            new Actions();\r\n                        }\r\n                    }, () => {\r\n                        console.log( '‼️ ERROR-TODO. Couldn\\'t delete the item' );\r\n\r\n                        // Reset UI\r\n                        if ( this.itemType == 'trigger' ){\r\n                            new Triggers();\r\n                        }\r\n                        \r\n                        if ( this.itemType == 'action' || this.itemType == 'closure' ){\r\n                            new Actions();\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    // Reset UI\r\n                    if ( this.itemType == 'trigger' ){\r\n                        new Triggers();\r\n                    }\r\n                    \r\n                    if ( this.itemType == 'action' ){\r\n                        new Actions();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        return container;\r\n    }\r\n}\r\n\r\nexport default ItemHeaderMenu;\n\n\n// WEBPACK FOOTER //\n// ./src/components/ItemHeaderMenu.js","import {\r\n\tisEmpty,\r\n\tvsprintf,\r\n} from './Utilities.js';\r\n\r\nclass RecipeNotices {\r\n\tconstructor(){\r\n\t\t// Get main element\r\n\t\tthis.elements = {\r\n\t\t\tcontainer: $( '#uo-uap-notices' )\r\n\t\t}\r\n\r\n\t\t// Check if the container exists\r\n\t\t// If not, then create it\r\n\t\tif ( this.elements.container.length == 0 ){\r\n\t\t\tthis.createContainer();\r\n\t\t\tthis.elements.container = $( '#uo-uap-notices' );\r\n\t\t}\r\n\r\n\t\t// Empty the container\r\n\t\tthis.emptyContainer();\r\n\r\n\t\t// Create warning\r\n\t\tthis.createWarning();\r\n\r\n\t\t// Check if error mode is enabled\r\n\t\tif ( UncannyAutomator.recipe.errorMode ){\r\n\t\t\t// Create error\r\n\t\t\tthis.createError();\r\n\t\t}\t\r\n\t}\r\n\r\n\temptyContainer(){\r\n\t\tthis.elements.container.empty();\r\n\t}\r\n\r\n\tcreateContainer(){\r\n\t\t/* Create notice containers */\r\n\t    let noticeContainer = $( '<div/>', { id: 'uo-uap-notices', class: 'uap' });\r\n\t    $( '#uap-publish-metabox' ).prepend( noticeContainer );\r\n\t}\r\n\r\n\tcreateError(){\r\n\t\tlet thisRecipeNotices = this;\r\n\r\n\t\t// Check if we have to create the notice\r\n\t\tif ( ! isEmpty( UncannyAutomator.recipe.message.error ) ){\r\n\t\t\t// Create error container\r\n\t\t\tlet notice = $( '<div/>', { class: 'uo-notice uo-notice--error' }).text( UncannyAutomator.recipe.message.error );\r\n\t\t\tthis.elements.container.append( notice );\r\n\t\t}\r\n\t}\r\n\r\n\tcreateWarning(){\r\n\t\tlet thisRecipeNotices = this;\r\n\r\n\t\t// Check if we have to create the notice\r\n\t\tif ( ! isEmpty( UncannyAutomator.recipe.message.warning ) ){\r\n\t\t\tlet notice = $( '<div/>', { class: 'uo-notice uo-notice--warning' }).text( UncannyAutomator.recipe.message.warning );\r\n\t\t\tthis.elements.container.append( notice );\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default RecipeNotices;\n\n\n// WEBPACK FOOTER //\n// ./src/components/RecipeNotices.js","import {\r\n\tisDefined\r\n} from './Utilities.js';\r\n\r\n/**\r\n * Create a new modal box\r\n *\r\n * @since 0.4\r\n */\r\n\r\nclass Modal {\r\n\t/*\r\n\t * Construct method\r\n\t *\r\n\t * @since 0.4\r\n\t *\r\n\t * @param  {object} settings\r\n\t * @param  {object} [settings.content]\r\n\t * @param  {string} [settings.content.title] - Title of the metabox\r\n\t * @param  {string} [settings.content.warning] - Content of warning in the metabox\r\n\t * @param  {object} [settings.content.buttons]\r\n\t * @param  {string} [settings.content.buttons.cancel] - Text of the cancel button\r\n\t * @param  {string} [settings.content.buttons.confirm] - Text of the confirm button\r\n\t * @param  {object} [settings.events.onConfirm] - Function that is going to be invoked when the user press the confirm button\r\n\t * @param  {object} [settings.events.onCancel] - Function that is going to be invoked when the user press the cancel button\r\n\t * @param  {object} [settings.events.onShow] - Function that is going to be invoked when the modal box is shown\r\n\t * @param  {object} [settings.events.onHide] - Function that is going to be invoked when the modal box is hidden\r\n\t * \r\n\t * @return {object} - The modal box object\r\n\t */\r\n\r\n\tconstructor( content, config = {} ){\r\n\t\t// Create elements object\r\n\t\tthis.elements = {\r\n\t\t\tcontainer: null,\r\n\t\t\tautomatorContainer: null, // ( .uap ) This DIV is only created to avoid conflicts with other plugins\r\n\t\t\tmodal: {\r\n\t\t\t\tcontainer: null,\r\n\t\t\t\tbox: {\r\n\t\t\t\t\tcontainer: null,\r\n\t\t\t\t\ttitle: null,\r\n\t\t\t\t\twarning: null,\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tcontainer: null,\r\n\t\t\t\t\t\tcancel: null,\r\n\t\t\t\t\t\tconfirm: null\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Set container\r\n\t\tthis.elements.container = $( 'body' );\r\n\r\n\t\t// Set isVisible property\r\n\t\tthis.isVisible = false;\r\n\r\n\t\t// Define default configuration\r\n\t\tthis.config = $.extend( true, {\r\n\t\t\tfadeDuration: 150,\r\n\t\t}, config );\r\n\r\n\t\t// Save modal box content. Add default values\r\n\t\tthis.content = $.extend( {}, {\r\n\t\t\tbuttons: {\r\n\t\t\t\tcancel: UncannyAutomator.i18n.cancel,\r\n\t\t\t}\r\n\t\t}, content );\r\n\r\n\t\t// Create new modal box\r\n\t\tthis.create();\r\n\r\n\t\t// Return object\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/*\r\n\t * Create modal box DOM elements\r\n\t *\r\n\t * @since 0.4\r\n\t */\r\n\r\n\tcreate(){\r\n\t\tlet automatorContainer = $( '<div/>', { 'class': 'uap' });\r\n\t\tlet modal = $( '<div/>', { 'class': 'modal' });\r\n\t\tlet modalBox = $( '<div/>', { 'class': 'modal__box' });\r\n\r\n\t\t// Check if the user wants a different modal size than the default size\r\n\t\tif ( isDefined( this.config.size ) && [ 'small', 'medium', 'large' ].includes( this.config.size ) ){\r\n\t\t\t// Add the correct size class\r\n\t\t\tmodal.addClass( `modal--${ this.config.size }` );\r\n\t\t}\r\n\r\n\t\t// Save elements\r\n\t\tthis.elements.automatorContainer = automatorContainer;\r\n\t\tthis.elements.modal.container = modal;\r\n\t\tthis.elements.modal.box.container = modalBox;\r\n\r\n\t\t// Set title\r\n\t\tif ( isDefined( this.content.title ) ){\r\n\t\t\tlet modalTitle = $( '<div/>', { 'class': 'modal__title' }).html( this.content.title );\r\n\t\t\tmodalBox.append( modalTitle );\r\n\r\n\t\t\t// Save element\r\n\t\t\tthis.elements.modal.box.title = modalTitle;\r\n\t\t}\r\n\r\n\t\t// Set warning\r\n\t\tif ( isDefined( this.content.content ) ){\r\n\t\t\tlet modalContent = $( '<div/>', { 'class': 'modal__content' }).html( this.content.content );\r\n\t\t\tmodalBox.append( modalContent );\r\n\r\n\t\t\t// Save element\r\n\t\t\tthis.elements.modal.box.content = modalContent;\r\n\t\t}\r\n\r\n\t\t// Set warning\r\n\t\tif ( isDefined( this.content.warning ) ){\r\n\t\t\tlet modalWarning = $( '<div/>', { 'class': 'modal__warning' }).html( this.content.warning );\r\n\t\t\tmodalBox.append( modalWarning );\r\n\r\n\t\t\t// Save element\r\n\t\t\tthis.elements.modal.box.warning = modalWarning;\r\n\t\t}\r\n\r\n\t\t// Set buttons\r\n\t\tlet modalButtons = $( '<div/>', { 'class': 'modal__buttons' });\r\n\t\tlet cancelButton = $( '<button/>', { 'class': 'uap-btn uap-btn--secondary' }).html( this.content.buttons.cancel );\r\n\t\tmodalButtons.append( cancelButton );\r\n\r\n\t\t// Save elements\r\n\t\tthis.elements.modal.box.buttons.container = modalButtons;\r\n\t\tthis.elements.modal.box.buttons.cancel = cancelButton;\r\n\r\n\t\tif ( isDefined( this.content.buttons.confirm ) ){\r\n\t\t\tlet confirmButton = $( '<button/>', { 'class': 'uap-btn uap-btn--primary' }).html( this.content.buttons.confirm );\r\n\t\t\tmodalButtons.append( confirmButton );\r\n\r\n\t\t\t// Save element\r\n\t\t\tthis.elements.modal.box.buttons.confirm = confirmButton;\r\n\t\t}\r\n\r\n\t\tmodalBox.append( modalButtons );\r\n\r\n\t\t// Append elements and add to the container\r\n\t\tmodal.append( modalBox );\r\n\t\tautomatorContainer.append( modal );\r\n\t\tthis.elements.container.append( automatorContainer );\r\n\r\n\t\t// Add open class to the html tag\r\n\t\t$( 'html' ).addClass( 'automator-modal-open' );\r\n\r\n\t\t// Bind\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\t/*\r\n\t * Define events\r\n\t *\r\n\t * @since 0.4\r\n\t */\r\n\r\n\tsetEvents( events ){\r\n\t\tlet emptyFunction = () => {};\r\n\r\n\t\t// Define events\r\n\t\tthis.events = {\r\n\t\t\tafterSetEvents: isDefined( events.afterSetEvents ) \t? events.afterSetEvents : emptyFunction,\r\n\t\t\tafterShow: \t\tisDefined( events.afterShow ) \t \t? events.afterShow \t\t: emptyFunction,\r\n\t\t\tafterHide: \t\tisDefined( events.afterHide ) \t \t? events.afterHide \t\t: emptyFunction,\r\n\t\t\tonConfirm:  \tisDefined( events.onConfirm ) \t\t? events.onConfirm \t\t: emptyFunction,\r\n\t\t\tonCancel:   \tisDefined( events.onCancel )  \t\t? events.onCancel \t\t: emptyFunction,\r\n\t\t};\r\n\r\n\t\tif ( ! isDefined( events.onCancel ) ){\r\n\t\t\tthis.events.onCancel = () => {\r\n\t\t\t\t// Default onCancel function\r\n\t\t\t\t// Hide modal box\r\n\t\t\t\tthis.hide();\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Fire afterSetEvents event\r\n\t\tthis.events.afterSetEvents();\r\n\t}\r\n\r\n\t/*\r\n\t * Remove all the DOM elements\r\n\t *\r\n\t * @since 0.4\r\n\t */\r\n\r\n\tdestroy(){\r\n\t\tlet thisModal = this;\r\n\r\n\t\t// Unbind everything\r\n\t\tthis.unbind();\r\n\r\n\t\t// Check if it's visible\r\n\t\tif ( this.isVisible ){\r\n\t\t\t// We have to hide it first\r\n\t\t\tthis.hide(function(){\r\n\t\t\t\tthisModal.elements.automatorContainer.remove();\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthisModal.elements.automatorContainer.remove();\r\n\t\t}\r\n\r\n\t\t// Remove modal open class from the html tag\r\n\t\t$( 'html' ).removeClass( 'automator-modal-open' );\r\n\t}\r\n\r\n\t/*\r\n\t * Bind the clicks on the buttons\r\n\t *\r\n\t * @since 0.4\r\n\t */\r\n\r\n\tbind(){\r\n\t\tlet thisModal = this;\r\n\r\n\t\t// Bind cancel button\r\n\t\tthis.elements.modal.box.buttons.cancel.on( 'click', function(){\r\n\t\t\tthisModal.events.onCancel();\r\n\t\t});\r\n\r\n\t\t// Bind confirm button\r\n\t\tthis.elements.modal.box.buttons.confirm.on( 'click', function(){\r\n\t\t\tthisModal.events.onConfirm();\r\n\t\t});\r\n\t}\r\n\r\n\t/*\r\n\t * Unbind all events\r\n\t *\r\n\t * @since 0.4\r\n\t */\r\n\r\n\tunbind(){\r\n\t\tthis.elements.modal.box.buttons.cancel.unbind( 'click' );\r\n\t\tthis.elements.modal.box.buttons.confirm.unbind( 'click' );\r\n\t}\r\n\r\n\t/*\r\n\t * Show modal box\r\n\t *\r\n\t * @since 0.4\r\n\t *\r\n\t * @param {object} [callback] - Custom function that it's going to be invoked after we show the modal box\r\n\t */\r\n\r\n\tshow( callback = null ){\r\n\t\tlet thisModal = this;\r\n\r\n\t\t// Set callback\r\n\t\tlet event = function(){};\r\n\r\n\t\tif ( isDefined( callback ) ){\r\n\t\t\tevent = callback;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tevent = this.events.afterShow;\r\n\t\t}\r\n\r\n\t\tcallback = event;\r\n\r\n\t\t// Change is visible status\r\n\t\tthis.isVisible = true;\r\n\r\n\t\t// Fade in\r\n\t\tthis.elements.modal.container.fadeIn( thisModal.config.fadeDuration, callback );\r\n\t}\r\n\r\n\t/*\r\n\t * Show modal box\r\n\t *\r\n\t * @since 0.4\r\n\t *\r\n\t * @param {object} [callback] - Custom function that it's going to be invoked after we hide the modal box\r\n\t */\r\n\r\n\thide( callback = null ){\r\n\t\tlet thisModal = this;\r\n\r\n\t\t// Set callback\r\n\t\tlet event = function(){};\r\n\r\n\t\tif ( isDefined( callback ) ){\r\n\t\t\tevent = callback;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tevent = this.events.afterHide;\r\n\t\t}\r\n\r\n\t\tcallback = event;\r\n\r\n\t\t// Change is visible status\r\n\t\tthis.isVisible = false;\r\n\r\n\t\t// Fade out\r\n\t\tthis.elements.modal.container.fadeOut( thisModal.config.fadeDuration, callback );\r\n\r\n\t\t// Remove modal open class from the html tag\r\n\t\t$( 'html' ).removeClass( 'automator-modal-open' );\r\n\t}\r\n\r\n\t/*\r\n\t * Returns all the DOM elements\r\n\t *\r\n\t * @since 0.4\r\n\t *\r\n\t * @return {object} All the DOM elements created by this class\r\n\t */\r\n\r\n\tgetElements(){\r\n\t\treturn this.elements;\r\n\t}\r\n}\r\n\r\nexport default Modal;\n\n\n// WEBPACK FOOTER //\n// ./src/components/Modal.js","import {\r\n    isEmpty,\r\n    getDOMElements,\r\n    vsprintf,\r\n} from './Utilities.js';\r\n\r\nimport ItemHeaderMenu     from './ItemHeaderMenu.js';\r\nimport ItemHeaderIcon     from './ItemHeaderIcon.js';\r\nimport ItemHeaderTag      from './ItemHeaderTag.js';\r\nimport ItemHeaderSentence from './ItemHeaderSentence.js';\r\n\r\nclass MetaboxItems {\r\n    constructor( itemType ){\r\n        $.each( UncannyAutomator.recipe.items, ( itemId, item ) => {\r\n            if ( itemType == item.itemType ){\r\n                // Create item\r\n                let item = this.createItem( itemId );\r\n\r\n                // Append to the metabox\r\n                let metabox = getDOMElements( 'metabox', {\r\n                    type: itemType\r\n                });\r\n\r\n                metabox.append( item );\r\n            }\r\n        });\r\n    }\r\n\r\n    createItem( itemId ){\r\n        // Get item data\r\n        let item = UncannyAutomator.recipe.items[ itemId ];\r\n\r\n        // Create container\r\n        let container = $( '<div/>', {\r\n            'class':   'item',\r\n            'data-id': itemId\r\n        });\r\n\r\n        if ( item.isMissing ){\r\n            container.addClass( 'item--missing' );\r\n        }\r\n\r\n        // Replace tokens in the CSS\r\n        if ( ! isEmpty( item.inlineCss ) ){\r\n            item.inlineCss = item.inlineCss.replace( /{{item_id}}/g, itemId );\r\n\r\n            // Add inline inlineCss\r\n            container.prepend( item.inlineCss );\r\n        }\r\n\r\n        // Create header\r\n        let header = this.createHeader(\r\n            item.integrationCode,\r\n            item.itemType,\r\n            item.itemCode,\r\n            itemId,\r\n        );\r\n\r\n        let notice = this.createNotice( item );\r\n\r\n        container.append( header );\r\n        container.append( notice );\r\n\r\n        // Debug\r\n        // console.groupCollapsed( vsprintf( 'ID: %s', [ itemId ] ) );\r\n        // console.log( item );\r\n        // console.groupEnd();\r\n\r\n        return container;\r\n    }\r\n\r\n    /**\r\n     * Creates item header\r\n     * \r\n     * @since 0.5\r\n     *\r\n     * @param {string}    integrationCode - The integration code\r\n     * @param {string}    itemType - The item type: 'trigger', 'action' or 'closure'\r\n     * @param {string}    itemCode - The code of the item\r\n     * @param {int}       itemId - The ID of the item\r\n     */\r\n\r\n    createHeader( integrationCode, itemType, itemCode, itemId ){\r\n        let container = $( '<div/>' ),\r\n            title     = $( '<div/>', { 'class': 'item-title clear' });\r\n\r\n        // Get item data\r\n        let item = UncannyAutomator.recipe.items[ itemId ];\r\n\r\n        // If the item is missing remove the integrationCode\r\n        // We don't want to show the integration icon\r\n        if ( item.isMissing ){\r\n            integrationCode = null;\r\n        }\r\n\r\n        let actions = new ItemHeaderMenu( itemType, integrationCode, itemCode, itemId );\r\n        container.append( actions );\r\n\r\n        let icon    = new ItemHeaderIcon( integrationCode );\r\n        container.append( icon );\r\n\r\n        // Integration name for missing items\r\n        let integrationName = item.integrationName;\r\n        \r\n        let itemTag = new ItemHeaderTag( integrationCode, integrationName );\r\n        title.append( itemTag );\r\n\r\n        let titleSentence = new ItemHeaderSentence( itemType, integrationCode, itemCode, itemId );\r\n        title.append( titleSentence );\r\n        container.append( title );\r\n\r\n        let itemContent = $( '<div/>', { 'class': 'item__content' });\r\n        container.append( itemContent );\r\n\r\n        return container;\r\n    }\r\n\r\n    /**\r\n     * Create item notice\r\n     *\r\n     * @since 0.6\r\n     *\r\n     */\r\n\r\n    createNotice( item ){\r\n        let container;\r\n\r\n        if ( item.isMissing ){\r\n            container = $( '<div/>', { 'class': 'item-notice' });\r\n            container.text( UncannyAutomator.i18n.itemMissing );\r\n        }\r\n\r\n        return container;\r\n    }\r\n}\r\n\r\nexport default MetaboxItems;\n\n\n// WEBPACK FOOTER //\n// ./src/components/MetaboxItems.js","import {\r\n\tvsprintf,\r\n\tisDefined\r\n} from './Utilities.js';\r\n\r\nclass ItemHeaderIcon {\r\n\tconstructor( integrationCode ){\r\n\t\tthis.integrationCode = integrationCode;\r\n\r\n\t\treturn this.createItemIcon();\r\n\t}\r\n\r\n\t/**\r\n     * Create item icon\r\n     *\r\n     * @since 0.5\r\n     *\r\n     * @return {object}   HTML with the item icon\r\n     */\r\n\r\n    createItemIcon(){\r\n    \tlet container   = $( '<div/>', { 'class': 'item-icon' });\r\n\r\n    \tif ( isDefined( UncannyAutomator.integrations[ this.integrationCode ] ) ){\r\n\t\t\t// Get integration by integrationCode\r\n\t        let integration = UncannyAutomator.integrations[ this.integrationCode ];\r\n\r\n\t        // Create the variable where we're going to save the icon\r\n\t        let $icon;\r\n\r\n\t\t\t// Check if it has a svg image\r\n\t\t\tif ( isDefined( integration.icon_svg ) ){\r\n\t\t\t\t$icon = $( `<img src=\"${ integration.icon_svg }\" alt=\"${ integration.name }\">` );\r\n\t\t\t}\r\n\t\t\t// Check if it has a png image\r\n\t\t\telse if ( isDefined( integration.icon_32 ) && isDefined( integration.icon_64 ) ){\r\n\t\t\t\t$icon = $( `<img src=\"${ integration.icon_32 }\" srcset=\"${ vsprintf( '%s 1x, %s 2x', [ integration.icon_32, integration.icon_64 ]) }\" alt=\"${ integration.name }\">` );\r\n\t\t\t}\r\n\r\n\t        container.append( $icon );\r\n    \t} \r\n\r\n        // Return element\r\n        return container;\r\n    }\r\n}\r\n\r\nexport default ItemHeaderIcon;\n\n\n// WEBPACK FOOTER //\n// ./src/components/ItemHeaderIcon.js","import {\r\n    isDefined\r\n} from './Utilities.js';\r\n\r\nclass ItemHeaderTag {\r\n    constructor( integrationId, integrationName = null ){\r\n        this.integrationId = integrationId;\r\n        this.integrationName = integrationName;\r\n\r\n        return this.createItemTag();\r\n    }\r\n\r\n    /**\r\n     * Create item tag with the name of the integration\r\n     *\r\n     * @since 0.5\r\n     * \r\n     * @param {string}    integrationCode - The integration code\r\n     *\r\n     * @return {object}   HTML with the item tag\r\n     */\r\n\r\n    createItemTag(){\r\n        // Get integration by integrationId\r\n        let integration = UncannyAutomator.integrations[ this.integrationId ];\r\n\r\n        // Create tag element and set the integraiton name\r\n        let container   = $( '<div/>', { 'class': 'item-title__integration clear' }),\r\n            tag         = $( '<div/>', { 'class': 'item-title__tag' });\r\n\r\n        if ( isDefined( integration ) ){\r\n            tag.text( integration.name );\r\n        }\r\n        else {\r\n            tag.text( this.integrationName );\r\n        }\r\n\r\n        container.append( tag );\r\n\r\n        // Return tag\r\n        return container;\r\n    }\r\n}\r\n\r\nexport default ItemHeaderTag;\n\n\n// WEBPACK FOOTER //\n// ./src/components/ItemHeaderTag.js","import {\r\n\taddParametersToURL,\r\n\titemsObject,\r\n\tisDefined,\r\n\tisEmpty,\r\n\tinArray,\r\n\tvsprintf,\r\n\trestCall,\r\n} from './Utilities.js';\r\n\r\nimport RecipeNotices from './RecipeNotices.js';\r\n\r\nimport Field from './Field.js';\r\n\r\nclass Publish {\r\n\r\n\tconstructor(){\r\n\t\t// Get metabox element\r\n\t\tthis.elements = {\r\n\t\t\tmetabox: $( '#uo-automator-publish-metabox' ),\r\n\t\t\ttimesPerUser: {\r\n\t\t\t\teditLink:\t\tnull,\r\n\t\t\t\thiddenBox: \t\tnull,\r\n\t\t\t\tsaveButton: \tnull,\r\n\t\t\t\tcancelButton: \tnull\r\n\t\t\t},\r\n\t\t\ttoggle: null\r\n\t\t}\r\n\r\n\t\t// Create new metabox\r\n\t\tthis.createMetabox();\r\n\t}\r\n\r\n\tcreateMetabox(){\r\n\t\tlet container          = $( '<div/>', { id: 'uap-publish-metabox' }),\r\n\t\t\tcontent            = $( '<div/>', { class: 'metabox__content' }),\r\n\t\t\tfooter             = $( '<div/>', { class: 'metabox__footer' });\r\n\r\n\t\t// Check if we have to add the times per user row\r\n\t\tif ( UncannyAutomator.recipe.type != 'anonymous' ){\r\n\t\t\t// Times per user row\r\n\t\t\tlet timesRow \t       = $( '<div/>', { class: 'publish-row' }),\r\n\t\t\t\ttimesRowVisible    = $( '<div/>', { class: 'publish-row__visible' }),\r\n\t\t\t\ttimesRowIconBox    = $( '<span/>', { class: 'publish-row__icon' }),\r\n\t\t\t\ttimesRowIcon       = $( '<i/>', { class: 'uo-icon uo-icon--sync-alt' }),\r\n\t\t\t\ttimesRowName       = $( '<span/>', { class: 'publish-row__name' }).text( UncannyAutomator.i18n.publish.timesPerUser );\r\n\r\n\t\t\t// Change value of numbers of times from -1 to empty\r\n\t\t\tUncannyAutomator.recipe.publish.timesPerUser = UncannyAutomator.recipe.publish.timesPerUser == -1 ? '' : UncannyAutomator.recipe.publish.timesPerUser;\r\n\t\t\tlet timesValue \t\t   = isEmpty( UncannyAutomator.recipe.publish.timesPerUser ) ? UncannyAutomator.i18n.publish.unlimited : UncannyAutomator.recipe.publish.timesPerUser; \r\n\r\n\t\t\tlet timesRowValue      = $( '<span/>', { class: 'publish-row__value' }).text( timesValue ),\r\n\t\t\t\ttimesRowEdit       = $( '<span/>', { class: 'publish-row__edit' }).text( UncannyAutomator.i18n.edit ),\r\n\t\t\t\ttimesRowHidden     = $( '<div/>', { class: 'publish-row__hidden' }),\r\n\t\t\t\ttimesRowHiddenBox  = $( '<div/>', { class: 'publish-row__settings' });\r\n\r\n\t\t\tthis.elements.timesPerUser.editLink  = timesRowEdit;\r\n\t\t\tthis.elements.timesPerUser.hiddenBox = timesRowHidden;\r\n\r\n\t\t\tlet timesRowField \t   = new Field( 'int', {\r\n\t\t\t\tcurrentValue: UncannyAutomator.recipe.publish.timesPerUser,\r\n\t\t\t\tdescription:  UncannyAutomator.i18n.publish.leaveEmpty,\r\n\t\t\t\tplaceholder:  UncannyAutomator.i18n.publish.unlimited,\r\n\t\t\t}, true, function( value, simulatedValue ){\r\n\t\t\t\t// Custom validation function\r\n\t\t\t\t// Create response object\r\n\t\t\t\tlet response = {\r\n\t\t\t\t\tisValid: false,\r\n\t\t\t\t\tmessage: ''\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if the number is 1 or bigger\r\n\t\t\t\tif ( value >= 1 ){\r\n\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tresponse.message = UncannyAutomator.i18n.publish.oneOrBigger\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Return response\r\n\t\t\t\treturn response;\r\n\t\t\t});\r\n\r\n\t\t\tthis.timesField \t   = timesRowField;\r\n\r\n\t\t\tlet timesRowButtons    = $( '<div/>', { class: 'publish-row__buttons' }),\r\n\t\t\t\ttimesRowSaveBtn    = $( '<div/>', { class: 'uap-btn uap-btn--primary' }).text( UncannyAutomator.i18n.save ),\r\n\t\t\t\ttimesRowCancelBtn  = $( '<div/>', { class: 'uap-btn uap-btn--secondary' }).text( UncannyAutomator.i18n.cancel );\r\n\r\n\t\t\tthis.elements.timesPerUser.saveButton   = timesRowSaveBtn;\r\n\t\t\tthis.elements.timesPerUser.cancelButton = timesRowCancelBtn;\r\n\r\n\t\t\ttimesRowButtons.append( timesRowSaveBtn );\r\n\t\t\ttimesRowButtons.append( timesRowCancelBtn );\r\n\r\n\t\t\ttimesRowHiddenBox.append( timesRowField.getFormElement() );\r\n\t\t\ttimesRowHiddenBox.append( timesRowButtons );\r\n\t\t\ttimesRowHidden.append( timesRowHiddenBox );\r\n\r\n\t\t\ttimesRowIconBox.append( timesRowIcon );\r\n\t\t\ttimesRowVisible.append( timesRowIconBox );\r\n\t\t\ttimesRowVisible.append( timesRowName );\r\n\t\t\ttimesRowVisible.append( timesRowValue );\r\n\t\t\ttimesRowVisible.append( timesRowEdit );\r\n\r\n\t\t\ttimesRow.append( timesRowVisible );\r\n\t\t\ttimesRow.append( timesRowHidden );\r\n\r\n\t\t\tcontent.append( timesRow );\r\n\t\t}\t\r\n\r\n\t\t// Recipe type\r\n\t\tlet recipeTypeRow        = $( '<div/>',  { class: 'publish-row' }),\r\n\t\t\trecipeTypeRowVisible = $( '<div/>',  { class: 'publish-row__visible' }),\r\n\t\t\trecipeTypeRowIconBox = $( '<span/>', { class: 'publish-row__icon' }),\r\n\t\t\trecipeTypeRowIcon    = $( '<i/>',    { class: 'uo-icon uo-icon--utensils' }),\r\n\t\t\trecipeTypeRowName    = $( '<span/>', { class: 'publish-row__name' }).text( UncannyAutomator.i18n.publish.recipeType ),\r\n\t\t\trecipeTypeRowValue   = $( '<span/>', { class: 'publish-row__value' }),\r\n\t\t\trecipeTypeLearnMore  = $( `\r\n\t\t\t\t<a href=\"${ addParametersToURL( 'https://automatorplugin.com/knowledge-base/creating-a-recipe/', {\r\n                        'utm_source':  'uncanny_automator',\r\n                        'utm_medium':  'publish_metabox',\r\n                        'utm_content': 'question_icon'\r\n                    }) }\" class=\"publish-row__learn-more\" target=\"_blank\"><span class=\"uo-icon uo-icon--question-circle\"></span></a>\r\n\t\t\t` );\r\n\r\n\t\tif ( UncannyAutomator.recipe.type == 'user' ){\r\n\t\t\trecipeTypeRowValue.text( UncannyAutomator.i18n.recipeType.userRecipeName );\r\n\t\t}\r\n\r\n\t\tif ( UncannyAutomator.recipe.type == 'anonymous' ){\r\n\t\t\trecipeTypeRowValue.text( UncannyAutomator.i18n.recipeType.anonymousRecipeName );\r\n\t\t}\r\n\r\n\t\trecipeTypeRowIconBox.append( recipeTypeRowIcon );\r\n\t\trecipeTypeRowVisible.append( recipeTypeRowIconBox );\r\n\t\trecipeTypeRowVisible.append( recipeTypeRowName );\r\n\t\trecipeTypeRowVisible.append( recipeTypeRowValue );\r\n\t\trecipeTypeRowVisible.append( recipeTypeLearnMore );\r\n\t\trecipeTypeRow.append( recipeTypeRowVisible );\r\n\r\n\t\tcontent.append( recipeTypeRow );\r\n\r\n\t\t// Created on row\r\n\t\tlet createdRow \t\t   = $( '<div/>', { class: 'publish-row' }),\r\n\t\t\tcreatedRowVisible  = $( '<div/>', { class: 'publish-row__visible' }),\r\n\t\t\tcreatedRowIconBox  = $( '<span/>', { class: 'publish-row__icon' }),\r\n\t\t\tcreatedRowIcon     = $( '<i/>', { class: 'uo-icon uo-icon--calendar-alt' }),\r\n\t\t\tcreatedRowName     = $( '<span/>', { class: 'publish-row__name' }).text( UncannyAutomator.i18n.publish.createdOn ),\r\n\t\t\tcreatedRowValue    = $( '<span/>', { class: 'publish-row__value' }).text( UncannyAutomator.recipe.publish.createdOn );\r\n\r\n\t\tcreatedRowIconBox.append( createdRowIcon );\r\n\t\tcreatedRowVisible.append( createdRowIconBox );\r\n\t\tcreatedRowVisible.append( createdRowName );\r\n\t\tcreatedRowVisible.append( createdRowValue );\r\n\t\tcreatedRow.append( createdRowVisible );\r\n\r\n\t\tcontent.append( createdRow );\r\n\r\n\t\t// Footer\r\n\r\n\t\tlet footerRow          = $( '<div/>', { class: 'publish-footer__row clear' }),\r\n\t\t\tfooterRowLeft      = $( '<div/>', { class: 'publish-footer__left' }),\r\n\t\t\tfooterMoveToDraft  = $( '<a/>', { class: 'publish-footer__move-to-draft', href: UncannyAutomator.recipe.publish.moveToTrash.replace( /&amp;/g, '&' ) }).text( UncannyAutomator.i18n.proOnly.moveToTrash ),\r\n\t\t\tfooterRowRight     = $( '<div/>', { class: 'publish-footer__right' });\r\n\r\n\t\tlet recipeStatusToggle = new Field( 'checkbox', {\r\n            color: 'gutenberg',\r\n            align: 'right',\r\n            toggle: {\r\n                on:  UncannyAutomator.i18n.status.liveRecipe,\r\n                off: UncannyAutomator.i18n.status.draftRecipe,\r\n            },\r\n            currentValue: UncannyAutomator.recipe.isLive\r\n\t\t});\r\n\r\n\t\t// Save toggle Field in main object\r\n\t\tUncannyAutomator.recipe.publish.statusToggle = recipeStatusToggle;\r\n\r\n\t\tlet recipeStatusToggleDOM = recipeStatusToggle.getFormElement();\r\n\t\tthis.recipeStatusToggle   = recipeStatusToggle;\r\n\r\n\t\tthis.elements.toggle   = recipeStatusToggleDOM;\r\n\r\n\t\tfooterRowLeft.append( footerMoveToDraft );\r\n\t\tfooterRowRight.append( recipeStatusToggleDOM );\r\n\t\tfooterRow.append( footerRowLeft );\r\n\t\tfooterRow.append( footerRowRight );\r\n\r\n\t\tfooter.append( footerRow );\r\n\r\n\t\t// Append main elements to the metabox\r\n\t\tcontainer.append( content );\r\n\t\tcontainer.append( footer );\r\n\r\n\t\t// Render metabox\r\n\t\tthis.elements.metabox.html( container );\r\n\r\n\t\t// Render errors\r\n\t\tnew RecipeNotices();\r\n\r\n\t\t// Bind\r\n\t\tthis.bind();\r\n\r\n\t\t// Validate status\r\n\t\tthis.validateStatus();\r\n\t}\r\n\r\n\tvalidateStatus(){\r\n\t\t// We're going to use this method to check if the recipe is live but it's invalid\r\n\t\tif ( UncannyAutomator.recipe.isLive && ! UncannyAutomator.recipe.isValid ){\r\n\t\t\t// Make Draft\r\n\t\t\tUncannyAutomator.recipe.publish.statusToggle.setValue( false );\r\n\t\t}\r\n\t}\r\n\r\n\tbind(){\r\n\t\t// Check if we have to add the event listeners to the \"times per user\" row\r\n\t\tif ( UncannyAutomator.recipe.type != 'anonymous' ){\r\n\t\t\t// Times per user, click on \"Edit\"\r\n\t\t\tthis.elements.timesPerUser.editLink.on( 'click', () => {\r\n\t\t\t\t// Slide toggle\r\n\t\t\t\tthis.elements.timesPerUser.hiddenBox.slideToggle( 300 );\r\n\t\t\t});\r\n\r\n\t\t\t// Times per user, click on \"Cancel\"\r\n\t\t\tthis.elements.timesPerUser.cancelButton.on( 'click', () => {\r\n\t\t\t\t// Slide toggle\r\n\t\t\t\tthis.elements.timesPerUser.hiddenBox.slideToggle( 300, () => {\r\n\t\t\t\t\t// Reset UI\r\n\t\t\t\t\tnew Publish();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Timer per user, click on \"Save\"\r\n\t\t\tthis.elements.timesPerUser.saveButton.on( 'click', () => {\r\n\t\t\t\t// Validate input\r\n\t\t\t\tlet validation = this.timesField.validate();\r\n\r\n\t\t\t\t// Check if it's valid. Otherwise do nothing. Field.js will show an error\r\n\t\t\t\tif ( validation.isValid ){\r\n\r\n\t\t\t\t\t// Add loading class to save button\r\n\t\t\t\t\tthis.elements.timesPerUser.saveButton.addClass( 'uap-btn--loading uap-btn--disabled' );\r\n\r\n\t\t\t\t\t// Get value. We have to check if it's empty and change it to -1\r\n\t\t\t\t\tlet numberOfTimes = this.timesField.getValue();\r\n\t\t\t\t\t\r\n\t\t\t\t\tif ( isEmpty( numberOfTimes ) ){\r\n\t\t\t\t\t\tnumberOfTimes = -1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trestCall( 'recipe_completions_allowed', {\r\n\t\t\t\t\t\tpost_ID: \t\t\t\t\tUncannyAutomator.recipe.id,\r\n\t\t\t\t\t\trecipe_completions_allowed: numberOfTimes\r\n\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\t// Update JS object\r\n\t\t\t\t\t\tUncannyAutomator.recipe.publish.timesPerUser = numberOfTimes;\r\n\r\n\t\t\t\t\t\t// Slide toggle fields container and refresh the Publish UI\r\n\t\t\t\t\t\tthis.elements.timesPerUser.hiddenBox.slideToggle( 300, () => {\r\n\t\t\t\t\t\t\t// Reset UI\r\n\t\t\t\t\t\t\tnew Publish();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\tconsole.log( '‼️ ERROR-TODO. Couldn\\'t save times per user' );\r\n\r\n\t\t\t\t\t\t// Revert changes\r\n\t\t\t\t\t\tthis.timesField.setValue( UncannyAutomator.recipe.publish.timesPerUser );\r\n\r\n\t\t\t\t\t\t// Remove the loading class to save button\r\n\t\t\t\t\t\tthis.elements.timesPerUser.saveButton.removeClass( 'uap-btn--loading uap-btn--disabled' );\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Get field element and bind 'keyup'\r\n\t\t\tthis.timesField.getField().on( 'keyup', ( event ) => {\r\n\t\t\t\t// Check if it's an enter\r\n\t\t\t\tif ( event.keyCode == 13 ){\r\n\t\t\t\t\t// Trigger a click on the Save Button\r\n\t\t\t\t\tthis.elements.timesPerUser.saveButton.trigger( 'click' );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Status change\r\n\t\tthis.elements.toggle.on( 'automator:field:change', () => {\r\n\t\t\t// Set loading status\r\n\t\t\tthis.recipeStatusToggle.startLoadingAnimation();\r\n\r\n\t\t\t// Set post status\r\n\t\t\tlet makeLive   = this.recipeStatusToggle.getValue(),\r\n\t\t\t\tpostStatus = makeLive ? 'publish' : 'draft';\r\n\r\n\t\t\t// Check if can make it live\r\n\t\t\tlet recipeTriggers = itemsObject( 'get', {\r\n\t\t\t\t\tfilter: {\r\n\t\t\t\t\t\titemType: 'trigger'\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n                canMakeLive = true;\r\n\r\n\t\t\t// Check if the user is trying to make the recipe live\r\n\t\t\tif ( canMakeLive && ( ! makeLive || ( makeLive && UncannyAutomator.recipe.isValid ) ) ){\r\n\r\n\t\t\t\trestCall( 'change_post_status', {\r\n\t\t\t\t\tpost_ID: \t UncannyAutomator.recipe.id,\r\n\t\t\t\t\tpost_status: postStatus\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\t// Update main object\r\n\t\t\t\t\tUncannyAutomator.recipe.isLive = makeLive;\r\n\r\n\t\t\t\t\t// Reset the UI\r\n\t\t\t\t\tnew Publish();\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\t// Shomething went wrong, show error\r\n\t\t\t\t\tconsole.log( '‼️ ERROR-TODO. Couldn\\'t set the recipe status' );\r\n\r\n\t\t\t\t\t// Revert user change\r\n\t\t\t\t\tsetTimeout( () => {\r\n\t\t\t\t\t\t// Stop loading animation\r\n\t\t\t\t\t\tthis.recipeStatusToggle.stopLoadingAnimation();\r\n\r\n\t\t\t\t\t\t// Revert value\r\n\t\t\t\t\t\tthis.recipeStatusToggle.setValue( false, false );\r\n\t\t\t\t\t}, 1000);\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif ( ! canMakeLive ){\r\n\t\t\t\t\t// Set error message\r\n                    UncannyAutomator.recipe.message.error = vsprintf( UncannyAutomator.i18n.proOnly.proToPublish, [ UncannyAutomator.i18n.uncannyAutomatorPro ] );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set error mode\r\n\t\t\t\tUncannyAutomator.recipe.errorMode = true;\r\n\r\n\t\t\t\t// Show error\r\n\t\t\t\tnew RecipeNotices();\r\n\t\t\t\t\r\n\t\t\t\t// Revert user change\r\n\t\t\t\tsetTimeout( () => {\r\n\t\t\t\t\t// Stop loading animation\r\n\t\t\t\t\tthis.recipeStatusToggle.stopLoadingAnimation();\r\n\r\n\t\t\t\t\t// Revert value\r\n\t\t\t\t\tthis.recipeStatusToggle.setValue( false, false );\r\n\t\t\t\t}, 1000);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default Publish;\n\n\n// WEBPACK FOOTER //\n// ./src/components/Publish.js","import {\r\n\trestCall,\r\n\tgetDOMElements,\r\n\tisEmpty\r\n} from './Utilities.js';\r\n\r\nclass RecipeTypeSelector {\r\n\tconstructor( doWhenReady ){\r\n\t\t// Save callbacks\r\n\t\tthis.doWhenReady = doWhenReady;\r\n\r\n\t\t// Render\r\n\t\tthis.render();\r\n\r\n\t\t// Get elements\r\n\t\tthis.getElements();\r\n\r\n\t\t// Listen to the form submission\r\n\t\tthis.listenSubmission();\r\n\t}\r\n\r\n\trender(){\r\n\t\t// Create HTML\r\n\t\tconst $recipeTypeSelector = $( `\r\n\t\t\t<div class=\"uap\">\r\n\t\t\t\t<div id=\"uap-type-selector\" class=\"uap-type-selector\">\r\n\t\t\t\t\t<div class=\"uap-type-selector__box\">\r\n\t\t\t\t\t\t<form id=\"uap-type-selector-form\" class=\"uap-type-selector__form\">\r\n\t\t\t\t\t\t\t<div class=\"uap-type-selector__title\">\r\n\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.recipeType.title }\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"uap-type-selector__content\">\r\n\t\t\t\t\t\t\t\t<div class=\"uap-type-selector__types\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type uap-type-selector-type--user\">\r\n\t\t\t\t\t\t\t\t\t\t<input class=\"uap-type-selector-type__hidden-field\" type=\"radio\" name=\"uap-recipe-type\" value=\"user\" id=\"uap-recipe-type-user\">\r\n\t\t\t\t\t\t\t\t\t\t<label class=\"uap-type-selector-type__label\" for=\"uap-recipe-type-user\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__container\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__icon\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__icon-img uap-type-selector-type__icon-img--user\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__title\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.recipeType.userRecipeName }\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__description\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.recipeType.userRecipeDescription }\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type uap-type-selector-type--anonymous\">\r\n\t\t\t\t\t\t\t\t\t\t<input class=\"uap-type-selector-type__hidden-field\" type=\"radio\" name=\"uap-recipe-type\" value=\"anonymous\" id=\"uap-recipe-type-anonymous\">\r\n\t\t\t\t\t\t\t\t\t\t<label class=\"uap-type-selector-type__label\" for=\"uap-recipe-type-anonymous\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__container\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__icon\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__icon-img uap-type-selector-type__icon-img--anonymous\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__title\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.recipeType.anonymousRecipeName }\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__description\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.recipeType.anonymousRecipeDescription }\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"uap-type-selector__warning\">\r\n\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.recipeType.cantChangeLaterNotice }\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"uap-type-selector__buttons\">\r\n\t\t\t\t\t\t\t\t<button type=\"submit\" id=\"uap-type-selector-submit-button\" class=\"uap-btn uap-btn--primary\">${ UncannyAutomator.i18n.confirm }</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</form>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Append container to the body\r\n\t\t$( 'body' ).append( $recipeTypeSelector );\r\n\t}\r\n\r\n\tgetElements(){\r\n\t\t// Get elements\r\n\t\tthis.$elements = {\r\n\t\t\tcontainer:    $( '#uap-type-selector' ),\r\n\t\t\tform:         $( '#uap-type-selector-form' ),\r\n\t\t\twarning:      $( '#uap-type-selector .uap-type-selector__warning' ),\r\n\t\t\tsubmitButton: $( '#uap-type-selector-submit-button' )\r\n\t\t}\r\n\t}\r\n\r\n\tlistenSubmission(){\r\n\t\t// Listen submission\r\n\t\tthis.$elements.form.on( 'submit', ( event ) => {\r\n\t\t\t// Prevent default\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\t// Get recipe type\r\n\t\t\tconst recipeType = this.$elements.form.find( 'input[name=\"uap-recipe-type\"]:checked' ).val();\r\n\r\n\t\t\t// Check if it's defined and it's a valid value\r\n\t\t\tif ( ! isEmpty( recipeType ) ){\r\n\t\t\t\t// Check if it has a valid value\r\n\t\t\t\tif ( [ 'user', 'anonymous' ].includes( recipeType ) ){\r\n\t\t\t\t\t// Save recipe type\r\n\t\t\t\t\tthis.saveRecipeType( recipeType );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// The user is trying save a different value\r\n\t\t\t\t\tthis.showError( UncannyAutomator.i18n.recipeType.errorTryingToSaveOtherValue );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// The user didn't select an option\r\n\t\t\t\tthis.showError( UncannyAutomator.i18n.recipeType.errorDidNotSelectType );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tsaveRecipeType( recipeType ){\r\n\t\t// Define endpoint\r\n\t\tconst endpoint = 'change_post_recipe_type';\r\n\r\n\t\t// Define data to send\r\n\t\tconst data = {\r\n\t\t\tpost_ID:     UncannyAutomator.recipe.id,\r\n\t\t\trecipe_type: recipeType\r\n\t\t}\r\n\r\n\t\t// Add loading animation to the button\r\n\t\tthis.$elements.submitButton.addClass( 'uap-btn--loading uap-btn--disabled' );\r\n\r\n\t\t// Do a REST call to save the recipe type\r\n\t\trestCall( endpoint, data,\r\n\t\t\t( response ) => {\r\n\t\t\t\t// Check if it was successful\r\n\t\t\t\tif ( response.success ){\r\n\t\t\t\t\t// Remove container \r\n\t\t\t\t\t// We should render everything again and \r\n\t\t\t\t\t// add a conditional to not render the elements\r\n\t\t\t\t\tthis.$elements.container.remove();\r\n\r\n\t\t\t\t\t// Save in main object\r\n\t\t\t\t\tUncannyAutomator.recipe.type = recipeType;\r\n\r\n\t\t\t\t\t// Get the container of the title\r\n\t\t\t\t\tlet $triggersMetaboxTitle = $( '#uo-recipe-triggers-meta-box-ui h2.hndle.ui-sortable-handle span' );\r\n\r\n\t\t\t\t\t// Create the title of triggers metabox\r\n\t\t\t\t\tlet triggersMetaboxTitle = UncannyAutomator.i18n.trigger.userTriggers;\r\n\t\t\t\t\tif ( UncannyAutomator.recipe.type == 'anonymous' ){\r\n\t\t\t\t\t\ttriggersMetaboxTitle = UncannyAutomator.i18n.trigger.anonymousTrigger;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Change text the title container\r\n\t\t\t\t\t$triggersMetaboxTitle.text( triggersMetaboxTitle );\r\n\r\n\t\t\t\t\t// Call callbacks\r\n\t\t\t\t\tthis.doWhenReady( recipeType );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Show error\r\n\t\t\t\t\tthis.showError( UncannyAutomator.i18n.recipeType.errorSomethingWentWrong );\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t( response ) => {\r\n\t\t\t\tconsole.log( '‼️ ERROR-TODO. Couldn\\'t save the recipe type' );\r\n\r\n\t\t\t\t// Remove loading class\r\n\t\t\t\tthis.$elements.submitButton.removeClass( 'uap-btn--loading uap-btn--disabled' );\r\n\r\n\t\t\t\t// Show error message\r\n\t\t\t\tthis.showError( UncannyAutomator.i18n.recipeType.errorSomethingWentWrong );\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tshowError( errorMessage ){\r\n\t\t// Create error\r\n\t\tconst $error = $( `\r\n\t\t\t<div class=\"uap-type-selector__error\">\r\n\t\t\t\t${ errorMessage }\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Check if the container already has an error container\r\n\t\tconst $oldErrorContainer = this.$elements.container.find( '.uap-type-selector__error' );\r\n\t\tif ( $oldErrorContainer.length > 0 ){\r\n\t\t\t$oldErrorContainer.remove();\r\n\t\t}\r\n\r\n\t\t// Add error container\r\n\t\t$error.insertAfter( this.$elements.warning );\r\n\r\n\t\t// Add class to shake\r\n\t\tsetTimeout(() => {\r\n\t\t\t$error.addClass( 'uap-type-selector__error--shake' );\r\n\t\t}, 10 );\r\n\t}\r\n}\r\n\r\nexport default RecipeTypeSelector;\n\n\n// WEBPACK FOOTER //\n// ./src/components/RecipeTypeSelector.js","import {\r\n    restCall,\r\n    getGlobalItem,\r\n    getDOMElements,\r\n    parseStringWithTokens,\r\n    isEmpty,\r\n    isDefined,\r\n    replaceCurlyBraces\r\n} from './Utilities.js';\r\n\r\nimport Modal       from './Modal.js';\r\nimport ItemOptions from './ItemOptions.js';\r\nimport Field       from './Field.js';\r\nimport Triggers    from './Triggers.js';\r\nimport Actions     from './Actions.js';\r\n\r\nimport {\r\n    validateItem\r\n} from './Validation.js';\r\n\r\nimport RecipeNotices from './RecipeNotices.js';\r\n\r\nclass ItemHeaderSentence {\r\n    constructor( itemType, integrationID, itemCode, itemId ){\r\n        this.itemType = itemType;\r\n        this.integrationID = integrationID;\r\n        this.itemCode = itemCode;\r\n        this.itemId   = itemId;\r\n        this.item     = UncannyAutomator.recipe.items[ itemId ];\r\n\r\n        return this.createItemSentence( itemType, itemCode, itemId );\r\n    }\r\n\r\n    /**\r\n     * Create item sentence + status toggle\r\n     * \r\n     * @since 0.5     \r\n     *\r\n     * @return {object}   jQuery DOM object with the item sentence + status toggle\r\n     */\r\n\r\n    createItemSentence( itemType, itemCode, itemId ){\r\n        // Get information about the global item\r\n        let globalItem = getGlobalItem( this.integrationID, itemType, itemCode );\r\n        this.globalItem = globalItem;\r\n\r\n        // Get sentence\r\n        let itemSentence;\r\n\r\n        if ( ! this.item.isMissing ){\r\n            itemSentence = getGlobalItem( this.integrationID, this.item.itemType, this.item.itemCode ).sentence;\r\n        }\r\n        else {\r\n            itemSentence = this.item.sentence;\r\n        }\r\n\r\n        itemSentence = parseStringWithTokens( this.item, itemSentence, UncannyAutomator.recipe.items[ this.itemId ].meta );\r\n\r\n        // Bind elements\r\n        /*\r\n        itemSentence.elements.normal.on( 'click', function(){\r\n            //\r\n        });\r\n        */\r\n\r\n        if ( ! this.item.isMissing ){\r\n            // Listen clicks on tokens\r\n            itemSentence.elements.token.on( 'click', ( event ) => {\r\n                // Get token element\r\n                const $token = $( event.currentTarget );\r\n\r\n                // Remove \"open\" class from al items\r\n                itemSentence.elements.token.removeClass( 'item-title__token--open' );\r\n                // Add \"open\" class to the clicked token\r\n                $token.addClass( 'item-title__token--open' );\r\n\r\n                // Get options ID\r\n                let optionsID = $token.data( 'options-id' );\r\n\r\n                // Get option group\r\n                let optionGroupDOM = getDOMElements( 'optionGroup', {\r\n                    itemID:  itemId,\r\n                    groupID: optionsID,\r\n                });\r\n\r\n                // Create and show\r\n                new ItemOptions( itemId, optionsID );\r\n            });\r\n        }\r\n            \r\n        // Create DOM elements\r\n        let container = $( '<div/>', { 'class': 'item-title__describe-container' }),\r\n            status    = $( '<div/>', { 'class': 'item-status' });\r\n\r\n        container.append( itemSentence.html.addClass( 'item-title__describe' ) );\r\n\r\n        // Create toggle. We're using Field. Read Field.js comments for more information\r\n        var itemToggle = new Field( 'checkbox', {\r\n            color: 'green',\r\n            align: 'right',\r\n            toggle: {\r\n                on:  UncannyAutomator.i18n.status.liveRecipeItem,\r\n                off: UncannyAutomator.i18n.status.draftRecipeItem,\r\n            },\r\n            currentValue: UncannyAutomator.recipe.items[ itemId ].isLive\r\n        });\r\n\r\n        let itemStatusToggle = itemToggle.getFormElement();\r\n            status.append( itemStatusToggle );\r\n            container.append( status );\r\n\r\n        if ( ! this.item.isMissing ){\r\n            itemStatusToggle.on( 'automator:field:change', function(){\r\n                let makeLive = itemToggle.getValue();\r\n                var isValidItem = true; // True by default, will change to false is it's invalid\r\n\r\n                // Check if the user wants to make it live\r\n                if ( makeLive ){\r\n                    // Validate\r\n                    let validation = validateItem( itemId );\r\n                    isValidItem = validation.isValid; \r\n                }\r\n\r\n                // Do AJAX\r\n                // Show loading animation\r\n                itemToggle.startLoadingAnimation();\r\n\r\n                if ( isValidItem ){\r\n                    // Set post status\r\n                    let post_status = makeLive ? 'publish' : 'draft';\r\n\r\n                    // Check if they want to make an item draft in a live recipe\r\n                    if ( ! makeLive && UncannyAutomator.recipe.isLive ){\r\n                        // Create modal box\r\n                        // Read Modal.js comments for more information\r\n                        let modal = new Modal({\r\n                            title:       UncannyAutomator.i18n.confirmationModal.title,\r\n                            warning:     replaceCurlyBraces( UncannyAutomator.i18n.confirmationModal.statusWarning, '<strong>', '</strong>' ),\r\n                            buttons: {\r\n                                cancel:  UncannyAutomator.i18n.cancel,\r\n                                confirm: UncannyAutomator.i18n.confirm,\r\n                            }\r\n                        });\r\n\r\n                        modal.setEvents({\r\n                            afterSetEvents: function(){\r\n                                modal.show();\r\n                            },\r\n                            onConfirm: function(){\r\n                                let elements        = modal.getElements();\r\n                                let confirmButton   = elements.modal.box.buttons.confirm;\r\n\r\n                                // Add loading class to button\r\n                                confirmButton.addClass( 'uap-btn--loading' ).prop( 'disabled', true );\r\n\r\n                                // Start loading animation on toggle\r\n                                itemToggle.startLoadingAnimation();\r\n\r\n                                restCall( 'change_post_status', {\r\n                                    post_ID:      itemId,\r\n                                    post_status:  post_status\r\n                                }, function(){\r\n                                    // On success\r\n                                    // Destroy modal\r\n                                    modal.destroy();\r\n\r\n                                    // Refresh UI\r\n                                    new Triggers();\r\n                                    new Actions();\r\n\r\n                                    // Show error\r\n                                    new RecipeNotices();\r\n\r\n                                    // Check if the recipe is still valid, if it isn't then make the recipe draft\r\n                                    if ( ! UncannyAutomator.recipe.isValid ){\r\n                                        UncannyAutomator.recipe.publish.statusToggle.setValue( false );\r\n                                    }\r\n                                }, function(){\r\n                                    // On fail\r\n                                    console.log( '‼️ ERROR-TODO. Couldn\\'t set the item status' );\r\n\r\n                                    // Destroy modal\r\n                                    modal.destroy();\r\n\r\n                                    // Remove loading animation, data didn't change\r\n                                    itemToggle.stopLoadingAnimation();\r\n\r\n                                    // Revert user change\r\n                                    itemToggle.setValue( ! makeLive, false );\r\n                                });\r\n                            },\r\n                            onCancel: function(){\r\n                                // Destroy modal\r\n                                modal.destroy();\r\n\r\n                                // Revert user change\r\n                                itemToggle.setValue( ! makeLive, false );\r\n\r\n                                // Stop loading animation in the toggle\r\n                                itemToggle.stopLoadingAnimation();\r\n                            },\r\n                            afterHide: function(){\r\n                                modal.destroy();\r\n                            }\r\n                        });\r\n                    }\r\n                    else {\r\n                        // Is valid, make live\r\n                        restCall( 'change_post_status', {\r\n                            post_ID:      itemId,\r\n                            post_status:  post_status\r\n                        }, function(){\r\n                            // On sucess\r\n                            // Update object\r\n\r\n                            // Refresh UI\r\n                            // Debugging! don't re-render the UI\r\n                            // new Triggers();\r\n                            // new Actions();\r\n\r\n                            // Remove loading animation, data didn't change\r\n                            itemToggle.stopLoadingAnimation();\r\n\r\n                            // Show error\r\n                            new RecipeNotices();\r\n                        }, function(){\r\n                            // On fail\r\n                            console.log( '‼️ ERROR-TODO. Couldn\\'t set the item status' );\r\n\r\n                            // Remove loading animation, data didn't change\r\n                            itemToggle.stopLoadingAnimation();\r\n\r\n                            // Revert user change\r\n                            itemToggle.setValue( ! makeLive, false );\r\n                        });\r\n                    }\r\n                }\r\n                else {\r\n                    // JS won't take more than some milliseconds to do this, so we're going to wait one second just for the user to understand what's happening\r\n                    setTimeout(function(){\r\n                        // Remove loading animation\r\n                        itemToggle.stopLoadingAnimation();\r\n\r\n                        // Revert user change\r\n                        itemToggle.setValue( false, false );\r\n                    }, 1000 );\r\n                }\r\n            });\r\n        }\r\n\r\n        return container;\r\n    }\r\n}\r\n\r\nexport default ItemHeaderSentence;\n\n\n// WEBPACK FOOTER //\n// ./src/components/ItemHeaderSentence.js","import {\r\n    itemsObject,\r\n    getDOMElements,\r\n    isEmpty,\r\n    isDefined,\r\n    vsprintf,\r\n    addParametersToURL\r\n} from './Utilities.js';\r\nimport ItemCreatorIntegrations from './ItemCreatorIntegrations.js';\r\nimport Triggers from './Triggers';\r\nimport Actions from './Actions';\r\nimport MetaboxItems from './MetaboxItems';\r\n\r\nclass MetaboxFooter {\r\n\r\n    constructor( itemType ){\r\n        this.itemType = itemType;\r\n\r\n        if ( this.shouldCreateMetaboxFooter() ){\r\n            this.createFooter();\r\n        }\r\n    }\r\n\r\n    shouldCreateMetaboxFooter(){\r\n        // Check if we should create the metabox\r\n        // For the triggers we're going to create it always,\r\n        // but for the actions we're going to create only if there is at least one action\r\n\r\n        let create = false;\r\n\r\n        if ( this.itemType == 'trigger' ){\r\n            // Get triggers\r\n            let recipeActions = itemsObject( 'get', {\r\n                filter: {\r\n                    itemType: 'trigger'\r\n                }\r\n            });\r\n\r\n            // Check if has triggers\r\n            let hasTriggers = ! isEmpty( recipeActions );\r\n\r\n            // Create metabox if hasTriggers\r\n            if ( ( hasTriggers || ( ! isDefined( UncannyAutomator.wp ) || ! UncannyAutomator.wp ) ) || UncannyAutomator.recipe.type == 'anonymous' ){\r\n                create = true;\r\n            }\r\n        }\r\n\r\n        if ( this.itemType == 'action' ){\r\n            // Get actions\r\n            let recipeActions = itemsObject( 'get', {\r\n                filter: {\r\n                    itemType: 'action'\r\n                }\r\n            });\r\n\r\n            // Check if has actions\r\n            let hasActions = ! isEmpty( recipeActions );\r\n\r\n            // Create metabox if hasActions\r\n            if ( hasActions ){\r\n                create = true;\r\n            }\r\n        }\r\n\r\n        return create;\r\n    }\r\n\r\n    createFooter(){\r\n        // Create error container\r\n        let container  = $( '<div/>', { 'class': 'metabox__footer' });\r\n\r\n        // \"Add another\" button\r\n        let addAnother = $( '<div/>', { 'class': 'uap-btn uap-btn--secondary' });\r\n\r\n        // Add button, but don't add it in the triggers metabox for anonymous recipes\r\n        if ( this.itemType == 'action' || ( this.itemType == 'trigger' && UncannyAutomator.recipe.type == 'user' ) ){\r\n            // Append \"Add another\" button\r\n            container.append( addAnother );\r\n        }\r\n\r\n        if ( this.itemType == 'trigger' ){\r\n            // Do only for \"user\" recipes\r\n            if ( UncannyAutomator.recipe.type == 'user' ){\r\n                // Set text to the \"Add Another\" button\r\n                addAnother.text( UncannyAutomator.i18n.trigger.addAnother );\r\n            }\r\n\r\n            // Do only for \"anonymous\" recipes\r\n            if ( UncannyAutomator.recipe.type == 'anonymous' ){\r\n                // Create and append anonymous notice\r\n                let $anonymousNotice = this.createAnonymousNotice();\r\n                container.append( $anonymousNotice );\r\n            }\r\n        }\r\n\r\n        if ( this.itemType == 'action' ){\r\n            // Set text to the \"Add Another\" button\r\n            addAnother.text( UncannyAutomator.i18n.action.addAnother );\r\n        }\r\n\r\n        // Bind button\r\n        if ( ( this.itemType == 'trigger' ) || this.itemType == 'action' ){\r\n            // Listen clicks to the \"Add another\" button\r\n            addAnother.on( 'click', () => {\r\n                // Multiple triggers are only allowed in the pro version\r\n                // So we're only doing this for actions\r\n                new ItemCreatorIntegrations( this.itemType );\r\n            });\r\n        }\r\n\r\n        // Append to the metabox\r\n        let metabox = getDOMElements( 'metabox', {\r\n            type: this.itemType\r\n        })\r\n\r\n        metabox.append( container );\r\n    }\r\n\r\n    createAnonymousNotice(){\r\n        let $notice = $( `\r\n            <div class=\"description\">\r\n                ${ UncannyAutomator.i18n.recipeType.anonymousOnlyOneTrigger } <a href=\"${ addParametersToURL( 'https://automatorplugin.com/knowledge-base/managing-triggers/', {\r\n                        'utm_source':  'uncanny_automator',\r\n                        'utm_medium':  'anonymous_recipe_one_trigger',\r\n                        'utm_content': 'learn_more'\r\n                    }) }\" target=\"_blank\">${ UncannyAutomator.i18n.learnMore } <span class=\"uo-icon uo-icon--external-link-alt\"></span></a>\r\n            </div>\r\n        ` );\r\n\r\n        return $notice;\r\n    }\r\n}\r\n\r\nexport default MetaboxFooter;\n\n\n// WEBPACK FOOTER //\n// ./src/components/MetaboxFooter.js","// Load static resources\r\nimport './css/uncannyowl-automator.svg';\r\nimport './css/uncannyowl-automator.ttf';\r\nimport './css/uncannyowl-automator.woff';\r\nimport './css/main.scss';\r\n\r\nimport {\r\n\tcreateDataOnLoad,\r\n\tconsoleLogLabel\r\n}   from './components/Utilities.js';\r\n\r\nimport Publish            from './components/Publish.js';\r\nimport Triggers           from './components/Triggers.js';\r\nimport Actions            from './components/Actions.js';\r\nimport SendFeedback       from './components/SendFeedback.js';\r\nimport RecipeTypeSelector from './components/RecipeTypeSelector.js';\r\nimport RecipeTitle        from './components/RecipeTitle.js';\r\nimport Taxonomies         from './components/Taxonomies.js';\r\n\r\n// Create the data required to render Automator\r\ncreateDataOnLoad(() => {\r\n\tconsoleLogLabel( 'Render the UI', false, { bgColor: '#579f49' });\r\n\r\n\t// Once ready, render the UI\r\n\tnew Triggers();\r\n\tnew Actions();\r\n\tnew Publish();\r\n\tnew SendFeedback();\r\n\tnew RecipeTitle();\r\n\tnew Taxonomies();\r\n});\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = \"uncannyowl-automator.svg\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/css/uncannyowl-automator.svg\n// module id = 19\n// module chunks = 0","module.exports = \"uncannyowl-automator.ttf\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/css/uncannyowl-automator.ttf\n// module id = 20\n// module chunks = 0","module.exports = \"uncannyowl-automator.woff\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/css/uncannyowl-automator.woff\n// module id = 21\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/css/main.scss\n// module id = 22\n// module chunks = 0","import {\r\n\tisDefined,\r\n\tisEmpty\r\n} from './Utilities';\r\n\r\nimport Field from './Field';\r\n\r\nclass FieldsGroup {\r\n\tconstructor( attributes, createDOMelements = true, customValidationFunction = null ){\r\n\t\t// Save attributes\r\n\t\tthis.setAttributes( attributes );\r\n\r\n\t\t// Create fields\r\n\t\tthis.createFields();\r\n\t}\r\n\r\n\t/**\r\n\t * Set attributes. It add properties like hasValue, hasPlaceholder, etc, automatically\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @param  {object} attributes - The field attributes\r\n\t *\r\n\t * @return {object} attributes - The field attributes\r\n\t */\r\n\r\n\tsetAttributes( attributes ){\r\n\t\t// Has label\r\n\t\tif ( ! isDefined( attributes.hasLabel ) ){\r\n\t\t\tif ( ! isEmpty( attributes.label ) ){\r\n\t\t\t\tattributes.hasLabel = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasLabel = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has description\r\n\t\tif ( ! isDefined( attributes.hasDescription ) ){\r\n\t\t\tif ( ! isEmpty( attributes.description ) ){\r\n\t\t\t\tattributes.hasDescription = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasDescription = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.attributes = attributes;\r\n\t}\r\n\r\n\t/**\r\n\t * Create instances of Field\r\n\t *\r\n\t * @since  2.0\r\n\t *\r\n\t * @return undefined\r\n\t */\r\n\r\n\tcreateFields(){\r\n\t\t// Replace fields data with Field instances\r\n\t\tthis.fields = this.attributes.fields.map(( fieldData ) => {\r\n\t\t\t// Create Field\r\n\t\t\treturn new Field( fieldData.fieldType, fieldData );\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Create a jQuery DOM element with the field\r\n\t *\r\n\t * @since 0.3\r\n\t */\r\n\r\n\tcreateFormElement(){\r\n\t\t// Create response object\r\n\t\tlet response = null;\r\n\r\n\t\t// Create container\r\n\t\tconst $container = $( `<div class=\"form-group\"></div>` );\r\n\r\n\t\t// Check if it has a label\r\n\t\tif ( this.attributes.hasLabel ){\r\n\t\t\t// Create label\r\n\t\t\tconst $label = $( `<div class=\"form-group__label\">${ this.attributes.label }</div>` );\r\n\r\n\t\t\t// Append label\r\n\t\t\t$container.append( $label );\r\n\t\t}\r\n\r\n\t\t// Create form group. We're going to add the fields here\r\n\t\tconst $formGroup = $( `<div class=\"form-group__fields\"></div>` );\r\n\t\t// Iterate fields\r\n\t\tthis.fields.forEach(( field ) => {\r\n\t\t\t// Create form element\r\n\t\t\tconst $fieldElement = field.createFormElement();\r\n\r\n\t\t\t// Append form element\r\n\t\t\t$formGroup.append( $fieldElement );\r\n\t\t});\r\n\t\t// Append fields\r\n\t\t$container.append( $formGroup );\r\n\r\n\t\t// Check if it has a description\r\n\t\tif ( this.attributes.hasLabel ){\r\n\t\t\t// Create description\r\n\t\t\tconst $description = $( `<div class=\"form-group__description\">${ this.attributes.description }</div>` );\r\n\t\t\r\n\t\t\t// Append description\r\n\t\t\t$container.append( $description );\r\n\t\t}\r\n\r\n\t\t// Save form element\r\n\t\tthis.formElement = $container;\r\n\t\tresponse = $container;\r\n\r\n\t\t// Return form element\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Get value\r\n\t *\r\n\t * @since  2.0\r\n\t *\r\n\t * @return {object} Object where the key is the field ID and the value is the field's value\r\n\t */\r\n\t\r\n\tgetValue(){\r\n\t\t// Create object where we're going to save the values\r\n\t\tlet fieldsValue = {};\r\n\r\n\t\t// Iterate fields\r\n\t\tthis.fields.forEach(( field ) => {\r\n\t\t\t// Add the field value\r\n\t\t\tfieldsValue[ field.getFieldID() ] = field.getValue();\r\n\t\t});\r\n\r\n\t\t// Return validation object\r\n\t\treturn fieldsValue;\r\n\t}\r\n\r\n\t/**\r\n\t * Get form element\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @return {object} jQuery object of the field's container\r\n\t */\r\n\r\n\tgetFormElement(){\r\n\t\treturn this.formElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Get attributes\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @return {object} Field attributes\r\n\t */\r\n\r\n\tgetAttributes(){\r\n\t\treturn this.attributes;\r\n\t}\r\n\r\n\t/**\r\n\t * Validate the fields\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @param  {boolean} renderError - TRUE if you want to render the field errors, FALSE if you only want to return the response object\r\n\t *\r\n\t * @return {object} Object where the key is the field ID and the value is a validateField object\r\n\t */\r\n\t\r\n\tvalidate( renderError = true ){\r\n\t\t// Create validation object\r\n\t\tlet validationObject = {\r\n\t\t\tisValid: true,\r\n\t\t\tmessage: ''\r\n\t\t};\r\n\r\n\t\t// Iterate fields\r\n\t\tthis.fields.forEach(( field ) => {\r\n\t\t\t// Validate and add response to the validation object\r\n\t\t\tvalidationObject[ field.getFieldID() ] = field.validate( renderError );\r\n\r\n\t\t\t// Update main validation\r\n\t\t\tvalidationObject.isValid = validationObject.isValid && validationObject[ field.getFieldID() ].isValid;\r\n\t\t});\r\n\r\n\t\t// Return validation object\r\n\t\treturn validationObject;\r\n\t}\r\n}\r\n\r\nexport default FieldsGroup;\n\n\n// WEBPACK FOOTER //\n// ./src/components/FieldsGroup.js","import {\r\n\tisDefined,\r\n\tisEmpty\r\n} from './Utilities';\r\n\r\nimport Field from './Field';\r\n\r\nconst sortable = require( 'html5sortable' );\r\n\r\nclass FieldsRepeater {\r\n\tconstructor( attributes, createDOMelements = true, customValidationFunction = null ){\r\n\t\t// Save attributes\r\n\t\tthis.setAttributes( attributes );\r\n\r\n\t\t// Create fields\r\n\t\tthis.createFields();\r\n\t}\r\n\r\n\t/**\r\n\t * Set attributes. It add properties like hasValue, hasPlaceholder, etc, automatically\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @param  {object} attributes - The field attributes\r\n\t *\r\n\t * @return {object} attributes - The field attributes\r\n\t */\r\n\r\n\tsetAttributes( attributes ){\r\n\t\t// Has label\r\n\t\tif ( ! isDefined( attributes.hasLabel ) ){\r\n\t\t\tif ( ! isEmpty( attributes.label ) ){\r\n\t\t\t\tattributes.hasLabel = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasLabel = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has description\r\n\t\tif ( ! isDefined( attributes.hasDescription ) ){\r\n\t\t\tif ( ! isEmpty( attributes.description ) ){\r\n\t\t\t\tattributes.hasDescription = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasDescription = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.attributes = attributes;\r\n\t}\r\n\r\n\t/**\r\n\t * Create instances of Field\r\n\t *\r\n\t * @since  2.0\r\n\t *\r\n\t * @return undefined\r\n\t */\r\n\r\n\tcreateFields(){\r\n\t\t// Get fields template\r\n\t\tconst rowFieldsTemplate = this.attributes.fields;\r\n\r\n\t\t// Create array with fields\r\n\t\tlet fieldsRows = [];\r\n\r\n\t\t// Check if there is data and create multiple rows of the repeater field\r\n\t\tif ( Array.isArray( this.attributes.currentValue ) && this.attributes.currentValue.length > 0 ){\r\n\t\t\t// https://regex101.com/r/tLL7S9/1/\r\n\t\t\t// Get field id and index from strings like FIELD_1\r\n\r\n\t\t\t// Iterate default rows\r\n\t\t\tthis.attributes.currentValue.forEach(( row, index ) => {\r\n\t\t\t\t// Clone template row\r\n\t\t\t\tlet rowFields = JSON.parse( JSON.stringify( rowFieldsTemplate ) );\r\n\r\n\t\t\t\t// Iterate the rows in the template and try to get their\r\n\t\t\t\t// value from the \"row\" array\r\n\t\t\t\trowFields = rowFields.map(( field, index ) => {\r\n\t\t\t\t\t// Check if there is a value for this field\r\n\t\t\t\t\tif ( isDefined( row[ field.optionCode ] ) ){\r\n\t\t\t\t\t\t// Save value\r\n\t\t\t\t\t\tfield.currentValue = row[ field.optionCode ];\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Set empty value\r\n\t\t\t\t\t\tfield.currentValue = '';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Return field\r\n\t\t\t\t\treturn field;\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Add row with fields\r\n\t\t\t\tfieldsRows.push( rowFields );\r\n\t\t\t});\r\n\t\t}\r\n\t\t// Otherwise, just create one row\r\n\t\telse {\r\n\t\t\t// Check if the field is required\r\n\t\t\tif ( this.attributes.isRequired ){\r\n\t\t\t\t// Create an empty row\r\n\t\t\t\tlet emptyRow = JSON.parse( JSON.stringify( rowFieldsTemplate ) );\r\n\r\n\t\t\t\t// Remove undefined current value\r\n\t\t\t\temptyRow.currentValue = '';\r\n\r\n\t\t\t\t// Add it to the main array\r\n\t\t\t\tfieldsRows.push( emptyRow );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Otherwise, do nothing\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Now iterate the row with fields\r\n\t\tfieldsRows = fieldsRows.map(( row, index ) => {\r\n\t\t\t// Now iterate each group of fields\r\n\t\t\trow = row.map(( fieldObject, index ) => {\r\n\t\t\t\t// Remove the label\r\n\t\t\t\tfieldObject.label = '';\r\n\r\n\t\t\t\t// Remove the description\r\n\t\t\t\tfieldObject.description = '';\r\n\r\n\t\t\t\t// Create field\r\n\t\t\t\tlet field = new Field( fieldObject.fieldType, fieldObject );\r\n\r\n\t\t\t\t// Return field instance\r\n\t\t\t\treturn field;\r\n\t\t\t});\r\n\r\n\t\t\t// Return row\r\n\t\t\treturn row;\r\n\t\t});\r\n\r\n\t\t// Update the fields property\r\n\t\tthis.fieldRows = fieldsRows;\r\n\t}\r\n\r\n\t/**\r\n\t * Create a jQuery DOM element with the field\r\n\t *\r\n\t * @since 0.3\r\n\t */\r\n\r\n\tcreateFormElement(){\r\n\t\t// Create response object\r\n\t\tlet response = null;\r\n\r\n\t\t// Create container\r\n\t\tconst $container = $( `<div class=\"form-repeater\"></div>` );\r\n\r\n\t\t// Check if it has a label\r\n\t\tif ( this.attributes.hasLabel ){\r\n\t\t\t// Create label\r\n\t\t\tconst $label = $( `\r\n\t\t\t\t<div class=\"form-repeater__label\">\r\n\t\t\t\t\t${ this.attributes.label }\r\n\t\t\t\t\t${ this.attributes.isRequired ? `<span class=\"form-repeater__label-required\"></span>` : `` }\r\n\t\t\t\t</div>\r\n\t\t\t` );\r\n\r\n\t\t\t// Append label\r\n\t\t\t$container.append( $label );\r\n\t\t}\r\n\r\n\t\t// Create table with the fields\r\n\t\tlet $table = this.getFieldsTable();\r\n\t\t$container.append( $table );\r\n\r\n\t\t// Add error container\r\n\t\t$table.append( $( `<div class=\"form-element__error\"></div>` ) );\r\n\r\n\t\t// Check if it has a description\r\n\t\tif ( this.attributes.hasDescription ){\r\n\t\t\t// Create description\r\n\t\t\tconst $description = $( `<div class=\"form-repeater__description\">${ this.attributes.description }</div>` );\r\n\t\t\r\n\t\t\t// Append description\r\n\t\t\t$container.append( $description );\r\n\t\t}\r\n\r\n\t\t// Save form element\r\n\t\tthis.formElement = $container;\r\n\t\tresponse = $container;\r\n\r\n\t\t// If there is more than one row, make list sortable\r\n\t\tif ( this.fieldRows.length > 1 ){\r\n\t\t\tthis.makeRowsSortable();\r\n\t\t}\r\n\r\n\t\t// Listen save\r\n\t\tthis.listenSave();\r\n\r\n\t\t// Return form element\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Listen save\r\n\t */\r\n\r\n\tlistenSave(){\r\n\t\t// Get form element\r\n\t\tthis.formElement.on( 'saved', ( event ) => {\r\n\t\t\t// Update the fields array\r\n\t\t\tthis.updateAttributesFieldsFromRow();\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Use fieldRows to update the original attributes.fields\r\n\t * We will use this to render the container again after it was\r\n\t * saved\r\n\t */\r\n\r\n\tupdateAttributesFieldsFromRow(){\r\n\t\t// Create the array where we're going to save the fields data\r\n\t\tlet fields = [];\r\n\r\n\t\t// Iterate fieldRows\r\n\t\tthis.fieldRows.forEach(( rowFields ) => {\r\n\t\t\t// Create array to save the row fields\r\n\t\t\tlet row = [];\r\n\r\n\t\t\t// Iterate row fields\r\n\t\t\trowFields.forEach(( Field ) => {\r\n\t\t\t\t// Add field\r\n\t\t\t\trow.push( Field.attributes );\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// Add row\r\n\t\t\tfields.push( row );\r\n\t\t});\r\n\r\n\t\t// Update fields\r\n\t\tthis.attributes.fields = fields;\r\n\t}\r\n\r\n\t/**\r\n\t * Make list of rows sortable\r\n\t */\r\n\t\r\n\tmakeRowsSortable(){\r\n\t\t// Make rows sortable\r\n\t\t// Use sortable from the html5sortable library\r\n\t\tsortable( this.formElement.find( '.form-repeater-fields__table-rows' ), {\r\n\t\t\tforcePlaceholderSize: true,\r\n\t\t\thandle: '.form-repeater-fields__table-rows-cell--number',\r\n\t\t\tplaceholder: `<tr><td colspan=\"${ ( this.fieldRows[0].length + 2 ) }\">&nbsp;</td></tr>`,\r\n\t\t\titemSerializer: ( serializedItem, sortableContainer ) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tposition: serializedItem.index,\r\n\t\t\t\t\thtml:     serializedItem.html\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Listen modifications to the rows order\r\n\t\tthis.formElement.find( '.form-repeater-fields__table-rows' ).on( 'sortupdate', ( event ) => {\r\n\t\t\t// Create an array where each element is the index of the row in the old order\r\n\t\t\tlet newOrder = [];\r\n\r\n\t\t\t// Iterate the rows (in their new order)\r\n\t\t\t$.each( event.detail.destination.items, ( index, row ) => {\r\n\t\t\t\tnewOrder.push( $( row ).data( 'order' ) );\r\n\t\t\t});\r\n\r\n\t\t\t// Change the order of the rows in the FieldRepeater instance\r\n\t\t\tlet newFieldRowsOrder = [];\r\n\t\t\tnewOrder.forEach(( oldIndex ) => {\r\n\t\t\t\tnewFieldRowsOrder.push( this.fieldRows[ oldIndex ] );\r\n\t\t\t});\r\n\t\t\tthis.fieldRows = newFieldRowsOrder;\r\n\r\n\t\t\t// Render the field agian\r\n\t\t\tthis.reRender();\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Create and return fields table\r\n\t *\r\n\t * @since  2.0\r\n\t */\r\n\t\r\n\tgetFieldsTable(){\r\n\t\t// Create variable to save the table\r\n\t\tconst $table = $( `\r\n\t\t\t<div class=\"form-repeater-fields\">\r\n\t\t\t\t<table class=\"form-repeater-fields__table\">\r\n\t\t\t\t\t<thead class=\"form-repeater-fields__table-heading\"></thead>\r\n\t\t\t\t\t<tbody class=\"form-repeater-fields__table-rows\"></tbody>\r\n\t\t\t\t</table>\r\n\t\t\t\t<div class=\"form-repeater-fields__actions\"></div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Create table with the rows\r\n\t\t// Get table headers\r\n\t\t// We will create a table where the name of the column will\r\n\t\t// be the label of the field\r\n\t\tlet heading = [];\r\n\r\n\t\t// Iterate the original fields object inside attributes (not the Field instances)\r\n\t\tthis.attributes.fields.forEach(( fieldData, index ) => {\r\n\t\t\t// Get column title\r\n\t\t\tconst title = isDefined( fieldData.label ) ? fieldData.label : '';\r\n\r\n\t\t\t// Check if the fields under this column are required\r\n\t\t\tconst isRequired = isDefined( fieldData.isRequired ) ? fieldData.isRequired : false;\r\n\r\n\t\t\t// Get the column description\r\n\t\t\tconst description = isDefined( fieldData.description ) ? fieldData.description : '';\r\n\r\n\t\t\t// Add heading column\r\n\t\t\theading.push({\r\n\t\t\t\ttitle:       title,\r\n\t\t\t\tdescription: description,\r\n\t\t\t\tisRequired:  isRequired\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// Create HTML of the heading\r\n\t\tconst $heading = $( `<tr></tr>` );\r\n\r\n\t\t// Add the column with for the row number\r\n\t\t$heading.append( $( `<th class=\"form-repeater-fields__table-heading-cell form-repeater-fields__table-heading-cell--number\">#</th>` ) );\r\n\r\n\t\t// Iterate heading columns\r\n\t\theading.forEach(( headingColumn, index ) => {\r\n\t\t\t// Create column\r\n\t\t\tlet $headingColumn = $( `<th class=\"form-repeater-fields__table-heading-cell\"></th>` );\r\n\r\n\t\t\t// Add the title\r\n\t\t\tif ( ! isEmpty( headingColumn.title ) ){\r\n\t\t\t\t$headingColumn.append( $( `\r\n\t\t\t\t\t<div class=\"form-repeater-fields__table-heading-cell-title\">\r\n\t\t\t\t\t\t${ headingColumn.title }\r\n\t\t\t\t\t\t${ headingColumn.isRequired ? `<span class=\"form-repeater-fields__table-heading-cell-required\"></span>` : `` }\r\n\t\t\t\t\t</div>\r\n\t\t\t\t` ) );\r\n\t\t\t}\r\n\r\n\t\t\t// Add the description\r\n\t\t\tif ( ! isEmpty( headingColumn.description ) ){\r\n\t\t\t\t$headingColumn.append( $( `\r\n\t\t\t\t\t<div class=\"form-repeater-fields__table-heading-cell-description\">\r\n\t\t\t\t\t\t${ headingColumn.description }\r\n\t\t\t\t\t</div>\r\n\t\t\t\t` ) );\r\n\t\t\t}\r\n\r\n\t\t\t// Add heading column\r\n\t\t\t$heading.append( $headingColumn );\r\n\t\t});\r\n\r\n\t\t// Add the column with for the actions\r\n\t\t$heading.append( $( `<th class=\"form-repeater-fields__table-heading-cell form-repeater-fields__table-heading-cell--actions\"></th>` ) );\r\n\r\n\t\t// Append heading\r\n\t\tconst $headingContainer = $table.find( '.form-repeater-fields__table-heading' );\r\n\t\t$headingContainer.append( $heading );\r\n\r\n\t\t// Create HTML of the rows\r\n\t\tconst $rows = $table.find( '.form-repeater-fields__table-rows' );\r\n\r\n\t\t// Get number of rows\r\n\t\tconst numberOfRows = this.fieldRows.length;\r\n\r\n\t\t// Iterate rows of fields\r\n\t\tthis.fieldRows.forEach(( row, index ) => {\r\n\t\t\t// Create container for the row\r\n\t\t\tconst $row = $( `<tr data-order=\"${ index }\"></tr>` );\r\n\r\n\t\t\t// Add the column with for the row number\r\n\t\t\t$row.append( $( `<td class=\"form-repeater-fields__table-rows-cell form-repeater-fields__table-rows-cell--number\">${ ( index + 1 ) }</td>` ) );\r\n\r\n\t\t\t// Add fields\r\n\t\t\trow.forEach(( Field, index ) => {\r\n\t\t\t\t// Create container\r\n\t\t\t\tconst $fieldCell = $( `<td class=\"form-repeater-fields__table-rows-cell\"></td>` );\r\n\r\n\t\t\t\t// Get field's DOM element\r\n\t\t\t\tconst $field = Field.getFormElement();\r\n\t\t\t\t// Make sure all the libraries had been initialized\r\n\t\t\t\tField.initLibraries();\r\n\r\n\t\t\t\t// Add field container\r\n\t\t\t\t$fieldCell.append( $field );\r\n\r\n\t\t\t\t// Append field cell to the row\r\n\t\t\t\t$row.append( $fieldCell );\r\n\t\t\t});\r\n\r\n\t\t\t// Add the column for the actions, and add the delete button\r\n\t\t\tconst $actions = $( `<td class=\"form-repeater-fields__table-rows-cell form-repeater-fields__table-rows-cell--actions\"></td>` );\r\n\t\t\t$row.append( $actions );\r\n\r\n\t\t\t// Check if the field requires at least on row and if this is the first row\r\n\t\t\tif ( index != 0 || ( index == 0 && ( ! this.attributes.isRequired || numberOfRows > 1 ) ) ){\r\n\t\t\t\t// Check if there is a custom \"Remove row\" label. If there is one,\r\n\t\t\t\t// use that, otherwise use the default one\r\n\t\t\t\tlet removeRowLabel = isDefined( this.attributes.removeRowButtonLabel ) ? this.attributes.removeRowButtonLabel : UncannyAutomator.i18n.removeRow;\r\n\r\n\t\t\t\t// Create delete button\r\n\t\t\t\tconst $removeRowButton = $( `<div class=\"form-repeater-fields__table-rows-cell-remove\" uap-tooltip=\"${ removeRowLabel }\"><span></span></div>` );\r\n\r\n\t\t\t\t// Listen clicks to the remove button\r\n\t\t\t\t$removeRowButton.on( 'click', () => {\r\n\t\t\t\t\t// Remove the row by index\r\n\t\t\t\t\tthis.deleteRow( index );\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Add remove button to the actions cell\r\n\t\t\t\t$actions.append( $removeRowButton );\r\n\t\t\t}\r\n\r\n\t\t\t// Add $row to the $rows element\r\n\t\t\t$rows.append( $row );\r\n\t\t});\r\n\r\n\t\t// Create \"Add row\" button\r\n\t\tconst $addRowButton = $( `\r\n\t\t\t<div class=\"uap-btn uap-btn--primary uap-btn--small\">\r\n\t\t\t\t${ UncannyAutomator.i18n.addRow }\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Check if we have to change label of the button\r\n\t\tif ( isDefined( this.attributes.addRowButtonLabel ) ){\r\n\t\t\t$addRowButton.text( this.attributes.addRowButtonLabel );\r\n\t\t}\r\n\r\n\t\t// Listen clicks\r\n\t\t$addRowButton.on( 'click', () => {\r\n\t\t\t// Add another row\r\n\t\t\tthis.addRow();\r\n\t\t});\r\n\r\n\t\t// Add actions\r\n\t\tconst $actionsContainer = $table.find( '.form-repeater-fields__actions' );\r\n\t\t$actionsContainer.append( $addRowButton );\r\n\r\n\t\treturn $table;\r\n\t}\r\n\r\n\t/**\r\n\t * Get value\r\n\t *\r\n\t * @since  2.0\r\n\t *\r\n\t * @return {object} Object where the key is the field ID and the value is the field's value\r\n\t */\r\n\t\r\n\tgetValue(){\r\n\t\t// Create object where we're going to save the values\r\n\t\tlet value = [];\r\n\r\n\t\t// Iterate rows\r\n\t\tthis.fieldRows.forEach(( row, index ) => {\r\n\t\t\t// Get the value of the fields\r\n\t\t\tlet fieldsValue = {}\r\n\r\n\t\t\t// Iterate fields\r\n\t\t\trow.forEach(( Field, index ) => {\r\n\t\t\t\t// Add it to the fieldsValue object\r\n\t\t\t\tfieldsValue[ Field.getFieldID() ] = Field.getValue();\r\n\t\t\t});\r\n\r\n\t\t\t// Add fields value to the main array\r\n\t\t\tvalue.push( fieldsValue );\r\n\t\t});\r\n\r\n\t\t// Return value\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Add row\r\n\t *\r\n\t * @since  2.0\r\n\t */\r\n\t\r\n\taddRow( fieldsData = {}, reRender = true ){\r\n\t\t// Create an empty row\r\n\t\tlet emptyRow = JSON.parse( JSON.stringify( this.attributes.fields ) );\r\n\r\n\t\t// Remove undefined current value\r\n\t\temptyRow.currentValue = '';\r\n\r\n\t\t// Now iterate the fields\r\n\t\temptyRow = emptyRow.map(( fieldObject, index ) => {\r\n\t\t\t// Remove the label\r\n\t\t\tfieldObject.label = '';\r\n\r\n\t\t\t// Remove the description\r\n\t\t\tfieldObject.description = '';\r\n\r\n\t\t\t// Check if there is a default value for this field\r\n\t\t\tif ( isDefined( fieldsData[ fieldObject.optionCode ] ) ){\r\n\t\t\t\t// And if there is, use that data\r\n\t\t\t\tfieldObject.currentValue = fieldsData[ fieldObject.optionCode ];\r\n\t\t\t}\r\n\r\n\t\t\t// Create field\r\n\t\t\tlet field = new Field( fieldObject.fieldType, fieldObject );\r\n\r\n\t\t\t// Return field instance\r\n\t\t\treturn field;\r\n\t\t});\r\n\r\n\t\t// Add it to the rows of fields\r\n\t\tthis.fieldRows.push( emptyRow );\r\n\r\n\t\t// Render form element again\r\n\t\tif ( reRender ){\r\n\t\t\tthis.reRender();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Rerender the field again\r\n\t */\r\n\r\n\treRender(){\r\n\t\tthis.formElement.replaceWith( this.createFormElement() );\r\n\t}\r\n\r\n\t/**\r\n\t * Delete row\r\n\t *\r\n\t * @since  2.0\r\n\t */\r\n\t\r\n\tdeleteRow( index ){\r\n\t\t// Check if there is a row with that index\r\n\t\tif ( isDefined( this.fieldRows[ index ] ) ){\r\n\t\t\t// Remove element\r\n\t\t\tthis.fieldRows.splice( index, 1 );\r\n\t\t}\r\n\r\n\t\t// Render form element again\r\n\t\tthis.formElement.replaceWith( this.createFormElement() );\r\n\t}\r\n\r\n\t/**\r\n\t * Get form element\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @return {object} jQuery object of the field's container\r\n\t */\r\n\r\n\tgetFormElement(){\r\n\t\t// Return form element\r\n\t\treturn this.formElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Get attributes\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @return {object} Field attributes\r\n\t */\r\n\r\n\tgetAttributes(){\r\n\t\treturn this.attributes;\r\n\t}\r\n\r\n\t/**\r\n\t * Get field ID\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @return {string} The field ID\r\n\t */\r\n\r\n\tgetFieldID(){\r\n\t\treturn this.attributes.optionCode;\r\n\t}\r\n\r\n\t/**\r\n\t * Validate the fields\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @param  {boolean} renderError - TRUE if you want to render the field errors, FALSE if you only want to return the response object\r\n\t *\r\n\t * @return {object} Object where the key is the field ID and the value is a validateField object\r\n\t */\r\n\t\r\n\tvalidate( renderError = true ){\r\n\t\t// Create validation object\r\n\t\tlet validation = {\r\n\t\t\tisValid: true,\r\n\t\t\tmessage: ''\r\n\t\t}\r\n\r\n\t\t// Create array to save the validation of the rows\r\n\t\tlet rowsValidation = [];\r\n\r\n\t\t// Iterate fields\r\n\t\tthis.fieldRows.forEach(( row, index ) => {\r\n\t\t\t// Create object to save the row validation\r\n\t\t\tlet rowValidation = {}\r\n\r\n\t\t\t// Iterate each field\r\n\t\t\trow.forEach(( Field, index ) => {\r\n\t\t\t\t// Validate and add response to the validation object\r\n\t\t\t\trowValidation[ Field.getFieldID() ] = Field.validate( renderError );\r\n\r\n\t\t\t\t// Update global validation\r\n\t\t\t\tvalidation.isValid = validation.isValid && rowValidation[ Field.getFieldID() ].isValid;\r\n\t\t\t});\r\n\r\n\t\t\t// Add row validation to the main validation array\r\n\t\t\trowsValidation.push( rowValidation );\r\n\t\t});\r\n\r\n\t\t// Return validation object\r\n\t\treturn validation;\r\n\t}\r\n}\r\n\r\nexport default FieldsRepeater;\n\n\n// WEBPACK FOOTER //\n// ./src/components/FieldsRepeater.js","/*\n * HTML5Sortable package\n * https://github.com/lukasoppermann/html5sortable\n *\n * Maintained by Lukas Oppermann <lukas@vea.re>\n *\n * Released under the MIT license.\n */\n'use strict';\n\n/**\n * Get or set data on element\n * @param {HTMLElement} element\n * @param {string} key\n * @param {any} value\n * @return {*}\n */\nfunction addData(element, key, value) {\n    if (value === undefined) {\n        return element && element.h5s && element.h5s.data && element.h5s.data[key];\n    }\n    else {\n        element.h5s = element.h5s || {};\n        element.h5s.data = element.h5s.data || {};\n        element.h5s.data[key] = value;\n    }\n}\n/**\n * Remove data from element\n * @param {HTMLElement} element\n */\nfunction removeData(element) {\n    if (element.h5s) {\n        delete element.h5s.data;\n    }\n}\n\n/* eslint-env browser */\n/**\n * Filter only wanted nodes\n * @param {NodeList|HTMLCollection|Array} nodes\n * @param {String} selector\n * @returns {Array}\n */\nvar _filter = (function (nodes, selector) {\n    if (!(nodes instanceof NodeList || nodes instanceof HTMLCollection || nodes instanceof Array)) {\n        throw new Error('You must provide a nodeList/HTMLCollection/Array of elements to be filtered.');\n    }\n    if (typeof selector !== 'string') {\n        return Array.from(nodes);\n    }\n    return Array.from(nodes).filter(function (item) { return item.nodeType === 1 && item.matches(selector); });\n});\n\n/* eslint-env browser */\nvar stores = new Map();\n/**\n * Stores data & configurations per Sortable\n * @param {Object} config\n */\nvar Store = /** @class */ (function () {\n    function Store() {\n        this._config = new Map(); // eslint-disable-line no-undef\n        this._placeholder = undefined; // eslint-disable-line no-undef\n        this._data = new Map(); // eslint-disable-line no-undef\n    }\n    Object.defineProperty(Store.prototype, \"config\", {\n        /**\n         * get the configuration map of a class instance\n         * @method config\n         * @return {object}\n         */\n        get: function () {\n            // transform Map to object\n            var config = {};\n            this._config.forEach(function (value, key) {\n                config[key] = value;\n            });\n            // return object\n            return config;\n        },\n        /**\n         * set the configuration of a class instance\n         * @method config\n         * @param {object} config object of configurations\n         */\n        set: function (config) {\n            if (typeof config !== 'object') {\n                throw new Error('You must provide a valid configuration object to the config setter.');\n            }\n            // combine config with default\n            var mergedConfig = Object.assign({}, config);\n            // add config to map\n            this._config = new Map(Object.entries(mergedConfig));\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * set individual configuration of a class instance\n     * @method setConfig\n     * @param  key valid configuration key\n     * @param  value any value\n     * @return void\n     */\n    Store.prototype.setConfig = function (key, value) {\n        if (!this._config.has(key)) {\n            throw new Error(\"Trying to set invalid configuration item: \" + key);\n        }\n        // set config\n        this._config.set(key, value);\n    };\n    /**\n     * get an individual configuration of a class instance\n     * @method getConfig\n     * @param  key valid configuration key\n     * @return any configuration value\n     */\n    Store.prototype.getConfig = function (key) {\n        if (!this._config.has(key)) {\n            throw new Error(\"Invalid configuration item requested: \" + key);\n        }\n        return this._config.get(key);\n    };\n    Object.defineProperty(Store.prototype, \"placeholder\", {\n        /**\n         * get the placeholder for a class instance\n         * @method placeholder\n         * @return {HTMLElement|null}\n         */\n        get: function () {\n            return this._placeholder;\n        },\n        /**\n         * set the placeholder for a class instance\n         * @method placeholder\n         * @param {HTMLElement} placeholder\n         * @return {void}\n         */\n        set: function (placeholder) {\n            if (!(placeholder instanceof HTMLElement) && placeholder !== null) {\n                throw new Error('A placeholder must be an html element or null.');\n            }\n            this._placeholder = placeholder;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * set an data entry\n     * @method setData\n     * @param {string} key\n     * @param {any} value\n     * @return {void}\n     */\n    Store.prototype.setData = function (key, value) {\n        if (typeof key !== 'string') {\n            throw new Error('The key must be a string.');\n        }\n        this._data.set(key, value);\n    };\n    /**\n     * get an data entry\n     * @method getData\n     * @param {string} key an existing key\n     * @return {any}\n     */\n    Store.prototype.getData = function (key) {\n        if (typeof key !== 'string') {\n            throw new Error('The key must be a string.');\n        }\n        return this._data.get(key);\n    };\n    /**\n     * delete an data entry\n     * @method deleteData\n     * @param {string} key an existing key\n     * @return {boolean}\n     */\n    Store.prototype.deleteData = function (key) {\n        if (typeof key !== 'string') {\n            throw new Error('The key must be a string.');\n        }\n        return this._data.delete(key);\n    };\n    return Store;\n}());\n/**\n * @param {HTMLElement} sortableElement\n * @returns {Class: Store}\n */\nvar store = (function (sortableElement) {\n    // if sortableElement is wrong type\n    if (!(sortableElement instanceof HTMLElement)) {\n        throw new Error('Please provide a sortable to the store function.');\n    }\n    // create new instance if not avilable\n    if (!stores.has(sortableElement)) {\n        stores.set(sortableElement, new Store());\n    }\n    // return instance\n    return stores.get(sortableElement);\n});\n\n/**\n * @param {Array|HTMLElement} element\n * @param {Function} callback\n * @param {string} event\n */\nfunction addEventListener(element, eventName, callback) {\n    if (element instanceof Array) {\n        for (var i = 0; i < element.length; ++i) {\n            addEventListener(element[i], eventName, callback);\n        }\n        return;\n    }\n    element.addEventListener(eventName, callback);\n    store(element).setData(\"event\" + eventName, callback);\n}\n/**\n * @param {Array<HTMLElement>|HTMLElement} element\n * @param {string} eventName\n */\nfunction removeEventListener(element, eventName) {\n    if (element instanceof Array) {\n        for (var i = 0; i < element.length; ++i) {\n            removeEventListener(element[i], eventName);\n        }\n        return;\n    }\n    element.removeEventListener(eventName, store(element).getData(\"event\" + eventName));\n    store(element).deleteData(\"event\" + eventName);\n}\n\n/**\n * @param {Array<HTMLElement>|HTMLElement} element\n * @param {string} attribute\n * @param {string} value\n */\nfunction addAttribute(element, attribute, value) {\n    if (element instanceof Array) {\n        for (var i = 0; i < element.length; ++i) {\n            addAttribute(element[i], attribute, value);\n        }\n        return;\n    }\n    element.setAttribute(attribute, value);\n}\n/**\n * @param {Array|HTMLElement} element\n * @param {string} attribute\n */\nfunction removeAttribute(element, attribute) {\n    if (element instanceof Array) {\n        for (var i = 0; i < element.length; ++i) {\n            removeAttribute(element[i], attribute);\n        }\n        return;\n    }\n    element.removeAttribute(attribute);\n}\n\n/**\n * @param {HTMLElement} element\n * @returns {Object}\n */\nvar _offset = (function (element) {\n    if (!element.parentElement || element.getClientRects().length === 0) {\n        throw new Error('target element must be part of the dom');\n    }\n    var rect = element.getClientRects()[0];\n    return {\n        left: rect.left + window.pageXOffset,\n        right: rect.right + window.pageXOffset,\n        top: rect.top + window.pageYOffset,\n        bottom: rect.bottom + window.pageYOffset\n    };\n});\n\n/**\n * Creates and returns a new debounced version of the passed function which will postpone its execution until after wait milliseconds have elapsed\n * @param {Function} func to debounce\n * @param {number} time to wait before calling function with latest arguments, 0 - no debounce\n * @returns {function} - debounced function\n */\nvar _debounce = (function (func, wait) {\n    if (wait === void 0) { wait = 0; }\n    var timeout;\n    return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        clearTimeout(timeout);\n        timeout = setTimeout(function () {\n            func.apply(void 0, args);\n        }, wait);\n    };\n});\n\n/* eslint-env browser */\n/**\n * Get position of the element relatively to its sibling elements\n * @param {HTMLElement} element\n * @returns {number}\n */\nvar _index = (function (element, elementList) {\n    if (!(element instanceof HTMLElement) || !(elementList instanceof NodeList || elementList instanceof HTMLCollection || elementList instanceof Array)) {\n        throw new Error('You must provide an element and a list of elements.');\n    }\n    return Array.from(elementList).indexOf(element);\n});\n\n/* eslint-env browser */\n/**\n * Test whether element is in DOM\n * @param {HTMLElement} element\n * @returns {boolean}\n */\nvar isInDom = (function (element) {\n    if (!(element instanceof HTMLElement)) {\n        throw new Error('Element is not a node element.');\n    }\n    return element.parentNode !== null;\n});\n\n/* eslint-env browser */\n/**\n * Insert node before or after target\n * @param {HTMLElement} referenceNode - reference element\n * @param {HTMLElement} newElement - element to be inserted\n * @param {String} position - insert before or after reference element\n */\nvar insertNode = function (referenceNode, newElement, position) {\n    if (!(referenceNode instanceof HTMLElement) || !(referenceNode.parentElement instanceof HTMLElement)) {\n        throw new Error('target and element must be a node');\n    }\n    referenceNode.parentElement.insertBefore(newElement, (position === 'before' ? referenceNode : referenceNode.nextElementSibling));\n};\n/**\n * Insert before target\n * @param {HTMLElement} target\n * @param {HTMLElement} element\n */\nvar insertBefore = function (target, element) { return insertNode(target, element, 'before'); };\n/**\n * Insert after target\n * @param {HTMLElement} target\n * @param {HTMLElement} element\n */\nvar insertAfter = function (target, element) { return insertNode(target, element, 'after'); };\n\n/* eslint-env browser */\n/**\n * Filter only wanted nodes\n * @param {HTMLElement} sortableContainer\n * @param {Function} customSerializer\n * @returns {Array}\n */\nvar _serialize = (function (sortableContainer, customItemSerializer, customContainerSerializer) {\n    if (customItemSerializer === void 0) { customItemSerializer = function (serializedItem, sortableContainer) { return serializedItem; }; }\n    if (customContainerSerializer === void 0) { customContainerSerializer = function (serializedContainer) { return serializedContainer; }; }\n    // check for valid sortableContainer\n    if (!(sortableContainer instanceof HTMLElement) || !sortableContainer.isSortable === true) {\n        throw new Error('You need to provide a sortableContainer to be serialized.');\n    }\n    // check for valid serializers\n    if (typeof customItemSerializer !== 'function' || typeof customContainerSerializer !== 'function') {\n        throw new Error('You need to provide a valid serializer for items and the container.');\n    }\n    // get options\n    var options = addData(sortableContainer, 'opts');\n    var item = options.items;\n    // serialize container\n    var items = _filter(sortableContainer.children, item);\n    var serializedItems = items.map(function (item) {\n        return {\n            parent: sortableContainer,\n            node: item,\n            html: item.outerHTML,\n            index: _index(item, items)\n        };\n    });\n    // serialize container\n    var container = {\n        node: sortableContainer,\n        itemCount: serializedItems.length\n    };\n    return {\n        container: customContainerSerializer(container),\n        items: serializedItems.map(function (item) { return customItemSerializer(item, sortableContainer); })\n    };\n});\n\n/* eslint-env browser */\n/**\n * create a placeholder element\n * @param {HTMLElement} sortableElement a single sortable\n * @param {string|undefined} placeholder a string representing an html element\n * @param {string} placeholderClasses a string representing the classes that should be added to the placeholder\n */\nvar _makePlaceholder = (function (sortableElement, placeholder, placeholderClass) {\n    var _a;\n    if (placeholderClass === void 0) { placeholderClass = 'sortable-placeholder'; }\n    if (!(sortableElement instanceof HTMLElement)) {\n        throw new Error('You must provide a valid element as a sortable.');\n    }\n    // if placeholder is not an element\n    if (!(placeholder instanceof HTMLElement) && placeholder !== undefined) {\n        throw new Error('You must provide a valid element as a placeholder or set ot to undefined.');\n    }\n    // if no placeholder element is given\n    if (placeholder === undefined) {\n        if (['UL', 'OL'].includes(sortableElement.tagName)) {\n            placeholder = document.createElement('li');\n        }\n        else if (['TABLE', 'TBODY'].includes(sortableElement.tagName)) {\n            placeholder = document.createElement('tr');\n            // set colspan to always all rows, otherwise the item can only be dropped in first column\n            placeholder.innerHTML = '<td colspan=\"100\"></td>';\n        }\n        else {\n            placeholder = document.createElement('div');\n        }\n    }\n    // add classes to placeholder\n    if (typeof placeholderClass === 'string') {\n        (_a = placeholder.classList).add.apply(_a, placeholderClass.split(' '));\n    }\n    return placeholder;\n});\n\n/* eslint-env browser */\n/**\n * Get height of an element including padding\n * @param {HTMLElement} element an dom element\n */\nvar _getElementHeight = (function (element) {\n    if (!(element instanceof HTMLElement)) {\n        throw new Error('You must provide a valid dom element');\n    }\n    // get calculated style of element\n    var style = window.getComputedStyle(element);\n    // pick applicable properties, convert to int and reduce by adding\n    return ['height', 'padding-top', 'padding-bottom']\n        .map(function (key) {\n        var int = parseInt(style.getPropertyValue(key), 10);\n        return isNaN(int) ? 0 : int;\n    })\n        .reduce(function (sum, value) { return sum + value; });\n});\n\n/* eslint-env browser */\n/**\n * Get width of an element including padding\n * @param {HTMLElement} element an dom element\n */\nvar _getElementWidth = (function (element) {\n    if (!(element instanceof HTMLElement)) {\n        throw new Error('You must provide a valid dom element');\n    }\n    // get calculated style of element\n    var style = window.getComputedStyle(element);\n    // pick applicable properties, convert to int and reduce by adding\n    return ['width', 'padding-left', 'padding-right']\n        .map(function (key) {\n        var int = parseInt(style.getPropertyValue(key), 10);\n        return isNaN(int) ? 0 : int;\n    })\n        .reduce(function (sum, value) { return sum + value; });\n});\n\n/* eslint-env browser */\n/**\n * get handle or return item\n * @param {Array<HTMLElement>} items\n * @param {string} selector\n */\nvar _getHandles = (function (items, selector) {\n    if (!(items instanceof Array)) {\n        throw new Error('You must provide a Array of HTMLElements to be filtered.');\n    }\n    if (typeof selector !== 'string') {\n        return items;\n    }\n    return items\n        // remove items without handle from array\n        .filter(function (item) {\n        return item.querySelector(selector) instanceof HTMLElement ||\n            (item.shadowRoot && item.shadowRoot.querySelector(selector) instanceof HTMLElement);\n    })\n        // replace item with handle in array\n        .map(function (item) {\n        return item.querySelector(selector) || (item.shadowRoot && item.shadowRoot.querySelector(selector));\n    });\n});\n\n/**\n * @param {Event} event\n * @returns {HTMLElement}\n */\nvar getEventTarget = (function (event) {\n    return (event.composedPath && event.composedPath()[0]) || event.target;\n});\n\n/* eslint-env browser */\n/**\n * defaultDragImage returns the current item as dragged image\n * @param {HTMLElement} draggedElement - the item that the user drags\n * @param {object} elementOffset - an object with the offsets top, left, right & bottom\n * @param {Event} event - the original drag event object\n * @return {object} with element, posX and posY properties\n */\nvar defaultDragImage = function (draggedElement, elementOffset, event) {\n    return {\n        element: draggedElement,\n        posX: event.pageX - elementOffset.left,\n        posY: event.pageY - elementOffset.top\n    };\n};\n/**\n * attaches an element as the drag image to an event\n * @param {Event} event - the original drag event object\n * @param {HTMLElement} draggedElement - the item that the user drags\n * @param {Function} customDragImage - function to create a custom dragImage\n * @return void\n */\nvar setDragImage = (function (event, draggedElement, customDragImage) {\n    // check if event is provided\n    if (!(event instanceof Event)) {\n        throw new Error('setDragImage requires a DragEvent as the first argument.');\n    }\n    // check if draggedElement is provided\n    if (!(draggedElement instanceof HTMLElement)) {\n        throw new Error('setDragImage requires the dragged element as the second argument.');\n    }\n    // set default function of none provided\n    if (!customDragImage) {\n        customDragImage = defaultDragImage;\n    }\n    // check if setDragImage method is available\n    if (event.dataTransfer && event.dataTransfer.setDragImage) {\n        // get the elements offset\n        var elementOffset = _offset(draggedElement);\n        // get the dragImage\n        var dragImage = customDragImage(draggedElement, elementOffset, event);\n        // check if custom function returns correct values\n        if (!(dragImage.element instanceof HTMLElement) || typeof dragImage.posX !== 'number' || typeof dragImage.posY !== 'number') {\n            throw new Error('The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].');\n        }\n        // needs to be set for HTML5 drag & drop to work\n        event.dataTransfer.effectAllowed = 'copyMove';\n        // Firefox requires it to use the event target's id for the data\n        event.dataTransfer.setData('text/plain', getEventTarget(event).id);\n        // set the drag image on the event\n        event.dataTransfer.setDragImage(dragImage.element, dragImage.posX, dragImage.posY);\n    }\n});\n\n/**\n * Check if curList accepts items from destList\n * @param {sortable} destination the container an item is move to\n * @param {sortable} origin the container an item comes from\n */\nvar _listsConnected = (function (destination, origin) {\n    // check if valid sortable\n    if (destination.isSortable === true) {\n        var acceptFrom = store(destination).getConfig('acceptFrom');\n        // check if acceptFrom is valid\n        if (acceptFrom !== null && acceptFrom !== false && typeof acceptFrom !== 'string') {\n            throw new Error('HTML5Sortable: Wrong argument, \"acceptFrom\" must be \"null\", \"false\", or a valid selector string.');\n        }\n        if (acceptFrom !== null) {\n            return acceptFrom !== false && acceptFrom.split(',').filter(function (sel) {\n                return sel.length > 0 && origin.matches(sel);\n            }).length > 0;\n        }\n        // drop in same list\n        if (destination === origin) {\n            return true;\n        }\n        // check if lists are connected with connectWith\n        if (store(destination).getConfig('connectWith') !== undefined && store(destination).getConfig('connectWith') !== null) {\n            return store(destination).getConfig('connectWith') === store(origin).getConfig('connectWith');\n        }\n    }\n    return false;\n});\n\n/**\n * default configurations\n */\nvar defaultConfiguration = {\n    items: null,\n    // deprecated\n    connectWith: null,\n    // deprecated\n    disableIEFix: null,\n    acceptFrom: null,\n    copy: false,\n    placeholder: null,\n    placeholderClass: 'sortable-placeholder',\n    draggingClass: 'sortable-dragging',\n    hoverClass: false,\n    debounce: 0,\n    throttleTime: 100,\n    maxItems: 0,\n    itemSerializer: undefined,\n    containerSerializer: undefined,\n    customDragImage: null,\n    orientation: 'vertical'\n};\n\n/**\n * make sure a function is only called once within the given amount of time\n * @param {Function} fn the function to throttle\n * @param {number} threshold time limit for throttling\n */\n// must use function to keep this context\nfunction _throttle (fn, threshold) {\n    var _this = this;\n    if (threshold === void 0) { threshold = 250; }\n    // check function\n    if (typeof fn !== 'function') {\n        throw new Error('You must provide a function as the first argument for throttle.');\n    }\n    // check threshold\n    if (typeof threshold !== 'number') {\n        throw new Error('You must provide a number as the second argument for throttle.');\n    }\n    var lastEventTimestamp = null;\n    return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var now = Date.now();\n        if (lastEventTimestamp === null || now - lastEventTimestamp >= threshold) {\n            lastEventTimestamp = now;\n            fn.apply(_this, args);\n        }\n    };\n}\n\n/* eslint-env browser */\n/**\n * enable or disable hoverClass on mouseenter/leave if container Items\n * @param {sortable} sortableContainer a valid sortableContainer\n * @param {boolean} enable enable or disable event\n */\n// export default (sortableContainer: sortable, enable: boolean) => {\nvar enableHoverClass = (function (sortableContainer, enable) {\n    if (typeof store(sortableContainer).getConfig('hoverClass') === 'string') {\n        var hoverClasses_1 = store(sortableContainer).getConfig('hoverClass').split(' ');\n        // add class on hover\n        if (enable === true) {\n            addEventListener(sortableContainer, 'mousemove', _throttle(function (event) {\n                // check of no mouse button was pressed when mousemove started == no drag\n                if (event.buttons === 0) {\n                    _filter(sortableContainer.children, store(sortableContainer).getConfig('items')).forEach(function (item) {\n                        var _a, _b;\n                        if (item !== event.target) {\n                            (_a = item.classList).remove.apply(_a, hoverClasses_1);\n                        }\n                        else {\n                            (_b = item.classList).add.apply(_b, hoverClasses_1);\n                        }\n                    });\n                }\n            }, store(sortableContainer).getConfig('throttleTime')));\n            // remove class on leave\n            addEventListener(sortableContainer, 'mouseleave', function () {\n                _filter(sortableContainer.children, store(sortableContainer).getConfig('items')).forEach(function (item) {\n                    var _a;\n                    (_a = item.classList).remove.apply(_a, hoverClasses_1);\n                });\n            });\n            // remove events\n        }\n        else {\n            removeEventListener(sortableContainer, 'mousemove');\n            removeEventListener(sortableContainer, 'mouseleave');\n        }\n    }\n});\n\n/* eslint-env browser */\n/*\n * variables global to the plugin\n */\nvar dragging;\nvar draggingHeight;\nvar draggingWidth;\n/*\n * Keeps track of the initialy selected list, where 'dragstart' event was triggered\n * It allows us to move the data in between individual Sortable List instances\n */\n// Origin List - data from before any item was changed\nvar originContainer;\nvar originIndex;\nvar originElementIndex;\nvar originItemsBeforeUpdate;\n// Previous Sortable Container - we dispatch as sortenter event when a\n// dragged item enters a sortableContainer for the first time\nvar previousContainer;\n// Destination List - data from before any item was changed\nvar destinationItemsBeforeUpdate;\n/**\n * remove event handlers from items\n * @param {Array|NodeList} items\n */\nvar _removeItemEvents = function (items) {\n    removeEventListener(items, 'dragstart');\n    removeEventListener(items, 'dragend');\n    removeEventListener(items, 'dragover');\n    removeEventListener(items, 'dragenter');\n    removeEventListener(items, 'drop');\n    removeEventListener(items, 'mouseenter');\n    removeEventListener(items, 'mouseleave');\n};\n/**\n * _getDragging returns the current element to drag or\n * a copy of the element.\n * Is Copy Active for sortable\n * @param {HTMLElement} draggedItem - the item that the user drags\n * @param {HTMLElement} sortable a single sortable\n */\nvar _getDragging = function (draggedItem, sortable) {\n    var ditem = draggedItem;\n    if (store(sortable).getConfig('copy') === true) {\n        ditem = draggedItem.cloneNode(true);\n        addAttribute(ditem, 'aria-copied', 'true');\n        draggedItem.parentElement.appendChild(ditem);\n        ditem.style.display = 'none';\n        ditem.oldDisplay = draggedItem.style.display;\n    }\n    return ditem;\n};\n/**\n * Remove data from sortable\n * @param {HTMLElement} sortable a single sortable\n */\nvar _removeSortableData = function (sortable) {\n    removeData(sortable);\n    removeAttribute(sortable, 'aria-dropeffect');\n};\n/**\n * Remove data from items\n * @param {Array<HTMLElement>|HTMLElement} items\n */\nvar _removeItemData = function (items) {\n    removeAttribute(items, 'aria-grabbed');\n    removeAttribute(items, 'aria-copied');\n    removeAttribute(items, 'draggable');\n    removeAttribute(items, 'role');\n};\n/**\n * find sortable from element. travels up parent element until found or null.\n * @param {HTMLElement} element a single sortable\n * @param {Event} event - the current event. We need to pass it to be able to\n * find Sortable whith shadowRoot (document fragment has no parent)\n */\nfunction findSortable(element, event) {\n    if (event.composedPath) {\n        return event.composedPath().find(function (el) { return el.isSortable; });\n    }\n    while (element.isSortable !== true) {\n        element = element.parentElement;\n    }\n    return element;\n}\n/**\n * Dragging event is on the sortable element. finds the top child that\n * contains the element.\n * @param {HTMLElement} sortableElement a single sortable\n * @param {HTMLElement} element is that being dragged\n */\nfunction findDragElement(sortableElement, element) {\n    var options = addData(sortableElement, 'opts');\n    var items = _filter(sortableElement.children, options.items);\n    var itemlist = items.filter(function (ele) {\n        return ele.contains(element) || (ele.shadowRoot && ele.shadowRoot.contains(element));\n    });\n    return itemlist.length > 0 ? itemlist[0] : element;\n}\n/**\n * Destroy the sortable\n * @param {HTMLElement} sortableElement a single sortable\n */\nvar _destroySortable = function (sortableElement) {\n    var opts = addData(sortableElement, 'opts') || {};\n    var items = _filter(sortableElement.children, opts.items);\n    var handles = _getHandles(items, opts.handle);\n    // remove event handlers & data from sortable\n    removeEventListener(sortableElement, 'dragover');\n    removeEventListener(sortableElement, 'dragenter');\n    removeEventListener(sortableElement, 'dragstart');\n    removeEventListener(sortableElement, 'dragend');\n    removeEventListener(sortableElement, 'drop');\n    // remove event data from sortable\n    _removeSortableData(sortableElement);\n    // remove event handlers & data from items\n    removeEventListener(handles, 'mousedown');\n    _removeItemEvents(items);\n    _removeItemData(items);\n    // clear sortable flag\n    sortableElement.isSortable = false;\n};\n/**\n * Enable the sortable\n * @param {HTMLElement} sortableElement a single sortable\n */\nvar _enableSortable = function (sortableElement) {\n    var opts = addData(sortableElement, 'opts');\n    var items = _filter(sortableElement.children, opts.items);\n    var handles = _getHandles(items, opts.handle);\n    addAttribute(sortableElement, 'aria-dropeffect', 'move');\n    addData(sortableElement, '_disabled', 'false');\n    addAttribute(handles, 'draggable', 'true');\n    // @todo: remove this fix\n    // IE FIX for ghost\n    // can be disabled as it has the side effect that other events\n    // (e.g. click) will be ignored\n    if (opts.disableIEFix === false) {\n        var spanEl = (document || window.document).createElement('span');\n        if (typeof spanEl.dragDrop === 'function') {\n            addEventListener(handles, 'mousedown', function () {\n                if (items.indexOf(this) !== -1) {\n                    this.dragDrop();\n                }\n                else {\n                    var parent = this.parentElement;\n                    while (items.indexOf(parent) === -1) {\n                        parent = parent.parentElement;\n                    }\n                    parent.dragDrop();\n                }\n            });\n        }\n    }\n};\n/**\n * Disable the sortable\n * @param {HTMLElement} sortableElement a single sortable\n */\nvar _disableSortable = function (sortableElement) {\n    var opts = addData(sortableElement, 'opts');\n    var items = _filter(sortableElement.children, opts.items);\n    var handles = _getHandles(items, opts.handle);\n    addAttribute(sortableElement, 'aria-dropeffect', 'none');\n    addData(sortableElement, '_disabled', 'true');\n    addAttribute(handles, 'draggable', 'false');\n    removeEventListener(handles, 'mousedown');\n};\n/**\n * Reload the sortable\n * @param {HTMLElement} sortableElement a single sortable\n * @description events need to be removed to not be double bound\n */\nvar _reloadSortable = function (sortableElement) {\n    var opts = addData(sortableElement, 'opts');\n    var items = _filter(sortableElement.children, opts.items);\n    var handles = _getHandles(items, opts.handle);\n    addData(sortableElement, '_disabled', 'false');\n    // remove event handlers from items\n    _removeItemEvents(items);\n    removeEventListener(handles, 'mousedown');\n    // remove event handlers from sortable\n    removeEventListener(sortableElement, 'dragover');\n    removeEventListener(sortableElement, 'dragenter');\n    removeEventListener(sortableElement, 'drop');\n};\n/**\n * Public sortable object\n * @param {Array|NodeList} sortableElements\n * @param {object|string} options|method\n */\nfunction sortable(sortableElements, options) {\n    // get method string to see if a method is called\n    var method = String(options);\n    options = options || {};\n    // check if the user provided a selector instead of an element\n    if (typeof sortableElements === 'string') {\n        sortableElements = document.querySelectorAll(sortableElements);\n    }\n    // if the user provided an element, return it in an array to keep the return value consistant\n    if (sortableElements instanceof HTMLElement) {\n        sortableElements = [sortableElements];\n    }\n    sortableElements = Array.prototype.slice.call(sortableElements);\n    if (/serialize/.test(method)) {\n        return sortableElements.map(function (sortableContainer) {\n            var opts = addData(sortableContainer, 'opts');\n            return _serialize(sortableContainer, opts.itemSerializer, opts.containerSerializer);\n        });\n    }\n    sortableElements.forEach(function (sortableElement) {\n        if (/enable|disable|destroy/.test(method)) {\n            return sortable[method](sortableElement);\n        }\n        // log deprecation\n        ['connectWith', 'disableIEFix'].forEach(function (configKey) {\n            if (Object.prototype.hasOwnProperty.call(options, configKey) && options[configKey] !== null) {\n                console.warn(\"HTML5Sortable: You are using the deprecated configuration \\\"\" + configKey + \"\\\". This will be removed in an upcoming version, make sure to migrate to the new options when updating.\");\n            }\n        });\n        // merge options with default options\n        options = Object.assign({}, defaultConfiguration, store(sortableElement).config, options);\n        // init data store for sortable\n        store(sortableElement).config = options;\n        // set options on sortable\n        addData(sortableElement, 'opts', options);\n        // property to define as sortable\n        sortableElement.isSortable = true;\n        // reset sortable\n        _reloadSortable(sortableElement);\n        // initialize\n        var listItems = _filter(sortableElement.children, options.items);\n        // create element if user defined a placeholder element as a string\n        var customPlaceholder;\n        if (options.placeholder !== null && options.placeholder !== undefined) {\n            var tempContainer = document.createElement(sortableElement.tagName);\n            if (options.placeholder instanceof HTMLElement) {\n                tempContainer.appendChild(options.placeholder);\n            }\n            else {\n                tempContainer.innerHTML = options.placeholder;\n            }\n            customPlaceholder = tempContainer.children[0];\n        }\n        // add placeholder\n        store(sortableElement).placeholder = _makePlaceholder(sortableElement, customPlaceholder, options.placeholderClass);\n        addData(sortableElement, 'items', options.items);\n        if (options.acceptFrom) {\n            addData(sortableElement, 'acceptFrom', options.acceptFrom);\n        }\n        else if (options.connectWith) {\n            addData(sortableElement, 'connectWith', options.connectWith);\n        }\n        _enableSortable(sortableElement);\n        addAttribute(listItems, 'role', 'option');\n        addAttribute(listItems, 'aria-grabbed', 'false');\n        // enable hover class\n        enableHoverClass(sortableElement, true);\n        /*\n         Handle drag events on draggable items\n         Handle is set at the sortableElement level as it will bubble up\n         from the item\n         */\n        addEventListener(sortableElement, 'dragstart', function (e) {\n            // ignore dragstart events\n            var target = getEventTarget(e);\n            if (target.isSortable === true) {\n                return;\n            }\n            e.stopImmediatePropagation();\n            if ((options.handle && !target.matches(options.handle)) || target.getAttribute('draggable') === 'false') {\n                return;\n            }\n            var sortableContainer = findSortable(target, e);\n            var dragItem = findDragElement(sortableContainer, target);\n            // grab values\n            originItemsBeforeUpdate = _filter(sortableContainer.children, options.items);\n            originIndex = originItemsBeforeUpdate.indexOf(dragItem);\n            originElementIndex = _index(dragItem, sortableContainer.children);\n            originContainer = sortableContainer;\n            // add transparent clone or other ghost to cursor\n            setDragImage(e, dragItem, options.customDragImage);\n            // cache selsection & add attr for dragging\n            draggingHeight = _getElementHeight(dragItem);\n            draggingWidth = _getElementWidth(dragItem);\n            dragItem.classList.add(options.draggingClass);\n            dragging = _getDragging(dragItem, sortableContainer);\n            addAttribute(dragging, 'aria-grabbed', 'true');\n            // dispatch sortstart event on each element in group\n            sortableContainer.dispatchEvent(new CustomEvent('sortstart', {\n                detail: {\n                    origin: {\n                        elementIndex: originElementIndex,\n                        index: originIndex,\n                        container: originContainer\n                    },\n                    item: dragging,\n                    originalTarget: target\n                }\n            }));\n        });\n        /*\n         We are capturing targetSortable before modifications with 'dragenter' event\n        */\n        addEventListener(sortableElement, 'dragenter', function (e) {\n            var target = getEventTarget(e);\n            var sortableContainer = findSortable(target, e);\n            if (sortableContainer && sortableContainer !== previousContainer) {\n                destinationItemsBeforeUpdate = _filter(sortableContainer.children, addData(sortableContainer, 'items'))\n                    .filter(function (item) { return item !== store(sortableElement).placeholder; });\n                sortableContainer.dispatchEvent(new CustomEvent('sortenter', {\n                    detail: {\n                        origin: {\n                            elementIndex: originElementIndex,\n                            index: originIndex,\n                            container: originContainer\n                        },\n                        destination: {\n                            container: sortableContainer,\n                            itemsBeforeUpdate: destinationItemsBeforeUpdate\n                        },\n                        item: dragging,\n                        originalTarget: target\n                    }\n                }));\n            }\n            previousContainer = sortableContainer;\n        });\n        /*\n         * Dragend Event - https://developer.mozilla.org/en-US/docs/Web/Events/dragend\n         * Fires each time dragEvent end, or ESC pressed\n         * We are using it to clean up any draggable elements and placeholders\n         */\n        addEventListener(sortableElement, 'dragend', function (e) {\n            if (!dragging) {\n                return;\n            }\n            dragging.classList.remove(options.draggingClass);\n            addAttribute(dragging, 'aria-grabbed', 'false');\n            if (dragging.getAttribute('aria-copied') === 'true' && addData(dragging, 'dropped') !== 'true') {\n                dragging.remove();\n            }\n            dragging.style.display = dragging.oldDisplay;\n            delete dragging.oldDisplay;\n            var visiblePlaceholder = Array.from(stores.values()).map(function (data) { return data.placeholder; })\n                .filter(function (placeholder) { return placeholder instanceof HTMLElement; })\n                .filter(isInDom)[0];\n            if (visiblePlaceholder) {\n                visiblePlaceholder.remove();\n            }\n            // dispatch sortstart event on each element in group\n            sortableElement.dispatchEvent(new CustomEvent('sortstop', {\n                detail: {\n                    origin: {\n                        elementIndex: originElementIndex,\n                        index: originIndex,\n                        container: originContainer\n                    },\n                    item: dragging\n                }\n            }));\n            previousContainer = null;\n            dragging = null;\n            draggingHeight = null;\n            draggingWidth = null;\n        });\n        /*\n         * Drop Event - https://developer.mozilla.org/en-US/docs/Web/Events/drop\n         * Fires when valid drop target area is hit\n         */\n        addEventListener(sortableElement, 'drop', function (e) {\n            if (!_listsConnected(sortableElement, dragging.parentElement)) {\n                return;\n            }\n            e.preventDefault();\n            e.stopPropagation();\n            addData(dragging, 'dropped', 'true');\n            // get the one placeholder that is currently visible\n            var visiblePlaceholder = Array.from(stores.values()).map(function (data) {\n                return data.placeholder;\n            })\n                // filter only HTMLElements\n                .filter(function (placeholder) { return placeholder instanceof HTMLElement; })\n                // filter only elements in DOM\n                .filter(isInDom)[0];\n            // attach element after placeholder\n            insertAfter(visiblePlaceholder, dragging);\n            // remove placeholder from dom\n            visiblePlaceholder.remove();\n            /*\n             * Fires Custom Event - 'sortstop'\n             */\n            sortableElement.dispatchEvent(new CustomEvent('sortstop', {\n                detail: {\n                    origin: {\n                        elementIndex: originElementIndex,\n                        index: originIndex,\n                        container: originContainer\n                    },\n                    item: dragging\n                }\n            }));\n            var placeholder = store(sortableElement).placeholder;\n            var originItems = _filter(originContainer.children, options.items)\n                .filter(function (item) { return item !== placeholder; });\n            var destinationContainer = this.isSortable === true ? this : this.parentElement;\n            var destinationItems = _filter(destinationContainer.children, addData(destinationContainer, 'items'))\n                .filter(function (item) { return item !== placeholder; });\n            var destinationElementIndex = _index(dragging, Array.from(dragging.parentElement.children)\n                .filter(function (item) { return item !== placeholder; }));\n            var destinationIndex = _index(dragging, destinationItems);\n            /*\n             * When a list item changed container lists or index within a list\n             * Fires Custom Event - 'sortupdate'\n             */\n            if (originElementIndex !== destinationElementIndex || originContainer !== destinationContainer) {\n                sortableElement.dispatchEvent(new CustomEvent('sortupdate', {\n                    detail: {\n                        origin: {\n                            elementIndex: originElementIndex,\n                            index: originIndex,\n                            container: originContainer,\n                            itemsBeforeUpdate: originItemsBeforeUpdate,\n                            items: originItems\n                        },\n                        destination: {\n                            index: destinationIndex,\n                            elementIndex: destinationElementIndex,\n                            container: destinationContainer,\n                            itemsBeforeUpdate: destinationItemsBeforeUpdate,\n                            items: destinationItems\n                        },\n                        item: dragging\n                    }\n                }));\n            }\n        });\n        var debouncedDragOverEnter = _debounce(function (sortableElement, element, pageX, pageY) {\n            if (!dragging) {\n                return;\n            }\n            // set placeholder height if forcePlaceholderSize option is set\n            if (options.forcePlaceholderSize) {\n                store(sortableElement).placeholder.style.height = draggingHeight + 'px';\n                store(sortableElement).placeholder.style.width = draggingWidth + 'px';\n            }\n            // if element the draggedItem is dragged onto is within the array of all elements in list\n            // (not only items, but also disabled, etc.)\n            if (Array.from(sortableElement.children).indexOf(element) > -1) {\n                var thisHeight = _getElementHeight(element);\n                var thisWidth = _getElementWidth(element);\n                var placeholderIndex = _index(store(sortableElement).placeholder, element.parentElement.children);\n                var thisIndex = _index(element, element.parentElement.children);\n                // Check if `element` is bigger than the draggable. If it is, we have to define a dead zone to prevent flickering\n                if (thisHeight > draggingHeight || thisWidth > draggingWidth) {\n                    // Dead zone?\n                    var deadZoneVertical = thisHeight - draggingHeight;\n                    var deadZoneHorizontal = thisWidth - draggingWidth;\n                    var offsetTop = _offset(element).top;\n                    var offsetLeft = _offset(element).left;\n                    if (placeholderIndex < thisIndex &&\n                        ((options.orientation === 'vertical' && pageY < offsetTop) ||\n                            (options.orientation === 'horizontal' && pageX < offsetLeft))) {\n                        return;\n                    }\n                    if (placeholderIndex > thisIndex &&\n                        ((options.orientation === 'vertical' && pageY > offsetTop + thisHeight - deadZoneVertical) ||\n                            (options.orientation === 'horizontal' && pageX > offsetLeft + thisWidth - deadZoneHorizontal))) {\n                        return;\n                    }\n                }\n                if (dragging.oldDisplay === undefined) {\n                    dragging.oldDisplay = dragging.style.display;\n                }\n                if (dragging.style.display !== 'none') {\n                    dragging.style.display = 'none';\n                }\n                // To avoid flicker, determine where to position the placeholder\n                // based on where the mouse pointer is relative to the elements\n                // vertical center.\n                var placeAfter = false;\n                try {\n                    var elementMiddleVertical = _offset(element).top + element.offsetHeight / 2;\n                    var elementMiddleHorizontal = _offset(element).left + element.offsetWidth / 2;\n                    placeAfter = (options.orientation === 'vertical' && (pageY >= elementMiddleVertical)) ||\n                        (options.orientation === 'horizontal' && (pageX >= elementMiddleHorizontal));\n                }\n                catch (e) {\n                    placeAfter = placeholderIndex < thisIndex;\n                }\n                if (placeAfter) {\n                    insertAfter(element, store(sortableElement).placeholder);\n                }\n                else {\n                    insertBefore(element, store(sortableElement).placeholder);\n                }\n                // get placeholders from all stores & remove all but current one\n                Array.from(stores.values())\n                    // remove empty values\n                    .filter(function (data) { return data.placeholder !== undefined; })\n                    // foreach placeholder in array if outside of current sorableContainer -> remove from DOM\n                    .forEach(function (data) {\n                    if (data.placeholder !== store(sortableElement).placeholder) {\n                        data.placeholder.remove();\n                    }\n                });\n            }\n            else {\n                // get all placeholders from store\n                var placeholders = Array.from(stores.values())\n                    .filter(function (data) { return data.placeholder !== undefined; })\n                    .map(function (data) {\n                    return data.placeholder;\n                });\n                // check if element is not in placeholders\n                if (placeholders.indexOf(element) === -1 && sortableElement === element && !_filter(element.children, options.items).length) {\n                    placeholders.forEach(function (element) { return element.remove(); });\n                    element.appendChild(store(sortableElement).placeholder);\n                }\n            }\n        }, options.debounce);\n        // Handle dragover and dragenter events on draggable items\n        var onDragOverEnter = function (e) {\n            var element = e.target;\n            var sortableElement = element.isSortable === true ? element : findSortable(element, e);\n            element = findDragElement(sortableElement, element);\n            if (!dragging || !_listsConnected(sortableElement, dragging.parentElement) || addData(sortableElement, '_disabled') === 'true') {\n                return;\n            }\n            var options = addData(sortableElement, 'opts');\n            if (parseInt(options.maxItems) && _filter(sortableElement.children, addData(sortableElement, 'items')).length >= parseInt(options.maxItems) && dragging.parentElement !== sortableElement) {\n                return;\n            }\n            e.preventDefault();\n            e.stopPropagation();\n            e.dataTransfer.dropEffect = store(sortableElement).getConfig('copy') === true ? 'copy' : 'move';\n            debouncedDragOverEnter(sortableElement, element, e.pageX, e.pageY);\n        };\n        addEventListener(listItems.concat(sortableElement), 'dragover', onDragOverEnter);\n        addEventListener(listItems.concat(sortableElement), 'dragenter', onDragOverEnter);\n    });\n    return sortableElements;\n}\nsortable.destroy = function (sortableElement) {\n    _destroySortable(sortableElement);\n};\nsortable.enable = function (sortableElement) {\n    _enableSortable(sortableElement);\n};\nsortable.disable = function (sortableElement) {\n    _disableSortable(sortableElement);\n};\n/* START.TESTS_ONLY */\nsortable.__testing = {\n    // add internal methods here for testing purposes\n    _data: addData,\n    _removeItemEvents: _removeItemEvents,\n    _removeItemData: _removeItemData,\n    _removeSortableData: _removeSortableData\n};\n\nmodule.exports = sortable;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/html5sortable/dist/html5sortable.cjs.js\n// module id = 25\n// module chunks = 0","/* global window, exports, define */\n\n!function() {\n    'use strict'\n\n    var re = {\n        not_string: /[^s]/,\n        not_bool: /[^t]/,\n        not_type: /[^T]/,\n        not_primitive: /[^v]/,\n        number: /[diefg]/,\n        numeric_arg: /[bcdiefguxX]/,\n        json: /[j]/,\n        not_json: /[^j]/,\n        text: /^[^\\x25]+/,\n        modulo: /^\\x25{2}/,\n        placeholder: /^\\x25(?:([1-9]\\d*)\\$|\\(([^)]+)\\))?(\\+)?(0|'[^$])?(-)?(\\d+)?(?:\\.(\\d+))?([b-gijostTuvxX])/,\n        key: /^([a-z_][a-z_\\d]*)/i,\n        key_access: /^\\.([a-z_][a-z_\\d]*)/i,\n        index_access: /^\\[(\\d+)\\]/,\n        sign: /^[+-]/\n    }\n\n    function sprintf(key) {\n        // `arguments` is not an array, but should be fine for this call\n        return sprintf_format(sprintf_parse(key), arguments)\n    }\n\n    function vsprintf(fmt, argv) {\n        return sprintf.apply(null, [fmt].concat(argv || []))\n    }\n\n    function sprintf_format(parse_tree, argv) {\n        var cursor = 1, tree_length = parse_tree.length, arg, output = '', i, k, ph, pad, pad_character, pad_length, is_positive, sign\n        for (i = 0; i < tree_length; i++) {\n            if (typeof parse_tree[i] === 'string') {\n                output += parse_tree[i]\n            }\n            else if (typeof parse_tree[i] === 'object') {\n                ph = parse_tree[i] // convenience purposes only\n                if (ph.keys) { // keyword argument\n                    arg = argv[cursor]\n                    for (k = 0; k < ph.keys.length; k++) {\n                        if (arg == undefined) {\n                            throw new Error(sprintf('[sprintf] Cannot access property \"%s\" of undefined value \"%s\"', ph.keys[k], ph.keys[k-1]))\n                        }\n                        arg = arg[ph.keys[k]]\n                    }\n                }\n                else if (ph.param_no) { // positional argument (explicit)\n                    arg = argv[ph.param_no]\n                }\n                else { // positional argument (implicit)\n                    arg = argv[cursor++]\n                }\n\n                if (re.not_type.test(ph.type) && re.not_primitive.test(ph.type) && arg instanceof Function) {\n                    arg = arg()\n                }\n\n                if (re.numeric_arg.test(ph.type) && (typeof arg !== 'number' && isNaN(arg))) {\n                    throw new TypeError(sprintf('[sprintf] expecting number but found %T', arg))\n                }\n\n                if (re.number.test(ph.type)) {\n                    is_positive = arg >= 0\n                }\n\n                switch (ph.type) {\n                    case 'b':\n                        arg = parseInt(arg, 10).toString(2)\n                        break\n                    case 'c':\n                        arg = String.fromCharCode(parseInt(arg, 10))\n                        break\n                    case 'd':\n                    case 'i':\n                        arg = parseInt(arg, 10)\n                        break\n                    case 'j':\n                        arg = JSON.stringify(arg, null, ph.width ? parseInt(ph.width) : 0)\n                        break\n                    case 'e':\n                        arg = ph.precision ? parseFloat(arg).toExponential(ph.precision) : parseFloat(arg).toExponential()\n                        break\n                    case 'f':\n                        arg = ph.precision ? parseFloat(arg).toFixed(ph.precision) : parseFloat(arg)\n                        break\n                    case 'g':\n                        arg = ph.precision ? String(Number(arg.toPrecision(ph.precision))) : parseFloat(arg)\n                        break\n                    case 'o':\n                        arg = (parseInt(arg, 10) >>> 0).toString(8)\n                        break\n                    case 's':\n                        arg = String(arg)\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 't':\n                        arg = String(!!arg)\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 'T':\n                        arg = Object.prototype.toString.call(arg).slice(8, -1).toLowerCase()\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 'u':\n                        arg = parseInt(arg, 10) >>> 0\n                        break\n                    case 'v':\n                        arg = arg.valueOf()\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 'x':\n                        arg = (parseInt(arg, 10) >>> 0).toString(16)\n                        break\n                    case 'X':\n                        arg = (parseInt(arg, 10) >>> 0).toString(16).toUpperCase()\n                        break\n                }\n                if (re.json.test(ph.type)) {\n                    output += arg\n                }\n                else {\n                    if (re.number.test(ph.type) && (!is_positive || ph.sign)) {\n                        sign = is_positive ? '+' : '-'\n                        arg = arg.toString().replace(re.sign, '')\n                    }\n                    else {\n                        sign = ''\n                    }\n                    pad_character = ph.pad_char ? ph.pad_char === '0' ? '0' : ph.pad_char.charAt(1) : ' '\n                    pad_length = ph.width - (sign + arg).length\n                    pad = ph.width ? (pad_length > 0 ? pad_character.repeat(pad_length) : '') : ''\n                    output += ph.align ? sign + arg + pad : (pad_character === '0' ? sign + pad + arg : pad + sign + arg)\n                }\n            }\n        }\n        return output\n    }\n\n    var sprintf_cache = Object.create(null)\n\n    function sprintf_parse(fmt) {\n        if (sprintf_cache[fmt]) {\n            return sprintf_cache[fmt]\n        }\n\n        var _fmt = fmt, match, parse_tree = [], arg_names = 0\n        while (_fmt) {\n            if ((match = re.text.exec(_fmt)) !== null) {\n                parse_tree.push(match[0])\n            }\n            else if ((match = re.modulo.exec(_fmt)) !== null) {\n                parse_tree.push('%')\n            }\n            else if ((match = re.placeholder.exec(_fmt)) !== null) {\n                if (match[2]) {\n                    arg_names |= 1\n                    var field_list = [], replacement_field = match[2], field_match = []\n                    if ((field_match = re.key.exec(replacement_field)) !== null) {\n                        field_list.push(field_match[1])\n                        while ((replacement_field = replacement_field.substring(field_match[0].length)) !== '') {\n                            if ((field_match = re.key_access.exec(replacement_field)) !== null) {\n                                field_list.push(field_match[1])\n                            }\n                            else if ((field_match = re.index_access.exec(replacement_field)) !== null) {\n                                field_list.push(field_match[1])\n                            }\n                            else {\n                                throw new SyntaxError('[sprintf] failed to parse named argument key')\n                            }\n                        }\n                    }\n                    else {\n                        throw new SyntaxError('[sprintf] failed to parse named argument key')\n                    }\n                    match[2] = field_list\n                }\n                else {\n                    arg_names |= 2\n                }\n                if (arg_names === 3) {\n                    throw new Error('[sprintf] mixing positional and named placeholders is not (yet) supported')\n                }\n\n                parse_tree.push(\n                    {\n                        placeholder: match[0],\n                        param_no:    match[1],\n                        keys:        match[2],\n                        sign:        match[3],\n                        pad_char:    match[4],\n                        align:       match[5],\n                        width:       match[6],\n                        precision:   match[7],\n                        type:        match[8]\n                    }\n                )\n            }\n            else {\n                throw new SyntaxError('[sprintf] unexpected placeholder')\n            }\n            _fmt = _fmt.substring(match[0].length)\n        }\n        return sprintf_cache[fmt] = parse_tree\n    }\n\n    /**\n     * export to either browser or node.js\n     */\n    /* eslint-disable quote-props */\n    if (typeof exports !== 'undefined') {\n        exports['sprintf'] = sprintf\n        exports['vsprintf'] = vsprintf\n    }\n    if (typeof window !== 'undefined') {\n        window['sprintf'] = sprintf\n        window['vsprintf'] = vsprintf\n\n        if (typeof define === 'function' && define['amd']) {\n            define(function() {\n                return {\n                    'sprintf': sprintf,\n                    'vsprintf': vsprintf\n                }\n            })\n        }\n    }\n    /* eslint-enable quote-props */\n}(); // eslint-disable-line\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/sprintf-js/src/sprintf.js\n// module id = 26\n// module chunks = 0","import {\r\n\tuserSelectorObject,\r\n\trecipeObject,\r\n\trestCall,\r\n\tgetDOMElements,\r\n\tisDefined,\r\n\tisEmpty,\r\n\tvsprintf\r\n} from './Utilities';\r\n\r\nimport Field from './Field.js';\r\n\r\nimport Actions from './Actions';\r\n\r\nimport RecipeNotices from './RecipeNotices';\r\n\r\nclass UserSelector {\r\n\tconstructor(){\r\n\t\t// On page load, get current step\r\n\t\tUncannyAutomator.recipe.userSelector.step = userSelectorObject( 'get-step' );\r\n\r\n\t\t// Render\r\n\t\tthis.render();\r\n\t}\r\n\r\n\trender(){\r\n\t\t// Create variable to save the content to be added\r\n\t\tlet $content = ``;\r\n\r\n\t\t// Get content depending of the step\r\n\t\tswitch ( UncannyAutomator.recipe.userSelector.step ){\r\n\t\t\tcase 'select-source':\r\n\t\t\t\t// Set validation to false\r\n\t\t\t\t// We're setting it to false here in case the user already\r\n\t\t\t\t// has valid values, but wanted to go to the first step\r\n\t\t\t\t// to change the source\r\n\t\t\t\tUncannyAutomator.recipe.userSelector.isValid = false;\r\n\r\n\t\t\t\t// Validate recipe\r\n\t\t\t\trecipeObject( 'validate' );\r\n\r\n\t\t\t\t// Where the recipe creator select the source of the user.\r\n\t\t\t\t// The options are \"Existing user\" and \"New user\".\r\n\t\t\t\t$content = this.getSelectSourceNodes();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'set-options':\r\n\t\t\t\t// Where the recipe creator defines values of the fields\r\n\t\t\t\t$content = this.getOptionsNodes();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'show-sentence':\r\n\t\t\t\t// Validate recipe\r\n\t\t\t\trecipeObject( 'validate' );\r\n\r\n\t\t\t\t// Set error mode\r\n\t\t\t\tUncannyAutomator.recipe.errorMode = false;\r\n\r\n\t\t\t\t// Show error\r\n\t\t\t\tnew RecipeNotices();\r\n\r\n\t\t\t\t// When the data is complete and valid.\r\n\t\t\t\t$content = this.getSentenceNodes();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// Get container\r\n\t\tlet $metabox = getDOMElements( 'metabox', {\r\n            type: 'action'\r\n        });\r\n\r\n        console.log( '%cRender User Selector', 'background: red; color: #fff; padding: 2px 10px;');\r\n\r\n        // Append content\r\n        $metabox.prepend( $content );\r\n\t}\r\n\r\n\tgetSelectSourceNodes(){\r\n\t\t// Create elements\r\n\t\tlet $userSelector = $( `\r\n\t\t\t<div class=\"user-selector\">\r\n\t\t\t\t<div class=\"item item--user-selector\">\r\n\t\t\t\t\t<div class=\"item__content\">\r\n\t\t\t\t\t\t<div class=\"item-integrations\">\r\n\t\t\t\t\t\t\t<div class=\"item-integration user-selector-option user-selector-option--existing-user\" data-source=\"existingUser\">\r\n\t\t\t\t\t\t\t\t<div class=\"item-integration__logo\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"item-integration__name\">\r\n\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.userSelector.userType.existing }\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"item-integration user-selector-option user-selector-option--new-user\" data-source=\"newUser\">\r\n\t\t\t\t\t\t\t\t<div class=\"item-integration__logo\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"item-integration__name\">\r\n\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.userSelector.userType.new }\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\t\r\n\t\t` );\r\n\r\n\t\t// Add header\r\n\t\t$userSelector.find( '.item' ).prepend( this.getHeaderNodes() );\r\n\r\n\t\t// Get user type boxes\r\n\t\tlet $userTypeButtons = $userSelector.find( '.user-selector-option' );\r\n\r\n\t\t// Bind click on the user type buttons\r\n\t\t$userTypeButtons.on( 'click', ( event ) => {\r\n\t\t\t// Get clicked button\r\n\t\t\tlet $option = $( event.currentTarget );\r\n\r\n\t\t\t// Get user type\r\n\t\t\tlet userSource = $option.data( 'source' );\r\n\t\t\t\r\n\t\t\t// Save selected source in main object\r\n\t\t\tuserSelectorObject( 'set-source', {\r\n\t\t\t\tsource: userSource\r\n\t\t\t});\r\n\r\n\t\t\t// Define next step\r\n\t\t\tUncannyAutomator.recipe.userSelector.step = 'set-options';\r\n\r\n\t\t\t// Render the actions metabox again\r\n\t\t\tnew Actions();\r\n\t\t});\r\n\r\n\t\t// Return element\r\n\t\treturn $userSelector;\r\n\t}\r\n\r\n\tgetOptionsNodes(){\r\n\t\t// Create elements\r\n\t\tlet $optionsContainer = $( `\r\n\t\t\t<div class=\"user-selector\">\r\n\t\t\t\t<div class=\"item item--user-selector\">\r\n\t\t\t\t\t<div class=\"item__content\">\r\n\t\t\t\t\t\t<div class=\"item-options\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Add header\r\n\t\t$optionsContainer.find( '.item' ).prepend( this.getHeaderNodes() );\r\n\r\n\t\t// Get options container, we will add the fields there\r\n\t\tlet $fieldsContainer = $optionsContainer.find( '.item-options' );\r\n\r\n\t\t// Add fields\r\n\t\t$fieldsContainer.append( this.getOptionsFields() );\r\n\r\n\t\t// Return node\r\n\t\treturn $optionsContainer;\r\n\t}\r\n\r\n\tgetOptionsFields(){\r\n\t\t// Create container\r\n\t\tconst $container = $( `<div></div>` );\r\n\r\n\t\t// Create the fields container\r\n\t\tlet $fields = $( `<div class=\"item-options__group\"></div>` );\r\n\r\n\t\t// Create array to save all the fields\r\n\t\tlet optionsFields = [];\r\n\r\n\t\t// Update fields data object so it's an object and not an array\r\n\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\tsource: 'existingUser',\r\n\t\t\tfields: {}\r\n\t\t});\r\n\r\n\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\tsource: 'newUser',\r\n\t\t\tfields: {}\r\n\t\t});\r\n\r\n\t\t// Get WordPress roles, but remove the \"administrator\" one\r\n\t\tlet roles = UncannyAutomator.recipe.userSelector.resources.roles;\r\n\t\tdelete roles.administrator;\r\n\r\n\t\t// Check what's the source\r\n\t\tswitch ( UncannyAutomator.recipe.userSelector.source ){\r\n\t\t\tcase 'existingUser':\r\n\t\t\t\t// Create group\r\n\t\t\t\tlet $groupOfFields = $( `<div class=\"user-selector__field-group user-selector__field-group--two-columns\"></div>` );\r\n\r\n\t\t\t\t// Create \"Unique field\" field\r\n\t\t\t\tlet uniqueField = new Field( 'select', {\r\n\t\t\t\t\titemType: 'user-selector',\r\n\t\t\t\t\toptionCode: 'uniqueField',\r\n\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.existingUser.uniqueFieldLabel,\r\n\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.uniqueField,\r\n\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'email',\r\n\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.userSelector.existingUser.uniqueFieldOptionEmail\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'id',\r\n\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.userSelector.existingUser.uniqueFieldOptionId\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'username',\r\n\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.userSelector.existingUser.uniqueFieldOptionUsername\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t]\r\n\t\t\t\t});\r\n\t\t\t\toptionsFields.push( uniqueField );\r\n\r\n\t\t\t\t// Create value field\r\n\t\t\t\tlet valueField = new Field( 'text', {\r\n\t\t\t\t\titemType: 'user-selector',\r\n\t\t\t\t\toptionCode: 'uniqueFieldValue',\r\n\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.uniqueFieldValue,\r\n\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.existingUser.valueFieldLabel,\r\n\t\t\t\t\tplaceholder: UncannyAutomator.i18n.userSelector.existingUser.valueFieldPlaceholder,\r\n\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t});\r\n\t\t\t\toptionsFields.push( valueField );\r\n\r\n\t\t\t\t// Create and add form element\r\n\t\t\t\tlet $uniqueFieldFormElement = uniqueField.getFormElement();\r\n\t\t\t\t$groupOfFields.append( $uniqueFieldFormElement );\r\n\r\n\t\t\t\tlet $valueFieldFormElement = valueField.getFormElement();\r\n\t\t\t\t$groupOfFields.append( $valueFieldFormElement );\r\n\r\n\t\t\t\t// Add elements to the main container\r\n\t\t\t\t$fields.append( $groupOfFields );\r\n\r\n\t\t\t\t// Create field to decide what to do if the user doesn't exist\r\n\t\t\t\tlet fallbackField = new Field( 'radio', {\r\n\t\t\t\t\titemType: 'user-selector',\r\n\t\t\t\t\toptionCode: 'fallback',\r\n\t\t\t\t\tname: 'user-selector-existing-user-fallback',\r\n\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.existingUser.createNewUserFieldLabel,\r\n\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.fallback,\r\n\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'create-new-user',\r\n\t\t\t\t\t\t\ttext: UncannyAutomator.i18n.userSelector.existingUser.createNewUserFieldOptionCreateUser\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'do-nothing',\r\n\t\t\t\t\t\t\ttext: UncannyAutomator.i18n.userSelector.existingUser.createNewUserFieldOptionDoNothing\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t});\r\n\t\t\t\toptionsFields.push( fallbackField );\r\n\r\n\t\t\t\t// Create and add form element\r\n\t\t\t\tlet $fallbackFieldFormElement = fallbackField.getFormElement();\r\n\t\t\t\t$fields.append( $fallbackFieldFormElement );\r\n\r\n\t\t\t\t// Listen changes\r\n\t\t\t\t$uniqueFieldFormElement.on( 'automator:field:change', () => {\r\n\t\t\t\t\t// Get and save value\r\n\t\t\t\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\t\t\t\tsource: 'existingUser',\r\n\t\t\t\t\t\tfields: {\r\n\t\t\t\t\t\t\tuniqueField: uniqueField.getValue()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$valueFieldFormElement.on( 'automator:field:change', () => {\r\n\t\t\t\t\t// Get and save value\r\n\t\t\t\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\t\t\t\tsource: 'existingUser',\r\n\t\t\t\t\t\tfields: {\r\n\t\t\t\t\t\t\tuniqueFieldValue: valueField.getValue()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Listen changes\r\n\t\t\t\t$fallbackFieldFormElement.on( 'automator:field:change', () => {\r\n\t\t\t\t\t// Get and save value\r\n\t\t\t\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\t\t\t\tsource: 'existingUser',\r\n\t\t\t\t\t\tfields: {\r\n\t\t\t\t\t\t\tfallback: fallbackField.getValue()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Render the actions metabox again\r\n\t\t\t\t\tnew Actions();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Check if we have to add more fields or the do-nothing notice\r\n\t\t\t\tif ( UncannyAutomator.recipe.userSelector.fields.existingUser.fallback == 'do-nothing' ){\r\n\t\t\t\t\t// Create \"Do nothing\" notice\r\n\t\t\t\t\tconst $doNothingNotice = $( `\r\n\t\t\t\t\t\t<div class=\"user-selector__warning\">\r\n\t\t\t\t\t\t\t${ UncannyAutomator.i18n.userSelector.existingUser.doNothingMessage }\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t` );\r\n\r\n\t\t\t\t\t$fields.append( $doNothingNotice );\r\n\t\t\t\t}\r\n\t\t\t\telse if ( UncannyAutomator.recipe.userSelector.fields.existingUser.fallback == 'create-new-user' ){\r\n\t\t\t\t\t// Create container\r\n\t\t\t\t\tlet $subOptionsContainer = $( '<div/>', {\r\n\t\t\t\t\t\t'class': 'item-options'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Create new users fields\r\n\t\t\t\t\tlet newUserFields = [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\t\toptionCode: 'firstName',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.firstName,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.firstName,\r\n\t\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\t\toptionCode: 'lastName',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.lastName,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.lastName,\r\n\t\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\t\toptionCode: 'email',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.email,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.email,\r\n\t\t\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\t\toptionCode: 'username',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.username,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.username,\r\n\t\t\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\t\toptionCode: 'displayName',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.displayName,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.displayName,\r\n\t\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\t\toptionCode: 'password',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.password,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.password,\r\n\t\t\t\t\t\t\tdescription: UncannyAutomator.i18n.userSelector.newUser.passwordDescription,\r\n\t\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'select',\r\n\t\t\t\t\t\t\toptionCode: 'role',\r\n\t\t\t\t\t\t\tcurrentValue: ! isEmpty( UncannyAutomator.recipe.userSelector.fields.existingUser.roles ) ? UncannyAutomator.recipe.userSelector.fields.existingUser.roles : 'subscriber',\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.roles,\r\n\t\t\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\t\t\tsupportsTokens: false,\r\n\t\t\t\t\t\t\toptions: Object.keys( roles ).map( ( key, index ) => {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tvalue: key,\r\n\t\t\t\t\t\t\t\t\ttext:  roles[ key ]\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType: 'user-selector',\r\n\t\t\t\t\t\t\tfieldType: 'radio',\r\n\t\t\t\t\t\t\toptionCode: 'logUserIn',\r\n\t\t\t\t\t\t\tname: 'logUserIn',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.canLogNewUserIn ? 'no' : ( ! isEmpty( UncannyAutomator.recipe.userSelector.fields.existingUser.logUserIn ) ? UncannyAutomator.recipe.userSelector.fields.existingUser.logUserIn : 'no' ),\r\n\t\t\t\t\t\t\tisHidden: UncannyAutomator.recipe.canLogNewUserIn,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.logUserIn,\r\n\t\t\t\t\t\t\tsupportsTokens: false,\r\n\t\t\t\t\t\t\toptions: [{\r\n\t\t\t\t\t\t\t\t\tvalue: 'yes',\r\n\t\t\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.yes\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tvalue: 'no',\r\n\t\t\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.no\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t];\r\n\r\n\t\t\t\t\t// Create fields\r\n\t\t\t\t\tnewUserFields.forEach(( fieldObject ) => {\r\n\t\t\t\t\t\t// Create field\r\n\t\t\t\t\t\tconst field = new Field( fieldObject.fieldType, fieldObject );\r\n\r\n\t\t\t\t\t\t// Get container\r\n\t\t\t\t\t\tlet $fieldFormElement = field.getFormElement();\r\n\t\t\t\t\t\t$subOptionsContainer.append( $fieldFormElement );\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * We don't need this for now, but we could need it in the future\r\n\t\t\t\t\t\t * \r\n\r\n\t\t\t\t\t\t// Listen changes\r\n\t\t\t\t\t\t$fieldFormElement.on( 'automator:field:change', () => {\r\n\t\t\t\t\t\t\t// Get ID\r\n\t\t\t\t\t\t\tconst fieldId = fieldObject.optionCode;\r\n\r\n\t\t\t\t\t\t\t// Get value\r\n\t\t\t\t\t\t\tconst value = field.getValue();\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t*/\r\n\r\n\t\t\t\t\t\t// Save field\r\n\t\t\t\t\t\toptionsFields.push( field );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Append container\r\n\t\t\t\t\t$fields.append( $subOptionsContainer );\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'newUser':\r\n\t\t\t\t// Create new users fields\r\n\t\t\t\tlet newUserFields = [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\toptionCode: 'firstName',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.firstName,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.firstName,\r\n\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\toptionCode: 'lastName',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.lastName,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.lastName,\r\n\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\toptionCode: 'email',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.email,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.email,\r\n\t\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\toptionCode: 'username',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.username,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.username,\r\n\t\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\toptionCode: 'displayName',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.displayName,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.displayName,\r\n\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\toptionCode: 'password',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.password,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.password,\r\n\t\t\t\t\t\tdescription: UncannyAutomator.i18n.userSelector.newUser.passwordDescription,\r\n\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'select',\r\n\t\t\t\t\t\toptionCode: 'role',\r\n\t\t\t\t\t\tcurrentValue: ! isEmpty( UncannyAutomator.recipe.userSelector.fields.newUser.roles ) ? UncannyAutomator.recipe.userSelector.fields.newUser.roles : 'subscriber',\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.roles,\r\n\t\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\t\tsupportsTokens: false,\r\n\t\t\t\t\t\toptions: Object.keys( roles ).map( ( key, index ) => {\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tvalue: key,\r\n\t\t\t\t\t\t\t\ttext:  roles[ key ]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType: 'user-selector',\r\n\t\t\t\t\t\tfieldType: 'radio',\r\n\t\t\t\t\t\toptionCode: 'logUserIn',\r\n\t\t\t\t\t\tname: 'logUserIn',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.canLogNewUserIn ? 'no' : ( ! isEmpty( UncannyAutomator.recipe.userSelector.fields.existingUser.logUserIn ) ? UncannyAutomator.recipe.userSelector.fields.existingUser.logUserIn : 'no' ),\r\n\t\t\t\t\t\tisHidden: ! UncannyAutomator.recipe.canLogNewUserIn,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.logUserIn,\r\n\t\t\t\t\t\tsupportsTokens: false,\r\n\t\t\t\t\t\toptions: [{\r\n\t\t\t\t\t\t\t\tvalue: 'yes',\r\n\t\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.yes\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tvalue: 'no',\r\n\t\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.no\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t}\r\n\t\t\t\t];\r\n\r\n\t\t\t\t// Create fields\r\n\t\t\t\tnewUserFields.forEach(( fieldObject ) => {\r\n\t\t\t\t\t// Create field\r\n\t\t\t\t\tconst field = new Field( fieldObject.fieldType, fieldObject );\r\n\r\n\t\t\t\t\t// Get container\r\n\t\t\t\t\tlet $fieldFormElement = field.getFormElement();\r\n\t\t\t\t\t$fields.append( $fieldFormElement );\r\n\r\n\t\t\t\t\t// Save field\r\n\t\t\t\t\toptionsFields.push( field );\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Create fallback field\r\n\t\t\t\tlet newUserFallbackField = new Field( 'radio', {\r\n\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\toptionCode: 'fallback',\r\n\t\t\t\t\tname: 'user-selector-new-user-fallback',\r\n\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.existingUserFieldLabel,\r\n\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.fallback,\r\n\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'select-existing-user',\r\n\t\t\t\t\t\t\ttext: UncannyAutomator.i18n.userSelector.newUser.existingUserFieldOptionExisting\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'do-nothing',\r\n\t\t\t\t\t\t\ttext: UncannyAutomator.i18n.userSelector.newUser.existingUserFieldOptionDoNothing\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t});\r\n\t\t\t\toptionsFields.push( newUserFallbackField );\r\n\r\n\t\t\t\t// Add fallback field to the container\r\n\t\t\t\tlet $newUserfallbackFieldFormElement = newUserFallbackField.getFormElement();\r\n\t\t\t\t$fields.append( $newUserfallbackFieldFormElement );\r\n\r\n\t\t\t\t// Listen changes\r\n\t\t\t\t$newUserfallbackFieldFormElement.on( 'automator:field:change', () => {\r\n\t\t\t\t\t// Update the value of all the fields (don't validate them yet)\r\n\t\t\t\t\tlet fieldsValues = {};\r\n\r\n\t\t\t\t\t// Iterate fields\r\n\t\t\t\t\toptionsFields.forEach(( Field ) => {\r\n\t\t\t\t\t\t// Save the field using the optionCode as ID and field value as value\r\n\t\t\t\t\t\tfieldsValues[ Field.getAttributes().optionCode ] = Field.getValue();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Get and save value\r\n\t\t\t\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\t\t\t\tsource: 'newUser',\r\n\t\t\t\t\t\tfields: fieldsValues\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Render the actions metabox again\r\n\t\t\t\t\tnew Actions();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Check if we have to add more fields or the do-nothing notice\r\n\t\t\t\tif ( UncannyAutomator.recipe.userSelector.fields.newUser.fallback == 'do-nothing' ){\r\n\t\t\t\t\t// Create \"Do nothing\" notice\r\n\t\t\t\t\tconst $doNothingNotice = $( `\r\n\t\t\t\t\t\t<div class=\"user-selector__warning\">\r\n\t\t\t\t\t\t\t${ UncannyAutomator.i18n.userSelector.newUser.doNothingMessage }\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t` );\r\n\r\n\t\t\t\t\t$fields.append( $doNothingNotice );\r\n\t\t\t\t}\r\n\t\t\t\telse if ( UncannyAutomator.recipe.userSelector.fields.newUser.fallback == 'select-existing-user' ){\r\n\t\t\t\t\t// Create container\r\n\t\t\t\t\tlet $subOptionsContainer = $( '<div/>', {\r\n\t\t\t\t\t\t'class': 'item-options'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Create \"Prioritized Field\" field\r\n\t\t\t\t\tlet prioritizedField = new Field( 'select', {\r\n\t\t\t\t\t\titemType:     'user-selector',\r\n\t\t\t\t\t\toptionCode:   'prioritizedField',\r\n\t\t\t\t\t\tlabel:        UncannyAutomator.i18n.userSelector.newUser.prioritizedFieldLabel,\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.prioritizedField,\r\n\t\t\t\t\t\tdefaultValue: 'email',\r\n\t\t\t\t\t\tdescription:  UncannyAutomator.i18n.userSelector.newUser.prioritizedFieldDescription,\r\n\t\t\t\t\t\tisRequired:   true,\r\n\t\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tvalue: 'email',\r\n\t\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.userSelector.newUser.email\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tvalue: 'username',\r\n\t\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.userSelector.newUser.username\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t});\r\n\t\t\t\t\toptionsFields.push( prioritizedField );\r\n\r\n\t\t\t\t\t// Get field container\r\n\t\t\t\t\tlet $prioritizedField = prioritizedField.getFormElement();\r\n\t\t\t\t\t$subOptionsContainer.append( $prioritizedField );\r\n\r\n\t\t\t\t\t// Append container\r\n\t\t\t\t\t$fields.append( $subOptionsContainer );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// Add fields\r\n\t\t$container.append( $fields );\r\n\r\n\t\t// Create and add save and cancel buttons\r\n\t\tconst $buttonsContainer = $( `<div class=\"item-options__buttons\"></div>` );\r\n\r\n\t\t// Save button\r\n\t\tconst $saveButton = $( `<div class=\"uap-btn uap-btn--primary\">${ UncannyAutomator.i18n.save }</div>` );\r\n\t\tconst $cancelButton = $( `<div class=\"uap-btn uap-btn--secondary\">${ UncannyAutomator.i18n.cancel }</div>` );\r\n\r\n\t\t// Add listeners\r\n\t\t// On save\r\n\t\t$saveButton.on( 'click', () => {\r\n\t\t\t// Validate fields\r\n\t\t\t// Create default response\r\n\t\t\tlet areAllFieldsValid = true;\r\n\r\n\t\t\t// Create object to get all the fields values\r\n\t\t\tlet fieldsValues = {}\r\n\r\n\t\t\t// Iterate fields and validate them\r\n\t\t\toptionsFields.forEach(( Field ) => {\r\n\t\t\t\t// Get field validation\r\n\t\t\t\tconst isFieldValid = Field.validate().isValid;\r\n\r\n\t\t\t\t// Update global validation\r\n\t\t\t\tareAllFieldsValid = areAllFieldsValid && isFieldValid;\r\n\r\n\t\t\t\t// Check if the field is valid\r\n\t\t\t\tif ( isFieldValid ){\r\n\t\t\t\t\t// Save value\r\n\t\t\t\t\tfieldsValues[ Field.getAttributes().optionCode ] = Field.getValue();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Save values\r\n\t\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\t\tsource: UncannyAutomator.recipe.userSelector.source,\r\n\t\t\t\tfields: fieldsValues\r\n\t\t\t});\r\n\r\n\t\t\t// Check if all fields are valid, otherwise\r\n\t\t\t// do nothing. The .validate() method will\r\n\t\t\t// render the errors\r\n\t\t\tif ( areAllFieldsValid ){\r\n\t\t\t\t// Add loading class to button\r\n\t\t\t\t$saveButton.addClass( 'uap-btn--primary uap-btn--loading uap-btn--disabled' );\r\n\r\n\t\t\t\t// Make request\r\n\t\t\t\trestCall( 'user-selector', {\r\n\t\t\t\t\trecipeId: UncannyAutomator.recipe.id,\r\n\t\t\t\t\tsource: UncannyAutomator.recipe.userSelector.source,\r\n\t\t\t\t\tfields: UncannyAutomator.recipe.userSelector.fields[ UncannyAutomator.recipe.userSelector.source ]\r\n\t\t\t\t}, ( response ) => {\r\n\t\t\t\t\t// On success\r\n\t\t\t\t\t// Set user selector as valid\r\n\t\t\t\t\tUncannyAutomator.recipe.userSelector.isValid = true;\r\n\r\n\t\t\t\t\t// Set step\r\n\t\t\t\t\tuserSelectorObject( 'set-step', {\r\n\t\t\t\t\t\tstep: 'show-sentence'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Render actions again\r\n\t\t\t\t\tnew Actions();\r\n\t\t\t\t}, ( response ) => {\r\n\t\t\t\t\t// On error\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// On cancel\r\n\t\t$cancelButton.on( 'click', () => {\r\n\t\t\t// Delete fields information\r\n\t\t\t// userSelectorObject( 'reset-fields' );\r\n\r\n\t\t\t// Set step\r\n\t\t\tuserSelectorObject( 'set-step', {\r\n\t\t\t\tstep: 'select-source'\r\n\t\t\t});\r\n\r\n\t\t\t// Render actions again\r\n\t\t\tnew Actions();\r\n\t\t})\r\n\r\n\t\t// Add buttons\r\n\t\t$buttonsContainer.append( $saveButton );\r\n\t\t$buttonsContainer.append( $cancelButton );\r\n\t\t$container.append( $buttonsContainer );\r\n\r\n\t\treturn $container;\r\n\t}\r\n\r\n\tgetSentenceNodes(){\r\n\t\t// Create elements\r\n\t\tlet $optionsContainer = $( `\r\n\t\t\t<div class=\"user-selector user-selector--summary\">\r\n\t\t\t\t<div class=\"item item--user-selector\">\r\n\t\t\t\t\t<div class=\"item__content\">\r\n\t\t\t\t\t\t<div class=\"item-options\">\r\n\t\t\t\t\t\t\t<div class=\"user-selector-summary\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t$optionsContainer.find( '.item' ).prepend( this.getHeaderNodes() );\r\n\r\n\t\t// Get container\r\n\t\tlet $summaryContainer = $optionsContainer.find( '.user-selector-summary' );\r\n\r\n\t\t// Create first row\r\n\t\tlet $sourceRow = $( `\r\n\t\t\t<div class=\"user-selector-summary-row\">\r\n\t\t\t\t<div class=\"user-selector-summary-row__icon\">\r\n\t\t\t\t\t<span class=\"uo-icon uo-icon--atom\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"user-selector-summary-row__content\"></div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Create token\r\n\t\tlet $sourceRowToken = $( `\r\n\t\t\t<div class=\"user-selector-summary-row__token\"></div>\r\n\t\t` );\r\n\t\t$sourceRow.find( '.user-selector-summary-row__content' ).append( $sourceRowToken );\r\n\r\n\t\t// If the source is \"existingUser\"\r\n\t\tif ( UncannyAutomator.recipe.userSelector.source == 'existingUser' ){\r\n\t\t\t// Then add the \"Existing user\" string\r\n\t\t\t$sourceRowToken.text( UncannyAutomator.i18n.userSelector.userType.existing );\r\n\t\t}\r\n\t\t// If it's \"newUser\"\r\n\t\telse if ( UncannyAutomator.recipe.userSelector.source == 'newUser' ){\r\n\t\t\t// Then add the \"New user\" string\r\n\t\t\t$sourceRowToken.text( UncannyAutomator.i18n.userSelector.userType.new );\r\n\t\t}\r\n\r\n\t\t// Listen clicks\r\n\t\t$sourceRowToken.on( 'click', () => {\r\n\t\t\t// Go to the first step.\r\n\t\t\t\r\n\t\t\t// Delete fields information\r\n\t\t\t// userSelectorObject( 'reset-fields' );\r\n\r\n\t\t\t// Set step\r\n\t\t\tuserSelectorObject( 'set-step', {\r\n\t\t\t\tstep: 'select-source'\r\n\t\t\t});\r\n\r\n\t\t\t// Render actions again\r\n\t\t\tnew Actions();\r\n\t\t});\r\n\r\n\t\t// Add to container\r\n\t\t$summaryContainer.append( $sourceRow );\r\n\r\n\t\t// Create first row\r\n\t\tlet $dataRow = $( `\r\n\t\t\t<div class=\"user-selector-summary-row\">\r\n\t\t\t\t<div class=\"user-selector-summary-row__icon\">\r\n\t\t\t\t\t<span class=\"uo-icon uo-icon--fingerprint\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"user-selector-summary-row__content\"></div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Create token\r\n\t\tlet $dataRowSentence;\r\n\r\n\t\tif ( UncannyAutomator.recipe.userSelector.source == 'existingUser' ){\r\n\t\t\t$dataRowSentence = $( `\r\n\t\t\t\t<div>\r\n\t\t\t\t${\r\n\t\t\t\t\tvsprintf(\r\n\t\t\t\t\t\tUncannyAutomator.i18n.userSelector.summary.matches,\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t`<div class=\"user-selector-summary-row__token\">${ UncannyAutomator.i18n.userSelector.summary[ UncannyAutomator.recipe.userSelector.fields.existingUser.uniqueField ] }</div>`,\r\n\t\t\t\t\t\t\t`<div class=\"user-selector-summary-row__token\">${ UncannyAutomator.recipe.userSelector.fields.existingUser.uniqueFieldValue }</div>`\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t\t</div>`\r\n\t\t\t);\r\n\t\t}\r\n\t\telse if ( UncannyAutomator.recipe.userSelector.source == 'newUser' ){\r\n\t\t\t$dataRowSentence = $( `\r\n\t\t\t\t<div>\r\n\t\t\t\t${\r\n\t\t\t\t\tvsprintf(\r\n\t\t\t\t\t\tUncannyAutomator.i18n.userSelector.summary.withEmail,\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t`<div class=\"user-selector-summary-row__token\">${ UncannyAutomator.recipe.userSelector.fields.newUser.email }</div>`\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t`\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t$dataRow.find( '.user-selector-summary-row__content' ).append( $dataRowSentence );\r\n\r\n\t\t// Listen clicks\r\n\t\t$dataRowSentence.find( '.user-selector-summary-row__token' ).on( 'click', () => {\r\n\t\t\t// Go to the second step.\r\n\t\t\t\r\n\t\t\t// Set step\r\n\t\t\tuserSelectorObject( 'set-step', {\r\n\t\t\t\tstep: 'set-options'\r\n\t\t\t});\r\n\r\n\t\t\t// Render actions again\r\n\t\t\tnew Actions();\r\n\t\t});\r\n\r\n\t\t// Add data row\r\n\t\t$summaryContainer.append( $dataRow );\r\n\r\n\t\t// Add fallback row\r\n\t\tlet $fallbackRow = $( `\r\n\t\t\t<div class=\"user-selector-summary-row\">\r\n\t\t\t\t<div class=\"user-selector-summary-row__icon\">\r\n\t\t\t\t\t<span class=\"uo-icon uo-icon--directions\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"user-selector-summary-row__content\"></div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\tlet otherwiseText = '';\r\n\r\n\t\tif ( UncannyAutomator.recipe.userSelector.source == 'existingUser' ){\r\n\t\t\tif ( UncannyAutomator.recipe.userSelector.fields.existingUser.fallback == 'create-new-user' ){\r\n\t\t\t\totherwiseText = UncannyAutomator.i18n.userSelector.summary.createNewUser;\r\n\t\t\t}\r\n\t\t\telse if ( UncannyAutomator.recipe.userSelector.fields.existingUser.fallback == 'do-nothing' ){\r\n\t\t\t\totherwiseText = UncannyAutomator.i18n.userSelector.summary.doNothing;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ( UncannyAutomator.recipe.userSelector.source == 'newUser' ){\r\n\t\t\tif ( UncannyAutomator.recipe.userSelector.fields.newUser.fallback == 'select-existing-user' ){\r\n\t\t\t\totherwiseText = UncannyAutomator.i18n.userSelector.summary.selectExistingUser;\r\n\t\t\t}\r\n\t\t\telse if ( UncannyAutomator.recipe.userSelector.fields.newUser.fallback == 'do-nothing' ){\r\n\t\t\t\totherwiseText = UncannyAutomator.i18n.userSelector.summary.doNothing;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet $fallbackRowSentence = $( `\r\n\t\t\t<div>\r\n\t\t\t${\r\n\t\t\t\tvsprintf(\r\n\t\t\t\t\tUncannyAutomator.i18n.userSelector.summary.otherwise,\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t`<div class=\"user-selector-summary-row__token\">${ otherwiseText }</div>`\r\n\t\t\t\t\t]\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t\t</div>`\r\n\t\t);\r\n\t\t$fallbackRow.find( '.user-selector-summary-row__content' ).append( $fallbackRowSentence );\r\n\r\n\t\t// Listen clicks\r\n\t\t$fallbackRow.find( '.user-selector-summary-row__token' ).on( 'click', () => {\r\n\t\t\t// Go to the second step.\r\n\r\n\t\t\t// Set step\r\n\t\t\tuserSelectorObject( 'set-step', {\r\n\t\t\t\tstep: 'set-options'\r\n\t\t\t});\r\n\r\n\t\t\t// Render actions again\r\n\t\t\tnew Actions();\r\n\t\t});\r\n\r\n\t\t// Add data row\r\n\t\t$summaryContainer.append( $fallbackRow );\r\n\r\n\t\t// Return nodes\r\n\t\treturn $optionsContainer;\r\n\t}\r\n\r\n\tgetHeaderNodes(){\r\n\t\t// Define title variable\r\n\t\tlet title;\r\n\r\n\t\t// Get title variable\r\n\t\tswitch ( UncannyAutomator.recipe.userSelector.step ){\r\n\t\t\tcase 'select-source':\r\n\t\t\tcase 'show-sentence':\r\n\t\t\t\t// Define title\r\n\t\t\t\ttitle = UncannyAutomator.i18n.userSelector.sentenceTitle;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'set-options':\r\n\t\t\t\t// Define title\r\n\t\t\t\ttitle = UncannyAutomator.i18n.userSelector.setOptions;\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// Create output\r\n\t\tlet $output = $( `\r\n\t\t\t<div>\r\n\t\t\t\t<div class=\"item-actions\">\r\n\t\t\t\t\t<div class=\"item-actions__btn\">\r\n\t\t\t\t\t\t<i class=\"uo-icon uo-icon--ellipsis-h-alt\"></i>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"item-actions__dropdown\">\r\n\t\t\t\t\t\t<ul class=\"item-actions-dropdown__ul\">\r\n\t\t\t\t\t\t\t<a href=\"#\" target=\"_blank\" class=\"item-actions-dropdown__action\">\r\n\t\t\t\t\t\t\t\t<span>${ UncannyAutomator.i18n.support }</span>\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"item-icon\"></div>\r\n\t\t\t\t<div class=\"item-title clear\">\r\n\t\t\t\t\t<div class=\"item-title__describe\">\r\n\t\t\t\t\t\t<div class=\"item-title__non-editable\">\r\n\t\t\t\t\t\t\t${ title }\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Add functionality to open and close the actions dropdown\r\n\t\t// Listen click on the three dots icon\r\n        $output.find( '.item-actions__btn' ).on( 'click', () => {\r\n        \t// Find the actions container and toogle the open class\r\n        \t$output.find( '.item-actions' ).toggleClass( 'item-actions--open' )\r\n        } );\r\n\r\n\t\t// Return output\r\n\t\treturn $output;\r\n\t}\r\n}\r\n\r\nexport default UserSelector;\n\n\n// WEBPACK FOOTER //\n// ./src/components/UserSelector.js","import {\r\n\tgetDOMElements,\r\n    restCall,\r\n    AJAXRequest,\r\n    isDefined,\r\n    isEmpty,\r\n    vsprintf,\r\n    getCurrentFieldsValues\r\n} from './Utilities.js';\r\n\r\nimport {\r\n    validateItemFields,\r\n} from './Validation';\r\n\r\nimport Triggers from './Triggers.js';\r\nimport Actions  from './Actions.js';\r\n\r\nimport Modal    from './Modal.js';\r\nimport Markdown from './Markdown.js';\r\n\r\nclass ItemOptions {\r\n\tconstructor( itemId, optionId ){\r\n\t\tthis.itemId   = itemId;\r\n\t\tthis.optionId = optionId;\r\n\t\tthis.item \t  = UncannyAutomator.recipe.items[ itemId ];\r\n\r\n\t\t// Array to save the Field objects\r\n\t\tthis.fields   = this.item.options[ this.optionId ].fields;\r\n\t\t// Array to save the buttons\r\n\t\tthis.buttons  = this.item.options[ this.optionId ].buttons;\r\n\r\n\t\tthis.create();\r\n\r\n\t\t// AFTER we added the elements to the DOM let's call init TinyMCE\r\n\t\t// We're going to call this in ItemOptions.js because TinyMCE needs the item in the DOM before changing it\r\n\t\t// Select2, the Token selector and the URL checker are called in Field.js\r\n\t\tthis.initTinyMCE();\r\n\t}\r\n\r\n\tcreate(){\r\n\t\t// Container\r\n\t\tlet container = getDOMElements( 'item', {\r\n\t\t\tid: this.itemId\r\n\t\t}).contentContainer;\r\n\r\n\t\tlet itemOptions\t= $( '<div/>', { 'class': 'item-options' });\r\n\r\n\t\t// Buttons. We have to create these before the fields, but append after\r\n\t\tlet buttons = this.createButtons();\r\n\r\n\t\t// Fields\r\n\t\tlet fields = this.createFields();\r\n\t\tthis.fieldsContainer = fields;\r\n\t\titemOptions.append( fields );\r\n\r\n\t\t// Create notices container\r\n\t\tlet noticeContainer  = $( '<div/>', { 'class': 'item-options__notices' });\r\n\t\tthis.noticeContainer = noticeContainer;\r\n\t\titemOptions.append( noticeContainer );\r\n\r\n\t\t// Append buttons\r\n\t\titemOptions.append( buttons );\r\n\r\n\t\t// Append to the item\r\n\t\tcontainer.html( itemOptions );\r\n\t}\r\n\r\n\tcreateFields(){\r\n\t\tlet container = $( '<div/>', { 'class': 'item-options__group' });\r\n\r\n\t\t// Create fields\r\n\t\t$.each( this.fields, ( index, field ) => {\r\n\t\t\t// Get field type\r\n\t\t\tlet fieldType = field.getAttributes().fieldType;\r\n\r\n\t\t\t// Check if it's a repeater\r\n\t\t\tif ( fieldType == 'repeater' ){\r\n\t\t\t\t// Create the fields again first (to avoid showing unsaved changed)\r\n\t\t\t\tfield.createFields();\r\n\t\t\t}\r\n\r\n\t\t\t// Append the form element to the DOM\r\n\t\t\tfield.createFormElement();\r\n\t\t\tcontainer.append( field.getFormElement() );\r\n\r\n\t\t\t// Bind submit on Enter (for all except groups and textareas)\r\n\t\t\tif ( ! [ 'textarea', 'group', 'repeater' ].includes( fieldType ) ){\r\n\t\t\t\t// Get field element and bind 'keyup'\r\n\t\t\t\tfield.getField().on( 'keyup', ( event ) => {\r\n\t\t\t\t\t// Check if it's an enter\r\n\t\t\t\t\tif ( event.keyCode == 13 ){\r\n\t\t\t\t\t\t// Trigger a click on the Save Button\r\n\t\t\t\t\t\tthis.saveButton.trigger( 'click' );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t// Check if it's a group\r\n\t\t\telse if ( fieldType == 'group' ){\r\n\t\t\t\t// Iterate fields\r\n\t\t\t\tfield.fields.forEach(( field ) => {\r\n\t\t\t\t\t// Get the field type\r\n\t\t\t\t\tconst fieldType = field.getAttributes().fieldType;\r\n\r\n\t\t\t\t\t// Check if it's not a textarea\r\n\t\t\t\t\tif ( fieldType !== 'textarea' ){\r\n\t\t\t\t\t\t// Get field element and bind 'keyup'\r\n\t\t\t\t\t\tfield.getField().on( 'keyup', ( event ) => {\r\n\t\t\t\t\t\t\t// Check if it's an enter\r\n\t\t\t\t\t\t\tif ( event.keyCode == 13 ){\r\n\t\t\t\t\t\t\t\t// Trigger a click on the Save Button\r\n\t\t\t\t\t\t\t\tthis.saveButton.trigger( 'click' );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse if ( fieldType == 'repeater' ){\r\n\t\t\t\t// Iterate rows\r\n\t\t\t\tfield.fieldRows.forEach(( row, index ) => {\r\n\t\t\t\t\t// Iterate each row\r\n\t\t\t\t\trow.forEach(( Field, index ) => {\r\n\t\t\t\t\t\t// Get field element and bind 'keyup'\r\n\t\t\t\t\t\tField.getField().on( 'keyup', ( event ) => {\r\n\t\t\t\t\t\t\t// Check if it's an enter\r\n\t\t\t\t\t\t\tif ( event.keyCode == 13 ){\r\n\t\t\t\t\t\t\t\t// Trigger a click on the Save Button\r\n\t\t\t\t\t\t\t\tthis.saveButton.trigger( 'click' );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t}\r\n\r\n\tcreateButtons(){\r\n\t\t// Buttons\r\n\t\tlet container \t  \t = $( '<div/>', { 'class': 'item-options__buttons' });\r\n\r\n\t\t// Actions buttons\r\n\t\tlet automatorButtons = $( '<div/>', { 'class': 'item-options__automator-buttons' }),\r\n\t\t\tdeveloperButtons = $( '<div/>', { 'class': 'item-options__developer-buttons' });\r\n\r\n\t\tlet saveButton \t  \t = $( '<div/>', { 'class': 'uap-btn uap-btn--primary' }),\r\n\t\t\tcancelButton  \t = $( '<div/>', { 'class': 'uap-btn uap-btn--secondary' }).text( UncannyAutomator.i18n.cancel );\r\n\r\n\t\tif ( this.item.itemType == 'trigger' ){\r\n\t\t\tsaveButton.text( UncannyAutomator.i18n.save );\r\n\t\t}\r\n\r\n\t\tif ( this.item.itemType == 'action' ){\r\n\t\t\tsaveButton.text( UncannyAutomator.i18n.save );\r\n\t\t}\r\n\r\n        if ( this.item.itemType == 'closure' ){\r\n            saveButton.text( UncannyAutomator.i18n.save );\r\n        }\r\n\r\n        this.saveButton = saveButton;\r\n\r\n\t\tautomatorButtons.append( saveButton );\r\n\t\tautomatorButtons.append( cancelButton );\r\n\r\n\t\t// Check developer defined buttons\r\n\t\t$.each( this.buttons, ( index, button ) => {\r\n\t\t\t// Create button\r\n\t\t\tconst $buttonElement = $( '<div/>', { 'class': 'uap-btn' }).text( button.text );\r\n\r\n\t\t\t// Check if we have to add a custom class to the button\r\n\t\t\tif ( isDefined( button.css_classes ) ){\r\n\t\t\t\t// Add classes\r\n\t\t\t\t$buttonElement.addClass( button.css_classes );\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it has a defined onClick function\r\n\t\t\tlet doOnClick = () => {};\r\n\t\t\tif ( isDefined( button.on_click ) ){\r\n\t\t\t\t// Try to overwrite empty function\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// Try to convert the string to function, but first remove the <script> tags and trim the string\r\n\t\t\t\t\tdoOnClick = eval( `(${ button.on_click.replace( '<script>', '' ).replace( '</script>', '' ).trim() })` ); \r\n\t\t\t\t} catch ( e ){ console.log( e ); console.log( button.on_click ); }\r\n\t\t\t}\r\n\r\n\t\t\t// Listen clicks on the button\r\n\t\t\t$buttonElement.on( 'click', () => {\r\n\t\t\t\t// Invoke callback\r\n\t\t\t\tdoOnClick(\r\n\t\t\t\t\t// button\r\n\t\t\t\t\t$buttonElement,\r\n\t\t\t\t\t// data\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titem:      this.item,\r\n\t\t\t\t\t\tvalues:    getCurrentFieldsValues( this.itemId ),\r\n\t\t\t\t\t},\r\n\t\t\t\t\t// modules\r\n\t\t\t\t\t(function(){\r\n\t\t\t\t\t\t// Get required modules\r\n\t\t\t\t\t\tlet modules = {};\r\n\r\n\t\t\t\t\t\t// Check if the developer wants custom modules\r\n\t\t\t\t\t\tif ( isDefined( button.modules ) ){\r\n\t\t\t\t\t\t\t// Check if we have to add the modal module\r\n\t\t\t\t\t\t\tif ( button.modules.includes( 'modal' ) ){\r\n\t\t\t\t\t\t\t\t// Include modal\r\n\t\t\t\t\t\t\t\tmodules.Modal = Modal;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif ( button.modules.includes( 'markdown' ) ){\r\n\t\t\t\t\t\t\t\t// Include Markdown\r\n\t\t\t\t\t\t\t\tmodules.Markdown = Markdown;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Return modules\r\n\t\t\t\t\t\treturn modules;\r\n\t\t\t\t\t})()\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\t// Add button to the container\r\n\t\t\tdeveloperButtons.append( $buttonElement );\r\n\t\t});\r\n\r\n\t\tcontainer.append( automatorButtons );\r\n\t\tcontainer.append( developerButtons );\r\n\r\n\t\tsaveButton.on( 'click', () => {\r\n\t\t\t// Verify form\r\n            let formValidation = validateItemFields( this.fieldsContainer );\r\n\r\n            // Check if it's valid\r\n            if ( formValidation.isValid ){\r\n            \t// Disable button and show loading animation\r\n            \tsaveButton.addClass( 'uap-btn--loading uap-btn--disabled' );\r\n\r\n            \t// The REST call wants:\r\n            \t// - The item ID\r\n            \t// - The option code (the one from the token, the main one)\r\n            \t// - The value. If there is more than one then a serialized object\r\n            \tlet itemId \t\t= this.itemId,\r\n            \t\toptionCode \t= this.optionId,\r\n            \t\toptionValue = this.getOptionValue();\r\n\r\n            \trestCall( 'update', {\r\n                    itemId:       itemId,\r\n                    optionCode:   optionCode,\r\n                    optionValue:  optionValue\r\n                }, ( response ) => {\r\n                \t// Trigger \"saved\" on all item fields\r\n                \tthis.fields.forEach(( Field ) => {\r\n                \t\tField.getFormElement().trigger( 'saved' );\r\n                \t});\r\n\r\n           \t        if ( this.item.itemType == 'trigger' ){\r\n                        new Triggers();\r\n                    }\r\n\r\n                    if ( this.item.itemType == 'action' || this.item.itemType == 'closure' ){\r\n                        new Actions();\r\n                    }\r\n\r\n                    // Get item form element\r\n                \tconst $item = getDOMElements( 'item', {\r\n                \t\tid: this.item.id\r\n                \t});\r\n\r\n                \t// Get first token and trigger a click\r\n                \t$item.item.find( '.item-title__token:not(.item-title__token--filled)' ).first().trigger( 'click' );\r\n                }, ( response ) => {\r\n                \tconsole.log( '‼️ ERROR-TODO. Couldn\\'t save the options of the item' );\r\n\r\n                \t// Reset UI\r\n\t\t\t\t\tif ( this.item.itemType == 'trigger' ){\r\n\t\t\t\t\t\tnew Triggers();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( this.item.itemType == 'action' || this.item.itemType == 'closure' ){\r\n\t\t\t\t\t\tnew Actions();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Try to open the options again\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// Get the item elements\r\n\t\t\t\t\t\tgetDOMElements( 'item', {\r\n\t\t\t\t\t\t\tid: this.itemId\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t// Get the main container\r\n\t\t\t\t\t\t.item\r\n\t\t\t\t\t\t// Find the token in the sentence\r\n\t\t\t\t\t\t.find( `.item-title__token[data-options-id=\"${ optionCode }\"]` )\r\n\t\t\t\t\t\t// Trigger a click\r\n\t\t\t\t\t\t.trigger( 'click' ); \r\n\t\t\t\t\t} catch ( e ){}\r\n                });\r\n            }\r\n\t\t});\r\n\r\n\t\tcancelButton.on( 'click', () => {\r\n\t\t\t// Reset UI\r\n\t\t\tif ( this.item.itemType == 'trigger' ){\r\n\t\t\t\tnew Triggers();\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.item.itemType == 'action' || this.item.itemType == 'closure' ){\r\n\t\t\t\tnew Actions();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t}\r\n\r\n\tinitTinyMCE(){\r\n\t\t$.each( this.fields, ( index, field ) => {\r\n\t\t\t// Get the field type\r\n\t\t\tif ( field.getAttributes().fieldType == 'textarea' ){\r\n\t\t\t\t// TinyMCE will be initialized only if it's a textarea and supportsTinyMCE is true\r\n\t\t\t\tfield.initTinyMCE();\r\n\t\t\t}\t\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Get the value that we have to send to the REST call\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tgetOptionValue(){\r\n\t\tlet response = {},\r\n\t\t\thasSelect = false,\r\n\t\t\thasRepeater = false;\r\n\r\n\t\t$.each( this.fields, ( index, field ) => {\r\n\t\t\tlet id \t  = field.getAttributes().optionCode,\r\n\t\t\t\tvalue = field.getValue();\r\n\r\n\t\t\tif ( [ 'select', 'radio' ].includes( field.getAttributes().fieldType ) ){\r\n\t\t\t\t// Has select\r\n\t\t\t\thasSelect = true;\r\n\r\n\t\t\t\t// Save readable value\r\n\t\t\t\tresponse[ vsprintf( '%s_readable', [ id ] ) ] = field.getReadableValue();\r\n\t\t\t}\r\n\t\t\telse if ( field.getAttributes().fieldType == 'repeater' ){\r\n\t\t\t\t// Has repeater\r\n\t\t\t\thasRepeater = true;\r\n\t\t\t\t\r\n\t\t\t\t// Convert data to a JSON string\r\n\t\t\t\tvalue = JSON.stringify( value );\r\n\t\t\t}\r\n\r\n\t\t\tresponse[ id ] = value;\r\n\t\t});\r\n\r\n\t\tif ( ! hasRepeater && ! hasSelect && Object.keys( response ).length == 1 ){\r\n\t\t\t// One field\r\n\t\t\tresponse = response[ Object.keys( response )[ 0 ] ];\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n}\r\n\r\nexport default ItemOptions;\n\n\n// WEBPACK FOOTER //\n// ./src/components/ItemOptions.js","import {\r\n\tisDefined,\r\n\tescapeHTML\r\n} from './Utilities.js';\r\n\r\nclass Markdown {\r\n\tconstructor( content = '' ){\r\n\t\t// Save content\r\n\t\tthis.content = content;\r\n\t}\r\n\r\n\tgetHTML(){\r\n\t\t// Define content and escape HTML\r\n\t\tlet content = escapeHTML( this.content );\r\n\t\t\r\n\t\tcontent = this.parseItalicsAndBold( content );\r\n\t\tcontent = this.parseAnchors( content );\r\n\r\n\t\treturn content;\r\n\t}\r\n\r\n\tparseItalicsAndBold( content ){\r\n\t\t// Underscores\r\n\t\t// Since we are consuming a \\s character, we need to add it\r\n\t\tcontent = content.replace( /(^|\\s|>|\\b)__(?=\\S)([^]+?)__(?=\\b|<|\\s|$)/gm, '$1<strong>$2</strong>' );\r\n\t\tcontent = content.replace( /(^|\\s|>|\\b)_(?=\\S)([^]+?)_(?=\\b|<|\\s|$)/gm, '$1<em>$2</em>' );\r\n\r\n\t\t// Asterisks\r\n\t\tcontent = content.replace( /(\\*\\*)(?=\\S)([^\\r]*?\\S[*]*)\\1/g, '<strong>$2</strong>' );\r\n\t\tcontent = content.replace( /(\\*)(?=\\S)([^\\r]*?\\S)\\1/g, '<em>$2</em>' );\r\n\r\n\t\t// Return content\r\n\t\treturn content;\r\n\t}\r\n\r\n\tparseAnchors( content ){\r\n\t\t// Inline-style links: [link text](url \"optional title\")\r\n\t\tcontent = content.replace( /(\\[((?:\\[[^\\]]*]|[^\\[\\]])*)]\\([ \\t]*()<?(.*?(?:\\(.*?\\).*?)?)>?[ \\t]*((['\"])(.*?)\\6[ \\t]*)?\\))/g, function( wholeMatch, m1, m2, m3, m4, m5, m6, m7 ){\r\n\t\t\tif ( ! isDefined( m7 ) ){\r\n\t\t\t\tm7 = '';\r\n\t\t\t}\r\n\r\n\t\t\twholeMatch = m1;\r\n\t\t\t\r\n\t\t\tvar linkText = m2,\r\n\t\t\t\tlinkId \t = m3.toLowerCase(),\r\n\t\t\t\turl \t = m4,\r\n\t\t\t\ttitle \t = m7;\r\n\r\n\t\t\tif ( ! url ){\r\n\t\t\t\tif ( ! linkId ){\r\n\t\t\t\t\t// Lower-case and turn embedded newlines into spaces\r\n\t\t\t\t\tlinkId = linkText.toLowerCase().replace( / ?\\n/g, ' ' );\r\n\t\t\t\t}\r\n\r\n\t\t\t\turl = '#' + linkId;\r\n\r\n\t\t\t\tif ( wholeMatch.search( /\\(\\s*\\)$/m ) > -1 ){\r\n\t\t\t\t\t// Special case for explicit empty url\r\n\t\t\t\t\turl = '';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn wholeMatch;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\turl = encodeURI( url, '*_', false );\r\n\t\t\tvar result = '<a href=\"' + url + '\" target=\"_blank\"';\r\n\r\n\t\t\tif ( title !== '' && title !== null ){\r\n\t\t\t\ttitle = title.replace( /\"/g, '&quot;' );\r\n\t\t\t\ttitle = encodeURI( title, '*_', false );\r\n\t\t\t\tresult += ' title=\"' + title + '\"';\r\n\t\t\t}\r\n\r\n\t\t\tresult += '>' + linkText + '</a>';\r\n\r\n\t\t\treturn result;\r\n\t\t});\r\n\r\n\t\t// Return content\r\n\t\treturn content;\r\n\t}\r\n}\r\n\r\nexport default Markdown;\n\n\n// WEBPACK FOOTER //\n// ./src/components/Markdown.js","import {\r\n    getDOMElements\r\n}                              from './Utilities.js';\r\nimport ItemCreatorIntegrations from './ItemCreatorIntegrations.js';\r\n\r\nclass ItemCreatorAdd {\r\n    constructor( itemType ){\r\n        let $container    = $( '<div/>', { 'class': 'item item--start' }),\r\n            $icon         = $( '<div/>', { 'class': 'item-icon' }),\r\n            $containerBox = $( '<div/>', { 'class': 'item-title clear' }),\r\n            $button       = $( '<div/>', { 'class': 'uap-btn uap-btn--secondary uap-btn--small' });\r\n\r\n        $containerBox.append( $button );\r\n        $container.append( $icon );\r\n        $container.append( $containerBox );\r\n\r\n        // Add to the metabox\r\n        let $metabox = getDOMElements( 'metabox', {\r\n            type: itemType\r\n        });\r\n\r\n        $metabox.append( $container );\r\n\r\n        // Add text depending of the itemType\r\n        if ( itemType == 'trigger' ){\r\n            $button.text( UncannyAutomator.i18n.trigger.add );\r\n        }\r\n\r\n        if ( itemType == 'action' ){\r\n            $button.text( UncannyAutomator.i18n.action.add );\r\n        }\r\n\r\n        $button.on( 'click', () => new ItemCreatorIntegrations( itemType ) );\r\n    }\r\n}\r\n\r\nexport default ItemCreatorAdd;\n\n\n// WEBPACK FOOTER //\n// ./src/components/ItemCreatorAdd.js","import {\r\n    isDefined,\r\n    getDOMElements,\r\n    restCall,\r\n    vsprintf\r\n}                         from './Utilities.js';\r\nimport ItemHeaderMenu     from './ItemHeaderMenu.js';\r\nimport ItemHeaderIcon     from './ItemHeaderIcon.js';\r\nimport ItemHeaderTag      from './ItemHeaderTag.js';\r\nimport ItemHeaderSentence from './ItemHeaderSentence.js';\r\nimport Actions            from './Actions.js';\r\nimport Field              from './Field.js';\r\n\r\nclass Closures {\r\n\r\n    constructor(){\r\n        // Create console group\r\n        // console.group( 'Closures' );\r\n\r\n        // Get metabox\r\n        this.elements = {\r\n            $metabox: getDOMElements( 'metabox', { type: 'action' })\r\n        }\r\n\r\n        // Create closures. It's important to understand that we're going to create all the available closures, not only those already added to the item\r\n        // That's why we create a separate file instead of using Item.js\r\n        $.each( UncannyAutomator.closures, ( key, closure ) => this.createClosure( closure ) );\r\n\r\n        // Close console group\r\n        // console.groupEnd();\r\n    }\r\n\r\n    createClosure( closure ){\r\n        // Variable to check later if this closure already was added to the recipe\r\n        let wasAdded = false;\r\n\r\n        // Container\r\n        let $container = $( '<div/>', { 'class': 'metabox__footer' });\r\n\r\n        // Checkbox attributes. We're going to use this to create our checkbox later.\r\n        let checkboxAttributes = {\r\n            label:              closure.select_option_name,\r\n            formElementClass:   'form-element--nomargin'\r\n        }\r\n\r\n        // Check if this closure already was added to the recipe\r\n        let closureInRecipe = this.getClosureByCodeFromItemsObject( closure.code );\r\n\r\n        if ( isDefined( closureInRecipe ) ){\r\n            wasAdded = true;\r\n\r\n            checkboxAttributes.currentValue = true;\r\n            checkboxAttributes.itemid       = closureInRecipe.id;\r\n\r\n            // Debug\r\n            // console.groupCollapsed( vsprintf( 'ID: %s', [ closureInRecipe.id ] ) );\r\n            // console.log( closureInRecipe );\r\n            // console.groupEnd();\r\n        }\r\n\r\n        // Create checkbox\r\n        let checkboxField = new Field( 'checkbox', checkboxAttributes ),\r\n            $checkbox      = checkboxField.getFormElement();\r\n\r\n        // Bind changes\r\n        $checkbox.on( 'change', function(){\r\n            let isChecked = checkboxField.getValue();\r\n            checkboxField.startLoadingAnimation();\r\n\r\n            // Check if it's checked\r\n            if ( isChecked ){\r\n                // Add item to the recipe\r\n                restCall( 'add', {\r\n                    recipePostID: UncannyAutomator.recipe.id,\r\n                    action:       'add-new-closure',\r\n                    item_code:    closure.code\r\n                }, ( response ) => {\r\n                    new Actions();\r\n\r\n                    // Check if the ID of the new item is defined\r\n                    if ( isDefined( response.post_ID ) ){\r\n                        // Get item form element\r\n                        const $newItem = getDOMElements( 'item', {\r\n                            id: response.post_ID\r\n                        });\r\n\r\n                        // Get first token and trigger a click\r\n                        $newItem.item.find( '.item-title__token:not(.item-title__token--filled)' ).first().trigger( 'click' );\r\n                    }\r\n                }, ( response ) => {\r\n                    console.log( '‼️ ERROR-TODO. Couldn\\'t add the closure' );\r\n\r\n                    // Stop the loading animation\r\n                    checkboxField.stopLoadingAnimation();\r\n\r\n                    // Change back the value of the checkbox\r\n                    checkboxField.setValue( false, false );\r\n                });\r\n            }\r\n            else {\r\n                restCall( 'delete', {\r\n                    ID: closureInRecipe.id\r\n                }, () => {\r\n                    new Actions();\r\n                }, () => {\r\n                    console.log( '‼️ ERROR-TODO. Couldn\\'t delete the closure' );\r\n\r\n                    new Actions();\r\n                });\r\n            }\r\n        });\r\n\r\n        // Append checkbox to the container\r\n        $container.append( $checkbox );\r\n\r\n        // Create toggle section\r\n        let $toggleContent = $( '<div/>', { 'class': 'uo-toggle uo-toggle--show' });\r\n\r\n        // Check if it was already added. In that case show it\r\n        if ( wasAdded ){\r\n            $toggleContent.addClass( 'uo-toggle--show' );\r\n\r\n            let $item = $( '<div/>', {\r\n                'class':   'item item--closure item--margintop',\r\n                'data-id': closureInRecipe.id\r\n            });\r\n\r\n            let $itemHeader = this.createHeader(\r\n                UncannyAutomator.recipe.items[ closureInRecipe.id ].integrationCode,\r\n                'closure',\r\n                closure.code,\r\n                closureInRecipe.id,\r\n            );\r\n\r\n            $item.append( $itemHeader );\r\n\r\n            let $itemContent = $( '<div/>', { 'class': 'item__content' });\r\n            $item.append( $itemContent );\r\n\r\n            $toggleContent.append( $item );\r\n        }\r\n    \r\n        $container.append( $toggleContent );\r\n\r\n        // Append everything to the metabox\r\n        this.elements.$metabox.append( $container );\r\n    }\r\n\r\n    /**\r\n     * Creates item header\r\n     * \r\n     * @since 0.5\r\n     *\r\n     * @param {string}    integrationCode - The integration code\r\n     * @param {string}    itemType - The item type: 'trigger', 'action' or 'closure'\r\n     * @param {string}    itemCode - The code of the item\r\n     * @param {int}       itemId - The ID of the item\r\n     */\r\n\r\n    createHeader( integrationCode, itemType, itemCode, itemId ){\r\n        let $container = $( '<div/>' ),\r\n            $title     = $( '<div/>', { 'class': 'item-title clear' });\r\n\r\n        let $actions = new ItemHeaderMenu( itemType, integrationCode, itemCode, itemId );\r\n        $container.append( $actions );\r\n\r\n        let $icon    = new ItemHeaderIcon( integrationCode );\r\n        $container.append( $icon );\r\n        \r\n        let $itemTag = new ItemHeaderTag( integrationCode );\r\n        $title.append( $itemTag );\r\n\r\n        let $titleSentence = new ItemHeaderSentence( itemType, integrationCode, itemCode, itemId );\r\n        $title.append( $titleSentence );\r\n\r\n        $container.append( $title );\r\n\r\n        return $container;\r\n    }\r\n\r\n    getClosureByCodeFromItemsObject( code ){\r\n        let theItem;\r\n\r\n        $.each( UncannyAutomator.recipe.items, function( itemID, item ){\r\n            if ( item.itemCode == code ){\r\n                theItem = item;\r\n            }\r\n        })\r\n\r\n        return theItem;\r\n    }\r\n}\r\n\r\nexport default Closures;\n\n\n// WEBPACK FOOTER //\n// ./src/components/Closures.js","import {\r\n\tgetItemsByIntegration,\r\n\tgetDOMElements,\r\n    restCall,\r\n    isDefined,\r\n    isEmpty,\r\n    replaceCurlyBraces,\r\n    addParametersToURL\r\n} from './Utilities.js';\r\n\r\nimport ItemCreatorIntegrations from './ItemCreatorIntegrations.js';\r\n\r\nimport ItemHeaderMenu from './ItemHeaderMenu.js';\r\nimport ItemHeaderIcon from './ItemHeaderIcon.js';\r\nimport ItemHeaderTag  from './ItemHeaderTag.js';\r\n\r\nimport Triggers \t  from './Triggers.js';\r\nimport Actions \t\t  from './Actions.js';\r\n\r\nclass itemCreatorTaskSelector {\r\n\tconstructor( itemType, integrationID, $currentItem ){\r\n\t\tthis.itemType \t\t= itemType;\r\n\t\tthis.integrationID \t= integrationID;\r\n\t\tthis.$currentItem \t= $currentItem;\r\n\r\n\t\t// Render DOM elements\r\n\t\tthis.render();\r\n\t}\r\n\r\n\trender(){\r\n\t\t// Create $container\r\n\t\tthis.$container = $( `<div class=\"item\"></div>` );\r\n\t\tthis.$item = this.$container;\r\n\r\n\t\tthis.createHeader();\r\n\t\tthis.createItemsList();\r\n\r\n        this.$currentItem.replaceWith( this.$container );\r\n\t}\r\n\r\n\tcreateHeader(){\r\n\t\tconst $header = $( `\r\n\t\t\t<div>\r\n\t\t\t\t<div class=\"item-title clear\">\r\n\t\t\t\t\t<div class=\"item-title__describe\">\r\n\t\t\t\t\t\t<div class=\"item-title__non-editable\">\r\n\t\t\t\t\t\t\t${ this.itemType == 'trigger' ? UncannyAutomator.i18n.trigger.select : UncannyAutomator.i18n.action.select }\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Add the item actions (the three dots)\r\n        let $itemActions = new ItemHeaderMenu( this.itemType );\r\n        $header.append( $itemActions );\r\n\r\n        // Add the item icon\r\n        let $itemIcon = new ItemHeaderIcon( this.integrationID );\r\n        $header.append( $itemIcon );\r\n\r\n        // Add the integration tag\r\n        let $integrationTag = new ItemHeaderTag( this.integrationID );\r\n        $header.find( '.item-title' ).prepend( $integrationTag );\r\n\r\n        // Append the header to the main container\r\n        this.$container.append( $header );\r\n\t}\r\n\r\n\tcreateItemsList(){\r\n\t\tlet items, searchPlaceholder, unlockItems;\r\n\r\n\t\t// Get data depending on the item type\r\n\t\tif ( this.itemType == 'trigger' ){\r\n\t\t\titems \t           = getItemsByIntegration( this.integrationID, 'triggers' );\r\n\t\t\tsearchPlaceholder  = UncannyAutomator.i18n.trigger.search;\r\n\t\t\tunlockItems        = UncannyAutomator.i18n.proOnly.unlockTriggers;\r\n\t\t}\r\n\t\telse if ( this.itemType == 'action' ){\r\n\t\t\titems              = getItemsByIntegration( this.integrationID, 'actions' );\r\n\t\t\tsearchPlaceholder  = UncannyAutomator.i18n.action.search;\r\n\t\t\tunlockItems        = UncannyAutomator.i18n.proOnly.unlockActions;\r\n\t\t}\r\n\r\n\t\t// Create the main container\r\n\t\tconst $container   = $( `\r\n\t\t\t<div class=\"item__content\">\r\n\t\t\t\t<div class=\"item-options item-options--nopadding item-options--noborder\">\r\n\t\t\t\t\t<div class=\"form-element\">\r\n\t\t\t\t\t\t<div class=\"item__task-selector\">\r\n\t\t\t\t\t\t\t<div class=\"item-task-selector__search\">\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\t\tclass=\"item-task-selector__search-input\"\r\n\t\t\t\t\t\t\t\t\tplaceholder=\"${ searchPlaceholder }\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"item-task-selector__options\">\r\n\t\t\t\t\t\t\t\t<div class=\"item-task-selector-options__group item-task-selector-options__group--available\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"item-task-selector-options__group item-task-selector-options__group--unavailable\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"item-task-selector-options__group-items\"></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"item-task-selector__option item-task-selector__option--no-results item-task-selector__option--hide\">\r\n\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.noResults }\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Get important elements\r\n\t\tconst $optionsContainer = $container.find( '.item-options' ),\r\n\t\t      $taskSelector     = $container.find( '.item__task-selector' ),\r\n\t\t      $searchField      = $container.find( '.item-task-selector__search-input' ),\r\n\t\t      $itemsList        = {\r\n\t\t      \tcontainer: $container.find( '.item-task-selector__options' ),\r\n\t\t      \tavailable: $container.find( '.item-task-selector-options__group--available' ),\r\n\t\t      \tunavailable: {\r\n\t\t      \t\tcontainer: $container.find( '.item-task-selector-options__group--unavailable' ),\r\n\t\t      \t\tlist:      $container.find( '.item-task-selector-options__group-items' )\r\n\t\t      \t},\r\n\t\t      \tnoResults: $container.find( '.item-task-selector__option--no-results' )\r\n\t\t      };\r\n\r\n\t\t// Check if it has available items\r\n\t\tif ( items.hasAvailableItems ){\r\n\t\t\t// Append available items to the list container\r\n\t\t\t$itemsList.available.append( items.available.map(( item ) => {\r\n\t\t\t\t// Check if it's a Pro item\r\n\t\t\t\tconst isPro = item.is_pro;\r\n\r\n\t\t\t\t// Create container\r\n\t\t\t\tconst $item = $( `\r\n\t\t\t\t\t<div class=\"item-task-selector__option ${ isPro ? 'item-task-selector__option--pro' : '' }\"\r\n\t\t\t\t\t\tdata-search=\"${ item.select_option_name.toLowerCase().replace( /\\s+|{|}/g, '' ) }\">\r\n\t\t\t\t\t\t${ replaceCurlyBraces( item.select_option_name, '<span class=\"item-task-selector__option-variable\">', '</span>' ) }\r\n\t\t\t\t\t\t${ isPro ? `<span class=\"item-task-selector-option__badge\">${ UncannyAutomator.i18n.proOnly.pro }</span>` : '' }\r\n\t\t\t\t\t</div>\r\n\t\t\t\t` );\r\n\r\n\t\t\t\t// Listen clicks on the container\r\n\t\t\t\t$item.on( 'click', () => {\r\n\t\t\t\t\t// Add loading class to the parent container\r\n\t\t\t\t\t$taskSelector.addClass( 'item__task-selector--loading' );\r\n\r\n\t\t\t\t\t// Add loading class to the container\r\n\t\t\t\t\t$item.addClass( 'item-task-selector__option--loading' );\r\n\r\n\t\t\t\t\t// Get the correct request code\r\n\t\t\t\t\tconst restRequestCode = [ 'trigger', 'action' ].includes( this.itemType ) ? `add-new-${ this.itemType }` : '';\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Save the value of the fields with default values\r\n\t\t\t\t\t// in the item meta\r\n\t\t\t\t\tlet defaultMeta = {}\r\n\t\t\t\t\t$.each( item.options, ( index, option ) => {\r\n\t\t\t\t\t\tif ( isDefined( option.default_value ) ){\r\n\t\t\t\t\t\t\tdefaultMeta[ option.option_code ] = option.default_value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Check if the trigger is an anonymous trigger\r\n\t\t\t\t\tif ( item.type == 'anonymous' ){\r\n\t\t\t\t\t\t// Save the \"can_log_in_new_user\" value\r\n\t\t\t\t\t\tdefaultMeta.can_log_in_new_user = isDefined( item.can_log_in_new_user ) ? item.can_log_in_new_user : true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Do REST call to add the item\r\n\t\t\t\t\trestCall( 'add', {\r\n\t\t\t\t\t\trecipePostID: UncannyAutomator.recipe.id,\r\n\t\t\t\t\t\taction:       restRequestCode,\r\n\t\t\t\t\t\titem_code:    item.code,\r\n\t\t\t\t\t\tdefault_meta: $.extend( {}, defaultMeta, {\r\n\t\t\t\t\t\t\tintegration_name: UncannyAutomator.integrations[ this.integrationID ].name,\r\n\t\t\t\t\t\t\tsentence: \t\t  item.sentence\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, ( response ) => {\r\n\t\t\t\t\t\tif ( this.itemType == 'trigger' ){\r\n\t\t\t\t\t\t\tnew Triggers();\r\n\r\n\t\t\t\t\t\t\t// Check if it's an anonymous recipe\r\n\t                        if ( UncannyAutomator.recipe.type == 'anonymous' ){\r\n\t                        \t// Render the Actions metabox again\r\n\t                        \t// We're doing this because we need to update the user selector\r\n\t                        \tnew Actions();\r\n\t                        }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ( this.itemType == 'action' ){\r\n\t\t\t\t\t\t\tnew Actions();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Check if the ID of the new item is defined\r\n\t\t\t\t\t\tif ( isDefined( response.post_ID ) ){\r\n\t\t\t\t\t\t\t// Get item form element\r\n\t\t\t\t\t\t\tconst $newItem = getDOMElements( 'item', {\r\n\t\t\t\t\t\t\t\tid: response.post_ID\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// Get first token and trigger a click\r\n\t\t\t\t\t\t\t$newItem.item.find( '.item-title__token:not(.item-title__token--filled)' ).first().trigger( 'click' );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, ( response ) => {\r\n\t\t\t\t\t\tconsole.log( '‼️ ERROR-TODO. Couldn\\'t add the item' );\r\n\r\n\t\t\t\t\t\t// Remove loading class to the parent container\r\n\t\t\t\t\t\t$taskSelector.removeClass( 'item__task-selector--loading' );\r\n\r\n\t\t\t\t\t\t// Remove loading class to the container\r\n\t\t\t\t\t\t$item.removeClass( 'item-task-selector__option--loading' );\r\n\r\n\t\t\t\t\t\t// Check if it's an invalid action\r\n\t\t\t\t\t\tif ( response.success == false ){\r\n\t\t\t\t\t\t\tnew Triggers();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Return the\r\n\t\t\t\treturn $item;\r\n\t\t\t}));\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Remove the available items container\r\n\t\t\t$itemsList.available.remove();\r\n\t\t}\r\n\r\n\t\t// Check if it has unavailable items\r\n\t\tif ( items.hasUnavailableItems ){\r\n\t\t\t// Append unavailable items to the list container\r\n\t\t\t$itemsList.unavailable.list.append( items.unavailable.map(( item ) => {\r\n\t\t\t\t// Create container\r\n\t\t\t\tconst $item = $( `\r\n\t\t\t\t\t<a  href=\"${ addParametersToURL( 'https://automatorplugin.com/pricing/', {\r\n\t\t\t\t\t\t    'utm_source':  'uncanny_automator',\r\n\t\t\t\t\t\t    'utm_medium':  'select_an_item',\r\n\t\t\t\t\t\t    'utm_content': 'unavailable_item'\r\n\t\t\t\t\t\t}) }\"\r\n\t\t\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\t\t\tclass=\"item-task-selector__option item-task-selector__option--pro\"\r\n\t\t\t\t\t\tdata-search=\"${ item.name.toLowerCase().replace( /\\s+|{|}/g, '' ) }\">\r\n\t\t\t\t\t\t<span class=\"uo-icon uo-icon--lock-alt\"></span>\r\n\t\t\t\t\t\t${ replaceCurlyBraces( item.name, '<span class=\"item-task-selector__option-variable\">', '</span>' ) }\r\n\t\t\t\t\t\t<span class=\"item-task-selector-option__badge\">${ UncannyAutomator.i18n.proOnly.pro }</span>\r\n\t\t\t\t\t</a>\r\n\t\t\t\t` );\r\n\r\n\t\t\t\treturn $item;\r\n\t\t\t}));\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Remove the unavailable items container\r\n\t\t\t$itemsList.unavailable.container.remove();\r\n\t\t}\r\n\r\n\t\t// Get the list of items\r\n\t\tconst $items = $itemsList.container.find( '.item-task-selector__option:not(.item-task-selector__option--no-results)' );\r\n\r\n\t\t// Listen changes on the search field\r\n        $searchField.on( 'input', () => {\r\n        \t// Get the current value\r\n            const query = $searchField.val().toLowerCase().replace( /\\s+|{|}/g, '' );\r\n\r\n            // Reset before searching\r\n            $items.removeClass( 'item-task-selector__option--show item-task-selector__option--hide' );\r\n\r\n            // Create variable to evaluate later if there were results\r\n            let hasResults = true;\r\n\r\n            // Check if the query is not empty\r\n            if ( ! isEmpty( query ) ){\r\n\t\t\t\t// If value it isn't empty then we have to check if there are going to be results, so false by default\r\n\t\t\t\thasResults = false;\r\n\r\n\t\t\t\t$.each( $items, ( index, item ) => {\r\n\t\t\t\t\tlet $item = $( item ),\r\n\t\t\t\t\t    text  = $item.data( 'search' );\r\n\r\n\t\t\t\t\tif ( text.search( query ) !== -1 ){\r\n\t\t\t\t\t    $item.addClass( 'item-task-selector__option--show' );\r\n\r\n\t\t\t\t\t    // At least one result, so true\r\n\t\t\t\t\t    hasResults = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t    $item.addClass( 'item-task-selector__option--hide' );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n            }\r\n\r\n            // Show and hide noResults\r\n            $itemsList.noResults.removeClass( 'item-task-selector__option--hide item-task-selector__option--show' );\r\n\r\n            if ( ! hasResults ){\r\n\t\t\t\t$itemsList.noResults.addClass( 'item-task-selector__option--show' );\r\n            }\r\n            else {\r\n\t\t\t\t$itemsList.noResults.addClass( 'item-task-selector__option--hide' )\r\n            }\r\n        });\r\n\r\n        // Append \"Cancel\" button\r\n        $optionsContainer.append( this.createCancelButton() );\r\n\r\n\t\t// Append the header to the main container\r\n        this.$container.append( $container );\r\n\t}\r\n\r\n\tcreateCancelButton(){\r\n\t\tlet $cancelButton = $( '<div/>', { 'class': 'uap-btn uap-btn--secondary' }).text( UncannyAutomator.i18n.cancel );\r\n\r\n\t\t$cancelButton.on( 'click', () => {\r\n\t\t\tnew ItemCreatorIntegrations( this.itemType, this.$item );\r\n\t\t});\r\n\r\n\t\treturn $cancelButton;\r\n\t}\r\n}\r\n\r\nexport default itemCreatorTaskSelector;\n\n\n// WEBPACK FOOTER //\n// ./src/components/itemCreatorTaskSelector.js","import {\r\n\tgetDOMElements,\r\n\tisDefined,\r\n\tvsprintf\r\n} from './Utilities.js';\r\n\r\nclass MetaboxNotice {\r\n\tconstructor( itemType, noticeType, noticeMessage ){\r\n\t\tthis.itemType \t\t= itemType;\r\n\t\tthis.noticeType \t= noticeType;\r\n\t\tthis.noticeMessage \t= noticeMessage;\r\n\r\n\t\t// Create notice\r\n        this.create();\r\n\t}\r\n\r\n\tcreate(){\r\n\t\t// Append to the metabox\r\n        let metabox = getDOMElements( 'metabox', {\r\n            type: this.itemType\r\n        });\r\n\r\n        // Get notice\r\n        let notice = this.createNotice();\r\n\r\n        // Append to the metabox\r\n        metabox.append( notice );\r\n\t}\r\n\r\n\tcreateNotice(){\r\n\t\tlet container = $( '<div/>', { 'class': 'metabox__notice' });\r\n\r\n\t\tif ( isDefined( this.noticeType ) ){\r\n\t\t\tcontainer.addClass( vsprintf( 'metabox__notice--%s', [ this.noticeType ] ) );\r\n\t\t}\r\n\r\n\t\tcontainer.html( this.noticeMessage );\r\n\t\treturn container;\r\n\t}\r\n}\r\n\r\nexport default MetaboxNotice;\n\n\n// WEBPACK FOOTER //\n// ./src/components/MetaboxNotice.js","import {\r\n\tisDefined,\r\n\tvsprintf\r\n} from './Utilities.js';\r\n\r\nclass SendFeedback {\r\n\r\n\tconstructor(){\r\n\t\tthis.build();\r\n\t}\r\n\r\n\tbuild(){\r\n\t\tlet sendFeedbackContainer = $( '<div/>', { 'class': 'uap-report-bug' });\r\n\r\n\t\t// Temporal\r\n\r\n\t\t/*\r\n\t\tif ( this.showAgain() ){\r\n\t\t\tsendFeedbackContainer.addClass( 'uap-report-bug--open' );\r\n\r\n\t\t\tlet sendFeedbackOverlay = $( '<div/>', { 'class': 'uap-report-bug__overlay' });\r\n\t\t\tlet sendFeedbackCircle = $( '<div/>', { 'class': 'uap-report-bug-circle' });\r\n\t\t\tlet sendFeedbackCircleContainer = $( '<div/>', { 'class': 'uap-report-bug-circle__container' });\r\n\r\n\t\t\tlet sendFeedbackCircleText = $( '<div/>', { 'class': 'uap-report-bug-circle__text' });\r\n\t\t\tsendFeedbackCircleText.text( vsprintf( UncannyAutomator.i18n.sendFeedback.message, [ 'Uncanny Automator' ] ) );\r\n\t\t\tsendFeedbackCircleText.appendTo( sendFeedbackCircleContainer );\r\n\r\n\t\t\tlet sendFeedbackDontShowContainer = $( '<div/>', { 'class': 'uap-report-bug-circle__dont-show' });\r\n\t\t\tlet sendFeedbackDontShowLabel = $( '<label/>', { 'class': 'uap-report-bug-circle-checkbox' });\r\n\t\t\tlet sendFeedbackDontShowSpan = $( '<span/>', { 'class': 'uap-report-bug-circle__span' });\r\n\t\t\tsendFeedbackDontShowSpan.text( UncannyAutomator.i18n.sendFeedback.dontShowAgain );\r\n\t\t\tsendFeedbackDontShowSpan.appendTo( sendFeedbackDontShowLabel );\r\n\t\t\tlet sendFeedbackDontShowInput = $( '<input/>', { 'class': 'uap-report-bug-circle-checkbox__input', 'type': 'checkbox' });\r\n\t\t\tlet sendFeedbackDontShowInputRender = $( '<div/>', { 'class': 'uap-report-bug-circle-checkbox__render' });\r\n\t\t\tsendFeedbackDontShowInputRender.prependTo( sendFeedbackDontShowLabel );\r\n\t\t\tsendFeedbackDontShowInput.prependTo( sendFeedbackDontShowLabel );\r\n\t\t\tsendFeedbackDontShowLabel.appendTo( sendFeedbackDontShowContainer );\r\n\t\t\tsendFeedbackDontShowContainer.appendTo( sendFeedbackCircleContainer );\r\n\r\n\t\t\tlet sendFeedbackFooter = $( '<div/>', { 'class': 'uap-report-bug-circle__footer' });\r\n\t\t\tlet sendFeedbackFooterBtn = $( '<div/>', { 'class': 'uap-report-bug-circle__btn' });\r\n\t\t\tsendFeedbackFooterBtn.text( UncannyAutomator.i18n.sendFeedback.gotIt );\r\n\t\t\tsendFeedbackFooterBtn.appendTo( sendFeedbackFooter );\r\n\t\t\tsendFeedbackFooter.appendTo( sendFeedbackCircleContainer );\r\n\r\n\t\t\tsendFeedbackCircleContainer.appendTo( sendFeedbackCircle );\r\n\t\t\tsendFeedbackCircle.appendTo( sendFeedbackOverlay );\r\n\t\t\tsendFeedbackOverlay.appendTo( sendFeedbackContainer );\r\n\r\n\t\t\t// Bind\r\n\t\t\tthis.bind( sendFeedbackFooterBtn, sendFeedbackDontShowInput, sendFeedbackOverlay, sendFeedbackContainer );\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t// Check version\r\n\t\tlet version,\r\n\t\t\tutmSource;\r\n\r\n\t\tif ( ! isDefined( UncannyAutomator.wp ) || ! UncannyAutomator.wp ){\r\n\t\t\tversion   = vsprintf( 'Uncanny Automator %s', [ UncannyAutomator.version ] );\r\n\t\t\tutmSource = 'uncanny_automator';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tversion   = vsprintf( 'Uncanny Automator %s %s', [ 'Pro', UncannyAutomator.version ] );\r\n\t\t\tutmSource = vsprintf( 'uncanny_automator_%s', [ 'pro' ] );\r\n\t\t}\r\n\r\n\t\tlet sendFeedbackButton = $( '<a/>', {\r\n\t\t\t'class': 'uap-report-bug__btn',\r\n\t\t\t'uap-tooltip': UncannyAutomator.i18n.sendFeedback.title,\r\n\t\t\t'uap-flow': 'left',\r\n\t\t\t'href': vsprintf( 'https://automatorplugin.com/feedback/?version=%s&utm_source=%s&utm_medium=%s', [ version, utmSource, 'send_feedback' ] ),\r\n\t\t\t'target': '_blank'\r\n\t\t});\r\n\r\n\t\tlet sendFeedbackButtonIcon = $( '<span/>', { 'class': 'uap-report-bug__icon' });\r\n\t\tsendFeedbackButton.append( sendFeedbackButtonIcon );\r\n\t\tsendFeedbackButton.appendTo( sendFeedbackContainer );\r\n\r\n\t\t// Append to the body\r\n\r\n\t\t$('body').append( sendFeedbackContainer );\r\n\t}\r\n\r\n\tbind( close_btn, dont_show_again_checkbox, overlay, mainContainer ){\r\n\r\n\t\tclose_btn.on( 'click', function(){\r\n\t\t\t// Storage\r\n\t\t\tif ( dont_show_again_checkbox.is(':checked') ){\r\n\t\t\t\tlocalStorage.uapSendFeedbackWelcome = 'hide';\r\n\t\t\t}\r\n\r\n\t\t\t// Hide\r\n\t\t\toverlay.fadeOut(150);\r\n\t\t\tmainContainer.removeClass( 'uap-report-bug--open' );\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tshowAgain(){\r\n\t\t/**\r\n\t\t * Version 2.0 introduced the recipe selector, which is\r\n\t\t * shown as an overlay on page load. As having two overlays\r\n\t\t * is bad for UX, we will hide this one\r\n\t\t */\r\n\t\t\r\n\t\tlet output = false;\r\n\r\n\t\t/*\r\n\t\tlet output = true;\r\n\r\n\t\tif ( localStorage.uapSendFeedbackWelcome && localStorage.uapSendFeedbackWelcome == 'hide' ){\r\n\t\t\toutput = false;\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\treturn output;\r\n\t}\r\n}\r\n\r\nexport default SendFeedback;\n\n\n// WEBPACK FOOTER //\n// ./src/components/SendFeedback.js","import {\r\n    restCall\r\n} from './Utilities.js';\r\n\r\nclass RecipeTitle {\r\n    constructor(){\r\n        this.elements = {\r\n            container: $( '#titlediv' ),\r\n            input:     $( '#titlediv #title' ),\r\n            status:    {}\r\n        }\r\n\r\n        this.publishedTitle = this.elements.input.val();\r\n\r\n        // Create DOM elements\r\n        this.createStatus();\r\n\r\n        // Bind changes\r\n        this.bindChanges();\r\n\r\n        // Unbind beforeunload.edit-post\r\n        this.notSavedAlert();\r\n    }\r\n\r\n    createStatus(){\r\n        let container    = $( '<div/>', { 'class': 'uap-title-status' }),\r\n            uapContainer = $( '<div/>', { 'class': 'uap' });\r\n\r\n        // Saving\r\n        let saving       = $( '<div/>', { 'class': 'uo-status uo-status--saving' }),\r\n            savingIcon   = $( '<span/>', { 'class': 'uo-status-icon uo-icon uo-icon--loading uo-icon--rotate' }),\r\n            savingText   = $( '<span/>', { 'class': 'uo-status__text' }).text( UncannyAutomator.i18n.title.saving );\r\n\r\n        saving.append( savingIcon );\r\n        saving.append( savingText );\r\n\r\n        this.elements.status.saving = saving;\r\n\r\n        // Saved\r\n        let saved        = $( '<div/>', { 'class': 'uo-status uo-status--saved' }),\r\n            savedIcon    = $( '<span/>', { 'class': 'uo-status-icon uo-icon uo-icon--check' }),\r\n            savedText    = $( '<span/>', { 'class': 'uo-status__text' }).text( UncannyAutomator.i18n.title.saved );\r\n\r\n        saved.append( savedIcon );\r\n        saved.append( savedText );\r\n\r\n        this.elements.status.saved = saved;\r\n\r\n        uapContainer.append( saving );\r\n        uapContainer.append( saved );\r\n        container.append( uapContainer );\r\n\r\n        // Append to the WP container\r\n        this.elements.container.append( container );\r\n    }\r\n\r\n    setStatusSaving(){\r\n        this.elements.status.saving.stop().fadeIn( 150 );\r\n    }\r\n\r\n    setStatusSaved(){\r\n        this.elements.status.saving.stop().fadeOut( 150 );\r\n\r\n        this.elements.status.saved.stop().fadeIn( 150, () => {\r\n            setTimeout( () => {\r\n                this.elements.status.saved.fadeOut( 150 );\r\n            }, 3000 );\r\n        });\r\n    }\r\n\r\n    revertChanges(){\r\n        // Revert the title\r\n        this.elements.input.val( this.publishedTitle );\r\n\r\n        // Stop the saving animation\r\n        this.elements.status.saving.stop().fadeOut( 150 );\r\n    }\r\n\r\n    bindChanges(){\r\n        let typingTimeout;\r\n\r\n        // Bind\r\n        this.elements.input.on( 'input', () => {\r\n            // Clear the timeout if it has already been set.\r\n            // This will prevent the previous task from executing\r\n            clearTimeout( typingTimeout );\r\n\r\n            // Wait 1.5 seconds\r\n            typingTimeout = setTimeout( () => {\r\n                // Set status saving\r\n                this.setStatusSaving();\r\n\r\n                // Update title\r\n                this.updateTitle();\r\n            }, 1500 );\r\n        });\r\n    }\r\n\r\n    getTitle(){\r\n        return this.elements.input.val();\r\n    }\r\n\r\n    updateTitle(){\r\n        restCall( 'change_post_title', {\r\n            post_ID:    UncannyAutomator.recipe.id,\r\n            post_title: this.getTitle()\r\n        }, () => {\r\n            this.setStatusSaved();\r\n\r\n            // Update the published title\r\n            this.publishedTitle = this.getTitle();\r\n        }, () => {\r\n            console.log( '‼️ ERROR-TODO. Couldn\\'t save the title' );\r\n\r\n            // Revert the changes\r\n            this.revertChanges();\r\n        });\r\n    }\r\n\r\n    notSavedAlert(){\r\n        $(document).ready( () => {\r\n            $( window ).off( 'beforeunload.edit-post' );\r\n        });\r\n    }\r\n}\r\n\r\nexport default RecipeTitle;\n\n\n// WEBPACK FOOTER //\n// ./src/components/RecipeTitle.js","import {\r\n\trestCall\r\n} from './Utilities.js';\r\n\r\nclass Taxonomies {\r\n\tconstructor(){\r\n\t\t// Save categories\r\n\t\tnew Categories();\r\n\r\n\t\t// Save tags\r\n\t\tnew Tags();\r\n\t}\r\n}\r\n\r\nclass Categories {\r\n\tconstructor(){\r\n\t\t// Get elements\r\n\t\tthis.getElements();\r\n\r\n\t\t// Check if the required element exist before adding\r\n\t\t// the event listeners\r\n\t\tif ( this.$elements.allCategories.length == 1 ){\r\n\t\t\t// Listen changes to the checkboxes\r\n\t\t\tthis.listenCheckboxes();\r\n\t\t}\r\n\t}\r\n\r\n\tgetElements(){\r\n\t\tthis.$elements = {\r\n\t\t\tcontainer:     $( '#recipe_categorydiv' ),\r\n\t\t\tallCategories: $( '#recipe_categorychecklist' )\r\n\t\t}\r\n\t}\r\n\r\n\tlistenCheckboxes(){\r\n\t\t// Listen changes to each checkbox\r\n\t\tthis.$elements.container.on( 'change', 'input[type=\"checkbox\"][name=\"tax_input[recipe_category][]\"], .popular-category input[type=\"checkbox\"]', ( event ) => {\r\n\t\t\t// Get checkbox\r\n\t\t\tconst $checkbox = $( event.currentTarget );\r\n\r\n\t\t\t// Save category\r\n\t\t\tthis.saveCategory( $checkbox );\r\n\t\t});\r\n\r\n\t\t// Listen when the user adds a new category. This will be\r\n\t\t// triggered when WP creates a new category after the user\r\n\t\t// used the \"+ Add New Category\" form\r\n\t\tnew MutationObserver(( mutations ) => {\r\n\t\t\t// Iterate mutations\r\n\t\t\tmutations.forEach( ( mutation ) => {\r\n\t\t\t\t// Iterate new categories\r\n\t\t\t\tmutation.addedNodes.forEach(( addedNode ) => {\r\n\t\t\t\t\t// Get the checkbox of the new category\r\n\t\t\t\t\tconst $checkbox = $( addedNode ).find( 'input[type=\"checkbox\"][name=\"tax_input[recipe_category][]\"]' );\r\n\r\n\t\t\t\t\t// Save category\r\n\t\t\t\t\tthis.saveCategory( $checkbox );\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}).observe( this.$elements.allCategories[0], {\r\n\t\t\tchildList: true\r\n\t\t});\r\n\t}\r\n\r\n\tgetCheckboxData( $checkbox ){\r\n\t\treturn {\r\n\t\t\tid:        $checkbox.val(),\r\n\t\t\tisChecked: $checkbox.is( ':checked' ),\r\n\t\t}\r\n\t}\r\n\r\n\tsaveCategory( $checkbox ){\r\n\t\t// Get the data\r\n\t\tlet checkboxData = this.getCheckboxData( $checkbox );\r\n\r\n\t\t// Set checkbox as loading\r\n\t\tthis.setStatus( 'loading', true, $checkbox );\r\n\r\n\t\t// Do call\r\n\t\trestCall( 'set_recipe_terms', {\r\n\t\t\tterm_id:      'recipe_category',\r\n\t\t\trecipe_id:    UncannyAutomator.recipe.id,\r\n\t\t\tcategory_id:  checkboxData.id,\r\n\t\t\tset_category: checkboxData.isChecked\r\n\t\t}, ( response ) => {\r\n\t\t\t// If the call (not necessarily the task) was successful...\r\n\r\n\t\t\tif ( response.success ){\r\n\t\t\t\t// If everything went well...\r\n\t\t\t\t// Show a green check icon\r\n\t\t\t\tthis.setStatus( 'success', true, $checkbox );\r\n\r\n\t\t\t\t// Remove it after 2 seconds\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// Remove the green check icon\r\n\t\t\t\t\tthis.setStatus( 'success', false, $checkbox );\r\n\t\t\t\t}, 2000 );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.log( '‼️ ERROR-TODO. Couldn\\'t change the status of the recipe category' );\r\n\r\n\t\t\t\t// If something went wrong,\r\n\t\t\t\t// revert the value of the checkbox\r\n\t\t\t\tthis.revertCheckboxValue( $checkbox );\r\n\r\n\t\t\t\t// Show an error icon\r\n\t\t\t\tthis.setStatus( 'error', true, $checkbox );\r\n\t\t\t\t// Remove it after 2 seconds\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// Remove the error icon\r\n\t\t\t\t\tthis.setStatus( 'error', false, $checkbox );\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Remove loading animation\r\n\t\t\tthis.setStatus( 'loading', false, $checkbox );\r\n\t\t}, ( response ) => {\r\n\t\t\t// On error...\r\n\r\n\t\t\t// Revert the value of the checkbox\r\n\t\t\tthis.revertCheckboxValue( $checkbox );\r\n\r\n\t\t\t// Remove loading animation\r\n\t\t\tthis.setStatus( 'loading', false, $checkbox );\r\n\r\n\t\t\t// Show an error icon\r\n\t\t\tthis.setStatus( 'error', true, $checkbox );\r\n\t\t\t// Remove it after 2 seconds\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t// Remove the error icon\r\n\t\t\t\tthis.setStatus( 'error', false, $checkbox );\r\n\t\t\t});\r\n\t\t}, {\r\n\t\t\trequiresRecipesObject: false,\r\n\t\t\trenderUI:              false\r\n\t\t});\r\n\t}\r\n\r\n\trevertCheckboxValue( $checkbox ){\r\n\t\t// Revert the value of the checkbox\r\n\t\t$checkbox.prop( 'checked', ! $checkbox.is( ':checked' ) );\r\n\t}\r\n\r\n\tsetStatus( status = '', enable = true, $checkbox ){\r\n\t\t// Get label container\r\n\t\tconst $label = $checkbox.closest( '.selectit' );\r\n\r\n\t\t// Check what status we have to set or unset\r\n\t\tif ( status == 'loading' ){\r\n\t\t\t// Check if we have to add or remove the loading status\r\n\t\t\tif ( enable ){\r\n\t\t\t\t// Add loading animation\r\n\t\t\t\t$label.addClass( 'uap-taxonomy-loading' );\r\n\r\n\t\t\t\t// Disable checkbox\r\n\t\t\t\t$checkbox.prop( 'disabled', true );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Remove loading animation\r\n\t\t\t\t$label.removeClass( 'uap-taxonomy-loading' );\r\n\r\n\t\t\t\t// Enable checkbox\r\n\t\t\t\t$checkbox.prop( 'disabled', false );\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ( status == 'success' ){\r\n\t\t\t// Check if we have to add or remove the loading status\r\n\t\t\tif ( enable ){\r\n\t\t\t\t// Add loading animation\r\n\t\t\t\t$label.addClass( 'uap-taxonomy-success' );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Remove loading animation\r\n\t\t\t\t$label.removeClass( 'uap-taxonomy-success' );\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ( status == 'error' ){\r\n\t\t\t// Check if we have to add or remove the loading status\r\n\t\t\tif ( enable ){\r\n\t\t\t\t// Add loading animation\r\n\t\t\t\t$label.addClass( 'uap-taxonomy-error' );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Remove loading animation\r\n\t\t\t\t$label.removeClass( 'uap-taxonomy-error' );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass Tags {\r\n\tconstructor(){\r\n\t\t// Get elements\r\n\t\tthis.getElements();\r\n\r\n\t\t// Check if the required elements exist before adding\r\n\t\t// the event listeners\r\n\t\tif ( this.$elements.tagsTextarea.length == 1 ){\r\n\t\t\t// Listen modifications to the textarea\r\n\t\t\tthis.listenModificationsToTags();\r\n\t\t}\r\n\t}\r\n\r\n\tgetElements(){\r\n\t\tthis.$elements = {\r\n\t\t\tcontainer:    $( '#tagsdiv-recipe_tag' ),\r\n\t\t\ttagsTextarea: $( 'textarea#tax-input-recipe_tag' ),\r\n\t\t\ttagsList:     $( '#tagsdiv-recipe_tag .tagchecklist' )\r\n\t\t}\r\n\t}\r\n\r\n\tlistenModificationsToTags(){\r\n\t\t// Listen when the user adds a new tag. This will be\r\n\t\t// triggered when the user uses the input to add tags\r\n\t\tnew MutationObserver(( mutations ) => {\r\n\t\t\t// Save tags\r\n\t\t\tthis.saveTags();\r\n\t\t}).observe( this.$elements.tagsList[0], {\r\n\t\t\tchildList: true\r\n\t\t});\r\n\t}\r\n\r\n\tsaveTags(){\r\n\t\t// Get tags\r\n\t\tconst tags = this.getTags();\r\n\r\n\t\t// Set checkbox as loading\r\n\t\tthis.setStatus( 'loading', true );\r\n\r\n\t\t// Do call\r\n\t\trestCall( 'set_recipe_terms', {\r\n\t\t\tterm_id:      'recipe_tag',\r\n\t\t\trecipe_id:    UncannyAutomator.recipe.id,\r\n\t\t\ttags:         tags,\r\n\t\t}, ( response ) => {\r\n\t\t\t// If the call (not necessarily the task) was successful...\r\n\r\n\t\t\tif ( response.success ){\r\n\t\t\t\t// If everything went well...\r\n\t\t\t\t// Show a green check icon\r\n\t\t\t\tthis.setStatus( 'success', true );\r\n\r\n\t\t\t\t// Remove it after 2 seconds\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// Remove the green check icon\r\n\t\t\t\t\tthis.setStatus( 'success', false );\r\n\t\t\t\t}, 2000 );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Reload\r\n\t\t\t\t// location.reload();\r\n\t\t\t}\r\n\r\n\t\t\t// Remove loading animation\r\n\t\t\tthis.setStatus( 'loading', false );\r\n\t\t}, ( response ) => {\r\n\t\t\t// On error...\r\n\r\n\t\t\t// Reload\r\n\t\t\tlocation.reload();\r\n\t\t}, {\r\n\t\t\trequiresRecipesObject: false,\r\n\t\t\trenderUI:              false\r\n\t\t});\r\n\t}\r\n\r\n\tsetStatus( status = '', enable = true ){\r\n\t\t// Check what status we have to set or unset\r\n\t\tif ( status == 'loading' ){\r\n\t\t\t// Check if we have to add or remove the loading status\r\n\t\t\tif ( enable ){\r\n\t\t\t\t// Add loading animation\r\n\t\t\t\tthis.$elements.container.addClass( 'uap-tags-loading' );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Remove loading animation\r\n\t\t\t\tthis.$elements.container.removeClass( 'uap-tags-loading' );\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ( status == 'success' ){\r\n\t\t\t// Check if we have to add or remove the loading status\r\n\t\t\tif ( enable ){\r\n\t\t\t\t// Add loading animation\r\n\t\t\t\tthis.$elements.container.addClass( 'uap-tags-success' );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Remove loading animation\r\n\t\t\t\tthis.$elements.container.removeClass( 'uap-tags-success' );\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ( status == 'error' ){\r\n\t\t\t// Check if we have to add or remove the loading status\r\n\t\t\tif ( enable ){\r\n\t\t\t\t// Add loading animation\r\n\t\t\t\tthis.$elements.container.addClass( 'uap-tags-error' );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Remove loading animation\r\n\t\t\t\tthis.$elements.container.removeClass( 'uap-tags-error' );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetTags(){\r\n\t\t// Get tags separated by comma\r\n\t\tconst tagsCommaSeparated = this.$elements.tagsTextarea.val();\r\n\r\n\t\t// Create array\r\n\t\tconst tagsArray = tagsCommaSeparated.split( ',' );\r\n\r\n\t\t// Return both\r\n\t\treturn {\r\n\t\t\tasArray:        tagsArray,\r\n\t\t\tcommaSeparated: tagsCommaSeparated\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default Taxonomies;\n\n\n// WEBPACK FOOTER //\n// ./src/components/Taxonomies.js"],"sourceRoot":""}