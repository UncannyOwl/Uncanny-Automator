{"version":3,"sources":["webpack://automator-recipe-ui/./src/components/Actions.js","webpack://automator-recipe-ui/./src/components/Closures.js","webpack://automator-recipe-ui/./src/components/Field.js","webpack://automator-recipe-ui/./src/components/FieldsGroup.js","webpack://automator-recipe-ui/./src/components/FieldsRepeater.js","webpack://automator-recipe-ui/./src/components/ItemCreatorAdd.js","webpack://automator-recipe-ui/./src/components/ItemCreatorIntegrations.js","webpack://automator-recipe-ui/./src/components/ItemHeaderAsync.js","webpack://automator-recipe-ui/./src/components/ItemHeaderIcon.js","webpack://automator-recipe-ui/./src/components/ItemHeaderMenu.js","webpack://automator-recipe-ui/./src/components/ItemHeaderSentence.js","webpack://automator-recipe-ui/./src/components/ItemHeaderTag.js","webpack://automator-recipe-ui/./src/components/ItemOptions.js","webpack://automator-recipe-ui/./src/components/Markdown.js","webpack://automator-recipe-ui/./src/components/MetaboxFooter.js","webpack://automator-recipe-ui/./src/components/MetaboxItems.js","webpack://automator-recipe-ui/./src/components/MetaboxNotice.js","webpack://automator-recipe-ui/./src/components/Modal.js","webpack://automator-recipe-ui/./src/components/Publish.js","webpack://automator-recipe-ui/./src/components/RecipeNotices.js","webpack://automator-recipe-ui/./src/components/RecipeTitle.js","webpack://automator-recipe-ui/./src/components/RecipeTypeSelector.js","webpack://automator-recipe-ui/./src/components/SendFeedback.js","webpack://automator-recipe-ui/./src/components/Taxonomies.js","webpack://automator-recipe-ui/./src/components/Triggers.js","webpack://automator-recipe-ui/./src/components/UserSelector.js","webpack://automator-recipe-ui/./src/components/Utilities.js","webpack://automator-recipe-ui/./src/components/Validation.js","webpack://automator-recipe-ui/./src/components/itemCreatorTaskSelector.js","webpack://automator-recipe-ui/./src/components/tokens/token-selector.js","webpack://automator-recipe-ui/./src/components/tokens/tokens.js","webpack://automator-recipe-ui/./node_modules/flatpickr/dist/esm/index.js","webpack://automator-recipe-ui/./node_modules/flatpickr/dist/esm/l10n/default.js","webpack://automator-recipe-ui/./node_modules/flatpickr/dist/esm/types/options.js","webpack://automator-recipe-ui/./node_modules/flatpickr/dist/esm/utils/dates.js","webpack://automator-recipe-ui/./node_modules/flatpickr/dist/esm/utils/dom.js","webpack://automator-recipe-ui/./node_modules/flatpickr/dist/esm/utils/formatting.js","webpack://automator-recipe-ui/./node_modules/flatpickr/dist/esm/utils/index.js","webpack://automator-recipe-ui/./node_modules/flatpickr/dist/esm/utils/polyfills.js","webpack://automator-recipe-ui/./node_modules/html5sortable/dist/html5sortable.cjs.js","webpack://automator-recipe-ui/./node_modules/sprintf-js/src/sprintf.js","webpack://automator-recipe-ui/external \"jQuery\"","webpack://automator-recipe-ui/webpack/bootstrap","webpack://automator-recipe-ui/webpack/runtime/compat get default export","webpack://automator-recipe-ui/webpack/runtime/define property getters","webpack://automator-recipe-ui/webpack/runtime/hasOwnProperty shorthand","webpack://automator-recipe-ui/webpack/runtime/make namespace object","webpack://automator-recipe-ui/./src/index.js"],"names":["console","log","UncannyAutomator","getDOMElements","type","empty","recipe","isDefined","wp","UserSelector","actions","itemsObject","filter","itemType","hasClosures","closuresLabel","i18n","action","asyncActions","closuresLabelInstant","isEmpty","instantActions","filterMeta","MetaboxItems","delayedActions","filterMetaValue","scheduledActions","closuresLabelAsync","Closures","ItemCreatorAdd","MetaboxFooter","label","this","elements","$metabox","$","closures","key","closure","createClosure","wasAdded","$container","checkboxAttributes","formElementClass","closureInRecipe","getClosureByCodeFromItemsObject","code","currentValue","itemid","id","checkboxField","Field","$checkbox","getFormElement","on","isChecked","getValue","startLoadingAnimation","restCall","recipePostID","item_code","default_meta","integration_name","integrations","integration","name","sentence","response","Actions","post_ID","item","find","first","trigger","stopLoadingAnimation","setValue","ID","append","$toggleContent","addClass","$item","$itemHeader","createHeader","items","integrationCode","$itemContent","itemCode","itemId","$title","$actions","ItemHeaderMenu","$icon","ItemHeaderIcon","$itemTag","ItemHeaderTag","$titleSentence","ItemHeaderSentence","theItem","itemID","attributes","createDOMelements","customValidationFunction","setAttributes","createFormElement","initLibraries","inArray","getFieldTypes","formElement","fieldContainer","field","fieldLabel","fieldAttributes","optionCode","uniqueFieldID","isAjax","targetField","integrationID","endPoint","supportsTokens","supportsTinyMCE","isRequired","groupId","isHidden","isChildField","supportsCustomValue","supportsMultipleValues","prop","defaultValue","defaultOptionExists","hasSelectedOption","numberOfOptions","hasDefaultValue","option_value","option_name","$normalOptions","options","option","value","option_data","selectOption","text","compareStrings","hasValue","appendTo","val","e","defaultOption","prependTo","hasPlaceholder","prepend","customFieldValue","customValue","$otherOptions","validation","select","otherOptions","attr","customValueField","isReadOnly","supportsCopyToClipboard","fieldType","description","hasCustomValueDescription","customValueDescription","undefined","placeholder","tokenName","vsprintf","customValueToken","parentOptionCode","selectHasSelectedOption","$noResults","Option","noResults","event","customData","fieldContainerClass","$fakeCodemirrorField","maxLength","includes","$clearButton","clear","clearValue","checkboxLabel","checkboxPseudo","hasLabel","html","isToggle","toggle","checkboxToggleOn","off","checkboxToggleOff","color","error","align","$fields","$fieldContainers","index","$formRadioContainer","$field","add","$fakeRadio","fieldLabelAsterisk","fieldError","hasDescription","fieldDescription","customValueFieldContainer","removeClass","onChange","onFocus","join","getUniqueId","JSON","parse","dateFormat","dateAltFormat","format","date","minDate","maxDate","supportsRange","timeFormat","timeAltFormat","minTime","maxTime","renderError","getFieldContainer","required","validateField","onChangeAJAXCallback","doAJAX","parentField","getField","completedFirstLoad","setCustomValue","onChangeTimeout","clearTimeout","setTimeout","currentTarget","ready","getMetaValue","integrationId","endpoint","parentFieldValue","targetFieldValue","AJAXRequest","recipe_id","integration_id","item_id","group_id","field_id","target_field","values","getCurrentFieldsValues","getAttributes","getSelectCustomValue","setSelectOptions","isReady","isTargetField","fields","reduce","accumulator","manuallySet","TokenSelector","parseHTMLTokensInPlainTextarea","is","map","optionValue","itemSeparator","getSelectOptionByValue","trueLabel","falseLabel","$checkedRadio","length","closest","trim","fieldValue","meta","push","forEach","metaValue","doTrigger","allOptions","optionID","fieldTinyMCE","setContent","wantsToCheck","fieldCM","flatpickrInstance","triggerChange","removeSelectOptions","$optionsContainer","optionsDOM","optionDOM","rerenderSelect2","hasClass","CSSclass","initSelect2","initURLChecker","initFlatpickr","settings","theme","searchInputPlaceholder","search","language","templateResult","data","template","Number","isInteger","parseInt","postIDPlaceholder","replace","templateSelection","escapeMarkup","markUp","customClass","getSelect2Settings","select2","document","getElementById","container","allowInput","positionElement","altInput","clickOpens","locale","weekdays","shorthand","sunday","monday","tuesday","wednesday","thursday","friday","saturday","longhand","months","january","february","march","april","may","june","july","august","september","october","november","december","rangeSeparator","firstDayOfWeek","weekAbbreviation","scrollTitle","scrollToIncrement","toggleTitle","clickToToggle","amPM","am","pm","yearAriaLabel","year","monthAriaLabel","month","hourAriaLabel","hour","minuteAriaLabel","minute","onReady","selectedDates","dateStr","instance","formatCodemirrorDate","setCodemirrorValue","altFormat","mode","enableTime","noCalendar","manTime","flatpickr","destroyCodeMirror","initialValue","CodeMirror","lineNumbers","tabSize","dragDrop","noNewlines","viewportMargin","Infinity","lineWrapping","autoRefresh","extraKeys","Tab","readOnly","setOption","open","focus","initCodeMirror","getWrapperElement","parentNode","removeChild","destroyTokenSelector","tokenSelector","initTokenSelector","destroy","fieldId","editor","tinymce","get","remove","initialize","mediaButtons","wpautop","toolbar1","toolbar2","quicktags","debounce","getContent","Defaults","fn","amd","require","extend","defaults","SearchDropdown","_renderSearchDropdown","prototype","render","decorated","$rendered","apply","Array","slice","arguments","$search","window","jQuery","createFields","fieldData","$label","$formGroup","$fieldElement","$description","fieldsValue","getFieldID","validationObject","isValid","message","validate","sortable","rowFieldsTemplate","fieldsRows","isArray","row","rowFields","stringify","emptyRow","fieldObject","fieldRows","$table","getFieldsTable","makeRowsSortable","listenSave","updateAttributesFieldsFromRow","forcePlaceholderSize","handle","itemSerializer","serializedItem","sortableContainer","position","newOrder","detail","destination","newFieldRowsOrder","oldIndex","reRender","heading","title","$heading","headingColumn","$headingColumn","$rows","numberOfRows","$row","$fieldCell","fieldAtts","removeRowLabel","removeRowButtonLabel","removeRow","$removeRowButton","deleteRow","hideActions","$addRowButton","addRow","addRowButtonLabel","fieldsData","$currentFormElement","$newFormElement","replaceWith","splice","rowsValidation","rowValidation","$containerBox","$button","ItemCreatorIntegrations","$currentItem","header","itemContent","createIntegrations","discoverMore","createDiscoverMoreIntegrations","lastItem","insertAfter","icon","titleContainer","titleContent","filterByNonEmptyIntegrations","sortIntegrationsAlphabetically","integrationElement","createIntegration","itemCreatorTaskSelector","$logoImg","logo","isProOnly","proOnly","pro","isAvailable","requiresPro","uncannyAutomatorPro","icon_svg","icon_32","icon_64","addParametersToURL","learnMore","Object","entries","hasItems","filterDeprecatedItems","triggers","hasTriggers","hasAvailableItems","allItemsArePro","hasActions","sortArrayOfObjectsAlphabetically","asyncMode","async_mode","proVersion","startsWith","createAsyncButton","async_delay_number","async_delay_unit","async_schedule_time","async_schedule_date","hasSchedule","async_sentence","delay","buttonContainer","button","buttonIcon","getButtonText","createRemoveButton","isNew","createBadge","showModal","buttonBadge","removeButton","removeButtonIcon","removeSchedule","modalContent","asyncModeHTML","createasyncModeHTML","after","createDelayOptions","createScheduleOptions","attachModeChangeEvent","modalNoticeHTML","modalNoticeIcon","modal","scheduleNotice2","Modal","content","createModalContent","buttons","cancel","confirm","size","modalEvents","setEvents","afterSetEvents","show","onConfirm","submitModal","afterHide","confirmButton","getElements","box","validateForm","asyncModeField","delayNumber","delayNumberField","delayUnit","delayUnitField","scheduleTime","scheduleTimeField","scheduleDate","scheduleDateField","delaySentence","scheduleSentence","saveSchedule","multiplier","unit","Date","publish","statusToggle","timeZoneHelpIcon","timeZoneDesc","timezone","timezoneString","schedule","scheduleNoticeHTML","scheduleOptions","scheduleDesc","scheduleFields","scheduleNoticeIcon","scheduleNotice1","createScheduleDateHTML","createScheduleTimeHTML","createTimeZone","delayOptions","delayDesc","delayFields","delayNumberHTML","createDelayNumberHTML","delayUnitHTML","createDelayUnitHTML","delayFieldsDesc","validateDelayNumber","seconds","minutes","hours","days","years","$scheduleDateField","$scheduleTimeField","validSchedule","validateScheduleFields","unsupported","simulate_int","positiveNumber","createItemIcon","createItemActions","btn","btnIcon","dropdown","dropdownUl","deleteAction","deleteText","isMissing","globalItemData","getGlobalItem","support_link","utmContent","replaceCurlyBraces","select_option_name","toLowerCase","supportAction","supportText","support","target","has","isLive","confirmationModal","warning","deleteWarning","Triggers","createItemSentence","itemSentence","globalItem","parseStringWithTokens","token","$token","parents","optionsID","groupID","ItemOptions","status","itemToggle","liveRecipeItem","draftRecipeItem","itemStatusToggle","makeLive","isValidItem","validateItem","post_status","statusWarning","itemSentenceHTML","outerHTML","sentence_human_readable","brackets","sentence_human_readable_html","RecipeNotices","onCancel","integrationName","createItemTag","tag","optionId","create","initTinyMCE","contentContainer","itemOptions","createButtons","fieldsContainer","noticeContainer","keyCode","saveButton","automatorButtons","developerButtons","cancelButton","save","$buttonElement","css_classes","doOnClick","on_click","eval","modules","Markdown","validateItemFields","getOptionValue","hasSelect","hasRepeater","getReadableValue","keys","escapeHTML","parseItalicsAndBold","parseAnchors","wholeMatch","m1","m2","m3","m4","m5","m6","m7","linkText","linkId","url","result","encodeURI","shouldCreateMetaboxFooter","createFooter","recipeActions","addAnother","$anonymousNotice","createAnonymousNotice","recipeType","anonymousOnlyOneTrigger","createItem","inlineCss","notice","createNotice","ItemHeaderAsync","itemTag","titleSentence","itemMissing","noticeType","noticeMessage","metabox","config","automatorContainer","isVisible","fadeDuration","warningFirst","modalWarning","modalBox","modalTitle","modalButtons","bind","events","emptyFunction","afterShow","hide","thisModal","unbind","callback","fadeIn","fadeOut","timesPerUser","editLink","hiddenBox","timesPerRecipe","createMetabox","class","footer","timesRow","timesRowVisible","timesRowIconBox","timesRowIcon","timesRowName","timesValue","unlimited","timesRowValue","timesRowEdit","edit","timesRowHidden","timesRowHiddenBox","timesRowField","leaveEmpty","simulatedValue","oneOrBigger","timesField","timesRowButtons","timesRowSaveBtn","timesRowCancelBtn","recipeTypeRow","recipeTypeRowVisible","recipeTypeRowIconBox","recipeTypeRowIcon","recipeTypeRowName","recipeTypeRowValue","recipeTypeLearnMore","userRecipeName","anonymousRecipeName","createdRow","createdRowVisible","createdRowIconBox","createdRowIcon","createdRowName","createdOn","createdRowValue","copyRecipeRow","copyRecipeRowVisible","copyRecipeRowName","href","copyToDraft","copyRecipe","footerRow","footerRowLeft","footerMoveToDraft","moveToTrash","footerRowRight","recipeStatusToggle","liveRecipe","draftRecipe","recipeStatusToggleDOM","validateStatus","timesRecipeRow","timesRecipeRowVisible","timesRecipeRowIconBox","timesRecipeRowIcon","timesRecipeRowName","timesRecipeValue","timesRecipeRowValue","timesRecipeRowEdit","timesRecipeRowHidden","timesRecipeRowHiddenBox","timesRecipeRowField","timesRecipeField","timesRecipeRowButtons","timesRecipeRowSaveBtn","timesRecipeRowCancelBtn","$element","$fieldValue","$timeField","slideToggle","Publish","numberOfTimes","recipe_completions_allowed","validateTimesPerFields","postStatus","errorMode","createContainer","emptyContainer","createWarning","createError","input","publishedTitle","createStatus","bindChanges","notSavedAlert","uapContainer","saving","savingIcon","savingText","saved","savedIcon","savedText","stop","typingTimeout","setStatusSaving","updateTitle","post_title","getTitle","setStatusSaved","revertChanges","doWhenReady","listenSubmission","$recipeTypeSelector","userRecipeDescription","anonymousRecipeDescription","cantChangeLaterNotice","$elements","form","submitButton","preventDefault","showError","errorDidNotSelectType","saveRecipeType","errorTryingToSaveOtherValue","recipe_type","success","$triggersMetaboxTitle","triggersMetaboxTitle","userTriggers","anonymousTrigger","errorSomethingWentWrong","errorMessage","$error","$oldErrorContainer","build","version","utmSource","sendFeedbackContainer","sendFeedbackButton","sendFeedback","sendFeedbackButtonIcon","close_btn","dont_show_again_checkbox","overlay","mainContainer","localStorage","uapSendFeedbackWelcome","Categories","allCategories","listenCheckboxes","saveCategory","MutationObserver","mutations","mutation","addedNodes","addedNode","observe","childList","checkboxData","getCheckboxData","setStatus","term_id","category_id","set_category","revertCheckboxValue","requiresRecipesObject","renderUI","enable","Tags","tagsTextarea","listenModificationsToTags","tagsList","saveTags","tags","getTags","location","reload","tagsCommaSeparated","asArray","split","commaSeparated","userSelector","step","userSelectorObject","$content","recipeObject","getSelectSourceNodes","getOptionsNodes","getSentenceNodes","$userSelector","userType","existing","getHeaderNodes","userSource","source","getOptionsFields","optionsFields","roles","resources","administrator","$groupOfFields","uniqueField","existingUser","uniqueFieldLabel","uniqueFieldOptionEmail","uniqueFieldOptionId","uniqueFieldOptionUsername","valueField","uniqueFieldValue","valueFieldLabel","valueFieldPlaceholder","$uniqueFieldFormElement","$valueFieldFormElement","fallbackField","createNewUserFieldLabel","fallback","createNewUserFieldOptionCreateUser","createNewUserFieldOptionDoNothing","$fallbackFieldFormElement","$doNothingNotice","doNothingMessage","$subOptionsContainer","firstName","newUser","lastName","email","username","displayName","password","passwordDescription","role","canLogNewUserIn","logUserIn","yes","no","$fieldFormElement","newUserFallbackField","existingUserFieldLabel","existingUserFieldOptionExisting","existingUserFieldOptionDoNothing","$newUserfallbackFieldFormElement","fieldsValues","prioritizedField","prioritizedFieldLabel","prioritizedFieldDescription","$prioritizedField","$buttonsContainer","$saveButton","$cancelButton","areAllFieldsValid","isFieldValid","recipeId","$summaryContainer","$sourceRow","$sourceRowToken","$dataRowSentence","$dataRow","summary","matches","withEmail","$fallbackRow","otherwiseText","createNewUser","doNothing","selectExistingUser","$fallbackRowSentence","otherwise","sentenceTitle","setOptions","$output","toggleClass","createDataOnLoad","consoleLogLabel","completeProcess","filterAutomatorItemsByRecipeType","groupItemsByIntegration","allRecipes","recipes_object","RecipeTypeSelector","validActions","requiredData","theRecipe","concat","recipeIsAnonymous","itemToAdd","option_code","options_group","groupsOfOptions","groupKey","allFieldsOnThisGroup","hasMoreThanOneOption","fieldInstance","sanitizeFieldData","isGroup","read_only","supports_tinymce","copy_to_clipboard","is_ajax","input_type","is_hidden","token_name","default_value","customFieldTokens","relevant_tokens","max_length","date_format","date_alt_format","supports_range","min_date","max_date","time_format","time_alt_format","min_time","max_time","supports_tokens","supports_custom_value","custom_value_description","supports_multiple_values","fill_values_in","FieldsGroup","hide_actions","add_row_button","remove_row_button","FieldsRepeater","show_in","tokens","inline_css","filterTokens","filter_tokens","optionKey","can_log_in_new_user","recipeTriggers","missingAttributes","arrayDifference","isRecipeValid","hasLive","itemData","itemIsValid","optionsGroupID","optionsGroupData","groupIsValid","liveItems","oneAction","oneTrigger","matchFilters","available","unavailable","proFeatures","every","is_pro","hasUnavailableItems","propertyToCompare","sort","a","b","compare","valueA","valueB","localeCompare","getItemsByIntegration","assign","addDeprecatedItems","is_deprecated","dev","debugMode","collapseGroup","consoleLogResult","groupEnd","onSuccess","onFail","validEndpoints","method","restURL","doing_rest","dataType","beforeSend","xhr","setRequestHeader","nonce","statusCode","403","jqXHR","textStatus","errorThrown","fail","ajaxurl","bgColor","groupOfFields","optionsGroupId","optionsGroup","integrationItems","element","validElements","cssSelector__metabox","$items","cssSelector","$contentContainer","cssSelector__tokenInSentence","cssSelector__fieldsContainer","$tokenInSentence","$fieldsContainer","tokenInSentence","optionsContainer","last","string","plain","normal","parts","match","tokensRegex","RegExp","normals","mappedString","tokenNumber","stringParts","full_match","readableText","tokenParts","tokenPlaceholderText","tokenValueID","hasFields","originalText","normalNumber","sentenceSection","exec","part","itemTokens","elementAttributes","contentIsNode","tagNodeContent","test","Tokens","includeGroupName","renderTextWithTokens","abbreviatedText","abbreviateText","isAbbreviated","decodeEntities","variable","isObject","string1","string2","caseSensitive","toString","needle","haystack","array1","array2","not","arguments_array","isString","removeSpaces","start","end","labelStyle","groupCollapsed","group","tagsToReplace","replaceTag","partLengths","Math","floor","textParts","substring","random","substr","parameters","URL","urlParameters","i","x","parameter","setAsURL","refresh","pageTitle","history","pushState","encodedString","$textarea","createElement","innerHTML","throttle","func","interval","lastCall","now","args","self","copyToClipboard","$tempTextarea","style","width","height","body","appendChild","execCommand","handleFatalError","recipeData","reportLog","logRecipe","debugging","recipeTitle","recipeTypeUser","recipeTypeAnonymous","recipeStatus","recipeStatusDraft","recipeStatusLive","logRecipeItems","recipeItemsTitle","cleanItemData","itemStatusLive","itemStatusDraft","triggersTitle","noTriggers","actionsTitle","noActions","closuresTitle","noClosures","noRecipeItemsFound","jsConsole","stack","replaceAll","siteURL","recipeCouldntBeLoaded","recipeFailedNotice","buttonGoBack","debuggingURL","recipesUrl","$debuggingConsole","range","createRange","selectNodeContents","getSelection","removeAllRanges","addRange","itemsWithMeta","exist","filteredItems","validateRecipe","canSubmit","itemElement","optionsGroupElements","validateChildren","isFormValid","each","radioInput","selectedRadio","field_type","fieldTypes","messages","invalid","textarea","int","multipleTokens","float","single","multiple","checkbox","radio","time","invalidType","tokensInString","$childrenFields","customValidation","int_regex","getTokensFromString","hasTokens","simulate_float","float_regex","simulate_email","email_regex","emails","allEmailsAreValid","hasMultipleEmails","hasMultipleVariables","validateURL","parseURL","simulatedURL","$error_container","regex","allTokens","includeGroupIcon","matchedToken","tokenGroup","replaceTokensInString","output","regexCondition","getExampleValueByFieldType","changed","newURL","regexURL","tokensInValue","simulate_url","checkURL","$this","input_attributes","validationNotice","validationNoticeHeader","validationNoticeURL","preURL","createItemsList","$header","$itemActions","$itemIcon","$integrationTag","searchPlaceholder","unlockTriggers","unlockActions","$taskSelector","$searchField","$itemsList","list","isPro","restRequestCode","defaultMeta","$newItem","utm_medium","query","hasResults","createCancelButton","TokenSelectorTextarea","TokenSelectorInput","setData","getCodeMirrorEditor","renderTokens","handleAddTokens","renderTokensInRealTime","RenderTokenSelector","tokenRenderingDebounce","insertTextAtCursor","doc","replaceRange","getCursor","querySearchTokens","getSearchCursor","from","to","tokenId","getRange","$tokenNode","createTokenDOMNode","widget","markText","replacedWith","addEventListener","classList","contains","onFocusOut","removeEventListener","onClickOutside","onCopy","onDelete","onNavigation","charCode","widgetPosition","setCursor","findNext","getTinyMCEEditor","addStylesToEditor","parsePlainTokensInTinyMCE","handleHTMLTokensInPlainTextarea","handlePlainTokensInTinyMCE","tokenCSSClass","tokenWithBrackets","cursorPosition","newCursorPosition","newValue","dom","addStyle","editorContent","editorContentWithTokens","$temporalContainer","$tokens","querySelectorAll","tokenID","dataset","getData","createWrapper","createFilter","createGroupsOfTokens","listenToggleButton","resizeDropdownOnWindowResize","resizeDropdownOnWindowScroll","refreshOnFieldChange","shouldSupportFilters","setFilter","isOpen","wrapper","toggleButton","searchField","allGroups","dropdownGroupsContainer","dropdownTokens","noResultsOption","$wrapper","$fieldToMove","getFieldCM","renderContainer","searchFieldContainer","fieldTypeHumanReadable","tokenType","$filterContainer","filterToggle","$filterFormElement","filterContainer","groupOfTokens","createIndividualGroupOfTokens","noResultsDescriptionWithFilter","noResultsDescription","$group","groupName","clone","$tokensListContainer","close","$modalContent","metaKeyField","specialTokens","userMeta","userMetaKey","userMetaKeyDescription","fieldValidation","global","userMetaKeyTemplate","updateGroupsOfTokensVisibility","filterByType","$tokensByType","closeWhenClickedOutside","css","outerWidth","setDropdownDirection","setDropdownHeight","children","$window","above","offset","top","scrollTop","below","outerHeight","dropdownHeight","hasSpaceBelow","getDropdownPosition","maxHeight","saveData","includeGroupTokens","tokensRegEx","getAllTokens","tokensList","commonTokens","getCommonTokens","advancedTokens","getAdvancedTokens","itemsTokens","getItemsTokens","common","siteName","cacheable","userID","userUsername","userFirstName","userLastName","userEmail","userDisplay","userResetPassLink","adminEmail","siteUrl","recipeName","currentDate","currentTime","advanced","autoLoginLink","getItemTokens","tokensGroup","icon_16","rowIndex","rowNumber","tokenIdentifier","getTokenDataByID","cache","cloneNode","$tokenName","$tokenIcon","originalTokenID","some","locatedToken","currentToken","textWithTokens","hasTemplate","fullMatch","tokenHTML","FlatpickrInstance","instanceConfig","defaultConfig","l10n","bindToInstance","setCalendarWidth","weekNumbers","showMonths","requestAnimationFrame","calendarContainer","visibility","display","daysContainer","daysWidth","offsetWidth","weekWrapper","removeProperty","updateTime","defaultDate","compareDates","getTime","getDefaultHours","setHours","getMilliseconds","latestSelectedDateObj","isKeyDown","eventTarget","getEventTarget","textContent","min","parseFloat","getAttribute","max","curValue","delta","which","isHourElem","hourElement","isMinuteElem","minuteElement","incrementNumInput","abs","pad","timeWrapper","prevValue","_input","setHoursFromInputs","updateValue","_debouncedChange","secondElement","limitMinHours","minDateHasTime","maxDateHasTime","getHours","getMinutes","getSeconds","setHoursFromDate","dateObj","isMobile","time_24hr","onYearInput","changeYear","handler","ev","el","_handlers","triggerEvent","jumpToDate","jumpDate","jumpTo","parseDate","oldYear","currentYear","oldMonth","currentMonth","getFullYear","getMonth","errorHandler","buildMonthSwitch","redraw","timeIncrement","className","indexOf","inputElem","firstChild","createEvent","dispatchEvent","createDay","dayNumber","dateIsEnabled","isEnabled","dayElement","getDate","$i","setAttribute","formatDate","ariaDateFormat","todayDateElem","tabIndex","isDateSelected","selectedDateElem","isDateInRange","insertAdjacentHTML","getWeek","focusOnDayElem","targetNode","onMouseOver","getFirstAvailableDay","startMonth","endMonth","m","startIndex","endIndex","c","focusOnDay","current","dayFocused","isInView","activeElement","startElem","givenMonth","loopDelta","numMonthDays","changeMonth","getNextAvailableDay","buildMonthDays","firstOfMonth","getDay","prevMonthDays","utils","getDaysInMonth","daysInMonth","createDocumentFragment","isMultiMonth","prevMonthDayClass","nextMonthDayClass","dayIndex","dayNum","dayContainer","buildDays","clearNode","frag","d","setMonth","monthSelectorType","shouldBuildMonth","monthsDropdownContainer","monthToStr","shorthandCurrentMonth","selected","buildMonth","monthNavFragment","monthElement","selectedMonth","yearInput","createNumberInput","tabindex","yearElement","getElementsByTagName","disabled","buildMonths","monthNav","prevMonthNav","yearElements","monthElements","nextMonthNav","buildWeekdays","weekdayContainer","updateWeekdays","isOffset","_hidePrevMonthArrow","_hideNextMonthArrow","updateNavigationCurrentMonth","isCalendarElem","elem","documentClick","inline","isCalendarElement","isInput","path","lostFocus","relatedTarget","isIgnored","ignoredFocusElements","timeContainer","newYear","newYearNum","isNewYear","timeless","_a","dateToCheck","disable","bool","array","parsed","onBlur","setDate","onKeyDown","wrap","allowKeydown","allowInlineKeydown","blur","isTimeObj","focusAndClose","selectDate","ctrlKey","stopPropagation","currentYearElement","elems","pluginElements","shiftKey","charAt","hoverDate","firstElementChild","initialDate","rangeStartDate","rangeEndDate","containsDisabled","minRange","maxRange","t","duration","l","dayElem","timestamp","outOfRange","isBetween","onResize","static","positionCalendar","minMaxDateSetter","inverseDateObj","removeAttribute","getInputElem","querySelector","setupLocale","l10ns","Error","default","tokenRegex","createDateFormatter","createDateParser","customPositionElement","_positionElement","calendarHeight","call","acc","child","offsetHeight","calendarWidth","configPos","configPosVertical","configPosHorizontal","inputBounds","getBoundingClientRect","distanceFromBottom","innerHeight","bottom","showOnTop","pageYOffset","left","pageXOffset","isCenter","isRight","right","rightMost","centerMost","editableSheet","styleSheets","sheet","cssRules","err","head","createStyleSheet","getDocumentStyleSheet","bodyWidth","centerLeft","centerBefore","centerAfter","centerIndex","centerStyle","insertRule","navigator","userAgent","msMaxTouchPoints","findParent","day","selectedDate","shouldChangeMonth","selectedIndex","closeOnSelect","loadedPlugins","_bind","_setHoursFromDate","_positionCalendar","triggerChangeEvent","toInitial","mobileInput","_initialDate","_createElement","lastChild","insertBefore","_type","k","_","click","wasOpen","set","CALLBACKS","HOOKS","arrayify","setSelectedDate","inputDate","dates","conjunction","allowInvalidPreload","parseDateRules","arr","rule","hooks","initEvent","getDateStr","dObj","mobileFormatStr","onMonthNavClick","isPrevMonth","isNextMonth","boolOpts","userConfig","formats","defineProperty","_enable","_disable","timeMode","defaultDateFormat","enableSeconds","defaultAltFormat","_minDate","_maxDate","minMaxTimeSetter","_minTime","_maxTime","hook","disableMobile","plugins","pluginConf","altInputClass","parseConfig","nodeName","nextSibling","preloadedDate","setupDates","yr","fragment","prevArrow","nextArrow","__hidePrevMonthArrow","__hideNextMonthArrow","innerContainer","buildWeeks","rContainer","separator","hourInput","minuteInput","military2ampm","hourIncrement","minuteIncrement","secondInput","defaultHour","buildTime","animate","customAppend","nodeType","evt","inputType","String","setupMobile","debouncedResize","ontouchstart","capture","selText","bindEvents","isSafari","init","_flatpickr","nodeList","nodes","HTMLElement","instances","node","HTMLCollection","NodeList","selector","Node","en","localize","setDefaults","fp_incr","english","ordinal","nth","s","autoFillDefaultTime","defaultMinute","defaultSeconds","warn","givenDate","week1","round","onClose","onDayCreate","onDestroy","onMonthChange","onOpen","onParseConfig","onValueUpdate","onYearChange","onPreCalendarPosition","frmt","overrideLocale","givenFormat","customLocale","parsedDate","dateOrig","toFixed","datestr","matched","ops","matchIndex","regexStr","isBackSlash","escaped","revFormat","isNaN","date1","date2","compareTimes","ts","ts1","ts2","DAY","minHour","minMinutes","minSeconds","maxHr","maxMinutes","condition","inputClassName","opts","numInput","arrowUp","arrowDown","pattern","composedPath","monthNumber","D","F","monthName","G","H","J","K","M","shortMonth","S","setSeconds","U","unixSeconds","W","weekNum","weekNumber","Y","setFullYear","Z","ISODate","h","setMinutes","j","n","u","unixMillSeconds","w","y","toISOString","number","wait","obj","TypeError","addData","h5s","stores","Map","Store","_config","_placeholder","_data","mergedConfig","enumerable","configurable","setConfig","getConfig","deleteData","delete","store","sortableElement","eventName","addAttribute","attribute","dragging","draggingHeight","draggingWidth","originContainer","originIndex","originElementIndex","originItemsBeforeUpdate","previousContainer","destinationItemsBeforeUpdate","parentElement","getClientRects","rect","getIndex","elementList","isInDom","insertNode","referenceNode","newElement","nextElementSibling","getElementHeight","getComputedStyle","getPropertyValue","sum","getElementWidth","getHandles","shadowRoot","defaultDragImage","draggedElement","elementOffset","posX","pageX","posY","pageY","listsConnected","origin","isSortable","acceptFrom","sel","defaultConfiguration","connectWith","disableIEFix","copy","placeholderClass","draggingClass","hoverClass","dropTargetContainerClass","throttleTime","maxItems","containerSerializer","customDragImage","orientation","enableHoverClass","hoverClasses_1","threshold","_this","lastEventTimestamp","_i","_b","removeItemEvents","removeContainerEvents","removeSortableData","removeItemData","findSortable","findDragElement","itemlist","ele","enableSortable","handles","parent","sortableElements","customItemSerializer","customContainerSerializer","serializedContainer","serializedItems","itemCount","serialize","configKey","hasOwnProperty","reloadSortable","customPlaceholder","listItems","tempContainer","tagName","makePlaceholder","stopImmediatePropagation","dragItem","Event","dataTransfer","setDragImage","dragImage","effectAllowed","draggedItem","ditem","oldDisplay","getDragging","CustomEvent","elementIndex","originalTarget","itemsBeforeUpdate","outTarget","fromElement","visiblePlaceholder","originItems","destinationContainer","destinationItems","destinationElementIndex","destinationIndex","timeout","debouncedDragOverEnter","thisHeight","thisWidth","placeholderIndex","thisIndex","deadZoneVertical","deadZoneHorizontal","offsetTop","offsetLeft","placeAfter","elementMiddleVertical","elementMiddleHorizontal","placeholders","onDragOverEnter","dropEffect","destroySortable","disableSortable","__testing","module","exports","re","not_string","not_bool","not_type","not_primitive","numeric_arg","json","not_json","modulo","key_access","index_access","sign","sprintf","sprintf_format","sprintf_parse","fmt","argv","parse_tree","arg","ph","pad_character","pad_length","is_positive","cursor","tree_length","param_no","Function","fromCharCode","precision","toExponential","toPrecision","valueOf","toUpperCase","pad_char","repeat","sprintf_cache","_fmt","arg_names","SyntaxError","field_list","replacement_field","field_match","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","__esModule","definition","o","r","Symbol","toStringTag","SendFeedback","RecipeTitle","Taxonomies"],"mappings":";8WAiGA,QAzEI,c,4FAAa,SACTA,QAAQC,IAAIC,mBAKGC,oBAAgB,UAAW,CAAEC,KAAM,WACzCC,QAG4B,aAAhCH,iBAAiBI,OAAOF,OAAuBG,eAAWL,iBAAiBM,KAAQN,iBAAiBM,IAErG,IAAIC,UAIR,IAAIC,GAAUC,iBAAa,MAAO,CAC9BC,OAAQ,CACJC,SAAU,YAIdC,GAAc,EACdC,EAAiBb,iBAAiBc,KAAKC,OAAOC,aAAaC,qBAG/D,KAAOC,aAASV,KAAaH,eAAWL,iBAAiBM,KAAQN,iBAAiBM,GAAI,CAElF,IAAIa,GAAiBC,gBAAYZ,EAAS,cAAc,GAGxD,IAAIa,UAAc,SAAUF,GAE5B,IAAIG,GAAiBC,qBAAiBf,EAAS,aAAc,SACzDgB,GAAmBD,qBAAiBf,EAAS,aAAc,aAExDU,aAASI,KAAsBJ,aAASM,KAC3CX,EAAiBb,iBAAiBc,KAAKC,OAAOC,aAAaS,mBAE3D,IAAIC,UAAUb,GAGdD,GAAc,GAIlB,IAAIS,UAAc,SAAUC,GAC5B,IAAID,UAAc,SAAUG,QAElBN,aAASV,GAInB,IAAImB,UAAgB,UAHpB,IAAIN,UAAc,SAAUb,GAOhC,IAAIoB,UAAe,UAOZhB,GACH,IAAIc,UAAUb,K,yiBC8G1B,Q,WAtLI,WAAagB,GAAO,Y,4FAAA,SAKhBC,KAAKC,SAAW,CACZC,UAAU/B,oBAAgB,UAAW,CAAEC,KAAM,YAKjD+B,SAAQjC,iBAAiBkC,UAAU,SAAEC,EAAKC,GAAP,OAAoB,EAAKC,cAAeD,EAASP,M,kDAMxF,SAAeO,EAASP,GAEpB,IAAIS,GAAW,EAGXC,EAAaN,IAAG,SAAU,CAAE,MAAS,oBAGrCO,EAAqB,CACrBX,MAAoBA,EACpBY,iBAAoB,0BAIpBC,EAAkBZ,KAAKa,gCAAiCP,EAAQQ,OAE/DvC,eAAWqC,KACZJ,GAAW,EAEXE,EAAmBK,cAAe,EAClCL,EAAmBM,OAAeJ,EAAgBK,IAStD,IAAIC,EAAgB,IAAIC,UAAO,WAAYT,GACvCU,EAAiBF,EAAcG,iBAGnCD,EAAUE,GAAI,UAAU,WACpB,IAAIC,EAAYL,EAAcM,WAC9BN,EAAcO,wBAGTF,GAEDG,cAAU,MAAO,CACbC,aAAczD,iBAAiBI,OAAO2C,GACtChC,OAAc,kBACd2C,UAActB,EAAQQ,KACtBe,aAAc,CACVC,iBAAkB5D,iBAAiB6D,aAAczB,EAAQ0B,aAAcC,KACvEC,SAAkB5B,EAAQ4B,YAE/B,SAAEC,GACD,IAAIC,WAGC7D,eAAW4D,EAASE,WAEJlE,oBAAgB,OAAQ,CACrC8C,GAAIkB,EAASE,UAIRC,KAAKC,KAAM,sDAAuDC,QAAQC,QAAS,YAEjG,SAAEN,GACDnE,QAAQC,IAAK,2CAGbiD,EAAcwB,uBAGdxB,EAAcyB,UAAU,GAAO,OAInCjB,cAAU,SAAU,CAChBkB,GAAIhC,EAAgBK,KACrB,WACC,IAAImB,aACL,WACCpE,QAAQC,IAAK,8CAEb,IAAImE,gBAMhB3B,EAAWoC,OAAQzB,GAGnB,IAAI0B,EAAiB3C,IAAG,SAAU,CAAE,MAAS,8BAG7C,GAAKK,EAAU,CACXsC,EAAeC,SAAU,mBAEzB,IAAIC,EAAQ7C,IAAG,SAAU,CACrB,MAAW,qCACX,UAAWS,EAAgBK,KAG3BgC,EAAcjD,KAAKkD,aACnBhF,iBAAiBI,OAAO6E,MAAOvC,EAAgBK,IAAKmC,gBACpD,UACA9C,EAAQQ,KACRF,EAAgBK,IAGpB+B,EAAMH,OAAQI,GAEd,IAAII,EAAelD,IAAG,SAAU,CAAE,MAAS,kBAC3C6C,EAAMH,OAAQQ,GAEdP,EAAeD,OAAQG,GAG3BvC,EAAWoC,OAAQC,GAGnB9C,KAAKC,SAASC,SAAS2C,OAAQpC,K,0BAcnC,SAAc2C,EAAiBvE,EAAUyE,EAAUC,GAC/C,IAAI9C,EAAaN,IAAG,UAChBqD,EAAarD,IAAG,SAAU,CAAE,MAAS,yBAErCsD,EAAW,IAAIC,UAAgB7E,EAAUuE,EAAiBE,EAAUC,GACxE9C,EAAWoC,OAAQY,GAEnB,IAAIE,EAAW,IAAIC,UAAgBR,GACnC3C,EAAWoC,OAAQc,GAEnB,IAAIE,EAAW,IAAIC,UAAeV,GAClCI,EAAOX,OAAQgB,GAEf,IAAIE,EAAiB,IAAIC,UAAoBnF,EAAUuE,EAAiBE,EAAUC,GAKlF,OAJAC,EAAOX,OAAQkB,GAEftD,EAAWoC,OAAQW,GAEZ/C,I,6CAGX,SAAiCK,GAC7B,IAAImD,EAQJ,OANA9D,SAAQjC,iBAAiBI,OAAO6E,OAAO,SAAUe,EAAQ5B,GAChDA,EAAKgB,UAAYxC,IAClBmD,EAAU3B,MAIX2B,O,qjBCw1Ef,Q,WAp+EC,WAAa7F,EAAM+F,GAAuE,IAA3DC,IAA2D,yDAAjCC,EAAiC,uDAAN,KAAM,UACzFrE,KAAK5B,KAAOA,EAEZ4B,KAAKmE,WAAkBnE,KAAKsE,cAAeH,GAC3CnE,KAAKqE,yBAA2BA,EAE3BD,GACJpE,KAAKuE,oB,sDAUP,WAAyC,WAAtBC,IAAsB,yDAEpCrC,EAAW,KAGX/D,EAAO4B,KAAK5B,KACV+F,EAAanE,KAAKmE,WAGxB,IAAKM,aAASrG,GAAMsG,sBAAmB,CAEtC,IAAIC,EAAcxE,IAAG,SAAU,CAAE,MAAS,kBAGrC5B,eAAW4F,EAAWxD,mBAC1BgE,EAAY5B,SAAUoB,EAAWxD,kBAIlC,IAsBIiE,EAAgBC,EAihBhBC,EAviBAC,EAAkB,CACrB,KAAyBZ,EAAWa,WACpC,GAAyBb,EAAWc,cAEpC,cAAyBd,EAAWe,OACpC,mBAAyBf,EAAWgB,YACpC,qBAAyBhB,EAAWiB,cACpC,gBAAyBjB,EAAWkB,SAEpC,sBAAyBlB,EAAWmB,eACpC,uBAAyBnB,EAAWoB,gBACpC,gBAAyBpB,EAAWqB,WACpC,iBAAyBrB,EAAWtF,SACpC,eAAyBsF,EAAWZ,OAEpC,oBAAyBY,EAAWsB,QAEpC,iBAAyBtB,EAAWuB,SACpC,sBAAyBvB,EAAWwB,cAOrC,OAASvH,GACR,IAAK,SAEJwG,EAAiBzE,IAAG,SAAU,CAC7B,MAAS,gBAGVH,KAAK4E,eAAiBA,EAGtBC,EAAQ1E,IAAG,YAAaA,WAAU,GAAI4E,EAAiB,CACtD,YAAa,SACb,MAAU,uBACV,6BAA8BZ,EAAWyB,uBAIrCzB,EAAW0B,wBAEfhB,EAAMiB,KAAM,WAAY,YAGzB9F,KAAK6E,MAAQA,EAEb,IAECkB,EACAC,EAHGC,GAAoB,EACvBC,EAAkB,EAKd/B,EAAWgC,kBAMdJ,GALM3G,aAAS+E,EAAW4B,aAAaK,gBAAoBhH,aAAS+E,EAAW4B,aAAaM,aAK7ElC,EAAW4B,aAHX5B,EAAW4B,aAAaK,cAQzC,IAAIE,EAAiBnG,IAAE,6JAyCvB,GA9BAgE,EAAWoC,QAAUpC,EAAWoC,QAAQ3H,QAAO,SAAE4H,GAChD,MAAwB,2BAAjBA,EAAOC,SAGftG,SAAQgE,EAAWoC,SAAS,SAAWE,EAAOC,GAC7C,IAAIC,EAAexG,IAAG,YAAa,CAClC,MAAUuG,EAAYD,MACtB,KAAUC,EAAYE,OAIlBzC,EAAWgC,kBAAmBU,oBAAgBd,EAAcU,KAChEE,EAAab,KAAM,YAAY,GAC/BE,GAAsB,EACtBC,GAAsB,GAIlB9B,EAAW2C,WAAYD,oBAAgB1C,EAAWpD,aAAc2F,EAAYD,SAChFE,EAAab,KAAM,YAAY,GAC/BG,GAAoB,GAGrBU,EAAaI,SAAUT,GACvBJ,OAGDI,EAAeS,SAAUlC,GAGpBV,EAAW0B,uBAAwB,CAEvC,KAAOzG,aAAS+E,EAAWpD,cAC1B,IACC8D,EAAMmC,IAAK7C,EAAWpD,cACrB,MAAQkG,KAMJ7H,aAASyF,EAAMmC,SACrBf,GAAoB,GAKtB,GAAK9B,EAAWgC,kBAAqBH,KAE7B5G,aAAS+E,EAAW4B,aAAaK,iBAAoBhH,aAAS+E,EAAW4B,aAAaM,aAAe,CAE3G,IAAIa,EAAgB/G,IAAG,YAAa,CACnC,MAASgE,EAAW4B,aAAaK,aACjC,KAASjC,EAAW4B,aAAaM,cAG3BlC,EAAW2C,WAAcD,oBAAgB1C,EAAW4B,aAAaK,aAAcjC,EAAWpD,gBAChGmG,EAAcpB,KAAM,YAAY,GAChCG,GAAoB,GAIrBiB,EAAcC,UAAWtC,GACzBqB,IAkBF,GAbK/B,EAAWiD,iBAEfvC,EAAMwC,QAAS,qBAIRlD,EAAWgC,iBAAqBhC,EAAW2C,UACjDjC,EAAMtC,KAAM,mBAAoBuD,KAAM,YAAY,IAM/C3B,EAAWyB,oBAAqB,CACpC,IAAI0B,EAAmBnD,EAAWoD,YAG5BC,EAAgBrH,IAAE,oCAAD,OACFjC,iBAAiBc,KAAKyI,WAAW5C,MAAM6C,OAAOC,aAD5C,sEAEqBzJ,iBAAiBc,KAAKyI,WAAW5C,MAAM6C,OAAOH,YAFnE,uDAOvB1C,EAAMhC,OAAQ2E,GAGTrD,EAAW2C,WAAYD,oBAAgB1C,EAAWpD,aAAc,4BAEpEyG,EAAcjF,KAAM,UAAWqF,KAAM,YAAY,GACjD3B,GAAoB,GAIhB9B,EAAW2C,WAAcb,IAE7BuB,EAAcjF,KAAM,UAAWqF,KAAM,YAAY,GACjD3B,GAAoB,EAGpBqB,EAAmBnD,EAAWpD,cAI/Bf,KAAK6H,iBAAmB,IAAI1G,EAAO,OAAQ,CAC1CoC,OAAQY,EAAWZ,OACnB1E,SAAUsF,EAAWtF,SAErB2G,WAAYrB,EAAWqB,WACvBsC,YAAY,EACZvC,iBAAiB,EACjBwC,yBAAyB,EACzBzC,eAAgBnB,EAAWmB,eAE3BJ,QAAQ,EAER8C,UAAW,OACXhD,WAAY,GAAF,OAAMb,EAAWa,WAAjB,WAEVjF,MAAO,GACPkI,YAAa9D,EAAW+D,0BAA4B/D,EAAWgE,4BAAyBC,EACxFC,YAAa,GACb3C,UAAU,EACV4C,WAAWC,cAAUrK,iBAAiBc,KAAKyI,WAAW5C,MAAM6C,OAAOc,iBAAkB,CAAErE,EAAWpE,QAElGgG,aAAc,KACdhF,aAAcuG,EAEd3B,cAAc,EACd8C,iBAAkBtE,EAAWa,aAQ/B,GAHAhF,KAAK0I,wBAA0BzC,EAGP,GAAnBC,EAAsB,CAC1B,IAAIyC,EAAaxI,IAAK,IAAIyI,OAAQ1K,iBAAiBc,KAAK6J,UAAW,IAAI,GAAM,IAE7EF,EAAW7C,KAAM,YAAY,GAE7B9F,KAAK6E,MAAMtC,KAAM,wCAAyCM,OAAQ8F,GAE3D3I,KAAKmE,WAAWyB,qBAEtB5F,KAAK6E,MAAMiB,KAAM,YAAY,GAK/BjB,EAAMvD,GAAI,UAAU,SAAUwH,EAAOC,GACpCpE,EAAYlC,QAAS,yBAA0BsG,MAGhD,MAED,IAAK,OACL,IAAK,MACL,IAAK,QACL,IAAK,MACL,IAAK,QACL,IAAK,OACL,IAAK,OAIJ,IAAIC,EAAsB,0BAAH,OAA8B5K,GAGrDwG,EAAiBzE,IAAG,SAAU,CAC7B,MAAS6I,IAIV,IAAMC,EAAuB9I,IAAG,SAAU,CACzC,MAAS,2BA6CV,GA1CAH,KAAKiJ,qBAAuBA,EAE5BrE,EAAe/B,OAAQoG,GAEvBjJ,KAAK4E,eAAiBA,EAGtBC,EAAQ1E,IAAG,WAAYA,WAAU,GAAI4E,EAAiB,CACrD,MAAa,sBACb,KAAa,OACb,YAAa3G,MAITG,eAAW4F,EAAW+E,YAC1BrE,EAAMiB,KAAM,YAAa3B,EAAW+E,WAGrClJ,KAAK6E,MAAQA,EAGRV,EAAWmB,gBACfV,EAAe7B,SAAU,qBAIrBoB,EAAWiD,gBACfvC,EAAMiB,KAAM,cAAe3B,EAAWkE,aAIlClE,EAAW2C,SACfjC,EAAMiB,KAAM,QAAS3B,EAAWpD,cAI3BoD,EAAWgC,iBACftB,EAAMiB,KAAM,QAAS3B,EAAW4B,cAK7B,CAAE,OAAQ,QAASoD,SAAUhF,EAAW6D,WAAa,CAEzD,IAAMoB,EAAejJ,IAAE,yEAAD,OACmCjC,iBAAiBc,KAAKqK,MADzD,6GAOtBzE,EACE7B,SAAU,yBAGZ/C,KAAKiJ,qBACHpG,OAAQuG,GAGVA,EAAa9H,GAAI,SAAS,WACzB,EAAKgI,gBAKPzE,EAAMvD,GAAI,SAAS,WAClBqD,EAAYlC,QAAS,6BAGtB,MAED,IAAK,WAEJmC,EAAiBzE,IAAG,SAAU,CAAC,MAAS,kBAExCH,KAAK4E,eAAiBA,EAGtBC,EAAQ1E,IAAG,cAAeA,YAAU,EAAM4E,EAAiB,CAC1D,YAAe,OACf,MAAY,yBACZ,iBAAmBZ,EAAWtF,aAI1BN,eAAW4F,EAAW+E,YAC1BrE,EAAMiB,KAAM,YAAa3B,EAAW+E,WAGrClJ,KAAK6E,MAAQA,EAGRV,EAAWmB,gBACfV,EAAe7B,SAAU,wBAIrBoB,EAAWiD,gBACfvC,EAAMiB,KAAM,cAAe3B,EAAWkE,aAIlClE,EAAW2C,SACfjC,EAAM+B,KAAMzC,EAAWpD,cAIlBoD,EAAWgC,iBACftB,EAAM+B,KAAMzC,EAAW4B,cAKzBlB,EAAMvD,GAAI,SAAS,WAClBqD,EAAYlC,QAAS,6BAGtB,MAED,IAAK,WAEJmC,EAAiBzE,IAAG,SAAU,CAAC,MAAS,kBAExCH,KAAK4E,eAAiBA,EAEtB,IAAI2E,EAAgBpJ,IAAG,WAAY,CAAC,MAAS,6BACzCqJ,EAAiBrJ,IAAG,SAAU,CAAC,MAAS,mBA2B5C,GAxBA0E,EAAQ1E,IAAG,WAAYA,WAAU,GAAI4E,EAAiB,CACrD,KAAa,WACb,YAAa,WACb,MAAU,wCAINZ,EAAW2C,UAAY3C,EAAWpD,cACtC8D,EAAMiB,KAAM,WAAW,GAGxB9F,KAAK6E,MAAQA,EAGRV,EAAWsF,UACfF,EAAcG,KAAMvF,EAAWpE,OAIhC6E,EAAe/B,OAAQ0G,GACvBA,EAAc1G,OAAQgC,GACtB0E,EAAc1G,OAAQ2G,IAGjBjL,eAAW4F,EAAWwF,WAAcxF,EAAWwF,WACnD/E,EAAe7B,SAAU,0BAGpBxE,eAAW4F,EAAWyF,SAAU,CAEpC,IAAKrL,eAAW4F,EAAWyF,OAAOtI,IAAM,CACvC,IAAIuI,EAAmB1J,IAAG,UAAW,CAAE,MAAS,sCAAuCyG,KAAMzC,EAAWyF,OAAOtI,IAC/GiI,EAAc1G,OAAQgH,GAIvB,IAAKtL,eAAW4F,EAAWyF,OAAOE,KAAO,CACxC,IAAIC,EAAoB5J,IAAG,UAAW,CAAE,MAAS,uCAAwCyG,KAAMzC,EAAWyF,OAAOE,KACjHP,EAAc1G,OAAQkH,IAMzB,IAAKxL,eAAW4F,EAAW6F,OAE1B,IAAKvF,aAASN,EAAW6F,MAAO,CAAE,YAAa,UAE9C,OAAS7F,EAAW6F,OACnB,IAAK,YACJpF,EAAe7B,SAAU,mCACzB,MAED,IAAK,QACJ6B,EAAe7B,SAAU,oCAK3B/E,QAAQiM,OAAO1B,cAAU,oEAAqE,CAAEpE,EAAW6F,UAKxGzL,eAAW4F,EAAW+F,UAErBzF,aAASN,EAAW+F,MAAO,CAAE,OAAQ,UAEhB,SAApB/F,EAAW+F,OAEftF,EAAe7B,SAAU,+BAI1B/E,QAAQiM,OAAO1B,cAAU,6DAA8D,CAAEpE,EAAW+F,MAAO,aAK7GrF,EAAMvD,GAAI,UAAU,SAAUwH,EAAOC,GACpCpE,EAAYlC,QAAS,yBAA0BsG,MAIhDlE,EAAQ0E,EAER,MAED,IAAK,QAEJ3E,EAAiBzE,IAAG,SAAU,CAAC,MAAS,eACxCH,KAAK4E,eAAiBA,EAGtB,IAAIuF,EAAUhK,MACbiK,EAAmBjK,MAGpBA,SAAQgE,EAAWoC,SAAS,SAAU8D,EAAO7D,GAE5C,IAAM8D,EAAsBnK,IAAG,WAAY,CAAE,MAAS,0BAGtDmK,EAAoBZ,KAAMlD,EAAOI,MAGjC,IAAM2D,EAASpK,IAAG,WAAYA,WAAU,GAAI4E,EAAiB,CAC5D,KAAa,QACb,YAAa,QACb,MAAU,+BAEV,MAAcyB,EAAOC,MACrB,KAAc1B,EAAgB9D,MAI/BkJ,EAAUA,EAAQK,IAAKD,GAGvB,IAAME,EAAatK,IAAG,SAAU,CAAE,MAAS,gBAG3CmK,EAAoBzH,OAAQ0H,GAC5BD,EAAoBzH,OAAQ4H,IAIvBtG,EAAW2C,UAAY3C,EAAWpD,cAAgByF,EAAOC,QAIlDtC,EAAW2C,UAAY3C,EAAWgC,iBAAmBhC,EAAW4B,cAAgBS,EAAOC,QAHlG8D,EAAOzE,KAAM,WAAW,GAQzBsE,EAAmBA,EAAiBI,IAAKF,MAI1CtK,KAAK6E,MAAQuF,EACbvF,EAAQuF,EAGRD,EAAQ7I,GAAI,UAAU,SAAEwH,EAAOC,GAE9BpE,EAAYlC,QAAS,yBAA0BsG,MA2BlD,GApBAnE,EAAe/B,OAAQgC,GAOV,YAARzG,IAAwB+F,EAAWsF,UAAYtF,EAAWqB,cAC9DV,EAAa3E,IAAG,WAAY,CAC3B,MAAS,sBACT,IAASgE,EAAWc,gBAIhBd,EAAWsF,UACf3E,EAAW4E,KAAMvF,EAAWpE,QAKzBoE,EAAWqB,WAKf,GAHAZ,EAAe7B,SAAU,0BAGI,YAAxBoB,EAAW6D,WAKf,GAHAnD,EAAMtC,KAAM,SAAUuD,KAAM,YAAY,GAGnC3B,EAAWsF,SAAU,CAEzB,IAAIiB,EAAqBvK,IAAG,UAAW,CAAE,MAAS,iCAClD0E,EAAMhC,OAAQ6H,SAQf,GAHA7F,EAAMiB,KAAM,YAAY,GAGnB3B,EAAWsF,SAAU,CAEzB,IAAIiB,EAAqBvK,IAAG,UAAW,CAAE,MAAS,iCAClD2E,EAAWjC,OAAQ6H,IAMjBnM,eAAW4F,EAAW2D,aAAgB3D,EAAW2D,aAExB,UAAxB3D,EAAW6D,UAEfnD,EAAMiB,KAAM,YAAY,GAEf,CAAE,WAAY,SAAUqD,SAAUhF,EAAW6D,WAEtDnD,EAAMtC,KAAM,SAAUuD,KAAM,YAAY,GAIxCjB,EAAMiB,KAAM,YAAY,KAKrB3B,EAAWsF,UAAYtF,EAAWqB,aACtCZ,EAAeyC,QAASvC,GAIzB,IAAI6F,EAAaxK,IAAG,SAAU,CAAE,MAAS,wBAMzC,GALAyE,EAAe/B,OAAQ8H,GAEvB3K,KAAK4E,eAAiBA,EAGjBT,EAAWyG,eAAgB,CAC/B,IAAIC,EAAmB1K,IAAG,SAAU,CAAE,MAAS,gBAC/C0K,EAAiBnB,KAAMvF,EAAW8D,aAClCrD,EAAe/B,OAAQgI,GAInB1G,EAAWuB,UAEfd,EAAe7B,SAAU,wBAI1B4B,EAAY9B,OAAQ+B,GAIS,UAAxBT,EAAW6D,YAAyBzJ,eAAWyB,KAAK6H,oBAExD7H,KAAK8K,0BAA4B3K,IAAE,6GAOnCH,KAAK8K,0BAA0BvI,KAAM,0BAA2BM,OAAQ7C,KAAK6H,iBAAiBtD,qBAG9FI,EAAY9B,OAAQ7C,KAAK8K,2BAGD,0BAAnB9K,KAAKwB,WACTxB,KAAK8K,0BAA0B/H,SAAU,+BAGzC/C,KAAK8K,0BAA0BC,YAAa,gCAK9C5I,EAAWwC,EAGX3E,KAAK2E,YAAcA,EAGdH,GACJxE,KAAKwE,gBAINxE,KAAKgL,WAGLhL,KAAKiL,eAILjN,QAAQiM,OAAO1B,cAAU,wDAAyD,CAAEnK,GAAMsG,qBAAgBwG,KAAM,SAGjH,OAAO/I,I,2BAaR,SAAegC,GAoGd,GAlGAA,EAAW6D,UAAYhI,KAAK5B,KAG5B+F,EAAWc,cAAX,UAA+Bd,EAAWa,WAA1C,cAA2DmG,oBAG9B,YAAxBhH,EAAW6D,YAA6B5I,aAAS+E,EAAWpD,eAE3D,CAAE,OAAQ,SAAUoI,SAAUhF,EAAWpD,gBAE7CoD,EAAWpD,aAA0C,QAA3BoD,EAAWpD,aAG9BoD,EAAWpD,aAIjBoD,EAAW2C,UAAW,EAHtB3C,EAAW2C,UAAW,IASlBvI,eAAW4F,EAAW2C,aACrB1H,aAAS+E,EAAWpD,cAI1BoD,EAAW2C,UAAW,EAHtB3C,EAAW2C,UAAW,IAQjBvI,eAAW4F,EAAWiD,mBACrBhI,aAAS+E,EAAWkE,aAI1BlE,EAAWiD,gBAAiB,EAH5BjD,EAAWiD,gBAAiB,IAQvB7I,eAAW4F,EAAWgC,oBACrB/G,aAAS+E,EAAW4B,cAI1B5B,EAAWgC,iBAAkB,EAH7BhC,EAAWgC,iBAAkB,IAQxB5H,eAAW4F,EAAWsF,aACrBrK,aAAS+E,EAAWpE,OAI1BoE,EAAWsF,UAAW,EAHtBtF,EAAWsF,UAAW,IAQjBlL,eAAW4F,EAAWyG,mBACrBxL,aAAS+E,EAAW8D,aAI1B9D,EAAWyG,gBAAiB,EAH5BzG,EAAWyG,gBAAiB,IAQvBrM,eAAW4F,EAAWqB,cAC5BrB,EAAWqB,YAAa,IAIlBjH,eAAW4F,EAAWwB,gBAC5BxB,EAAWwB,cAAe,IAIpBpH,eAAW4F,EAAWmB,kBAC5BnB,EAAWmB,gBAAiB,GAIxBnB,EAAWmB,gBAA0C,UAAxBnB,EAAW6D,YAA2B,CAAE,SAAU,WAAYmB,SAAUhF,EAAWtF,YACpHsF,EAAWmB,gBAAiB,IAItB/G,eAAW4F,EAAW2D,cAC5B3D,EAAW2D,YAAa,GAII,UAAxB3D,EAAW6D,UAAuB,CAgBtC,IAdOzJ,eAAW4F,EAAW0B,0BAC5B1B,EAAW0B,wBAAyB,GAKhC1B,EAAW0B,yBACf1B,EAAWyB,qBAAsB,GAO7BzB,EAAW0B,uBACf,IACC1B,EAAWpD,aAAeqK,KAAKC,MAAOlH,EAAWpD,cAChD,MAAQkG,KAMJ1I,eAAW4F,EAAWyB,uBAC5BzB,EAAWyB,qBAAsB,GASlCzB,EAAW+D,4BAA8B9I,aAAS+E,EAAWgE,wBA8E9D,MA1E6B,QAAxBhE,EAAW6D,YACf7D,EAAW2D,YAAa,GAGjBvJ,eAAW4F,EAAWmH,cAC5BnH,EAAWmH,WAAa,UAIlB/M,eAAW4F,EAAWoH,iBAC5BpH,EAAWoH,cAAgBrN,iBAAiBsN,OAAOC,OAI/ClN,eAAW4F,EAAWuH,WAC1BvH,EAAWuH,QAAUvH,EAAWuH,UAI5BnN,eAAW4F,EAAWwH,WAC1BxH,EAAWwH,QAAUxH,EAAWwH,UAI1BpN,eAAW4F,EAAWyH,iBAC5BzH,EAAWyH,eAAgB,IAKA,QAAxBzH,EAAW6D,YACf7D,EAAW2D,YAAa,GAGjBvJ,eAAW4F,EAAW0H,cAC5B1H,EAAW0H,WAAa,UAIlBtN,eAAW4F,EAAW2H,iBAC5B3H,EAAW2H,cAAgB,UAIvBvN,eAAW4F,EAAW4H,WAC1B5H,EAAW4H,QAAU5H,EAAW4H,UAI5BxN,eAAW4F,EAAW6H,WAC1B7H,EAAW6H,QAAU7H,EAAW6H,WAK3BzN,eAAW4F,EAAWoB,mBAC5BpB,EAAWoB,iBAAkB,KAIvBhH,eAAW4F,EAAWwF,YAAcpL,eAAW4F,EAAWyF,UAChEzF,EAAWwF,UAAW,IAIhBpL,eAAW4F,EAAWe,UAC5Bf,EAAWe,QAAS,IAId3G,eAAW4F,EAAWuB,YAC5BvB,EAAWuB,UAAW,GAGhBvB,I,sBAaR,WAA8B,IAK5BsC,EALQwF,IAAoB,yDAIzBpH,EAAQ,KAGPoH,GACJpH,EAAQ7E,KAAKkM,oBACbzF,EAAQzG,KAAKwB,YAGbiF,EAAQzG,KAAKmE,WAAWpD,aAITf,KAAK5B,KAArB,IAGI+F,EAAa,CAChBmB,eAAgBtF,KAAKmE,WAAWmB,eAChC6G,SAAgBnM,KAAKmE,WAAWqB,YAIjC,OAAO4G,mBAAevH,EAAO7E,KAAK5B,KAAMqI,EAAOtC,EAAYnE,KAAKqE,4B,sBASjE,WAAU,WACTrE,KAAK2E,YAAYrD,GAAI,0BAA0B,SAAEwH,EAAOC,GAKrB,UAA7B,EAAK5E,WAAW6D,WAAyB,EAAK7D,WAAWyB,sBACrC,0BAAnB,EAAKpE,WAET,EAAKsJ,0BAA0B/H,SAAU,+BAIzC,EAAK+H,0BAA0BC,YAAa,gCAI9C,IAAMsB,EAAuB,WAa5B,GAXK,EAAKlI,WAAWe,QAEf,EAAKf,WAAWgB,cAAgB,EAAKhB,WAAWa,YAIpD,EAAKsH,UAKF/N,eAAW,EAAK4F,WAAWwB,eAAkB,EAAKxB,WAAWwB,eAE5DpH,eAAW,EAAK4F,WAAWsE,kBAAoB,CAEnD,IAAM8D,GAAcC,cAAU,EAAKrI,WAAWZ,OAAQ,EAAKY,WAAWsE,mBAGjElK,eAAWgO,IAKfA,EAAYD,WAQhB,GAEC,EAAKnI,WAAWe,SAEb3G,eAAW,EAAK4F,WAAWgB,cAG3B,EAAKhB,WAAWgB,cAAgB,EAAKhB,WAAWa,aAGlD,EAAKb,WAAWsI,qBAKfrN,aAAS,EAAK+E,WAAWpD,gBACpB,EAAKoD,WAAWgC,kBAChB,EAAKhC,WAAWsI,oBAGvB,CAEA,IAAItH,GAAcqH,cAAU,EAAKrI,WAAWZ,OAAQ,EAAKY,WAAWgB,aAKpEA,EAAYxC,SAAU,MAAM,GAC5BwC,EAAYuH,eAAgB,MAAM,GAqBnC,MAjBK,CAAE,SAAU,QAAS,YAAavD,SAAU,EAAKhF,WAAW6D,WAEhEqE,MAIK9N,eAAW,EAAKoO,kBACpBC,aAAc,EAAKD,iBAIpB,EAAKA,gBAAkBE,YAAW,WACjCR,MACE,QAIG,O,qBAUT,WAAS,WACRrM,KAAK6E,MAAMvD,GAAI,WAAW,SAAEwH,GAEtB,EAAK3E,WAAW2D,YAEpB3H,IAAG2I,EAAMgE,eAAgBpF,YAI3B1H,KAAK6E,MAAMvD,GAAI,YAAY,iB,qBAS5B,WACC,IAAIyL,GAAQ,EAMZ,OAJKxO,eAAWL,iBAAiBI,OAAO6E,MAAOnD,KAAKmE,WAAWZ,WAC9DwJ,GAAQ,GAGFA,I,oBASR,WAAQ,WAKP,IAHiBxO,eAAWyB,KAAKwB,YAAexB,KAAKwB,WAAaxB,KAAKgN,eAGlEhN,KAAKmE,WAAWe,OAAQ,CAE5B,IAAIC,EAAcnF,KAOlB,GALKA,KAAKmE,WAAWa,YAAchF,KAAKmE,WAAWgB,cAClDA,GAAcqH,cAAUxM,KAAKmE,WAAWZ,OAAQvD,KAAKmE,WAAWgB,gBAI1D/F,aAASY,KAAKmE,WAAW8I,kBAAqB7N,aAASY,KAAKmE,WAAW+I,UAAY,CAEzFlN,KAAKyB,wBAEL0D,EAAY1D,wBAGZ,IAAI0L,EAAmBnN,KAAKwB,WACtB4L,GAAmB7O,eAAW4G,EAAY3D,YAAe2D,EAAY3D,WAAa2D,EAAY6H,gBAEpGK,iBAAarN,KAAKmE,WAAW+I,SAAU,CACtCI,UAAgBpP,iBAAiBI,OAAO2C,GACxCsM,eAAgBvN,KAAKmE,WAAW8I,cAChCO,QAAcxN,KAAKmE,WAAWZ,OAC9BkK,SAAezN,KAAKmE,WAAWsB,QAC/BiI,SAAe1N,KAAKmE,WAAWa,WAC/B2I,aAAgB3N,KAAKmE,WAAWgB,YAChCsB,MAAa0G,EACbS,QAAUC,4BAAwB7N,KAAKmE,WAAWZ,UAChD,SAAEpB,GAsBJ,GAjBA,EAAKO,uBACLyC,EAAYzC,uBAgB4B,UAdZyC,EAAY2I,gBAcb9F,WAAyB7H,YAAWgC,GAAY,CAkC1E,GA7BC,EAAKgC,WAAWe,SAEb3G,eAAW,EAAK4F,WAAWgB,cAG3B,EAAKhB,WAAWgB,cAAgB,EAAKhB,WAAWa,aAGlD,EAAKb,WAAWsI,qBAKfrN,aAAS,EAAK+E,WAAWpD,gBACpB,EAAKoD,WAAWgC,kBAChB,EAAKhC,WAAWsI,sBAIvBW,EAAmB,MAUK,0BAApBA,EAA8C,CAElD,IAAM9F,EAAmBnC,EAAY4I,uBASpCX,GANMhO,aAASkI,GAMI,KAJAA,EAcrBnC,EAAY6I,iBAAkB7L,GAAU,GAMxCgD,EAAYxC,SAAUyK,QAItBjI,EAAYxC,SAAUR,GAIvB,EAAKgC,WAAWsI,oBAAqB,S,4BAczC,WAAgB,WACf,GAAKzM,KAAKiO,UAAW,CAEpBjO,KAAKmE,WAAWsI,oBAAqB,EAMrC,IAAIyB,GAAkB,EAEtB,IAKCA,EAHehQ,iBAAiBI,OAAO6E,MAAOnD,KAAKmE,WAAWZ,QAASgD,QAASvG,KAAKmE,WAAWsB,SAAU0I,OAGnFC,QAAQ,SAAEC,EAAaxJ,GAC7C,OAAOwJ,GAEJxJ,EAAMV,WAAWgB,aAAe,EAAKhB,WAAWa,YAE5CH,EAAMV,WAAWa,YAAc,EAAKb,WAAWa,YAElDH,EAAMV,WAAWe,UAEnB,GAEJ,MAAQ+B,IAKDiH,IAMLlO,KAAKmE,WAAWgB,aAAenF,KAAKmE,WAAWa,YAC5ChF,KAAKmE,WAAWe,QAEnBlF,KAAKsM,SAGNtM,KAAK6E,MAAMpC,QAAS,yBAA0B,CAC7C6L,aAAa,KAKhB,OAAOtO,KAAK2E,c,+BAWb,WACC,OAAO3E,KAAK4E,iB,wBAWb,WACC,OAAO5E,KAAKmE,WAAWa,a,sBAWxB,WACC,OAAOhF,KAAK6E,Q,wBAGb,WACC,OAAO7E,KAAKiJ,uB,2BAWb,WACC,OAAOjJ,KAAKmE,a,sBAYb,WACC,IAAIhC,EAAW,KAEf,IAAK5D,eAAWyB,KAAK6E,OACpB,OAAS7E,KAAK5B,MACb,IAAK,SACL,IAAK,OACL,IAAK,MACL,IAAK,QACL,IAAK,MACL,IAAK,QACJ+D,EAAWnC,KAAK6E,MAAMmC,MACtB,MAED,IAAK,WAEJ,IAAKzI,eAAWyB,KAAKuO,eACpB,IACCvO,KAAKuO,cAAcC,iCAClB,MAAQvH,GACTjJ,QAAQC,IAAKgJ,GAIf9E,EAAWnC,KAAK6E,MAAMmC,MACtB,MAED,IAAK,WACJ7E,EAAWnC,KAAK6E,MAAM4J,GAAI,YAC1B,MAED,IAAK,QACJtM,EAAWnC,KAAK6E,MAAMtC,KAAM,iBAAkByE,MAC9C,MAED,IAAK,OAIL,IAAK,OACJ7E,EAAWnC,KAAK6E,MAAMmC,MAwBzB,OAlBGzI,eAAWyB,KAAK6E,SACbtG,eAAW4D,KAGXnC,KAAKmE,WAAW2C,SAEpB3E,EAAWnC,KAAKmE,WAAWpD,aAKtBf,KAAKmE,WAAWgC,kBAEpBhE,EAAWnC,KAAKmE,WAAW4B,eAKvB5D,I,8BAWR,WAAkB,WACbA,EAAW,KACdsE,EAAUzG,KAAKwB,WAEhB,OAASxB,KAAK5B,MACb,IAAK,SAEJ,IAAKG,eAAWyB,KAAK6E,OAKnB1C,EAHInC,KAAKmE,WAAW0B,wBAA0B1F,YAAWsG,GAG9CA,EAAMiI,KAAI,SAAEC,GACtB,OAAO,EAAK9J,MAAMtC,MAAMgG,cAAU,qBAAsB,CAAEoG,KAAkB/H,UAC1EsE,KAFQ,UAEEhN,iBAAiBc,KAAK4P,cAFxB,MAKA5O,KAAK6E,MAAMtC,MAAMgG,cAAU,qBAAsB,CAAE9B,KAAYG,YAK3E,GAAK5G,KAAKmE,WAAW0B,wBAA0B1F,YAAWsG,GACzD,IAGCtE,EAAWsE,EAAMiI,KAAI,SAAEC,GACtB,OAAO,EAAKE,uBAAwBF,GAAc/H,QAChDsE,KAFQ,UAEEhN,iBAAiBc,KAAK4P,cAFxB,MAIZ,MAAQ3H,SAKR,IAEC9E,EAAWnC,KAAK6O,uBAAwBpI,GAAQG,KAEjD,MAAQK,IAKV,MAED,IAAK,OACL,IAAK,MACL,IAAK,QACL,IAAK,MACL,IAAK,QACL,IAAK,WAEJR,EAAQtG,IAAG,QAASuJ,KAAMjD,GAAQG,OAClC,MAED,IAAK,WAEHzE,EADIsE,EACOvI,iBAAiBc,KAAK8P,UAGtB5Q,iBAAiBc,KAAK+P,WAElC,MAED,IAAK,QAEJ,IAAKxQ,eAAWyB,KAAK6E,OAAS,CAE7B,IAAMmK,EAAgBhP,KAAK6E,MAAMtC,KAAM,iBAGV,GAAxByM,EAAcC,SAKlB9M,EAHwB6M,EAAcE,QAAS,0BAGpBtI,OAAOuI,aAInC,IAEChN,EAAWnC,KAAK6O,uBAAwBpI,GAAQG,KAEjD,MAAQK,IAIT,MAED,IAAK,OAKL,IAAK,OAEJR,EAAQtG,IAAG,QAASuJ,KAAMjD,GAAQG,OAIpC,OAAOzE,I,kCAUR,WAEC,IAAIiN,EAAa,KAGjB,GAAkC,UAA7BpP,KAAKmE,WAAW6D,WAAyBhI,KAAKmE,WAAWyB,qBAA0C,0BAAnB5F,KAAKwB,WAEzF,IAAKjD,eAAWyB,KAAK6H,kBACpBuH,EAAapP,KAAK6H,iBAAiBrG,gBAInC,IACC4N,EAAalR,iBAAiBI,OAAO6E,MAAOnD,KAAKmE,WAAWZ,QAAS8L,KAAxD,UAAkErP,KAAKmE,WAAWa,WAAlF,YAEd,MAAQiC,IAMV,OAAOmI,I,oCAUR,WAAoC,IAAZ3I,EAAY,uDAAJ,GAC3BD,EAAS,KAGTD,EAAUvG,KAAKmE,WAAWoC,QAqB9B,OAlBKvG,KAAKmE,WAAWyB,qBACpBW,EAAQ+I,KAAK,CACZ7I,MAAO,yBACPG,KAAO1I,iBAAiBc,KAAKyI,WAAW5C,MAAM6C,OAAOH,eAKhDnI,aAASmH,IAEfA,EAAQgJ,SAAQ,SAAE5I,GAEZF,GAASE,EAAaF,QAC1BD,EAASG,MAKLH,I,0BAWR,WACC,IAAIrE,EAGJ,IAAK5D,eAAWL,iBAAiBI,OAAO6E,MAAOnD,KAAKmE,WAAWZ,SAAY,CAC1E,IAAIiM,EAAYtR,iBAAiBI,OAAO6E,MAAOnD,KAAKmE,WAAWZ,QAAS8L,KAAMrP,KAAKmE,WAAWa,aAEzFzG,eAAWiR,KACfrN,EAAWqN,GAIb,OAAOrN,I,sBAWR,SAAUsE,GAAyB,WAAlBgJ,IAAkB,yDAIlC,IAAKlR,eAAWyB,KAAK6E,OACpB,OAAS7E,KAAK5B,MACb,IAAK,UAEGG,eAAWkI,KAEhBA,EADIzG,KAAKmE,WAAW0B,uBACZ,GAGA,IAKV,IAAI6J,EAAa1P,KAAK6E,MAAMtC,KAAM,UAElC,GAAKvC,KAAKmE,WAAW0B,uBAEpB6J,EAAW5J,KAAM,YAAY,GAGxB3F,YAAWsG,MAAarH,aAASqH,KAErCA,EAAM8I,SAAQ,SAAEI,GAEf,IAAInJ,EAAS,EAAK3B,MAAMtC,KAAM,iBAAmBoN,EAAW,MAGvDnJ,EAAOyI,OAAS,GAEpBzI,EAAOV,KAAM,YAAY,MAKtB2J,GACJzP,KAAK6E,MAAMpC,QAAS,SAAU,CAC7B6L,aAAa,SAKZ,CAEJ,IAAI9H,EAASxG,KAAK6E,MAAMtC,KAAM,iBAAmBkE,EAAQ,MAGpDD,EAAOyI,OAAS,GAEpBS,EAAW5J,KAAM,YAAY,GAG7BU,EAAOV,KAAM,YAAY,GAGpB2J,GACJzP,KAAK6E,MAAMpC,QAAS,SAAU,CAC7B6L,aAAa,MAMfoB,EAAW5J,KAAM,YAAY,GAI5B9F,KAAKmE,WAAWyB,uBACXxG,aAASqH,IAGdzG,KAAK0M,eAAgBjG,GAAO,GAIxBgJ,GACJzP,KAAK6E,MAAMpC,QAAS,SAAU,CAC7B6L,aAAa,KAQjB,MAED,IAAK,OACL,IAAK,MACL,IAAK,QACL,IAAK,MACL,IAAK,QAEJtO,KAAK6E,MAAMmC,IAAKP,GAGXgJ,GACJzP,KAAK6E,MAAMpC,QAAS,0BAErB,MAED,IAAK,WAEEzC,KAAK6E,MAAMmC,IAAKP,IAGXlI,eAAWyB,KAAK4P,eACpB5P,KAAK4P,aAAaC,WAAYpJ,GAmBhCgJ,GACJzP,KAAK6E,MAAMpC,QAAS,0BAErB,MAED,IAAK,WACJ,IAAIqN,EAAerJ,EAClBlF,EAAYvB,KAAKwB,WAGbsO,IAAkBvO,GACtBvB,KAAK6E,MAAMiB,KAAM,WAAW,IAGtBgK,GAAgBvO,GACtBvB,KAAK6E,MAAMiB,KAAM,WAAW,GAGxB2J,IAAiBK,IAAkBvO,IAAmBuO,GAAgBvO,IAE1EvB,KAAK6E,MAAMpC,QAAS,0BAGrB,MAED,IAAK,QAEJzC,KAAK6E,MAAMjG,OAAX,iBAA8B6H,EAA9B,OAA2CX,KAAM,WAAW,GAGvD2J,GAEJzP,KAAK6E,MAAMpC,QAAS,0BAGrB,MAED,IAAK,OAUL,IAAK,OAEJzC,KAAK6E,MAAMmC,IAAKP,GAGXgJ,GACJzP,KAAK6E,MAAMpC,QAAS,6B,wBAazB,WAECzC,KAAK2C,SAAU,IAAI,GAGnB,IACC3C,KAAK+P,QAAQpN,SAAU,IACtB,MAAQsE,IAGV,GAAK,CAAE,OAAQ,QAASkC,SAAUnJ,KAAKmE,WAAW6D,WAEjD,IACChI,KAAKgQ,kBAAkB3G,QACtB,MAAQpC,O,4BAUZ,SAAgBR,GAAyB,IAAlBgJ,IAAkB,yDAOV,UAA7BzP,KAAKmE,WAAW6D,YACbzJ,eAAWyB,KAAK6H,oBAGnB7H,KAAK6E,MAAMmC,IAAK,0BAGhBhH,KAAK6H,iBAAiBlF,SAAU8D,EAAOgJ,GAGlCA,GACJzP,KAAK6E,MAAMpC,QAAS,SAAU,CAC7B6L,aAAa,O,+BAYjB,WACC,OAAOtO,KAAK0I,0B,8BAWb,SAAkBnC,GAA+B,IAAtB0J,IAAsB,yDAEhDjQ,KAAKkQ,sBAGL,IACC3J,EAAUA,EAAQ3H,QAAO,SAAE4H,GAC1B,OAAOjI,eAAWiI,EAAOC,SAAWlI,eAAWiI,EAAOI,SAEtD,MAAQK,IAEV,IAAK1I,eAAWyB,KAAK6E,OAAS,CAE7B,IAAMsL,EAAoBnQ,KAAK6E,MAAMtC,KAAM,wCAE3C,GAAKgE,EAAQ0I,OAAS,EAAG,CAExBjP,KAAK6E,MAAMiB,KAAM,YAAY,GAG7B,IAAIW,GAAQlI,eAAWyB,KAAKwB,YAAexB,KAAKwB,WAAaxB,KAAKgN,eAG9DoD,EAAa,GAGjBjQ,SAAQoG,GAAS,SAAE8D,EAAO7D,GACzB,IAAI6J,EAAY,IAAIzH,OAAQpC,EAAOI,KAAMJ,EAAOC,OAAO,GAAO,GAE9D0J,EAAkBtN,OAAQwN,GAC1BD,EAAWd,KAAMe,OAGXjR,aAASqH,IACftG,SAAQH,KAAK6E,MAAMtC,KAAM,WAAY,SAAE8H,EAAO7D,GACxCA,EAAOC,OAASA,GACpBtG,IAAGqG,GAASV,KAAM,YAAY,UAK7B,CACJ,IAAI6C,EAAaxI,IAAK,IAAIyI,OAAQ1K,iBAAiBc,KAAK6J,UAAW,IAAM7I,KAAKmE,WAAWyB,qBAAuB5F,KAAKmE,WAAWyB,sBAChI+C,EAAW7C,KAAM,YAAY,GAE7BqK,EAAkBtN,OAAQ8F,GAEnB3I,KAAKmE,WAAWyB,qBAEtB5F,KAAK6E,MAAMiB,KAAM,YAAY,GAI1BmK,GACJjQ,KAAK6E,MAAMpC,QAAS,UAKrBzC,KAAKsQ,qB,iCAUP,YACM/R,eAAWyB,KAAK6E,QACpB7E,KAAK6E,MAAMtC,KAAM,wCAAyClE,U,uBAY5D,WACC,OAAO2B,KAAK2E,YAAY4L,SAAU,2B,mCASnC,WAEC,IAAIC,EAAW,yBAEVjS,eAAWyB,KAAK2E,eAAmB3E,KAAK2E,YAAY4L,SAAUC,KAGlExQ,KAAK2E,YAAY5B,SAAUyN,GAGT,YAAbxQ,KAAK5B,OAAwBG,eAAWyB,KAAKmE,WAAWwF,WAC5D3J,KAAK4E,eAAe7B,SAAU,iCAI/B/C,KAAK2E,YAAYlC,QAAS,8B,kCAU5B,WAEC,IAAI+N,EAAW,yBAEVjS,eAAWyB,KAAK2E,cAAiB3E,KAAK2E,YAAY4L,SAAUC,KAGhExQ,KAAK2E,YAAYoG,YAAayF,GAG9BxQ,KAAK4E,eAAemG,YAAa,iCAGjC/K,KAAK2E,YAAYlC,QAAS,8B,2BAU5B,WACC,OAASzC,KAAK5B,MACb,IAAK,SAEJ4B,KAAKyQ,YAAazQ,KAAK6E,OACvB,MAED,IAAK,OACL,IAAK,MACL,IAAK,QACL,IAAK,MACL,IAAK,QACL,IAAK,WAE8B,OAA7B7E,KAAKmE,WAAW6D,YACpB0I,oBAAgB1Q,KAAK4E,gBAEtB,MAED,IAAK,OACL,IAAK,OAEJ5E,KAAK2Q,cAAe3Q,KAAK6E,U,gCAa5B,WAEC,IAAI+L,EAAW,CACdC,MAAO,cACDC,uBAAwB5S,iBAAiBc,KAAK+R,OAC9CC,SAAU,CACNnI,UAAW,WACP,OAAO3K,iBAAiBc,KAAK6J,YAGlCoI,eAAgB,SAAEC,GACjB,IAAIC,EAAWD,EAAKtK,KAUjB,OAPKrI,eAAW2S,EAAKjQ,KAEZmQ,OAAOC,UAAWC,SAAUJ,EAAKjQ,MAAUqQ,SAAUJ,EAAKjQ,IAAO,IAClEkQ,EAAW,yCAAH,QAA6C5I,cAAUrK,iBAAiBc,KAAKuS,kBAAmB,CAAEL,EAAKjQ,GAAGuQ,QAAS,aAAc,MAAjI,oBAAoJN,EAAKtK,OAIlKuK,GAEXM,kBAAmB,SAAWP,GAC1B,IAAIC,EAAWD,EAAKtK,KAUpB,OAPKrI,eAAW2S,EAAKjQ,KAEZmQ,OAAOC,UAAWC,SAAUJ,EAAKjQ,MAAUqQ,SAAUJ,EAAKjQ,IAAO,IAClEkQ,EAAW,yCAAH,QAA6C5I,cAAUrK,iBAAiBc,KAAKuS,kBAAmB,CAAEL,EAAKjQ,GAAGuQ,QAAS,aAAc,MAAjI,oBAAoJL,IAI7JA,GAEXO,aAAc,SAAWC,GACrB,OAAOA,IAerB,OAVK3R,KAAKmE,WAAWiD,iBAEpBwJ,EAASvI,YAAcrI,KAAKmE,WAAWkE,aAInCrI,KAAKmE,WAAWyN,cACpBhB,EAASgB,YAAc5R,KAAKmE,WAAWyN,aAGjChB,I,yBASR,SAAarG,GACZ,IAAIqG,EAAW5Q,KAAK6R,qBAEbtH,EAAOgG,SAAU,8BACvBhG,EAAOuH,QAASlB,K,2BAUlB,SAAerG,GAAQ,YAEfhM,eAAWwT,SAASC,eAAgB,4BAC1C7R,IAAG,QACD0C,OAAQ1C,IAAE,+EAEb,IAAM8R,EAAYF,SAASC,eAAgB,0BAEvCpB,EAAW,CACdsB,YAAY,EAEZC,gBAAiBnS,KAAKiJ,qBAAqB,GAE3CmJ,UAAY,EAEZC,YAAY,EAEZtL,SAAUkL,EAEVK,OAAQ,CACPC,SAAU,CACTC,UAAW,CACVtU,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASC,UAAUC,OAAQvU,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASC,UAAUE,OAAQxU,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASC,UAAUG,QAASzU,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASC,UAAUI,UAAW1U,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASC,UAAUK,SAAU3U,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASC,UAAUM,OAAQ5U,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASC,UAAUO,UAC1aC,SAAU,CAAE9U,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASS,SAASP,OAAQvU,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASS,SAASN,OAAQxU,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASS,SAASL,QAASzU,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASS,SAASJ,UAAW1U,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASS,SAASH,SAAU3U,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASS,SAASF,OAAQ5U,iBAAiBc,KAAKwM,OAAOC,KAAK8G,SAASS,SAASD,WAE/aE,OAAQ,CACPT,UAAW,CACVtU,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOT,UAAUU,QAAShV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOT,UAAUW,SAAUjV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOT,UAAUY,MAAOlV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOT,UAAUa,MAAOnV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOT,UAAUc,IAAKpV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOT,UAAUe,KAAMrV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOT,UAAUgB,KAAMtV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOT,UAAUiB,OAAQvV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOT,UAAUkB,UAAWxV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOT,UAAUmB,QAASzV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOT,UAAUoB,SAAU1V,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOT,UAAUqB,UAE9rBb,SAAU,CACR9U,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOD,SAASE,QAAShV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOD,SAASG,SAAUjV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOD,SAASI,MAAOlV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOD,SAASK,MAAOnV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOD,SAASM,IAAKpV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOD,SAASO,KAAMrV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOD,SAASQ,KAAMtV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOD,SAASS,OAAQvV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOD,SAASU,UAAWxV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOD,SAASW,QAASzV,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOD,SAASY,SAAU1V,iBAAiBc,KAAKwM,OAAOC,KAAKwH,OAAOD,SAASa,WAGlrBC,eAAgB,IAAF,OAAO5V,iBAAiBc,KAAKwM,OAAOC,KAAKqI,eAAzC,KAGdC,eAAkBzC,SAAUpT,iBAAiBc,KAAKwM,OAAOC,KAAKsI,iBAAoB,GAAKzC,SAAUpT,iBAAiBc,KAAKwM,OAAOC,KAAKsI,iBAAoB,EAAMzC,SAAUpT,iBAAiBc,KAAKwM,OAAOC,KAAKsI,gBAAmB,EAAI,EAChOC,iBAAkB,IAAF,OAAO9V,iBAAiBc,KAAKwM,OAAOC,KAAKuI,iBAAzC,KAChBC,YAAa/V,iBAAiBc,KAAKkV,kBAC7BC,YAAajW,iBAAiBc,KAAKoV,cACnCC,KAAM,CAAEnW,iBAAiBc,KAAKwM,OAAOC,KAAK6I,GAAIpW,iBAAiBc,KAAKwM,OAAOC,KAAK8I,IAChFC,cAAetW,iBAAiBc,KAAKwM,OAAOC,KAAKgJ,KACjDC,eAAgBxW,iBAAiBc,KAAKwM,OAAOC,KAAKkJ,MAClDC,cAAe1W,iBAAiBc,KAAKwM,OAAOC,KAAKoJ,KACjDC,gBAAiB5W,iBAAiBc,KAAKwM,OAAOC,KAAKsJ,QAG1DC,QAAS,SAAEC,EAAeC,EAASC,GAKlC,IACC,IAAMC,EAAuB,WAErB,EAAK5T,WAAW2H,SAAU,OAG3B,EAAK4G,QAAQvO,YAAc2T,EAAS/C,SAAS3L,OACjD,EAAKsJ,QAAQpN,SAAUwS,EAAS/C,SAAS3L,SAMvClI,eAAW,EAAKwR,SACpBqF,IAGA,EAAKvQ,MAAMvD,GAAI,uBAAuB,WACrC8T,OAGD,MAAQnO,GAAKjJ,QAAQC,IAAKgJ,KAG7B+D,SAAU,SAAEiK,EAAeC,EAASC,GAEnC,IACC,IAAME,EAAqB,WAG1B,EAAKtF,QAAQpN,SAAUwS,EAAS/C,SAAS3L,SAIrClI,eAAW,EAAKwR,SACpBsF,IAGA,EAAKxQ,MAAMvD,GAAI,uBAAuB,WACrC+T,OAGD,MAAQpO,GAAKjJ,QAAQC,IAAKgJ,MAMI,QAA7BjH,KAAKmE,WAAW6D,YACpB4I,EAAWzQ,WAAUyQ,EAAU,CAE9BtF,WAAYtL,KAAKmE,WAAWmH,WAC5BgK,UAAYtV,KAAKmE,WAAWoH,gBAIxBvL,KAAKmE,WAAWyH,gBACpBgF,EAAS2E,KAAO,UAIZhX,eAAWyB,KAAKmE,WAAWuH,WAC/BkF,EAASlF,QAAU1L,KAAKmE,WAAWuH,UAI/BnN,eAAWyB,KAAKmE,WAAWwH,WAC/BiF,EAASjF,QAAU3L,KAAKmE,WAAWwH,UAIH,QAA7B3L,KAAKmE,WAAW6D,YACpB4I,EAAWzQ,WAAUyQ,EAAU,CAC9B4E,YAAY,EACVC,YAAY,EAGZnK,WAAYtL,KAAKmE,WAAW0H,WAC9ByJ,UAAYtV,KAAKmE,WAAW2H,iBAIxBvN,eAAWyB,KAAKmE,WAAW4H,WAC/B6E,EAAS7E,QAAU/L,KAAKmE,WAAW4H,UAI/BxN,eAAWyB,KAAKmE,WAAWuR,WAC/B9E,EAAS8E,QAAU1V,KAAKmE,WAAWuR,UAKrC1V,KAAKgQ,kBAAoBzF,EAAOoL,UAAW/E,K,4BAS5C,WAAgB,WAEf,GACC,CAAE,OAAQ,MAAO,QAAS,MAAO,QAAS,OAAQ,QAASzH,SAAUnJ,KAAKmE,WAAW6D,WACrF,CAEAhI,KAAK4V,oBAEL,IAAMC,EAAe7V,KAAKwB,WAG1BxB,KAAK+P,QAAU+F,WAAY9V,KAAKiJ,qBAAqB,GAAI,CACxD8M,YAAa,EACbC,QAAS,EACTvP,MAAOoP,EACPN,KAAM,UACNU,UAAU,EACVC,YAAY,EACZC,eAAgBC,IAChBC,cAAc,EACdC,aAAa,EACbC,UAAW,CACVC,KAAK,GAENC,SAAUzW,KAAKmE,WAAW2D,aAItB9H,KAAKmE,WAAWiD,gBACpBpH,KAAK+P,QAAQ2G,UAAW,cAAe1W,KAAKmE,WAAWkE,aAGxDrI,KAAK+P,QAAQzO,GAAI,WAAW,WAEpB,CAAE,OAAQ,QAAS6H,SAAU,EAAKhF,WAAW6D,YACnD,EAAKrF,SAAU,EAAKoN,QAAQvO,eAI9BxB,KAAK+P,QAAQzO,GAAI,SAAS,WAEzB,GAAK,CAAE,OAAQ,QAAS6H,SAAU,EAAKhF,WAAW6D,WACjD,IAEC6E,YAAY,WACX,EAAKmD,kBAAkB2G,SACrB,IACF,MAAQ1P,GACTjJ,QAAQC,IAAKgJ,OAKhBjH,KAAK6E,MAAMvD,GAAI,SAAS,WACvB,EAAKyO,QAAQ6G,WAGd5W,KAAK6E,MAAMpC,QAAS,uBAGa,UAA7BzC,KAAKmE,WAAW6D,YAEfzJ,eAAWyB,KAAK6H,mBACpB7H,KAAK6H,iBAAiBgP,mB,+BAUzB,WAEC,IAAKtY,eAAWyB,KAAK+P,SACpB,IACC,IAAMxF,EAASvK,KAAK+P,QAAQ+G,oBAC5BvM,EAAOwM,WAAWC,YAAazM,GAC/BvK,KAAK+P,QAAU,KACd,MAAQ9I,O,6BASZ,WACC,IAAI2J,EAAW5Q,KAAK6R,uBAEbzS,aAASY,KAAK6E,QAAW7E,KAAK6E,MAAM0L,SAAU,8BACpDvQ,KAAK6E,MAAMiN,QAAS,WAAYA,QAASlB,K,+BAU3C,WAEE5Q,KAAKmE,WAAWmB,iBAGhBtF,KAAKiX,uBAELjX,KAAKkX,cAAgB,IAAI3I,UAAevO,OAGP,UAA7BA,KAAKmE,WAAW6D,YAEfzJ,eAAWyB,KAAK6H,mBACpB7H,KAAK6H,iBAAiBsP,sB,kCAWzB,YAEO5Y,eAAWyB,KAAKkX,gBACrBlX,KAAKkX,cAAcE,Y,yBAWrB,WAAa,WAIZ,GAHgBpX,KAAK6E,OAGhBtG,eAAWyB,KAAK6E,QAAwC,YAA7B7E,KAAKmE,WAAW6D,WAA2BhI,KAAKmE,WAAWoB,gBAAiB,CAE3G,IAAM8R,EAAUrX,KAAK6E,MAAMiB,KAAM,MAGvBwR,EAASC,QAAQC,IAAKH,IAErB9Y,eAAW+Y,IACf9Y,GAAG8Y,OAAOG,OAAQJ,GAGzB7Y,GAAG8Y,OAAOI,WAAYL,EAAS,CAC9BM,cAAc,EACdJ,QAAS,CACRK,SAAS,EACTC,SAAU,2GACVC,SAAU,0FAEXC,WAAW,KAINT,EAASC,QAAQC,IAAKH,IAIf/V,GAAI,yBAAyB0W,eAAS,WAGlD,EAAKnT,MAAMmC,IAAKsQ,EAAOW,WAAW,CACjCzM,OAAS,WAEF,MAGHxL,KAAK2E,YAAYpC,KAAM,gBAAiBjB,GAAI,SAAS,WACpD,EAAKuD,MAAMpC,QAAS,sCAGrBzC,KAAK2E,YAAYpC,KAAM,gBAAiBjB,GAAI,SAAS,WACpD,EAAKuD,MAAMpC,QAAS,oCAGrBzC,KAAK4P,aAAe0H,EAEpBA,EAAOhW,GAAI,QAAQ,WAClB,EAAKuD,MAAMpC,QAAS,6B,uBAkB9B,SAAUtC,GAGN,IAAI+X,EAAW/X,EAAEgY,GAAGrG,QAAQsG,IAAIC,QAAS,oBAGzClY,EAAEmY,OAAQJ,EAASK,SAAU,CACzBzH,uBAAwB,KAI5B,IAAI0H,EAAiBrY,EAAEgY,GAAGrG,QAAQsG,IAAIC,QAAS,2BAG3CI,EAAwBD,EAAeE,UAAUC,OAErDH,EAAeE,UAAUC,OAAS,SAAWC,GAEzC,IAAIC,EAAYJ,EAAsBK,MAAO9Y,KAAM+Y,MAAML,UAAUM,MAAMF,MAAOG,YAIhF,OAHAjZ,KAAKkZ,QAAQtR,KAAM,cAAe5H,KAAKuG,QAAQiR,IAAK,2BAC1DxX,KAAKkZ,QAAQnW,SAAU/C,KAAKuG,QAAQiR,IAAK,gBAE5BqB,GAtBf,CAwBIM,OAAOC,S,8VC13EX,Q,WA3LC,WAAajV,I,6FAAuE,SAEnFnE,KAAKsE,cAAeH,GAGpBnE,KAAKqZ,e,kDAaN,SAAelV,IAEP5F,eAAW4F,EAAWsF,aACrBrK,aAAS+E,EAAWpE,OAI1BoE,EAAWsF,UAAW,EAHtBtF,EAAWsF,UAAW,IAQjBlL,eAAW4F,EAAWyG,mBACrBxL,aAAS+E,EAAW8D,aAI1B9D,EAAWyG,gBAAiB,EAH5BzG,EAAWyG,gBAAiB,GAO9B5K,KAAKmE,WAAaA,I,0BAWnB,WAECnE,KAAKmO,OAASnO,KAAKmE,WAAWgK,OAAOO,KAAI,SAAE4K,GAE1C,OAAO,IAAInY,UAAOmY,EAAUtR,UAAWsR,Q,+BAUzC,WAEC,IAGM7Y,EAAaN,IAAE,kCAGrB,GAAKH,KAAKmE,WAAWsF,SAAU,CAE9B,IAAM8P,EAASpZ,IAAE,kCAAD,OAAqCH,KAAKmE,WAAWpE,MAArD,WAGhBU,EAAWoC,OAAQ0W,GAIpB,IAAMC,EAAarZ,IAAE,0CAarB,GAXAH,KAAKmO,OAAOoB,SAAQ,SAAE1K,GAErB,IAAM4U,EAAgB5U,EAAMN,oBAG5BiV,EAAW3W,OAAQ4W,MAGpBhZ,EAAWoC,OAAQ2W,GAGdxZ,KAAKmE,WAAWsF,SAAU,CAE9B,IAAMiQ,EAAevZ,IAAE,wCAAD,OAA2CH,KAAKmE,WAAW8D,YAA3D,WAGtBxH,EAAWoC,OAAQ6W,GAQpB,OAJA1Z,KAAK2E,YAAclE,EACRA,I,sBAcZ,WAEC,IAAIkZ,EAAc,GASlB,OANA3Z,KAAKmO,OAAOoB,SAAQ,SAAE1K,GAErB8U,EAAa9U,EAAM+U,cAAiB/U,EAAMrD,cAIpCmY,I,4BAWR,WACC,OAAO3Z,KAAK2E,c,2BAWb,WACC,OAAO3E,KAAKmE,a,sBAab,WAA8B,IAApB8H,IAAoB,yDAEzB4N,EAAmB,CACtBC,SAAS,EACTC,QAAS,IAaV,OATA/Z,KAAKmO,OAAOoB,SAAQ,SAAE1K,GAErBgV,EAAkBhV,EAAM+U,cAAiB/U,EAAMmV,SAAU/N,GAGzD4N,EAAiBC,QAAUD,EAAiBC,SAAWD,EAAkBhV,EAAM+U,cAAeE,WAIxFD,O,wXCxLT,IAAMI,EAAW5B,EAAS,0DA6qB1B,Q,WA1qBC,WAAalU,I,6FAAuE,SAEnFnE,KAAKsE,cAAeH,GAGpBnE,KAAKqZ,e,kDAaN,SAAelV,IAEP5F,eAAW4F,EAAWsF,aACrBrK,aAAS+E,EAAWpE,OAI1BoE,EAAWsF,UAAW,EAHtBtF,EAAWsF,UAAW,IAQjBlL,eAAW4F,EAAWyG,mBACrBxL,aAAS+E,EAAW8D,aAI1B9D,EAAWyG,gBAAiB,EAH5BzG,EAAWyG,gBAAiB,GAO9B5K,KAAKmE,WAAaA,I,0BAWnB,WAEC,IAAM+V,EAAoBla,KAAKmE,WAAWgK,OAGtCgM,EAAa,GAGjB,GAAKpB,MAAMqB,QAASpa,KAAKmE,WAAWpD,eAAkBf,KAAKmE,WAAWpD,aAAakO,OAAS,EAK3FjP,KAAKmE,WAAWpD,aAAawO,SAAQ,SAAE8K,EAAKhQ,GAE3C,IAAIiQ,EAAYlP,KAAKC,MAAOD,KAAKmP,UAAWL,IAI5CI,EAAYA,EAAU5L,KAAI,SAAE7J,EAAOwF,GAYlC,OAVK9L,eAAW8b,EAAKxV,EAAMG,aAE1BH,EAAM9D,aAAesZ,EAAKxV,EAAMG,YAIhCH,EAAM9D,aAAe,GAIf8D,KAIRsV,EAAW7K,KAAMgL,WAMlB,GAAKta,KAAKmE,WAAWqB,WAAY,CAEhC,IAAIgV,EAAWpP,KAAKC,MAAOD,KAAKmP,UAAWL,IAG3CM,EAASzZ,aAAe,GAGxBoZ,EAAW7K,KAAMkL,GAQnBL,EAAaA,EAAWzL,KAAI,SAAE2L,EAAKhQ,GAiBlC,OAfMgQ,EAAI3L,KAAI,SAAE+L,EAAapQ,GAW5B,OATAoQ,EAAY1a,MAAQ,GAGpB0a,EAAYxS,YAAc,GAGd,IAAI9G,UAAOsZ,EAAYzS,UAAWyS,SAWhDza,KAAK0a,UAAYP,I,+BASlB,WAEC,IAAIhY,EAGE1B,EAAaN,IAAE,qCAGrB,GAAKH,KAAKmE,WAAWsF,SAAU,CAE9B,IAAM8P,EAASpZ,IAAE,2DAAD,OAEXH,KAAKmE,WAAWpE,MAFL,uBAGXC,KAAKmE,WAAWqB,WAAhB,yDAHW,6BAQhB/E,EAAWoC,OAAQ0W,GAIpB,IAAIoB,EAAS3a,KAAK4a,iBAOlB,GANAna,EAAWoC,OAAQ8X,GAGnBA,EAAO9X,OAAQ1C,IAAE,4CAGZH,KAAKmE,WAAWyG,eAAgB,CAEpC,IAAM8O,EAAevZ,IAAE,2CAAD,OAA8CH,KAAKmE,WAAW8D,YAA9D,WAGtBxH,EAAWoC,OAAQ6W,GAgBpB,OAZA1Z,KAAK2E,YAAclE,EACnB0B,EAAW1B,EAGNT,KAAK0a,UAAUzL,OAAS,GAC5BjP,KAAK6a,mBAIN7a,KAAK8a,aAGE3Y,I,wBAOR,WAAY,WAEXnC,KAAK2E,YAAYrD,GAAI,SAAS,SAAEwH,GAE/B,EAAKiS,qC,2CAUP,WAEC,IAAI5M,EAAS,GAGbnO,KAAK0a,UAAUnL,SAAQ,SAAE+K,GAExB,IAAID,EAAM,GAGVC,EAAU/K,SAAQ,SAAEpO,GAEnBkZ,EAAI/K,KAAMnO,EAAMgD,eAIjBgK,EAAOmB,KAAM+K,MAIdra,KAAKmE,WAAWgK,OAASA,I,8BAO1B,WAAkB,WAGjB8L,EAAUja,KAAK2E,YAAYpC,KAAM,qCAAuC,CACvEyY,sBAAsB,EACtBC,OAAQ,iDACR5S,YAAa,oBAAF,OAAyBrI,KAAK0a,UAAU,GAAGzL,OAAS,EAApD,sBACXiM,eAAgB,SAAEC,EAAgBC,GACjC,MAAO,CACNC,SAAUF,EAAe9Q,MACzBX,KAAUyR,EAAezR,SAM5B1J,KAAK2E,YAAYpC,KAAM,qCAAsCjB,GAAI,cAAc,SAAEwH,GAEhF,IAAIwS,EAAW,GAGfnb,SAAQ2I,EAAMyS,OAAOC,YAAYrY,OAAO,SAAEkH,EAAOgQ,GAChDiB,EAAShM,KAAMnP,IAAGka,GAAMnJ,KAAM,aAI/B,IAAIuK,EAAoB,GACxBH,EAAS/L,SAAQ,SAAEmM,GAClBD,EAAkBnM,KAAM,EAAKoL,UAAWgB,OAEzC,EAAKhB,UAAYe,EAGjB,EAAKE,gB,4BAUP,WAAgB,WAEThB,EAASxa,IAAE,+UAcbyb,EAAU,GAGd5b,KAAKmE,WAAWgK,OAAOoB,SAAQ,SAAE+J,EAAWjP,GAE3C,IAAMwR,GAAQtd,eAAW+a,EAAUvZ,OAAUuZ,EAAUvZ,MAAQ,GAGzDyF,KAAajH,eAAW+a,EAAU9T,aAAe8T,EAAU9T,WAG3DyC,GAAc1J,eAAW+a,EAAUrR,aAAgBqR,EAAUrR,YAAc,GAGjF2T,EAAQtM,KAAK,CACZuM,MAAaA,EACb5T,YAAaA,EACbzC,WAAaA,OAKf,IAAMsW,EAAW3b,IAAE,aAGnB2b,EAASjZ,OAAQ1C,IAAE,iHAGnByb,EAAQrM,SAAQ,SAAEwM,EAAe1R,GAEhC,IAAI2R,EAAiB7b,IAAE,+DAGhBf,aAAS2c,EAAcF,QAC7BG,EAAenZ,OAAQ1C,IAAE,yFAAD,OAEnB4b,EAAcF,MAFK,yBAGnBE,EAAcvW,WAAd,6EAHmB,mCASlBpG,aAAS2c,EAAc9T,cAC7B+T,EAAenZ,OAAQ1C,IAAE,+FAAD,OAEnB4b,EAAc9T,YAFK,kCAQzB6T,EAASjZ,OAAQmZ,MAIlBF,EAASjZ,OAAQ1C,IAAE,iHAGOwa,EAAOpY,KAAM,wCACrBM,OAAQiZ,GAG1B,IAAMG,EAAQtB,EAAOpY,KAAM,qCAGrB2Z,EAAelc,KAAK0a,UAAUzL,OA8DpC,GA3DAjP,KAAK0a,UAAUnL,SAAQ,SAAE8K,EAAKhQ,GAE7B,IAAM8R,EAAOhc,IAAE,mBAAD,OAAsBkK,EAAtB,YAGd8R,EAAKtZ,OAAQ1C,IAAE,mGAAD,OAAwGkK,EAAQ,EAAhH,WAGdgQ,EAAI9K,SAAQ,SAAEpO,EAAOkJ,GAEpB,IAAM+R,EAAajc,IAAE,2DAGfoK,EAASpJ,EAAME,iBAErBF,EAAMqD,gBAGN4X,EAAWvZ,OAAQ0H,GAGnB4R,EAAKtZ,OAAQuZ,MAId,IAAM3Y,EAAWtD,IAAE,0GACnBgc,EAAKtZ,OAAQY,GAEb,IAAI4Y,EAAY,EAAKvO,gBAGrB,GAAc,GAATzD,GAAyB,GAATA,KAAkB,EAAKlG,WAAWqB,YAAc0W,EAAe,GAAO,CAG1F,IAAII,GAAiB/d,eAAW,EAAK4F,WAAWoY,sBAAyB,EAAKpY,WAAWoY,qBAAuBre,iBAAiBc,KAAKwd,UAGhIC,EAAmBtc,IAAE,0EAAD,OAA6Emc,EAA7E,0BAG1BG,EAAiBnb,GAAI,SAAS,WAE7B,EAAKob,UAAWrS,MAIXgS,EAAUM,aAEflZ,EAASZ,OAAO4Z,GAKlBR,EAAMpZ,OAAQsZ,OAICnc,KAAK8N,gBAEL6O,YAAc,CAC7B,IAAMC,EAAgBzc,IAAE,8EAAD,OAElBjC,iBAAiBc,KAAK6d,OAFJ,8BAOlBte,eAAWyB,KAAKmE,WAAW2Y,oBAC/BF,EAAchW,KAAM5G,KAAKmE,WAAW2Y,mBAIrCF,EAActb,GAAI,SAAS,WAE1Bsb,EAAc7Z,SAAU,oBAGxB,EAAK8Z,YAIoBlC,EAAOpY,KAAM,kCACrBM,OAAO+Z,GAE1B,OAAOjC,I,sBAWR,WAEC,IAAIlU,EAAQ,GAkBZ,OAfAzG,KAAK0a,UAAUnL,SAAQ,SAAE8K,EAAKhQ,GAE7B,IAAIsP,EAAc,GAGlBU,EAAI9K,SAAQ,SAAEpO,EAAOkJ,GAEpBsP,EAAaxY,EAAMyY,cAAiBzY,EAAMK,cAI3CiF,EAAM6I,KAAMqK,MAINlT,I,oBASR,WAA0C,IAAlCsW,EAAkC,uDAArB,GAAIpB,IAAiB,yDAErCnB,EAAWpP,KAAKC,MAAOD,KAAKmP,UAAWva,KAAKmE,WAAWgK,SAG3DqM,EAASzZ,aAAe,GAGxByZ,EAAWA,EAAS9L,KAAI,SAAE+L,EAAapQ,GAiBtC,OAfAoQ,EAAY1a,MAAQ,GAGpB0a,EAAYxS,YAAc,IAGrB1J,eAAWwe,EAAYtC,EAAYzV,eAEvCyV,EAAY1Z,aAAegc,EAAYtC,EAAYzV,aAIxC,IAAI7D,UAAOsZ,EAAYzS,UAAWyS,MAO/Cza,KAAK0a,UAAUpL,KAAMkL,GAGhBmB,GACJ3b,KAAK2b,a,sBAQP,WAEC3b,KAAK4V,oBAEL5V,KAAKiX,uBAGL,IAAM+F,EAAsBhd,KAAK2E,YAC3BsY,EAAkBjd,KAAKuE,mBAAmB,GAChDyY,EAAoBE,YAAaD,GAGjCjd,KAAKmX,oBAELnX,KAAK6W,mB,uBASN,SAAWxM,IAEL9L,eAAWyB,KAAK0a,UAAWrQ,KAE/BrK,KAAK0a,UAAUyC,OAAQ9S,EAAO,GAI/BrK,KAAK2E,YAAYuY,YAAald,KAAKuE,uB,4BAWpC,WAEC,OAAOvE,KAAK2E,c,2BAWb,WACC,OAAO3E,KAAKmE,a,wBAWb,WACC,OAAOnE,KAAKmE,WAAWa,a,sBAaxB,WAA8B,IAApBiH,IAAoB,yDAEzBxE,EAAa,CAChBqS,SAAS,EACTC,QAAS,IAINqD,EAAiB,GAqBrB,OAlBApd,KAAK0a,UAAUnL,SAAQ,SAAE8K,EAAKhQ,GAE7B,IAAIgT,EAAgB,GAGpBhD,EAAI9K,SAAQ,SAAEpO,EAAOkJ,GAEpBgT,EAAelc,EAAMyY,cAAiBzY,EAAM6Y,SAAU/N,GAGtDxE,EAAWqS,QAAUrS,EAAWqS,SAAWuD,EAAelc,EAAMyY,cAAeE,WAIhFsD,EAAe9N,KAAM+N,MAIf5V,I,+BAGR,WACCzH,KAAK0a,UAAUnL,SAAQ,SAAE+K,GAExBA,EAAU/K,SAAQ,SAAEpO,GAEnBA,EAAMgW,4B,kCAKT,WACCnX,KAAK0a,UAAUnL,SAAQ,SAAE+K,GAExBA,EAAU/K,SAAQ,SAAEpO,GAEnBA,EAAM8V,+B,4BAKT,WACCjX,KAAK0a,UAAUnL,SAAQ,SAAE+K,GAExBA,EAAU/K,SAAQ,SAAEpO,GAEnBA,EAAM0V,yB,+BAKT,WACC7W,KAAK0a,UAAUnL,SAAQ,SAAE+K,GAExBA,EAAU/K,SAAQ,SAAEpO,GAEnBA,EAAMyU,+B,oOC1oBV,QA9BI,WAAa/W,I,4FAAU,SACnB,IAAI4B,EAAgBN,IAAG,SAAU,CAAE,MAAS,qBACxCwD,EAAgBxD,IAAG,SAAU,CAAE,MAAS,cACxCmd,EAAgBnd,IAAG,SAAU,CAAE,MAAS,yBACxCod,EAAgBpd,IAAG,SAAU,CAAE,MAAS,8CAE5Cmd,EAAcza,OAAQ0a,GACtB9c,EAAWoC,OAAQc,GACnBlD,EAAWoC,OAAQya,IAGJnf,oBAAgB,UAAW,CACtCC,KAAMS,IAGDgE,OAAQpC,GAGA,WAAZ5B,GACD0e,EAAQ3W,KAAM1I,iBAAiBc,KAAKyD,QAAQ+H,KAG/B,UAAZ3L,GACD0e,EAAQ3W,KAAM1I,iBAAiBc,KAAKC,OAAOuL,KAG/C+S,EAAQjc,GAAI,SAAS,kBAAM,IAAIkc,UAAyB3e,Q,ghBCiOhE,Q,WArPI,WAAaA,EAAU4e,I,4FAAc,SACjCzd,KAAKnB,SAAeA,EACpBmB,KAAKyd,aAAeA,EACpBzd,KAAK+B,aAAe,GAGpB/B,KAAK2Y,S,2CAGT,WAEI,IAAI1G,EAAY9R,IAAG,SAAU,CAAE,MAAS,SACxCH,KAAKgD,MAAWiP,EAEhB,IAAIyL,EAAe1d,KAAKkD,eACpBya,EAAexd,IAAG,SAAU,CAAC,MAAS,kBACtC4B,EAAe/B,KAAK4d,qBACpBC,EAAe7d,KAAK8d,iCAUxB,GARA7L,EAAUpP,OAAQ6a,GAElBC,EAAY9a,OAAQd,GACpB4b,EAAY9a,OAAQgb,GAEpB5L,EAAUpP,OAAQ8a,IAGbpf,eAAWyB,KAAKyd,cAEjBzd,KAAKyd,aAAaP,YAAajL,OAE9B,CAED,IAAI8L,GAAW5f,oBAAgB,WAAY,CACvCC,KAAM4B,KAAKnB,WAGO,WAAjBmB,KAAKnB,WAEDkf,EAAS9O,OAAS,EACnBgD,EAAU+L,YAAaD,IAIT5f,oBAAgB,UAAW,CACrCC,KAAM4B,KAAKnB,WAGPgE,OAAQoP,IAIF,UAAjBjS,KAAKnB,YAEMV,oBAAgB,QAAS,CACjCC,KAAM4B,KAAKnB,WAGJoQ,OAAS,EAEhBgD,EAAU+L,YAAaD,IAIT5f,oBAAgB,UAAW,CACrCC,KAAM4B,KAAKnB,WAEc0D,KAAM,qBACpB2a,YAAajL,O,0BAM5C,WACI,IAAIyL,EAAUvd,IAAG,UAEb8d,EAAiB9d,IAAG,SAAU,CAAE,MAAS,cACzC+d,EAAiB/d,IAAG,SAAU,CAAE,MAAS,yBACzCge,EAAiBhe,IAAG,SAAU,CAAE,MAAS,yBACzC0b,EAAiB1b,IAAG,SAAU,CAAE,MAAS,6BAA8ByG,KAAM1I,iBAAiBc,KAAKgD,YAAY0F,QAE/GhJ,EAAiB,IAAIgF,UAAgB1D,KAAKnB,UAS9C,OARA6e,EAAO7a,OAAQnE,GAEfgf,EAAO7a,OAAQob,GAEfE,EAAatb,OAAQgZ,GACrBqC,EAAerb,OAAQsb,GACvBT,EAAO7a,OAAQqb,GAERR,I,gCAGX,WAAoB,WACZzL,EAAe9R,IAAG,SAAU,CAAE,MAAS,sBA0B3C,OAvBAH,KAAKoe,6BAA8Bpe,KAAKnB,UAGxCmB,KAAKqe,iCAGLre,KAAK+B,aAAawN,SAAQ,SAAEvN,GAExB,IAAMoD,EAAgBpD,EAAYf,GAG9Bqd,EAAqB,EAAKC,kBAAmBnZ,EAAepD,GAGhEsc,EAAmBhd,GAAI,SAAS,WAC5B,IAAIkd,UAAyB,EAAK3f,SAAUuG,EAAe,EAAKpC,UAIpEiP,EAAUpP,OAAQyb,MAIfrM,I,+BAGX,SAAmB7M,EAAepD,GAC9B,IA6BIyc,EA7BAxM,EAAc9R,IAAG,SAAU,CAAE,MAAS,qBACtCue,EAAcve,IAAG,SAAU,CAAE,MAAS,2BACtC8B,EAAc9B,IAAG,SAAU,CAAE,MAAS,2BAiD1C,OA9CK6B,EAAY2c,YAEb1M,EAAUlP,SAAU,yBAGpBkP,EAAUpP,OAAQ1C,IAAE,0DAAD,OACyBjC,iBAAiBc,KAAK4f,QAAQC,IADvD,2BAMhB7c,EAAY8c,YASf7M,EAAUlP,SAAU,gCAPpBkP,EAAUlP,SAAU,iCAGpBkP,EAAUrK,KAAM,eAAeW,cAAUrK,iBAAiBc,KAAK4f,QAAQG,YAAa,CAAE7gB,iBAAiBc,KAAKggB,yBAW3GzgB,eAAWyD,EAAYid,UACxBR,EAAWte,IAAE,aAAD,OAAgB6B,EAAYid,SAA5B,kBAAgDjd,EAAYC,KAA5D,QAGN1D,eAAWyD,EAAYkd,WAAa3gB,eAAWyD,EAAYmd,WACjEV,EAAWte,IAAE,aAAD,OAAgB6B,EAAYkd,QAA5B,sBAAkD3W,cAAU,eAAgB,CAAEvG,EAAYkd,QAASld,EAAYmd,UAA/G,kBAAqInd,EAAYC,KAAjJ,QAMhBA,EAAK2E,KAAM5E,EAAYC,MAGvByc,EAAK7b,OAAQ4b,GACbxM,EAAUpP,OAAQ6b,GAClBzM,EAAUpP,OAAQZ,GAGXgQ,I,4CAGX,WACI,OAAO9R,IAAE,0EAAD,OAEGjC,iBAAiBc,KAAKgD,YAAY6b,aAFrC,sBAEgEuB,wBAAoB,4CAA6C,CACzH,WAAe,oBACf,WAAe,wBACf,YAAe,+BALvB,6BAM6BlhB,iBAAiBc,KAAKqgB,UANnD,kG,0CAWZ,SAA8BxgB,GAAU,WAEpC,GAAK,CAAE,UAAW,UAAWsK,SAAUtK,GAAY,CAE/C,IAAMkD,EAAe5B,YAAU,EAAM,GAAIjC,iBAAiB6D,cAG1Dud,OAAOC,QAASxd,GAAewN,SAAQ,YAAoC,IASnEpM,E,IATmE,G,EAAA,E,4CAAA,I,wwBAAjCiC,EAAiC,KAAlBpD,EAAkB,KAEnEwd,GAAW,EAEXb,GAAY,EAEZG,GAAc,EAKD,WAAZjgB,GAID2gB,GAFArc,GAAcsc,2BAAuBzd,EAAYmB,MAAMuc,WAEnCC,YACpBb,EAAc3b,EAAMyc,kBACpBjB,EAAcxb,EAAM0c,gBAEF,UAAZhhB,IAIN2gB,GAFArc,GAAcsc,2BAAuBzd,EAAYmB,MAAMzE,UAEnCohB,WACpBhB,EAAc3b,EAAMyc,kBACpBjB,EAAcxb,EAAM0c,gBAInBL,GAED,EAAKzd,aAAauN,KAAMnP,WAAS,GAAI6B,EAAa,CAC9Cf,GAAamE,EACb0Z,YAAaA,EACbH,UAAaA,W,4CAOjC,WAEI3e,KAAK+B,cAAege,sCAAkC/f,KAAK+B,aAAc,a,qjBCiUjF,Q,WAnhBI,WAAalD,EAAUuG,EAAe9B,EAAUC,GAQ5C,O,4FARoD,kgBACpDvD,KAAKnB,SAAgBA,EACrBmB,KAAKoF,cAAgBA,EACrBpF,KAAKsD,SAAgBA,EACrBtD,KAAKuD,OAAgBA,EACrBvD,KAAKsC,KAAgBpE,iBAAiBI,OAAO6E,MAAOI,GACpDvD,KAAKggB,UAAgBhgB,KAAKsC,KAAK+M,KAAK4Q,WAE/B/hB,iBAAiBgiB,WAAWC,WAAY,KAClC,KAGJngB,KAAKogB,oB,gDAIhB,WACI,QAAOpgB,KAAKggB,YAIW,SAAlBhgB,KAAKggB,UACChgB,KAAKsC,KAAK+M,KAAKgR,oBAAsBrgB,KAAKsC,KAAK+M,KAAKiR,iBAGxC,YAAlBtgB,KAAKggB,WACChgB,KAAKsC,KAAK+M,KAAKkR,qBAAuBvgB,KAAKsC,KAAK+M,KAAKmR,uB,2BAMpE,WACI,GAAKxgB,KAAKygB,cAAgB,CACtB,IAAI7Z,EAAO1I,iBAAiBc,KAAKC,OAAOC,aAAac,KAAKggB,WAG1D,OAFApZ,GAAQ,KACA,WAAa5G,KAAKsC,KAAK+M,KAAKqR,eAAiB,YAGzD,OAAOxiB,iBAAiBc,KAAKC,OAAOC,aAAayhB,Q,+BAGrD,WAAmB,WA2Bf,OAxBA3gB,KAAK4gB,gBAAsBzgB,IAAG,SAAU,CAAE,MAAS,eACnDH,KAAK6gB,OAAmB1gB,IAAG,SAAU,CAAE,MAAS,oBAChDH,KAAK8gB,WAAmB3gB,IAAG,OAAQ,CAAE,MAAS,2BAI9CH,KAAK6gB,OAAOnX,KAAM1J,KAAK+gB,iBACvB/gB,KAAK6gB,OAAOxZ,QAASrH,KAAK8gB,YAC1B9gB,KAAK4gB,gBAAgB/d,OAAQ7C,KAAK6gB,QAE7B7gB,KAAKygB,eACNzgB,KAAKghB,qBAGJhhB,KAAKihB,SACNjhB,KAAKkhB,YAAahjB,iBAAiBc,KAAKC,OAAOC,aAA7B,KAItBc,KAAK6gB,OAAOvf,GAAI,SAAS,WACrB,EAAK6f,eAIFnhB,KAAK4gB,kB,mBAGhB,WAEI,OAAO,I,yBAGX,SAAa7gB,GACTC,KAAKohB,YAAcjhB,IAAG,UAAW,CAAE,MAAS,wBAC5CH,KAAKohB,YAAYxa,KAAM7G,GACvBC,KAAK6gB,OAAOhe,OAAQ7C,KAAKohB,e,gCAG7B,WAAqB,WACjBphB,KAAKqhB,aAAelhB,IAAG,UAAW,CAAE,MAAS,iBAC7CH,KAAKshB,iBAAmBnhB,IAAG,OAAQ,CAAE,MAAS,2BAE9CH,KAAKqhB,aAAaza,KAAM1I,iBAAiBc,KAAKC,OAAOC,aAAauY,QAClEzX,KAAKqhB,aAAa/f,GAAI,SAAS,WAC3B,EAAKigB,oBAETvhB,KAAKqhB,aAAaha,QAASrH,KAAKshB,kBAChCthB,KAAK4gB,gBAAgB/d,OAAQ7C,KAAKqhB,gB,gCAGtC,WAEI,IAAIG,EAAerhB,IAAE,SAAW,CAAE,MAAS,uBAY3C,GAVAH,KAAKyhB,cAAgBzhB,KAAK0hB,sBAE1B1hB,KAAKyhB,cAAclf,KAAM,gCAAiCof,MAAO3hB,KAAK4hB,sBACtE5hB,KAAKyhB,cAAclf,KAAM,+BAAgCof,MAAO3hB,KAAK6hB,yBAErE7hB,KAAK8hB,wBAGLN,EAAa3e,OAAQ7C,KAAKyhB,eAErBzhB,KAAKygB,cAAgB,CACtB,IAAIsB,EAAkB5hB,IAAG,SAAU,CAAE,MAAS,oCAC1C6hB,EAAkB7hB,IAAG,OAAQ,CAAE,MAAS,0CAC5C4hB,EAAgBlf,OAAQmf,GACxBD,EAAgBlf,OAAQ3E,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMC,iBACxEV,EAAa3e,OAAQkf,GAGzB,OAAOP,I,uBAGX,WAEIxhB,KAAKiiB,MAAQ,IAAIE,UAAO,CACpBtG,MAAO3d,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMpG,MACvDuG,QAASpiB,KAAKqiB,qBACdC,QAAS,CACLC,OAASrkB,iBAAiBc,KAAKujB,OAC/BC,QAAStkB,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMO,UAE9D,CACCC,KAAM,QACN7Q,YAAa,iBAGjB5R,KAAK0iB,gB,yBAGT,WAAc,WACV1iB,KAAKiiB,MAAMU,UAAW,CAClBC,eAAgB,WAEZ,EAAKX,MAAMY,QAEfC,UAAW,WACP,EAAKC,eAGTC,UAAW,WACP,EAAKf,MAAM7K,e,yBAKvB,WACI,IACI6L,EADkBjjB,KAAKiiB,MAAMiB,cACFjB,MAAMkB,IAAIb,QAAQE,QAKjD,GAFAS,EAAclgB,SAAU,oBAAqB+C,KAAM,YAAY,GAExD9F,KAAKojB,eAAetJ,QAA3B,CAKA,IAOI5X,EAPA8d,EAAYhgB,KAAKqjB,eAAe7hB,WAChC8hB,EAActjB,KAAKujB,iBAAiB/hB,WACpCgiB,EAAYxjB,KAAKyjB,eAAejiB,WAChCkiB,EAAe1jB,KAAK2jB,kBAAkBniB,WACtCoiB,EAAe5jB,KAAK6jB,kBAAkBriB,WAMtCU,EADc,SAAb8d,EACUhgB,KAAK8jB,gBAEL9jB,KAAK+jB,mBAGpB/jB,KAAKgkB,aAAchE,EAAWsD,EAAaE,EAAWE,EAAcE,EAAc1hB,QAnB9E+gB,EAAclY,YAAa,oBAAqBjF,KAAM,YAAY,K,0BAuB1E,WACI,IAEIme,EAFAT,EAAYxjB,KAAKyjB,eAAejiB,WAChC8hB,EAActjB,KAAKujB,iBAAiB/hB,WAGxC,OAASgiB,GACL,IAAK,UACDS,EAAa,EACb,MACJ,IAAK,UACDA,EAAa,GACb,MACJ,IAAK,QACDA,EAAa,KACb,MACJ,IAAK,OACDA,EAAa,MACb,MACJ,IAAK,QACDA,EAAa,QACb,MACJ,QACIA,EAAa,EAIrB,OAAOX,EAAcW,I,2BAGzB,WACI,IAAIC,EAAOlkB,KAAKyjB,eAAejiB,WAM/B,OAJyC,GAApCxB,KAAKujB,iBAAiB/hB,aACvB0iB,EAAOA,EAAKlL,MAAM,GAAI,IAGdhZ,KAAKujB,iBAAiB/hB,WAAa,IAAMtD,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMiC,K,6BAGzG,WACI,OAAOC,KAAK9Y,MAAOrL,KAAK6jB,kBAAkBriB,WAAa,IAAMxB,KAAK2jB,kBAAkBniB,c,8BAGxF,WACI,OAAOxB,KAAK6jB,kBAAkBriB,WAAa,MAAQxB,KAAK2jB,kBAAkBniB,a,0BAG9E,SAAcwe,GAA6G,WAAlGsD,EAAkG,uDAApF,KAAME,EAA8E,uDAAlE,KAAME,EAA4D,uDAA7C,KAAME,EAAuC,uDAAxB,KAAM1hB,EAAkB,uDAAP,MAEhHR,cAAU,kBAAmB,CACzB,SAAYxD,iBAAiBI,OAAO2C,GACpC,SAAYjB,KAAKuD,OACjB,UAAayc,EACb,YAAesD,EACf,UAAaE,EACb,aAAgBE,EAChB,aAAgBE,EAChB,iBAAoB1hB,IACrB,WAEC,EAAK+f,MAAM7K,UAEX,IAAIhV,UAGGlE,iBAAiBI,OAAOwb,SAC3B5b,iBAAiBI,OAAO8lB,QAAQC,aAAa1hB,UAAU,MAE5D,WAEC,EAAKsf,MAAM7K,UAEXpZ,QAAQC,IAAK,6CAEb,IAAImE,e,4BAKZ,YAGIV,cAAU,kBAAmB,CACzB,SAAYxD,iBAAiBI,OAAO2C,GACpC,SAAYjB,KAAKuD,SAClB,WAEC,IAAInB,UAGGlE,iBAAiBI,OAAOwb,SAC3B5b,iBAAiBI,OAAO8lB,QAAQC,aAAa1hB,UAAU,MAE5D,WAEC3E,QAAQC,IAAK,6CAEb,IAAImE,e,4BAKZ,WAEI,IAAIkiB,EAAmBnkB,IAAG,OAAQ,CAAE,MAAS,qCAEzCokB,EAAepkB,IAAG,UAAW,CAAE,MAAS,iCAAkCuJ,KAAM,WAAaxL,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMuC,SAAW,cAAgBtmB,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMwC,gBAI5N,OAFAF,EAAa1hB,OAAQyhB,GAEdC,I,iCAIX,WAqBI,OAnBAvkB,KAAKqjB,eAAiB,IAAIliB,UAAO,QAAS,CACtCtC,SAAU,SACVmG,WAAY,gBACZ/C,KAAM,gBACNuD,YAAY,EACZzE,aAAcf,KAAKggB,UAAYhgB,KAAKggB,UAAY,QAChDzZ,QAAS,CACL,CACIE,MAAO,QACPG,KAAM1I,iBAAiBc,KAAKC,OAAOC,aAAayhB,OAEpD,CACIla,MAAO,WACPG,KAAM1I,iBAAiBc,KAAKC,OAAOC,aAAawlB,aAMrD1kB,KAAKqjB,eAAe9e,oBAAoBxB,SAAU,yB,mCAG7D,WAAwB,WAEpB/C,KAAKyhB,cAAcngB,GAAI,0BAA0B,WAEnB,YADF,EAAK+hB,eAAe7hB,YAExC,EAAKmjB,mBAAmB5Z,YAAa,UACrC,EAAKkX,MAAMhiB,SAASgiB,MAAMkB,IAAIb,QAAQE,QAAQ5b,KAAM1I,iBAAiBc,KAAKC,OAAOC,aAAawlB,YAE9F,EAAKC,mBAAmB5hB,SAAU,UAClC,EAAKkf,MAAMhiB,SAASgiB,MAAMkB,IAAIb,QAAQE,QAAQ5b,KAAM1I,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMO,e,mCAKhH,WAEI,IAAIoC,EAAkBzkB,IAAE,SAAW,CAAE,MAAS,qBAE1C0kB,EAAe1kB,IAAG,UAAW,CAAE,MAAS,4BAA8ByG,KAAM1I,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAM4C,cAE5HC,EAAiB3kB,IAAG,SAAU,CAAE,MAAS,oBAE7C,IAAOH,KAAKygB,cAAgB,CACxBzgB,KAAK2kB,mBAAqBxkB,IAAG,SAAU,CAAE,MAAS,2BAClD,IAAI4kB,EAAqB5kB,IAAG,OAAQ,CAAE,MAAS,qCAC/CH,KAAK2kB,mBAAmB/d,KAAM1I,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAM+C,iBAC9EhlB,KAAK2kB,mBAAmB9hB,OAAQkiB,GAChC/kB,KAAK2kB,mBAAmB5hB,SAAU,2BAetC,OAZA6hB,EAAgB/hB,OAAQgiB,GAExBC,EAAejiB,OAAQ7C,KAAKilB,0BAE5BH,EAAejiB,OAAQ7C,KAAKklB,0BAE5BN,EAAgB/hB,OAAQiiB,GAExBF,EAAgB/hB,OAAQ7C,KAAKmlB,kBAE7BP,EAAgB/hB,OAAQ7C,KAAK2kB,oBAEtBC,I,gCAGX,WACI,IAAIQ,EAAejlB,IAAE,SAAW,CAAE,MAAS,kBAEvCklB,EAAYllB,IAAG,UAAW,CAAE,MAAS,4BAA8ByG,KAAM1I,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMoD,WAEzHC,EAAcnlB,IAAG,SAAU,CAAE,MAAS,iBAG1CH,KAAKulB,gBAAkBvlB,KAAKwlB,wBAE5BxlB,KAAKylB,cAAgBzlB,KAAK0lB,sBAE1B,IAAIC,EAAkBxlB,IAAG,UAAW,CAAE,MAAS,8BAAgCyG,KAAM1I,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMN,OAgBrI,OAZA2D,EAAYziB,OAAQ7C,KAAKulB,iBAEzBD,EAAYziB,OAAQ7C,KAAKylB,eAEzBH,EAAYziB,OAAQ8iB,GAGpBP,EAAaviB,OAAQwiB,GAErBD,EAAaviB,OAAQyiB,GAGdF,I,mCAGX,WAYI,OAVAplB,KAAKujB,iBAAmB,IAAIpiB,UAAO,MAAO,CACtCtC,SAAU,SACVmG,WAAY,eACZQ,YAAY,EACZF,gBAAgB,EAChBvE,aAAcf,KAAKsC,KAAK+M,KAAKgR,mBAAqBrgB,KAAKsC,KAAK+M,KAAKgR,mBAAqB,KAE1F,EACArgB,KAAK4lB,qBAEE5lB,KAAKujB,iBAAiBhf,oBAAoBxB,SAAU,0B,iCAG/D,WAgCI,OA9BA/C,KAAKyjB,eAAiB,IAAItiB,UAAO,SAAU,CACvCtC,SAAU,SACVmG,WAAY,aACZjE,aAAcf,KAAKsC,KAAK+M,KAAKiR,iBAAmBtgB,KAAKsC,KAAK+M,KAAKiR,iBAAmB,UAClF1O,YAAa,YACbpM,YAAY,EACZe,QAAS,CACL,CACIE,MAAO,UACPG,KAAO1I,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAM4D,SAE3D,CACIpf,MAAO,UACPG,KAAO1I,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAM6D,SAE3D,CACIrf,MAAO,QACPG,KAAO1I,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAM8D,OAE3D,CACItf,MAAO,OACPG,KAAO1I,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAM+D,MAE3D,CACIvf,MAAO,QACPG,KAAO1I,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMgE,UAK5DjmB,KAAKyjB,eAAelf,oBAAoBxB,SAAU,wB,oCAG7D,WAEI/C,KAAK6jB,kBAAoB,IAAI1iB,UAAO,OAAQ,CACxCtC,SAAU,SACVmG,WAAY,gBACZQ,YAAY,EACZ8F,WAAYpN,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAM3W,WAC5DhG,gBAAgB,EAChBvE,aAAcf,KAAKsC,KAAK+M,KAAKmR,oBAAsBxgB,KAAKsC,KAAK+M,KAAKmR,oBAAsB,KAI5F,IAAM0F,EAAqBlmB,KAAK6jB,kBAAkBtf,oBAOlD,OALA2hB,EAAmBnjB,SAAU,yBAG7B/C,KAAK6jB,kBAAkBhN,iBAEhBqP,I,oCAGX,WAEIlmB,KAAK2jB,kBAAoB,IAAIxiB,UAAO,OAAQ,CACxCtC,SAAU,SACVmG,WAAY,gBACZQ,YAAY,EACZqG,WAAY3N,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMpW,WAC5DvG,gBAAgB,EAChBvE,aAAcf,KAAKsC,KAAK+M,KAAKkR,oBAAsBvgB,KAAKsC,KAAK+M,KAAKkR,oBAAsB,KAI5F,IAAM4F,EAAqBnmB,KAAK2jB,kBAAkBpf,oBAOlD,OALA4hB,EAAmBpjB,SAAU,yBAG7B/C,KAAK2jB,kBAAkB9M,iBAEhBsP,I,0BAGX,WAEI,IAEIC,EAEJ,OAJgBpmB,KAAKqjB,eAAe7hB,YAKhC,IAAK,WACD4kB,EAAgBpmB,KAAKqmB,yBACrB,MACJ,IAAK,QACDD,EAAgBpmB,KAAKujB,iBAAiBvJ,WACtC,MACJ,QACIoM,EAAgB,CAAEtM,SAAS,EAAOC,QAAS7b,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMxa,WAAW6e,aAI9G,OAAOF,EAActM,QAId,CAAEA,SAAS,GAHPsM,I,oCAMf,SAAwB3f,GACpB,MAAO,CAAEqT,SAAS,K,iCAGtB,SAAqBrT,EAAO8f,GAExB,OAAK9f,EAAQ,EACF,CAAEqT,SAAS,EAAOC,QAAS7b,iBAAiBc,KAAKC,OAAOC,aAAa+iB,MAAMxa,WAAW+e,gBAG1F,CAAE1M,SAAS,Q,uVC3gB1B,Q,WAzCC,WAAa1W,GAGZ,O,4FAH6B,SAC7BpD,KAAKoD,gBAAkBA,EAEhBpD,KAAKymB,iB,mDAWV,WACC,IAAIxU,EAAc9R,IAAG,SAAU,CAAE,MAAS,cAE1C,IAAK5B,eAAWL,iBAAiB6D,aAAc/B,KAAKoD,kBAAqB,CAErE,IAGIO,EAHA3B,EAAc9D,iBAAiB6D,aAAc/B,KAAKoD,kBAMvD7E,eAAWyD,EAAYid,UAC3Btb,EAAQxD,IAAE,aAAD,OAAgB6B,EAAYid,SAA5B,kBAAgDjd,EAAYC,KAA5D,QAGA1D,eAAWyD,EAAYkd,WAAa3gB,eAAWyD,EAAYmd,WACpExb,EAAQxD,IAAE,aAAD,OAAgB6B,EAAYkd,QAA5B,sBAAkD3W,cAAU,eAAgB,CAAEvG,EAAYkd,QAASld,EAAYmd,UAA/G,kBAAqInd,EAAYC,KAAjJ,QAGJgQ,EAAUpP,OAAQc,GAInB,OAAOsO,O,+bCoMf,Q,WAzNI,WAAapT,EAAUuG,EAAe9B,EAAUC,GAO5C,O,4FAPoD,SACpDvD,KAAKnB,SAAgBA,EACrBmB,KAAKoF,cAAgBA,EACrBpF,KAAKsD,SAAgBA,EACrBtD,KAAKuD,OAAgBA,EACrBvD,KAAKsC,KAAgBpE,iBAAiBI,OAAO6E,MAAOI,GAE7CvD,KAAK0mB,oB,sDAGhB,WAAmB,WAEXzU,EAAgB9R,IAAG,SAAU,CAAE,MAAS,iBACxCwmB,EAAgBxmB,IAAG,SAAU,CAAE,MAAS,sBACxCymB,EAAgBzmB,IAAG,OAAQ,CAAE,MAAS,oCACtC0mB,EAAgB1mB,IAAG,SAAU,CAAE,MAAS,2BACxC2mB,EAAgB3mB,IAAG,QAAS,CAAE,MAAS,8BAE3CwmB,EAAI9jB,OAAQ+jB,GACZ3U,EAAUpP,OAAQ8jB,GAGlB,IAAII,EAAgB5mB,IAAG,QAAS,CAAE,MAAS,kCACvC6mB,EAAgB7mB,IAAG,WAAYyG,KAAM1I,iBAAiBc,KAAjB,QAMzC,GAJA+nB,EAAalkB,OAAQmkB,GACrBF,EAAWjkB,OAAQkkB,IAGdxoB,eAAWyB,KAAKnB,YAAcN,eAAWyB,KAAKsD,cACxC/E,eAAWyB,KAAKsC,QAAS/D,eAAWyB,KAAKsC,QAAYtC,KAAKsC,KAAK2kB,WAAW,CAC7E,IAAIC,GAAiBC,mBAAennB,KAAKoF,cAAepF,KAAKnB,SAAUmB,KAAKsD,UAE5E,IAAK/E,eAAW2oB,EAAeE,cAAgB,CAC3C,IAAIC,EAAa,qBAAH,OAAyBrnB,KAAKoF,cAA9B,YAAiDpF,KAAKoF,cAAtD,YAAyEpF,KAAKsD,SAA9E,YAA4FtD,KAAKoF,cAAjG,aAAoHkiB,wBAAoBJ,EAAeK,mBAAoB,GAAI,IAAKC,cAAchW,QAAS,WAAY,MAEjOiW,EAAgBtnB,IAAG,OAAQ,CAC3B,MAASif,wBAAoB8H,EAAeE,aAAc,CACtD,WAAe,oBACf,WAAe,cACf,YAAeC,IAEnB,MAAS,gCACT,OAAU,WAEVK,EAAgBvnB,IAAG,WAAYyG,KAAM1I,iBAAiBc,KAAK2oB,SAE/DF,EAAc5kB,OAAQ6kB,GACtBZ,EAAWjkB,OAAQ4kB,IAqK/B,OAhKAZ,EAAShkB,OAAQikB,GACjB7U,EAAUpP,OAAQgkB,GAGlBF,EAAIrlB,GAAI,SAAS,WAEE2Q,EAAU1B,SAAU,uBAoB/B0B,EAAUlH,YAAa,sBAGvB5K,IAAG4R,UAAWjI,IAAK,uCAlBnBmI,EAAUlP,SAAU,sBAGpB5C,IAAG4R,UAAWzQ,GAAI,qCAAqC,SAAEwH,GAC9CmJ,EAAUxD,GAAI3F,EAAM8e,SAAqD,IAAzC3V,EAAU4V,IAAK/e,EAAM8e,QAAS3Y,SAEjEgD,EAAUlH,YAAa,sBAGvB5K,IAAG4R,UAAWjI,IAAK,6CAcnCid,EAAazlB,GAAI,SAAS,WACtB,IAAK/C,eAAW,EAAKgF,SAAYrF,iBAAiBI,OAAOwpB,QAAU5pB,iBAAiBI,OAAO6E,MAAO,EAAKI,QAASukB,OAAQ,CAEpH7V,EAAUlH,YAAa,sBAIvB,IAAIkX,EAAQ,IAAIE,UAAM,CAClBtG,MAAa3d,iBAAiBc,KAAK+oB,kBAAkBlM,MACrDmM,SAAaV,wBAAoBppB,iBAAiBc,KAAK+oB,kBAAkBE,cAAe,WAAY,aACpG3F,QAAS,CACLC,OAASrkB,iBAAiBc,KAAKujB,OAC/BC,QAAStkB,iBAAiBc,KAAKwjB,WAIvCP,EAAMU,UAAU,CACZC,eAAgB,WACZX,EAAMY,QAEVC,UAAW,WACeb,EAAMiB,cACGjB,MAAMkB,IAAIb,QAAQE,QAGnCzf,SAAU,oBAAqB+C,KAAM,YAAY,IAG/DpE,cAAU,SAAU,CAChB,GAAM,EAAK6B,SACZ,WAEC0e,EAAM7K,UAGgB,WAAjB,EAAKvY,WACN,IAAIqpB,UAGiC,aAAhChqB,iBAAiBI,OAAOF,MAGzB,IAAIgE,WAIU,UAAjB,EAAKvD,UAAyC,WAAjB,EAAKA,UACnC,IAAIuD,UAIDlE,iBAAiBI,OAAOwb,SAC3B5b,iBAAiBI,OAAO8lB,QAAQC,aAAa1hB,UAAU,MAE5D,WAECsf,EAAM7K,UAENpZ,QAAQC,IAAK,2CAGS,WAAjB,EAAKY,UACN,IAAIqpB,UAGc,UAAjB,EAAKrpB,UAAyC,WAAjB,EAAKA,UACnC,IAAIuD,cAIhB4gB,UAAW,WACPf,EAAM7K,kBAMT7Y,eAAW,EAAKgF,SAEjBwjB,EAAahkB,SAAU,2CAGvBrB,cAAU,SAAU,CAChB,GAAM,EAAK6B,SACZ,WAEuB,WAAjB,EAAK1E,WACN,IAAIqpB,UAGiC,aAAhChqB,iBAAiBI,OAAOF,MAGzB,IAAIgE,WAIU,UAAjB,EAAKvD,UAAyC,WAAjB,EAAKA,UACnC,IAAIuD,aAET,WACCpE,QAAQC,IAAK,2CAGS,WAAjB,EAAKY,UACN,IAAIqpB,UAGc,UAAjB,EAAKrpB,UAAyC,WAAjB,EAAKA,UACnC,IAAIuD,eAMU,WAAjB,EAAKvD,UACN,IAAIqpB,UAGc,UAAjB,EAAKrpB,UACN,IAAIuD,cAMb6P,O,0lBC4Cf,Q,WAhQI,WAAapT,EAAUuG,EAAe9B,EAAUC,GAO5C,O,4FAPoD,SACpDvD,KAAKnB,SAAWA,EAChBmB,KAAKoF,cAAgBA,EACrBpF,KAAKsD,SAAWA,EAChBtD,KAAKuD,OAAWA,EAChBvD,KAAKsC,KAAWpE,iBAAiBI,OAAO6E,MAAOI,GAExCvD,KAAKmoB,mBAAoBtpB,EAAUyE,EAAUC,G,uDAWxD,SAAoB1E,EAAUyE,EAAUC,GAEpC,IAII6kB,EAJAC,GAAalB,mBAAennB,KAAKoF,cAAevG,EAAUyE,GAC9DtD,KAAKqoB,WAAaA,EASdD,EAJGpoB,KAAKsC,KAAK2kB,UAIEjnB,KAAKsC,KAAKJ,UAHVilB,mBAAennB,KAAKoF,cAAepF,KAAKsC,KAAKzD,SAAUmB,KAAKsC,KAAKgB,UAAWpB,SAM/FkmB,GAAeE,2BACXtoB,KAAKsC,KACL8lB,EACAlqB,iBAAiBI,OAAO6E,MAAOnD,KAAKuD,QAAS8L,MAC7C,GAUGrP,KAAKsC,KAAK2kB,WAEbmB,EAAanoB,SAASsoB,MAAMjnB,GAAI,SAAS,SAAEwH,GAEvC,IAAM0f,EAASroB,IAAG2I,EAAMgE,eAGxBsb,EAAanoB,SAASsoB,MAAMxd,YAAa,2BAEzCyd,EAAOzlB,SAAU,2BAGHylB,EAAOC,QAAQ,SACvB1lB,SAAU,cAGhB,IAAI2lB,EAAYF,EAAOtX,KAAM,eAGR/S,oBAAgB,cAAe,CAChD+F,OAASX,EACTolB,QAASD,IAIb,IAAIE,UAAarlB,EAAQmlB,MAKjC,IAAIzW,EAAY9R,IAAG,SAAU,CAAE,MAAS,mCACpC0oB,EAAY1oB,IAAG,SAAU,CAAE,MAAS,gBAExC8R,EAAUpP,OAAQulB,EAAa1e,KAAK3G,SAAU,yBAG9C,IAAI+lB,EAAa,IAAI3nB,UAAO,WAAY,CACpC6I,MAAO,QACPE,MAAO,QACPN,OAAQ,CACJtI,GAAKpD,iBAAiBc,KAAK6pB,OAAOE,eAClCjf,IAAK5L,iBAAiBc,KAAK6pB,OAAOG,iBAEtCjoB,aAAc7C,iBAAiBI,OAAO6E,MAAOI,GAASukB,SAGtDmB,EAAmBH,EAAWznB,iBA+JlC,OA9JIwnB,EAAOhmB,OAAQomB,GACfhX,EAAUpP,OAAQgmB,GAEf7oB,KAAKsC,KAAK2kB,WACbgC,EAAiB3nB,GAAI,0BAA0B,WAC3C,IAAI4nB,EAAWJ,EAAWtnB,WACtB2nB,GAAc,EAalB,GAVKD,IAGDC,GADiBC,kBAAc7lB,GACNuW,SAK7BgP,EAAWrnB,wBAEN0nB,EAAa,CAEd,IAAIE,EAAcH,EAAW,UAAY,QAGzC,IAAOA,GAAYhrB,iBAAiBI,OAAOwpB,OAAQ,CAG/C,IAAI7F,EAAQ,IAAIE,UAAM,CAClBtG,MAAa3d,iBAAiBc,KAAK+oB,kBAAkBlM,MACrDmM,SAAaV,wBAAoBppB,iBAAiBc,KAAK+oB,kBAAkBuB,cAAe,WAAY,aACpGhH,QAAS,CACLC,OAASrkB,iBAAiBc,KAAKujB,OAC/BC,QAAStkB,iBAAiBc,KAAKwjB,WAIvCP,EAAMU,UAAU,CACZC,eAAgB,WACZX,EAAMY,QAEVC,UAAW,WACP,IAUIyG,EAVkBtH,EAAMiB,cACGjB,MAAMkB,IAAIb,QAAQE,QAGnCzf,SAAU,oBAAqB+C,KAAM,YAAY,GAG/DgjB,EAAWrnB,wBAIX,IACI8nB,EAAmBnB,EAAa1e,KAAK8N,IAAI,GAAGgS,UAC9C,MAAQviB,KAEVvF,cAAU,qBAAsB,CAC5BW,QAAckB,EACd8lB,YAAcA,EACdI,wBAAyBrB,EAAasB,SACtCC,6BAA8BJ,IAC/B,WAGCtH,EAAM7K,UAGN,IAAI8Q,UACJ,IAAI9lB,UAGJ,IAAIwnB,UAGG1rB,iBAAiBI,OAAOwb,SAC3B5b,iBAAiBI,OAAO8lB,QAAQC,aAAa1hB,UAAU,MAE5D,WAEC3E,QAAQC,IAAK,+CAGbgkB,EAAM7K,UAGN0R,EAAWpmB,uBAGXomB,EAAWnmB,UAAYumB,GAAU,OAGzCW,SAAU,WAEN5H,EAAM7K,UAGN0R,EAAWnmB,UAAYumB,GAAU,GAGjCJ,EAAWpmB,wBAEfsgB,UAAW,WACPf,EAAM7K,iBAIb,CAED,IAAImS,EACJ,IACIA,EAAmBnB,EAAa1e,KAAK8N,IAAI,GAAGgS,UAC9C,MAAQviB,KAGVvF,cAAU,qBAAsB,CAC5BW,QAAckB,EACd8lB,YAAcA,EACdI,wBAAyBrB,EAAasB,SACtCC,6BAA8BJ,IAC/B,WAUCT,EAAWpmB,uBAGX,IAAIknB,aACL,WAEC5rB,QAAQC,IAAK,+CAGb6qB,EAAWpmB,uBAGXomB,EAAWnmB,UAAYumB,GAAU,YAMzCrc,YAAW,WAEPic,EAAWpmB,uBAGXomB,EAAWnmB,UAAU,GAAO,KAC7B,QAKRsP,O,obCvOf,Q,WAvCI,WAAahF,GAAuC,IAAxB6c,EAAwB,uDAAN,KAI1C,OAJgD,UAChD9pB,KAAKiN,cAAgBA,EACrBjN,KAAK8pB,gBAAkBA,EAEhB9pB,KAAK+pB,gB,kDAahB,WAEI,IAAI/nB,EAAc9D,iBAAiB6D,aAAc/B,KAAKiN,eAGlDgF,EAAc9R,IAAG,SAAU,CAAE,MAAS,sCACtC6pB,EAAc7pB,IAAG,SAAU,CAAE,MAAS,oBAY1C,OAVK5B,eAAWyD,GACZgoB,EAAIpjB,KAAM5E,EAAYC,MAGtB+nB,EAAIpjB,KAAM5G,KAAK8pB,iBAGnB7X,EAAUpP,OAAQmnB,GAGX/X,O,+2CCnBT2W,Y,WACL,qBAAarlB,EAAQ0mB,GAAU,kCAC9BjqB,KAAKuD,OAAWA,EAChBvD,KAAKiqB,SAAWA,EAChBjqB,KAAKsC,KAAUpE,iBAAiBI,OAAO6E,MAAOI,GAG9CvD,KAAKmO,OAAWnO,KAAKsC,KAAKiE,QAASvG,KAAKiqB,UAAW9b,OAEnDnO,KAAKsiB,QAAWtiB,KAAKsC,KAAKiE,QAASvG,KAAKiqB,UAAW3H,QAEnDtiB,KAAKkqB,SAOLlqB,KAAKmX,oBACLnX,KAAKmqB,cACLnqB,KAAK6W,iB,qDAGN,WAEC,IAAI5E,GAAY9T,6DAAgB,OAAQ,CACvC8C,GAAIjB,KAAKuD,SACP6mB,iBAECC,EAAclqB,8CAAG,SAAU,CAAE,MAAS,iBAGtCmiB,EAAUtiB,KAAKsqB,gBAGfnc,EAASnO,KAAKqZ,eAClBrZ,KAAKuqB,gBAAkBpc,EACvBkc,EAAYxnB,OAAQsL,GAGpB,IAAIqc,EAAmBrqB,8CAAG,SAAU,CAAE,MAAS,0BAC/CH,KAAKwqB,gBAAkBA,EACvBH,EAAYxnB,OAAQ2nB,GAGpBH,EAAYxnB,OAAQyf,GAGpBrQ,EAAUvI,KAAM2gB,K,0BAGjB,WAAc,WACTpY,EAAY9R,8CAAG,SAAU,CAAE,MAAS,wBAkExC,OA/DAA,mDAAQH,KAAKmO,QAAQ,SAAE9D,EAAOxF,GAE7B,IAAImD,EAAYnD,EAAMiJ,gBAAgB9F,UAGpB,YAAbA,GAEJnD,EAAMwU,eAIPxU,EAAMN,oBACN0N,EAAUpP,OAAQgC,EAAMxD,kBAGjB,CAAE,WAAY,QAAS,YAAa8H,SAAUnB,GAW9B,SAAbA,EAETnD,EAAMsJ,OAAOoB,SAAQ,SAAE1K,GAKH,aAHDA,EAAMiJ,gBAAgB9F,WAKvCnD,EAAM2H,WAAWlL,GAAI,SAAS,SAAEwH,GAET,IAAjBA,EAAM2hB,SAEV,EAAKC,WAAWjoB,QAAS,eAMP,YAAbuF,GAETnD,EAAM6V,UAAUnL,SAAQ,SAAE8K,EAAKhQ,GAE9BgQ,EAAI9K,SAAQ,SAAEpO,EAAOkJ,GAEpBlJ,EAAMqL,WAAWlL,GAAI,SAAS,SAAEwH,GAET,IAAjBA,EAAM2hB,SAEV,EAAKC,WAAWjoB,QAAS,kBAtC7BoC,EAAM2H,WAAWlL,GAAI,SAAS,SAAEwH,GAET,IAAjBA,EAAM2hB,SAEV,EAAKC,WAAWjoB,QAAS,eA0CtBwP,I,2BAGR,SAAAqY,gBAAe,gBAEVrY,UAAiB9R,8CAAG,SAAU,CAAE,MAAS,0BAGzCwqB,iBAAmBxqB,8CAAG,SAAU,CAAE,MAAS,oCAC9CyqB,iBAAmBzqB,8CAAG,SAAU,CAAE,MAAS,oCAExCuqB,WAAkBvqB,8CAAG,SAAU,CAAE,MAAS,6BAC7C0qB,aAAkB1qB,8CAAG,SAAU,CAAE,MAAS,+BAAgCyG,KAAM1I,iBAAiBc,KAAKujB,QA2MvG,MAzM2B,WAAtBviB,KAAKsC,KAAKzD,UACd6rB,WAAW9jB,KAAM1I,iBAAiBc,KAAK8rB,MAGb,UAAtB9qB,KAAKsC,KAAKzD,UACd6rB,WAAW9jB,KAAM1I,iBAAiBc,KAAK8rB,MAGP,WAAtB9qB,KAAKsC,KAAKzD,UACX6rB,WAAW9jB,KAAM1I,iBAAiBc,KAAK8rB,MAG3C9qB,KAAK0qB,WAAaA,WAExBC,iBAAiB9nB,OAAQ6nB,YACzBC,iBAAiB9nB,OAAQgoB,cAGzB1qB,mDAAQH,KAAKsiB,SAAS,SAAEjY,MAAOwW,QAE9B,IAAMkK,eAAiB5qB,8CAAG,SAAU,CAAE,MAAS,YAAayG,KAAMia,OAAOja,OAGpErI,wDAAWsiB,OAAOmK,cAEtBD,eAAehoB,SAAU8d,OAAOmK,aAIjC,IAAIC,UAAY,aAChB,IAAK1sB,wDAAWsiB,OAAOqK,UAEtB,IAECD,UAAYE,KAAK,IAAD,OAAOtK,OAAOqK,SAAS1Z,QAAS,WAAY,IAAKA,QAAS,aAAa,IAAKrC,OAA5E,MACf,MAAQlI,GAAKjJ,QAAQC,IAAKgJ,GAAKjJ,QAAQC,IAAK4iB,OAAOqK,UAItDH,eAAezpB,GAAI,SAAS,WAWzB,IAEI8pB,EAXNH,UAECF,eAEA,CACCzoB,KAAW,OAAKA,KAChBsL,QAAWC,qEAAwB,OAAKtK,UAKpC6nB,EAAU,IAGT7sB,wDAAWsiB,OAAOuK,WAEjBvK,OAAOuK,QAAQjiB,SAAU,WAE7BiiB,EAAQjJ,MAAQA,gDAGZtB,OAAOuK,QAAQjiB,SAAU,cAE7BiiB,EAAQC,SAAWA,oDAKdD,OAMVR,iBAAiB/nB,OAAQkoB,mBAG1B9Y,UAAUpP,OAAQ8nB,kBAClB1Y,UAAUpP,OAAQ+nB,kBAElBF,WAAWppB,GAAI,SAAS,WAKd,IAHqBgqB,+DAAoB,OAAKf,iBAG1BzQ,QAAS,CAE5B4Q,WAAW3nB,SAAU,sCAMrB,IASIwmB,EATAhmB,EAAW,OAAKA,OACnByB,EAAc,OAAKilB,SACnBtb,EAAc,OAAK4c,iBAIdnD,GAAeE,oEAAuB,OAAKhmB,KAAM,OAAKA,KAAK+M,KAAKnN,SAAU/B,qDAAS,GAAI,OAAKmC,KAAK+M,MAAMxB,qEAAwB,OAAKtK,UAI1I,IACCgmB,EAAmBnB,EAAa1e,KAAK8N,IAAI,GAAGgS,UAC3C,MAAQviB,KAEVvF,uDAAU,SAAU,CACb6B,OAAcA,EACdyB,WAAcA,EACd2J,YAAcA,EACd8a,wBAAyBrB,EAAasB,SACtCC,6BAA8BJ,IAC/B,SAAEpnB,GAEJ,OAAKgM,OAAOoB,SAAQ,SAAEpO,GACrBA,EAAME,iBAAiBoB,QAAS,YAGH,WAAtB,OAAKH,KAAKzD,UACX,IAAIqpB,kDAGmB,UAAtB,OAAK5lB,KAAKzD,UAA8C,WAAtB,OAAKyD,KAAKzD,UAC7C,IAAIuD,iDAMvB,IAAM0X,EAAU5b,iBAAiBI,OAAO6E,MAAO,OAAKb,KAAKrB,IAAK6Y,QAG5C9W,GAAQ7E,6DAAgB,OAAQ,CACrC8C,GAAI,OAAKqB,KAAKrB,KAItB6Y,EAEG5b,iBAAiBI,OAAOwpB,QAGvB,OAAKxlB,KAAKwlB,QAEhB9kB,EAAMV,KACJC,KAAM,uCACNuD,KAAM,WAAW,GACjBrD,QAAS,UAObO,EAAMV,KACJC,KAAM,sDACNC,QACAC,QAAS,YAEE,SAAEN,GACJnE,QAAQC,IAAK,wDAGE,WAAtB,OAAKqE,KAAKzD,UACd,IAAIqpB,kDAGsB,UAAtB,OAAK5lB,KAAKzD,UAA8C,WAAtB,OAAKyD,KAAKzD,UAChD,IAAIuD,iDAIL,KAECjE,6DAAgB,OAAQ,CACvB8C,GAAI,OAAKsC,SAGTjB,KAEAC,KAND,8CAM+CyC,EAN/C,OAQCvC,QAAS,SACT,MAAQwE,YAKb4jB,aAAavpB,GAAI,SAAS,WAEE,WAAtB,OAAKgB,KAAKzD,UACd,IAAIqpB,kDAGsB,UAAtB,OAAK5lB,KAAKzD,UAA8C,WAAtB,OAAKyD,KAAKzD,UAChD,IAAIuD,oDAIC6P,Y,+BAGR,WACC9R,mDAAQH,KAAKmO,QAAQ,SAAE9D,EAAOxF,GAE7BA,EAAMsS,yB,yBAIR,WACChX,mDAAQH,KAAKmO,QAAQ,SAAE9D,EAAOxF,GAEW,YAAnCA,EAAMiJ,gBAAgB9F,WAE1BnD,EAAMslB,mB,4BAKT,WACChqB,mDAAQH,KAAKmO,QAAQ,SAAE9D,EAAOxF,GAE7BA,EAAMgS,sB,4BAUR,WACC,IAAI1U,EAAW,GACdqpB,GAAY,EACZC,GAAc,EA8Cf,OA5CAtrB,mDAAQH,KAAKmO,QAAQ,SAAE9D,EAAOxF,GAC7B,IAAI5D,EAAQ4D,EAAMiJ,gBAAgB9I,WACjCyB,EAAQ5B,EAAMrD,WAEf,GAAK,CAAE,SAAU,SAAU2H,SAAUtE,EAAMiJ,gBAAgB9F,WAAa,CAOvE,GALAwjB,GAAY,EAKP3mB,EAAMiJ,gBAAgBjI,uBAC1B,IACCY,EAAQ2E,KAAKmP,UAAW9T,GACvB,MAAQQ,GACTjJ,QAAQC,IAAKgJ,GAKf9E,GAAUoG,uDAAU,cAAe,CAAEtH,KAAW4D,EAAM6mB,mBAGtD,IAAMnkB,EAAc1C,EAAMkJ,uBACZ,0BAATtH,IACJtE,GAAUoG,uDAAU,YAAa,CAAEtH,KAAWsG,OAGH,YAAnC1C,EAAMiJ,gBAAgB9F,YAE/ByjB,GAAc,EAGdhlB,EAAQ2E,KAAKmP,UAAW9T,IAGzBtE,EAAUlB,GAAOwF,KAGXglB,GAAiBD,GAA+C,GAAlClM,OAAOqM,KAAMxpB,GAAW8M,SAE5D9M,EAAWA,EAAUmd,OAAOqM,KAAMxpB,GAAY,KAGxCA,M,eAIT,8C,6YCnWA,Q,WA/EC,aAA2B,IAAdigB,EAAc,uDAAJ,GAAI,UAE1BpiB,KAAKoiB,QAAUA,E,4CAGhB,WAEC,IAAIA,GAAUwJ,gBAAY5rB,KAAKoiB,SAK/B,OAHAA,EAAUpiB,KAAK6rB,oBAAqBzJ,GAC1BpiB,KAAK8rB,aAAc1J,K,iCAK9B,SAAqBA,GAWpB,OAJAA,GAHAA,GADAA,EAAUA,EAAQ5Q,QAAS,8CAA+C,0BACxDA,QAAS,4CAA6C,kBAGtDA,QAAS,iCAAkC,wBAC3CA,QAAS,2BAA4B,iB,0BAMxD,SAAc4Q,GA8Cb,OA5CUA,EAAQ5Q,QAAS,kGAAkG,SAAUua,EAAYC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,IACnK/tB,eAAW+tB,KACjBA,EAAK,IAGNP,EAAaC,EAEb,IAAIO,EAAWN,EACdO,EAAWN,EAAG1E,cACdiF,EAAQN,EACRtQ,EAAUyQ,EAEX,IAAOG,EAAK,CAQX,GAPOD,IAENA,EAASD,EAAS/E,cAAchW,QAAS,QAAS,MAGnDib,EAAM,IAAMD,IAEPT,EAAWhb,OAAQ,cAAiB,GAKxC,OAAOgb,EAHPU,EAAM,GAQR,IAAIC,EAAS,aADbD,EAAME,UAAWF,EAAK,MAAM,IACK,oBAUjC,MARe,KAAV5Q,GAA0B,OAAVA,IACpBA,EAAQA,EAAMrK,QAAS,KAAM,UAE7Bkb,GAAU,YADV7Q,EAAQ8Q,UAAW9Q,EAAO,MAAM,IACD,KAGhC6Q,EAAU,IAAMH,EAAW,e,kfC0D9B,Q,WAtHI,WAAa1tB,I,4FAAU,SACnBmB,KAAKnB,SAAWA,EAEXmB,KAAK4sB,6BACN5sB,KAAK6sB,e,8DAIb,WAKI,IAAI3C,GAAS,EAEb,GAAsB,WAAjBlqB,KAAKnB,SAAuB,CAE7B,IAAIiuB,GAAgBnuB,iBAAa,MAAO,CACpCC,OAAQ,CACJC,SAAU,cAKEO,aAAS0tB,KAGHvuB,eAAWL,iBAAiBM,KAAUN,iBAAiBM,IAA0C,aAAhCN,iBAAiBI,OAAOF,OAC/G8rB,GAAS,GAIjB,GAAsB,UAAjBlqB,KAAKnB,SAAsB,CAE5B,IAAIiuB,GAAgBnuB,iBAAa,MAAO,CACpCC,OAAQ,CACJC,SAAU,cAKCO,aAAS0tB,KAIxB5C,GAAS,GAIjB,OAAOA,I,0BAGX,WAAc,WAENjY,EAAa9R,IAAG,SAAU,CAAE,MAAS,oBAGrC4sB,EAAa5sB,IAAG,SAAU,CAAE,MAAS,+BAQzC,IALsB,UAAjBH,KAAKnB,UAA2C,WAAjBmB,KAAKnB,UAAyD,QAAhCX,iBAAiBI,OAAOF,OAEtF6T,EAAUpP,OAAQkqB,GAGA,WAAjB/sB,KAAKnB,WAE+B,QAAhCX,iBAAiBI,OAAOF,MAEzB2uB,EAAWnmB,KAAM1I,iBAAiBc,KAAKyD,QAAQsqB,YAId,aAAhC7uB,iBAAiBI,OAAOF,MAAqB,CAE9C,IAAI4uB,EAAmBhtB,KAAKitB,wBAC5Bhb,EAAUpP,OAAQmqB,GAIJ,UAAjBhtB,KAAKnB,UAENkuB,EAAWnmB,KAAM1I,iBAAiBc,KAAKC,OAAO8tB,YAI1B,WAAjB/sB,KAAKnB,UAA4C,UAAjBmB,KAAKnB,UAExCkuB,EAAWzrB,GAAI,SAAS,WAGpB,IAAIkc,UAAyB,EAAK3e,cAK5BV,oBAAgB,UAAW,CACrCC,KAAM4B,KAAKnB,WAGPgE,OAAQoP,K,mCAGpB,WAWI,OAVc9R,IAAE,4DAAD,OAEJjC,iBAAiBc,KAAKkuB,WAAWC,wBAF7B,sBAEmE/N,wBAAoB,gEAAiE,CACvJ,WAAe,oBACf,WAAe,+BACf,YAAe,eALhB,6BAMsBlhB,iBAAiBc,KAAKqgB,UAN5C,qG,2iBC2BvB,Q,WArII,WAAaxgB,EAAUsE,GAAO,Y,4FAAA,SAC1BhD,SAAQgD,GAAO,SAAEI,EAAQjB,GACrB,GAAKzD,GAAYyD,EAAKzD,SAAU,CAE5B,IAAIyD,EAAO,EAAK8qB,WAAY7pB,IAGdpF,oBAAgB,UAAW,CACrCC,KAAMS,IAGFgE,OAAQP,O,+CAK5B,SAAYiB,GAER,IAAIjB,EAAOpE,iBAAiBI,OAAO6E,MAAOI,GAGtC0O,EAAY9R,IAAG,SAAU,CACzB,MAAW,OACX,UAAWoD,IAGVjB,EAAK2kB,WACNhV,EAAUlP,SAAU,iBAGnBT,EAAK+M,KAAK4Q,YACXhO,EAAUlP,SAAU,gBAIjB3D,aAASkD,EAAK+qB,aACjB/qB,EAAK+qB,UAAY/qB,EAAK+qB,UAAU7b,QAAS,eAAgBjO,GAGzD0O,EAAU5K,QAAS/E,EAAK+qB,YAI5B,IAAI3P,EAAS1d,KAAKkD,aACdZ,EAAKc,gBACLd,EAAKzD,SACLyD,EAAKgB,SACLC,GAGA+pB,EAASttB,KAAKutB,aAAcjrB,GAUhC,OARA2P,EAAUpP,OAAQ6a,GAClBzL,EAAUpP,OAAQyqB,GAOXrb,I,0BAcX,SAAc7O,EAAiBvE,EAAUyE,EAAUC,GAC/C,IAAI0O,EAAY9R,IAAG,UACf0b,EAAY1b,IAAG,SAAU,CAAE,MAAS,yBAGpCmC,EAAOpE,iBAAiBI,OAAO6E,MAAOI,GAQ1C,GAJKjB,EAAK2kB,YACN7jB,EAAkB,MAGL,UAAZvE,IAAwBN,eAAWL,iBAAiBM,KAAQN,iBAAiBM,GAAK,CACnF,IAAIkmB,EAAW,IAAI8I,UAAiB3uB,EAAUuE,EAAiBE,EAAUC,GACzE0O,EAAUpP,OAAQ6hB,GAGtB,IAAIhmB,EAAU,IAAIgF,UAAgB7E,EAAUuE,EAAiBE,EAAUC,GACvE0O,EAAUpP,OAAQnE,GAElB,IAAIuf,EAAU,IAAIra,UAAgBR,GAClC6O,EAAUpP,OAAQob,GAGlB,IAAI6L,EAAkBxnB,EAAKwnB,gBAEvB2D,EAAU,IAAI3pB,UAAeV,EAAiB0mB,GAClDjO,EAAMhZ,OAAQ4qB,GAEd,IAAIC,EAAgB,IAAI1pB,UAAoBnF,EAAUuE,EAAiBE,EAAUC,GACjFsY,EAAMhZ,OAAQ6qB,GACdzb,EAAUpP,OAAQgZ,GAElB,IAAI8B,EAAcxd,IAAG,SAAU,CAAE,MAAS,kBAG1C,OAFA8R,EAAUpP,OAAQ8a,GAEX1L,I,0BAUX,SAAc3P,GACV,IAAI2P,EAOJ,OALK3P,EAAK2kB,YACNhV,EAAY9R,IAAG,SAAU,CAAE,MAAS,iBAC1ByG,KAAM1I,iBAAiBc,KAAK2uB,aAGnC1b,O,sVCrGf,Q,WAlCC,WAAapT,EAAU+uB,EAAYC,I,4FAAe,SACjD7tB,KAAKnB,SAAaA,EAClBmB,KAAK4tB,WAAcA,EACnB5tB,KAAK6tB,cAAiBA,EAGhB7tB,KAAKkqB,S,2CAGZ,WAEO,IAAI4D,GAAU3vB,oBAAgB,UAAW,CACrCC,KAAM4B,KAAKnB,WAIXyuB,EAASttB,KAAKutB,eAGlBO,EAAQjrB,OAAQyqB,K,0BAGvB,WACC,IAAIrb,EAAY9R,IAAG,SAAU,CAAE,MAAS,oBAOxC,OALK5B,eAAWyB,KAAK4tB,aACpB3b,EAAUlP,UAAUwF,cAAU,sBAAuB,CAAEvI,KAAK4tB,cAG7D3b,EAAUvI,KAAM1J,KAAK6tB,eACd5b,O,4aCmUT,Q,WAzUC,WAAamQ,GAAsB,IAAb2L,EAAa,uDAAJ,GA4C9B,OA5CkC,UAElC/tB,KAAKC,SAAW,CACfgS,UAAW,KACX+b,mBAAoB,KACpB/L,MAAO,CACNhQ,UAAW,KACXkR,IAAK,CACJlR,UAAW,KACX4J,MAAO,KACPmM,QAAS,KACT1F,QAAS,CACRrQ,UAAW,KACXsQ,OAAQ,KACRC,QAAS,SAObxiB,KAAKC,SAASgS,UAAY9R,IAAG,QAG7BH,KAAKiuB,WAAY,EAGjBjuB,KAAK+tB,OAAS5tB,YAAU,EAAM,CAC7B+tB,aAAc,IACdzL,KAAM,SACN0L,cAAc,GACZJ,GAGH/tB,KAAKoiB,QAAUjiB,WAAU,GAAI,CAC5BmiB,QAAS,CACRC,OAAQrkB,iBAAiBc,KAAKujB,SAE7BH,GAGHpiB,KAAKkqB,SAGElqB,K,2CASR,WACC,IA8BIwhB,EAkBA4M,EAhDAJ,EAAqB7tB,IAAG,SAAU,CAAE,MAAS,QAC7C8hB,EAAQ9hB,IAAG,SAAU,CAAE,MAAS,UAChCkuB,EAAWluB,IAAG,SAAU,CAAE,MAAS,eAmBvC,IAhBK5B,eAAWyB,KAAK+tB,OAAOtL,OAAU,CAAE,QAAS,SAAU,QAAS,eAAgBtZ,SAAUnJ,KAAK+tB,OAAOtL,OAEzGR,EAAMlf,SAAN,iBAA2B/C,KAAK+tB,OAAOtL,QAInClkB,eAAWyB,KAAK+tB,OAAOnc,cAC3BqQ,EAAMlf,SAAN,iBAA2B/C,KAAK+tB,OAAOnc,cAIxC5R,KAAKC,SAAS+tB,mBAAqBA,EACnChuB,KAAKC,SAASgiB,MAAMhQ,UAAYgQ,EAChCjiB,KAAKC,SAASgiB,MAAMkB,IAAIlR,UAAYoc,GAG/B9vB,eAAWyB,KAAKoiB,QAAQvG,OAAS,CACrC,IAAIyS,EAAanuB,IAAG,SAAU,CAAE,MAAS,iBAAkBuJ,KAAM1J,KAAKoiB,QAAQvG,OAC9EwS,EAASxrB,OAAQyrB,GAGjBtuB,KAAKC,SAASgiB,MAAMkB,IAAItH,MAAQyS,EAKjC,IAAK/vB,eAAWyB,KAAKoiB,QAAQA,SAAW,CACvCZ,EAAerhB,IAAG,SAAU,CAAE,MAAS,mBAGvC,IACCqhB,EAAa3e,OAAQ7C,KAAKoiB,QAAQA,SACjC,MAAQnb,GACTua,EAAa9X,KAAM1J,KAAKoiB,QAAQA,SAGjCiM,EAASxrB,OAAQ2e,GAGjBxhB,KAAKC,SAASgiB,MAAMkB,IAAIf,QAAUZ,GAK9BjjB,eAAWyB,KAAKoiB,QAAQ4F,WAC5BoG,EAAejuB,IAAG,SAAU,CAAE,MAAS,mBAAoBuJ,KAAM1J,KAAKoiB,QAAQ4F,SAG9EhoB,KAAKC,SAASgiB,MAAMkB,IAAI6E,QAAUoG,IAI9B7vB,eAAWyB,KAAK+tB,OAAOI,eAAkBnuB,KAAK+tB,OAAOI,eACpD5vB,eAAWyB,KAAKoiB,QAAQ4F,UAC5BqG,EAASxrB,OAAQurB,IAGb7vB,eAAWyB,KAAKoiB,QAAQA,UAC5BiM,EAASxrB,OAAQ2e,MAIbjjB,eAAWyB,KAAKoiB,QAAQA,UAC5BiM,EAASxrB,OAAQ2e,IAGbjjB,eAAWyB,KAAKoiB,QAAQ4F,UAC5BqG,EAASxrB,OAAQurB,IAKnB,IAAIG,EAAepuB,IAAG,SAAU,CAAE,MAAS,mBACvC0qB,EAAe1qB,IAAG,YAAa,CAAE,MAAS,+BAAgCuJ,KAAM1J,KAAKoiB,QAAQE,QAAQC,QAOzG,GANAgM,EAAa1rB,OAAQgoB,GAGrB7qB,KAAKC,SAASgiB,MAAMkB,IAAIb,QAAQrQ,UAAYsc,EAC5CvuB,KAAKC,SAASgiB,MAAMkB,IAAIb,QAAQC,OAASsI,GAEpCtsB,eAAWyB,KAAKoiB,QAAQE,QAAQE,SAAW,CAC/C,IAAIS,EAAgB9iB,IAAG,YAAa,CAAE,MAAS,6BAA8BuJ,KAAM1J,KAAKoiB,QAAQE,QAAQE,SACxG+L,EAAa1rB,OAAQogB,GAGrBjjB,KAAKC,SAASgiB,MAAMkB,IAAIb,QAAQE,QAAUS,EAG3CoL,EAASxrB,OAAQ0rB,GAGjBtM,EAAMpf,OAAQwrB,GACdL,EAAmBnrB,OAAQof,GAC3BjiB,KAAKC,SAASgS,UAAUpP,OAAQmrB,GAGhC7tB,IAAG,QAAS4C,SAAU,wBAGtB/C,KAAKwuB,S,uBASN,SAAWC,GAAQ,WACdC,EAAgB,aAGpB1uB,KAAKyuB,OAAS,CACb7L,gBAAgBrkB,eAAWkwB,EAAO7L,gBAAoB6L,EAAO7L,eAAiB8L,EAC9EC,WAAapwB,eAAWkwB,EAAOE,WAAiBF,EAAOE,UAAcD,EACrE1L,WAAazkB,eAAWkwB,EAAOzL,WAAiByL,EAAOzL,UAAc0L,EACrE5L,WAAavkB,eAAWkwB,EAAO3L,WAAgB2L,EAAO3L,UAAc4L,EACpE7E,UAAatrB,eAAWkwB,EAAO5E,UAAgB4E,EAAO5E,SAAa6E,IAG7DnwB,eAAWkwB,EAAO5E,YACxB7pB,KAAKyuB,OAAO5E,SAAW,WAGtB,EAAK+E,SAKP5uB,KAAKyuB,OAAO7L,mB,qBASb,WACC,IAAIiM,EAAY7uB,KAGhBA,KAAK8uB,SAGA9uB,KAAKiuB,UAETjuB,KAAK4uB,MAAK,WACTC,EAAU5uB,SAAS+tB,mBAAmBvW,YAIvCoX,EAAU5uB,SAAS+tB,mBAAmBvW,SAIvCtX,IAAG,QAAS4K,YAAa,0B,kBAS1B,WACC,IAAI8jB,EAAY7uB,MAGXzB,eAAWyB,KAAKC,SAASgiB,MAAMkB,IAAIb,QAAQC,SAC/CviB,KAAKC,SAASgiB,MAAMkB,IAAIb,QAAQC,OAAOjhB,GAAI,SAAS,WACnDutB,EAAUJ,OAAO5E,eAKdtrB,eAAWyB,KAAKC,SAASgiB,MAAMkB,IAAIb,QAAQE,UAC/CxiB,KAAKC,SAASgiB,MAAMkB,IAAIb,QAAQE,QAAQlhB,GAAI,SAAS,WACpDutB,EAAUJ,OAAO3L,iB,oBAWpB,WACC9iB,KAAKC,SAASgiB,MAAMkB,IAAIb,QAAQC,OAAOuM,OAAQ,SAC/C9uB,KAAKC,SAASgiB,MAAMkB,IAAIb,QAAQE,QAAQsM,OAAQ,W,kBAWjD,WAAuB,IAAjBC,EAAiB,uDAAN,KACZF,EAAY7uB,KAYhB+uB,GAPKxwB,eAAWwwB,GACPA,EAGA/uB,KAAKyuB,OAAOE,UAMrB3uB,KAAKiuB,WAAY,EAGjBjuB,KAAKC,SAASgiB,MAAMhQ,UAAU+c,OAAQH,EAAUd,OAAOG,aAAca,K,kBAWtE,WAAuB,IAAjBA,EAAiB,uDAAN,KACZF,EAAY7uB,KAYhB+uB,GAPKxwB,eAAWwwB,GACPA,EAGA/uB,KAAKyuB,OAAOzL,UAMrBhjB,KAAKiuB,WAAY,EAGjBjuB,KAAKC,SAASgiB,MAAMhQ,UAAUgd,QAASJ,EAAUd,OAAOG,aAAca,GAGtE5uB,IAAG,QAAS4K,YAAa,0B,yBAW1B,WACC,OAAO/K,KAAKC,c,0ZCuKd,Q,WA3fC,c,4FAAa,SAEZD,KAAKC,SAAW,CACf6tB,QAAS3tB,IAAG,iCACZ+uB,aAAc,CACbC,SAAW,KACXC,UAAa,KACb1E,WAAa,KACbG,aAAe,KACfxlB,SAAY,8BAEbgqB,eAAgB,CACfF,SAAW,KACXC,UAAa,KACb1E,WAAa,KACbG,aAAe,KACfxlB,SAAY,kCAEbuE,OAAQ,MAIT5J,KAAKsvB,gB,kDAGN,WACC,IAAIrd,EAAqB9R,IAAG,SAAU,CAAEc,GAAI,wBAC3CmhB,EAAqBjiB,IAAG,SAAU,CAAEovB,MAAO,qBAC3CC,EAAqBrvB,IAAG,SAAU,CAAEovB,MAAO,oBAG5C,GAAqC,aAAhCrxB,iBAAiBI,OAAOF,KAAqB,CAEjD,IAAIqxB,EAAmBtvB,IAAG,SAAU,CAAEovB,MAAO,gBAC5CG,EAAqBvvB,IAAG,SAAU,CAAEovB,MAAO,yBAC3CI,EAAqBxvB,IAAG,UAAW,CAAEovB,MAAO,sBAC5CK,EAAqBzvB,IAAG,OAAQ,CAAEovB,MAAO,8BACzCM,EAAqB1vB,IAAG,UAAW,CAAEovB,MAAO,sBAAuB3oB,KAAM1I,iBAAiBc,KAAKolB,QAAQ8K,cAGxGhxB,iBAAiBI,OAAO8lB,QAAQ8K,cAAgE,GAAjDhxB,iBAAiBI,OAAO8lB,QAAQ8K,aAAqB,GAAKhxB,iBAAiBI,OAAO8lB,QAAQ8K,aACzI,IAAIY,GAAkB1wB,aAASlB,iBAAiBI,OAAO8lB,QAAQ8K,cAAiBhxB,iBAAiBc,KAAKolB,QAAQ2L,UAAY7xB,iBAAiBI,OAAO8lB,QAAQ8K,aAEtJc,EAAqB7vB,IAAG,UAAW,CAAEovB,MAAO,uBAAwB3oB,KAAMkpB,GAC7EG,EAAqB9vB,IAAG,UAAW,CAAEovB,MAAO,sBAAuB3oB,KAAM1I,iBAAiBc,KAAKkxB,MAC/FC,EAAqBhwB,IAAG,SAAU,CAAEovB,MAAO,wBAC3Ca,EAAqBjwB,IAAG,SAAU,CAAEovB,MAAO,0BAE5CvvB,KAAKC,SAASivB,aAAaC,SAAYc,EACvCjwB,KAAKC,SAASivB,aAAaE,UAAYe,EAEvC,IAAIE,EAAoB,IAAIlvB,UAAO,MAAO,CACzCJ,aAAc7C,iBAAiBI,OAAO8lB,QAAQ8K,aAC9CjnB,YAAc/J,iBAAiBc,KAAKolB,QAAQkM,WAC5CjoB,YAAcnK,iBAAiBc,KAAKolB,QAAQ2L,YAC1C,GAAM,SAAUtpB,EAAO8pB,GAGzB,IAAIpuB,EAAW,CACd2X,SAAS,EACTC,QAAS,IAYV,OARKtT,GAAS,EACbtE,EAAS2X,SAAU,EAGnB3X,EAAS4X,QAAU7b,iBAAiBc,KAAKolB,QAAQoM,YAI3CruB,KAGRnC,KAAKywB,WAAiBJ,EAEtB,IAAIK,EAAqBvwB,IAAG,SAAU,CAAEovB,MAAO,yBAC9CoB,EAAqBxwB,IAAG,SAAU,CAAEovB,MAAO,6BAA8B3oB,KAAM1I,iBAAiBc,KAAK8rB,MACrG8F,EAAqBzwB,IAAG,SAAU,CAAEovB,MAAO,+BAAgC3oB,KAAM1I,iBAAiBc,KAAKujB,QAExGviB,KAAKC,SAASivB,aAAaxE,WAAeiG,EAC1C3wB,KAAKC,SAASivB,aAAarE,aAAe+F,EAE1CF,EAAgB7tB,OAAQ8tB,GACxBD,EAAgB7tB,OAAQ+tB,GAExBR,EAAkBvtB,OAAQwtB,EAAchvB,kBACxC+uB,EAAkBvtB,OAAQ6tB,GAC1BP,EAAettB,OAAQutB,GAEvBT,EAAgB9sB,OAAQ+sB,GACxBF,EAAgB7sB,OAAQ8sB,GACxBD,EAAgB7sB,OAAQgtB,GACxBH,EAAgB7sB,OAAQmtB,GACxBN,EAAgB7sB,OAAQotB,GAExBR,EAAS5sB,OAAQ6sB,GACjBD,EAAS5sB,OAAQstB,GAEjB/N,EAAQvf,OAAQ4sB,GAGjB,IAAIJ,EAAiBrvB,KAAKqvB,iBAC1BjN,EAAQvf,OAAQwsB,GAGhB,IAAIwB,EAAuB1wB,IAAG,SAAW,CAAEovB,MAAO,gBACjDuB,EAAuB3wB,IAAG,SAAW,CAAEovB,MAAO,yBAC9CwB,EAAuB5wB,IAAG,UAAW,CAAEovB,MAAO,sBAC9CyB,EAAuB7wB,IAAG,OAAW,CAAEovB,MAAO,8BAC9C0B,EAAuB9wB,IAAG,UAAW,CAAEovB,MAAO,sBAAuB3oB,KAAM1I,iBAAiBc,KAAKolB,QAAQ8I,YACzGgE,EAAuB/wB,IAAG,UAAW,CAAEovB,MAAO,uBAC9C4B,EAAuBhxB,IAAE,sBAAD,QACXif,wBAAoB,gEAAiE,CAC7E,WAAe,oBACf,WAAe,kBACf,YAAe,8BAJZ,yHAQY,QAAhClhB,iBAAiBI,OAAOF,MAC5B8yB,EAAmBtqB,KAAM1I,iBAAiBc,KAAKkuB,WAAWkE,gBAGtB,aAAhClzB,iBAAiBI,OAAOF,MAC5B8yB,EAAmBtqB,KAAM1I,iBAAiBc,KAAKkuB,WAAWmE,qBAG3DN,EAAqBluB,OAAQmuB,GAC7BF,EAAqBjuB,OAAQkuB,GAC7BD,EAAqBjuB,OAAQouB,GAC7BH,EAAqBjuB,OAAQquB,GAC7BJ,EAAqBjuB,OAAQsuB,GAC7BN,EAAchuB,OAAQiuB,GAEtB1O,EAAQvf,OAAQguB,GAGhB,IAAIS,EAAkBnxB,IAAG,SAAU,CAAEovB,MAAO,gBAC3CgC,EAAqBpxB,IAAG,SAAU,CAAEovB,MAAO,yBAC3CiC,EAAqBrxB,IAAG,UAAW,CAAEovB,MAAO,sBAC5CkC,EAAqBtxB,IAAG,OAAQ,CAAEovB,MAAO,kCACzCmC,EAAqBvxB,IAAG,UAAW,CAAEovB,MAAO,sBAAuB3oB,KAAM1I,iBAAiBc,KAAKolB,QAAQuN,WACvGC,EAAqBzxB,IAAG,UAAW,CAAEovB,MAAO,uBAAwB3oB,KAAM1I,iBAAiBI,OAAO8lB,QAAQuN,WAE3GH,EAAkB3uB,OAAQ4uB,GAC1BF,EAAkB1uB,OAAQ2uB,GAC1BD,EAAkB1uB,OAAQ6uB,GAC1BH,EAAkB1uB,OAAQ+uB,GAC1BN,EAAWzuB,OAAQ0uB,GAEnBnP,EAAQvf,OAAQyuB,GAGhB,IAAIO,EAAqB1xB,IAAG,SAAU,CAAEovB,MAAO,gBAC9CuC,EAAwB3xB,IAAG,SAAU,CAAEovB,MAAO,yBAC9CwC,EAAwB5xB,IAAG,OAAQ,CAAEovB,MAAO,qDAAsDyC,KAAM9zB,iBAAiBI,OAAO8lB,QAAQ6N,YAAYzgB,QAAS,SAAU,OAAS5K,KAAM1I,iBAAiBc,KAAKolB,QAAQ8N,YAErNJ,EAAqBjvB,OAAQkvB,GAC7BF,EAAchvB,OAAQivB,GAEtB1P,EAAQvf,OAAQgvB,GAIhB,IAAIM,EAAqBhyB,IAAG,SAAU,CAAEovB,MAAO,kCAC9C6C,EAAqBjyB,IAAG,SAAU,CAAEovB,MAAO,yBAC3C8C,EAAqBlyB,IAAG,OAAQ,CAAEovB,MAAO,gCAAiCyC,KAAM9zB,iBAAiBI,OAAO8lB,QAAQkO,YAAY9gB,QAAS,SAAU,OAAS5K,KAAM1I,iBAAiBc,KAAK4f,QAAQ0T,aAC5LC,EAAqBpyB,IAAG,SAAU,CAAEovB,MAAO,0BAExCiD,EAAqB,IAAIrxB,UAAO,WAAY,CACtC6I,MAAO,YACPE,MAAO,QACPN,OAAQ,CACJtI,GAAKpD,iBAAiBc,KAAK6pB,OAAO4J,WAClC3oB,IAAK5L,iBAAiBc,KAAK6pB,OAAO6J,aAEtC3xB,aAAc7C,iBAAiBI,OAAOwpB,SAIhD5pB,iBAAiBI,OAAO8lB,QAAQC,aAAemO,EAE/C,IAAIG,EAAwBH,EAAmBnxB,iBAC/CrB,KAAKwyB,mBAAuBA,EAE5BxyB,KAAKC,SAAS2J,OAAW+oB,EAEzBP,EAAcvvB,OAAQwvB,GACtBE,EAAe1vB,OAAQ8vB,GACvBR,EAAUtvB,OAAQuvB,GAClBD,EAAUtvB,OAAQ0vB,GAElB/C,EAAO3sB,OAAQsvB,GAGflgB,EAAUpP,OAAQuf,GAClBnQ,EAAUpP,OAAQ2sB,GAGlBxvB,KAAKC,SAAS6tB,QAAQpkB,KAAMuI,GAG5B,IAAI2X,UAGJ5pB,KAAKwuB,OAGLxuB,KAAK4yB,mB,4BAGN,WAEC,IAAIC,EAAyB1yB,IAAG,SAAU,CAAEovB,MAAO,gBAClDuD,EAA2B3yB,IAAG,SAAU,CAAEovB,MAAO,yBACjDwD,EAA2B5yB,IAAG,UAAW,CAAEovB,MAAO,sBAClDyD,EAA2B7yB,IAAG,OAAQ,CAAEovB,MAAO,gCAC/C0D,EAA2B9yB,IAAG,UAAW,CAAEovB,MAAO,sBAAuB3oB,KAAM1I,iBAAiBc,KAAKolB,QAAQiL,gBAG9GnxB,iBAAiBI,OAAO8lB,QAAQiL,gBAAoE,GAAnDnxB,iBAAiBI,OAAO8lB,QAAQiL,eAAuB,GAAKnxB,iBAAiBI,OAAO8lB,QAAQiL,eAC7I,IAAI6D,GAAwB9zB,aAASlB,iBAAiBI,OAAO8lB,QAAQiL,gBAAmBnxB,iBAAiBc,KAAKolB,QAAQ2L,UAAY7xB,iBAAiBI,OAAO8lB,QAAQiL,eAE9J8D,EAA2BhzB,IAAG,UAAW,CAAEovB,MAAO,uBAAwB3oB,KAAMssB,GACnFE,EAA2BjzB,IAAG,UAAW,CAAEovB,MAAO,sBAAuB3oB,KAAM1I,iBAAiBc,KAAKkxB,MACrGmD,EAA2BlzB,IAAG,SAAU,CAAEovB,MAAO,wBACjD+D,EAA2BnzB,IAAG,SAAU,CAAEovB,MAAO,0BAElDvvB,KAAKC,SAASovB,eAAeF,SAAYiE,EACzCpzB,KAAKC,SAASovB,eAAeD,UAAYiE,EAEzC,IAAIE,EAA0B,IAAIpyB,UAAO,MAAO,CAC/CJ,aAAc7C,iBAAiBI,OAAO8lB,QAAQiL,eAC9CpnB,YAAc/J,iBAAiBc,KAAKolB,QAAQkM,WAC5CjoB,YAAcnK,iBAAiBc,KAAKolB,QAAQ2L,YAC1C,GAAM,SAAUtpB,EAAO8pB,GAGzB,IAAIpuB,EAAW,CACd2X,SAAS,EACTC,QAAS,IAYV,OARKtT,GAAS,EACbtE,EAAS2X,SAAU,EAGnB3X,EAAS4X,QAAU7b,iBAAiBc,KAAKolB,QAAQoM,YAI3CruB,KAGRnC,KAAKwzB,iBAAuBD,EAE5B,IAAIE,EAA2BtzB,IAAG,SAAU,CAAEovB,MAAO,yBACpDmE,EAA2BvzB,IAAG,SAAU,CAAEovB,MAAO,6BAA8B3oB,KAAM1I,iBAAiBc,KAAK8rB,MAC3G6I,EAA2BxzB,IAAG,SAAU,CAAEovB,MAAO,+BAAgC3oB,KAAM1I,iBAAiBc,KAAKujB,QAqB9G,OAnBAviB,KAAKC,SAASovB,eAAe3E,WAAegJ,EAC5C1zB,KAAKC,SAASovB,eAAexE,aAAe8I,EAE5CF,EAAsB5wB,OAAQ6wB,GAC9BD,EAAsB5wB,OAAQ8wB,GAE9BL,EAAwBzwB,OAAQ0wB,EAAoBlyB,kBACpDiyB,EAAwBzwB,OAAQ4wB,GAChCJ,EAAqBxwB,OAAQywB,GAE7BP,EAAsBlwB,OAAQmwB,GAC9BF,EAAsBjwB,OAAQkwB,GAC9BD,EAAsBjwB,OAAQowB,GAC9BH,EAAsBjwB,OAAQswB,GAC9BL,EAAsBjwB,OAAQuwB,GAE9BP,EAAehwB,OAAQiwB,GACvBD,EAAehwB,OAAQwwB,GAEhBR,I,4BAGR,WAEM30B,iBAAiBI,OAAOwpB,SAAY5pB,iBAAiBI,OAAOwb,SAEhE5b,iBAAiBI,OAAO8lB,QAAQC,aAAa1hB,UAAU,K,oCAIzD,SAAuBixB,EAAUC,EAAaC,GAE7CF,EAASzE,SAAS7tB,GAAI,SAAS,WAE9BsyB,EAASxE,UAAU2E,YAAa,QAIjCH,EAAS/I,aAAavpB,GAAI,SAAS,WAElCsyB,EAASxE,UAAU2E,YAAa,KAAK,WAEpC,IAAIC,QAKNJ,EAASlJ,WAAWppB,GAAI,SAAS,WAKhC,GAHiBwyB,EAAW9Z,WAGZF,QAAS,CAGxB8Z,EAASlJ,WAAW3nB,SAAU,sCAG9B,IAAIkxB,EAAgBH,EAAWtyB,YAE1BpC,aAAS60B,KACbA,GAAiB,IAGlBvyB,cAAUkyB,EAASvuB,SAAU,CAC5BhD,QAAcnE,iBAAiBI,OAAO2C,GACtCizB,2BAA4BD,IAC1B,WAEG,8BAAgCL,EAASvuB,SAC7CnH,iBAAiBI,OAAO8lB,QAAQ8K,aAAe+E,EAE/C/1B,iBAAiBI,OAAO8lB,QAAQiL,eAAiB4E,EAIlDL,EAASxE,UAAU2E,YAAa,KAAK,WAEpC,IAAIC,QAEH,WACFh2B,QAAQC,IAAK,+CAGb61B,EAAWnxB,SAAUkxB,GAGrBD,EAASlJ,WAAW3f,YAAa,6CAMpC+oB,EAAWtnB,WAAWlL,GAAI,SAAS,SAAEwH,GAEd,IAAjBA,EAAM2hB,SAEVmJ,EAASlJ,WAAWjoB,QAAS,c,kBAKhC,WAAM,WAEgC,aAAhCvE,iBAAiBI,OAAOF,MAE5B4B,KAAKm0B,uBAAwBn0B,KAAKC,SAASivB,aAAchxB,iBAAiBI,OAAO8lB,QAAQ8K,aAAclvB,KAAKywB,YAoE7GzwB,KAAKm0B,uBAAwBn0B,KAAKC,SAASovB,eAAgBnxB,iBAAiBI,OAAO8lB,QAAQiL,eAAgBrvB,KAAKwzB,kBAEhHxzB,KAAKC,SAAS2J,OAAOtI,GAAI,0BAA0B,WAElD,EAAKkxB,mBAAmB/wB,wBAGxB,IAAIynB,EAAa,EAAKsJ,mBAAmBhxB,WACxC4yB,EAAalL,EAAW,UAAY,SAGhBvqB,iBAAa,MAAO,CACvCC,OAAQ,CACPC,SAAU,cAMWqqB,GAAcA,GAAYhrB,iBAAiBI,OAAOwb,SAEzEpY,cAAU,qBAAsB,CAC/BW,QAAWnE,iBAAiBI,OAAO2C,GACnCooB,YAAa+K,IACX,WAEFl2B,iBAAiBI,OAAOwpB,OAASoB,EAGjC,IAAI8K,KACF,WAEFh2B,QAAQC,IAAK,iDAGb4O,YAAY,WAEX,EAAK2lB,mBAAmB9vB,uBAGxB,EAAK8vB,mBAAmB7vB,UAAU,GAAO,KACvC,SAWJzE,iBAAiBI,OAAO+1B,WAAY,EAGpC,IAAIzK,UAGJ/c,YAAY,WAEX,EAAK2lB,mBAAmB9vB,uBAGxB,EAAK8vB,mBAAmB7vB,UAAU,GAAO,KACvC,c,sVCrcP,Q,WA1DC,c,4FAAa,SAEZ3C,KAAKC,SAAW,CACfgS,UAAW9R,IAAG,oBAKwB,GAAlCH,KAAKC,SAASgS,UAAUhD,SAC5BjP,KAAKs0B,kBACLt0B,KAAKC,SAASgS,UAAY9R,IAAG,oBAI9BH,KAAKu0B,iBAGLv0B,KAAKw0B,gBAGAt2B,iBAAiBI,OAAO+1B,WAE5Br0B,KAAKy0B,c,mDAIP,WACCz0B,KAAKC,SAASgS,UAAU5T,U,6BAGzB,WAEI,IAAImsB,EAAkBrqB,IAAG,SAAU,CAAEc,GAAI,iBAAkBsuB,MAAO,QAClEpvB,IAAG,wBAAyBkH,QAASmjB,K,yBAGzC,WAIC,KAAOprB,aAASlB,iBAAiBI,OAAOyb,QAAQ9P,OAAS,CAExD,IAAIqjB,EAASntB,IAAG,SAAU,CAAEovB,MAAO,+BAAgC3oB,KAAM1I,iBAAiBI,OAAOyb,QAAQ9P,OACzGjK,KAAKC,SAASgS,UAAUpP,OAAQyqB,M,2BAIlC,WAIC,KAAOluB,aAASlB,iBAAiBI,OAAOyb,QAAQiO,SAAW,CAC1D,IAAIsF,EAASntB,IAAG,SAAU,CAAEovB,MAAO,iCAAkC3oB,KAAM1I,iBAAiBI,OAAOyb,QAAQiO,SAC3GhoB,KAAKC,SAASgS,UAAUpP,OAAQyqB,S,oVCmEnC,Q,WAzHI,c,4FAAa,SACTttB,KAAKC,SAAW,CACZgS,UAAW9R,IAAG,aACdu0B,MAAWv0B,IAAG,oBACd0oB,OAAW,IAGf7oB,KAAK20B,eAAiB30B,KAAKC,SAASy0B,MAAM1tB,MAG1ChH,KAAK40B,eAGL50B,KAAK60B,cAGL70B,KAAK80B,gB,iDAGT,WACI,IAAI7iB,EAAe9R,IAAG,SAAU,CAAE,MAAS,qBACvC40B,EAAe50B,IAAG,SAAU,CAAE,MAAS,QAGvC60B,EAAe70B,IAAG,SAAU,CAAE,MAAS,gCACvC80B,EAAe90B,IAAG,UAAW,CAAE,MAAS,4DACxC+0B,EAAe/0B,IAAG,UAAW,CAAE,MAAS,oBAAqByG,KAAM1I,iBAAiBc,KAAK6c,MAAMmZ,QAEnGA,EAAOnyB,OAAQoyB,GACfD,EAAOnyB,OAAQqyB,GAEfl1B,KAAKC,SAAS4oB,OAAOmM,OAASA,EAG9B,IAAIG,EAAeh1B,IAAG,SAAU,CAAE,MAAS,+BACvCi1B,EAAej1B,IAAG,UAAW,CAAE,MAAS,0CACxCk1B,EAAel1B,IAAG,UAAW,CAAE,MAAS,oBAAqByG,KAAM1I,iBAAiBc,KAAK6c,MAAMsZ,OAEnGA,EAAMtyB,OAAQuyB,GACdD,EAAMtyB,OAAQwyB,GAEdr1B,KAAKC,SAAS4oB,OAAOsM,MAAQA,EAE7BJ,EAAalyB,OAAQmyB,GACrBD,EAAalyB,OAAQsyB,GACrBljB,EAAUpP,OAAQkyB,GAGlB/0B,KAAKC,SAASgS,UAAUpP,OAAQoP,K,6BAGpC,WACIjS,KAAKC,SAAS4oB,OAAOmM,OAAOM,OAAOtG,OAAQ,O,4BAG/C,WAAgB,WACZhvB,KAAKC,SAAS4oB,OAAOmM,OAAOM,OAAOrG,QAAS,KAE5CjvB,KAAKC,SAAS4oB,OAAOsM,MAAMG,OAAOtG,OAAQ,KAAK,WAC3CniB,YAAY,WACR,EAAK5M,SAAS4oB,OAAOsM,MAAMlG,QAAS,OACrC,U,2BAIX,WAEIjvB,KAAKC,SAASy0B,MAAM1tB,IAAKhH,KAAK20B,gBAG9B30B,KAAKC,SAAS4oB,OAAOmM,OAAOM,OAAOrG,QAAS,O,yBAGhD,WAAa,IACLsG,EADK,OAITv1B,KAAKC,SAASy0B,MAAMpzB,GAAI,SAAS,WAG7BsL,aAAc2oB,GAGdA,EAAgB1oB,YAAY,WAExB,EAAK2oB,kBAGL,EAAKC,gBACN,W,sBAIX,WACI,OAAOz1B,KAAKC,SAASy0B,MAAM1tB,Q,yBAG/B,WAAa,YACTtF,cAAU,oBAAqB,CAC3BW,QAAYnE,iBAAiBI,OAAO2C,GACpCy0B,WAAY11B,KAAK21B,aAClB,WACC,EAAKC,iBAGL,EAAKjB,eAAiB,EAAKgB,cAC5B,WACC33B,QAAQC,IAAK,0CAGb,EAAK43B,qB,2BAIb,WACI11B,IAAE4R,UAAUhF,OAAO,WACf5M,IAAGgZ,QAASrP,IAAK,kC,2VCkF7B,Q,WApMC,WAAagsB,I,4FAAa,SAEzB91B,KAAK81B,YAAcA,EAGnB91B,KAAK2Y,SAGL3Y,KAAKkjB,cAGLljB,KAAK+1B,mB,2CAGN,WAEC,IAAMC,EAAsB71B,IAAE,oSAAD,OAMpBjC,iBAAiBc,KAAKkuB,WAAWrR,MANb,41BAkBf3d,iBAAiBc,KAAKkuB,WAAWkE,eAlBlB,kJAqBflzB,iBAAiBc,KAAKkuB,WAAW+I,sBArBlB,q2BAkCf/3B,iBAAiBc,KAAKkuB,WAAWmE,oBAlClB,kJAqCfnzB,iBAAiBc,KAAKkuB,WAAWgJ,2BArClB,yPA6CpBh4B,iBAAiBc,KAAKkuB,WAAWiJ,sBA7Cb,uMAgDwEj4B,iBAAiBc,KAAKwjB,QAhD9F,+GAyD7BriB,IAAG,QAAS0C,OAAQmzB,K,yBAGrB,WAECh2B,KAAKo2B,UAAY,CAChBnkB,UAAc9R,IAAG,sBACjBk2B,KAAcl2B,IAAG,2BACjB6nB,QAAc7nB,IAAG,kDACjBm2B,aAAcn2B,IAAG,uC,8BAInB,WAAkB,WAEjBH,KAAKo2B,UAAUC,KAAK/0B,GAAI,UAAU,SAAEwH,GAEnCA,EAAMytB,iBAGN,IAAMrJ,EAAa,EAAKkJ,UAAUC,KAAK9zB,KAAM,yCAA0CyE,OAGhF5H,aAAS8tB,GAaf,EAAKsJ,UAAWt4B,iBAAiBc,KAAKkuB,WAAWuJ,uBAX5C,CAAE,OAAQ,aAActtB,SAAU+jB,GAEtC,EAAKwJ,eAAgBxJ,GAIrB,EAAKsJ,UAAWt4B,iBAAiBc,KAAKkuB,WAAWyJ,kC,4BAUrD,SAAgBzJ,GAAY,WAKrBhc,EAAO,CACZ7O,QAAanE,iBAAiBI,OAAO2C,GACrC21B,YAAa1J,GAIdltB,KAAKo2B,UAAUE,aAAavzB,SAAU,uCAGtCrB,cAZiB,0BAYGwP,GACnB,SAAE/O,GAED,GAAKA,EAAS00B,QAAS,CAItB,EAAKT,UAAUnkB,UAAUwF,SAGzBvZ,iBAAiBI,OAAOF,KAAO8uB,EAG/B,IAAI4J,EAAwB32B,IAAG,+DAG3B42B,EAAuB74B,iBAAiBc,KAAKyD,QAAQu0B,aACpB,aAAhC94B,iBAAiBI,OAAOF,OAC5B24B,EAAuB74B,iBAAiBc,KAAKyD,QAAQw0B,kBAItDH,EAAsBlwB,KAAMmwB,GAG5B,EAAKjB,YAAa5I,QAIlB,EAAKsJ,UAAWt4B,iBAAiBc,KAAKkuB,WAAWgK,4BAGnD,SAAE/0B,GACDnE,QAAQC,IAAK,gDAGb,EAAKm4B,UAAUE,aAAavrB,YAAa,sCAGzC,EAAKyrB,UAAWt4B,iBAAiBc,KAAKkuB,WAAWgK,8B,uBAKpD,SAAWC,GAEV,IAAMC,EAASj3B,IAAE,2DAAD,OAEXg3B,EAFW,yBAOVE,EAAqBr3B,KAAKo2B,UAAUnkB,UAAU1P,KAAM,6BACrD80B,EAAmBpoB,OAAS,GAChCooB,EAAmB5f,SAIpB2f,EAAOpZ,YAAahe,KAAKo2B,UAAUpO,SAGnCnb,YAAW,WACVuqB,EAAOr0B,SAAU,qCACf,S,qVC9EL,Q,WAlHC,c,4FAAa,SACZ/C,KAAKs3B,Q,0CAGN,WACC,IA4CIC,EACHC,EA7CGC,EAAwBt3B,IAAG,SAAU,CAAE,MAAS,oBA+C7C5B,eAAWL,iBAAiBM,KAAUN,iBAAiBM,IAK7D+4B,GAAYhvB,cAAU,0BAA2B,CAAE,MAAOrK,iBAAiBq5B,UAC3EC,GAAYjvB,cAAU,uBAAwB,CAAE,UALhDgvB,GAAYhvB,cAAU,uBAAwB,CAAErK,iBAAiBq5B,UACjEC,EAAY,qBAOb,IAAIE,EAAqBv3B,IAAG,OAAQ,CACnC,MAAS,sBACT,cAAejC,iBAAiBc,KAAK24B,aAAa9b,MAClD,WAAY,OACZ,MAAQtT,cAAU,8FAA+F,CAAEgvB,EAASC,EAAW,gBAAiB,cACxJ,OAAU,WAGPI,EAAyBz3B,IAAG,UAAW,CAAE,MAAS,yBACtDu3B,EAAmB70B,OAAQ+0B,GAC3BF,EAAmB3wB,SAAU0wB,GAI7Bt3B,IAAE,QAAQ0C,OAAQ40B,K,kBAGnB,SAAMI,EAAWC,EAA0BC,EAASC,GAEnDH,EAAUv2B,GAAI,SAAS,WAEjBw2B,EAAyBrpB,GAAG,cAChCwpB,aAAaC,uBAAyB,QAIvCH,EAAQ9I,QAAQ,KAChB+I,EAAcjtB,YAAa,6B,uBAK7B,WAiBC,OAVa,O,8eC7FTotB,E,WACL,aAAa,UAEZn4B,KAAKkjB,cAIuC,GAAvCljB,KAAKo2B,UAAUgC,cAAcnpB,QAEjCjP,KAAKq4B,mB,qCAIP,WACCr4B,KAAKo2B,UAAY,CAChBnkB,UAAe9R,IAAG,uBAClBi4B,cAAej4B,IAAG,gC,8BAIpB,WAAkB,WAEjBH,KAAKo2B,UAAUnkB,UAAU3Q,GAAI,SAAU,yGAAyG,SAAEwH,GAEjJ,IAAM1H,EAAYjB,IAAG2I,EAAMgE,eAG3B,EAAKwrB,aAAcl3B,MAMpB,IAAIm3B,kBAAiB,SAAEC,GAEtBA,EAAUjpB,SAAS,SAAEkpB,GAEpBA,EAASC,WAAWnpB,SAAQ,SAAEopB,GAE7B,IAAMv3B,EAAYjB,IAAGw4B,GAAYp2B,KAAM,+DAGvC,EAAK+1B,aAAcl3B,YAGnBw3B,QAAS54B,KAAKo2B,UAAUgC,cAAc,GAAI,CAC5CS,WAAW,M,6BAIb,SAAiBz3B,GAChB,MAAO,CACNH,GAAWG,EAAU4F,MACrBzF,UAAWH,EAAUqN,GAAI,e,0BAI3B,SAAcrN,GAAW,WAEpB03B,EAAe94B,KAAK+4B,gBAAiB33B,GAGzCpB,KAAKg5B,UAAW,WAAW,EAAM53B,IAGjCM,cAAU,mBAAoB,CAC7Bu3B,QAAc,kBACd3rB,UAAcpP,iBAAiBI,OAAO2C,GACtCi4B,YAAcJ,EAAa73B,GAC3Bk4B,aAAcL,EAAav3B,YACzB,SAAEY,GAGCA,EAAS00B,SAGb,EAAKmC,UAAW,WAAW,EAAM53B,GAGjCyL,YAAW,WAEV,EAAKmsB,UAAW,WAAW,EAAO53B,KAChC,OAGHpD,QAAQC,IAAK,oEAIb,EAAKm7B,oBAAqBh4B,GAG1B,EAAK43B,UAAW,SAAS,EAAM53B,GAE/ByL,YAAW,WAEV,EAAKmsB,UAAW,SAAS,EAAO53B,OAKlC,EAAK43B,UAAW,WAAW,EAAO53B,MAChC,SAAEe,GAIJ,EAAKi3B,oBAAqBh4B,GAG1B,EAAK43B,UAAW,WAAW,EAAO53B,GAGlC,EAAK43B,UAAW,SAAS,EAAM53B,GAE/ByL,YAAW,WAEV,EAAKmsB,UAAW,SAAS,EAAO53B,QAE/B,CACFi4B,uBAAuB,EACvBC,UAAuB,M,iCAIzB,SAAqBl4B,GAEpBA,EAAU0E,KAAM,WAAa1E,EAAUqN,GAAI,e,uBAG5C,WAAkD,IAAvCoa,EAAuC,uDAA9B,GAAI0Q,IAA0B,yDAAXn4B,EAAW,uCAE3CmY,EAASnY,EAAU8N,QAAS,aAGnB,WAAV2Z,EAEC0Q,GAEJhgB,EAAOxW,SAAU,wBAGjB3B,EAAU0E,KAAM,YAAY,KAI5ByT,EAAOxO,YAAa,wBAGpB3J,EAAU0E,KAAM,YAAY,IAGV,WAAV+iB,EAEJ0Q,EAEJhgB,EAAOxW,SAAU,wBAIjBwW,EAAOxO,YAAa,wBAGF,SAAV8d,IAEJ0Q,EAEJhgB,EAAOxW,SAAU,sBAIjBwW,EAAOxO,YAAa,2B,KAMlByuB,E,WACL,aAAa,UAEZx5B,KAAKkjB,cAIsC,GAAtCljB,KAAKo2B,UAAUqD,aAAaxqB,QAEhCjP,KAAK05B,4B,qCAIP,WACC15B,KAAKo2B,UAAY,CAChBnkB,UAAc9R,IAAG,uBACjBs5B,aAAct5B,IAAG,iCACjBw5B,SAAcx5B,IAAG,wC,uCAInB,WAA2B,WAG1B,IAAIo4B,kBAAiB,SAAEC,GAEtB,EAAKoB,cACHhB,QAAS54B,KAAKo2B,UAAUuD,SAAS,GAAI,CACvCd,WAAW,M,sBAIb,WAAU,WAEHgB,EAAO75B,KAAK85B,UAGlB95B,KAAKg5B,UAAW,WAAW,IAG3Bt3B,cAAU,mBAAoB,CAC7Bu3B,QAAc,aACd3rB,UAAcpP,iBAAiBI,OAAO2C,GACtC44B,KAAcA,IACZ,SAAE13B,GAGCA,EAAS00B,UAGb,EAAKmC,UAAW,WAAW,GAG3BnsB,YAAW,WAEV,EAAKmsB,UAAW,WAAW,KACzB,MAQJ,EAAKA,UAAW,WAAW,MACzB,SAAE72B,GAIJ43B,SAASC,WACP,CACFX,uBAAuB,EACvBC,UAAuB,M,uBAIzB,WAAuC,IAA5BzQ,EAA4B,uDAAnB,GAAI0Q,IAAe,yDAEvB,WAAV1Q,EAEC0Q,EAEJv5B,KAAKo2B,UAAUnkB,UAAUlP,SAAU,oBAInC/C,KAAKo2B,UAAUnkB,UAAUlH,YAAa,oBAGpB,WAAV8d,EAEJ0Q,EAEJv5B,KAAKo2B,UAAUnkB,UAAUlP,SAAU,oBAInC/C,KAAKo2B,UAAUnkB,UAAUlH,YAAa,oBAGpB,SAAV8d,IAEJ0Q,EAEJv5B,KAAKo2B,UAAUnkB,UAAUlP,SAAU,kBAInC/C,KAAKo2B,UAAUnkB,UAAUlH,YAAa,qB,qBAKzC,WAEC,IAAMkvB,EAAqBj6B,KAAKo2B,UAAUqD,aAAazyB,MAMvD,MAAO,CACNkzB,QAJiBD,EAAmBE,MAAO,KAK3CC,eAAgBH,O,KAKnB,QAzTC,aAAa,UAEZ,IAAI9B,EAGJ,IAAIqB,I,sTCmCN,QAhCI,c,4FAAa,UAKKr7B,oBAAgB,UAAW,CAAEC,KAAM,YACzCC,QAGR,IAAIqhB,GAAW/gB,iBAAa,MAAO,CAC/BC,OAAQ,CACJC,SAAU,cAKXO,aAASsgB,GAKZ,IAAIlC,UAAyB,WAH7B,IAAIje,UAAc,UAAWmgB,GAOjC,IAAI5f,UAAe,a,2aC+6B3B,Q,WAp8BC,c,4FAAa,SAEZ5B,iBAAiBI,OAAO+7B,aAAaC,MAAOC,wBAAoB,YAGhEv6B,KAAK2Y,S,2CAGN,WAEC,IAAI6hB,EAAW,GAGf,OAASt8B,iBAAiBI,OAAO+7B,aAAaC,MAC7C,IAAK,gBAKJp8B,iBAAiBI,OAAO+7B,aAAavgB,SAAU,GAG/C2gB,kBAAc,YAIdD,EAAWx6B,KAAK06B,uBAChB,MAED,IAAK,cAEJF,EAAWx6B,KAAK26B,kBAChB,MAED,IAAK,iBAEJF,kBAAc,YAGdv8B,iBAAiBI,OAAO+1B,WAAY,EAGpC,IAAIzK,UAGJ4Q,EAAWx6B,KAAK46B,mBAKlB,IAAI16B,GAAW/B,oBAAgB,UAAW,CAChCC,KAAM,WAGVJ,QAAQC,IAAK,yBAA0B,oDAGvCiC,EAASmH,QAASmzB,K,kCAGzB,WAEC,IAAIK,EAAgB16B,IAAE,kbAAD,OAQXjC,iBAAiBc,KAAKq7B,aAAaS,SAASC,SARjC,uTAcX78B,iBAAiBc,KAAKq7B,aAAaS,SAAnC,IAdW,+HAkDrB,OA1BAD,EAAct4B,KAAM,SAAU8E,QAASrH,KAAKg7B,kBAGrBH,EAAct4B,KAAM,yBAG1BjB,GAAI,SAAS,SAAEwH,GAE/B,IAGImyB,EAHU96B,IAAG2I,EAAMgE,eAGEoE,KAAM,WAG/BqpB,wBAAoB,aAAc,CACjCW,OAAQD,IAIT/8B,iBAAiBI,OAAO+7B,aAAaC,KAAO,cAG5C,IAAIl4B,aAIEy4B,I,6BAGR,WAEC,IAAI1qB,EAAoBhQ,IAAE,kOAoB1B,OATAgQ,EAAkB5N,KAAM,SAAU8E,QAASrH,KAAKg7B,kBAGzB7qB,EAAkB5N,KAAM,iBAG9BM,OAAQ7C,KAAKm7B,oBAGvBhrB,I,8BAGR,WAEC,IAAM1P,EAAaN,IAAE,eAGjBgK,EAAUhK,IAAE,2CAGZi7B,EAAgB,IAGpBb,wBAAoB,gBAAiB,CACpCW,OAAQ,eACR/sB,OAAQ,MAGTosB,wBAAoB,gBAAiB,CACpCW,OAAQ,UACR/sB,OAAQ,KAIT,IAAIktB,EAAQn9B,iBAAiBI,OAAO+7B,aAAaiB,UAAUD,MAI3D,cAHOA,EAAME,cAGJr9B,iBAAiBI,OAAO+7B,aAAaa,QAC7C,IAAK,eAEJ,IAAIM,EAAiBr7B,IAAE,0FAGnBs7B,EAAc,IAAIt6B,UAAO,SAAU,CACtCtC,SAAU,gBACVmG,WAAY,cACZjF,MAAO7B,iBAAiBc,KAAKq7B,aAAaqB,aAAaC,iBACvD56B,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAaD,YACvEj2B,YAAY,EACZe,QAAS,CACR,CACCE,MAAO,QACPG,KAAO1I,iBAAiBc,KAAKq7B,aAAaqB,aAAaE,wBAExD,CACCn1B,MAAO,KACPG,KAAO1I,iBAAiBc,KAAKq7B,aAAaqB,aAAaG,qBAExD,CACCp1B,MAAO,WACPG,KAAO1I,iBAAiBc,KAAKq7B,aAAaqB,aAAaI,8BAI1DV,EAAc9rB,KAAMmsB,GAGpB,IAAIM,EAAa,IAAI56B,UAAO,OAAQ,CACnCtC,SAAU,gBACVmG,WAAY,mBACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAaM,iBACvEj8B,MAAO7B,iBAAiBc,KAAKq7B,aAAaqB,aAAaO,gBACvD5zB,YAAanK,iBAAiBc,KAAKq7B,aAAaqB,aAAaQ,sBAC7D12B,YAAY,EACZF,gBAAgB,IAEjB81B,EAAc9rB,KAAMysB,GAGpB,IAAII,EAA0BV,EAAYp6B,iBAC1Cm6B,EAAe34B,OAAQs5B,GAEvB,IAAIC,EAAyBL,EAAW16B,iBACxCm6B,EAAe34B,OAAQu5B,GAGvBjyB,EAAQtH,OAAQ24B,GAGhB,IAAIa,EAAgB,IAAIl7B,UAAO,QAAS,CACvCtC,SAAU,gBACVmG,WAAY,WACZ/C,KAAM,uCACNlC,MAAO7B,iBAAiBc,KAAKq7B,aAAaqB,aAAaY,wBACvD92B,YAAY,EACZzE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAaa,SACvEh2B,QAAS,CACR,CACCE,MAAO,kBACPG,KAAM1I,iBAAiBc,KAAKq7B,aAAaqB,aAAac,oCAEvD,CACC/1B,MAAO,aACPG,KAAM1I,iBAAiBc,KAAKq7B,aAAaqB,aAAae,sCAIzDrB,EAAc9rB,KAAM+sB,GAGpB,IAAIK,EAA4BL,EAAch7B,iBAuC9C,GAtCA8I,EAAQtH,OAAQ65B,GAGhBP,EAAwB76B,GAAI,0BAA0B,YAErDi5B,wBAAoB,gBAAiB,CACpCW,OAAQ,eACR/sB,OAAQ,CACPstB,YAAaA,EAAYj6B,iBAK5B46B,EAAuB96B,GAAI,0BAA0B,YAEpDi5B,wBAAoB,gBAAiB,CACpCW,OAAQ,eACR/sB,OAAQ,CACP6tB,iBAAkBD,EAAWv6B,iBAMhCk7B,EAA0Bp7B,GAAI,0BAA0B,YAEvDi5B,wBAAoB,gBAAiB,CACpCW,OAAQ,eACR/sB,OAAQ,CACPouB,SAAUF,EAAc76B,cAK1B,IAAIY,aAIqE,cAArElE,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAaa,SAA0B,CAEvF,IAAMI,EAAmBx8B,IAAE,qEAAD,OAErBjC,iBAAiBc,KAAKq7B,aAAaqB,aAAakB,iBAF3B,qCAM1BzyB,EAAQtH,OAAQ85B,QAEZ,GAA0E,mBAArEz+B,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAaa,SAA+B,CAEjG,IAAIM,EAAuB18B,IAAG,SAAU,CACvC,MAAS,iBAIU,CACnB,CACCtB,SAAY,gBACZmJ,UAAY,OACZhD,WAAY,YACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAaoB,UACvE/8B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQD,UAClDt3B,YAAY,EACZF,gBAAgB,GAEjB,CACCzG,SAAY,gBACZmJ,UAAY,OACZhD,WAAY,WACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAasB,SACvEj9B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQC,SAClDx3B,YAAY,EACZF,gBAAgB,GAEjB,CACCzG,SAAY,gBACZmJ,UAAY,OACZhD,WAAY,QACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAauB,MACvEl9B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQE,MAClDz3B,YAAY,EACZF,gBAAgB,GAEjB,CACCzG,SAAY,gBACZmJ,UAAY,OACZhD,WAAY,WACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAawB,SACvEn9B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQG,SAClD13B,YAAY,EACZF,gBAAgB,GAEjB,CACCzG,SAAY,gBACZmJ,UAAY,OACZhD,WAAY,cACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAayB,YACvEp9B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQI,YAClD33B,YAAY,EACZF,gBAAgB,GAEjB,CACCzG,SAAY,gBACZmJ,UAAY,OACZhD,WAAY,WACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAa0B,SACvEr9B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQK,SAClDn1B,YAAa/J,iBAAiBc,KAAKq7B,aAAa0C,QAAQM,oBACxD73B,YAAY,EACZF,gBAAgB,GAEjB,CACCzG,SAAY,gBACZmJ,UAAY,SACZhD,WAAY,OACZjE,cAAgB3B,aAASlB,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAa4B,MAAyE,aAAhEp/B,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAa4B,KACpJv9B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQO,KAClD93B,YAAY,EACZF,gBAAgB,EAChBiB,QAAS+Y,OAAOqM,KAAM0P,GAAQ3sB,KAAK,SAAErO,EAAKgK,GACzC,MAAO,CACN5D,MAAOpG,EACPuG,KAAOy0B,EAAOh7B,QAIjB,CACCxB,SAAU,gBACVmJ,UAAW,QACXhD,WAAY,YACZ/C,KAAM,YACNlB,aAAc7C,iBAAiBI,OAAOi/B,iBAAsBn+B,aAASlB,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAa8B,WAAmF,KAArEt/B,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAa8B,UAAqB,KAC1N93B,UAAYxH,iBAAiBI,OAAOi/B,gBACpCx9B,MAAO7B,iBAAiBc,KAAKq7B,aAAamD,UAC1Cl4B,gBAAgB,EAChBiB,QAAS,CAAC,CACRE,MAAO,MACPG,KAAO1I,iBAAiBc,KAAKy+B,KAE9B,CACCh3B,MAAO,KACPG,KAAO1I,iBAAiBc,KAAK0+B,OAOnBnuB,SAAQ,SAAEkL,GAEvB,IAAM5V,EAAQ,IAAI1D,UAAOsZ,EAAYzS,UAAWyS,GAG5CkjB,EAAoB94B,EAAMxD,iBAC9Bw7B,EAAqBh6B,OAAQ86B,GAkB7BvC,EAAc9rB,KAAMzK,MAIrBsF,EAAQtH,OAAQg6B,GAEjB,MAED,IAAK,UAEgB,CACnB,CACCh+B,SAAY,gBACZmJ,UAAY,OACZhD,WAAY,YACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQD,UAClE/8B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQD,UAClDt3B,YAAY,EACZF,gBAAgB,GAEjB,CACCzG,SAAY,gBACZmJ,UAAY,OACZhD,WAAY,WACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQC,SAClEj9B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQC,SAClDx3B,YAAY,EACZF,gBAAgB,GAEjB,CACCzG,SAAY,gBACZmJ,UAAY,OACZhD,WAAY,QACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQE,MAClEl9B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQE,MAClDz3B,YAAY,EACZF,gBAAgB,GAEjB,CACCzG,SAAY,gBACZmJ,UAAY,OACZhD,WAAY,WACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQG,SAClEn9B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQG,SAClD13B,YAAY,EACZF,gBAAgB,GAEjB,CACCzG,SAAY,gBACZmJ,UAAY,OACZhD,WAAY,cACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQI,YAClEp9B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQI,YAClD33B,YAAY,EACZF,gBAAgB,GAEjB,CACCzG,SAAY,gBACZmJ,UAAY,OACZhD,WAAY,WACZjE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQK,SAClEr9B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQK,SAClDn1B,YAAa/J,iBAAiBc,KAAKq7B,aAAa0C,QAAQM,oBACxD73B,YAAY,EACZF,gBAAgB,GAEjB,CACCzG,SAAY,gBACZmJ,UAAY,SACZhD,WAAY,OACZjE,cAAgB3B,aAASlB,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQO,MAAoE,aAA3Dp/B,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQO,KAC1Iv9B,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQO,KAClD93B,YAAY,EACZF,gBAAgB,EAChBiB,QAAS+Y,OAAOqM,KAAM0P,GAAQ3sB,KAAK,SAAErO,EAAKgK,GACzC,MAAO,CACN5D,MAAOpG,EACPuG,KAAOy0B,EAAOh7B,QAIjB,CACCxB,SAAU,gBACVmJ,UAAW,QACXhD,WAAY,YACZ/C,KAAM,YACNlB,aAAc7C,iBAAiBI,OAAOi/B,iBAAsBn+B,aAASlB,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQS,WAA8E,KAAhEt/B,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQS,UAAqB,KAChN93B,UAAYxH,iBAAiBI,OAAOi/B,gBACpCx9B,MAAO7B,iBAAiBc,KAAKq7B,aAAamD,UAC1Cl4B,gBAAgB,EAChBiB,QAAS,CAAC,CACRE,MAAO,MACPG,KAAO1I,iBAAiBc,KAAKy+B,KAE9B,CACCh3B,MAAO,KACPG,KAAO1I,iBAAiBc,KAAK0+B,OAOnBnuB,SAAQ,SAAEkL,GAEvB,IAAM5V,EAAQ,IAAI1D,UAAOsZ,EAAYzS,UAAWyS,GAG5CkjB,EAAoB94B,EAAMxD,iBAC9B8I,EAAQtH,OAAQ86B,GAGhBvC,EAAc9rB,KAAMzK,MAIrB,IAAI+4B,EAAuB,IAAIz8B,UAAO,QAAS,CAC9CtC,SAAY,gBACZmG,WAAY,WACZ/C,KAAM,kCACNlC,MAAO7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQc,uBAClDr4B,YAAY,EACZzE,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQR,SAClEh2B,QAAS,CACR,CACCE,MAAO,uBACPG,KAAM1I,iBAAiBc,KAAKq7B,aAAa0C,QAAQe,iCAElD,CACCr3B,MAAO,aACPG,KAAM1I,iBAAiBc,KAAKq7B,aAAa0C,QAAQgB,qCAIpD3C,EAAc9rB,KAAMsuB,GAGpB,IAAII,EAAmCJ,EAAqBv8B,iBAyB5D,GAxBA8I,EAAQtH,OAAQm7B,GAGhBA,EAAiC18B,GAAI,0BAA0B,WAE9D,IAAI28B,EAAe,GAGnB7C,EAAc7rB,SAAQ,SAAEpO,GAEvB88B,EAAc98B,EAAM2M,gBAAgB9I,YAAe7D,EAAMK,eAI1D+4B,wBAAoB,gBAAiB,CACpCW,OAAQ,UACR/sB,OAAQ8vB,IAIT,IAAI77B,aAIgE,cAAhElE,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQR,SAA0B,CAElF,IAAMI,EAAmBx8B,IAAE,qEAAD,OAErBjC,iBAAiBc,KAAKq7B,aAAa0C,QAAQH,iBAFtB,qCAM1BzyB,EAAQtH,OAAQ85B,QAEZ,GAAqE,wBAAhEz+B,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQR,SAAoC,CAEjG,IAAIM,EAAuB18B,IAAG,SAAU,CACvC,MAAS,iBAIN+9B,EAAmB,IAAI/8B,UAAO,SAAU,CAC3CtC,SAAc,gBACdmG,WAAc,mBACdjF,MAAc7B,iBAAiBc,KAAKq7B,aAAa0C,QAAQoB,sBACzDp9B,aAAc7C,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQmB,iBAClEn4B,aAAc,QACdkC,YAAc/J,iBAAiBc,KAAKq7B,aAAa0C,QAAQqB,4BACzD54B,YAAc,EACde,QAAS,CACR,CACCE,MAAO,QACPG,KAAO1I,iBAAiBc,KAAKq7B,aAAa0C,QAAQE,OAEnD,CACCx2B,MAAO,WACPG,KAAO1I,iBAAiBc,KAAKq7B,aAAa0C,QAAQG,aAIrD9B,EAAc9rB,KAAM4uB,GAGpB,IAAIG,EAAoBH,EAAiB78B,iBACzCw7B,EAAqBh6B,OAAQw7B,GAG7Bl0B,EAAQtH,OAAQg6B,IAOnBp8B,EAAWoC,OAAQsH,GAGnB,IAAMm0B,EAAoBn+B,IAAE,6CAGtBo+B,EAAcp+B,IAAE,yCAAD,OAA4CjC,iBAAiBc,KAAK8rB,KAAlE,WACf0T,EAAgBr+B,IAAE,2CAAD,OAA8CjC,iBAAiBc,KAAKujB,OAApE,WAkFvB,OA9EAgc,EAAYj9B,GAAI,SAAS,WAGxB,IAAIm9B,GAAoB,EAGpBR,EAAe,GAGnB7C,EAAc7rB,SAAQ,SAAEpO,GAEvB,IAAMu9B,EAAev9B,EAAM6Y,WAAWF,QAGtC2kB,EAAoBA,GAAqBC,EAGpCA,IAEJT,EAAc98B,EAAM2M,gBAAgB9I,YAAe7D,EAAMK,gBAK3D+4B,wBAAoB,gBAAiB,CACpCW,OAAQh9B,iBAAiBI,OAAO+7B,aAAaa,OAC7C/sB,OAAQ8vB,IAMJQ,IAEJF,EAAYx7B,SAAU,wDAGtBrB,cAAU,gBAAiB,CAC1Bi9B,SAAUzgC,iBAAiBI,OAAO2C,GAClCi6B,OAAQh9B,iBAAiBI,OAAO+7B,aAAaa,OAC7C/sB,OAAQjQ,iBAAiBI,OAAO+7B,aAAalsB,OAAQjQ,iBAAiBI,OAAO+7B,aAAaa,UACxF,SAAE/4B,GAGJjE,iBAAiBI,OAAO+7B,aAAavgB,SAAU,GAG/CygB,wBAAoB,WAAY,CAC/BD,KAAM,kBAIP,IAAIl4B,aACF,SAAED,WAOPq8B,EAAcl9B,GAAI,SAAS,YAK1Bi5B,wBAAoB,WAAY,CAC/BD,KAAM,kBAIP,IAAIl4B,aAILk8B,EAAkBz7B,OAAQ07B,GAC1BD,EAAkBz7B,OAAQ27B,GAC1B/9B,EAAWoC,OAAQy7B,GAEZ79B,I,8BAGR,WAEC,IAAI0P,EAAoBhQ,IAAE,gUAY1BgQ,EAAkB5N,KAAM,SAAU8E,QAASrH,KAAKg7B,kBAGhD,IAAI4D,EAAoBzuB,EAAkB5N,KAAM,0BAG5Cs8B,EAAa1+B,IAAE,qQAUf2+B,EAAkB3+B,IAAE,sEAGxB0+B,EAAWt8B,KAAM,uCAAwCM,OAAQi8B,GAGb,gBAA/C5gC,iBAAiBI,OAAO+7B,aAAaa,OAEzC4D,EAAgBl4B,KAAM1I,iBAAiBc,KAAKq7B,aAAaS,SAASC,UAGV,WAA/C78B,iBAAiBI,OAAO+7B,aAAaa,QAE9C4D,EAAgBl4B,KAAM1I,iBAAiBc,KAAKq7B,aAAaS,SAAnC,KAIvBgE,EAAgBx9B,GAAI,SAAS,YAO5Bi5B,wBAAoB,WAAY,CAC/BD,KAAM,kBAIP,IAAIl4B,aAILw8B,EAAkB/7B,OAAQg8B,GAG1B,IAUIE,EAVAC,EAAW7+B,IAAE,4QAYmC,gBAA/CjC,iBAAiBI,OAAO+7B,aAAaa,OACzC6D,EAAmB5+B,IAAE,4BAAD,QAGlBoI,cACCrK,iBAAiBc,KAAKq7B,aAAa4E,QAAQC,QAC3C,CAAC,iDAAD,OACmDhhC,iBAAiBc,KAAKq7B,aAAa4E,QAAS/gC,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAaD,aADxJ,kEAEmDv9B,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAaM,iBAF5G,YALiB,qBAcoC,WAA/C99B,iBAAiBI,OAAO+7B,aAAaa,SAC9C6D,EAAmB5+B,IAAE,4BAAD,QAGlBoI,cACCrK,iBAAiBc,KAAKq7B,aAAa4E,QAAQE,UAC3C,CAAC,iDAAD,OACmDjhC,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQE,MADvG,YALiB,gCAerB+B,EAASz8B,KAAM,uCAAwCM,OAAQk8B,GAG/DA,EAAiBx8B,KAAM,qCAAsCjB,GAAI,SAAS,YAIzEi5B,wBAAoB,WAAY,CAC/BD,KAAM,gBAIP,IAAIl4B,aAILw8B,EAAkB/7B,OAAQm8B,GAG1B,IAAII,EAAej/B,IAAE,2QASjBk/B,EAAgB,GAEgC,gBAA/CnhC,iBAAiBI,OAAO+7B,aAAaa,OACiC,mBAArEh9B,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAaa,SAC7D8C,EAAgBnhC,iBAAiBc,KAAKq7B,aAAa4E,QAAQK,cAEmB,cAArEphC,iBAAiBI,OAAO+7B,aAAalsB,OAAOutB,aAAaa,WAClE8C,EAAgBnhC,iBAAiBc,KAAKq7B,aAAa4E,QAAQM,WAGJ,WAA/CrhC,iBAAiBI,OAAO+7B,aAAaa,SACuB,wBAAhEh9B,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQR,SACxD8C,EAAgBnhC,iBAAiBc,KAAKq7B,aAAa4E,QAAQO,mBAEc,cAAhEthC,iBAAiBI,OAAO+7B,aAAalsB,OAAO4uB,QAAQR,WAC7D8C,EAAgBnhC,iBAAiBc,KAAKq7B,aAAa4E,QAAQM,YAI7D,IAAIE,EAAuBt/B,IAAE,wBAAD,QAG1BoI,cACCrK,iBAAiBc,KAAKq7B,aAAa4E,QAAQS,UAC3C,CAAC,iDAAD,OACmDL,EADnD,YALyB,mBA+B5B,OAnBAD,EAAa78B,KAAM,uCAAwCM,OAAQ48B,GAGnEL,EAAa78B,KAAM,qCAAsCjB,GAAI,SAAS,YAIrEi5B,wBAAoB,WAAY,CAC/BD,KAAM,gBAIP,IAAIl4B,aAILw8B,EAAkB/7B,OAAQu8B,GAGnBjvB,I,4BAGR,WAEC,IAAI0L,EAGJ,OAAS3d,iBAAiBI,OAAO+7B,aAAaC,MAC7C,IAAK,gBACL,IAAK,gBAEJze,EAAQ3d,iBAAiBc,KAAKq7B,aAAasF,cAE3C,MAED,IAAK,cAEJ9jB,EAAQ3d,iBAAiBc,KAAKq7B,aAAauF,WAM7C,IAAIC,EAAU1/B,IAAE,4XAAD,OASAjC,iBAAiBc,KAAK2oB,QATtB,gSAkBP9L,EAlBO,+EAiCf,OANMgkB,EAAQt9B,KAAM,sBAAuBjB,GAAI,SAAS,WAEjDu+B,EAAQt9B,KAAM,iBAAkBu9B,YAAa,yBAI7CD,O,w3EC77BF,SAASE,IAAiC,IAAfhR,EAAe,uDAAJ,GAC5CiR,EAAiB,kCAGjBjR,EAAa3vB,EAAS2vB,GAAwB,aAAXA,EAInC,IAAMkR,EAAkB,WAEvBC,IAEAC,IAGA1F,EAAc,SAAU,CACvB2F,WAAYliC,iBAAiBmiC,wBAKpBniC,iBAAiBwhB,gBACjBxhB,iBAAiBQ,QAExBshC,EAAiB,kCAGjBjR,KAIGxwB,EAAWL,iBAAiBM,KAAUN,iBAAiBM,GAQtDY,EAASlB,iBAAiBI,OAAOF,MAMvC,IAAIkiC,WAAmB,WAEtBL,OANDA,KARD/hC,iBAAiBI,OAAOF,KAAO,OAG/B6hC,KA4BK,SAASxF,IAA8C,IAAhCx7B,EAAgC,uDAAvB,KAAMkF,EAAiB,uDAAJ,GAElDhC,GAAe,EAGfo+B,EAAe,CAAE,SAAU,YAG/B,GAAKhiC,EAAWU,IAAYwF,EAASxF,EAAQshC,GACzC,OAASthC,GACL,IAAK,SAED,IAAIuhC,EAAe,CAAE,cAGrB,GAAK/7B,EAAS+7B,EAAclhB,OAAOqM,KAAMxnB,IAAgB,CAErD,IAAI7F,EAGA8hC,EAAaj8B,EAAWi8B,WAE5BjgC,SAAQigC,GAAY,SAAU/1B,EAAOo2B,GAC5BA,EAAU79B,IAAM1E,iBAAiBI,OAAO2C,KACzC3C,EAASmiC,MAKjBtgC,SAAQ7B,EAAOohB,UAAU,SAAErV,EAAO5H,GAAT,OAAsBA,EAAQ5D,SAAW,aAClEsB,SAAQ7B,EAAOI,SAAU,SAAE2L,EAAOpL,GAAT,OAAsBA,EAAOJ,SAAY,YAClEsB,SAAQ7B,EAAO8B,UAAU,SAAEiK,EAAO/J,GAAT,OAAsBA,EAAQzB,SAAW,aAGlE,IAAIsE,EAAQ,GAAGu9B,OAAO5nB,MAAO,GAAI,CAAExa,EAAOohB,SAAUphB,EAAOI,QAASJ,EAAO8B,WAG3EzB,EAAa,SAGb,IAAMgiC,EAAoD,aAAhCziC,iBAAiBI,OAAOF,KAwblD,GArbA+B,SAAQgD,GAAO,SAAUkH,EAAO/H,GAE5B,IAAIs+B,EAGAvY,EAAalB,EAAe7kB,EAAK+M,KAAKrN,YAAaM,EAAKzD,SAAUyD,EAAK+M,KAAKvO,MAG5EwC,EAAWhB,EAAK+M,KAAKvO,KAGzB,GAAKvC,EAAW8pB,GAAc,CAE1B,IAAI9hB,EAAU,GAGThI,EAAW8pB,EAAW9hB,UACvBpG,SAAQkoB,EAAW9hB,SAAS,SAAU8D,EAAO7D,GACzCD,EAASC,EAAOq6B,aAAgB,CAAEr6B,MAKrCjI,EAAW8pB,EAAWyY,gBACvB3gC,YAAU,EAAMoG,EAAS8hB,EAAWyY,eAIxC,IAAIC,EAAkB,GAEtB5gC,SAAQoG,GAAS,SAAUy6B,EAAU7yB,GACjC,IAAI8yB,EAAuB,GAGvBC,EAAuB/yB,EAAOc,OAAS,EAE3C9O,SAAQgO,GAAQ,SAAU9D,EAAOxF,GAS7B,IA8JI4V,EAAa0mB,EA9JXC,EAAoB,SAAEv8B,GAExB,IAAI4V,EAAc,CACd4mB,QAAoBH,EACpB39B,OAAoBjB,EAAKM,GACzB/D,SAAoByD,EAAKzD,SAEzB2G,aAAoBjH,EAAWsG,EAAMsH,WAAatH,EAAMsH,SACxDrE,aAAoBvJ,EAAWsG,EAAMy8B,YAAcz8B,EAAMy8B,UACzD/7B,kBAAoBhH,EAAWsG,EAAM08B,mBAAqB18B,EAAM08B,iBAChEx5B,0BAAyBxJ,EAAWsG,EAAM28B,oBAAsB38B,EAAM28B,kBAEtEt8B,SAAoB3G,EAAWsG,EAAM48B,UAAY58B,EAAM48B,QAEvDh8B,QAAoBu7B,EACpBh8B,WAAoBH,EAAMg8B,YAC1B74B,UAAoBnD,EAAM68B,WAE1B3hC,MAAoB8E,EAAM9E,MAC1BkI,YAAoBpD,EAAMoD,YAC1BI,YAAoBxD,EAAMwD,YAC1B3C,WAAoBnH,EAAWsG,EAAM88B,YAAc98B,EAAM88B,UACzDr5B,UAAoB/J,EAAWsG,EAAM+8B,YAAe/8B,EAAM+8B,WAAa/8B,EAAM9E,MAE7EgG,aAAoBlB,EAAMg9B,cAC1B9gC,aAAoBxC,EAAW+D,EAAK+M,KAAMxK,EAAMg8B,cAAkBv+B,EAAK+M,KAAMxK,EAAMg8B,aAAgBh8B,EAAMg9B,cACzGC,oBAAsBvjC,EAAWsG,EAAMk9B,kBAAoBl9B,EAAMk9B,gBACjEA,kBAAoBxjC,EAAWsG,EAAMk9B,kBAAoBl9B,EAAMk9B,gBAE/D74B,UAAoB3K,EAAWsG,EAAMm9B,YAAen9B,EAAMm9B,WAAa,MA8H3E,MAxH8B,QAAzBvnB,EAAYzS,YACbyS,EAAYnP,WAAgB/M,EAAWsG,EAAMo9B,aAAgBp9B,EAAMo9B,YAAc,QACjFxnB,EAAYlP,cAAgBhN,EAAWsG,EAAMq9B,iBAAoBr9B,EAAMq9B,gBAAkBhkC,iBAAiBsN,OAAOC,KAGjHgP,EAAY7O,gBAAgBrN,EAAWsG,EAAMs9B,iBAAmBt9B,EAAMs9B,eAGjE5jC,EAAWsG,EAAMu9B,YAClB3nB,EAAY/O,QAAU7G,EAAMu9B,UAI3B7jC,EAAWsG,EAAMw9B,YAClB5nB,EAAY9O,QAAU9G,EAAMw9B,WAIN,QAAzB5nB,EAAYzS,YACbyS,EAAY5O,WAAgBtN,EAAWsG,EAAMy9B,aAAgBz9B,EAAMy9B,YAAc,QACjF7nB,EAAY3O,cAAgBvN,EAAWsG,EAAM09B,iBAAoB19B,EAAM09B,gBAAkB,QAGpFhkC,EAAWsG,EAAM29B,YAClB/nB,EAAY1O,QAAUlH,EAAM29B,UAI3BjkC,EAAWsG,EAAMw9B,YAClB5nB,EAAYzO,QAAUnH,EAAM49B,WAgChC,CAAE,OAAQ,WAAY,MAAO,QAAS,QAAS,MAAO,SAAU,OAAQ,QAASt5B,SAAUsR,EAAYzS,YACvG,CAAE,SAAU,WAAYmB,SAAUsR,EAAY5b,YAC5C4b,EAAY3S,WAEd2S,EAAYnV,gBAAiB/G,EAAWsG,EAAM69B,kBAAoB79B,EAAM69B,gBAGxEjoB,EAAYnV,gBAAiB,EAIH,UAAzBmV,EAAYzS,YAObyS,EAAY7U,oBAAsBrH,EAAWsG,EAAM89B,uBAA0B99B,EAAM89B,wBAA0B,CAAE,SAAU,WAAYx5B,SAAUsR,EAAY5b,UAKtJ4b,EAAY7U,sBAEb6U,EAAYlT,YAAchJ,EAAW+D,EAAK+M,KAAL,UAAeoL,EAAYzV,WAA3B,aAAsD1C,EAAK+M,KAAL,UAAeoL,EAAYzV,WAA3B,YAAoD,IAI9IzG,EAAWsG,EAAM+9B,4BAClBnoB,EAAYtS,uBAAyBtD,EAAM+9B,0BAI1CrkC,EAAWsG,EAAMg+B,4BACjBpoB,EAAY5U,uBAAyBhB,EAAMg+B,2BAK/CpoB,EAAYvV,SACbuV,EAAYtV,YAAgB5G,EAAWsG,EAAMi+B,gBAAmBj+B,EAAMi+B,eAAiB,GACvFroB,EAAYvN,SAAgB3O,EAAWsG,EAAMqI,UAAarI,EAAMqI,SAAW,GAC3EuN,EAAYxN,cAAgBob,EAAWrmB,YAKlC5C,EAASqb,EAAYtV,eACtBsV,EAAYtV,YAAcN,EAAMg8B,cAKnC,CAAE,SAAU,SAAU13B,SAAUsR,EAAYzS,aAC7CyS,EAAYlU,QAAUhI,EAAWsG,EAAM0B,SAAY1B,EAAM0B,QAAU,IAIhEkU,GAMX,GAAyB,SAApB5V,EAAM68B,WAEPjnB,EAAc,CACVhV,QAAkBu7B,EAClBh8B,WAAkBH,EAAMg8B,YACxB74B,UAAkBnD,EAAM68B,WAExBL,QAAkBH,EAClB39B,OAAkBjB,EAAKM,GACvB/D,SAAkByD,EAAKzD,SAEvBkB,MAAkB8E,EAAM9E,MACxBkI,YAAkBpD,EAAMoD,YAExBK,UAAkB/J,EAAWsG,EAAM+8B,YAAe/8B,EAAM+8B,WAAa/8B,EAAM9E,MAE3EyF,aAAkBjH,EAAWsG,EAAMsH,WAAatH,EAAMsH,SAEtDgC,OAAQtJ,EAAMsJ,OAAOO,KAAI,SAAE4K,GACvB,OAAO8nB,EAAmB9nB,OAKlC6nB,EAAgB,IAAI4B,UAAatoB,QAEhC,GAAyB,YAApB5V,EAAM68B,WAA0B,CAEtC,IACIp/B,EAAK+M,KAAMxK,EAAMg8B,aAAgBz1B,KAAKC,MAAO/I,EAAK+M,KAAMxK,EAAMg8B,cAChE,MAAQ55B,IAGVwT,EAAc,CACVhV,QAAkBu7B,EAClBh8B,WAAkBH,EAAMg8B,YACxB74B,UAAkBnD,EAAM68B,WAExBL,QAAkBH,EAClB39B,OAAkBjB,EAAKM,GACvB/D,SAAkByD,EAAKzD,SAEvBkB,MAAkB8E,EAAM9E,MACxBkI,YAAkBpD,EAAMoD,YAExBK,UAAkB/J,EAAWsG,EAAM+8B,YAAe/8B,EAAM+8B,WAAa/8B,EAAM9E,MAE3EgG,aAAkBlB,EAAMg9B,cACxB9gC,aAAkBxC,EAAW+D,EAAK+M,KAAMxK,EAAMg8B,cAAkBv+B,EAAK+M,KAAMxK,EAAMg8B,aAAgBh8B,EAAMg9B,cAEvGr8B,aAAkBjH,EAAWsG,EAAMsH,WAAatH,EAAMsH,SAEtDwQ,cAAmBpe,EAAWsG,EAAMm+B,eAAiBn+B,EAAMm+B,aAE3D70B,OAAQtJ,EAAMsJ,OAAOO,KAAI,SAAE4K,GACvB,OAAO8nB,EAAmB9nB,OAK7B/a,EAAWsG,EAAMo+B,kBAClBxoB,EAAYqC,kBAAoBjY,EAAMo+B,gBAIrC1kC,EAAWsG,EAAMq+B,qBAClBzoB,EAAY8B,qBAAuB1X,EAAMq+B,mBAI7C/B,EAAgB,IAAIgC,UAAgB1oB,QAKpCA,EAAc2mB,EAAmBv8B,GAGjCs8B,EAAgB,IAAIhgC,UAAOsZ,EAAYzS,UAAWyS,GAAa,GAInEwmB,EAAqB3xB,KAAM6xB,MAI/B,IAAI7e,EAAU,GAGT/jB,EAAW8pB,EAAW/F,UAEvBniB,SAAQkoB,EAAW/F,SAAS,SAAEjY,EAAOwW,GAE5BA,EAAOuiB,SAAWpC,GACnB1e,EAAQhT,KAAMuR,MAM1BkgB,EAAiBC,GAAa,CAC1B7yB,OAAS8yB,EACTnnB,SAAS,EACTwI,QAASA,MAKjBse,EAAY,CACR3/B,GAAiBqB,EAAKM,GACtB/D,SAAiByD,EAAKzD,SACtByE,SAAiBA,EACjBF,gBAAiBilB,EAAWrmB,YAC5B8lB,OAAqC,WAApBxlB,EAAK+mB,YACtB9iB,QAAiBw6B,EACjB1xB,KAAiB/M,EAAK+M,KACtB4X,WAAiB,EACjBoc,OAAiB9kC,EAAW+D,EAAK+gC,QAAW/gC,EAAK+gC,OAAS,GAC1DhW,UAAiB9uB,EAAW8pB,EAAWib,YAAejb,EAAWib,WAAa,GAC9EC,aAAiBhlC,EAAW8pB,EAAWmb,eAAkBnb,EAAWmb,cAAgB,IAInFjlC,EAAW8pB,EAAWV,WACvBiZ,EAAUjZ,QAAUU,EAAWV,SAMnC,IAAIxZ,EAAS,GAGbhO,SAAQ4gC,GAAiB,SAAU0C,EAAWl9B,GAC1CpG,SAAQoG,EAAQ4H,QAAQ,SAAU9D,EAAOxF,GACrCsJ,EAAQtJ,EAAMiJ,gBAAgB9I,YAAeH,QAIrD1E,SAAQgO,GAAQ,SAAE9D,EAAOxF,GACrB,IAAIE,EAAkBF,EAAMiJ,gBACnBvP,EAAWqiC,EAAUvxB,KAAMtK,EAAgBC,eAAkB5F,EAASwhC,EAAUvxB,KAAMtK,EAAgBC,cAAsB5F,EAAS2F,EAAgBhE,gBAC1J6/B,EAAUvxB,KAAMtK,EAAgBC,YAAeD,EAAgBhE,iBAMlE4/B,IACDC,EAAUrD,iBAAkBh/B,EAAW8pB,EAAWqb,sBAAwBrb,EAAWqb,0BAwDzF9C,EAAY,CACR3/B,GAAiBqB,EAAKM,GACtB/D,SAAiByD,EAAKzD,SACtByE,SAAiBhB,EAAK+M,KAAKvO,KAC3BsC,gBAAiBd,EAAK+M,KAAKrN,YAC3B8nB,gBAAiBxnB,EAAK+M,KAAKvN,iBAC3BI,SAAiBI,EAAK+M,KAAKnN,SAC3B4lB,OAAqC,WAApBxlB,EAAK+mB,YACtBga,OAAiB,GACjB98B,QAAiB,GACjB8I,KAAiB/M,EAAK+M,KACtB4X,WAAiB,GAKhB0Z,IACDC,EAAUrD,iBAAkBh/B,EAAW+D,EAAK+M,KAAKq0B,sBAA2D,QAAjCphC,EAAK+M,KAAKq0B,qBAK7F/kC,EAAa,MAAOiiC,MAInBD,EAAmB,CAEpBziC,iBAAiBI,OAAOi/B,iBAAkB,EAG1C,IAAMoG,EAAiBhlC,EAAa,MAAO,CACvCC,OAAQ,CACJC,SAAU,aAKbygB,OAAOqM,KAAMgY,GAAmB,IAEjCzlC,iBAAiBI,OAAOi/B,iBAAkB,EAG1Cp9B,SAAQwjC,GAAgB,SAAEt5B,EAAO5H,GAG7BvE,iBAAiBI,OAAOi/B,gBAAkBr/B,iBAAiBI,OAAOi/B,iBAAmB96B,EAAQ86B,sBAMjHh/B,EAAW4F,EAAW6V,WAAgBzb,EAAW4F,EAAW6V,WAAc7V,EAAW6V,WAE5EygB,EAAc,gBAGd,CAED,IAAImJ,EAAoBx4B,KAAKmP,UAAWspB,EAAiB1/B,EAAYq8B,IACrExiC,QAAQiM,MAAO1B,EAAU,sCAAuC,CAAE,eAAgBq7B,KAGtF,MAEJ,IAAK,WAED,IAAIE,GAAgB,EAIpB3jC,SAAQjC,iBAAiBI,OAAOylC,SAAS,SAAUllC,EAAUgpB,GAEzD3pB,iBAAiBI,OAAOylC,QAASllC,IAAa,KAIlDsB,SAAQjC,iBAAiBI,OAAO6E,OAAO,SAAUe,EAAQ8/B,GAEhDA,EAASlc,SACV5pB,iBAAiBI,OAAOylC,QAASC,EAASnlC,WAAa,MAK/DsB,SAAQjC,iBAAiBI,OAAO6E,OAAO,SAAUe,EAAQ8/B,GAGrD,IAAIC,GAAc,EAGlB9jC,SAAQ6jC,EAASz9B,SAAS,SAAU29B,EAAgBC,GAGhD,IAAIC,GAAe,EAGnBjkC,SAAQgkC,EAAiBh2B,QAAQ,SAAU9D,EAAOxF,GAExBA,EAAMmV,UAAU,GAGfF,UACnBsqB,GAAe,MAKvBlmC,iBAAiBI,OAAO6E,MAAOe,GAASqC,QAAS29B,GAAiBpqB,QAAUsqB,EAGrEA,IACHH,GAAc,MAItB/lC,iBAAiBI,OAAO6E,MAAOe,GAAS4V,QAAUmqB,EAG7CD,EAASlc,SAAYmc,IACtBH,GAAgB,MAOjB5lC,iBAAiBI,OAAOylC,QAAQthC,QAQE,aAAhCvE,iBAAiBI,OAAOF,MAAyBF,iBAAiBI,OAAO+7B,aAAavgB,QAShF5b,iBAAiBI,OAAOylC,QAAQ9kC,QAAYf,iBAAiBI,OAAOylC,QAAQzjC,QAQxEpC,iBAAiBI,OAAOylC,QAAQthC,SAAevE,iBAAiBI,OAAOylC,QAAQ9kC,QAAYf,iBAAiBI,OAAOylC,QAAQzjC,UAE9HpC,iBAAiBI,OAAOyb,QAAQ9P,MAAQ/L,iBAAiBc,KAAKyI,WAAWnJ,OAAO+lC,YATpFP,GAAgB,EAGhB5lC,iBAAiBI,OAAOyb,QAAQ9P,MAAQ/L,iBAAiBc,KAAKyI,WAAWnJ,OAAOgmC,YAXpFR,GAAgB,EAGhB5lC,iBAAiBI,OAAOyb,QAAQ9P,MAAQ/L,iBAAiBc,KAAKyI,WAAWnJ,OAAO+7B,eAZpFyJ,GAAgB,EAGhB5lC,iBAAiBI,OAAOyb,QAAQ9P,MAAQ/L,iBAAiBc,KAAKyI,WAAWnJ,OAAOimC,YA6BpFrmC,iBAAiBI,OAAOwb,QAAUgqB,EAG7BA,IAED5lC,iBAAiBI,OAAOyb,QAAQ9P,MAAQ,IAI5C9H,GAAW,OAOnBnE,QAAQiM,MAAO1B,EAAU,qCAAsC,CAAE,eAAgBtJ,KAGrF,OAAOkD,EAmBJ,SAASxD,IAA6C,IAAhCM,EAAgC,uDAAvB,KAAMkF,EAAiB,uDAAJ,GAEjDhC,GAAe,EAGfo+B,EAAe,CAAE,MAAO,SAAU,QAAS,QAAS,SAAU,OAGlE,GAAKhiC,EAAWU,IAAYwF,EAASxF,EAAQshC,GAEzC,OAASthC,GACL,IAAK,MAEDkF,EAAahE,WAAS,CAClB2Z,SAAS,EACTgO,QAAQ,GACT3jB,GAGH,IAAIq8B,EAAe,CAAE,KAAM,YAG3B,GAAK/7B,EAAS+7B,EAAclhB,OAAOqM,KAAMxnB,IAG9B5F,EAAWL,iBAAiBI,OAAO6E,MAAOgB,EAAWlD,OAGxD/C,iBAAiBI,OAAO6E,MAAOgB,EAAWlD,IAAOkD,EAGjDxF,EAAa,QAAS,IAGtBwD,GAAW,OAGd,CAED,IAAIyhC,EAAoBx4B,KAAKmP,UAAWspB,EAAiB1/B,EAAYq8B,IACrExiC,QAAQiM,MAAO1B,EAAU,sCAAuC,CAAE,cAAeq7B,KAGrF,MAEJ,IAAK,SAKMxkC,GAJP+E,EAAahE,WAAS,CAClB2Z,SAAS,GACV3V,IAEwBlD,IAcvBjD,QAAQiM,MAAO1B,EAAU,sBAAuB,CAAE,iBAZ7ChK,EAAWL,iBAAiBI,OAAO6E,MAAOgB,EAAWlD,aAC/C/C,iBAAiBI,OAAO6E,MAAOgB,EAAWlD,IAGjDkB,GAAW,GAGXnE,QAAQiM,MAAO1B,EAAU,iDAAmD,CAAE,cAAepE,EAAWlD,MAQhH,MAEJ,IAAK,QAGD,IAAIkC,EAAQ,GAEZhD,SAAQjC,iBAAiBI,OAAO6E,OAAO,SAAUkH,EAAO5D,GAC/ClI,EAAWkI,KACZtD,EAAOkH,GAAU5D,MAIzBvI,iBAAiBI,OAAO6E,MAAQA,EAGhChB,GAAW,EAEX,MAEJ,IAAK,SAGM/C,EAAS+E,EAAWlD,IAiBvBjD,QAAQiM,MAAO1B,EAAU,sBAAuB,CAAE,iBAf7ChK,EAAWL,iBAAiBI,OAAO6E,MAAOgB,EAAWlD,MAGtD/C,iBAAiBI,OAAO6E,MAAOgB,EAAWlD,IAAOd,WAAU,GAAIjC,iBAAiBI,OAAO6E,MAAOgB,EAAWlD,IAAMkD,GAG/GhC,GAAW,GAIXnE,QAAQiM,MAAO1B,EAAU,iDAAmD,CAAE,cAAepE,EAAWlD,MAQhH,MAEJ,IAAK,QAED/C,iBAAiBI,OAAO6E,MAAQ,GAGhChB,GAAW,EACX,MAEJ,IAAK,MAED,GAAO/C,EAAS+E,EAAWvF,QAuBvBuD,EAAWjE,iBAAiBI,OAAO6E,UAvBF,CAEjC,IAAIA,EAAQ,GAEZhD,SAAQjC,iBAAiBI,OAAO6E,OAAO,SAAUI,EAAQjB,GACrD,IAAIkiC,GAAe,EAEnBrkC,SAAQgE,EAAWvF,QAAQ,SAAUyB,EAAKoG,GACjCnE,EAAMjC,IAASoG,IAChB+9B,GAAe,MAKlBA,IACDrhC,EAAOI,GAAWjB,MAK1BH,EAAWgB,QAWvBnF,QAAQiM,MAAO1B,EAAU,qCAAsC,CAAE,cAAetJ,KAGpF,OAAOkD,EAUJ,SAASg+B,IAEZ7gB,OAAOC,QAASrhB,iBAAiB6D,cAAewN,SAAQ,YAAoC,aAAjCnK,EAAiC,KAGpFsa,GAHoF,KAGzE,CACP+kB,UAAa1kB,EAAkC7hB,iBAAiBwhB,SAAS9gB,QAAQ,SAAA0D,GAAI,OAAIA,EAAKN,aAAeoD,KAAiB,sBAAsB,SAAAlD,GAAQ,OAAIolB,EAAoBplB,MACpLwiC,YAAa,KAEjBhmC,EAAW,CACP+lC,UAAa1kB,EAAkC7hB,iBAAiBQ,QAAQE,QAAQ,SAAA0D,GAAI,OAAIA,EAAKN,aAAeoD,KAAiB,sBAAsB,SAAAlD,GAAQ,OAAIolB,EAAoBplB,MACnLwiC,YAAa,IAGdnmC,EAAWL,iBAAiBM,KAAUN,iBAAiBM,IAGtDD,EAAWL,iBAAiBymC,cAC5BpmC,EAAWL,iBAAiBymC,YAAav/B,MAIzCsa,EAASglB,YAAc3kB,EAAkC7hB,iBAAiBymC,YAAav/B,GAAgBsa,SAAS9gB,QAAQ,SAAA6D,GAAO,MAAoB,aAAhBA,EAAQrE,QAAuB,QAAQ,SAAA8D,GAAQ,OAAIolB,EAAoBplB,MAI1MxD,EAAQgmC,YAAe3kB,EAAkC7hB,iBAAiBymC,YAAav/B,GAAgB1G,QAAS,QAAQ,SAAAwD,GAAQ,OAAIolB,EAAoBplB,OAOhKwd,EAASG,eAAqBH,EAAS+kB,UAAUG,OAAO,SAAAtiC,GAAI,QAAI/D,EAAW+D,EAAKuiC,SAAWviC,EAAKuiC,UAChGnmC,EAAQmhB,eAAsBnhB,EAAQ+lC,UAAUG,OAAO,SAAAtiC,GAAI,QAAI/D,EAAW+D,EAAKuiC,SAAWviC,EAAKuiC,UAG/FnlB,EAASE,kBAAqBF,EAAS+kB,UAAUx1B,OAAS,EAC1DvQ,EAAQkhB,kBAAsBlhB,EAAQ+lC,UAAUx1B,OAAS,EAGzDyQ,EAASolB,oBAAsBplB,EAASglB,YAAYz1B,OAAS,EAC7DvQ,EAAQomC,oBAAuBpmC,EAAQgmC,YAAYz1B,OAAS,EAG5DyQ,EAASC,YAAcD,EAASE,mBAAqBF,EAASglB,YAAYz1B,OAAS,EACnFvQ,EAAQohB,WAAephB,EAAQkhB,mBAAqBlhB,EAAQgmC,YAAYz1B,OAAS,EAGjF/Q,iBAAiB6D,aAAcqD,GAAgBjC,MAAQ,CACnDuc,SAAUA,EACVhhB,QAAUA,MAaf,SAASqhB,IAA8E,IAA5C5c,EAA4C,uDAApC,GAAI4hC,EAAgC,uDAAZ,GAAInmC,EAAQ,uCAmC1F,OAjCOL,EAAWK,KACdA,EAAS,SAAA6H,GAAK,OAAIA,IAIjBsS,MAAMqB,QAASjX,KAAa/D,EAAS+D,KAEtCA,EAAQA,EAAM6hC,MAAK,SAAEC,EAAGC,GAEpB,IAAIC,EAAU,EAGd,GAAK5mC,EAAW0mC,EAAGF,KAAyBxmC,EAAW2mC,EAAGH,IAAuB,CAE7E,IAAIK,EAASxmC,EAAQqmC,EAAGF,IACpBM,EAASzmC,EAAQsmC,EAAGH,IASxBI,GADAA,GALAA,EAAUC,EAAOE,cAAeD,IAKZ,EAAI,EAAIF,GACR,GAAK,EAAIA,EAIjC,OAAOA,MAKRhiC,EAWJ,SAASoiC,IAA2E,IAApDngC,EAAoD,uDAApC,GAAIvG,EAAgC,uDAArB,WAAY0H,EAAS,uCAEvFA,EAAU+Y,OAAOkmB,OAAO,CACpBC,oBAAoB,GACrBl/B,GAGH,IAAIpD,EAAQ,CACRshC,UAAW,GACXC,YAAa,IA2BjB,MAlBK,CAAE,WAAY,WAAYv7B,SAH/BtK,EAAuB,WAFvBA,EAAuB,WAAZA,EAAwB,WAAaA,GAEd,UAAYA,KAKnCO,EAASgG,IAEP7G,EAAWL,iBAAiB6D,aAAcqD,MAE3CjC,EAAQhD,YAAU,EAAM,GAAIjC,iBAAiB6D,aAAcqD,GAAgBjC,MAAOtE,IAG3E0H,EAAQk/B,qBAEXtiC,EAAQsc,EAAuBtc,MAOxCA,EASJ,SAASsc,EAAuBtc,GAkBnC,OAhBAA,EAAMshC,UAAYthC,EAAMshC,UAAU7lC,QAAQ,SAAA0D,GAAI,OAAMA,EAAKojC,iBAGzDviC,EAAMyc,kBAAoBzc,EAAMshC,UAAUx1B,OAAS,EAG9C1Q,EAAW4E,EAAMwc,aAClBxc,EAAMwc,YAAcxc,EAAMyc,mBAAqBzc,EAAMuhC,YAAYz1B,OAAS,EAEpE1Q,EAAW4E,EAAM2c,cACvB3c,EAAM2c,WAAc3c,EAAMyc,mBAAqBzc,EAAMuhC,YAAYz1B,OAAS,GAI9E9L,EAAM0c,eAAiB1c,EAAMshC,UAAUG,OAAO,SAAAtiC,GAAI,QAAI/D,EAAW+D,EAAKuiC,SAAWviC,EAAKuiC,UAE/E1hC,EASJ,SAASo3B,IAAoD,IAAhCt7B,EAAgC,uDAAvB,KAAMkF,EAAiB,uDAAJ,GAExDhC,GAAe,EAGfo+B,EAAe,CAAE,WAAY,WAAY,aAAc,gBAAiB,gBAM5E,GAHqBriC,iBAAiBI,OAAO+7B,aAGxC97B,EAAWU,IAAYwF,EAASxF,EAAQshC,GAAgB,CAEzD,IAAIC,EAAe,GAEnB,OAASvhC,GAWL,IAAK,WAKD,GAAKwF,EAHL+7B,EAAe,CAAE,QAGWlhB,OAAOqM,KAAMxnB,IAErCjG,iBAAiBI,OAAO+7B,aAAaC,KAAOn2B,EAAWm2B,SAEtD,CAED,IAAIsJ,EAAoBx4B,KAAKmP,UAAWspB,EAAiB1/B,EAAYq8B,IACrExiC,QAAQiM,MAAO1B,EAAU,sCAAuC,CAAE,qBAAsBq7B,KAG5F,MAEJ,IAAK,WAGD,IAAItJ,EAAO,gBAGN/7B,EAAWL,iBAAiBI,OAAO+7B,aAAaC,MAEjDA,EAAOp8B,iBAAiBI,OAAO+7B,aAAaC,KAKrCl7B,EAASlB,iBAAiBI,OAAO+7B,aAAalsB,OAAQjQ,iBAAiBI,OAAO+7B,aAAaa,WAE9FZ,EAAO,gBAIPp8B,iBAAiBI,OAAO+7B,aAAavgB,SAAU,GAKvD3X,EAAWm4B,EAEX,MAEJ,IAAK,aAKD,GAAK71B,EAHL+7B,EAAe,CAAE,UAGWlhB,OAAOqM,KAAMxnB,IAErCjG,iBAAiBI,OAAO+7B,aAAaa,OAAS/2B,EAAW+2B,WAExD,CAED,IAAI0I,EAAoBx4B,KAAKmP,UAAWspB,EAAiB1/B,EAAYq8B,IACrExiC,QAAQiM,MAAO1B,EAAU,sCAAuC,CAAE,qBAAsBq7B,KAG5F,MAEJ,IAAK,gBAKD,GAAKn/B,EAHL+7B,EAAe,CAAE,SAAU,UAGClhB,OAAOqM,KAAMxnB,IAEhC,CAAE,eAAgB,WAAYgF,SAAUhF,EAAW+2B,SAE/C97B,EAASlB,iBAAiBI,OAAO+7B,aAAalsB,UAC/CjQ,iBAAiBI,OAAO+7B,aAAalsB,OAAS,CAC1CutB,aAAc,GACdqB,QAAS,KAKjB7+B,iBAAiBI,OAAO+7B,aAAalsB,OAAQhK,EAAW+2B,QAAW/6B,WAAU,GAAIjC,iBAAiBI,OAAO+7B,aAAalsB,OAAQhK,EAAW+2B,QAAU/2B,EAAWgK,SAI9JnQ,QAAQiM,MAAO1B,EAAU,4DAA6D,CAAE,qBAAsB,CAAE,eAAgB,kBAGnI,CAED,IAAIq7B,EAAoBx4B,KAAKmP,UAAWspB,EAAiB1/B,EAAYq8B,IACrExiC,QAAQiM,MAAO1B,EAAU,sCAAuC,CAAE,qBAAsBq7B,KAG5F,MAEJ,IAAK,eAED1lC,iBAAiBI,OAAO+7B,aAAalsB,OAAS,CAC1CutB,aAAc,GACdqB,QAAS,UAOrB/+B,QAAQiM,MAAO1B,EAAU,qCAAsC,CAAE,qBAAsBtJ,KAG3F,OAAOkD,EAaJ,SAAS+9B,IAEP,CAAE,OAAQ,aAAc/2B,SAAUjL,iBAAiBI,OAAOF,QAEtDF,iBAAiBynC,IAAIC,YAEtB5F,EAAiB,0BAA0B,EAAM,CAC7C6F,eAAe,IAInB7nC,QAAQC,IAAKsK,EAAU,0BAA2B,CAAErK,iBAAiBI,OAAOF,SAIhFF,iBAAiBwhB,SAAWxhB,iBAAiBwhB,SAAS9gB,QAAO,SAAE6D,GAgB3D,OAdKvE,iBAAiBynC,IAAIC,YAEtB5nC,QAAQC,IAAKwE,GAGRA,EAAQrE,MAAQF,iBAAiBI,OAAOF,KACzC0nC,EAAkB,UAAW,QAG7BA,EAAkB,QAAS,WAK5BrjC,EAAQrE,MAAQF,iBAAiBI,OAAOF,QAI9CF,iBAAiBynC,IAAIC,WAEtB5nC,QAAQ+nC,YAmBb,SAASrkC,IAAuF,IAA7E2D,EAA6E,uDAAlE,KAAM6L,EAA4D,uDAArD,KAAM80B,EAA+C,uDAAnC,KAAMC,EAA6B,uDAApB,KAAM1/B,EAAc,uDAAJ,GAE3F2/B,EAAiB,CAAE,MAAO,SAAU,SAAU,qBAAsB,6BAA8B,iCAAkC,oBAAqB,0BAA2B,gBAAiB,mBAAoB,kBAAmB,mBAGhP3/B,EAAUpG,WAAS,GAAI,CACnB,uBAAyB,EACzB,UAAyB,GAC1BoG,GAGE9B,EAASY,EAAU6gC,GAGpB/lC,SAAO,CACHgmC,OAAU,OACV1Z,IAAK,GAAF,OAAWvuB,iBAAiBkoC,QAA5B,YAAwC/gC,EAAxC,KACH6L,KAAU/Q,UAAS+Q,GAAS,IAAM/Q,UAAQ,CAAEkmC,WAAY,IACxDC,SAAU,OAGVC,WAAY,SAAUC,GAClBA,EAAIC,iBAAkB,aAAcvoC,iBAAiBwoC,QAGzD7P,QAAS,SAAU10B,GAEVjE,iBAAiBynC,IAAIC,YACtB5F,EAAiB,eAAe,EAAM,CAClC6F,eAAe,IAEnB7nC,QAAQC,IAAR,oBAA2BoH,IAC3BrH,QAAQC,IAAK,SACbD,QAAQC,IAAKiT,GACblT,QAAQC,IAAK,aACbD,QAAQC,IAAKkE,GACbnE,QAAQ+nC,YAIP5jC,EAAS00B,QAELt4B,EAAW4D,EAASk+B,kBAAsB95B,EAAQ8yB,sBAE9C96B,EAAWynC,KAEPz/B,EAAQ+yB,UACTmB,EAAc,SAAU,CACpB2F,WAAYj+B,EAASk+B,iBAK7B2F,EAAW7jC,KAKfnE,QAAQiM,MAAO,mEAGV1L,EAAW0nC,IAEZA,EAAQ9jC,KAMhBnE,QAAQiM,MAAO,mDAIV1L,EAAW0nC,IAEZA,EAAQ9jC,KAKpBwkC,WAAY,CACRC,IAAK,SAAUzkC,GAENjE,iBAAiBynC,IAAIC,YACtB5F,EAAiB,gBAAgB,EAAM,CACnC6F,eAAe,IAEnB7nC,QAAQC,IAAK,SACbD,QAAQC,IAAKiT,GACblT,QAAQC,IAAK,YACbD,QAAQC,IAAK,uBAAwB,cACrCD,QAAQ+nC,YAGPxnC,EAAW0nC,IACZA,EAAQ9jC,KAKpB8H,MAAO,SAAU48B,EAAOC,EAAYC,GAE3B7oC,iBAAiBynC,IAAIC,YACtB5F,EAAiB,gBAAgB,EAAM,CACnC6F,eAAe,IAEnB7nC,QAAQC,IAAK,SACbD,QAAQC,IAAKiT,GACblT,QAAQC,IAAK,YACbD,QAAQC,IAAK,kBAAmB,cAChCD,QAAQ+nC,YAGPxnC,EAAW0nC,IACZA,EAAO,CACHpP,SAAS,KAKrBmQ,KAAM,SAAW7kC,GAERjE,iBAAiBynC,IAAIC,YACtB5F,EAAiB,gBAAgB,EAAM,CACnC6F,eAAe,IAEnB7nC,QAAQC,IAAK,SACbD,QAAQC,IAAKiT,GACblT,QAAQC,IAAK,YACbD,QAAQC,IAAK,kBAAmB,cAChCD,QAAQ+nC,YAGPxnC,EAAW0nC,IACZA,EAAQ9jC,MAMpBnE,QAAQiM,MAAO1B,EAAU,8DAA+D,CAAElD,EAAU6gC,EAAeh7B,KAAM,SAgB1H,SAASmC,IAA0E,IAA7DpO,EAA6D,uDAApD,KAAMiS,EAA8C,uDAAvC,KAAM80B,EAAiC,uDAArB,KAAMC,EAAe,uDAAN,KAG3E1nC,EAAWU,IAEZiS,EAAO/Q,YAAU,EAAM+Q,EAAM,CACzBjS,OAAQA,EACRynC,MAAOxoC,iBAAiBwoC,QAI5BvmC,SAAO,CACHgmC,OAAU,OACVG,SAAU,OACV7Z,IAAUwa,QACV/1B,KAAUA,EAEV2lB,QAAS,SAAU10B,GAEVjE,iBAAiBynC,IAAIC,YACtB5F,EAAiB,eAAe,EAAM,CAClC6F,eAAe,IAEnB7nC,QAAQC,IAAK,SACbD,QAAQC,IAAKiT,GACblT,QAAQC,IAAK,YACbD,QAAQC,IAAKkE,GACbnE,QAAQ+nC,YAIPxnC,EAAW4D,EAAS0mB,SAA+B,eAAnB1mB,EAAS0mB,OAC1CkR,SAASC,SAIJz7B,EAAWynC,IAEZA,EAAW7jC,EAAU+O,IAKjCy1B,WAAY,CACRC,IAAK,WAEI1oC,iBAAiBynC,IAAIC,YACtB5F,EAAiB,gBAAgB,EAAM,CACnC6F,eAAe,IAEnB7nC,QAAQC,IAAK,SACbD,QAAQC,IAAKiT,GACblT,QAAQC,IAAK,YACb+hC,EAAiB,sBAAsB,EAAO,CAAEkH,QAAS,YACzDlpC,QAAQ+nC,YAGPxnC,EAAW0nC,IACZA,EAAQ9jC,UAIP5D,EAAW0nC,IAEZA,EAAQ9jC,YAKpB6kC,KAAM,SAAW7kC,GAERjE,iBAAiBynC,IAAIC,YACtB5F,EAAiB,gBAAgB,EAAM,CACnC6F,eAAe,IAEnB7nC,QAAQC,IAAK,SACbD,QAAQC,IAAKiT,GACblT,QAAQC,IAAK,YACbD,QAAQC,IAAK,kBAAmB,cAChCD,QAAQ+nC,YAGPxnC,EAAW0nC,IACZA,EAAQ9jC,OASpBnE,QAAQiM,MAAO,4DAahB,SAAS4D,EAAwBtK,GACpC,IAAIqK,EAAS,GA+Bb,OA5BAzN,SAAQjC,iBAAiBI,OAAO6E,MAAOI,GAASgD,SAAS,SAAE8D,EAAO88B,GAE9DhnC,SAAQgnC,EAAch5B,QAAQ,SAAE9D,EAAOxF,GAEnC,IAAIwS,EAAaxS,EAAM+U,aACnBxK,EAAavK,EAAMrD,WAGhBjD,EAAW6Q,KACdA,EAAavK,EAAMiJ,gBAAgB/M,cAIC,UAAnC8D,EAAMiJ,gBAAgB9F,WAAuC,0BAAdoH,IAChDxB,EAAO,GAAD,OAAMyJ,EAAN,YAA4BxS,EAAMkJ,wBAI5CH,EAAQyJ,GAAYjI,EAGbhQ,EAASgQ,IAAmD,UAAnCvK,EAAMiJ,gBAAgB9F,YAElD4F,EAAO,GAAD,OAAMyJ,EAAN,cAA8BxS,EAAM6mB,0BAK/C9d,EAcJ,SAASpB,EAAUjJ,EAAQ8T,GAC9B,IAAIxS,EAUJ,OARA1E,SAAQjC,iBAAiBI,OAAO6E,MAAOI,GAASgD,SAAS,SAAU6gC,EAAgBC,GAC/ElnC,SAAQknC,EAAal5B,QAAQ,SAAU9D,EAAO82B,GACrC9pB,GAAW8pB,EAAcvnB,eAC1B/U,EAAQs8B,SAKbt8B,EAcJ,SAASsiB,IAAiE,IAC5EljB,EAD0BmB,EAAkD,uDAAlC,GAAIvG,EAA8B,uDAAnB,GAAIyE,EAAe,uDAAJ,GAI5E,IAAOlE,EAASgG,KAAqBhG,EAASP,KAAgBO,EAASkE,GAAY,CAClF,IAAIgkC,EAAmB,GAGvB,GAAiB,WAAZzoC,GAAqC,UAAZA,GAE7B,GAAKN,EAAWL,iBAAiB6D,aAAcqD,IAAmB,CAEjE,IAAIpD,EAAc9D,iBAAiB6D,aAAcqD,GAG5C7G,EAAWyD,EAAYmB,OAE3BmkC,EAA+B,WAAZzoC,EAAwBmD,EAAYmB,MAAMuc,SAAS+kB,UAAYziC,EAAYmB,MAAMzE,QAAQ+lC,UAG5GzmC,QAAQC,IAAK,oCAAqC,0EAI/B,WAAZY,IACTyoC,EAAmBppC,iBAAiBkC,UAIrCD,SAAQmnC,GAAkB,SAAUj9B,EAAO/H,GAC1C,GAAKA,EAAKxB,MAAQwC,EAKhB,OAHDW,EAAU3B,GAGF,KAMX,OAAO2B,EAeD,SAAS9F,EAAgBopC,GAA0B,IAAjBpjC,EAAiB,uDAAJ,GAE9ChC,EAAW,GAGXqlC,EAAgB,CAAE,UAAW,QAAS,OAAQ,cAAe,WAAY,iBAG7E,GAAKjpC,EAAWgpC,IAAa9iC,EAAS8iC,EAASC,GAAiB,CAE5D,IAAIhH,EAAe,GAEnB,OAAS+G,GACL,IAAK,UAQD,GANApjC,EAAahE,WAAS,GAAIgE,GAMrBM,EAHL+7B,EAAe,CAAE,QAGWlhB,OAAOqM,KAAMxnB,IAAgB,CACrDA,EAAWsjC,qBAGa,WAAnBtjC,EAAW/F,KACZ+F,EAAWsjC,qBAAuB,sBAET,UAAnBtjC,EAAW/F,OACjB+F,EAAWsjC,qBAAuB,sBAGtC,IAAIvnC,EAAWC,IAAGgE,EAAWsjC,sBAE7BtlC,EAAWjC,MAEV,CAED,IAAI0jC,EAAoBx4B,KAAKmP,UAAWspB,EAAiB1/B,EAAYq8B,IACrExiC,QAAQiM,MAAO1B,EAAU,sCAAuC,CAAE,cAAeq7B,KAGrF,MAEJ,IAAK,QAQD,GANAz/B,EAAahE,WAAS,GAAIgE,GAMrBM,EAHL+7B,EAAe,CAAE,QAGWlhB,OAAOqM,KAAMxnB,IAAgB,CACrD,IAAI2pB,EAAU3vB,EAAgB,UAAW,CACrCC,KAAM+F,EAAW/F,OAIjBspC,EAAS5Z,EAAQvrB,KAAM,yEAG3BJ,EAAWulC,MAEV,CAED,IAAI9D,EAAoBx4B,KAAKmP,UAAWspB,EAAiB1/B,EAAYq8B,IACrExiC,QAAQiM,MAAO1B,EAAU,sCAAuC,CAAE,cAAeq7B,KAGrF,MAEJ,IAAK,OAQD,GANAz/B,EAAahE,WAAS,GAAIgE,GAMrBM,EAHL+7B,EAAe,CAAE,MAGWlhB,OAAOqM,KAAMxnB,IAAgB,CAErDA,EAAWwjC,YAAc,uBAAyBxjC,EAAWlD,GAAK,KAGlE,IAAI+B,EAAQ7C,IAAGgE,EAAWwjC,aACtBC,EAAoB5kC,EAAMT,KAAM,kBAGpCJ,EAASG,KAAOU,EAChBb,EAASioB,iBAAmBwd,MAE3B,CAED,IAAIhE,EAAoBx4B,KAAKmP,UAAWspB,EAAiB1/B,EAAYq8B,IACrExiC,QAAQiM,MAAO1B,EAAU,sCAAuC,CAAE,cAAeq7B,KAGrF,MAEJ,IAAK,cAQD,GANAz/B,EAAahE,WAAS,GAAIgE,GAMrBM,EAHL+7B,EAAe,CAAE,SAAU,WAGClhB,OAAOqM,KAAMxnB,IAAgB,CAErD,IAAI7B,EAAOnE,EAAgB,OAAQ,CAAE8C,GAAIkD,EAAWD,SAAW5B,KAG/D6B,EAAW0jC,6BAA+B,qCAAuC1jC,EAAWwkB,QAAU,KACtGxkB,EAAW2jC,6BAA+B,0CAA4C3jC,EAAWwkB,QAAU,KAE3G,IAAIof,EAAoBzlC,EAAKC,KAAM4B,EAAW0jC,8BAC1CG,EAAoB1lC,EAAKC,KAAM4B,EAAW2jC,8BAC1C33B,EAAoB7N,EAAKC,KAAM,iBAEnCJ,EAAS8lC,gBAAmBF,EAC5B5lC,EAASooB,gBAAmByd,EAC5B7lC,EAAS+lC,iBAAmB/3B,MAE3B,CAED,IAAIyzB,EAAoBx4B,KAAKmP,UAAWspB,EAAiB1/B,EAAYq8B,IACrExiC,QAAQiM,MAAO1B,EAAU,sCAAuC,CAAE,cAAeq7B,KAGrF,MAEJ,IAAK,WAQD,GANAz/B,EAAahE,WAAS,GAAIgE,GAMrBM,EAHL+7B,EAAe,CAAE,QAGWlhB,OAAOqM,KAAMxnB,IAAgB,CAErD,IAAI2pB,EAAU3vB,EAAgB,UAAW,CACrCC,KAAM+F,EAAW/F,OAIjB2f,EAAW+P,EAAQvrB,KAAM,yEAA0E4lC,OAEvGhmC,EAAW4b,MAEV,CAED,IAAI6lB,EAAoBx4B,KAAKmP,UAAWspB,EAAiB1/B,EAAYq8B,IACrExiC,QAAQiM,MAAO1B,EAAU,sCAAuC,CAAE,cAAeq7B,KAGrF,MAEJ,IAAK,gBAEDzhC,EAAWhC,IAAG,wBAOtBnC,QAAQiM,MAAO1B,EAAU,sCAAuC,CAAE,iBAAkBg/B,KAGxF,OAAOplC,EAYJ,SAASuC,IAIZ,MAFsB,CAAE,SAAU,WAAY,OAAQ,MAAO,QAAS,MAAO,QAAS,WAAY,QAAS,QAAS,OAAQ,OAAQ,YAwBjI,SAAS4jB,IAA8E,IAAvDhmB,EAAuD,uDAAhD,KAAM8lC,EAA0C,uDAAjC,GAAIl3B,EAA6B,uDAAtB,GAChE/O,EAAW,KA0BX,GAfAA,EAAW,CACPkmC,MAAY,GACZ3e,SAAY,GACZhgB,KAAYvJ,IAAG,UACfF,SAAY,CACRqoC,OAAQ,GACR/f,MAAO,IAEXggB,MAAO,KAOJnpC,EAHPgpC,EAASA,EAAOj5B,QAGU,CAEtB,IA6EIq5B,EA7EAC,EAAe,IAAIC,OAAQ,mBAC3BC,EAAe,GACftF,EAAe,GACfuF,EAAeR,EAGfS,EAAc,EAiDdC,GA9CJV,EAASA,EAAO52B,QAASi3B,GAAa,SAAUM,EAAYxgB,GACxD,IAsBQygB,EAtBJC,EAAa1gB,EAAM4R,MAAO,KAGxB+O,EAAuBD,EAAY,GAGnCE,EAAeF,EAAY,GAI3BvgB,EAAYnqB,EAAW0qC,EAAY,IAAQA,EAAY,GAAME,EAgCnE,OA9BA5gB,EAAQ,CACJnqB,KAAW,QACX6C,GAAWkoC,EACXviC,KAAWsiC,EACXxgB,UAAWA,EACX0gB,UAAW7qC,EAAW+D,EAAKiE,QAASmiB,KAInCnqB,EAAW2S,EAAMqX,EAAMtnB,OAGC,0BAApBiQ,EAAMqX,EAAMtnB,KAAoC1C,EAAW2S,EAAM3I,EAAU,YAAa,CAAEggB,EAAMtnB,OACjG+nC,EAAe93B,EAAM3I,EAAU,YAAa,CAAEggB,EAAMtnB,MAE9C1C,EAAW2S,EAAM3I,EAAU,cAAe,CAAEggB,EAAMtnB,SACxD+nC,EAAkB93B,EAAM3I,EAAU,cAAe,CAAEggB,EAAMtnB,OAG7DsnB,EAAM8gB,aAAgB9gB,EAAM3hB,KAC5B2hB,EAAM3hB,KAAgBrI,EAAWyqC,GAAiBA,EAAe93B,EAAMqX,EAAMtnB,KAIjFoiC,EAAO/zB,KAAMiZ,GAGbqgB,EAAeA,EAAap3B,QAASu3B,EAAY,WAAaF,EAAc,MAC5EA,IAEO,YAGc1O,MAAO,SAG5BmP,EAAe,EAqBnB,IApBAnpC,SAAQ2oC,GAAa,SAAUzoC,EAAKkpC,GAChC,GAAwB,IAAnBA,EAAuB,CAExB,IAAIjB,EAAS,CACTlqC,KAAM,SACNwI,KAAM2iC,GAIVZ,EAAQr5B,KAAMg5B,GAGdM,EAAeA,EAAap3B,QAAS+3B,EAAiB,YAAcD,EAAe,MACnFA,QAOiD,QAA/Cd,EAAQC,EAAYe,KAAMZ,KAA2B,CAE3D,IAAIa,EAAOjB,EAAO,GAAIrO,MAAO,KAQX,WANlBsP,EAAO,CACHrrC,KAAOqrC,EAAM,GACbp/B,MAAOo/B,EAAM,KAIPrrC,KACN+D,EAASomC,MAAMj5B,KAAMq5B,EAASc,EAAKp/B,QAGnClI,EAASomC,MAAMj5B,KAAM+zB,EAAQoG,EAAKp/B,QAK1C,IAAIq/B,EAAa,KAGjBvpC,SAAQgC,EAASomC,OAAO,SAAUl+B,EAAOo/B,GAKrC,GAHAtnC,EAASkmC,OAASoB,EAAK7iC,KAGL,KAAb6iC,EAAK7iC,KAAa,CACnB,IAAI+iC,EACA/iC,EAAO6iC,EAAK7iC,KAEZgjC,GAAiB,EACjBC,EAAiB,KAcrB,GAXmC,KAAbjjC,EAAM,KAExBA,EAAOA,EAAKoS,MAAO,IAI0B,KAA3BpS,EAAMA,EAAKqI,OAAS,KAEtCrI,EAAOA,EAAKoS,MAAO,GAAI,IAGP,UAAbywB,EAAKrrC,MAAqC,SAAbqrC,EAAKrrC,OAAqBqrC,EAAKL,YAAe9mC,EAAK2kB,UACnF0iB,EAAoB,CAChB,MAAS,sBAIbxnC,EAASunB,UAAY+f,EAAK7iC,SAEzB,CAmBD,GAhBA+iC,EAAoB,CAChB,MAHW,oBAIX,gBAAmBF,EAAKxoC,GACxB,kBAAmBwoC,EAAK/gB,WAIvBnqB,EAAW+D,EAAKiE,QAASkjC,EAAK/gB,aAE1BpmB,EAAKiE,QAASkjC,EAAK/gB,WAAY5O,UAEhC6vB,EAAiB,OAAe,8BAKnCprC,EAAWkrC,EAAKJ,cAAgB,CAOjC,GAAKZ,EAAYqB,KAAMljC,GAAQ,CAEpBrI,EAAWmrC,KACdA,EAAa,IAAIK,UACbznC,EAAKzD,SACL,OACA,CACImrC,kBAAkB,KAM9B,IAAIzhB,EAAQmhB,EAAWO,qBAAsBrjC,GAExCrI,EAAWgqB,KAGZqhB,GAAiB,EACjBC,EAAiBthB,GAIzB,IAAOqhB,EAAe,CAElB,IAAIM,EAAkBC,EAAgBvjC,EAAM,IAGvCsjC,EAAgBE,gBAEjBT,EAAmB,eAAkB/iC,EAGrCA,EAAOsjC,EAAgBtjC,OAMnCzE,EAASunB,UAAT,YAA2B2gB,EAAgBzjC,GAA3C,MAGJ,IAAI2gC,EAAUpnC,IAAG,UAAWwpC,GAEvBC,EACDrC,EACK1kC,OAAQgnC,GAGbtC,EACK3gC,KAAMyjC,EAAgBzjC,IAI/BzE,EAASlC,SAAUwpC,EAAKrrC,MAAOkR,KAAMi4B,GAQrCplC,EAASuH,KAAK7G,OAAQ0kC,QA0BtBplC,EAASunB,UAAY+f,EAAK7iC,QAKlCzE,EAASlC,SAASqoC,OAASnoC,IAAGgC,EAASlC,SAASqoC,QAAS55B,KAAK,WAAY,OAAO1O,KAAKwX,SACtFrV,EAASlC,SAASsoB,MAASpoB,IAAGgC,EAASlC,SAASsoB,OAAQ7Z,KAAK,WAAY,OAAO1O,KAAKwX,SAAS5Y,OAAQ,6BAM9G,OAHIV,iBAAiBI,OAAO6E,MAAOb,EAAKrB,IAAKmnB,aAAejmB,EAGrDA,EAYJ,SAAS5D,EAAW+rC,GAEvB,OAAO,MAAOA,EAYX,SAASlrC,EAASkrC,GACrB,IAAInoC,GAAW,EAgBf,OAbK5D,EAAW+rC,KAGRnoC,EADChC,YAAWmqC,GACkB,GAAnBA,EAASr7B,OAEds7B,EAAUD,GACLnqC,kBAAiBmqC,GAGL,IAAZA,GAIZnoC,EAgBJ,SAAS0E,EAAgB2jC,EAASC,GAA6C,IAApC75B,EAAoC,uDAAzB,CAAE85B,eAAe,GAY1E,OAPO95B,EAAS85B,cAIDF,EAAQG,YAAcF,EAAQE,WAH9BH,EAAQG,WAAWnjB,eAAiBijB,EAAQE,WAAWnjB,cAqBnE,SAAS/iB,EAASmmC,EAAQC,GAY7B,OATK9xB,MAAMqB,QAASwwB,GAEyC,GAA9C/G,EAAiB+G,EAAQC,GAAW57B,QAID,IAAnC9O,YAAWyqC,EAAQC,GA4B/B,SAAShH,EAAiBiH,EAAQC,GACrC,OAAO5qC,IAAG2qC,GAASE,IAAKD,GAASvzB,MA6C9B,SAASjP,EAAUiD,EAAQy/B,GAE9B,OAAO1iC,EADQ8P,wDACE7M,EAAQy/B,GAYtB,SAASC,EAAU9C,GACtB,MAAyB,iBAAXA,EAYX,SAASmC,EAAUD,GACtB,OAAoB,OAAbA,GAAyC,WAApB,EAAOA,GAYhC,SAASa,EAAc/C,GAC1B,OAAOA,EAAO52B,QAAS,MAAO,IAe3B,SAAS8V,IAAuD,IAAnC8gB,EAAmC,uDAA1B,GAAIgD,EAAsB,uDAAd,GAAIC,EAAU,uDAAJ,GAG/D,OAFAjD,EAASA,EAAO52B,QAAS,MAAO45B,IAChB55B,QAAS,MAAO65B,GAa7B,SAASrL,IAA2D,IAA1Cp5B,EAA0C,uDAAnC,GAAIy6B,EAA+B,wDAAd96B,EAAc,uDAAJ,GAE/DhI,EAAWgI,EAAQ2gC,WACzB3gC,EAAQ2gC,QAAU,WAIhB,IAAIoE,EAAa,eAAH,OAAmB/kC,EAAQ2gC,QAA3B,0KAGT7F,EACI9iC,EAAWgI,EAAQs/B,gBAAmBt/B,EAAQs/B,cAC/C7nC,QAAQutC,eAAgB,gBAAiBD,EAAY1kC,GAGrD5I,QAAQwtC,MAAO,gBAAiBF,EAAY1kC,GAIhD5I,QAAQC,IAAK,gBAAiBqtC,EAAY1kC,GAc3C,SAASk/B,IAA+C,IAA7Bjd,EAA6B,uDAApB,QAASjiB,EAAW,uDAAJ,GAEnD0kC,EAAa,yKAGF,SAAVziB,IACDyiB,EAAa,wBAAH,OAA4BA,IAG3B,WAAVziB,IACDyiB,EAAa,wBAAH,OAA4BA,IAI1CttC,QAAQC,IAAR,YAAmB2I,GAAS0kC,GAWzB,SAAS1f,IAAuB,IAAXliB,EAAW,uDAAJ,GAC3B+hC,EAAgB,CAChB,IAAK,QACL,IAAK,OACL,IAAK,QAGLC,EAAa,SAAU1hB,GACvB,OAAOyhB,EAAezhB,IAASA,GAGnC,OAAOtgB,EAAK8H,QAAS,SAAUk6B,GAY5B,SAASvB,IAAwC,IAAxBvjC,EAAwB,uDAAjB,GAAIqI,EAAa,uDAAJ,GAE5C9M,EAAW,CACXioC,eAAe,EACfxjC,KAAMA,GAIV,GAAKA,EAAKqI,OAASA,EAAQ,CAEvB,IAAI08B,EAAcC,KAAKC,MAAO58B,EAAS,GAGnC68B,EAAY,CACZV,MAAOxkC,EAAKmlC,UAAW,EAAGJ,GAC1BN,IAAOzkC,EAAKoS,OAAQ2yB,IAIxBxpC,EAASyE,KAAT,UAAoBklC,EAAUV,MAA9B,gBAA6CU,EAAUT,KACvDlpC,EAASioC,eAAgB,EAI7B,OAAOjoC,EAOJ,SAASgJ,IAIZ,MAAO,IAAMygC,KAAKI,SAASrB,SAAU,IAAKsB,OAAQ,EAAG,GAYlD,SAAS7sB,IAA6D,IAAzCqN,EAAyC,uDAAnC,GAAIyf,EAA+B,uDAAlB,GAAI3lC,EAAc,uDAAJ,GAEhEnH,EAASqtB,KACVA,EAAMtT,OAAO4gB,SAAS/H,MAI1B,IACIvF,EAAM,IAAI0f,IAAK1f,GACjB,MAAQxlB,GAEN,OAAOwlB,EAOX,IAHA,IAAI2f,EAAgB3f,EAAI1b,OAAOk7B,OAAQ,GAAI9R,MAAO,KAGlD,MAA4B7a,OAAOC,QAAS2sB,GAA5C,eAA0D,CAApD,gBAAM7rC,EAAN,KAAWoG,EAAX,KACFpG,EAAQssB,UAAWtsB,GACnBoG,EAAQkmB,UAAWlmB,GAKnB,IAHA,IAAI4lC,EAAID,EAAcn9B,OAClBq9B,OAAC,EAEGD,KAGJ,IAFAC,EAAIF,EAAeC,GAAIlS,MAAO,MAEtB,IAAO95B,EAAK,CAChBisC,EAAG,GAAM7lC,EACT2lC,EAAcC,GAAKC,EAAEphC,KAAM,KAC3B,MAIHmhC,EAAI,IACLD,EAAeA,EAAcn9B,QAAW,CAAE5O,EAAKoG,GAAQyE,KAAM,MAiBrE,GAZAkhC,EAAgBA,EAAcxtC,QAAQ,SAAA2tC,GAAS,OAAMntC,EAASmtC,MAG9D9f,EAAI1b,OAASq7B,EAAclhC,KAAM,MAGjC3E,EAAUpG,WAAS,GAAI,CACnBqsC,UAAU,EACVC,SAAU,GACXlmC,IAGUimC,SAET,GAAKjmC,EAAQkmC,QAETtzB,OAAO4gB,SAAS/H,KAAOvF,EAAIuF,SAE1B,CAED,IAAI0a,EAAY36B,SAAS8J,MAGzB1C,OAAOwzB,QAAQC,UAAU,GAAIF,EAAWjgB,EAAIuF,MAKpD,OAAOvF,EAAIuF,KAUR,SAASqY,IAAoC,IAApBwC,EAAoB,uDAAJ,GACtCC,EAAY/6B,SAASg7B,cAAe,YAE1C,OADAD,EAAUE,UAAYH,EACfC,EAAUrmC,MAGd,SAASwmC,EAAUC,EAAMC,GAC5B,IAAIC,EAAW,EAEf,OAAO,WACH,IAAIC,EAAMlpB,KAAKkpB,MACf,GAAKD,EAAWD,EAAWE,EAEvB,OADAD,EAAWC,EACJH,EAAKp0B,MAAO9Y,KAAMiZ,YAK9B,SAASjB,EAAUk1B,EAAMC,GAC5B,IAAIC,GAAY,EAEhB,OAAO,WACHxgC,aAAcwgC,GACd,IAAIE,EAAOr0B,UACPs0B,EAAOvtC,KACXotC,EAAWvgC,YAAY,WACnBqgC,EAAKp0B,MAAOy0B,EAAMD,KACnBH,IAIJ,SAASK,EAAiBpF,GAE7B,IAAMqF,EAAgB17B,SAASg7B,cAAe,YAG9CU,EAAcC,MAAMC,MAAS,MAC7BF,EAAcC,MAAME,OAAS,MAG7BH,EAAchnC,MAAQ2hC,EAGtBr2B,SAAS87B,KAAKC,YAAaL,GAG3BA,EAAc/lC,SAGdqK,SAASg8B,YAAa,QAGtBh8B,SAAS87B,KAAK72B,YAAay2B,GAUxB,SAASO,EAAkB/jC,GAE9B,IAEIgkC,EAFAC,EAAY,GAGhB,IAEID,EAAa/vC,iBAAiBmiC,eAAezhC,QAAQ,SAAEN,GACnD,OAAOA,EAAOsE,IAAM1E,iBAAiBI,OAAO2C,MAC7C,GACL,MAAQgG,GACNjJ,QAAQC,IAAKgJ,GAIjB,IACI,IAAIknC,EAAY,UAAH,OAAcjwC,iBAAiBc,KAAKovC,UAAUC,YAA9C,cAGTnhB,EAAuC,QAA1B+gB,EAAWrX,YAAwB14B,iBAAiBc,KAAKovC,UAAUE,eAA6C,aAA1BL,EAAWrX,YAA6B14B,iBAAiBc,KAAKovC,UAAUG,oBAAsB,GACrMJ,GAAa,GAAJ,OAAQjwC,iBAAiBc,KAAKovC,UAAUlhB,WAAxC,aAAyDA,GAGlE,IAAIshB,EAAyC,SAA1BP,EAAW5kB,YAAyBnrB,iBAAiBc,KAAKovC,UAAUK,kBAAgD,WAA1BR,EAAW5kB,YAA2BnrB,iBAAiBc,KAAKovC,UAAUM,iBAAmB,GAGtMR,EAFAC,GAAa,KAAJ,OAAUjwC,iBAAiBc,KAAKovC,UAAUI,aAA1C,aAA6DA,GAI1E,MAAQvnC,GACJjJ,QAAQC,IAAKgJ,GAIjB,IACI,IAAI0nC,EAAiB,OAAH,OAAWzwC,iBAAiBc,KAAKovC,UAAUQ,iBAA3C,WAIZC,EAAgB,SAAEvsC,GAEpB,IAAMksC,EAAmC,WAApBlsC,EAAK+mB,YAA2BnrB,iBAAiBc,KAAKovC,UAAUU,eAAiB5wC,iBAAiBc,KAAKovC,UAAUW,gBAEtI,kBAAazsC,EAAK+M,KAAKrN,YAAvB,cAA0CM,EAAK+M,KAAKvO,KAApD,cAAgE0tC,IAI9D9uB,EAAcuuB,EAAWvuB,SAAShR,IAAKmgC,GACvClvB,EAAcD,EAASzQ,OAAS,EAGhCvQ,EAAcuvC,EAAWvvC,QAAQgQ,IAAKmgC,GACtC/uB,EAAcphB,EAAQuQ,OAAS,EAG/B7O,EAAc6tC,EAAW7tC,SAASsO,IAAKmgC,GACvC/vC,EAAcsB,EAAS6O,OAAS,EAGjC0Q,GAAeG,GAAchhB,GAE9B6vC,GAAkB,GAAJ,OAAQzwC,iBAAiBc,KAAKovC,UAAUY,cAAxC,MAIVL,GADChvB,EACiBD,EAASxU,KAAM,MAGf,KAAJ,OAAUhN,iBAAiBc,KAAKovC,UAAUa,YAI5DN,GAAkB,KAAJ,OAAUzwC,iBAAiBc,KAAKovC,UAAUc,aAA1C,MAIVP,GADC7uB,EACiBphB,EAAQwM,KAAM,MAGd,KAAJ,OAAUhN,iBAAiBc,KAAKovC,UAAUe,WAI5DR,GAAkB,KAAJ,OAAUzwC,iBAAiBc,KAAKovC,UAAUgB,cAA1C,MAIVT,GADC7vC,EACiBsB,EAAS8K,KAAM,MAGf,KAAJ,OAAUhN,iBAAiBc,KAAKovC,UAAUiB,aAI5DV,GAAkB,GAAJ,OAAQzwC,iBAAiBc,KAAKovC,UAAUkB,oBAG1DpB,EAA4B,KAAdA,EAAF,UAA2BA,EAA3B,eAA6CS,GAAoBT,EAEjF,MAAQjnC,GACJjJ,QAAQC,IAAKgJ,GAIjB,IACI,IAAIsoC,EAAY,UAAH,OAAcrxC,iBAAiBc,KAAKovC,UAAUmB,UAA9C,cAGbA,GAAa,GAAJ,OAAQtlC,EAAMulC,MAAMC,WAAYvxC,iBAAiBwxC,QAAS,eAEnExB,EAA0B,KAAdA,EAAA,UAAuBA,EAAvB,eAAyCqB,GAAerB,EAExE,MAAQjnC,GACJjJ,QAAQC,IAAKgJ,GAGF,IAAIkb,UAAM,CACrBtG,MAAO,iFAAF,OAAsF3d,iBAAiBc,KAAKovC,UAAUuB,uBAC3H3nB,QAAS,GAAF,OAAM9pB,iBAAiBc,KAAKovC,UAAUwB,oBAC7CxtB,QAAS,scAAF,OAUoC8rB,EAVpC,0FAeP5rB,QAAS,CACLC,OAASrkB,iBAAiBc,KAAKovC,UAAUyB,aACzCrtB,QAAStkB,iBAAiBc,KAAKovC,UAAU/uB,YAE9C,CACCoD,KAAM,cACN0L,cAAc,IAGXxL,UAAU,CACbG,UAAW,WAEP3J,OAAOxC,KAAMzY,iBAAiBynC,IAAImK,aAAc,WAEpDjmB,SAAU,WAEN1Q,OAAO4gB,SAASvoB,QAAStT,iBAAiBynC,IAAIoK,aAElDntB,eAAgB,WAEZ,IAAMotB,EAAoB7vC,IAAG,kBAG7B6vC,EAAkB1uC,GAAI,SAAS,WAEN0uC,EAAkBppC,OAAvC,IAYIqpC,EAAQl+B,SAASm+B,cACrBD,EAAME,mBAAoBH,EAAkB,IAC5C72B,OAAOi3B,eAAeC,kBACtBl3B,OAAOi3B,eAAeE,SAAUL,SAiBxC,SAASxwC,EAAiB0D,EAAOkM,EAAM5I,GAE3C,IAAI8pC,EAAgB,GAQpB,OANApwC,SAAQgD,GAAO,SAAEI,EAAQjB,GAChBA,EAAK+M,KAAKA,IAAS/M,EAAK+M,KAAKA,IAAS5I,IACvC8pC,EAAchtC,GAAUjB,MAIzBiuC,EAcH,SAASjxC,EAAY6D,EAAOkM,GAAqB,IAAfmhC,IAAe,yDAEjDC,EAAgB,GAQpB,OANAtwC,SAAQgD,GAAO,SAAEI,EAAQjB,GACd+M,KAAQ/M,EAAK+M,OAAWmhC,IAC3BC,EAAcltC,GAAUjB,MAIzBmuC,I,4RCxvDAtwC,E,wIAtkCJ,SAASuwC,IAEf,IAAIvuC,EAAW,CACdwuC,UAAWzyC,iBAAiBI,OAAOwb,SAiBpC,OAbO5b,iBAAiBI,OAAOwb,SAM9B3Z,SAAQjC,iBAAiBI,OAAO6E,OAAO,SAAUe,EAAQ8/B,GAGxD5a,EAAcllB,MAIT/B,EAeD,SAASinB,EAAcllB,GAAsB,IAAdlB,EAAc,uDAAN,KAEzCb,EAAW,CACd2X,SAAS,GAIV,IAAKvb,eAAW2F,GAAU,CAEzB,IAAI5B,EAAOpE,iBAAiBI,OAAO6E,MAAOe,GAG1C,IAAO5B,EAAK2kB,aAAe7nB,aAASkD,KAEnCH,EAAS2X,QAAUxX,EAAKwX,SAGjBxX,EAAKwX,SAAS,CAGpB,IAAI82B,GAAczyC,oBAAgB,OAAQ,CACzC8C,GAAIiD,IACF5B,KAGHsuC,EAAY7tC,SAAU,eAGtB5C,SAAQmC,EAAKiE,SAAS,SAAU29B,EAAgBC,GAG/C,IAAOA,EAAiBrqB,QAAS,CAGhC,IAAI+2B,GAAuB1yC,oBAAgB,cAAe,CACzD+F,OAASA,EACTykB,QAAUub,IAIX2M,EAAqB5I,gBAAgBllC,SAAU,2DAC/C8tC,EAAqBtmB,gBAAgBxnB,SAAU,8BAC/C8tC,EAAqB3I,iBAAiBnlC,SAAU,uBAGhD8J,YAAY,WACXgkC,EAAqB5I,gBAAgBl9B,YAAa,uCAChD,MAGExM,eAAWsyC,EAAqB3I,mBAGpC5c,EAAoBulB,EAAqB3I,4BAS9C/lC,EAAS2X,SAAU,GAGZ1a,aAAS4D,IAIfhF,QAAQiM,MAAO,0EAKjB,OAAO9H,EAcD,SAASmpB,EAAoB+K,GAAgC,IAA1Bya,EAA0B,wDAE/D3uC,EAAW,CACd2X,SAAS,GAIN3L,EAASkoB,EAAK9zB,KAAL,+DACsCuuC,EAAmB,OAAS,QADlE,yEAE4CA,EAAmB,OAAS,QAFxE,qEAGwCA,EAAmB,OAAS,QAHpE,oDASTC,GAAc,EAuFlB,OApFA5iC,EAAO6iC,MAAK,WAGX,IAAInsC,EAAQ1E,IAAGH,MAMXsZ,GAHYzU,EAAMqM,KAAM,QAGZ,IAGhB,GAAKrM,EAAM0L,SAAU,cAAgB,CAKpC,IAAI0gC,EAAiBpsC,EAAMtC,KAAM,SAAUC,QAGvC0uC,EAAiBrsC,EAAMtC,KAAM,iBAIjC+W,EAAY,CACX63B,WAAe,QACf1qC,MALoByqC,EAAcjiC,OAAS,EAAIiiC,EAAclqC,MAAQ,GAMrE7C,WAAY,CACXmB,eAAiB2rC,EAAW//B,KAAM,kBAClC/E,SAAa8kC,EAAW//B,KAAM,mBAMhCoI,EADSzU,EAAM0L,SAAU,wBACb,CACX4gC,WAAe,SACf1qC,MAAY5B,EAAMmC,MAClB7C,WAAY,CACXmB,eAAqBT,EAAMqM,KAAM,kBACjC/E,SAAiBtH,EAAMqM,KAAM,YAC7BtL,oBAAqBf,EAAMqM,KAAM,2BAMvB,CACXigC,WAAetsC,EAAMqM,KAAM,QAC3BzK,MAAY5B,EAAMmC,MAClB7C,WAAY,CACXmB,eAAiBT,EAAMqM,KAAM,kBAC7B/E,SAAatH,EAAMqM,KAAM,cAMC,YAAxBoI,EAAU63B,aACd73B,EAAU7S,MAAQ5B,EAAM4J,GAAI,aAYPrC,EAAevH,EAAOyU,EAAU63B,WAAY73B,EAAU7S,MAAO6S,EAAUnV,YAGtE2V,UACtBi3B,GAAc,EAGd1a,EAAKtzB,SAAU,2BAIjBZ,EAAS2X,QAAUi3B,EAEZ5uC,EAyBD,SAASiK,EAAevH,EAAOmD,EAAWvB,GAA0F,IAAnFtC,EAAmF,uDAAtE,CAAEmB,gBAAgB,EAAO6G,UAAU,GAAS9H,EAA0B,uCAEtIlC,EAAW,CACd2X,SAAS,EACTC,QAAS,IAINq3B,GAAa1sC,qBAGb2sC,EAAW,CACd3pC,OAAQ,CACPrJ,MAASH,iBAAiBc,KAAKyI,WAAW5C,MAAM6C,OAAOrJ,MACvDizC,QAASpzC,iBAAiBc,KAAKyI,WAAW5C,MAAM6C,OAAO4pC,SAExD1qC,KAAM,CACLvI,MAASH,iBAAiBc,KAAKyI,WAAW5C,MAAM+B,KAAKvI,MACrDizC,QAASpzC,iBAAiBc,KAAKyI,WAAW5C,MAAM+B,KAAK0qC,SAEtDC,SAAU,CACTlzC,MAASH,iBAAiBc,KAAKyI,WAAW5C,MAAM0sC,SAASlzC,MACzDizC,QAASpzC,iBAAiBc,KAAKyI,WAAW5C,MAAM0sC,SAASD,SAE1DE,IAAK,CACJnzC,MAASH,iBAAiBc,KAAKyI,WAAW5C,MAAjC,IAA2CxG,MACpDizC,QAASpzC,iBAAiBc,KAAKyI,WAAW5C,MAAjC,IAA2CysC,QACpDG,eAAgBvzC,iBAAiBc,KAAKyI,WAAW5C,MAAjC,IAA2C4sC,gBAE5DC,MAAO,CACNrzC,MAASH,iBAAiBc,KAAKyI,WAAW5C,MAAjC,MAA6CxG,MACtDizC,QAASpzC,iBAAiBc,KAAKyI,WAAW5C,MAAjC,MAA6CysC,QACtDG,eAAgBvzC,iBAAiBc,KAAKyI,WAAW5C,MAAjC,MAA6C4sC,gBAE9DxU,MAAO,CACN5+B,MAASH,iBAAiBc,KAAKyI,WAAW5C,MAAMo4B,MAAM5+B,MACtDszC,OAAS,CACRL,QAASpzC,iBAAiBc,KAAKyI,WAAW5C,MAAMo4B,MAAM0U,OAAOL,QAC7DG,eAAgBvzC,iBAAiBc,KAAKyI,WAAW5C,MAAMo4B,MAAM0U,OAAOF,gBAErEG,SAAU,CACTN,QAASpzC,iBAAiBc,KAAKyI,WAAW5C,MAAMo4B,MAAM2U,SAASN,QAC/DG,eAAgBvzC,iBAAiBc,KAAKyI,WAAW5C,MAAMo4B,MAAM2U,SAASH,iBAGxEhlB,IAAK,CACJpuB,MAASH,iBAAiBc,KAAKyI,WAAW5C,MAAM4nB,IAAIpuB,MACpDizC,QAASpzC,iBAAiBc,KAAKyI,WAAW5C,MAAM4nB,IAAI6kB,SAErDO,SAAU,CACTxzC,MAASH,iBAAiBc,KAAKyI,WAAW5C,MAAMgtC,SAASxzC,MACzDizC,QAASpzC,iBAAiBc,KAAKyI,WAAW5C,MAAMgtC,SAASP,SAE1DQ,MAAO,CACNzzC,MAASH,iBAAiBc,KAAKyI,WAAW5C,MAAMitC,MAAMzzC,MACtDizC,QAASpzC,iBAAiBc,KAAKyI,WAAW5C,MAAMitC,MAAMR,SAEvD7lC,KAAM,CACLpN,MAASH,iBAAiBc,KAAKyI,WAAW5C,MAAM4G,KAAKpN,MACrDizC,QAASpzC,iBAAiBc,KAAKyI,WAAW5C,MAAM4G,KAAK6lC,SAEtDS,KAAM,CACL1zC,MAASH,iBAAiBc,KAAKyI,WAAW5C,MAAMktC,KAAK1zC,MACrDizC,QAASpzC,iBAAiBc,KAAKyI,WAAW5C,MAAMktC,KAAKT,SAEtDU,YAAa9zC,iBAAiBc,KAAKyI,WAAW5C,MAAMmtC,aAIrD,IAAKvtC,aAASuD,EAAWopC,IAYxB,GAVkB,YAAbppC,IAA6B5I,aAASqH,IAErC,CAAE,OAAQ,SAAU0C,SAAU1C,KAElCA,EAAiB,QAATA,GAMLtC,EAAWgI,YAAc/M,aAASqH,IAAwB,YAAbuB,IAAqC,IAAVvB,GAC5EtE,EAAS4X,QAAUs3B,EAAUrpC,GAAY3J,WAIrC,IAAO8F,EAAWgI,WAAY/M,aAASqH,GAC3CtE,EAAS2X,SAAU,OAGf,GAAc,IAATrT,EAAa,CAEtB,IAAIwrC,EAGJ,OAASjqC,GAER,IAAK,SAIJ,GAHA7F,EAAS2X,SAAU,EAGd3V,EAAWyB,qBAAgC,0BAATa,EAAmC,CAEzE,IAAMyrC,EAAkBrtC,EAAMqK,QAAS,iBAAkB3M,KAAM,0BAGhC,GAA1B2vC,EAAgBjjC,SAEpB9M,EAAS2X,QAAUwR,EAAoB4mB,GAAiB,GAAOp4B,SAKjE,GAAK3X,EAAS2X,UAAWvb,eAAW8F,GAA4B,CAE/D,IAAI8tC,EAAmB9tC,EAA0BoC,GAEjDtE,EAAS2X,QAAUq4B,EAAiBr4B,QAG7Bq4B,EAAiBr4B,UACvB3X,EAAS4X,QAAUo4B,EAAiBp4B,SAItC,MAED,IAAK,OACL,IAAK,WAIJ,GAHA5X,EAAS2X,SAAU,GAGdvb,eAAW8F,GAA4B,CAE3C,IAAI8tC,EAAmB9tC,EAA0BoC,GAEjDtE,EAAS2X,QAAUq4B,EAAiBr4B,QAG7Bq4B,EAAiBr4B,UACvB3X,EAAS4X,QAAUo4B,EAAiBp4B,SAItC,MAED,IAAK,MAGJ,IAMIwM,EANA6rB,EAAY,IAAI1J,OAAO,yBAiC3B,GA9BAuJ,EAAiBI,EAAqB5rC,GAMjCtC,EAAWmB,gBAAkB2sC,EAAeK,UAEX,GAAhCL,EAAe5O,OAAOp0B,OAE1B9M,EAAS2X,SAAU,EAInB3X,EAAS4X,QAAUs3B,EAAQ,IAAKI,eAK5BW,EAAUtI,KAAMrjC,GACpBtE,EAAS2X,SAAU,EAInB3X,EAAS4X,QAAUs3B,EAAQ,IAAKC,QAM7BnvC,EAAS2X,UAAWvb,eAAW8F,GAA4B,CAE/D,IAAI8tC,EAAmB9tC,EAA0BoC,EAAO8f,GAExDpkB,EAAS2X,QAAUq4B,EAAiBr4B,QAG7Bq4B,EAAiBr4B,UACvB3X,EAAS4X,QAAUo4B,EAAiBp4B,SAItC,MAED,IAAK,QAGJ,IAMIw4B,EANAC,EAAc,IAAI9J,OAAO,uCAiC7B,GA9BAuJ,EAAiBI,EAAqB5rC,GAMjCtC,EAAWmB,gBAAkB2sC,EAAeK,UAEX,GAAhCL,EAAe5O,OAAOp0B,OAE1B9M,EAAS2X,SAAU,EAInB3X,EAAS4X,QAAUs3B,EAAQ,MAAOI,eAK9Be,EAAY1I,KAAMrjC,GACtBtE,EAAS2X,SAAU,EAInB3X,EAAS4X,QAAUs3B,EAAQ,MAAOC,QAM/BnvC,EAAS2X,UAAWvb,eAAW8F,GAA4B,CAE/D,IAAI8tC,EAAmB9tC,EAA0BoC,EAAO8rC,GAExDpwC,EAAS2X,QAAUq4B,EAAiBr4B,QAG7Bq4B,EAAiBr4B,UACvB3X,EAAS4X,QAAUo4B,EAAiBp4B,SAItC,MAED,IAAK,QAGJ,IA0BI04B,EA1BAC,EAAc,IAAIhK,OAAO,0JAMzBiK,EAAS,GAGRlsC,EAAM0C,SAAU,MACpBwpC,EAASlsC,EAAM0zB,MAAO,KAGtBh6B,SAAQwyC,GAAQ,SAAUtoC,EAAO4yB,GAChC0V,EAAQtoC,GAAU4yB,EAAM9tB,WAKzBwjC,EAAOrjC,KAAM7I,EAAM0I,QAIpB8iC,EAAiBI,EAAqB5rC,GAMtC,IAAImsC,GAAoB,EAGpBC,EAAoBF,EAAO1jC,OAAS,EAGxC,GAAK9K,EAAWmB,gBAAkB2sC,EAAeK,UAAW,CAE3D,IAAIQ,GAAuB,EAG3B3yC,SAAQwyC,GAAQ,SAAUtoC,EAAO4yB,GAKhC,MAHAgV,EAAiBI,EAAqBpV,IAGlBoG,OAAOp0B,QAAU,GASpC,OAHA6jC,GAAuB,GAGhB,KAKJF,IAAuBE,EAC3B3wC,EAAS2X,SAAU,EAMjB3X,EAAS4X,QAHN+4B,EAECD,EACexB,EAASpU,MAAM2U,SAASH,eAGxBJ,EAASpU,MAAM0U,OAAOF,eAKrCoB,EACexB,EAASpU,MAAM2U,SAASN,QAGxBD,EAASpU,MAAM0U,OAAOL,aAO5CnxC,SAAQwyC,GAAQ,SAAUtoC,EAAO4yB,GAEzByV,EAAY5I,KAAM7M,KAExB2V,GAAoB,MAKjBA,EACJzwC,EAAS2X,SAAU,EAKlB3X,EAAS4X,QADL84B,EACexB,EAASpU,MAAM2U,SAASN,QAGxBD,EAASpU,MAAM0U,OAAOL,QAO5C,GAAKnvC,EAAS2X,UAAWvb,eAAW8F,GAA4B,CAE/D,IAAI8tC,EAAmB9tC,EAA0BoC,EAAOgsC,GAExDtwC,EAAS2X,QAAUq4B,EAAiBr4B,QAG7Bq4B,EAAiBr4B,UACvB3X,EAAS4X,QAAUo4B,EAAiBp4B,SAItC,MAED,IAAK,MAEJ,IAAIg5B,EAAcC,EAAUvsC,EAAOtC,GAanC,GAVK4uC,EAAYj5B,QAChB3X,EAAS2X,SAAU,EAInB3X,EAAS4X,QAAUs3B,EAASW,YAKxB7vC,EAAS2X,UAAWvb,eAAW8F,GAA4B,CAE/D,IAAI8tC,EAAmB9tC,EAA0BoC,EAAOssC,EAAYE,cAEpE9wC,EAAS2X,QAAUq4B,EAAiBr4B,QAG7Bq4B,EAAiBr4B,UACvB3X,EAAS4X,QAAUo4B,EAAiBp4B,SAItC,MAED,IAAK,WAIJ,GAHA5X,EAAS2X,SAAU,GAGdvb,eAAW8F,GAA4B,CAE3C,IAAI8tC,EAAmB9tC,EAA0BoC,GAEjDtE,EAAS2X,QAAUq4B,EAAiBr4B,QAG7Bq4B,EAAiBr4B,UACvB3X,EAAS4X,QAAUo4B,EAAiBp4B,SAItC,MAED,IAAK,QAIJ,GAHA5X,EAAS2X,SAAU,GAGdvb,eAAW8F,GAA4B,CAE3C,IAAI8tC,EAAmB9tC,EAA0BoC,GAEjDtE,EAAS2X,QAAUq4B,EAAiBr4B,QAG7Bq4B,EAAiBr4B,UACvB3X,EAAS4X,QAAUo4B,EAAiBp4B,SAItC,MAGD,IAAK,OAIJ,GAHA5X,EAAS2X,SAAU,GAGdvb,eAAW8F,GAA4B,CAE3C,IAAI8tC,EAAmB9tC,EAA0BoC,GAEjDtE,EAAS2X,QAAUq4B,EAAiBr4B,QAG7Bq4B,EAAiBr4B,UACvB3X,EAAS4X,QAAUo4B,EAAiBp4B,SAItC,MAGD,IAAK,OAIJ,GAHA5X,EAAS2X,SAAU,GAGdvb,eAAW8F,GAA4B,CAE3C,IAAI8tC,EAAmB9tC,EAA0BoC,GAEjDtE,EAAS2X,QAAUq4B,EAAiBr4B,QAG7Bq4B,EAAiBr4B,UACvB3X,EAAS4X,QAAUo4B,EAAiBp4B,SAItC,MAED,QAEC5X,EAAS2X,SAAU,EACnB3X,EAAS4X,QAAU,UAMtB5X,EAAS4X,QAAUs3B,EAAQ,YAM5B,KAAOjyC,aAASyF,GAAS,CACxB,IAAIpE,EAAaoE,EAAMqK,QAAS,iBAC5BgkC,EAAmBzyC,EAAW8B,KAAM,wBAAyB3D,QAAO,WACvE,OAAOuB,IAAGH,MAAOkP,QAAS,iBAAkBT,GAAIhO,MAG1C0B,EAAS2X,SAKfrZ,EAAWsK,YAAa,uBACxBtK,EAAWsC,SAAU,2BALrBtC,EAAWsK,YAAa,yBACxBtK,EAAWsC,SAAU,wBAOG,IAApBZ,EAAS4X,SACbm5B,EAAiBnwC,SAAU,6BAC3BmwC,EAAiBtsC,KAAMzE,EAAS4X,WAGhCm5B,EAAiBnoC,YAAa,6BAC9BmoC,EAAiBtsC,KAAK,KAKxB,OAAOzE,EAiBD,SAASkwC,EAAqBjK,GAEpC,IAAIjmC,EAAW,CACdmwC,WAAW,EACXjP,OAAQ,IAKL8P,EAAQ,IAAIzK,OAAO,mBAGnB0K,EAAY,IAAIrJ,UAAQ,KAAM,KAAM,CACvCC,kBAAkB,EAClBqJ,kBAAkB,IAChBhQ,OAoDH,OAjDK9kC,eAAW6pC,IAERhpC,aAASgpC,IAAU,YAElB8C,cAAU9C,KAChBA,EAASA,EAAOuC,YAQjB,IAJA,IAGInC,EAHAnF,EAAS,GAPY,aAYxB,IAAIiQ,EAAe9K,EAAO,GAIzB8K,EAAanzB,WAAY,cACtBmzB,EAAanzB,WAAY,aAG5BkjB,EAAO/zB,KAAMgkC,GAIbnzC,SAAQizC,GAAW,SAAE/oC,EAAOkpC,GAC3BpzC,SAAQozC,EAAWlQ,QAAQ,SAAEh5B,EAAOke,GAC9B+qB,GAAgB/qB,EAAMtnB,IAC1BoiC,EAAO/zB,KAAMiZ,UAhB2B,QAAnCigB,EAAQ2K,EAAM3J,KAAMpB,KAAqB,IAuBnDjmC,EAASkhC,OAASA,EAGblhC,EAASkhC,OAAOp0B,OAAS,IAC7B9M,EAASmwC,WAAY,GAtCG,GA4C1Bt0C,QAAQiM,MAAO,8BAGT9H,EAgBD,SAASqxC,EAAuBpL,GAItC,IAAIqL,EAASrL,EAGT6J,EAAiBI,EAAqBjK,GA8B1C,OA3BK6J,EAAeK,WAGnBnyC,SAAQ8xC,EAAe5O,QAAQ,SAAUh5B,EAAOke,GAM/C,IAAImrB,EAAiBnrB,EAAMtnB,GAAGuQ,QAAS,2BAA4B,QAGnEkiC,GAAiBnrC,cAAU,SAAU,CAAEmrC,IAIvC,IAAIP,EAAQ,IAAIzK,OAAQgL,EAAgB,KAGxCD,EAASA,EAAOjiC,QAAS2hC,GAAO,SAAUpK,EAAYyC,GAGrD,OAAOmI,EAA4BprB,EAAMnqB,YAKrCq1C,EAgBD,SAASE,EAA4B3rC,GAC3C,IAAIvB,EAAQ,GAEZ,OAAQuB,GAEP,IAAK,SACJvB,EAAQ,SACR,MAED,IAAK,OACJA,EAAQ,cACR,MAED,IAAK,WACJA,EAAQ,uMACR,MAED,IAAK,MACJA,EAAQ,EACR,MAED,IAAK,QACJA,EAAQ,IACR,MAED,IAAK,MACJA,EAAQ,sBACR,MAED,IAAK,QACJA,EAAQ,sBACR,MAED,IAAK,WACJA,GAAQ,EACR,MAED,IAAK,QACJA,EAAQ,SACR,MAED,IAAK,OACJA,EAAQ,aACR,MAED,IAAK,GACJA,EAAQ,WAIV,OAAOA,EA2BD,SAASusC,EAAUvmB,GAA6C,IAAxCtoB,EAAwC,uDAA3B,CAAEmB,gBAAgB,GAEzDnD,EAAW,CACdyxC,SAAS,EACT95B,SAAS,EACT+5B,OAAQ,KACRZ,aAAc,MAIfxmB,EAAMA,EAAIjb,QAAS,KAAM,OAIzB,IAAIsiC,EAAW,IAAIpL,OAAQ,qXAGvBqL,EAAgB1B,EAAqB5lB,GAIrConB,EAASpnB,EAGb,GAAKtoB,EAAWmB,gBAAkByuC,EAAczB,UAAW,CAE1D,IAAI0B,EAAeR,EAAuB/mB,GAC1CtqB,EAAS8wC,aAAee,EAGnBF,EAAShK,KAAMkK,GACnB7xC,EAAS2X,SAAU,GAOlB+5B,EAFc,KAAVpnB,EAAI,GAECvuB,iBAAiBwxC,QAAUjjB,EAI3BvuB,iBAAiBwxC,QAAU,IAAMjjB,EAItCqnB,EAAShK,KAAM+J,KACnB1xC,EAAS2X,SAAU,SAMhBg6B,EAAShK,KAAMrd,GACnBtqB,EAAS2X,SAAU,GAOlB+5B,EAFc,KAAVpnB,EAAI,GAECvuB,iBAAiBwxC,QAAUjjB,EAI3BvuB,iBAAiBwxC,QAAU,IAAMjjB,EAItCqnB,EAAShK,KAAM+J,KACnB1xC,EAAS2X,SAAU,IAatB,OARA3X,EAAS0xC,OAASA,EAIb1xC,EAAS0xC,QAAUpnB,IACvBtqB,EAASyxC,SAAU,GAGbzxC,EAwFD,SAASuO,EAAgBvC,GAC/BA,EAAO8lC,YA5EG9zC,EA+DTiZ,QA9DCjB,GAAG87B,SAAW,SAAW1tC,GAC1B,OAAOvG,KAAKgxC,MAAM,WAKjB,IAAIkD,EAAQ/zC,EAAEH,MAGV4Q,EAAWzQ,EAAEmY,OAAO,CACvB,OAAU,eACR/R,GAGCtG,EAAW,CACdgS,UAAYiiC,EACZxf,MAASwf,EAAM3xC,KAAM,yBAIlB4xC,EAAmB,CACtBhoC,SAAalM,EAASy0B,MAAMxjB,KAAM,YAClC5L,eAAiBrF,EAASy0B,MAAMxjB,KAAM,mBAInCkjC,EAAmBj0C,EAAG,SAAU,CAAE,MAAS,0BAC3Ck0C,EAAyBl0C,EAAG,SAAU,CAAE,MAAS,kCACjDm0C,EAAsBn0C,EAAG,SAAU,CAAE,MAAS,+BAQlD,SAAS6Z,EAAUvT,GAClB,IAAIgmB,EAAMumB,EAAUvsC,EAAO0tC,GAGb,IAAT1tC,GAAegmB,EAAI3S,SAAW2S,EAAImnB,SACtCQ,EAAiBrxC,SAAU,+BAC3BuxC,EAAoB1tC,KAAM6lB,EAAIonB,SAG9BO,EAAiBrpC,YAAa,+BAchC,OA7BAspC,EAAuBztC,KAAMgK,EAAS2jC,QACtCF,EAAuBttC,SAAUqtC,GACjCE,EAAoBvtC,SAAUqtC,GAC9BA,EAAiBrtC,SAAU9G,EAASgS,WAiBP,IAAxBhS,EAASy0B,MAAM1tB,OACnBgT,EAAU/Z,EAASy0B,MAAM1tB,OAI1B/G,EAASgS,UAAU3Q,GAAI,0BAA0B,WAChD0Y,EAAU/Z,EAASy0B,MAAM1tB,UAGnBhH,U,gkBC1zBV,Q,WA9UC,WAAanB,EAAUuG,EAAeqY,I,4FAAc,SACnDzd,KAAKnB,SAAaA,EAClBmB,KAAKoF,cAAiBA,EACtBpF,KAAKyd,aAAgBA,EAGrBzd,KAAK2Y,S,2CAGN,WAEC3Y,KAAKS,WAAaN,IAAE,4BACpBH,KAAKgD,MAAQhD,KAAKS,WAElBT,KAAKkD,eACLlD,KAAKw0C,kBAECx0C,KAAKyd,aAAaP,YAAald,KAAKS,c,0BAG3C,WACC,IAAMg0C,EAAUt0C,IAAE,8KAAD,OAKQ,WAAjBH,KAAKnB,SAAwBX,iBAAiBc,KAAKyD,QAAQiF,OAASxJ,iBAAiBc,KAAKC,OAAOyI,OALxF,+EAaPgtC,EAAe,IAAIhxC,UAAgB1D,KAAKnB,UAC5C41C,EAAQ5xC,OAAQ6xC,GAGhB,IAAIC,EAAY,IAAI/wC,UAAgB5D,KAAKoF,eACzCqvC,EAAQ5xC,OAAQ8xC,GAGhB,IAAIC,EAAkB,IAAI9wC,UAAe9D,KAAKoF,eAC9CqvC,EAAQlyC,KAAM,eAAgB8E,QAASutC,GAGvC50C,KAAKS,WAAWoC,OAAQ4xC,K,6BAG/B,WAAiB,IACZtxC,EAAO0xC,EADK,OAIM,WAAjB70C,KAAKnB,UACTsE,GAAoBoiC,2BAAuBvlC,KAAKoF,cAAe,YAC/DyvC,EAAqB32C,iBAAiBc,KAAKyD,QAAQsO,OAC9B7S,iBAAiBc,KAAK4f,QAAQk2B,gBAEzB,UAAjB90C,KAAKnB,WACdsE,GAAqBoiC,2BAAuBvlC,KAAKoF,cAAe,WAChEyvC,EAAqB32C,iBAAiBc,KAAKC,OAAO8R,OAC7B7S,iBAAiBc,KAAK4f,QAAQm2B,eAIpD,IAAMt0C,EAAeN,IAAE,0ZAAD,OASC00C,EATD,+kBAkBZ32C,iBAAiBc,KAAK6J,UAlBV,6HA4BhBsH,EAAoB1P,EAAW8B,KAAM,iBACrCyyC,EAAoBv0C,EAAW8B,KAAM,wBACrC0yC,EAAoBx0C,EAAW8B,KAAM,qCACrC2yC,EAAoB,CACnBjjC,UAAWxR,EAAW8B,KAAM,gCAC5BkiC,UAAWhkC,EAAW8B,KAAM,iDAC5BmiC,YAAa,CACZzyB,UAAWxR,EAAW8B,KAAM,mDAC5B4yC,KAAW10C,EAAW8B,KAAM,6CAE7BsG,UAAWpI,EAAW8B,KAAM,4CAI9BY,EAAMyc,kBAEVs1B,EAAWzQ,UAAU5hC,OAAQM,EAAMshC,UAAU/1B,KAAI,SAAEpM,GAElD,IAAM8yC,EAAQ9yC,EAAKuiC,OAGb7hC,EAAQ7C,IAAE,sDAAD,OAC4Bi1C,EAAQ,kCAAoC,GADxE,uCAEG9yC,EAAKilB,mBAAmBC,cAAchW,QAAS,WAAY,IAF9D,4BAGV8V,wBAAoBhlB,EAAKilB,mBAAoB,qDAAsD,WAHzF,yBAIV6tB,EAAQ,kDAAH,OAAsDl3C,iBAAiBc,KAAK4f,QAAQC,IAApF,WAAoG,GAJ/F,iCAmHf,OA1GA7b,EAAM1B,GAAI,SAAS,WAElB0zC,EAAcjyC,SAAU,gCAGxBC,EAAMD,SAAU,uCAGhB,IAAMsyC,EAAkB,CAAE,UAAW,UAAWlsC,SAAU,EAAKtK,UAAvC,kBAAgE,EAAKA,UAAc,GAIvGy2C,EAAc,GAClBn1C,SAAQmC,EAAKiE,SAAS,SAAE8D,EAAO7D,IACzBjI,eAAWiI,EAAOq7B,iBACtByT,EAAa9uC,EAAOq6B,aAAgBr6B,EAAOq7B,kBAK3B,aAAbv/B,EAAKlE,OAETk3C,EAAY5R,sBAAsBnlC,eAAW+D,EAAKohC,sBAAwBphC,EAAKohC,sBAIhFhiC,cAAU,MAAO,CAChBC,aAAczD,iBAAiBI,OAAO2C,GACtChC,OAAco2C,EACdzzC,UAAcU,EAAKxB,KACnBe,aAAc1B,WAAU,GAAIm1C,EAAa,CACxCxzC,iBAAkB5D,iBAAiB6D,aAAc,EAAKqD,eAAgBnD,KACtEC,SAAcI,EAAKJ,aAElB,SAAEC,GAwBJ,GArBA,IAAI+lB,UACJ,IAAI9lB,WAoBC7D,eAAW4D,EAASE,SAAW,CAEnC,IAAMkzC,GAAWp3C,oBAAgB,OAAQ,CACxC8C,GAAIkB,EAASE,UAMEnE,iBAAiBI,OAAO6E,MAAOhB,EAASE,SAAUyX,QAK1D5b,iBAAiBI,OAAOwpB,QAE9BytB,EAASjzC,KACPC,KAAM,uCACNuD,KAAM,WAAW,GACjBrD,QAAS,UAMZ8yC,EAASjzC,KACPC,KAAM,sDACNC,QACAC,QAAS,aAGX,SAAEN,GACJnE,QAAQC,IAAK,wCAGb+2C,EAAcjqC,YAAa,gCAG3B/H,EAAM+H,YAAa,uCAGM,GAApB5I,EAAS00B,SACb,IAAI3O,gBAMAllB,MAKRkyC,EAAWzQ,UAAUhtB,SAIjBtU,EAAM2hC,oBAEVoQ,EAAWxQ,YAAYyQ,KAAKtyC,OAAQM,EAAMuhC,YAAYh2B,KAAI,SAAEpM,GAG3D,IAAMkzC,EAAa,oBAAH,OAAwB,EAAKpwC,cAA7B,YAAgD,EAAKA,cAArD,aAAwEkiB,wBAAoBhlB,EAAKL,KAAM,GAAI,IAAKulB,cAAchW,QAAS,WAAY,MAmBnK,OAhBcrR,IAAE,wBAAD,QACFif,wBAAoB,uCAAwC,CACnE,WAAgB,oBAChB,WAAgB,iBAChB,aAAgB,gBAChB,YAAgBo2B,IALP,oJASGlzC,EAAKL,KAAKulB,cAAchW,QAAS,WAAY,IAThD,yFAWV8V,wBAAoBhlB,EAAKL,KAAM,qDAAsD,WAX3E,wEAYqC/D,iBAAiBc,KAAK4f,QAAQC,IAZnE,0CAqBhBq2B,EAAWxQ,YAAYzyB,UAAUwF,SAIlC,IAAMiwB,EAASwN,EAAWjjC,UAAU1P,KAAM,4EAGpC0yC,EAAa3zC,GAAI,SAAS,WAEtB,IAAMm0C,EAAQR,EAAajuC,MAAMwgB,cAAchW,QAAS,WAAY,IAGpEk2B,EAAO38B,YAAa,qEAGpB,IAAI2qC,GAAa,GAGVt2C,aAASq2C,KAExBC,GAAa,EAEbv1C,SAAQunC,GAAQ,SAAEr9B,EAAO/H,GACxB,IAAIU,EAAQ7C,IAAGmC,IAGgB,IAFnBU,EAAMkO,KAAM,UAEdH,OAAQ0kC,IACdzyC,EAAMD,SAAU,oCAGhB2yC,GAAa,GAGb1yC,EAAMD,SAAU,wCAMbmyC,EAAWrsC,UAAUkC,YAAa,qEAE3B2qC,EAIfR,EAAWrsC,UAAU9F,SAAU,oCAH/BmyC,EAAWrsC,UAAU9F,SAAU,uCAQ3BoN,EAAkBtN,OAAQ7C,KAAK21C,sBAG/B31C,KAAKS,WAAWoC,OAAQpC,K,gCAG/B,WAAoB,WACf+9B,EAAgBr+B,IAAG,SAAU,CAAE,MAAS,+BAAgCyG,KAAM1I,iBAAiBc,KAAKujB,QAMxG,OAJAic,EAAcl9B,GAAI,SAAS,WAC1B,IAAIkc,UAAyB,EAAK3e,SAAU,EAAKmE,UAG3Cw7B,O,m3DC/UYjwB,EACjB,WAAapN,GAET,GAFgB,UAEXA,EAAMgD,WAAWmB,eAElB,MAAmB,YAAdnE,EAAM/C,KACA,IAAIw3C,EAAuBz0C,GAG3B,IAAI00C,EAAoB10C,IAMzC00C,E,8BACF,WAAa10C,GAAO,wBAChB,cACIA,EAAMgD,WAAWtF,SACjBsC,EAAM/C,OAIL+C,MAAQA,EAGb,EAAKA,MAAMoN,cAAX,KAGA,EAAKoK,SAGL,EAAKm9B,UAGL,EAAK30C,MAAMqL,WAAWlL,GAAI,uBAAuB,WAE7C,EAAKy0C,sBAGL,EAAKz+B,OAAO3U,SAAU,EAAK2U,OAAO9V,YAClC,EAAKw0C,eAGL,EAAKC,kBAGL,EAAKC,4BA/BO,E,gCAmCpB,WACIl2C,KAAKm2C,oBAAsB,IAAIA,EAAqBn2C,KAAKmB,MAAOnB,KAAKqjC,U,qBAGzE,WACIrjC,KAAKkR,KAAO,CACRklC,uBAAwB,O,iCAKhC,WACIp2C,KAAKsX,OAAStX,KAAKmB,MAAM4O,U,6BAG7B,WAAiB,WAEb/P,KAAKmB,MAAM0D,MACNiF,IAAK,gBACLxI,GAAI,gBAAgB,SAAEwH,EAAOyf,GAErB,CAAE,OAAQ,QAASpf,SAAU,EAAKhI,MAAMgD,WAAW6D,YAEpD,EAAKsP,OAAO3U,SAAU,IAI1B,EAAK0zC,mBAAL,YAA+B9tB,EAAMtnB,GAArC,OAGA,EAAK+0C,eAGE,CAAE,OAAQ,QAAS7sC,SAAU,EAAKhI,MAAMgD,WAAW6D,YAEtD,EAAKsP,OAAOV,QAIX,CAAE,OAAQ,QAASzN,SAAU,EAAKhI,MAAMgD,WAAW6D,YAEpD,EAAK7G,MAAMwB,SAAX,YAA2B4lB,EAAMtnB,GAAjC,Y,qBAKhB,WAEIjB,KAAKm2C,oBAAoB/+B,Y,gCAU7B,SAAoBxQ,GAChB5G,KAAKsX,OAAOg/B,IAAIC,aAAc3vC,EAAM5G,KAAKsX,OAAOg/B,IAAIE,e,oCAGxD,WAAwB,WACpBx2C,KAAKsX,OAAOhW,GAAI,WAAW0W,eAAU,SAAElP,GAEnC,EAAKktC,iBACNh2C,KAAKkR,KAAKklC,2B,0BAGjB,WASI,IATU,WAMJK,EAAoBz2C,KAAKsX,OAAOo/B,gBAAiB,iBAN7C,aAWN,IAAMr7B,EAAW,CACbs7B,KAAMF,EAAkBE,OACxBC,GAAMH,EAAkBG,MAUtBC,EANU,EAAKv/B,OAAOw/B,SACxBz7B,EAASs7B,KACTt7B,EAASu7B,IAIWplC,QAAS,KAAM,IAAKA,QAAS,KAAM,IAGrDulC,EAAa,EAAKC,mBAAoBH,GAEtCI,EAAS,EAAK3/B,OAAO4/B,SACvB77B,EAASs7B,KACTt7B,EAASu7B,GACT,CACIO,aAAcJ,IAQf,EAAK51C,MAAMgD,WAAW2D,YAEzBivC,EAAWK,iBAAkB,SAAS,WAElC,IAAOL,EAAWM,UAAUC,SAAU,yBAA2B,CAE7DP,EAAWM,UAAU7sC,IAAK,yBAE1B,IAAM+sC,EAAa,WAEfR,EAAWM,UAAU5/B,OAAQ,yBAI7B1F,SAASylC,oBAAqB,UAAWC,GAIzC1lC,SAASylC,oBAAqB,OAAQE,GAGtC3lC,SAASylC,oBAAqB,UAAWG,GAIzC5lC,SAASylC,oBAAqB,UAAWI,IAIvCH,EAAiB,SAAE3uC,GAGbiuC,IAAejuC,EAAM8e,QAGlBmvB,EAAWO,SAAUxuC,EAAM8e,SAElC2vB,KAGRxlC,SAASqlC,iBAAkB,UAAWK,GAGtC,IAAMC,EAAS,SAAE5uC,GACbyuC,KAGA/J,qBAAgB,KAAD,OAAQqJ,EAAR,QAEnB9kC,SAASqlC,iBAAkB,OAAQM,GAGnC,IAAMC,EAAW,SAAE7uC,GAEf,IAAMzI,EAAMyI,EAAM2hB,SAAW3hB,EAAM+uC,SAGnC,GAAY,GAAPx3C,GAAmB,IAAPA,EAAW,CAExB,IAAMy3C,EAAiBb,EAAO10C,OAG9B00C,EAAO5tC,QAGP,EAAKiO,OAAOi/B,aACR,GACAuB,EAAenB,KACfmB,EAAelB,IAGnBW,MAGRxlC,SAASqlC,iBAAkB,UAAWO,GAGtC,IAAMC,EAAe,SAAE9uC,GAEnB,IAAMzI,EAAMyI,EAAM2hB,SAAW3hB,EAAM+uC,SAGnC,GAAY,IAAPx3C,GAAoB,IAAPA,EAAW,CACzBk3C,IAGA,IAGIl8B,EAHEy8B,EAAiBb,EAAO10C,OAMlB,IAAPlC,IAEDgb,EAAWy8B,EAAenB,MAIlB,IAAPt2C,IAEDgb,EAAWy8B,EAAelB,IAI9B,EAAKt/B,OAAOV,QAGZ,EAAKU,OAAOygC,UAAW18B,KAG/BtJ,SAASqlC,iBAAkB,UAAWQ,QA7I9CnB,EAAkBuB,YAAY,Q,GAlHbjO,WAuQ3B6L,E,8BACF,WAAaz0C,GAAO,wBAChB,cACIA,EAAMgD,WAAWtF,SACjBsC,EAAM/C,OAIL+C,MAAQA,EAGb,EAAKA,MAAMoN,cAAX,KAGA,EAAKunC,UAGL,EAAKn9B,SAGL,EAAKxX,MAAMqL,WAAWlL,GAAI,oBAAoB,WAE1C,EAAK22C,mBAGL,EAAKC,oBAGLrrC,YAAW,WACP,EAAKsrC,8BACN,EAAKjnC,KAAKklC,wBAGbvpC,YAAW,WACP,EAAK2B,mCACN,EAAK0C,KAAKklC,wBAGb,EAAKH,kBAGL,EAAKmC,kCAGL,EAAKC,gCA3CO,E,iCA+CpB,WACIr4C,KAAKkR,KAAO,CACRklC,uBAAwB,IACxBkC,cAAe,uB,oBAIvB,WACIt4C,KAAKm2C,oBAAsB,IAAIA,EAAqBn2C,KAAKmB,MAAOnB,KAAKqjC,U,6BAGzE,WAAiB,WAEbrjC,KAAKmB,MAAM0D,MAAMvD,GAAI,gBAAgB,SAAEwH,EAAOyf,GAE1C,EAAK8tB,mBAAoB9tB,EAAMtnB,S,gCAIvC,WAAgC,IAAZsnB,EAAY,uDAAJ,GAElBgwB,EAAoB,KAAH,OAAShwB,EAAT,MAGvB,GAAKvoB,KAAKmB,MAAMqL,WAAWiC,GAAI,YAAc,CAGzC,IAAM+pC,EAAoBx4C,KAAKmB,MAAMqL,WAAW1G,KAAM,kBAChD2yC,EAAoBD,EAAiBD,EAAkBtpC,OAGvDlO,EAAef,KAAKmB,MAAMqL,WAAWxF,MAGrC0xC,EAAe33C,EAAakrC,OAAQ,EAAGuM,GAAmBD,EAAoBx3C,EAAakrC,OAAQuM,GAGzGx4C,KAAKmB,MAAMwB,SAAU+1C,GAAU,GAG/B14C,KAAKmB,MAAMqL,WAAWoK,QAGtB5W,KAAKmB,MAAMqL,WAAW1G,KAAM,eAAgB2yC,OAE3C,CAED,IAAM1B,EAAa/2C,KAAKg3C,mBAAoBzuB,GAG5CvoB,KAAKsX,OAAOy2B,YAAa,oBAAoB,EAA7C,uBAAqE/tC,KAAKkR,KAAKonC,cAA/E,oDAA0I/vB,EAA1I,aAAsJwuB,EAAWvtB,UAAjK,YAIJxpB,KAAKmB,MAAMqL,WACN/J,QAAS,kB,8BAGlB,WACIzC,KAAKsX,OAAStX,KAAKmB,MAAMyO,e,+BAG7B,WACI5P,KAAKsX,OAAOqhC,IAAIC,SAAhB,0qH,6CAgGJ,WAAiC,WAE7B54C,KAAKmB,MAAMqL,WACNlL,GAAI,gBACD0W,eAAS,WAEL,EAAKxJ,mCACNxO,KAAKkR,KAAKklC,yBAKrBp2C,KAAKmB,MAAMqL,WACNlL,GAAI,iCAAiC,WAElCuL,YAAW,WACP,EAAK2B,mCACN,EAAK0C,KAAKklC,6B,wCAIzB,WAA4B,WAGxBp2C,KAAKmB,MAAMqL,WACNlL,GAAI,mCAAmC,WAEpCuL,YAAW,WACP,EAAKsrC,8BACN,EAAKjnC,KAAKklC,6B,uCAIzB,WAEI,IAAMyC,EAAgB74C,KAAKsX,OAAOW,WAAW,CACzCzM,OAAQ,QAINstC,EAA0B94C,KAAKiqC,qBACjC4O,EACA,CAEI1nC,SAAU,gBAAF,OAAmBnR,KAAKkR,KAAKonC,cAA7B,gEAKXO,GAAiBC,GAElB94C,KAAKsX,OAAOzH,WAAYipC,EAAwB9L,a,4CAIxD,WAEI,IAAI5qB,EAAUpiB,KAAKmB,MAAMqL,WAAWxF,MAGhC+xC,EAAqBhnC,SAASg7B,cAAe,OACjDgM,EAAmB/L,UAAY5qB,EAG/B,IAAM42B,EAAUD,EAAmBE,iBAAnB,WAA0Cj5C,KAAKkR,KAAKonC,gBAI/DU,EAAQ/pC,OAAS,IAElB+pC,EAAQzpC,SAAQ,SAAEwnC,GAEd,IAAMmC,EAAUnC,EAAWoC,QAAQtC,QAGnCE,EAAWvtB,UAAX,YAA6B0vB,EAA7B,SAIJ92B,EAAU22B,EAAmB/L,UAI7BhtC,KAAKmB,MAAMqL,WAAWxF,IAAKob,M,qBAInC,WACIpiB,KAAKm2C,oBAAoB/+B,c,GAvSG2yB,WA2S9BoM,E,WACF,WAAah1C,EAAOkiC,GAAQ,UACxBrjC,KAAKmB,MAASA,EACdnB,KAAKqjC,OAASA,EAGdrjC,KAAKo5C,UAGLp5C,KAAKkjB,cAGLljB,KAAKq5C,gBAGLr5C,KAAKs5C,eAGLt5C,KAAKu5C,uBAGLv5C,KAAKw5C,qBAGLx5C,KAAKy5C,+BAGLz5C,KAAK05C,+BAGL15C,KAAK25C,uBAGL35C,KAAK+Q,SAGA/Q,KAAK45C,wBACN55C,KAAK65C,WAAW,G,iCAIxB,WACI75C,KAAKkR,KAAO,CACR4oC,QAAU,EACVz+B,SAAU,W,yBAIlB,WACIrb,KAAKo2B,UAAY,CACb2jB,QAAS,KACTC,aAAc,KACdC,YAAa,KACbpzB,SAAU,KACVqzB,UAAW,KACXC,wBAAyB,KACzBC,eAAgB,KAChBC,gBAAiB,Q,2BAIzB,WACI,IAAMC,EAAWn6C,IAAE,orBAAD,OAasBjC,iBAAiBc,KAAKqkC,OAAOtyB,OAbnD,0NAuBZwpC,EAAkC,YAAnBv6C,KAAKmB,MAAM/C,KAAqB4B,KAAKmB,MAAMqL,WAAaxM,KAAKmB,MAAMq5C,aAGxFF,EACKt8B,YAAau8B,GAElBD,EACK/3C,KAAM,oCACNM,OAAQ03C,GAGbv6C,KAAKo2B,UAAU2jB,QAAUO,EAGzBt6C,KAAKo2B,UAAUqkB,gBAAkBH,EAC5B/3C,KAAM,oCAGXvC,KAAKo2B,UAAUskB,qBAAuBJ,EAAS/3C,KAAM,0BAGrDvC,KAAKo2B,UAAU6jB,YAAcK,EAAS/3C,KAAM,gCAG5CvC,KAAKo2B,UAAU4jB,aAAeM,EAAS/3C,KAAM,0BAG7CvC,KAAKo2B,UAAUvP,SAAWyzB,EAAS/3C,KAAM,4BAGzCvC,KAAKo2B,UAAU+jB,wBAA0BG,EAAS/3C,KAAM,4B,0BAG5D,WAAc,WAEV,GAAKvC,KAAK45C,uBAAwB,CAE9B,IAAM5xC,EAAYhI,KAAKmB,MAAMgD,WAAW6D,UAGlC2yC,GAAyBp8C,eAAWL,iBAAiBc,KAAKqkC,OAAOuX,UAAW5yC,IAAgB9J,iBAAiBc,KAAKqkC,OAAOuX,UAAW5yC,GAAcA,EAGlJ6yC,EAAmB16C,IAAE,6EAKrB26C,EAAe,IAAI35C,UAAO,WAAY,CACxC6D,WAAc,sBACdjE,cAAc,EACdhB,MAAO,8CAA+CwI,cAAUrK,iBAAiBc,KAAKqkC,OAAOzkC,OAAQ,CAAC,4CAAD,OAA+C+7C,EAA/C,aAA9F,WAILI,EAAqBD,EAAav2C,oBAGxCs2C,EAAiBxzC,QAAS0zC,GAG1B/6C,KAAKo2B,UAAUskB,qBAAqB73C,OAAQg4C,GAG5C76C,KAAKo2B,UAAU4kB,gBAAkBH,EAGjCE,EAAmBz5C,GAAI,0BAA0B,WAEzBw5C,EAAat5C,WAI7B,EAAKq4C,WAAW,GAGhB,EAAKA,WAAW,S,kCAMhC,WAAsB,WAEZp5C,EAAaT,KAAKo2B,UAAU2jB,QAAQx3C,KAAM,0BAGhDvC,KAAKqjC,OAAO9zB,SAAQ,SAAE0rC,GAClBx6C,EAAWoC,OAAQ,EAAKq4C,8BAA+BD,OAI3Dj7C,KAAKo2B,UAAU8jB,UAAYz5C,EAAW8B,KAAM,yBAG5CvC,KAAKo2B,UAAUgkB,eAAiB35C,EAAW8B,KAAM,8BAGjDvC,KAAKo2B,UAAUikB,gBAAkBl6C,IAAE,8MAAD,OAGnBjC,iBAAiBc,KAAKqkC,OAAOx6B,UAHV,yIAMnB7I,KAAK45C,uBAAyB17C,iBAAiBc,KAAKqkC,OAAO8X,+BAAiCj9C,iBAAiBc,KAAKqkC,OAAO+X,qBANtG,2DAUlC36C,EAAWoC,OAAQ7C,KAAKo2B,UAAUikB,mB,2CAGtC,SAA+BY,GAAe,WACpCI,EAASl7C,IAAE,+FAAD,OAGI86C,EAAch6C,GAHlB,+hBAiBVq6C,EAAYL,EAAch5C,KACL,WAArB,EAAQq5C,KACEA,EAAU5xC,KAAK6xC,Q,4DAA3B,IAGJF,EACK94C,KAAM,4CACNM,OAAQo4C,EAAch5C,MAG3B,IAAI0B,EAAQs3C,EAAch9B,KAAKs9B,QAG/BF,EAAO94C,KAAM,qCAAsCM,OAAQc,GAGrC03C,EAAO94C,KAAM,gCAErBjB,GAAI,SAAS,WACvB+5C,EAAOvb,YAAa,iCAIxB,IAAM0b,EAAuBH,EAAO94C,KAAM,kCAqG1C,OAlGA04C,EAAc5X,OAAO9zB,SAAQ,SAAEgZ,GAE3B,IAAMC,EAASroB,IAAE,oHAAD,OAIJooB,EAAMtmB,KACDkN,OACAqY,cACAhW,QAAS,MAAO,IAPjB,6CASM+W,EAAMnqB,KATZ,qDAWLmqB,EAAMtmB,KAXD,2CAgBC,gBAAZsmB,EAAMtnB,GAEPunB,EAAOlnB,GAAI,SAAS,WAEhB,EAAKm6C,QAGL,IAAMC,EAAgBv7C,IAAE,eAGlBw7C,EAAe,IAAIx6C,UAAO,OAAQ,CACpC6D,WAAY,sBACZjF,MAAO7B,iBAAiBc,KAAKqkC,OAAOuY,cAAcC,SAAS55B,MAAM65B,YACjE7zC,YAAa/J,iBAAiBc,KAAKqkC,OAAOuY,cAAcC,SAAS55B,MAAM85B,uBACvEv2C,YAAY,IAIhBk2C,EAAc74C,OAAQ84C,EAAap3C,qBAGnC,IAAM0d,EAAQ,IAAIE,UAAM,CACpBtG,MAAO3d,iBAAiBc,KAAKqkC,OAAOuY,cAAcC,SAAS55B,MAAMpG,MACjEuG,QAASs5B,EACTp5B,QAAS,CACLC,OAASrkB,iBAAiBc,KAAKujB,OAC/BC,QAAStkB,iBAAiBc,KAAKqkC,OAAOuY,cAAcC,SAAS55B,MAAMgB,iBAI3EhB,EAAMU,UAAU,CACZC,eAAgB,WACZX,EAAMY,QAEVC,UAAW,WAEP,IAAMk5B,EAAkBL,EAAa3hC,WAG/B5K,EAAausC,EAAan6C,WAG3Bw6C,EAAgBliC,WAEjByO,EAAQpoB,YAAU,EAAM,GAAIooB,IAGtBtnB,GAAKsnB,EAAMtnB,GAAGuQ,QAAS,MAAOpC,GAGpCmZ,EAAMtmB,MAAOsG,cAAUrK,iBAAiBc,KAAKqkC,OAAO4Y,OAAOC,oBAAqB,CAAE9sC,IAGlF,EAAKjO,MAAM0D,MAAMpC,QAAS,eAAgB8lB,GAG1CtG,EAAM7K,YAGd4L,UAAW,WACPf,EAAM7K,gBAOlBoR,EAAOlnB,GAAI,SAAS,WAEhB,EAAKH,MAAM0D,MAAMpC,QAAS,eAAgB8lB,GAG1C,EAAKkzB,WAKbD,EAAqB34C,OAAQ2lB,MAG1B6yB,I,gCAGX,WAAoB,WAChBr7C,KAAKo2B,UAAU4jB,aAAa14C,GAAI,SAAS,WAE9B,EAAK4P,KAAK4oC,OAIb,EAAK2B,QAHL,EAAK9kC,Y,oBAQjB,WAAQ,WAEJ3W,KAAKo2B,UAAU6jB,YAAY34C,GAAI,SAAS2rC,eAAU,WAE9C,IAAIwI,EAAQ,EAAKrf,UAAU6jB,YAAYjzC,MAGvCyuC,EAAQA,EACHtmC,OACAqY,cACAhW,QAAS,MAAO,KAEdpS,aAASq2C,IAsBZ,EAAKrf,UAAU8jB,UACVnvC,YAAa,8BAGlB,EAAKqrB,UAAUgkB,eACVrvC,YAAa,iDAzBlB,EAAKqrB,UAAU8jB,UACVn3C,SAAU,8BAGf,EAAKqzB,UAAUgkB,eACVr3C,SAAU,+CAGQ,EAAKqzB,UAAUgkB,eACjCx7C,QAAO,SAAEytC,EAAG9jB,GACT,OAAiD,IAA1CA,EAAM4wB,QAAQpoC,OAAOA,OAAQ0kC,MAMvC1qC,YAAa,gDAatB,EAAKoxC,mCACN,O,uBAGP,WAAgC,WAArBC,IAAqB,yDAE5B,GAAKA,EAAc,CAEfp8C,KAAKo2B,UAAUgkB,eACVr3C,SAAU,+CAGf,IAAMs5C,EAAgBr8C,KAAKo2B,UAAUgkB,eAChCx7C,QAAO,SAAEytC,EAAG9jB,GAOT,OAH0C,OAAtBA,EAAM4wB,QAAQ/6C,MAAoD,SAAnC,EAAK+C,MAAMgD,WAAW6D,UAAyB,QAAUugB,EAAM4wB,QAAQ/6C,OAGtG,EAAK+C,MAAMgD,WAAW6D,aAKlDq0C,EACKtxC,YAAa,oDAIlB/K,KAAKo2B,UAAUgkB,eACVrvC,YAAa,+CAItB/K,KAAKm8C,mC,4CAGT,WAMI,IAAIzG,GAAa,EAGjB11C,KAAKo2B,UAAU8jB,UACVnvC,YAAa,kDAGlB/K,KAAKo2B,UAAU8jB,UACVt7C,QAAO,SAAEytC,EAAGb,GAEuBA,EAC3ByN,iBAAkB,kIAClBhqC,OAAS,EAQVymC,GAAa,EAJblK,EAAM6L,UAAU7sC,IAAK,qDAU5BkrC,EACD11C,KAAKo2B,UAAUikB,gBACVt3C,SAAU,8CAGf/C,KAAKo2B,UAAUikB,gBACVtvC,YAAa,gD,kBAI1B,WAGI,GAAK,CAAE,OAAQ,QAAS5B,SAAUnJ,KAAKmB,MAAMgD,WAAW6D,WACpD,IACIhI,KAAKmB,MAAM6O,kBAAkByrC,QAC/B,MAAQx0C,IAIdjH,KAAKo2B,UAAU2jB,QAAQh3C,SAAU,uBAGjC/C,KAAKkR,KAAK4oC,QAAS,EAGnB95C,KAAKs8C,0BAGLt8C,KAAKo2B,UAAU6jB,YACVjzC,IAAK,IACLvE,QAAS,SAGT85C,IAAI,CACD,4BAAyBh+C,eAAWyB,KAAKo2B,UAAU4kB,iBAAoBh7C,KAAKo2B,UAAU4kB,gBAAgBwB,aAAe,GAAM,GAA3H,QAIRx8C,KAAKo2B,UAAU6jB,YACVrjC,QAGL5W,KAAKy8C,uBAGLz8C,KAAK08C,sB,mBAGT,WACI18C,KAAKo2B,UAAU2jB,QAAQhvC,YAAa,uBAGpC/K,KAAKkR,KAAK4oC,QAAS,EAGnB95C,KAAKo2B,UAAU6jB,YACVjzC,IAAK,IACLvE,QAAS,SAGdtC,IAAG4R,UAAWjI,IAAK,8C,qBAGvB,WAEI9J,KAAKo2B,UAAUqkB,gBAAgBkC,WAAW3+B,YAAahe,KAAKo2B,UAAU2jB,SACtE/5C,KAAKo2B,UAAU2jB,QAAQtiC,W,qCAG3B,WAAyB,WACrBtX,IAAG4R,UAAWzQ,GAAI,4CAA4C,SAAEwH,GAE5D,IAAMrI,EAAa,EAAK21B,UAAU2jB,QAE3Bt5C,EAAWgO,GAAI3F,EAAM8e,SAAsD,IAA1CnnB,EAAWonB,IAAK/e,EAAM8e,QAAS3Y,QAEnE,EAAKwsC,a,iCAKjB,WACI,IAAMmB,EAAUz8C,IAAGgZ,QAEbkC,EAAW,GACjBA,EAASwhC,MAAQ78C,KAAKo2B,UAAU2jB,QAAQ+C,SAASC,IAAMH,EAAQI,YAC/D3hC,EAAS4hC,MAAQL,EAAQhP,UAAavyB,EAASwhC,MAAQ78C,KAAKo2B,UAAU2jB,QAAQmD,eAGtD,YAAnBl9C,KAAKmB,MAAM/C,OAEZid,EAAS4hC,MAAQL,EAAQhP,UAAavyB,EAASwhC,MAAQ,KAK3D78C,KAAKo2B,UAAUvP,SAAS9jB,SAAU,eAElC,IAAMo6C,EAAiBn9C,KAAKo2B,UAAUvP,SAASq2B,cAAgB,IAW/D,OAVAl9C,KAAKo2B,UAAUvP,SAAS9b,YAAa,eAGb,YAAnB/K,KAAKmB,MAAM/C,KACZid,EAAS+hC,eAAgB,EAGzB/hC,EAAS+hC,cAAgB/hC,EAAS4hC,OAASE,EAGxC9hC,I,kCAGX,WAEI,IAAMA,EAAWrb,KAAKq9C,sBAGtBr9C,KAAKo2B,UAAU2jB,QAAQhvC,YAAa,6CAG/BsQ,EAAS4hC,MAAQ5hC,EAASwhC,OAASxhC,EAAS+hC,eAE7Cp9C,KAAKo2B,UAAU2jB,QAAQh3C,SAAU,wBAGjC/C,KAAKkR,KAAKmK,SAAW,UAIrBrb,KAAKo2B,UAAU2jB,QAAQh3C,SAAU,wBAGjC/C,KAAKkR,KAAKmK,SAAW,W,+BAI7B,WAEI,GAAKrb,KAAKkR,KAAK4oC,OAAQ,CAEnB,IAAMwD,EAAYt9C,KAAKq9C,sBAAuBr9C,KAAKkR,KAAKmK,UAAarb,KAAKo2B,UAAU6jB,YAAYiD,cAAgB,GAGhHl9C,KAAKo2B,UAAU+jB,wBACVoC,IAAI,CACD,uBAAmBe,EAAnB,W,8BAKhB,WACIt9C,KAAKo2B,UAAU6jB,YACVrjC,U,0CAGT,WAA8B,WAC1BzW,IAAGgZ,QAAS7X,GAAI,UACZ2rC,eAAU,WAEN,EAAKwP,uBAGL,EAAKC,sBACN,O,0CAIX,WAA8B,WAC1Bv8C,IAAGgZ,QAAS7X,GAAI,UACZ0W,eAAU,WAEN,EAAKykC,uBAGL,EAAKC,sBACN,Q,kCAIX,WAAsB,WAElB18C,KAAKmB,MAAMwD,YAAYrD,GAAI,0BAA0B,WAEjD,EAAKm7C,uBAGL,EAAKC,yB,kCAIb,WAEI,IAAM10C,EAAYhI,KAAKmB,MAAMgD,WAAW6D,UAExC,MAAO,CAAE,QAAS,MAAO,QAAS,MAAO,OAAQ,QAASmB,SAAUnB,O,giFC3tCvD+hC,O,WACpB,gBAAalrC,GAA4C,IAAlCmJ,EAAkC,uDAAtB,OAAQzB,EAAc,uDAAJ,GAAI,6BAExDvG,KAAKu9C,SAAU1+C,EAAUmJ,EAAWzB,GAGpCvG,KAAKo5C,U,kDAGN,SAAUv6C,EAAUmJ,EAAWzB,GAC9BvG,KAAKnB,SAAYA,EACjBmB,KAAKgI,UAAYA,EAEjBhI,KAAKuG,QAAU+Y,OAAOkmB,OAAQ,CAC7BwE,kBAAoB,EACpBqJ,kBAAoB,EACpBmK,oBAAoB,GAClBj3C,GAEHvG,KAAKy9C,YAAc,IAAI/U,OAAQ,qB,qBAGhC,WAEC1oC,KAAKqjC,OAASrjC,KAAK09C,iB,0BAWpB,WACC,IAAIC,EAAa,GAGXC,EAAe59C,KAAK69C,kBAErBD,EAAava,OAAOp0B,OAAS,GACjC0uC,EAAWruC,KAAMsuC,GAIlB,IAAME,EAAiB99C,KAAK+9C,oBAEvBD,EAAeza,OAAOp0B,OAAS,GACnC0uC,EAAWruC,KAAMwuC,GAIlB,IAAME,EAAch+C,KAAKi+C,iBAIzB,MAFa,GAAH,0BAAQN,GAAR,mBAAuBK,M,6BAgBlC,WAEC,IAAMJ,EAAe,CACpB38C,GAAQ,UAuHT,OAnHKjB,KAAKuG,QAAQyjC,mBACjB4T,EAAa37C,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAOiC,QAIpDl+C,KAAKuG,QAAQ8sC,mBACjBuK,EAAa3/B,KAAO9d,8CAAE,0EAMlBH,KAAKuG,QAAQi3C,qBACjBI,EAAava,OAAS,CACrB,CACCpiC,GAAM,YACN7C,KAAM,OACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAOkC,SAC3CC,WAAW,KAQqB,aAAhClgD,iBAAiBI,OAAOF,MACF,WAAjB4B,KAAKnB,UAA0C,iBAAjBmB,KAAKnB,WAItC++C,EAAava,OAAO/zB,KAChB,CACIrO,GAAM,UACN7C,KAAM,MACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAOoC,OAC3CD,WAAW,GAEf,CACIn9C,GAAM,gBACN7C,KAAM,OACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAOqC,aAC3CF,WAAW,GAEf,CACIn9C,GAAM,iBACN7C,KAAM,OACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAOsC,cAC3CH,WAAW,GAEf,CACIn9C,GAAM,gBACN7C,KAAM,OACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAOuC,aAC3CJ,WAAW,GAEf,CACIn9C,GAAM,aACN7C,KAAM,QACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAOwC,UAC3CL,WAAW,GAEf,CACIn9C,GAAM,mBACN7C,KAAM,OACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAOyC,YAC3CN,WAAW,GAEf,CACIn9C,GAAM,kBACN7C,KAAM,MACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAO0C,kBAC3CP,WAAW,IAMvBR,EAAava,OAAO/zB,KACnB,CACIrO,GAAM,cACN7C,KAAM,QACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAO2C,WAC3CR,WAAW,GAEf,CACIn9C,GAAM,WACN7C,KAAM,MACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAO4C,QAC3CT,WAAW,GAEf,CACIn9C,GAAM,cACN7C,KAAM,OACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAO6C,WAC3CV,WAAW,GAEf,CACIn9C,GAAM,eACN7C,KAAM,OACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAO8C,YAC3CX,WAAW,GAEf,CACIn9C,GAAM,eACN7C,KAAM,OACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAO+C,YAC3CZ,WAAW,KAQVR,I,+BAcR,WAEC,IAAME,EAAiB,CACtB78C,GAAQ,WACRoiC,OAAQ,IAiDN,OA7CErjC,KAAKuG,QAAQyjC,mBACjB8T,EAAe77C,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAOgD,UAItDj/C,KAAKuG,QAAQ8sC,mBACjByK,EAAe7/B,KAAO9d,8CAAE,0EAMpBH,KAAKuG,QAAQi3C,qBAKoB,aAAhCt/C,iBAAiBI,OAAOF,MACF,WAAjB4B,KAAKnB,UAA0C,iBAAjBmB,KAAKnB,YAG5Ci/C,EAAeza,OAAO/zB,KAAK,CAC1BrO,GAAM,eACN7C,KAAM,OACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAOH,YAC3CsC,WAAW,KAIX7/C,qDAAWL,iBAAiBM,KACzB,MAAQN,iBAAiBM,IAE5Bs/C,EAAeza,OAAO/zB,KAAK,CAC1BrO,GAAM,gBACN7C,KAAM,OACN6D,KAAO/D,iBAAiBc,KAAKqkC,OAAO4Y,OAAOiD,cAC3Cd,WAAW,KASLN,I,4BAYX,WAAgB,WACXE,EAAc,GAId76C,EAAQjF,iBAAiBI,OAAO6E,MAoCpC,OAnCK5E,qDAAWyB,KAAKnB,YAEpBsE,EAAQ,GAEA,CAAE,SAAU,UAAW,iBAAkBgG,SAAUnJ,KAAKnB,YACzDsE,EAAQhD,qDAAU,GAAIgD,GAAOxE,uDAAa,MAAO,CAC7CC,OAAQ,CACJC,SAAU,eAKA,WAAjBmB,KAAKnB,WACNsE,EAAQhD,qDAAU,GAAIgD,GAAOxE,uDAAa,MAAO,CAC7CC,OAAQ,CACJC,SAAU,eAO1BygB,OAAOC,QAASpc,GAAQoM,SAAS,YAAwB,0BAAZjN,GAAY,WAElDonC,EAAa,EAAKyV,cAAe78C,IAItConC,EAAWrG,OAAOp0B,OAAS,IACtB,EAAK1I,QAAQi3C,qBAElBQ,EAAY1uC,KAAMo6B,MAIbsU,I,2BAoBR,SAAAmB,cAAe78C,MAEd,IAAI88C,YAAc,CACRn+C,GAAgBqB,KAAKgB,SACrB2J,cAAgB3K,KAAKc,iBAI/B,GAAKpD,KAAKuG,QAAQyjC,iBAAkB,CAGnC,IAAI5hB,aAAe9lB,KAAKJ,SACjBI,KAAK2kB,YACRmB,cAAejB,yDAAe7kB,KAAKc,gBAAiBd,KAAKzD,SAAUyD,KAAKgB,UAAWpB,UAIvFk9C,YAAYn9C,MAAOqmB,iEACThmB,KACA8lB,aACAlqB,iBAAiBI,OAAO6E,MAAOb,KAAKrB,IAAKoO,MACzC,GACC3F,KAIZ,GAAK1J,KAAKuG,QAAQ8sC,iBAAkB,CAE7B,IAAI1vC,MAEJ,IAAKpF,qDAAWL,iBAAiB6D,aAAcO,KAAKc,kBAAqB,CAErE,IAAMpB,YAAc9D,iBAAiB6D,aAAcO,KAAKc,kBAGnD7E,qDAAWyD,YAAYid,UACxBtb,MAAQxD,8CAAE,iEAAD,OAEO6B,YAAYid,SAFnB,8CAGOjd,YAAYC,KAHnB,oDAQH1D,qDAAWyD,YAAYq9C,WAAa9gD,qDAAWyD,YAAYkd,WACjEvb,MAAQxD,8CAAE,iEAAD,OAEO6B,YAAYq9C,QAFnB,kDAGU92C,oDAAU,eAAgB,CAAEvG,YAAYq9C,QAASr9C,YAAYkd,UAHvE,6CAIOld,YAAYC,KAJnB,oDAWjBm9C,YAAYnhC,KAAOta,MAI1B,GAAK3D,KAAKuG,QAAQi3C,mBAAoB,CACrC,IAAI9T,WAAa,GA8FX,GAzFApqB,OAAOC,QAASjd,KAAKiE,SAAUgJ,SAAS,YAAwC,oCAElEpB,OAAOoB,SAAS,SAAEpO,GAE9B,IAAM4D,EAAkB5D,EAAM2M,gBAKU,YAA7B/I,EAAgBiD,UAEjB7G,EAAMuZ,UAAUnL,SAAQ,SAAE8K,EAAKhQ,GAE3B,IAAMi1C,EAAWj1C,EAGjBgQ,EAAI9K,SAAQ,SAAEpO,GAEVuoC,WAAWp6B,KAAK,CAGZrO,GAAI,GAAF,OAAWqB,KAAKrB,GAAhB,YAAwBqB,KAAKgB,SAA7B,YAA2CyB,EAAgBC,WAA3D,YAA2Es6C,EAA3E,YAAyFn+C,EAAM2M,gBAAgB9I,YAGjH/C,KAAM,GAAF,OAAS8C,EAAgBuD,UAAzB,eAA0CC,oDAAUrK,iBAAiBc,KAAKugD,UAAW,CAAID,EAAW,IAApG,cAAmHn+C,EAAM2M,gBAAgBxF,WAC7IlK,KAA4C,UAAnC+C,EAAM2M,gBAAgB9F,WAA4D,YAAnC7G,EAAM2M,gBAAgB9F,UAA0B,OAAS7G,EAAM2M,gBAAgB9F,UACvIvB,MAAStF,EAAMK,WACf6V,QAASlW,EAAM2M,gBAAgB9I,WAC/Bd,OAAS5B,KAAKrB,GACdm9C,WAAW,UAKY,SAA7Br5C,EAAgBiD,aAOxBzJ,qDAAWwG,EAAgB+8B,qBACxByI,oDAAUxlC,EAAgB+8B,mBAG7BxiB,OAAOC,QAASxa,EAAgB+8B,mBAAoBvyB,SAAQ,YAA8B,0BAA1BsnC,EAA0B,KAAjBvuC,EAAiB,KACzFohC,WAAWp6B,KAAK,CACHrO,GAAI,GAAF,OAAYqB,KAAKrB,GAAjB,YAAyBqB,KAAKgB,SAA9B,YAA4CuzC,GAC9C50C,KAAWqG,EACXlK,KAAwC,UAA7B2G,EAAgBiD,WAAsD,YAA7BjD,EAAgBiD,UAA0B,OAASjD,EAAgBiD,UACvHvB,MAAWtF,EAAMK,WACjB6V,QAAWtS,EAAgBC,WAC3Bd,OAAW5B,KAAKrB,GAChBm9C,WAAW,OAMzB1U,WAAWp6B,KAAK,CACNrO,GAAI,GAAF,OAAWqB,KAAKrB,GAAhB,YAAwBqB,KAAKgB,SAA7B,YAA2CyB,EAAgBC,YAC7D/C,KAAS8C,EAAgBuD,UACzBlK,KAAsC,UAA7B2G,EAAgBiD,WAAsD,YAA7BjD,EAAgBiD,UAA0B,OAASjD,EAAgBiD,UACrHvB,MAAStF,EAAMK,WACf6V,QAAStS,EAAgBC,WACzBd,OAAS5B,KAAKrB,GACdm9C,WAAW,WAS/B97C,KAAK+gC,OAAO9zB,SAAQ,SAAEgZ,GACrBmhB,WAAWp6B,KAAK,CACTrO,GAAI,GAAF,OAAQqB,KAAKrB,GAAb,YAAqBsnB,EAAMi3B,gBAA3B,YAAgDj3B,EAAMsuB,SACxD50C,KAAMsmB,EAAMjgB,UACZlK,MAAMG,qDAAWgqB,EAAMqyB,WAAcryB,EAAMqyB,UAAY,OACvD12C,OAAQ5B,KAAKrB,GACbm9C,WAAW,OAKnBgB,YAAY/b,OAASqG,aAGdtqC,mDAASkD,KAAKihC,cAEjB,IAEI,IAAMA,aAAepY,KAAK,IAAD,OAAO7oB,KAAKihC,aAAa/xB,QAAS,WAAY,IAAKA,QAAS,aAAa,IAAKrC,OAA9E,MAGzBu6B,WAAanG,aAAc6b,YAAa98C,MAC1C,MAAQ2E,GACTjJ,QAAQC,IAAKgJ,GACbjJ,QAAQC,IAAKqE,KAAKihC,eAexB,OAAO6b,c,gCAYd,SAAoB/b,GAAQ,WA4B3B,OAzBK9kC,qDAAWyB,KAAKgI,aAGb,CAAE,OAAQ,WAAY,OAAQmB,SAAUnJ,KAAKgI,aAEnDq7B,EAASA,EAAOzkC,QAAO,SAAE2pB,GAExB,IAAIqyB,EAAYryB,EAAMnqB,KAatB,MAPmB,SAAlB,EAAK4J,WACW,OAAb4yC,IAEHA,EAAY,SAIN,EAAK5yC,WAAa4yC,OAKrBvX,I,gCAYR,SAAoB6V,GAEnB,IAAInC,EAAa,KAGXxuB,EAAQvoB,KAAKy/C,iBAAkBvG,GAGrC,IAAK36C,qDAAWgqB,GAAS,CAExB,IAAKhqB,qDAAWL,iBAAiBwhD,MAAMrc,OAAQ9a,EAAMtnB,KACpD81C,EAAa74C,iBAAiBwhD,MAAMrc,OAAQ9a,EAAMtnB,QAE9C,EAGJ81C,EAAahlC,SAASg7B,cAAe,SAC1BsK,UAAU7sC,IAAK,aAG1BusC,EAAWjJ,YAAavlB,EAAMijB,MAAMvtB,KAAK,GAAG0hC,aAG5C,IAAMC,EAAa7tC,SAASg7B,cAAe,QAC3C6S,EAAWvI,UAAU7sC,IAAK,mBAC1Bo1C,EAAW5S,UAAYzkB,EAAMtmB,KAC7B80C,EAAWjJ,YAAa8R,GAGnBr3B,EAAM61B,YAEVlgD,iBAAiBwhD,MAAMrc,OAAQ9a,EAAMtnB,IAAO81C,GAK9CA,EAAaA,EAAW4I,WAAW,OAE/B,EAGJ5I,EAAahlC,SAASg7B,cAAe,SAC1BsK,UAAU7sC,IAAK,YAAa,sBAGvC,IAAMq1C,EAAa9tC,SAASg7B,cAAe,KAC3C8S,EAAWxI,UAAU7sC,IAAK,UAAW,wBACrCusC,EAAWjJ,YAAa+R,GAGxB,IAAMD,EAAa7tC,SAASg7B,cAAe,QAC3C6S,EAAWvI,UAAU7sC,IAAK,mBAC1Bo1C,EAAW5S,UAAYkM,EACvBnC,EAAWjJ,YAAa8R,GAGzB,OAAO7I,I,8BAYR,WAAgC,IAAdmC,EAAc,uDAAJ,GAGrB4G,EAAkB5G,EAGpB3wB,EAAQ,KAgCZ,GA7BK2wB,EAAQ/4B,WAAY,eAExB+4B,EAAU,iBAIJ95C,mDAAS85C,IAEfl5C,KAAKqjC,OAAO0c,MAAK,SAAEX,GAOlB,GALA72B,EAAQ62B,EAAY/b,OAAOj1B,QAAO,SAAE4xC,EAAcC,GACjD,OAAOA,EAAah/C,IAAMi4C,EAAU+G,EAAeD,IACjD,OAGEzhD,qDAAWgqB,GAQf,OANAA,EAAMijB,MAAQ,CACbvqC,GAAMm+C,EAAYn+C,GAClBgB,KAAMm9C,EAAYn9C,KAClBgc,KAAMmhC,EAAYnhC,OAGZ,MAML1f,qDAAWgqB,IAAW2wB,EAAQ/4B,WAAY,aAAe,CAEpDoI,EAAQpoB,sDAAU,EAAM,GAAIooB,GAGrC,IAAMloB,EAAOy/C,EAAgBtuC,QAAS,YAAa,IAG1C+W,EAAMtnB,GAAOsnB,EAAMtnB,GAAGuQ,QAAS,MAAOnR,GAGtCkoB,EAAMtmB,MAAOsG,oDAAUrK,iBAAiBc,KAAKqkC,OAAO4Y,OAAOC,oBAAqB,CAAE77C,IAG5F,OAAOkoB,I,kCAWR,SAAsB23B,GAA6B,WAAb35C,EAAa,uDAAH,GAE/CA,EAAU+Y,OAAOkmB,OAAO,CACvBr0B,SAAU,IACR5K,GAGH,IAAM45C,IAAgB/gD,mDAASmH,EAAQ4K,UAGjC1Q,EAAasR,SAASg7B,cAAe,QA6B3C,OA1BAmT,EAAiBA,EAAe1uC,QAC/BxR,KAAKy9C,aACL,SAAE2C,EAAW73B,GAEZ,IAGI83B,EAHW,EAAKrJ,mBAAoBzuB,GAGjBiB,UAYvB,OATK22B,IAEJE,GAAY93C,oDAAUhC,EAAQ4K,SAAU,CACvCkvC,EACA93B,KAKK83B,KAKT5/C,EAAWusC,UAAYkT,EAEhBz/C,M,ucCnuBT,SAAS6/C,EAAkB/Y,EAASgZ,GAChC,MAAMhT,EAAO,CACTxf,OAAQzO,OAAOkmB,OAAOlmB,OAAOkmB,OAAO,GAAI,YAAiB7vB,EAAU6qC,eACnEC,KAAM,WAuDV,SAASC,EAAevoC,GACpB,OAAOA,EAAGqW,KAAK+e,GAEnB,SAASoT,IACL,MAAM5yB,EAASwf,EAAKxf,QACO,IAAvBA,EAAO6yB,aAA+C,IAAtB7yB,EAAO8yB,aAGZ,IAAtB9yB,EAAOtY,YACZ0D,OAAO2nC,uBAAsB,WAKzB,QAJ+B14C,IAA3BmlC,EAAKwT,oBACLxT,EAAKwT,kBAAkBrT,MAAMsT,WAAa,SAC1CzT,EAAKwT,kBAAkBrT,MAAMuT,QAAU,cAEhB74C,IAAvBmlC,EAAK2T,cAA6B,CAClC,MAAMC,GAAa5T,EAAKvnB,KAAKo7B,YAAc,GAAKrzB,EAAO8yB,WACvDtT,EAAK2T,cAAcxT,MAAMC,MAAQwT,EAAY,KAC7C5T,EAAKwT,kBAAkBrT,MAAMC,MACzBwT,QAC0B/4C,IAArBmlC,EAAK8T,YACA9T,EAAK8T,YAAYD,YACjB,GACN,KACR7T,EAAKwT,kBAAkBrT,MAAM4T,eAAe,cAC5C/T,EAAKwT,kBAAkBrT,MAAM4T,eAAe,eAK5D,SAASC,EAAWt6C,GAChB,GAAkC,IAA9BsmC,EAAKt4B,cAAchG,OAAc,CACjC,MAAMuyC,OAAsCp5C,IAAxBmlC,EAAKxf,OAAOriB,UAC5B,IAAA+1C,cAAa,IAAIt9B,KAAQopB,EAAKxf,OAAOriB,UAAY,EAC/C,IAAIyY,KACJ,IAAIA,KAAKopB,EAAKxf,OAAOriB,QAAQg2C,WAC7BnpC,GAAW,IAAAopC,iBAAgBpU,EAAKxf,QACtCyzB,EAAYI,SAASrpC,EAASwN,MAAOxN,EAASuN,QAASvN,EAASsN,QAAS27B,EAAYK,mBACrFtU,EAAKt4B,cAAgB,CAACusC,GACtBjU,EAAKuU,sBAAwBN,OAEvBp5C,IAANnB,GAA8B,SAAXA,EAAE7I,MA+tD7B,SAAqB6I,GACjBA,EAAEsvB,iBACF,MAAMwrB,EAAuB,YAAX96C,EAAE7I,KAAoB4jD,GAAc,IAAAC,gBAAeh7C,GAAIytB,EAAQstB,OAC/D55C,IAAdmlC,EAAKl5B,MAAsB2tC,IAAgBzU,EAAKl5B,OAChDk5B,EAAKl5B,KAAK6tC,YACN3U,EAAKkT,KAAKpsC,MAAK,IAAAm9B,KAAIjE,EAAKl5B,KAAK6tC,cAAgB3U,EAAKkT,KAAKpsC,KAAK,MAEpE,MAAM8tC,EAAMC,WAAW1tB,EAAM2tB,aAAa,QAASC,EAAMF,WAAW1tB,EAAM2tB,aAAa,QAAS/nB,EAAO8nB,WAAW1tB,EAAM2tB,aAAa,SAAUE,EAAWjxC,SAASojB,EAAMjuB,MAAO,IAEhL,IAAIiyC,EAAW6J,EAAWjoB,GAFmKrzB,EAAEu7C,QAC1LT,EAAyB,KAAZ96C,EAAEw7C,MAAe,GAAK,EAAK,IAE7C,QAA2B,IAAhB/tB,EAAMjuB,OAAgD,IAAvBiuB,EAAMjuB,MAAMwI,OAAc,CAChE,MAAMyzC,EAAahuB,IAAU6Y,EAAKoV,YAAaC,EAAeluB,IAAU6Y,EAAKsV,cACzEnK,EAAWyJ,GACXzJ,EACI4J,EACI5J,GACA,IAAAlH,MAAKkR,KACJ,IAAAlR,KAAIkR,KAAe,IAAAlR,MAAKjE,EAAKl5B,OAClCuuC,GACAE,OAAkB16C,GAAY,EAAGmlC,EAAKoV,cAErCjK,EAAW4J,IAChB5J,EACIhkB,IAAU6Y,EAAKoV,YAAcjK,EAAW4J,GAAM,IAAA9Q,MAAKjE,EAAKl5B,MAAQ8tC,EAChES,GACAE,OAAkB16C,EAAW,EAAGmlC,EAAKoV,cAEzCpV,EAAKl5B,MACLquC,IACU,IAATpoB,EACKoe,EAAW6J,IAAa,GACxB3W,KAAKmX,IAAIrK,EAAW6J,GAAYjoB,KACtCiT,EAAKl5B,KAAK6tC,YACN3U,EAAKkT,KAAKpsC,MAAK,IAAAm9B,KAAIjE,EAAKl5B,KAAK6tC,cAAgB3U,EAAKkT,KAAKpsC,KAAK,MAEpEqgB,EAAMjuB,OAAQ,IAAAu8C,KAAItK,IAjwDlBuK,CAAYh8C,GAEhB,MAAMi8C,EAAY3V,EAAK4V,OAAO18C,MAC9B28C,IACAC,KACI9V,EAAK4V,OAAO18C,QAAUy8C,GACtB3V,EAAK+V,mBAeb,SAASF,IACL,QAAyBh7C,IAArBmlC,EAAKoV,kBAAoDv6C,IAAvBmlC,EAAKsV,cACvC,OACJ,IAAI98B,GAASzU,SAASi8B,EAAKoV,YAAYl8C,MAAMuS,OAAO,GAAI,KAAO,GAAK,GAAI8M,GAAWxU,SAASi8B,EAAKsV,cAAcp8C,MAAO,KAAO,GAAK,GAAIof,OAAiCzd,IAAvBmlC,EAAKgW,eAC9IjyC,SAASi8B,EAAKgW,cAAc98C,MAAO,KAAO,GAAK,GAChD,EAjBV,IAAuBoO,EAAMR,OAkBPjM,IAAdmlC,EAAKl5B,OAlBUQ,EAmBOkR,EAnBD1R,EAmBQk5B,EAAKl5B,KAAK6tC,YAAvCn8B,EAlBIlR,EAAO,GAAM,IAAK,IAAA28B,KAAIn9B,IAASk5B,EAAKkT,KAAKpsC,KAAK,KAoBtD,MAAMmvC,OAAwCp7C,IAAxBmlC,EAAKxf,OAAOhiB,SAC7BwhC,EAAKxf,OAAOriB,SACT6hC,EAAKkW,gBACLlW,EAAKuU,uBAED,KADJ,IAAAL,cAAalU,EAAKuU,sBAAuBvU,EAAKxf,OAAOriB,SAAS,GAQtE,QAN8CtD,IAAxBmlC,EAAKxf,OAAO/hB,SAC7BuhC,EAAKxf,OAAOpiB,SACT4hC,EAAKmW,gBACLnW,EAAKuU,uBAED,KADJ,IAAAL,cAAalU,EAAKuU,sBAAuBvU,EAAKxf,OAAOpiB,SAAS,GAEnD,CACf,MAAMK,OAAkC5D,IAAxBmlC,EAAKxf,OAAO/hB,QACtBuhC,EAAKxf,OAAO/hB,QACZuhC,EAAKxf,OAAOpiB,QAClBoa,EAAQ6lB,KAAKuW,IAAIp8B,EAAO/Z,EAAQ23C,YAC5B59B,IAAU/Z,EAAQ23C,aAClB79B,EAAU8lB,KAAKuW,IAAIr8B,EAAS9Z,EAAQ43C,eACpC99B,IAAY9Z,EAAQ43C,eACpB/9B,EAAU+lB,KAAKuW,IAAIt8B,EAAS7Z,EAAQ63C,eAE5C,GAAIL,EAAe,CACf,MAAMz3C,OAAkC3D,IAAxBmlC,EAAKxf,OAAOhiB,QACtBwhC,EAAKxf,OAAOhiB,QACZwhC,EAAKxf,OAAOriB,QAClBqa,EAAQ6lB,KAAK0W,IAAIv8B,EAAOha,EAAQ43C,YAC5B59B,IAAUha,EAAQ43C,YAAc79B,EAAU/Z,EAAQ63C,eAClD99B,EAAU/Z,EAAQ63C,cAClB99B,IAAY/Z,EAAQ63C,eACpB/9B,EAAU+lB,KAAK0W,IAAIz8B,EAAS9Z,EAAQ83C,eAE5CjC,EAAS77B,EAAOD,EAASD,GAE7B,SAASi+B,EAAiBC,GACtB,MAAMt4C,EAAOs4C,GAAWxW,EAAKuU,sBACzBr2C,GACAm2C,EAASn2C,EAAKk4C,WAAYl4C,EAAKm4C,aAAcn4C,EAAKo4C,cAG1D,SAASjC,EAAS77B,EAAOD,EAASD,QACKzd,IAA/BmlC,EAAKuU,uBACLvU,EAAKuU,sBAAsBF,SAAS77B,EAAQ,GAAID,EAASD,GAAW,EAAG,GAEtE0nB,EAAKoV,aAAgBpV,EAAKsV,gBAAiBtV,EAAKyW,WAErDzW,EAAKoV,YAAYl8C,OAAQ,IAAAu8C,KAAKzV,EAAKxf,OAAOk2B,UAEpCl+B,GADE,GAAKA,GAAS,GAAM,IAAK,IAAAyrB,KAAIzrB,EAAQ,IAAO,IAEpDwnB,EAAKsV,cAAcp8C,OAAQ,IAAAu8C,KAAIl9B,QACb1d,IAAdmlC,EAAKl5B,OACLk5B,EAAKl5B,KAAK6tC,YAAc3U,EAAKkT,KAAKpsC,MAAK,IAAAm9B,KAAIzrB,GAAS,WAC7B3d,IAAvBmlC,EAAKgW,gBACLhW,EAAKgW,cAAc98C,OAAQ,IAAAu8C,KAAIn9B,KAEvC,SAASq+B,EAAYp7C,GACjB,MAAMk5C,GAAc,IAAAC,gBAAen5C,GAC7B2L,EAAOnD,SAAS0wC,EAAYv7C,QAAUqC,EAAM05C,OAAS,IACvD/tC,EAAO,IAAO,GACC,UAAd3L,EAAMzI,MAAoB,QAAQypC,KAAKr1B,EAAKk2B,cAC7CwZ,EAAW1vC,GAGnB,SAAS+Z,EAAK+Y,EAASz+B,EAAOs7C,EAAS79C,GACnC,OAAIuC,aAAiBiQ,MACVjQ,EAAMyG,SAAS80C,GAAO71B,EAAK+Y,EAAS8c,EAAID,EAAS79C,KACxDghC,aAAmBxuB,MACZwuB,EAAQh4B,SAAS+0C,GAAO91B,EAAK81B,EAAIx7C,EAAOs7C,EAAS79C,MAC5DghC,EAAQ6P,iBAAiBtuC,EAAOs7C,EAAS79C,QACzCgnC,EAAKgX,UAAUj1C,KAAK,CAChBmI,OAAQ,IAAM8vB,EAAQiQ,oBAAoB1uC,EAAOs7C,MAGzD,SAASn0C,IACLu0C,EAAa,YAyDjB,SAASC,EAAWC,EAAUz0C,GAC1B,MAAM00C,OAAsBv8C,IAAbs8C,EACTnX,EAAKqX,UAAUF,GACfnX,EAAKuU,wBACFvU,EAAKxf,OAAOriB,SAAW6hC,EAAKxf,OAAOriB,QAAU6hC,EAAKF,IAC7CE,EAAKxf,OAAOriB,QACZ6hC,EAAKxf,OAAOpiB,SAAW4hC,EAAKxf,OAAOpiB,QAAU4hC,EAAKF,IAC9CE,EAAKxf,OAAOpiB,QACZ4hC,EAAKF,KACjBwX,EAAUtX,EAAKuX,YACfC,EAAWxX,EAAKyX,aACtB,SACmB58C,IAAXu8C,IACApX,EAAKuX,YAAcH,EAAOM,cAC1B1X,EAAKyX,aAAeL,EAAOO,YAGnC,MAAOj+C,GACHA,EAAE8S,QAAU,0BAA4B4qC,EACxCpX,EAAKxf,OAAOo3B,aAAal+C,GAEzBgJ,GAAiBs9B,EAAKuX,cAAgBD,IACtCL,EAAa,gBACbY,MAEAn1C,GACCs9B,EAAKuX,cAAgBD,GAAWtX,EAAKyX,eAAiBD,GACvDP,EAAa,iBAEjBjX,EAAK8X,SAET,SAASC,EAAcr+C,GACnB,MAAM+6C,GAAc,IAAAC,gBAAeh7C,IAC9B+6C,EAAYuD,UAAUC,QAAQ,UAC/B1C,EAAkB77C,EAAG+6C,EAAY3K,UAAUC,SAAS,WAAa,GAAK,GAE9E,SAASwL,EAAkB77C,EAAGu7C,EAAOiD,GACjC,MAAM79B,EAAS3gB,IAAK,IAAAg7C,gBAAeh7C,GAC7BytB,EAAQ+wB,GACT79B,GAAUA,EAAO7Q,YAAc6Q,EAAO7Q,WAAW2uC,WAChD58C,EAAQ68C,GAAY,aAC1B78C,EAAM05C,MAAQA,EACd9tB,GAASA,EAAMkxB,cAAc98C,GA0DjC,SAAS+8C,EAAUN,EAAW95C,EAAMq6C,EAAWzZ,GAC3C,MAAM0Z,EAAgBC,EAAUv6C,GAAM,GAAOw6C,GAAa,IAAAlZ,eAAc,OAAQ,iBAAmBwY,EAAW95C,EAAKy6C,UAAUvb,YAuC7H,OAtCAsb,EAAWlC,QAAUt4C,EACrBw6C,EAAWE,GAAK9Z,EAChB4Z,EAAWG,aAAa,aAAc7Y,EAAK8Y,WAAW56C,EAAM8hC,EAAKxf,OAAOu4B,kBACnC,IAAjCf,EAAUC,QAAQ,WACe,KAAjC,IAAA/D,cAAah2C,EAAM8hC,EAAKF,OACxBE,EAAKgZ,cAAgBN,EACrBA,EAAW5O,UAAU7sC,IAAI,SACzBy7C,EAAWG,aAAa,eAAgB,SAExCL,GACAE,EAAWO,UAAY,EACnBC,GAAeh7C,KACfw6C,EAAW5O,UAAU7sC,IAAI,YACzB+iC,EAAKmZ,iBAAmBT,EACC,UAArB1Y,EAAKxf,OAAOxY,QACZ,IAAAuqB,aAAYmmB,EAAY,aAAc1Y,EAAKt4B,cAAc,IACD,KAApD,IAAAwsC,cAAah2C,EAAM8hC,EAAKt4B,cAAc,IAAI,KAC9C,IAAA6qB,aAAYmmB,EAAY,WAAY1Y,EAAKt4B,cAAc,IACC,KAApD,IAAAwsC,cAAah2C,EAAM8hC,EAAKt4B,cAAc,IAAI,IAC5B,iBAAdswC,GACAU,EAAW5O,UAAU7sC,IAAI,cAKrCy7C,EAAW5O,UAAU7sC,IAAI,sBAEJ,UAArB+iC,EAAKxf,OAAOxY,MAk3CpB,SAAuB9J,GACnB,QAAyB,UAArB8hC,EAAKxf,OAAOxY,MAAoBg4B,EAAKt4B,cAAchG,OAAS,KAExD,IAAAwyC,cAAah2C,EAAM8hC,EAAKt4B,cAAc,KAAO,IACjD,IAAAwsC,cAAah2C,EAAM8hC,EAAKt4B,cAAc,KAAO,EAr3CzC0xC,CAAcl7C,KAAUg7C,GAAeh7C,IACvCw6C,EAAW5O,UAAU7sC,IAAI,WAE7B+iC,EAAKqT,aACsB,IAA3BrT,EAAKxf,OAAO8yB,YACE,iBAAd0E,GACAO,EAAY,GAAM,GAClBvY,EAAKqT,YAAYgG,mBAAmB,YAAa,+BAAiCrZ,EAAKxf,OAAO84B,QAAQp7C,GAAQ,WAElH+4C,EAAa,cAAeyB,GACrBA,EAEX,SAASa,EAAeC,GACpBA,EAAWnwC,QACc,UAArB22B,EAAKxf,OAAOxY,MACZyxC,EAAYD,GAEpB,SAASE,EAAqBzE,GAC1B,MAAM0E,EAAa1E,EAAQ,EAAI,EAAIjV,EAAKxf,OAAO8yB,WAAa,EACtDsG,EAAW3E,EAAQ,EAAIjV,EAAKxf,OAAO8yB,YAAc,EACvD,IAAK,IAAIuG,EAAIF,EAAYE,GAAKD,EAAUC,GAAK5E,EAAO,CAChD,MAAM7tC,EAAQ44B,EAAK2T,cAAcvE,SAASyK,GACpCC,EAAa7E,EAAQ,EAAI,EAAI7tC,EAAMgoC,SAAS1tC,OAAS,EACrDq4C,EAAW9E,EAAQ,EAAI7tC,EAAMgoC,SAAS1tC,QAAU,EACtD,IAAK,IAAIo9B,EAAIgb,EAAYhb,GAAKib,EAAUjb,GAAKmW,EAAO,CAChD,MAAM+E,EAAI5yC,EAAMgoC,SAAStQ,GACzB,IAAuC,IAAnCkb,EAAEhC,UAAUC,QAAQ,WAAoBQ,EAAUuB,EAAExD,SACpD,OAAOwD,IA+BvB,SAASC,EAAWC,EAAS3K,GACzB,MAAM4K,EAAaC,EAAS51C,SAAS61C,eAAiB71C,SAAS87B,MACzDga,OAAwBz/C,IAAZq/C,EACZA,EACAC,EACI31C,SAAS61C,mBACiBx/C,IAA1BmlC,EAAKmZ,kBAAkCiB,EAASpa,EAAKmZ,kBACjDnZ,EAAKmZ,sBACkBt+C,IAAvBmlC,EAAKgZ,eAA+BoB,EAASpa,EAAKgZ,eAC9ChZ,EAAKgZ,cACLU,EAAqBnK,EAAS,EAAI,GAAK,QACvC10C,IAAdy/C,EACAta,EAAK4V,OAAOvsC,QAEN8wC,EAxCd,SAA6BD,EAASjF,GAClC,MAAMsF,GAAqD,IAAxCL,EAAQlC,UAAUC,QAAQ,SACvCiC,EAAQ1D,QAAQmB,WAChB3X,EAAKyX,aACLmC,EAAW3E,EAAQ,EAAIjV,EAAKxf,OAAO8yB,YAAc,EACjDkH,EAAYvF,EAAQ,EAAI,GAAK,EACnC,IAAK,IAAI4E,EAAIU,EAAava,EAAKyX,aAAcoC,GAAKD,EAAUC,GAAKW,EAAW,CACxE,MAAMpzC,EAAQ44B,EAAK2T,cAAcvE,SAASyK,GACpCC,EAAaS,EAAava,EAAKyX,eAAiBoC,EAChDK,EAAQtB,GAAK3D,EACbA,EAAQ,EACJ7tC,EAAMgoC,SAAS1tC,OAAS,EACxB,EACJ+4C,EAAerzC,EAAMgoC,SAAS1tC,OACpC,IAAK,IAAIo9B,EAAIgb,EAAYhb,GAAK,GAAKA,EAAI2b,GAAgB3b,IAAMmW,EAAQ,EAAIwF,GAAgB,GAAI3b,GAAK0b,EAAW,CACzG,MAAMR,EAAI5yC,EAAMgoC,SAAStQ,GACzB,IAAuC,IAAnCkb,EAAEhC,UAAUC,QAAQ,WACpBQ,EAAUuB,EAAExD,UACZnY,KAAKmX,IAAI0E,EAAQtB,GAAK9Z,IAAMT,KAAKmX,IAAIP,GACrC,OAAOsE,EAAeS,IAGlCha,EAAK0a,YAAYF,GACjBP,EAAWP,EAAqBc,GAAY,GAqBxCG,CAAoBL,EAAW/K,GAH/BgK,EAAee,GAMvB,SAASM,EAAe1zC,EAAME,GAC1B,MAAMyzC,GAAgB,IAAIjkC,KAAK1P,EAAME,EAAO,GAAG0zC,SAAW9a,EAAKkT,KAAK1sC,eAAiB,GAAK,EACpFu0C,EAAgB/a,EAAKgb,MAAMC,gBAAgB7zC,EAAQ,EAAI,IAAM,GAAIF,GACjEg0C,EAAclb,EAAKgb,MAAMC,eAAe7zC,EAAOF,GAAOuR,EAAO7M,OAAOpH,SAAS22C,yBAA0BC,EAAepb,EAAKxf,OAAO8yB,WAAa,EAAG+H,EAAoBD,EAAe,sBAAwB,eAAgBE,EAAoBF,EAAe,sBAAwB,eAC9R,IAAI7C,EAAYwC,EAAgB,EAAIF,EAAcU,EAAW,EAC7D,KAAOhD,GAAawC,EAAexC,IAAagD,IAC5C9iC,EAAK8nB,YAAY+X,EAAU+C,EAAmB,IAAIzkC,KAAK1P,EAAME,EAAQ,EAAGmxC,GAAYA,EAAWgD,IAEnG,IAAKhD,EAAY,EAAGA,GAAa2C,EAAa3C,IAAagD,IACvD9iC,EAAK8nB,YAAY+X,EAAU,GAAI,IAAI1hC,KAAK1P,EAAME,EAAOmxC,GAAYA,EAAWgD,IAEhF,IAAK,IAAIC,EAASN,EAAc,EAAGM,GAAU,GAAKX,IAClB,IAA3B7a,EAAKxf,OAAO8yB,YAAoBiI,EAAW,GAAM,GAAIC,IAAUD,IAChE9iC,EAAK8nB,YAAY+X,EAAUgD,EAAmB,IAAI1kC,KAAK1P,EAAME,EAAQ,EAAGo0C,EAASN,GAAcM,EAAQD,IAE3G,MAAME,GAAe,IAAAjc,eAAc,MAAO,gBAE1C,OADAic,EAAalb,YAAY9nB,GAClBgjC,EAEX,SAASC,IACL,QAA2B7gD,IAAvBmlC,EAAK2T,cACL,QAEJ,IAAAgI,WAAU3b,EAAK2T,eACX3T,EAAKqT,cACL,IAAAsI,WAAU3b,EAAKqT,aACnB,MAAMuI,EAAOp3C,SAAS22C,yBACtB,IAAK,IAAIrc,EAAI,EAAGA,EAAIkB,EAAKxf,OAAO8yB,WAAYxU,IAAK,CAC7C,MAAM+c,EAAI,IAAIjlC,KAAKopB,EAAKuX,YAAavX,EAAKyX,aAAc,GACxDoE,EAAEC,SAAS9b,EAAKyX,aAAe3Y,GAC/B8c,EAAKrb,YAAYqa,EAAeiB,EAAEnE,cAAemE,EAAElE,aAEvD3X,EAAK2T,cAAcpT,YAAYqb,GAC/B5b,EAAKvnB,KAAOunB,EAAK2T,cAAcwE,WACN,UAArBnY,EAAKxf,OAAOxY,MAAkD,IAA9Bg4B,EAAKt4B,cAAchG,QACnD+3C,IAGR,SAAS5B,IACL,GAAI7X,EAAKxf,OAAO8yB,WAAa,GACS,aAAlCtT,EAAKxf,OAAOu7B,kBACZ,OACJ,MAAMC,EAAmB,SAAU50C,GAC/B,aAA4BvM,IAAxBmlC,EAAKxf,OAAOriB,SACZ6hC,EAAKuX,cAAgBvX,EAAKxf,OAAOriB,QAAQu5C,eACzCtwC,EAAQ44B,EAAKxf,OAAOriB,QAAQw5C,iBAGC98C,IAAxBmlC,EAAKxf,OAAOpiB,SACjB4hC,EAAKuX,cAAgBvX,EAAKxf,OAAOpiB,QAAQs5C,eACzCtwC,EAAQ44B,EAAKxf,OAAOpiB,QAAQu5C,aAEpC3X,EAAKic,wBAAwBhD,UAAY,EACzCjZ,EAAKic,wBAAwBxc,UAAY,GACzC,IAAK,IAAIX,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,IAAKkd,EAAiBld,GAClB,SACJ,MAAM13B,GAAQ,IAAAo4B,eAAc,SAAU,iCACtCp4B,EAAMlO,MAAQ,IAAI0d,KAAKopB,EAAKuX,YAAazY,GAAG6Y,WAAWva,WACvDh2B,EAAMutC,aAAc,IAAAuH,YAAWpd,EAAGkB,EAAKxf,OAAO27B,sBAAuBnc,EAAKkT,MAC1E9rC,EAAM6xC,UAAY,EACdjZ,EAAKyX,eAAiB3Y,IACtB13B,EAAMg1C,UAAW,GAErBpc,EAAKic,wBAAwB1b,YAAYn5B,IAGjD,SAASi1C,IACL,MAAM33C,GAAY,IAAA86B,eAAc,MAAO,mBACjC8c,EAAmB1wC,OAAOpH,SAAS22C,yBACzC,IAAIoB,EACAvc,EAAKxf,OAAO8yB,WAAa,GACS,WAAlCtT,EAAKxf,OAAOu7B,kBACZQ,GAAe,IAAA/c,eAAc,OAAQ,cAGrCQ,EAAKic,yBAA0B,IAAAzc,eAAc,SAAU,kCACvDQ,EAAKic,wBAAwBpD,aAAa,aAAc7Y,EAAKkT,KAAK/rC,gBAClE8Z,EAAK+e,EAAKic,wBAAyB,UAAWviD,IAC1C,MAAM2gB,GAAS,IAAAq6B,gBAAeh7C,GACxB8iD,EAAgBz4C,SAASsW,EAAOnhB,MAAO,IAC7C8mC,EAAK0a,YAAY8B,EAAgBxc,EAAKyX,cACtCR,EAAa,oBAEjBY,IACA0E,EAAevc,EAAKic,yBAExB,MAAMQ,GAAY,IAAAC,mBAAkB,WAAY,CAAEC,SAAU,OACtDC,EAAcH,EAAUI,qBAAqB,SAAS,GAC5DD,EAAY/D,aAAa,aAAc7Y,EAAKkT,KAAKjsC,eAC7C+4B,EAAKxf,OAAOriB,SACZy+C,EAAY/D,aAAa,MAAO7Y,EAAKxf,OAAOriB,QAAQu5C,cAActa,YAElE4C,EAAKxf,OAAOpiB,UACZw+C,EAAY/D,aAAa,MAAO7Y,EAAKxf,OAAOpiB,QAAQs5C,cAActa,YAClEwf,EAAYE,WACN9c,EAAKxf,OAAOriB,SACV6hC,EAAKxf,OAAOriB,QAAQu5C,gBAAkB1X,EAAKxf,OAAOpiB,QAAQs5C,eAEtE,MAAMD,GAAe,IAAAjY,eAAc,MAAO,2BAK1C,OAJAiY,EAAalX,YAAYgc,GACzB9E,EAAalX,YAAYkc,GACzBH,EAAiB/b,YAAYkX,GAC7B/yC,EAAU67B,YAAY+b,GACf,CACH53C,YACAk4C,cACAL,gBAGR,SAASQ,KACL,IAAApB,WAAU3b,EAAKgd,UACfhd,EAAKgd,SAASzc,YAAYP,EAAKid,cAC3Bjd,EAAKxf,OAAO8yB,aACZtT,EAAKkd,aAAe,GACpBld,EAAKmd,cAAgB,IAEzB,IAAK,IAAItD,EAAI7Z,EAAKxf,OAAO8yB,WAAYuG,KAAM,CACvC,MAAMzyC,EAAQi1C,IACdrc,EAAKkd,aAAan7C,KAAKqF,EAAMw1C,aAC7B5c,EAAKmd,cAAcp7C,KAAKqF,EAAMm1C,cAC9Bvc,EAAKgd,SAASzc,YAAYn5B,EAAM1C,WAEpCs7B,EAAKgd,SAASzc,YAAYP,EAAKod,cA+FnC,SAASC,IACArd,EAAKsd,kBAGN,IAAA3B,WAAU3b,EAAKsd,kBAFftd,EAAKsd,kBAAmB,IAAA9d,eAAc,MAAO,sBAGjD,IAAK,IAAIV,EAAIkB,EAAKxf,OAAO8yB,WAAYxU,KAAM,CACvC,MAAMp6B,GAAY,IAAA86B,eAAc,MAAO,8BACvCQ,EAAKsd,iBAAiB/c,YAAY77B,GAGtC,OADA64C,IACOvd,EAAKsd,iBAEhB,SAASC,IACL,IAAKvd,EAAKsd,iBACN,OAEJ,MAAM92C,EAAiBw5B,EAAKkT,KAAK1sC,eACjC,IAAIxB,EAAW,IAAIg7B,EAAKkT,KAAKluC,SAASC,WAClCuB,EAAiB,GAAKA,EAAiBxB,EAAStD,SAChDsD,EAAW,IACJA,EAAS4K,OAAOpJ,EAAgBxB,EAAStD,WACzCsD,EAAS4K,OAAO,EAAGpJ,KAG9B,IAAK,IAAIs4B,EAAIkB,EAAKxf,OAAO8yB,WAAYxU,KACjCkB,EAAKsd,iBAAiBlO,SAAStQ,GAAGW,UAAY,qDAEhDz6B,EAASrH,KAAK,oEAgBpB,SAAS+8C,EAAYxhD,EAAOskD,GAAW,GACnC,MAAMvI,EAAQuI,EAAWtkD,EAAQA,EAAQ8mC,EAAKyX,aACzCxC,EAAQ,IAAkC,IAA7BjV,EAAKyd,qBAClBxI,EAAQ,IAAkC,IAA7BjV,EAAK0d,sBAEvB1d,EAAKyX,cAAgBxC,GACjBjV,EAAKyX,aAAe,GAAKzX,EAAKyX,aAAe,MAC7CzX,EAAKuX,aAAevX,EAAKyX,aAAe,GAAK,GAAK,EAClDzX,EAAKyX,cAAgBzX,EAAKyX,aAAe,IAAM,GAC/CR,EAAa,gBACbY,KAEJ6D,IACAzE,EAAa,iBACb0G,MA2GJ,SAASC,EAAeC,GACpB,SAAI7d,EAAKxf,OAAOhnB,WAAYwmC,EAAKxf,OAAOhnB,SAASuwC,SAAS8T,KAEnD7d,EAAKwT,kBAAkBzJ,SAAS8T,GAE3C,SAASC,EAAcpkD,GACnB,GAAIsmC,EAAKuM,SAAWvM,EAAKxf,OAAOu9B,OAAQ,CACpC,MAAMtJ,GAAc,IAAAC,gBAAeh7C,GAC7BskD,EAAoBJ,EAAenJ,GACnCwJ,EAAUxJ,IAAgBzU,EAAK7Y,OACjCstB,IAAgBzU,EAAKn7B,UACrBm7B,EAAKhG,QAAQ+P,SAAS0K,IACrB/6C,EAAEwkD,MACCxkD,EAAEwkD,KAAKjG,WACLv+C,EAAEwkD,KAAKjG,QAAQjY,EAAK7Y,SACjBztB,EAAEwkD,KAAKjG,QAAQjY,EAAKn7B,WAC3Bs5C,EAAuB,SAAXzkD,EAAE7I,KACdotD,GACEvkD,EAAE0kD,gBACDR,EAAelkD,EAAE0kD,gBACnBH,IACED,IACAJ,EAAelkD,EAAE0kD,eACpBC,GAAare,EAAKxf,OAAO89B,qBAAqB9L,MAAMqL,GAASA,EAAK9T,SAAS0K,KAC7E0J,GAAaE,SACcxjD,IAAvBmlC,EAAKue,oBACkB1jD,IAAvBmlC,EAAKsV,oBACgBz6C,IAArBmlC,EAAKoV,aACgB,KAArBpV,EAAK7Y,MAAMjuB,YACU2B,IAArBmlC,EAAK7Y,MAAMjuB,OACX86C,IAEJhU,EAAKkO,QACDlO,EAAKxf,QACgB,UAArBwf,EAAKxf,OAAOxY,MACkB,IAA9Bg4B,EAAKt4B,cAAchG,SACnBs+B,EAAKlkC,OAAM,GACXkkC,EAAK8X,YAKrB,SAASlB,EAAW4H,GAChB,IAAKA,GACAxe,EAAKxf,OAAOriB,SAAWqgD,EAAUxe,EAAKxf,OAAOriB,QAAQu5C,eACrD1X,EAAKxf,OAAOpiB,SAAWogD,EAAUxe,EAAKxf,OAAOpiB,QAAQs5C,cACtD,OACJ,MAAM+G,EAAaD,EAASE,EAAY1e,EAAKuX,cAAgBkH,EAC7Dze,EAAKuX,YAAckH,GAAcze,EAAKuX,YAClCvX,EAAKxf,OAAOpiB,SACZ4hC,EAAKuX,cAAgBvX,EAAKxf,OAAOpiB,QAAQs5C,cACzC1X,EAAKyX,aAAepZ,KAAKuW,IAAI5U,EAAKxf,OAAOpiB,QAAQu5C,WAAY3X,EAAKyX,cAE7DzX,EAAKxf,OAAOriB,SACjB6hC,EAAKuX,cAAgBvX,EAAKxf,OAAOriB,QAAQu5C,gBACzC1X,EAAKyX,aAAepZ,KAAK0W,IAAI/U,EAAKxf,OAAOriB,QAAQw5C,WAAY3X,EAAKyX,eAElEiH,IACA1e,EAAK8X,SACLb,EAAa,gBACbY,KAGR,SAASY,EAAUv6C,EAAMygD,GAAW,GAChC,IAAIC,EACJ,MAAMC,EAAc7e,EAAKqX,UAAUn5C,OAAMrD,EAAW8jD,GACpD,GAAK3e,EAAKxf,OAAOriB,SACb0gD,IACA,IAAA3K,cAAa2K,EAAa7e,EAAKxf,OAAOriB,aAAsBtD,IAAb8jD,EAAyBA,GAAY3e,EAAKkW,gBAAkB,GAC1GlW,EAAKxf,OAAOpiB,SACTygD,IACA,IAAA3K,cAAa2K,EAAa7e,EAAKxf,OAAOpiB,aAAsBvD,IAAb8jD,EAAyBA,GAAY3e,EAAKmW,gBAAkB,EAC/G,OAAO,EACX,IAAKnW,EAAKxf,OAAOwL,QAAyC,IAA/BgU,EAAKxf,OAAOs+B,QAAQp9C,OAC3C,OAAO,EACX,QAAoB7G,IAAhBgkD,EACA,OAAO,EACX,MAAME,IAAS/e,EAAKxf,OAAOwL,OAAQgzB,EAAsC,QAA7BJ,EAAK5e,EAAKxf,OAAOwL,cAA2B,IAAP4yB,EAAgBA,EAAK5e,EAAKxf,OAAOs+B,QAClH,IAAK,IAAWjD,EAAP/c,EAAI,EAAMA,EAAIkgB,EAAMt9C,OAAQo9B,IAAK,CAEtC,GADA+c,EAAImD,EAAMlgB,GACO,mBAAN+c,GACPA,EAAEgD,GACF,OAAOE,EACN,GAAIlD,aAAajlC,WACF/b,IAAhBgkD,GACAhD,EAAE1H,YAAc0K,EAAY1K,UAC5B,OAAO4K,EACN,GAAiB,iBAANlD,EAAgB,CAC5B,MAAMoD,EAASjf,EAAKqX,UAAUwE,OAAGhhD,GAAW,GAC5C,OAAOokD,GAAUA,EAAO9K,YAAc0K,EAAY1K,UAC5C4K,GACCA,EAEN,GAAiB,iBAANlD,QACIhhD,IAAhBgkD,GACAhD,EAAEzS,MACFyS,EAAExS,IACFwV,EAAY1K,WAAa0H,EAAEzS,KAAK+K,WAChC0K,EAAY1K,WAAa0H,EAAExS,GAAG8K,UAC9B,OAAO4K,EAEf,OAAQA,EAEZ,SAAS3E,EAASyD,GACd,YAA2BhjD,IAAvBmlC,EAAK2T,gBACyC,IAAtCkK,EAAK7F,UAAUC,QAAQ,YACuB,IAAlD4F,EAAK7F,UAAUC,QAAQ,uBACvBjY,EAAK2T,cAAc5J,SAAS8T,GAGxC,SAASqB,EAAOxlD,GACIA,EAAE2gB,SAAW2lB,EAAK4V,UAE7B5V,EAAKt4B,cAAchG,OAAS,GAAKs+B,EAAK4V,OAAO18C,MAAMwI,OAAS,IAC3DhI,EAAE0kD,eAAiBR,EAAelkD,EAAE0kD,gBACtCpe,EAAKmf,QAAQnf,EAAK4V,OAAO18C,OAAO,EAAMQ,EAAE2gB,SAAW2lB,EAAKn7B,SAClDm7B,EAAKxf,OAAOzY,UACZi4B,EAAKxf,OAAOziB,YAG1B,SAASqhD,EAAU1lD,GACf,MAAM+6C,GAAc,IAAAC,gBAAeh7C,GAC7BukD,EAAUje,EAAKxf,OAAO6+B,KACtBrlB,EAAQ+P,SAAS0K,GACjBA,IAAgBzU,EAAK4V,OACrBjxC,EAAaq7B,EAAKxf,OAAO7b,WACzB26C,EAAetf,EAAKuM,UAAY5nC,IAAes5C,GAC/CsB,EAAqBvf,EAAKxf,OAAOu9B,QAAUE,IAAYt5C,EAC7D,GAAkB,KAAdjL,EAAEwjB,SAAkB+gC,EAAS,CAC7B,GAAIt5C,EAIA,OAHAq7B,EAAKmf,QAAQnf,EAAK4V,OAAO18C,OAAO,EAAMu7C,IAAgBzU,EAAKn7B,SACrDm7B,EAAKxf,OAAOzY,UACZi4B,EAAKxf,OAAOziB,YACX02C,EAAY+K,OAGnBxf,EAAK52B,YAGR,GAAIw0C,EAAenJ,IACpB6K,GACAC,EAAoB,CACpB,MAAME,IAAczf,EAAKue,eACrBve,EAAKue,cAAcxU,SAAS0K,GAChC,OAAQ/6C,EAAEwjB,SACN,KAAK,GACGuiC,GACA/lD,EAAEsvB,iBACFgrB,IACA0L,KAGAC,EAAWjmD,GACf,MACJ,KAAK,GACDA,EAAEsvB,iBACF02B,IACA,MACJ,KAAK,EACL,KAAK,GACGzB,IAAYje,EAAKxf,OAAO7b,aACxBjL,EAAEsvB,iBACFgX,EAAKlkC,SAET,MACJ,KAAK,GACL,KAAK,GACD,GAAK2jD,GAAcxB,EAeVje,EAAKoV,aACVpV,EAAKoV,YAAY/rC,aAdjB,GADA3P,EAAEsvB,sBACyBnuB,IAAvBmlC,EAAK2T,iBACW,IAAfhvC,GACIH,SAAS61C,eAAiBD,EAAS51C,SAAS61C,gBAAkB,CACnE,MAAMpF,EAAsB,KAAdv7C,EAAEwjB,QAAiB,GAAK,EACjCxjB,EAAEkmD,SAGHlmD,EAAEmmD,kBACFnF,EAAYzF,GACZgF,EAAWP,EAAqB,GAAI,IAJpCO,OAAWp/C,EAAWo6C,GAUlC,MACJ,KAAK,GACL,KAAK,GACDv7C,EAAEsvB,iBACF,MAAMisB,EAAsB,KAAdv7C,EAAEwjB,QAAiB,GAAK,EACjC8iB,EAAK2T,oBACa94C,IAAnB45C,EAAYmE,IACZnE,IAAgBzU,EAAK7Y,OACrBstB,IAAgBzU,EAAKn7B,SACjBnL,EAAEkmD,SACFlmD,EAAEmmD,kBACFjJ,EAAW5W,EAAKuX,YAActC,GAC9BgF,EAAWP,EAAqB,GAAI,IAE9B+F,GACNxF,OAAWp/C,EAAmB,EAARo6C,GAErBR,IAAgBzU,EAAK8f,mBAC1BlJ,EAAW5W,EAAKuX,YAActC,GAEzBjV,EAAKxf,OAAOvY,cACZw3C,GAAazf,EAAKoV,aACnBpV,EAAKoV,YAAY/rC,QACrB2qC,EAAWt6C,GACXsmC,EAAK+V,oBAET,MACJ,KAAK,EACD,GAAI0J,EAAW,CACX,MAAMM,EAAQ,CACV/f,EAAKoV,YACLpV,EAAKsV,cACLtV,EAAKgW,cACLhW,EAAKl5B,MAEJqsB,OAAO6M,EAAKggB,gBACZ3uD,QAAQ0tC,GAAMA,IACbD,EAAIihB,EAAM9H,QAAQxD,GACxB,IAAW,IAAP3V,EAAU,CACV,MAAMzkB,EAAS0lC,EAAMjhB,GAAKplC,EAAEumD,UAAY,EAAI,IAC5CvmD,EAAEsvB,kBACD3O,GAAU2lB,EAAK4V,QAAQvsC,cAGtB22B,EAAKxf,OAAOtY,YAClB83B,EAAK2T,eACL3T,EAAK2T,cAAc5J,SAAS0K,IAC5B/6C,EAAEumD,WACFvmD,EAAEsvB,iBACFgX,EAAK4V,OAAOvsC,UAO5B,QAAkBxO,IAAdmlC,EAAKl5B,MAAsB2tC,IAAgBzU,EAAKl5B,KAChD,OAAQpN,EAAE5G,KACN,KAAKktC,EAAKkT,KAAKpsC,KAAK,GAAGo5C,OAAO,GAC9B,KAAKlgB,EAAKkT,KAAKpsC,KAAK,GAAGo5C,OAAO,GAAGjmC,cAC7B+lB,EAAKl5B,KAAK6tC,YAAc3U,EAAKkT,KAAKpsC,KAAK,GACvC+uC,IACAC,KACA,MACJ,KAAK9V,EAAKkT,KAAKpsC,KAAK,GAAGo5C,OAAO,GAC9B,KAAKlgB,EAAKkT,KAAKpsC,KAAK,GAAGo5C,OAAO,GAAGjmC,cAC7B+lB,EAAKl5B,KAAK6tC,YAAc3U,EAAKkT,KAAKpsC,KAAK,GACvC+uC,IACAC,MAIRmI,GAAWL,EAAenJ,KAC1BwC,EAAa,YAAav9C,GAGlC,SAAS+/C,EAAYoE,GACjB,GAAkC,IAA9B7d,EAAKt4B,cAAchG,QAClBm8C,KACKA,EAAK/T,UAAUC,SAAS,kBACtB8T,EAAK/T,UAAUC,SAAS,uBAChC,OACJ,MAAMoW,EAAYtC,EACZA,EAAKrH,QAAQrC,UACbnU,EAAKvnB,KAAK2nC,kBAAkB5J,QAAQrC,UAAWkM,EAAcrgB,EAAKqX,UAAUrX,EAAKt4B,cAAc,QAAI7M,GAAW,GAAMs5C,UAAWmM,EAAiBjiB,KAAKuW,IAAIuL,EAAWngB,EAAKt4B,cAAc,GAAGysC,WAAYoM,EAAeliB,KAAK0W,IAAIoL,EAAWngB,EAAKt4B,cAAc,GAAGysC,WACrQ,IAAIqM,GAAmB,EACnBC,EAAW,EAAGC,EAAW,EAC7B,IAAK,IAAIC,EAAIL,EAAgBK,EAAIJ,EAAcI,GAAK,EAAAC,SAAA,IAC3CnI,EAAU,IAAI7hC,KAAK+pC,IAAI,KACxBH,EACIA,GAAqBG,EAAIL,GAAkBK,EAAIJ,EAC/CI,EAAIN,KAAiBI,GAAYE,EAAIF,GACrCA,EAAWE,EACNA,EAAIN,KAAiBK,GAAYC,EAAID,KAC1CA,EAAWC,IAGvB,IAAK,IAAI9G,EAAI,EAAGA,EAAI7Z,EAAKxf,OAAO8yB,WAAYuG,IAAK,CAC7C,MAAMzyC,EAAQ44B,EAAK2T,cAAcvE,SAASyK,GAC1C,IAAK,IAAI/a,EAAI,EAAG+hB,EAAIz5C,EAAMgoC,SAAS1tC,OAAQo9B,EAAI+hB,EAAG/hB,IAAK,CACnD,MAAMgiB,EAAU15C,EAAMgoC,SAAStQ,GACzBiiB,EADoCD,EAAQtK,QAC3BrC,UACjB6M,EAAcP,EAAW,GAAKM,EAAYN,GAC3CC,EAAW,GAAKK,EAAYL,EAC7BM,GACAF,EAAQhX,UAAU7sC,IAAI,cACtB,CAAC,UAAW,aAAc,YAAY+E,SAASg4C,IAC3C8G,EAAQhX,UAAU5/B,OAAO8vC,OAIxBwG,IAAqBQ,IAE9B,CAAC,aAAc,UAAW,WAAY,cAAch/C,SAASg4C,IACzD8G,EAAQhX,UAAU5/B,OAAO8vC,WAEhBn/C,IAATgjD,IACAA,EAAK/T,UAAU7sC,IAAIkjD,GAAangB,EAAKt4B,cAAc,GAAGysC,UAChD,aACA,YACFkM,EAAcF,GAAaY,IAAcV,EACzCS,EAAQhX,UAAU7sC,IAAI,cACjBojD,EAAcF,GAAaY,IAAcV,GAC9CS,EAAQhX,UAAU7sC,IAAI,YACtB8jD,GAAaN,IACC,IAAbC,GAAkBK,GAAaL,KAChC,IAAAO,WAAUF,EAAWV,EAAaF,IAClCW,EAAQhX,UAAU7sC,IAAI,eAK1C,SAASikD,KACDlhB,EAAKuM,QAAWvM,EAAKxf,OAAO2gC,QAAWnhB,EAAKxf,OAAOu9B,QACnDqD,IAqCR,SAASC,EAAiBxwD,GACtB,OAAQqN,IACJ,MAAMs4C,EAAWxW,EAAKxf,OAAO,IAAI3vB,SAAcmvC,EAAKqX,UAAUn5C,EAAM8hC,EAAKxf,OAAOziB,YAC1EujD,EAAiBthB,EAAKxf,OAAO,IAAa,QAAT3vB,EAAiB,MAAQ,kBAChDgK,IAAZ27C,IACAxW,EAAc,QAATnvC,EAAiB,iBAAmB,kBACrC2lD,EAAQJ,WAAa,GACjBI,EAAQH,aAAe,GACvBG,EAAQF,aAAe,GAE/BtW,EAAKt4B,gBACLs4B,EAAKt4B,cAAgBs4B,EAAKt4B,cAAcrW,QAAQwqD,GAAMpD,EAAUoD,KAC3D7b,EAAKt4B,cAAchG,QAAmB,QAAT7Q,GAC9B0lD,EAAiBC,GACrBV,MAEA9V,EAAK2T,gBACLmE,SACgBj9C,IAAZ27C,EACAxW,EAAK8f,mBAAmBjvD,GAAQ2lD,EAAQkB,cAActa,WAEtD4C,EAAK8f,mBAAmByB,gBAAgB1wD,GAC5CmvC,EAAK8f,mBAAmBhD,WAClBwE,QACczmD,IAAZ27C,GACA8K,EAAe5J,gBAAkBlB,EAAQkB,gBA+G7D,SAAS8J,IACL,OAAOxhB,EAAKxf,OAAO6+B,KACbrlB,EAAQynB,cAAc,gBACtBznB,EAEV,SAAS0nB,IAC6B,iBAAvB1hB,EAAKxf,OAAOzb,aAC4B,IAAxCqD,EAAUu5C,MAAM3hB,EAAKxf,OAAOzb,SACnCi7B,EAAKxf,OAAOo3B,aAAa,IAAIgK,MAAM,6BAA6B5hB,EAAKxf,OAAOzb,WAChFi7B,EAAKkT,KAAOnhC,OAAOkmB,OAAOlmB,OAAOkmB,OAAO,GAAI7vB,EAAUu5C,MAAME,SAAyC,iBAAvB7hB,EAAKxf,OAAOzb,OACpFi7B,EAAKxf,OAAOzb,OACW,YAAvBi7B,EAAKxf,OAAOzb,OACRqD,EAAUu5C,MAAM3hB,EAAKxf,OAAOzb,aAC5BlK,GACV,EAAAinD,WAAA,EAAe,IAAI9hB,EAAKkT,KAAKpsC,KAAK,MAAMk5B,EAAKkT,KAAKpsC,KAAK,MAAMk5B,EAAKkT,KAAKpsC,KAAK,GAAGmT,iBAAiB+lB,EAAKkT,KAAKpsC,KAAK,GAAGmT,sBAErFpf,IADVkX,OAAOkmB,OAAOlmB,OAAOkmB,OAAO,GAAI+a,GAAiBn1C,KAAKC,MAAMD,KAAKmP,UAAUgtB,EAAQ4R,SAAW,MAClG8K,gBAC2B77C,IAAtCuN,EAAU6qC,cAAcyD,YACxB1W,EAAKxf,OAAOk2B,UAAY1W,EAAKkT,KAAKwD,WAEtC1W,EAAK8Y,YAAa,IAAAiJ,qBAAoB/hB,GACtCA,EAAKqX,WAAY,IAAA2K,kBAAiB,CAAExhC,OAAQwf,EAAKxf,OAAQ0yB,KAAMlT,EAAKkT,OAExE,SAASkO,EAAiBa,GACtB,GAAoC,mBAAzBjiB,EAAKxf,OAAO1S,SACnB,YAAYkyB,EAAKxf,OAAO1S,SAASkyB,EAAMiiB,GAE3C,QAA+BpnD,IAA3BmlC,EAAKwT,kBACL,OACJyD,EAAa,yBACb,MAAMryC,EAAkBq9C,GAAyBjiB,EAAKkiB,iBAChDC,EAAiB32C,MAAML,UAAUtK,OAAOuhD,KAAKpiB,EAAKwT,kBAAkBpE,UAAU,CAAEiT,EAAKC,IAAUD,EAAMC,EAAMC,cAAe,GAAIC,EAAgBxiB,EAAKwT,kBAAkBK,YAAa4O,EAAYziB,EAAKxf,OAAO1S,SAAS8e,MAAM,KAAM81B,EAAoBD,EAAU,GAAIE,EAAsBF,EAAU/gD,OAAS,EAAI+gD,EAAU,GAAK,KAAMG,EAAch+C,EAAgBi+C,wBAAyBC,EAAqBl3C,OAAOm3C,YAAcH,EAAYI,OAAQC,EAAkC,UAAtBP,GAC/a,UAAtBA,GACGI,EAAqBX,GACrBS,EAAYpT,IAAM2S,EACpB3S,EAAM5jC,OAAOs3C,YACfN,EAAYpT,KACVyT,GAAgDd,EAAiB,EAArDv9C,EAAgB29C,aAAe,GAGjD,IAFA,IAAAhwB,aAAYyN,EAAKwT,kBAAmB,YAAayP,IACjD,IAAA1wB,aAAYyN,EAAKwT,kBAAmB,cAAeyP,GAC/CjjB,EAAKxf,OAAOu9B,OACZ,OACJ,IAAIoF,EAAOv3C,OAAOw3C,YAAcR,EAAYO,KACxCE,GAAW,EACXC,GAAU,EACc,WAAxBX,GACAQ,IAASX,EAAgBI,EAAYxiB,OAAS,EAC9CijB,GAAW,GAEkB,UAAxBV,IACLQ,GAAQX,EAAgBI,EAAYxiB,MACpCkjB,GAAU,IAEd,IAAA/wB,aAAYyN,EAAKwT,kBAAmB,aAAc6P,IAAaC,IAC/D,IAAA/wB,aAAYyN,EAAKwT,kBAAmB,cAAe6P,IACnD,IAAA9wB,aAAYyN,EAAKwT,kBAAmB,aAAc8P,GAClD,MAAMC,EAAQ33C,OAAOpH,SAAS87B,KAAKuT,aAC9BjoC,OAAOw3C,YAAcR,EAAYW,OAChCC,EAAYL,EAAOX,EAAgB52C,OAAOpH,SAAS87B,KAAKuT,YACxD4P,EAAaF,EAAQf,EAAgB52C,OAAOpH,SAAS87B,KAAKuT,YAEhE,IADA,IAAAthB,aAAYyN,EAAKwT,kBAAmB,YAAagQ,IAC7CxjB,EAAKxf,OAAO2gC,OAGhB,GADAnhB,EAAKwT,kBAAkBrT,MAAMqP,IAAM,GAAGA,MACjCgU,EAIA,GAAKC,EAIL,CACD,MAAM1a,EAgBd,WACI,IAAI2a,EAAgB,KACpB,IAAK,IAAI5kB,EAAI,EAAGA,EAAIt6B,SAASm/C,YAAYjiD,OAAQo9B,IAAK,CAClD,MAAM8kB,EAAQp/C,SAASm/C,YAAY7kB,GACnC,IACI8kB,EAAMC,SAEV,MAAOC,GACH,SAEJJ,EAAgBE,EAChB,MAEJ,OAAwB,MAAjBF,EAAwBA,EAEnC,WACI,MAAMvjB,EAAQ37B,SAASg7B,cAAc,SAErC,OADAh7B,SAASu/C,KAAKxjB,YAAYJ,GACnBA,EAAMyjB,MALkCI,GA7B/BC,GACZ,QAAYppD,IAARkuC,EACA,OACJ,MAAMmb,EAAYt4C,OAAOpH,SAAS87B,KAAKuT,YACjCsQ,EAAa9lB,KAAK0W,IAAI,EAAGmP,EAAY,EAAI1B,EAAgB,GACzD4B,EAAe,wCACfC,EAAc,uCACdC,EAAcvb,EAAI8a,SAASniD,OAC3B6iD,EAAc,SAAS3B,EAAYO,uBACzC,IAAA5wB,aAAYyN,EAAKwT,kBAAmB,aAAa,IACjD,IAAAjhB,aAAYyN,EAAKwT,kBAAmB,cAAc,GAClDzK,EAAIyb,WAAW,GAAGJ,KAAgBC,IAAcE,IAAeD,GAC/DtkB,EAAKwT,kBAAkBrT,MAAMgjB,KAAO,GAAGgB,MACvCnkB,EAAKwT,kBAAkBrT,MAAMojB,MAAQ,YAjBrCvjB,EAAKwT,kBAAkBrT,MAAMgjB,KAAO,OACpCnjB,EAAKwT,kBAAkBrT,MAAMojB,MAAQ,GAAGA,WALxCvjB,EAAKwT,kBAAkBrT,MAAMgjB,KAAO,GAAGA,MACvCnjB,EAAKwT,kBAAkBrT,MAAMojB,MAAQ,OA2C7C,SAASzL,IACD9X,EAAKxf,OAAOtY,YAAc83B,EAAKyW,WAEnCoB,IACA8F,KACAjC,KAEJ,SAASgE,IACL1f,EAAK4V,OAAOvsC,SACwC,IAAhDuC,OAAO64C,UAAUC,UAAUzM,QAAQ,cACJp9C,IAA/B4pD,UAAUE,iBACVrlD,WAAW0gC,EAAKkO,MAAO,GAGvBlO,EAAKkO,QAGb,SAASyR,EAAWjmD,GAChBA,EAAEsvB,iBACFtvB,EAAEmmD,kBACF,MAIMc,GAAI,IAAAiE,aAAW,IAAAlQ,gBAAeh7C,IAJdmrD,GAAQA,EAAI/a,WAC9B+a,EAAI/a,UAAUC,SAAS,mBACtB8a,EAAI/a,UAAUC,SAAS,wBACvB8a,EAAI/a,UAAUC,SAAS,gBAE5B,QAAUlvC,IAAN8lD,EACA,OACJ,MAAMtmC,EAASsmC,EACTmE,EAAgB9kB,EAAKuU,sBAAwB,IAAI39B,KAAKyD,EAAOm8B,QAAQrC,WACrE4Q,GAAqBD,EAAanN,WAAa3X,EAAKyX,cACtDqN,EAAanN,WACT3X,EAAKyX,aAAezX,EAAKxf,OAAO8yB,WAAa,IAC5B,UAArBtT,EAAKxf,OAAOxY,KAEhB,GADAg4B,EAAKmZ,iBAAmB9+B,EACC,WAArB2lB,EAAKxf,OAAOxY,KACZg4B,EAAKt4B,cAAgB,CAACo9C,QACrB,GAAyB,aAArB9kB,EAAKxf,OAAOxY,KAAqB,CACtC,MAAMg9C,EAAgB9L,GAAe4L,GACjCE,EACAhlB,EAAKt4B,cAAckI,OAAO7L,SAASihD,GAAgB,GAEnDhlB,EAAKt4B,cAAc3F,KAAK+iD,OAEF,UAArB9kB,EAAKxf,OAAOxY,OACiB,IAA9Bg4B,EAAKt4B,cAAchG,QACnBs+B,EAAKlkC,OAAM,GAAO,GAEtBkkC,EAAKuU,sBAAwBuQ,EAC7B9kB,EAAKt4B,cAAc3F,KAAK+iD,GACwC,KAA5D,IAAA5Q,cAAa4Q,EAAc9kB,EAAKt4B,cAAc,IAAI,IAClDs4B,EAAKt4B,cAAc+vB,MAAK,CAACC,EAAGC,IAAMD,EAAEyc,UAAYxc,EAAEwc,aAG1D,GADA0B,IACIkP,EAAmB,CACnB,MAAMrG,EAAY1e,EAAKuX,cAAgBuN,EAAapN,cACpD1X,EAAKuX,YAAcuN,EAAapN,cAChC1X,EAAKyX,aAAeqN,EAAanN,WAC7B+G,IACAzH,EAAa,gBACbY,KAEJZ,EAAa,iBAejB,GAbA0G,KACAjC,IACA5F,KACKiP,GACoB,UAArB/kB,EAAKxf,OAAOxY,MACe,IAA3Bg4B,EAAKxf,OAAO8yB,gBAEmBz4C,IAA1BmlC,EAAKmZ,uBACWt+C,IAArBmlC,EAAKoV,aACLpV,EAAKmZ,kBAAoBnZ,EAAKmZ,iBAAiB9vC,QAH/CkwC,EAAel/B,QAKMxf,IAArBmlC,EAAKoV,kBACgBv6C,IAArBmlC,EAAKoV,aAA6BpV,EAAKoV,YAAY/rC,QACnD22B,EAAKxf,OAAOykC,cAAe,CAC3B,MAAM7gB,EAA8B,WAArBpE,EAAKxf,OAAOxY,OAAsBg4B,EAAKxf,OAAOvY,WACvDy6B,EAA6B,UAArB1C,EAAKxf,OAAOxY,MACQ,IAA9Bg4B,EAAKt4B,cAAchG,SAClBs+B,EAAKxf,OAAOvY,YACbm8B,GAAU1B,IACVgd,IAGRh9C,IA3/CJs9B,EAAKqX,WAAY,IAAA2K,kBAAiB,CAAExhC,OAAQwf,EAAKxf,OAAQ0yB,KAAMlT,EAAKkT,OACpElT,EAAKgX,UAAY,GACjBhX,EAAKggB,eAAiB,GACtBhgB,EAAKklB,cAAgB,GACrBllB,EAAKmlB,MAAQlkC,EACb+e,EAAKolB,kBAAoB7O,EACzBvW,EAAKqlB,kBAAoBjE,EACzBphB,EAAK0a,YAAcA,EACnB1a,EAAK4W,WAAaA,EAClB5W,EAAKlkC,MA4tBL,SAAewpD,GAAqB,EAAMC,GAAY,GAYlD,GAXAvlB,EAAK7Y,MAAMjuB,MAAQ,QACG2B,IAAlBmlC,EAAKn7B,WACLm7B,EAAKn7B,SAAS3L,MAAQ,SACD2B,IAArBmlC,EAAKwlB,cACLxlB,EAAKwlB,YAAYtsD,MAAQ,IAC7B8mC,EAAKt4B,cAAgB,GACrBs4B,EAAKuU,2BAAwB15C,GACX,IAAd0qD,IACAvlB,EAAKuX,YAAcvX,EAAKylB,aAAa/N,cACrC1X,EAAKyX,aAAezX,EAAKylB,aAAa9N,aAEX,IAA3B3X,EAAKxf,OAAOvY,WAAqB,CACjC,MAAM,MAAEuQ,EAAK,QAAED,EAAO,QAAED,IAAY,IAAA87B,iBAAgBpU,EAAKxf,QACzD6zB,EAAS77B,EAAOD,EAASD,GAE7B0nB,EAAK8X,SACDwN,GACArO,EAAa,aA7uBrBjX,EAAKkO,MA+uBL,WACIlO,EAAKuM,QAAS,EACTvM,EAAKyW,gBACyB57C,IAA3BmlC,EAAKwT,mBACLxT,EAAKwT,kBAAkB1J,UAAU5/B,OAAO,aAExBrP,IAAhBmlC,EAAK4V,QACL5V,EAAK4V,OAAO9L,UAAU5/B,OAAO,WAGrC+sC,EAAa,YAxvBjBjX,EAAK0lB,eAAiB,EAAAlmB,cACtBQ,EAAKn2B,QAyvBL,gBACwBhP,IAAhBmlC,EAAKxf,QACLy2B,EAAa,aACjB,IAAK,IAAInY,EAAIkB,EAAKgX,UAAUt1C,OAAQo9B,KAChCkB,EAAKgX,UAAUlY,GAAG50B,SAGtB,GADA81B,EAAKgX,UAAY,GACbhX,EAAKwlB,YACDxlB,EAAKwlB,YAAYh8C,YACjBw2B,EAAKwlB,YAAYh8C,WAAWC,YAAYu2B,EAAKwlB,aACjDxlB,EAAKwlB,iBAAc3qD,OAElB,GAAImlC,EAAKwT,mBAAqBxT,EAAKwT,kBAAkBhqC,WACtD,GAAIw2B,EAAKxf,OAAO2gC,QAAUnhB,EAAKwT,kBAAkBhqC,WAAY,CACzD,MAAMgjC,EAAUxM,EAAKwT,kBAAkBhqC,WAEvC,GADAgjC,EAAQmZ,WAAanZ,EAAQ/iC,YAAY+iC,EAAQmZ,WAC7CnZ,EAAQhjC,WAAY,CACpB,KAAOgjC,EAAQ2L,YACX3L,EAAQhjC,WAAWo8C,aAAapZ,EAAQ2L,WAAY3L,GACxDA,EAAQhjC,WAAWC,YAAY+iC,SAInCxM,EAAKwT,kBAAkBhqC,WAAWC,YAAYu2B,EAAKwT,mBAEvDxT,EAAKn7B,WACLm7B,EAAK7Y,MAAMt2B,KAAO,OACdmvC,EAAKn7B,SAAS2E,YACdw2B,EAAKn7B,SAAS2E,WAAWC,YAAYu2B,EAAKn7B,iBACvCm7B,EAAKn7B,UAEZm7B,EAAK7Y,QACL6Y,EAAK7Y,MAAMt2B,KAAOmvC,EAAK7Y,MAAM0+B,MAC7B7lB,EAAK7Y,MAAM2iB,UAAU5/B,OAAO,mBAC5B81B,EAAK7Y,MAAMo6B,gBAAgB,aAE/B,CACI,iBACA,wBACA,sBACA,sBACA,uBACA,uBACA,WACA,SACA,mBACA,iBACA,iBACA,OACA,gBACA,SACA,mBACA,iBACA,aACA,WACA,gBACA,oBACA,mBACA,eACA,eACA,0BACA,sBACA,qBACA,yBACA,mBACA,UACFv/C,SAAS8jD,IACP,WACW9lB,EAAK8lB,GAEhB,MAAOC,SA9zBf/lB,EAAKyY,UAAYA,EACjBzY,EAAKkX,WAAaA,EAClBlX,EAAK52B,KA+nCL,SAAc1P,EAAGkL,EAAkBo7B,EAAKkiB,kBACpC,IAAsB,IAAlBliB,EAAKyW,SAAmB,CACxB,GAAI/8C,EAAG,CACHA,EAAEsvB,iBACF,MAAMyrB,GAAc,IAAAC,gBAAeh7C,GAC/B+6C,GACAA,EAAY+K,OAQpB,YALyB3kD,IAArBmlC,EAAKwlB,cACLxlB,EAAKwlB,YAAYn8C,QACjB22B,EAAKwlB,YAAYQ,cAErB/O,EAAa,UAGZ,GAAIjX,EAAK4V,OAAOkH,UAAY9c,EAAKxf,OAAOu9B,OACzC,OAEJ,MAAMkI,EAAUjmB,EAAKuM,OACrBvM,EAAKuM,QAAS,EACT0Z,IACDjmB,EAAKwT,kBAAkB1J,UAAU7sC,IAAI,QACrC+iC,EAAK4V,OAAO9L,UAAU7sC,IAAI,UAC1Bg6C,EAAa,UACbmK,EAAiBx8C,KAEU,IAA3Bo7B,EAAKxf,OAAOvY,aAAkD,IAA3B+3B,EAAKxf,OAAOtY,cAChB,IAA3B83B,EAAKxf,OAAO7b,iBACL9J,IAANnB,GACIsmC,EAAKue,cAAcxU,SAASrwC,EAAE0kD,gBACnC9+C,YAAW,IAAM0gC,EAAKoV,YAAYj7C,UAAU,MA7pCxD6lC,EAAK8X,OAASA,EACd9X,EAAKkmB,IA8/CL,SAAajtD,EAAQC,GACjB,GAAe,OAAXD,GAAqC,iBAAXA,EAAqB,CAC/C8Y,OAAOkmB,OAAO+H,EAAKxf,OAAQvnB,GAC3B,IAAK,MAAMnG,KAAOmG,OACS4B,IAAnBsrD,EAAUrzD,IACVqzD,EAAUrzD,GAAKkP,SAAS+8B,GAAMA,WAItCiB,EAAKxf,OAAOvnB,GAAUC,OACI2B,IAAtBsrD,EAAUltD,GACVktD,EAAUltD,GAAQ+I,SAAS+8B,GAAMA,MAC5B,EAAAqnB,MAAA,QAAcntD,IAAW,IAC9B+mC,EAAKxf,OAAOvnB,IAAU,IAAAotD,UAASntD,IAEvC8mC,EAAK8X,SACLhC,IAAY,IA7gDhB9V,EAAKmf,QAijDL,SAAiBjhD,EAAMwE,GAAgB,EAAOzE,EAAS+hC,EAAKxf,OAAOziB,YAC/D,GAAc,IAATG,IAAeA,GAAUA,aAAgBsN,OAAyB,IAAhBtN,EAAKwD,OACxD,OAAOs+B,EAAKlkC,MAAM4G,GACtB4jD,EAAgBpoD,EAAMD,GACtB+hC,EAAKuU,sBACDvU,EAAKt4B,cAAcs4B,EAAKt4B,cAAchG,OAAS,GACnDs+B,EAAK8X,SACLZ,OAAWr8C,EAAW6H,GACtB6zC,IACkC,IAA9BvW,EAAKt4B,cAAchG,QACnBs+B,EAAKlkC,OAAM,GAEfg6C,GAAYpzC,GACRA,GACAu0C,EAAa,aA9jDrBjX,EAAK3jC,OAisDL,SAAgB3C,GACZ,IAAoB,IAAhBsmC,EAAKuM,OACL,OAAOvM,EAAKkO,QAChBlO,EAAK52B,KAAK1P,IA1Nd,MAAMysD,EAAY,CACdphD,OAAQ,CAAC28C,EAAanE,GACtBjK,WAAY,CAACyJ,EAAa3J,EAAkBiK,GAC5Cl/C,QAAS,CAAC+4C,GACV94C,QAAS,CAAC84C,GACVpyC,WAAY,CACR,MACmC,IAA3Bk7B,EAAKxf,OAAO1b,YACZmc,EAAK+e,EAAK4V,OAAQ,QAAS5V,EAAK52B,MAChC6X,EAAK+e,EAAK4V,OAAQ,QAAS5V,EAAK52B,QAGhC42B,EAAK4V,OAAO3L,oBAAoB,QAASjK,EAAK52B,MAC9C42B,EAAK4V,OAAO3L,oBAAoB,QAASjK,EAAK52B,UAuB9D,SAASk9C,EAAgBC,EAAWtoD,GAChC,IAAIuoD,EAAQ,GACZ,GAAID,aAAqB/6C,MACrBg7C,EAAQD,EAAUplD,KAAK06C,GAAM7b,EAAKqX,UAAUwE,EAAG59C,UAC9C,GAAIsoD,aAAqB3vC,MAA6B,iBAAd2vC,EACzCC,EAAQ,CAACxmB,EAAKqX,UAAUkP,EAAWtoD,SAClC,GAAyB,iBAAdsoD,EACZ,OAAQvmB,EAAKxf,OAAOxY,MAChB,IAAK,SACL,IAAK,OACDw+C,EAAQ,CAACxmB,EAAKqX,UAAUkP,EAAWtoD,IACnC,MACJ,IAAK,WACDuoD,EAAQD,EACH35B,MAAMoT,EAAKxf,OAAOimC,aAClBtlD,KAAKjD,GAAS8hC,EAAKqX,UAAUn5C,EAAMD,KACxC,MACJ,IAAK,QACDuoD,EAAQD,EACH35B,MAAMoT,EAAKkT,KAAK3sC,gBAChBpF,KAAKjD,GAAS8hC,EAAKqX,UAAUn5C,EAAMD,UAOhD+hC,EAAKxf,OAAOo3B,aAAa,IAAIgK,MAAM,0BAA0B/jD,KAAKmP,UAAUu5C,OAChFvmB,EAAKt4B,cAAiBs4B,EAAKxf,OAAOkmC,oBAC5BF,EACAA,EAAMn1D,QAAQwqD,GAAMA,aAAajlC,MAAQ6hC,EAAUoD,GAAG,KACnC,UAArB7b,EAAKxf,OAAOxY,MACZg4B,EAAKt4B,cAAc+vB,MAAK,CAACC,EAAGC,IAAMD,EAAEyc,UAAYxc,EAAEwc,YAkB1D,SAASwS,EAAeC,GACpB,OAAOA,EACFn7C,QACAtK,KAAK0lD,GACc,iBAATA,GACS,iBAATA,GACPA,aAAgBjwC,KACTopB,EAAKqX,UAAUwP,OAAMhsD,GAAW,GAElCgsD,GACW,iBAATA,GACPA,EAAKzd,MACLyd,EAAKxd,GACE,CACHD,KAAMpJ,EAAKqX,UAAUwP,EAAKzd,UAAMvuC,GAChCwuC,GAAIrJ,EAAKqX,UAAUwP,EAAKxd,QAAIxuC,IAE7BgsD,IAENx1D,QAAQ0tC,GAAMA,IAmHvB,SAASkY,EAAa17C,EAAOoI,GACzB,QAAoB9I,IAAhBmlC,EAAKxf,OACL,OACJ,MAAMsmC,EAAQ9mB,EAAKxf,OAAOjlB,GAC1B,QAAcV,IAAVisD,GAAuBA,EAAMplD,OAAS,EACtC,IAAK,IAAIo9B,EAAI,EAAGgoB,EAAMhoB,IAAMA,EAAIgoB,EAAMplD,OAAQo9B,IAC1CgoB,EAAMhoB,GAAGkB,EAAKt4B,cAAes4B,EAAK7Y,MAAMjuB,MAAO8mC,EAAMr8B,GAE/C,aAAVpI,IACAykC,EAAK7Y,MAAMkxB,cAAcD,GAAY,WACrCpY,EAAK7Y,MAAMkxB,cAAcD,GAAY,WAG7C,SAASA,GAAY1jD,GACjB,MAAMgF,EAAI8K,SAAS4zC,YAAY,SAE/B,OADA1+C,EAAEqtD,UAAUryD,GAAM,GAAM,GACjBgF,EAEX,SAASw/C,GAAeh7C,GACpB,IAAK,IAAI4gC,EAAI,EAAGA,EAAIkB,EAAKt4B,cAAchG,OAAQo9B,IAC3C,GAAkD,KAA9C,IAAAoV,cAAalU,EAAKt4B,cAAco3B,GAAI5gC,GACpC,MAAO,GAAK4gC,EAEpB,OAAO,EAQX,SAAS6e,KACD3d,EAAKxf,OAAOtY,YAAc83B,EAAKyW,WAAazW,EAAKgd,WAErDhd,EAAKkd,aAAal7C,SAAQ,CAAC46C,EAAa9d,KACpC,MAAM+c,EAAI,IAAIjlC,KAAKopB,EAAKuX,YAAavX,EAAKyX,aAAc,GACxDoE,EAAEC,SAAS9b,EAAKyX,aAAe3Y,GAC3BkB,EAAKxf,OAAO8yB,WAAa,GACS,WAAlCtT,EAAKxf,OAAOu7B,kBACZ/b,EAAKmd,cAAcre,GAAG6V,aAClB,IAAAuH,YAAWL,EAAElE,WAAY3X,EAAKxf,OAAO27B,sBAAuBnc,EAAKkT,MAAQ,IAG7ElT,EAAKic,wBAAwB/iD,MAAQ2iD,EAAElE,WAAWva,WAEtDwf,EAAY1jD,MAAQ2iD,EAAEnE,cAActa,cAExC4C,EAAKyd,yBACuB5iD,IAAxBmlC,EAAKxf,OAAOriB,UACP6hC,EAAKuX,cAAgBvX,EAAKxf,OAAOriB,QAAQu5C,cACpC1X,EAAKyX,cAAgBzX,EAAKxf,OAAOriB,QAAQw5C,WACzC3X,EAAKuX,YAAcvX,EAAKxf,OAAOriB,QAAQu5C,eACrD1X,EAAK0d,yBACuB7iD,IAAxBmlC,EAAKxf,OAAOpiB,UACP4hC,EAAKuX,cAAgBvX,EAAKxf,OAAOpiB,QAAQs5C,cACpC1X,EAAKyX,aAAe,EAAIzX,EAAKxf,OAAOpiB,QAAQu5C,WAC5C3X,EAAKuX,YAAcvX,EAAKxf,OAAOpiB,QAAQs5C,gBAEzD,SAASsP,GAAW/oD,GAChB,OAAO+hC,EAAKt4B,cACPvG,KAAK8lD,GAASjnB,EAAK8Y,WAAWmO,EAAMhpD,KACpC5M,QAAO,CAACwqD,EAAG/c,EAAG8nB,IAA6B,UAArB5mB,EAAKxf,OAAOxY,MACnCg4B,EAAKxf,OAAOvY,YACZ2+C,EAAI3O,QAAQ4D,KAAO/c,IAClBnhC,KAA0B,UAArBqiC,EAAKxf,OAAOxY,KAChBg4B,EAAKxf,OAAOimC,YACZzmB,EAAKkT,KAAK3sC,gBAEpB,SAASuvC,GAAYpzC,GAAgB,QACR7H,IAArBmlC,EAAKwlB,aAA6BxlB,EAAKknB,kBACvClnB,EAAKwlB,YAAYtsD,WACkB2B,IAA/BmlC,EAAKuU,sBACCvU,EAAK8Y,WAAW9Y,EAAKuU,sBAAuBvU,EAAKknB,iBACjD,IAEdlnB,EAAK7Y,MAAMjuB,MAAQ8tD,GAAWhnB,EAAKxf,OAAOziB,iBACpBlD,IAAlBmlC,EAAKn7B,WACLm7B,EAAKn7B,SAAS3L,MAAQ8tD,GAAWhnB,EAAKxf,OAAOzY,aAE3B,IAAlBrF,GACAu0C,EAAa,iBAErB,SAASkQ,GAAgBztD,GACrB,MAAM+6C,GAAc,IAAAC,gBAAeh7C,GAC7B0tD,EAAcpnB,EAAKid,aAAalT,SAAS0K,GACzC4S,EAAcrnB,EAAKod,aAAarT,SAAS0K,GAC3C2S,GAAeC,EACf3M,EAAY0M,GAAe,EAAI,GAE1BpnB,EAAKkd,aAAajF,QAAQxD,IAAgB,EAC/CA,EAAYt6C,SAEPs6C,EAAY3K,UAAUC,SAAS,WACpC/J,EAAK4W,WAAW5W,EAAKuX,YAAc,GAE9B9C,EAAY3K,UAAUC,SAAS,cACpC/J,EAAK4W,WAAW5W,EAAKuX,YAAc,GA0C3C,OAt0DA,WACIvX,EAAKhG,QAAUgG,EAAK7Y,MAAQ6S,EAC5BgG,EAAKuM,QAAS,EA+qClB,WACI,MAAM+a,EAAW,CACb,OACA,cACA,aACA,sBACA,aACA,YACA,aACA,aACA,WACA,wBACA,SACA,SACA,gBACA,iBAEEC,EAAax1C,OAAOkmB,OAAOlmB,OAAOkmB,OAAO,GAAIp6B,KAAKC,MAAMD,KAAKmP,UAAUgtB,EAAQ4R,SAAW,MAAOoH,GACjGwU,EAAU,GAChBxnB,EAAKxf,OAAO62B,UAAYkQ,EAAWlQ,UACnCrX,EAAKxf,OAAOs4B,WAAayO,EAAWzO,WACpC/mC,OAAO01C,eAAeznB,EAAKxf,OAAQ,SAAU,CACzCvW,IAAK,IAAM+1B,EAAKxf,OAAOknC,QACvBxB,IAAMM,IACFxmB,EAAKxf,OAAOknC,QAAUf,EAAeH,MAG7Cz0C,OAAO01C,eAAeznB,EAAKxf,OAAQ,UAAW,CAC1CvW,IAAK,IAAM+1B,EAAKxf,OAAOmnC,SACvBzB,IAAMM,IACFxmB,EAAKxf,OAAOmnC,SAAWhB,EAAeH,MAG9C,MAAMoB,EAA+B,SAApBL,EAAWv/C,KAC5B,IAAKu/C,EAAWxpD,aAAewpD,EAAWt/C,YAAc2/C,GAAW,CAC/D,MAAMC,EAAoBz/C,EAAU6qC,cAAcl1C,YAAc,sBAChEypD,EAAQzpD,WACJwpD,EAAWr/C,YAAc0/C,EACnB,OAASL,EAAWO,cAAgB,KAAO,IAC3CD,EAAoB,QAAUN,EAAWO,cAAgB,KAAO,IAE9E,GAAIP,EAAW1iD,WACV0iD,EAAWt/C,YAAc2/C,KACzBL,EAAWx/C,UAAW,CACvB,MAAMggD,EAAmB3/C,EAAU6qC,cAAclrC,WAAa,qBAC9Dy/C,EAAQz/C,UACJw/C,EAAWr/C,YAAc0/C,EACnB,OAASL,EAAWO,cAAgB,OAAS,MAC7CC,EAAmB,OAAOR,EAAWO,cAAgB,KAAO,OAE1E/1C,OAAO01C,eAAeznB,EAAKxf,OAAQ,UAAW,CAC1CvW,IAAK,IAAM+1B,EAAKxf,OAAOwnC,SACvB9B,IAAK7E,EAAiB,SAE1BtvC,OAAO01C,eAAeznB,EAAKxf,OAAQ,UAAW,CAC1CvW,IAAK,IAAM+1B,EAAKxf,OAAOynC,SACvB/B,IAAK7E,EAAiB,SAE1B,MAAM6G,EAAoBr3D,GAAU4I,IAChCumC,EAAKxf,OAAgB,QAAT3vB,EAAiB,WAAa,YAAcmvC,EAAKqX,UAAU59C,EAAK,UAEhFsY,OAAO01C,eAAeznB,EAAKxf,OAAQ,UAAW,CAC1CvW,IAAK,IAAM+1B,EAAKxf,OAAO2nC,SACvBjC,IAAKgC,EAAiB,SAE1Bn2C,OAAO01C,eAAeznB,EAAKxf,OAAQ,UAAW,CAC1CvW,IAAK,IAAM+1B,EAAKxf,OAAO4nC,SACvBlC,IAAKgC,EAAiB,SAEF,SAApBX,EAAWv/C,OACXg4B,EAAKxf,OAAOtY,YAAa,EACzB83B,EAAKxf,OAAOvY,YAAa,GAE7B8J,OAAOkmB,OAAO+H,EAAKxf,OAAQgnC,EAASD,GACpC,IAAK,IAAIzoB,EAAI,EAAGA,EAAIwoB,EAAS5lD,OAAQo9B,IACjCkB,EAAKxf,OAAO8mC,EAASxoB,KACY,IAA7BkB,EAAKxf,OAAO8mC,EAASxoB,KACY,SAA7BkB,EAAKxf,OAAO8mC,EAASxoB,IACjC,EAAAsnB,MAAA,QAAciC,QAA+BxtD,IAAtBmlC,EAAKxf,OAAO6nC,KAAqBrmD,SAASqmD,IAC7DroB,EAAKxf,OAAO6nC,IAAQ,IAAAhC,UAASrmB,EAAKxf,OAAO6nC,IAAS,IAAIlnD,IAAIgyC,MAE9DnT,EAAKyW,UACAzW,EAAKxf,OAAO8nC,gBACRtoB,EAAKxf,OAAOu9B,QACQ,WAArB/d,EAAKxf,OAAOxY,OACXg4B,EAAKxf,OAAOs+B,QAAQp9C,SACpBs+B,EAAKxf,OAAOwL,SACZgU,EAAKxf,OAAO6yB,aACb,iEAAiE9W,KAAKkoB,UAAUC,WACxF,IAAK,IAAI5lB,EAAI,EAAGA,EAAIkB,EAAKxf,OAAO+nC,QAAQ7mD,OAAQo9B,IAAK,CACjD,MAAM0pB,EAAaxoB,EAAKxf,OAAO+nC,QAAQzpB,GAAGkB,IAAS,GACnD,IAAK,MAAMltC,KAAO01D,EACV,EAAApC,MAAA,QAActzD,IAAQ,EACtBktC,EAAKxf,OAAO1tB,IAAO,IAAAuzD,UAASmC,EAAW11D,IAClCqO,IAAIgyC,GACJhgB,OAAO6M,EAAKxf,OAAO1tB,SAEQ,IAApBy0D,EAAWz0D,KACvBktC,EAAKxf,OAAO1tB,GAAO01D,EAAW11D,IAGrCy0D,EAAWkB,gBACZzoB,EAAKxf,OAAOioC,cACRjH,IAAexJ,UAAY,IAAMhY,EAAKxf,OAAOioC,eAErDxR,EAAa,iBAvxCbyR,GACAhH,IAinDA1hB,EAAK7Y,MAAQq6B,IACRxhB,EAAK7Y,OAIV6Y,EAAK7Y,MAAM0+B,MAAQ7lB,EAAK7Y,MAAMt2B,KAC9BmvC,EAAK7Y,MAAMt2B,KAAO,OAClBmvC,EAAK7Y,MAAM2iB,UAAU7sC,IAAI,mBACzB+iC,EAAK4V,OAAS5V,EAAK7Y,MACf6Y,EAAKxf,OAAO3b,WACZm7B,EAAKn7B,UAAW,IAAA26B,eAAcQ,EAAK7Y,MAAMwhC,SAAU3oB,EAAKxf,OAAOioC,eAC/DzoB,EAAK4V,OAAS5V,EAAKn7B,SACnBm7B,EAAKn7B,SAAS/J,YAAcklC,EAAK7Y,MAAMrsB,YACvCklC,EAAKn7B,SAASi4C,SAAW9c,EAAK7Y,MAAM21B,SACpC9c,EAAKn7B,SAASjG,SAAWohC,EAAK7Y,MAAMvoB,SACpCohC,EAAKn7B,SAASo0C,SAAWjZ,EAAK7Y,MAAM8xB,SACpCjZ,EAAKn7B,SAAShU,KAAO,OACrBmvC,EAAK7Y,MAAM0xB,aAAa,OAAQ,WAC3B7Y,EAAKxf,OAAO2gC,QAAUnhB,EAAK7Y,MAAM3d,YAClCw2B,EAAK7Y,MAAM3d,WAAWo8C,aAAa5lB,EAAKn7B,SAAUm7B,EAAK7Y,MAAMyhC,cAEhE5oB,EAAKxf,OAAO7b,YACbq7B,EAAK4V,OAAOiD,aAAa,WAAY,YACzC7Y,EAAKkiB,iBAAmBliB,EAAKxf,OAAO5b,iBAAmBo7B,EAAK4V,QArBxD5V,EAAKxf,OAAOo3B,aAAa,IAAIgK,MAAM,oCA5C3C,WACI5hB,EAAKt4B,cAAgB,GACrBs4B,EAAKF,IAAME,EAAKqX,UAAUrX,EAAKxf,OAAOsf,MAAQ,IAAIlpB,KAClD,MAAMiyC,EAAgB7oB,EAAKxf,OAAOyzB,cACJ,UAAxBjU,EAAK7Y,MAAMwhC,UACe,aAAxB3oB,EAAK7Y,MAAMwhC,WACX3oB,EAAK7Y,MAAMrsB,aACXklC,EAAK7Y,MAAMjuB,QAAU8mC,EAAK7Y,MAAMrsB,YAE9BklC,EAAK7Y,MAAMjuB,MADX,MAEN2vD,GACAvC,EAAgBuC,EAAe7oB,EAAKxf,OAAOziB,YAC/CiiC,EAAKylB,aACDzlB,EAAKt4B,cAAchG,OAAS,EACtBs+B,EAAKt4B,cAAc,GACnBs4B,EAAKxf,OAAOriB,SACV6hC,EAAKxf,OAAOriB,QAAQg2C,UAAYnU,EAAKF,IAAIqU,UACvCnU,EAAKxf,OAAOriB,QACZ6hC,EAAKxf,OAAOpiB,SACV4hC,EAAKxf,OAAOpiB,QAAQ+1C,UAAYnU,EAAKF,IAAIqU,UACvCnU,EAAKxf,OAAOpiB,QACZ4hC,EAAKF,IACvBE,EAAKuX,YAAcvX,EAAKylB,aAAa/N,cACrC1X,EAAKyX,aAAezX,EAAKylB,aAAa9N,WAClC3X,EAAKt4B,cAAchG,OAAS,IAC5Bs+B,EAAKuU,sBAAwBvU,EAAKt4B,cAAc,SACxB7M,IAAxBmlC,EAAKxf,OAAOhiB,UACZwhC,EAAKxf,OAAOhiB,QAAUwhC,EAAKqX,UAAUrX,EAAKxf,OAAOhiB,QAAS,aAClC3D,IAAxBmlC,EAAKxf,OAAO/hB,UACZuhC,EAAKxf,OAAO/hB,QAAUuhC,EAAKqX,UAAUrX,EAAKxf,OAAO/hB,QAAS,QAC9DuhC,EAAKkW,iBACClW,EAAKxf,OAAOriB,UACT6hC,EAAKxf,OAAOriB,QAAQi4C,WAAa,GAC9BpW,EAAKxf,OAAOriB,QAAQk4C,aAAe,GACnCrW,EAAKxf,OAAOriB,QAAQm4C,aAAe,GAC/CtW,EAAKmW,iBACCnW,EAAKxf,OAAOpiB,UACT4hC,EAAKxf,OAAOpiB,QAAQg4C,WAAa,GAC9BpW,EAAKxf,OAAOpiB,QAAQi4C,aAAe,GACnCrW,EAAKxf,OAAOpiB,QAAQk4C,aAAe,GA5mD/CwS,GAdA9oB,EAAKgb,MAAQ,CACTC,eAAc,CAAC7zC,EAAQ44B,EAAKyX,aAAcsR,EAAK/oB,EAAKuX,cAClC,IAAVnwC,IAAiB2hD,EAAK,GAAM,GAAKA,EAAK,KAAQ,GAAMA,EAAK,KAAQ,GAC1D,GACJ/oB,EAAKkT,KAAKgI,YAAY9zC,IAYhC44B,EAAKyW,UAsQd,WACI,MAAMuS,EAAWp9C,OAAOpH,SAAS22C,yBAGjC,GAFAnb,EAAKwT,mBAAoB,IAAAhU,eAAc,MAAO,sBAC9CQ,EAAKwT,kBAAkByF,UAAY,GAC9BjZ,EAAKxf,OAAOtY,WAAY,CAGzB,GAFA8gD,EAASzoB,aA8RbP,EAAKgd,UAAW,IAAAxd,eAAc,MAAO,oBACrCQ,EAAKkd,aAAe,GACpBld,EAAKmd,cAAgB,GACrBnd,EAAKid,cAAe,IAAAzd,eAAc,OAAQ,wBAC1CQ,EAAKid,aAAaxd,UAAYO,EAAKxf,OAAOyoC,UAC1CjpB,EAAKod,cAAe,IAAA5d,eAAc,OAAQ,wBAC1CQ,EAAKod,aAAa3d,UAAYO,EAAKxf,OAAO0oC,UAC1CnM,IACAhrC,OAAO01C,eAAeznB,EAAM,sBAAuB,CAC/C/1B,IAAK,IAAM+1B,EAAKmpB,qBAChB,IAAIpK,GACI/e,EAAKmpB,uBAAyBpK,KAC9B,IAAAxsB,aAAYyN,EAAKid,aAAc,qBAAsB8B,GACrD/e,EAAKmpB,qBAAuBpK,MAIxChtC,OAAO01C,eAAeznB,EAAM,sBAAuB,CAC/C/1B,IAAK,IAAM+1B,EAAKopB,qBAChB,IAAIrK,GACI/e,EAAKopB,uBAAyBrK,KAC9B,IAAAxsB,aAAYyN,EAAKod,aAAc,qBAAsB2B,GACrD/e,EAAKopB,qBAAuBrK,MAIxC/e,EAAK8f,mBAAqB9f,EAAKkd,aAAa,GAC5CS,KACO3d,EAAKgd,WAzTRhd,EAAKqpB,gBAAiB,IAAA7pB,eAAc,MAAO,4BACvCQ,EAAKxf,OAAO6yB,YAAa,CACzB,MAAM,YAAES,EAAW,YAAET,GAuZjC,WACIrT,EAAKwT,kBAAkB1J,UAAU7sC,IAAI,YACrC,MAAM62C,GAAc,IAAAtU,eAAc,MAAO,yBACzCsU,EAAYvT,aAAY,IAAAf,eAAc,OAAQ,oBAAqBQ,EAAKkT,KAAKzsC,mBAC7E,MAAM4sC,GAAc,IAAA7T,eAAc,MAAO,mBAEzC,OADAsU,EAAYvT,YAAY8S,GACjB,CACHS,cACAT,eA/ZyCiW,GACrCtpB,EAAKqpB,eAAe9oB,YAAYuT,GAChC9T,EAAKqT,YAAcA,EACnBrT,EAAK8T,YAAcA,EAEvB9T,EAAKupB,YAAa,IAAA/pB,eAAc,MAAO,wBACvCQ,EAAKupB,WAAWhpB,YAAY8c,KACvBrd,EAAK2T,gBACN3T,EAAK2T,eAAgB,IAAAnU,eAAc,MAAO,kBAC1CQ,EAAK2T,cAAcsF,UAAY,GAEnCyC,IACA1b,EAAKupB,WAAWhpB,YAAYP,EAAK2T,eACjC3T,EAAKqpB,eAAe9oB,YAAYP,EAAKupB,YACrCP,EAASzoB,YAAYP,EAAKqpB,gBAE1BrpB,EAAKxf,OAAOvY,YACZ+gD,EAASzoB,YAwSjB,WACIP,EAAKwT,kBAAkB1J,UAAU7sC,IAAI,WACjC+iC,EAAKxf,OAAOtY,YACZ83B,EAAKwT,kBAAkB1J,UAAU7sC,IAAI,cACzC,MAAM+N,GAAW,IAAAopC,iBAAgBpU,EAAKxf,QACtCwf,EAAKue,eAAgB,IAAA/e,eAAc,MAAO,kBAC1CQ,EAAKue,cAActF,UAAY,EAC/B,MAAMuQ,GAAY,IAAAhqB,eAAc,OAAQ,2BAA4B,KAC9DiqB,GAAY,IAAA/M,mBAAkB,iBAAkB,CAClD,aAAc1c,EAAKkT,KAAK7rC,gBAE5B24B,EAAKoV,YAAcqU,EAAU5M,qBAAqB,SAAS,GAC3D,MAAM6M,GAAc,IAAAhN,mBAAkB,mBAAoB,CACtD,aAAc1c,EAAKkT,KAAK3rC,kBAyB5B,GAvBAy4B,EAAKsV,cAAgBoU,EAAY7M,qBAAqB,SAAS,GAC/D7c,EAAKoV,YAAY6D,SAAWjZ,EAAKsV,cAAc2D,UAAY,EAC3DjZ,EAAKoV,YAAYl8C,OAAQ,IAAAu8C,KAAIzV,EAAKuU,sBAC5BvU,EAAKuU,sBAAsB6B,WAC3BpW,EAAKxf,OAAOk2B,UACR1rC,EAASwN,MAthBvB,SAAuBlR,GACnB,OAAQA,EAAO,IACX,KAAK,EACL,KAAK,GACD,OAAO,GACX,QACI,OAAOA,EAAO,IAihBZqiD,CAAc3+C,EAASwN,QACjCwnB,EAAKsV,cAAcp8C,OAAQ,IAAAu8C,KAAIzV,EAAKuU,sBAC9BvU,EAAKuU,sBAAsB8B,aAC3BrrC,EAASuN,SACfynB,EAAKoV,YAAYyD,aAAa,OAAQ7Y,EAAKxf,OAAOopC,cAAcxsB,YAChE4C,EAAKsV,cAAcuD,aAAa,OAAQ7Y,EAAKxf,OAAOqpC,gBAAgBzsB,YACpE4C,EAAKoV,YAAYyD,aAAa,MAAO7Y,EAAKxf,OAAOk2B,UAAY,IAAM,KACnE1W,EAAKoV,YAAYyD,aAAa,MAAO7Y,EAAKxf,OAAOk2B,UAAY,KAAO,MACpE1W,EAAKoV,YAAYyD,aAAa,YAAa,KAC3C7Y,EAAKsV,cAAcuD,aAAa,MAAO,KACvC7Y,EAAKsV,cAAcuD,aAAa,MAAO,MACvC7Y,EAAKsV,cAAcuD,aAAa,YAAa,KAC7C7Y,EAAKue,cAAche,YAAYkpB,GAC/BzpB,EAAKue,cAAche,YAAYipB,GAC/BxpB,EAAKue,cAAche,YAAYmpB,GAC3B1pB,EAAKxf,OAAOk2B,WACZ1W,EAAKue,cAAczU,UAAU7sC,IAAI,YACjC+iC,EAAKxf,OAAOsnC,cAAe,CAC3B9nB,EAAKue,cAAczU,UAAU7sC,IAAI,cACjC,MAAM6sD,GAAc,IAAApN,mBAAkB,oBACtC1c,EAAKgW,cAAgB8T,EAAYjN,qBAAqB,SAAS,GAC/D7c,EAAKgW,cAAc98C,OAAQ,IAAAu8C,KAAIzV,EAAKuU,sBAC9BvU,EAAKuU,sBAAsB+B,aAC3BtrC,EAASsN,SACf0nB,EAAKgW,cAAc6C,aAAa,OAAQ7Y,EAAKsV,cAAcR,aAAa,SACxE9U,EAAKgW,cAAc6C,aAAa,MAAO,KACvC7Y,EAAKgW,cAAc6C,aAAa,MAAO,MACvC7Y,EAAKgW,cAAc6C,aAAa,YAAa,KAC7C7Y,EAAKue,cAAche,aAAY,IAAAf,eAAc,OAAQ,2BAA4B,MACjFQ,EAAKue,cAAche,YAAYupB,GAUnC,OARK9pB,EAAKxf,OAAOk2B,YACb1W,EAAKl5B,MAAO,IAAA04B,eAAc,OAAQ,kBAAmBQ,EAAKkT,KAAKpsC,MAAK,IAAAm9B,MAAKjE,EAAKuU,sBACxEvU,EAAKoV,YAAYl8C,MACjB8mC,EAAKxf,OAAOupC,aAAe,MACjC/pB,EAAKl5B,KAAKwH,MAAQ0xB,EAAKkT,KAAKtsC,YAC5Bo5B,EAAKl5B,KAAKmyC,UAAY,EACtBjZ,EAAKue,cAAche,YAAYP,EAAKl5B,OAEjCk5B,EAAKue,cApWayL,KAEzB,IAAAz3B,aAAYyN,EAAKwT,kBAAmB,YAAkC,UAArBxT,EAAKxf,OAAOxY,OAC7D,IAAAuqB,aAAYyN,EAAKwT,kBAAmB,WAAmC,IAAxBxT,EAAKxf,OAAOypC,UAC3D,IAAA13B,aAAYyN,EAAKwT,kBAAmB,aAAcxT,EAAKxf,OAAO8yB,WAAa,GAC3EtT,EAAKwT,kBAAkBjT,YAAYyoB,GACnC,MAAMkB,OAAwCrvD,IAAzBmlC,EAAKxf,OAAOhnB,eACKqB,IAAlCmlC,EAAKxf,OAAOhnB,SAAS2wD,SACzB,IAAInqB,EAAKxf,OAAOu9B,QAAU/d,EAAKxf,OAAO2gC,UAClCnhB,EAAKwT,kBAAkB1J,UAAU7sC,IAAI+iC,EAAKxf,OAAOu9B,OAAS,SAAW,UACjE/d,EAAKxf,OAAOu9B,UACPmM,GAAgBlqB,EAAKhG,QAAQxwB,WAC9Bw2B,EAAKhG,QAAQxwB,WAAWo8C,aAAa5lB,EAAKwT,kBAAmBxT,EAAK4V,OAAOgT,kBAC3C/tD,IAAzBmlC,EAAKxf,OAAOhnB,UACjBwmC,EAAKxf,OAAOhnB,SAAS+mC,YAAYP,EAAKwT,oBAE1CxT,EAAKxf,OAAO2gC,QAAQ,CACpB,MAAM3U,GAAU,IAAAhN,eAAc,MAAO,qBACjCQ,EAAKhG,QAAQxwB,YACbw2B,EAAKhG,QAAQxwB,WAAWo8C,aAAapZ,EAASxM,EAAKhG,SACvDwS,EAAQjM,YAAYP,EAAKhG,SACrBgG,EAAKn7B,UACL2nC,EAAQjM,YAAYP,EAAKn7B,UAC7B2nC,EAAQjM,YAAYP,EAAKwT,mBAG5BxT,EAAKxf,OAAO2gC,QAAWnhB,EAAKxf,OAAOu9B,cACVljD,IAAzBmlC,EAAKxf,OAAOhnB,SACPwmC,EAAKxf,OAAOhnB,SACZoS,OAAOpH,SAAS87B,MAAMC,YAAYP,EAAKwT,mBA3T7CzpB,GAkKR,WAMI,GALIiW,EAAKxf,OAAO6+B,MACZ,CAAC,OAAQ,QAAS,SAAU,SAASr9C,SAASooD,IAC1C5+C,MAAML,UAAUnJ,QAAQogD,KAAKpiB,EAAKhG,QAAQ0R,iBAAiB,SAAS0e,OAAUrT,GAAO91B,EAAK81B,EAAI,QAAS/W,EAAKoqB,SAGhHpqB,EAAKyW,SAEL,YA29CR,WACI,MAAM4T,EAAYrqB,EAAKxf,OAAOvY,WACxB+3B,EAAKxf,OAAOtY,WACR,OACA,iBACJ,OACN83B,EAAKwlB,aAAc,IAAAhmB,eAAc,QAASQ,EAAK7Y,MAAM6wB,UAAY,qBACjEhY,EAAKwlB,YAAYvM,SAAW,EAC5BjZ,EAAKwlB,YAAY30D,KAAOw5D,EACxBrqB,EAAKwlB,YAAY1I,SAAW9c,EAAK7Y,MAAM21B,SACvC9c,EAAKwlB,YAAY5mD,SAAWohC,EAAK7Y,MAAMvoB,SACvCohC,EAAKwlB,YAAY1qD,YAAcklC,EAAK7Y,MAAMrsB,YAC1CklC,EAAKknB,gBACa,mBAAdmD,EACM,gBACc,SAAdA,EACI,QACA,QACVrqB,EAAKt4B,cAAchG,OAAS,IAC5Bs+B,EAAKwlB,YAAYhtD,aAAewnC,EAAKwlB,YAAYtsD,MAAQ8mC,EAAK8Y,WAAW9Y,EAAKt4B,cAAc,GAAIs4B,EAAKknB,kBAErGlnB,EAAKxf,OAAOriB,UACZ6hC,EAAKwlB,YAAY5Q,IAAM5U,EAAK8Y,WAAW9Y,EAAKxf,OAAOriB,QAAS,UAC5D6hC,EAAKxf,OAAOpiB,UACZ4hC,EAAKwlB,YAAYzQ,IAAM/U,EAAK8Y,WAAW9Y,EAAKxf,OAAOpiB,QAAS,UAC5D4hC,EAAK7Y,MAAM2tB,aAAa,UACxB9U,EAAKwlB,YAAYz4B,KAAOu9B,OAAOtqB,EAAK7Y,MAAM2tB,aAAa,UAC3D9U,EAAK7Y,MAAMt2B,KAAO,cACIgK,IAAlBmlC,EAAKn7B,WACLm7B,EAAKn7B,SAAShU,KAAO,UACzB,IACQmvC,EAAK7Y,MAAM3d,YACXw2B,EAAK7Y,MAAM3d,WAAWo8C,aAAa5lB,EAAKwlB,YAAaxlB,EAAK7Y,MAAMyhC,aAExE,MAAOhK,IACP39B,EAAK+e,EAAKwlB,YAAa,UAAW9rD,IAC9BsmC,EAAKmf,SAAQ,IAAAzK,gBAAeh7C,GAAGR,OAAO,EAAO8mC,EAAKknB,iBAClDjQ,EAAa,YACbA,EAAa,cAlgDbsT,GAGJ,MAAMC,GAAkB,IAAA//C,UAASy2C,EAAU,IAwB3C,GAvBAlhB,EAAK+V,kBAAmB,IAAAtrC,UAAS/H,EAzNb,KA0NhBs9B,EAAK2T,gBAAkB,oBAAoBpX,KAAKkoB,UAAUC,YAC1DzjC,EAAK+e,EAAK2T,cAAe,aAAcj6C,IACV,UAArBsmC,EAAKxf,OAAOxY,MACZyxC,GAAY,IAAA/E,gBAAeh7C,OAEvCunB,EAAKrV,OAAOpH,SAAS87B,KAAM,UAAW8e,GACjCpf,EAAKxf,OAAOu9B,QAAW/d,EAAKxf,OAAO2gC,QACpClgC,EAAKrV,OAAQ,SAAU4+C,QACC3vD,IAAxB+Q,OAAO6+C,aACPxpC,EAAKrV,OAAOpH,SAAU,aAAcs5C,GAEpC78B,EAAKrV,OAAOpH,SAAU,YAAas5C,GACvC78B,EAAKrV,OAAOpH,SAAU,QAASs5C,EAAe,CAAE4M,SAAS,KAC1B,IAA3B1qB,EAAKxf,OAAO1b,aACZmc,EAAK+e,EAAK4V,OAAQ,QAAS5V,EAAK52B,MAChC6X,EAAK+e,EAAK4V,OAAQ,QAAS5V,EAAK52B,YAETvO,IAAvBmlC,EAAK2T,gBACL1yB,EAAK+e,EAAKgd,SAAU,QAASmK,IAC7BlmC,EAAK+e,EAAKgd,SAAU,CAAC,QAAS,aAAcrG,GAC5C11B,EAAK+e,EAAK2T,cAAe,QAASgM,SAEX9kD,IAAvBmlC,EAAKue,oBACkB1jD,IAAvBmlC,EAAKsV,oBACgBz6C,IAArBmlC,EAAKoV,YAA2B,CAChC,MAAMuV,EAAWjxD,IAAM,IAAAg7C,gBAAeh7C,GAAGS,SACzC8mB,EAAK+e,EAAKue,cAAe,CAAC,aAAcvK,GACxC/yB,EAAK+e,EAAKue,cAAe,OAAQvK,EAAY,CAAE0W,SAAS,IACxDzpC,EAAK+e,EAAKue,cAAe,QAASxG,GAClC92B,EAAK,CAAC+e,EAAKoV,YAAapV,EAAKsV,eAAgB,CAAC,QAAS,SAAUqV,QACtC9vD,IAAvBmlC,EAAKgW,eACL/0B,EAAK+e,EAAKgW,cAAe,SAAS,IAAMhW,EAAKgW,eAAiBhW,EAAKgW,cAAc77C,gBACnEU,IAAdmlC,EAAKl5B,MACLma,EAAK+e,EAAKl5B,KAAM,SAAUpN,IACtBs6C,EAAWt6C,GACXgJ,OAIRs9B,EAAKxf,OAAO7b,YACZsc,EAAK+e,EAAK4V,OAAQ,OAAQsJ,GArN9B0L,IACI5qB,EAAKt4B,cAAchG,QAAUs+B,EAAKxf,OAAOtY,cACrC83B,EAAKxf,OAAOvY,YACZsuC,EAAiBvW,EAAKxf,OAAOtY,WAAa83B,EAAKuU,2BAAwB15C,GAE3Ei7C,IAAY,IAEhB1C,IACA,MAAMyX,EAAW,iCAAiCtuB,KAAKkoB,UAAUC,YAC5D1kB,EAAKyW,UAAYoU,GAClBzJ,IAEJnK,EAAa,WA+yDjB6T,GACO9qB,EAEX,SAAS+qB,EAAWC,EAAUxqC,GAC1B,MAAMyqC,EAAQz/C,MAAML,UAAUM,MACzB22C,KAAK4I,GACL35D,QAAQ0tC,GAAMA,aAAamsB,cAC1BC,EAAY,GAClB,IAAK,IAAIrsB,EAAI,EAAGA,EAAImsB,EAAMvpD,OAAQo9B,IAAK,CACnC,MAAMssB,EAAOH,EAAMnsB,GACnB,IACI,GAA0C,OAAtCssB,EAAKtW,aAAa,gBAClB,cACoBj6C,IAApBuwD,EAAKL,aACLK,EAAKL,WAAWlhD,UAChBuhD,EAAKL,gBAAalwD,GAEtBuwD,EAAKL,WAAahY,EAAkBqY,EAAM5qC,GAAU,IACpD2qC,EAAUppD,KAAKqpD,EAAKL,YAExB,MAAOrxD,GACHjJ,QAAQiM,MAAMhD,IAGtB,OAA4B,IAArByxD,EAAUzpD,OAAeypD,EAAU,GAAKA,E,0DAExB,oBAAhBD,aACmB,oBAAnBG,gBACa,oBAAbC,WACPD,eAAelgD,UAAU/C,UAAYkjD,SAASngD,UAAU/C,UAAY,SAAUoY,GAC1E,OAAOuqC,EAAWt4D,KAAM+tB,IAE5B0qC,YAAY//C,UAAU/C,UAAY,SAAUoY,GACxC,OAAOuqC,EAAW,CAACt4D,MAAO+tB,KAGlC,IAAIpY,EAAY,SAAUmjD,EAAU/qC,GAChC,MAAwB,iBAAb+qC,EACAR,EAAWn/C,OAAOpH,SAASknC,iBAAiB6f,GAAW/qC,GAEzD+qC,aAAoBC,KAClBT,EAAW,CAACQ,GAAW/qC,GAGvBuqC,EAAWQ,EAAU/qC,IAGpCpY,EAAU6qC,cAAgB,GAC1B7qC,EAAUu5C,MAAQ,CACd8J,GAAI15C,OAAOkmB,OAAO,GAAI,WACtB4pB,QAAS9vC,OAAOkmB,OAAO,GAAI,YAE/B7vB,EAAUsjD,SAAYxY,IAClB9qC,EAAUu5C,MAAME,QAAU9vC,OAAOkmB,OAAOlmB,OAAOkmB,OAAO,GAAI7vB,EAAUu5C,MAAME,SAAU3O,IAExF9qC,EAAUujD,YAAenrC,IACrBpY,EAAU6qC,cAAgBlhC,OAAOkmB,OAAOlmB,OAAOkmB,OAAO,GAAI7vB,EAAU6qC,eAAgBzyB,IAExFpY,EAAUivC,WAAY,IAAA2K,kBAAiB,IACvC55C,EAAU0wC,YAAa,IAAAiJ,qBAAoB,IAC3C35C,EAAU8rC,aAAe,EAAAA,aACH,oBAAXroC,aAA+C,IAAdA,OAAOjB,KAC/CiB,OAAOjB,GAAGxC,UAAY,SAAUoY,GAC5B,OAAOuqC,EAAWt4D,KAAM+tB,KAGhC5J,KAAKzL,UAAUygD,QAAU,SAAUnzC,GAC/B,OAAO,IAAI7B,KAAKnkB,KAAKilD,cAAejlD,KAAKklD,WAAYllD,KAAKkmD,WAA6B,iBAATlgC,EAAoB1U,SAAS0U,EAAM,IAAMA,KAErG,oBAAX7M,SACPA,OAAOxD,UAAYA,GAEvB,W,uHCv7DO,MAAMyjD,EAAU,CACnB7mD,SAAU,CACNC,UAAW,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OACtDQ,SAAU,CACN,SACA,SACA,UACA,YACA,WACA,SACA,aAGRC,OAAQ,CACJT,UAAW,CACP,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OAEJQ,SAAU,CACN,UACA,WACA,QACA,QACA,MACA,OACA,OACA,SACA,YACA,UACA,WACA,aAGRy1C,YAAa,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAC1D10C,eAAgB,EAChBslD,QAAUC,IACN,MAAMC,EAAID,EAAM,IAChB,GAAIC,EAAI,GAAKA,EAAI,GACb,MAAO,KACX,OAAQA,EAAI,IACR,KAAK,EACD,MAAO,KACX,KAAK,EACD,MAAO,KACX,KAAK,EACD,MAAO,KACX,QACI,MAAO,OAGnBzlD,eAAgB,OAChBE,iBAAkB,KAClBC,YAAa,sBACbE,YAAa,kBACbE,KAAM,CAAC,KAAM,MACbG,cAAe,OACfE,eAAgB,QAChBE,cAAe,OACfE,gBAAiB,SACjBmvC,WAAW,GAEf,K,uHCvEO,MAAM0P,EAAQ,CACjB,WACA,UACA,cACA,YACA,YACA,gBACA,SACA,gBACA,UACA,gBACA,eACA,yBAESp7C,EAAW,CACpB28C,SAAU,GACVhjD,YAAY,EACZ+hD,qBAAqB,EACrB3+C,UAAW,SACXlD,UAAU,EACV4jD,cAAe,qBACfwB,QAA2B,iBAAXr+C,SACoC,IAAhDA,OAAO64C,UAAUC,UAAUzM,QAAQ,QACvCc,eAAgB,SAChBkT,qBAAqB,EACrBnnD,YAAY,EACZmgD,eAAe,EACfwB,YAAa,KACb1oD,WAAY,QACZgsD,YAAa,GACbmC,cAAe,EACfC,eAAgB,EAChBrN,QAAS,GACTwJ,eAAe,EACfR,eAAe,EACf7/C,YAAY,EACZ2vC,aAAekM,GAA2B,oBAAZrzD,SAA2BA,QAAQ27D,KAAKtI,GACtExK,QAAU+S,IACN,MAAMnuD,EAAO,IAAI0Y,KAAKy1C,EAAUlY,WAChCj2C,EAAKm2C,SAAS,EAAG,EAAG,EAAG,GACvBn2C,EAAKihD,QAAQjhD,EAAKy6C,UAAY,GAAMz6C,EAAK48C,SAAW,GAAK,GACzD,IAAIwR,EAAQ,IAAI11C,KAAK1Y,EAAKw5C,cAAe,EAAG,GAC5C,OAAQ,EACJrZ,KAAKkuB,QAAQruD,EAAKi2C,UAAYmY,EAAMnY,WAAa,MAC7C,GACEmY,EAAMxR,SAAW,GAAK,GACxB,IAEZ8O,cAAe,EACftL,qBAAsB,GACtBP,QAAQ,EACRh5C,OAAQ,UACR8kD,gBAAiB,EACjB7hD,KAAM,SACN+zC,kBAAmB,WACnBmN,UAAW,yOACXhhD,YAAY,EACZ43B,IAAK,IAAIlpB,KACTnZ,SAAU,GACV+uD,QAAS,GACTC,YAAa,GACbC,UAAW,GACXtN,UAAW,GACXuN,cAAe,GACfC,OAAQ,GACRC,cAAe,GACfplD,QAAS,GACTqlD,cAAe,GACfC,aAAc,GACdC,sBAAuB,GACvBzE,QAAS,GACTz6C,SAAU,OACVlJ,qBAAiB/J,EACjBouD,UAAW,uOACX9M,uBAAuB,EACvB7I,WAAY,EACZ6N,QAAQ,EACRzK,WAAW,EACXrD,aAAa,EACbgM,MAAM,I,0ZC5EH,MAAM0C,EAAsB,EAAGvhC,SAAS,EAAAxV,SAAUkoC,OAAO,EAAA2Y,QAASpV,YAAW,KAAa,CAACD,EAASyW,EAAMC,KAC7G,MAAMnoD,EAASmoD,GAAkBha,EACjC,YAA0Br4C,IAAtB2lB,EAAOs4B,YAA6BrC,EAGjCwW,EACFrgC,MAAM,IACNzrB,KAAI,CAAC64C,EAAGlb,EAAG8nB,IAAQ,EAAAY,QAAQxN,IAAqB,OAAf4M,EAAI9nB,EAAI,GACxC,EAAA0oB,QAAQxN,GAAGxD,EAASzxC,EAAQyb,GACtB,OAANw5B,EACIA,EACA,KACLr8C,KAAK,IATC6iB,EAAOs4B,WAAWtC,EAASyW,EAAMloD,IAWnCi9C,EAAmB,EAAGxhC,SAAS,EAAAxV,SAAUkoC,OAAO,EAAA2Y,WAAc,CAAC3tD,EAAMivD,EAAaxO,EAAUyO,KACrG,GAAa,IAATlvD,IAAeA,EACf,OACJ,MAAM6G,EAASqoD,GAAgBla,EAC/B,IAAIma,EACJ,MAAMC,EAAWpvD,EACjB,GAAIA,aAAgB0Y,KAChBy2C,EAAa,IAAIz2C,KAAK1Y,EAAKi2C,gBAC1B,GAAoB,iBAATj2C,QACKrD,IAAjBqD,EAAKqvD,QACLF,EAAa,IAAIz2C,KAAK1Y,QACrB,GAAoB,iBAATA,EAAmB,CAC/B,MAAMD,EAASkvD,IAAgB3sC,GAAU,EAAAxV,UAAUjN,WAC7CyvD,EAAUlD,OAAOpsD,GAAM0D,OAC7B,GAAgB,UAAZ4rD,EACAH,EAAa,IAAIz2C,KACjB+nC,GAAW,OAEV,GAAI,KAAKpiB,KAAKixB,IACf,OAAOjxB,KAAKixB,GACZH,EAAa,IAAIz2C,KAAK1Y,QACrB,GAAIsiB,GAAUA,EAAO62B,UACtBgW,EAAa7sC,EAAO62B,UAAUn5C,EAAMD,OACnC,CACDovD,EACK7sC,GAAWA,EAAOtY,WAEb,IAAI0O,MAAK,IAAIA,MAAOy9B,SAAS,EAAG,EAAG,EAAG,IADtC,IAAIz9B,MAAK,IAAIA,MAAO8gC,cAAe,EAAG,EAAG,EAAG,EAAG,EAAG,GAE5D,IAAI+V,EAASC,EAAM,GACnB,IAAK,IAAI5uB,EAAI,EAAG6uB,EAAa,EAAGC,EAAW,GAAI9uB,EAAI7gC,EAAOyD,OAAQo9B,IAAK,CACnE,MAAM9jB,EAAQ/c,EAAO6gC,GACf+uB,EAAwB,OAAV7yC,EACd8yC,EAA4B,OAAlB7vD,EAAO6gC,EAAI,IAAe+uB,EAC1C,GAAI,EAAA/L,WAAW9mC,KAAW8yC,EAAS,CAC/BF,GAAY,EAAA9L,WAAW9mC,GACvB,MAAMigB,EAAQ,IAAIE,OAAOyyB,GAAU3xB,KAAK/9B,GACpC+8B,IAAUwyB,GAAU,IACpBC,EAAc,MAAV1yC,EAAgB,OAAS,WAAW,CACpCpQ,GAAI,EAAAmjD,UAAU/yC,GACdvhB,IAAKwhC,IAAQ0yB,UAIfE,IACND,GAAY,KAChBF,EAAI1rD,SAAQ,EAAG4I,KAAInR,SAAW4zD,EAAaziD,EAAGyiD,EAAY5zD,EAAKsL,IAAWsoD,IAE9EA,EAAaI,EAAUJ,OAAaxyD,GAG5C,GAAMwyD,aAAsBz2C,OAASo3C,MAAMX,EAAWlZ,WAMtD,OAFiB,IAAbwK,GACA0O,EAAWhZ,SAAS,EAAG,EAAG,EAAG,GAC1BgZ,EALH7sC,EAAOo3B,aAAa,IAAIgK,MAAM,0BAA0B0L,OAOzD,SAASpZ,EAAa+Z,EAAOC,EAAOvP,GAAW,GAClD,OAAiB,IAAbA,EACQ,IAAI/nC,KAAKq3C,EAAM9Z,WAAWE,SAAS,EAAG,EAAG,EAAG,GAChD,IAAIz9B,KAAKs3C,EAAM/Z,WAAWE,SAAS,EAAG,EAAG,EAAG,GAE7C4Z,EAAM9Z,UAAY+Z,EAAM/Z,UAE5B,SAASga,EAAaF,EAAOC,GAChC,OAAQ,MAAQD,EAAM7X,WAAa8X,EAAM9X,YACrC,IAAM6X,EAAM5X,aAAe6X,EAAM7X,cACjC4X,EAAM3X,aACN4X,EAAM5X,aAEP,MAAM2K,EAAY,CAACmN,EAAIC,EAAKC,IACxBF,EAAK/vB,KAAKuW,IAAIyZ,EAAKC,IAAQF,EAAK/vB,KAAK0W,IAAIsZ,EAAKC,GAE5C1N,EAAW,CACpB2N,IAAK,OAEF,SAASna,EAAgB5zB,GAC5B,IAAIhI,EAAQgI,EAAOupC,YACfxxC,EAAUiI,EAAO0rC,cACjB5zC,EAAUkI,EAAO2rC,eACrB,QAAuBtxD,IAAnB2lB,EAAOriB,QAAuB,CAC9B,MAAMqwD,EAAUhuC,EAAOriB,QAAQi4C,WACzBqY,EAAajuC,EAAOriB,QAAQk4C,aAC5BqY,EAAaluC,EAAOriB,QAAQm4C,aAC9B99B,EAAQg2C,IACRh2C,EAAQg2C,GAERh2C,IAAUg2C,GAAWj2C,EAAUk2C,IAC/Bl2C,EAAUk2C,GAEVj2C,IAAUg2C,GAAWj2C,IAAYk2C,GAAcn2C,EAAUo2C,IACzDp2C,EAAUkI,EAAOriB,QAAQm4C,cAEjC,QAAuBz7C,IAAnB2lB,EAAOpiB,QAAuB,CAC9B,MAAMuwD,EAAQnuC,EAAOpiB,QAAQg4C,WACvBwY,EAAapuC,EAAOpiB,QAAQi4C,aAClC79B,EAAQ6lB,KAAKuW,IAAIp8B,EAAOm2C,GACpBn2C,IAAUm2C,IACVp2C,EAAU8lB,KAAKuW,IAAIga,EAAYr2C,IAC/BC,IAAUm2C,GAASp2C,IAAYq2C,IAC/Bt2C,EAAUkI,EAAOpiB,QAAQk4C,cAEjC,MAAO,CAAE99B,QAAOD,UAASD,a,wECxHtB,SAASia,EAAYsrB,EAAM7F,EAAW+G,GACzC,IAAa,IAATA,EACA,OAAOlB,EAAK/T,UAAU7sC,IAAI+6C,GAC9B6F,EAAK/T,UAAU5/B,OAAO8tC,GAEnB,SAASxY,EAAc/iB,EAAKu7B,EAAWnjC,GAC1C,MAAMnb,EAAIkS,OAAOpH,SAASg7B,cAAc/iB,GAMxC,OALAu7B,EAAYA,GAAa,GACzBnjC,EAAUA,GAAW,GACrBnb,EAAEs+C,UAAYA,OACEn9C,IAAZga,IACAnb,EAAEi7C,YAAc9/B,GACbnb,EAEJ,SAASiiD,EAAUyP,GACtB,KAAOA,EAAKjT,YACRiT,EAAK3hD,YAAY2hD,EAAKjT,YAEvB,SAASyM,EAAWwG,EAAMyD,GAC7B,OAAIA,EAAUzD,GACHA,EACFA,EAAK5hD,WACHo7C,EAAWwG,EAAK5hD,WAAYqlD,QADlC,EAIF,SAASnS,EAAkBoS,EAAgBC,GAC9C,MAAMviB,EAAUhN,EAAc,MAAO,mBAAoBwvB,EAAWxvB,EAAc,QAAS,YAAcsvB,GAAiBG,EAAUzvB,EAAc,OAAQ,WAAY0vB,EAAY1vB,EAAc,OAAQ,aAQxM,IAPiD,IAA7CilB,UAAUC,UAAUzM,QAAQ,YAC5B+W,EAASn+D,KAAO,UAGhBm+D,EAASn+D,KAAO,OAChBm+D,EAASG,QAAU,aAEVt0D,IAATk0D,EACA,IAAK,MAAMj8D,KAAOi8D,EACdC,EAASnW,aAAa/lD,EAAKi8D,EAAKj8D,IAIxC,OAHA05C,EAAQjM,YAAYyuB,GACpBxiB,EAAQjM,YAAY0uB,GACpBziB,EAAQjM,YAAY2uB,GACb1iB,EAEJ,SAASkI,EAAen5C,GAC3B,IACI,MAAkC,mBAAvBA,EAAM6zD,aACA7zD,EAAM6zD,eACP,GAET7zD,EAAM8e,OAEjB,MAAO3d,GACH,OAAOnB,EAAM8e,Q,gWClDrB,MAAM2X,EAAY,OACLkqB,EAAa,CAACmT,EAAapqD,EAAWF,IAAWA,EAAOW,OAAOT,EAAY,YAAc,YAAYoqD,GACrGtB,EAAY,CACrBuB,EAAGt9B,EACHu9B,EAAG,SAAU/Y,EAASgZ,EAAWzqD,GAC7ByxC,EAAQsF,SAAS/2C,EAAOW,OAAOD,SAASwyC,QAAQuX,KAEpDC,EAAG,CAACjZ,EAASlvC,KACTkvC,EAAQnC,SAASQ,WAAWvtC,KAEhCooD,EAAG,CAAClZ,EAASlvC,KACTkvC,EAAQnC,SAASQ,WAAWvtC,KAEhCqoD,EAAG,CAACnZ,EAASqO,KACTrO,EAAQ2I,QAAQtK,WAAWgQ,KAE/B+K,EAAG,CAACpZ,EAAS1vC,EAAM/B,KACfyxC,EAAQnC,SAAUmC,EAAQJ,WAAa,GACnC,IAAK,IAAAnS,KAAI,IAAI9I,OAAOp2B,EAAO+B,KAAK,GAAI,KAAKy1B,KAAKz1B,MAEtD+oD,EAAG,SAAUrZ,EAASsZ,EAAY/qD,GAC9ByxC,EAAQsF,SAAS/2C,EAAOW,OAAOT,UAAUgzC,QAAQ6X,KAErDC,EAAG,CAACvZ,EAASl+B,KACTk+B,EAAQwZ,WAAWnb,WAAWv8B,KAElC23C,EAAG,CAAClK,EAAGmK,IAAgB,IAAIt5C,KAA+B,IAA1Bi+B,WAAWqb,IAC3CC,EAAG,SAAU3Z,EAAS4Z,EAASrrD,GAC3B,MAAMsrD,EAAatsD,SAASqsD,GACtBlyD,EAAO,IAAI0Y,KAAK4/B,EAAQkB,cAAe,EAAG,EAAuB,GAAlB2Y,EAAa,GAAQ,EAAG,EAAG,EAAG,GAEnF,OADAnyD,EAAKihD,QAAQjhD,EAAKy6C,UAAYz6C,EAAK48C,SAAW/1C,EAAOyB,gBAC9CtI,GAEXoyD,EAAG,CAAC9Z,EAAStvC,KACTsvC,EAAQ+Z,YAAY1b,WAAW3tC,KAEnCspD,EAAG,CAACzK,EAAG0K,IAAY,IAAI75C,KAAK65C,GAC5B5U,EAAG,CAACrF,EAASqO,KACTrO,EAAQ2I,QAAQtK,WAAWgQ,KAE/B6L,EAAG,CAACla,EAASlvC,KACTkvC,EAAQnC,SAASQ,WAAWvtC,KAEhCw3B,EAAG,CAAC0X,EAASj+B,KACTi+B,EAAQma,WAAW9b,WAAWt8B,KAElCq4C,EAAG,CAACpa,EAASqO,KACTrO,EAAQ2I,QAAQtK,WAAWgQ,KAE/BhE,EAAG7uB,EACH6nB,EAAG,CAACrD,EAASpvC,KACTovC,EAAQsF,SAASjH,WAAWztC,GAAS,IAEzCypD,EAAG,CAACra,EAASpvC,KACTovC,EAAQsF,SAASjH,WAAWztC,GAAS,IAEzC4kD,EAAG,CAACxV,EAASl+B,KACTk+B,EAAQwZ,WAAWnb,WAAWv8B,KAElCw4C,EAAG,CAAC/K,EAAGgL,IAAoB,IAAIn6C,KAAKi+B,WAAWkc,IAC/CC,EAAGh/B,EACHi/B,EAAG,CAACza,EAAStvC,KACTsvC,EAAQ+Z,YAAY,IAAO1b,WAAW3tC,MAGjC46C,EAAa,CACtBwN,EAAG,SACHC,EAAG,SACHE,EAAG,eACHC,EAAG,eACHC,EAAG,mBACHC,EAAG,GACHC,EAAG,SACHE,EAAG,eACHE,EAAG,OACHE,EAAG,eACHG,EAAG,WACHE,EAAG,OACH3U,EAAG,eACH6U,EAAG,eACH5xB,EAAG,eACH8xB,EAAG,eACH/P,EAAG,SACHhH,EAAG,eACHgX,EAAG,eACH7E,EAAG,eACH8E,EAAG,OACHE,EAAG,eACHC,EAAG,YAEMzJ,EAAU,CACnBgJ,EAAItyD,GAASA,EAAKgzD,cAClB5B,EAAG,SAAUpxD,EAAM6G,EAAQ/L,GACvB,OAAO+L,EAAOC,SAASC,UAAUuiD,EAAQwJ,EAAE9yD,EAAM6G,EAAQ/L,KAE7Du2D,EAAG,SAAUrxD,EAAM6G,EAAQ/L,GACvB,OAAOkjD,EAAWsL,EAAQqJ,EAAE3yD,EAAM6G,EAAQ/L,GAAW,GAAG,EAAO+L,IAEnE0qD,EAAG,SAAUvxD,EAAM6G,EAAQ/L,GACvB,OAAO,IAAAy8C,KAAI+R,EAAQkJ,EAAExyD,EAAM6G,EAAQ/L,KAEvC02D,EAAIxxD,IAAS,IAAAu3C,KAAIv3C,EAAKk4C,YACtBuZ,EAAG,SAAUzxD,EAAM6G,GACf,YAA0BlK,IAAnBkK,EAAO+mD,QACR5tD,EAAKy6C,UAAY5zC,EAAO+mD,QAAQ5tD,EAAKy6C,WACrCz6C,EAAKy6C,WAEfiX,EAAG,CAAC1xD,EAAM6G,IAAWA,EAAO+B,MAAK,IAAAm9B,KAAI/lC,EAAKk4C,WAAa,KACvDyZ,EAAG,SAAU3xD,EAAM6G,GACf,OAAOm3C,EAAWh+C,EAAKy5C,YAAY,EAAM5yC,IAE7CgrD,EAAI7xD,IAAS,IAAAu3C,KAAIv3C,EAAKo4C,cACtB2Z,EAAI/xD,GAASA,EAAKi2C,UAAY,IAC9Bgc,EAAG,SAAUjyD,EAAM6nD,EAAG/sD,GAClB,OAAOA,EAAQsgD,QAAQp7C,IAE3BoyD,EAAIpyD,IAAS,IAAAu3C,KAAIv3C,EAAKw5C,cAAe,GACrCmE,EAAI39C,IAAS,IAAAu3C,KAAIv3C,EAAKy6C,WACtB+X,EAAIxyD,GAAUA,EAAKk4C,WAAa,GAAKl4C,EAAKk4C,WAAa,GAAK,GAC5DtX,EAAI5gC,IAAS,IAAAu3C,KAAIv3C,EAAKm4C,cACtBua,EAAI1yD,GAASA,EAAKy6C,UAClBkI,EAAG,SAAU3iD,EAAM6G,GACf,OAAOA,EAAOC,SAASS,SAASvH,EAAK48C,WAEzCjB,EAAI37C,IAAS,IAAAu3C,KAAIv3C,EAAKy5C,WAAa,GACnCkZ,EAAI3yD,GAASA,EAAKy5C,WAAa,EAC/BqU,EAAI9tD,GAASA,EAAKo4C,aAClBwa,EAAI5yD,GAASA,EAAKi2C,UAClB6c,EAAI9yD,GAASA,EAAK48C,SAClBmW,EAAI/yD,GAASosD,OAAOpsD,EAAKw5C,eAAelZ,UAAU,K,4IClI/C,MAAMiX,EAAM,CAAC0b,EAAQzvD,EAAS,IAAM,MAAMyvD,IAAS1lD,OAAgB,EAAV/J,GACnDuiC,EAAO8a,IAAmB,IAATA,EAAgB,EAAI,EAC3C,SAASt0C,EAASG,EAAIwmD,GACzB,IAAIzQ,EACJ,OAAO,WACHthD,aAAashD,GACbA,EAAIrhD,YAAW,IAAMsL,EAAGW,MAAM9Y,KAAMiZ,YAAY0lD,IAGjD,MAAM/K,EAAYgL,GAAQA,aAAe7lD,MAAQ6lD,EAAM,CAACA,I,yECRlC,mBAAlBt/C,OAAOkmB,SACdlmB,OAAOkmB,OAAS,SAAU5d,KAAW0lB,GACjC,IAAK1lB,EACD,MAAMi3C,UAAU,8CAEpB,IAAK,MAAM3jC,KAAUoS,EACbpS,GACA5b,OAAOqM,KAAKuP,GAAQ3rB,SAASlP,GAASunB,EAAOvnB,GAAO66B,EAAO76B,KAGnE,OAAOunB,K,0ECMf,SAASk3C,EAAQv3B,EAASlnC,EAAKoG,GAC3B,QAAc2B,IAAV3B,EACA,OAAO8gC,GAAWA,EAAQw3B,KAAOx3B,EAAQw3B,IAAI7tD,MAAQq2B,EAAQw3B,IAAI7tD,KAAK7Q,GAGtEknC,EAAQw3B,IAAMx3B,EAAQw3B,KAAO,GAC7Bx3B,EAAQw3B,IAAI7tD,KAAOq2B,EAAQw3B,IAAI7tD,MAAQ,GACvCq2B,EAAQw3B,IAAI7tD,KAAK7Q,GAAOoG,EAoBhC,IAAI7H,EAAS,SAAW45D,EAAOM,GAC3B,KAAMN,aAAiBK,UAAYL,aAAiBI,gBAAkBJ,aAAiBz/C,OACnF,MAAM,IAAIo2C,MAAM,gFAEpB,MAAwB,iBAAb2J,EACA//C,MAAM49B,KAAK6hB,GAEfz/C,MAAM49B,KAAK6hB,GAAO55D,QAAO,SAAU0D,GAAQ,OAAyB,IAAlBA,EAAKo1D,UAAkBp1D,EAAK48B,QAAQ45B,OAK7FkG,EAAS,IAAIC,IAMbC,EAAuB,WACvB,SAASA,IACLl/D,KAAKm/D,QAAU,IAAIF,IACnBj/D,KAAKo/D,kBAAeh3D,EACpBpI,KAAKq/D,MAAQ,IAAIJ,IAyHrB,OAvHA3/C,OAAO01C,eAAekK,EAAMxmD,UAAW,SAAU,CAM7ClB,IAAK,WAED,IAAIuW,EAAS,GAKb,OAJA/tB,KAAKm/D,QAAQ5vD,SAAQ,SAAU9I,EAAOpG,GAClC0tB,EAAO1tB,GAAOoG,KAGXsnB,GAOX0lC,IAAK,SAAU1lC,GACX,GAAsB,iBAAXA,EACP,MAAM,IAAIohC,MAAM,uEAGpB,IAAImQ,EAAehgD,OAAOkmB,OAAO,GAAIzX,GAErC/tB,KAAKm/D,QAAU,IAAIF,IAAI3/C,OAAOC,QAAQ+/C,KAE1CC,YAAY,EACZC,cAAc,IASlBN,EAAMxmD,UAAU+mD,UAAY,SAAUp/D,EAAKoG,GACvC,IAAKzG,KAAKm/D,QAAQt3C,IAAIxnB,GAClB,MAAM,IAAI8uD,MAAM,6CAA+C9uD,GAGnEL,KAAKm/D,QAAQ1L,IAAIpzD,EAAKoG,IAQ1By4D,EAAMxmD,UAAUgnD,UAAY,SAAUr/D,GAClC,IAAKL,KAAKm/D,QAAQt3C,IAAIxnB,GAClB,MAAM,IAAI8uD,MAAM,yCAA2C9uD,GAE/D,OAAOL,KAAKm/D,QAAQ3nD,IAAInX,IAE5Bif,OAAO01C,eAAekK,EAAMxmD,UAAW,cAAe,CAMlDlB,IAAK,WACD,OAAOxX,KAAKo/D,cAQhB3L,IAAK,SAAUprD,GACX,KAAMA,aAAuBowD,cAAgC,OAAhBpwD,EACzC,MAAM,IAAI8mD,MAAM,kDAEpBnvD,KAAKo/D,aAAe/2D,GAExBk3D,YAAY,EACZC,cAAc,IASlBN,EAAMxmD,UAAUo9B,QAAU,SAAUz1C,EAAKoG,GACrC,GAAmB,iBAARpG,EACP,MAAM,IAAI8uD,MAAM,6BAEpBnvD,KAAKq/D,MAAM5L,IAAIpzD,EAAKoG,IAQxBy4D,EAAMxmD,UAAU0gC,QAAU,SAAU/4C,GAChC,GAAmB,iBAARA,EACP,MAAM,IAAI8uD,MAAM,6BAEpB,OAAOnvD,KAAKq/D,MAAM7nD,IAAInX,IAQ1B6+D,EAAMxmD,UAAUinD,WAAa,SAAUt/D,GACnC,GAAmB,iBAARA,EACP,MAAM,IAAI8uD,MAAM,6BAEpB,OAAOnvD,KAAKq/D,MAAMO,OAAOv/D,IAEtB6+D,EA7He,GAmItBW,EAAQ,SAAWC,GAEnB,KAAMA,aAA2BrH,aAC7B,MAAM,IAAItJ,MAAM,oDAOpB,OAJK6P,EAAOn3C,IAAIi4C,IACZd,EAAOvL,IAAIqM,EAAiB,IAAIZ,GAG7BF,EAAOxnD,IAAIsoD,IAQtB,SAAS1oB,EAAiB7P,EAASw4B,EAAWhxC,GAC1C,GAAIwY,aAAmBxuB,MACnB,IAAK,IAAIszB,EAAI,EAAGA,EAAI9E,EAAQt4B,SAAUo9B,EAClC+K,EAAiB7P,EAAQ8E,GAAI0zB,EAAWhxC,QAIhDwY,EAAQ6P,iBAAiB2oB,EAAWhxC,GACpC8wC,EAAMt4B,GAASuO,QAAQ,QAAUiqB,EAAWhxC,GAMhD,SAASyoB,EAAoBjQ,EAASw4B,GAClC,GAAIx4B,aAAmBxuB,MACnB,IAAK,IAAIszB,EAAI,EAAGA,EAAI9E,EAAQt4B,SAAUo9B,EAClCmL,EAAoBjQ,EAAQ8E,GAAI0zB,QAIxCx4B,EAAQiQ,oBAAoBuoB,EAAWF,EAAMt4B,GAAS6R,QAAQ,QAAU2mB,IACxEF,EAAMt4B,GAASo4B,WAAW,QAAUI,GAQxC,SAASC,EAAaz4B,EAAS04B,EAAWx5D,GACtC,GAAI8gC,aAAmBxuB,MACnB,IAAK,IAAIszB,EAAI,EAAGA,EAAI9E,EAAQt4B,SAAUo9B,EAClC2zB,EAAaz4B,EAAQ8E,GAAI4zB,EAAWx5D,QAI5C8gC,EAAQ6e,aAAa6Z,EAAWx5D,GAMpC,SAASqoD,EAAgBvnB,EAAS04B,GAC9B,GAAI14B,aAAmBxuB,MACnB,IAAK,IAAIszB,EAAI,EAAGA,EAAI9E,EAAQt4B,SAAUo9B,EAClCyiB,EAAgBvnB,EAAQ8E,GAAI4zB,QAIpC14B,EAAQunB,gBAAgBmR,GAO5B,IA4aIC,EACAC,EACAC,EAMAC,EACAC,EACAC,EACAC,EAGAC,EAEAC,EA5bA5jB,EAAS,SAAWvV,GACpB,IAAKA,EAAQo5B,eAAqD,IAApCp5B,EAAQq5B,iBAAiB3xD,OACnD,MAAM,IAAIkgD,MAAM,0CAEpB,IAAI0R,EAAOt5B,EAAQq5B,iBAAiB,GACpC,MAAO,CACHlQ,KAAMmQ,EAAKnQ,KAAOv3C,OAAOw3C,YACzBG,MAAO+P,EAAK/P,MAAQ33C,OAAOw3C,YAC3B5T,IAAK8jB,EAAK9jB,IAAM5jC,OAAOs3C,YACvBF,OAAQsQ,EAAKtQ,OAASp3C,OAAOs3C,cA+BjCqQ,EAAW,SAAWv5B,EAASw5B,GAC/B,KAAMx5B,aAAmBkxB,cAAkBsI,aAAuBlI,UAAYkI,aAAuBnI,gBAAkBmI,aAAuBhoD,QAC1I,MAAM,IAAIo2C,MAAM,uDAEpB,OAAOp2C,MAAM49B,KAAKoqB,GAAavb,QAAQje,IASvCy5B,EAAU,SAAWz5B,GACrB,KAAMA,aAAmBkxB,aACrB,MAAM,IAAItJ,MAAM,kCAEpB,OAA8B,OAAvB5nB,EAAQxwB,YAUfkqD,EAAa,SAAUC,EAAeC,EAAY9lD,GAClD,KAAM6lD,aAAyBzI,aAAkByI,EAAcP,yBAAyBlI,aACpF,MAAM,IAAItJ,MAAM,qCAEpB+R,EAAcP,cAAcxN,aAAagO,EAA0B,WAAb9lD,EAAwB6lD,EAAgBA,EAAcE,qBAa5GpjD,EAAc,SAAU4J,EAAQ2f,GAAW,OAAO05B,EAAWr5C,EAAQ2f,EAAS,UAuF9E85B,EAAmB,SAAW95B,GAC9B,KAAMA,aAAmBkxB,aACrB,MAAM,IAAItJ,MAAM,wCAGpB,IAAIzhB,EAAQv0B,OAAOmoD,iBAAiB/5B,GAEpC,MAA6C,eAAzCmG,EAAM6zB,iBAAiB,cAChBjwD,SAASo8B,EAAM6zB,iBAAiB,UAAW,IAG/C,CAAC,SAAU,cAAe,kBAC5B7yD,KAAI,SAAUrO,GACf,IAAImxC,EAAMlgC,SAASo8B,EAAM6zB,iBAAiBlhE,GAAM,IAChD,OAAOk7D,MAAM/pB,GAAO,EAAIA,KAEvBpjC,QAAO,SAAUozD,EAAK/6D,GAAS,OAAO+6D,EAAM/6D,MAQjDg7D,EAAkB,SAAWl6B,GAC7B,KAAMA,aAAmBkxB,aACrB,MAAM,IAAItJ,MAAM,wCAGpB,IAAIzhB,EAAQv0B,OAAOmoD,iBAAiB/5B,GAEpC,MAAO,CAAC,QAAS,eAAgB,iBAC5B74B,KAAI,SAAUrO,GACf,IAAImxC,EAAMlgC,SAASo8B,EAAM6zB,iBAAiBlhE,GAAM,IAChD,OAAOk7D,MAAM/pB,GAAO,EAAIA,KAEvBpjC,QAAO,SAAUozD,EAAK/6D,GAAS,OAAO+6D,EAAM/6D,MASjDi7D,EAAa,SAAWv+D,EAAO21D,GAC/B,KAAM31D,aAAiB4V,OACnB,MAAM,IAAIo2C,MAAM,4DAEpB,MAAwB,iBAAb2J,EACA31D,EAEJA,EAEFvE,QAAO,SAAU0D,GAClB,OAAOA,EAAK0sD,cAAc8J,aAAqBL,aAC1Cn2D,EAAKq/D,YAAcr/D,EAAKq/D,WAAW3S,cAAc8J,aAAqBL,eAG1E/pD,KAAI,SAAUpM,GACf,OAAOA,EAAK0sD,cAAc8J,IAAcx2D,EAAKq/D,YAAcr/D,EAAKq/D,WAAW3S,cAAc8J,OAQ7F7W,EAAiB,SAAWn5C,GAC5B,OAAQA,EAAM6zD,cAAgB7zD,EAAM6zD,eAAe,IAAO7zD,EAAM8e,QAWhEg6C,EAAmB,SAAUC,EAAgBC,EAAeh5D,GAC5D,MAAO,CACHy+B,QAASs6B,EACTE,KAAMj5D,EAAMk5D,MAAQF,EAAcpR,KAClCuR,KAAMn5D,EAAMo5D,MAAQJ,EAAc/kB,MA+CtColB,EAAiB,SAAW3mD,EAAa4mD,GAEzC,IAA+B,IAA3B5mD,EAAY6mD,WAAqB,CACjC,IAAIC,EAAazC,EAAMrkD,GAAakkD,UAAU,cAE9C,GAAmB,OAAf4C,IAAsC,IAAfA,GAA8C,iBAAfA,EACtD,MAAM,IAAInT,MAAM,oGAEpB,GAAmB,OAAfmT,EACA,OAAsB,IAAfA,GAAwBA,EAAWnoC,MAAM,KAAKv7B,QAAO,SAAU2jE,GAClE,OAAOA,EAAItzD,OAAS,GAAKmzD,EAAOljC,QAAQqjC,MACzCtzD,OAAS,EAGhB,GAAIuM,IAAgB4mD,EAChB,OAAO,EAGX,QAAoDh6D,IAAhDy3D,EAAMrkD,GAAakkD,UAAU,gBAAgF,OAAhDG,EAAMrkD,GAAakkD,UAAU,eAC1F,OAAOG,EAAMrkD,GAAakkD,UAAU,iBAAmBG,EAAMuC,GAAQ1C,UAAU,eAGvF,OAAO,GAMP8C,EAAuB,CACvBr/D,MAAO,KAEPs/D,YAAa,KAEbC,aAAc,KACdJ,WAAY,KACZK,MAAM,EACNt6D,YAAa,KACbu6D,iBAAkB,uBAClBC,cAAe,oBACfC,YAAY,EACZC,0BAA0B,EAC1B/qD,SAAU,EACVgrD,aAAc,IACdC,SAAU,EACV/nD,oBAAgB9S,EAChB86D,yBAAqB96D,EACrB+6D,gBAAiB,KACjBC,YAAa,YAwCbC,EAAmB,SAAWjoD,EAAmBme,GACjD,GAAgE,iBAArDsmC,EAAMzkD,GAAmBskD,UAAU,cAA4B,CACtE,IAAI4D,EAAiBzD,EAAMzkD,GAAmBskD,UAAU,cAAcvlC,MAAM,MAE7D,IAAXZ,GACA6d,EAAiBh8B,EAAmB,YApChD,SAAmBjD,EAAIorD,GACnB,IAAIC,EAAQxjE,KAOZ,QANkB,IAAdujE,IAAwBA,EAAY,KAMf,iBAAdA,EACP,MAAM,IAAIpU,MAAM,kEAEpB,IAAIsU,EAAqB,KACzB,OAAO,WAEH,IADA,IAAIn2B,EAAO,GACFo2B,EAAK,EAAGA,EAAKzqD,UAAUhK,OAAQy0D,IACpCp2B,EAAKo2B,GAAMzqD,UAAUyqD,GAEzB,IAAIr2B,EAAMlpB,KAAKkpB,OACY,OAAvBo2B,GAA+Bp2B,EAAMo2B,GAAsBF,KAC3DE,EAAqBp2B,EACrBl1B,EAAGW,MAAM0qD,EAAOl2B,KAgBiCL,EAAS,SAAUnkC,GAE1C,IAAlBA,EAAMwZ,SACN1jB,EAAOwc,EAAkBuhC,SAAUkjB,EAAMzkD,GAAmBskD,UAAU,UAAUnwD,SAAQ,SAAUjN,GAC9F,IAAI6pD,EAAIwX,EACJrhE,IAASwG,EAAM8e,QACdukC,EAAK7pD,EAAK+0C,WAAW5/B,OAAOqB,MAAMqzC,EAAImX,IAGtCK,EAAKrhE,EAAK+0C,WAAW7sC,IAAIsO,MAAM6qD,EAAIL,QAIjDzD,EAAMzkD,GAAmBskD,UAAU,kBAEtCtoB,EAAiBh8B,EAAmB,cAAc,WAC9Cxc,EAAOwc,EAAkBuhC,SAAUkjB,EAAMzkD,GAAmBskD,UAAU,UAAUnwD,SAAQ,SAAUjN,GAC9F,IAAI6pD,GACHA,EAAK7pD,EAAK+0C,WAAW5/B,OAAOqB,MAAMqzC,EAAImX,WAM/C9rB,EAAoBp8B,EAAmB,aACvCo8B,EAAoBp8B,EAAmB,iBA8B/CwoD,EAAmB,SAAUzgE,GAC7Bq0C,EAAoBr0C,EAAO,aAC3Bq0C,EAAoBr0C,EAAO,WAC3Bq0C,EAAoBr0C,EAAO,YAC3Bq0C,EAAoBr0C,EAAO,aAC3Bq0C,EAAoBr0C,EAAO,QAC3Bq0C,EAAoBr0C,EAAO,cAC3Bq0C,EAAoBr0C,EAAO,eAG3B0gE,EAAwB,SAAUxD,EAAiBI,GAC/CJ,GACA7oB,EAAoB6oB,EAAiB,aAErCI,GAAsBA,IAAsBJ,GAC5C7oB,EAAoBipB,EAAmB,cAyB3CqD,EAAqB,SAAU7pD,GAttBnC,IAAoBstB,KAutBLttB,GAttBC8kD,YACDx3B,EAAQw3B,IAAI7tD,KAstBvB49C,EAAgB70C,EAAU,oBAM1B8pD,EAAiB,SAAU5gE,GAC3B2rD,EAAgB3rD,EAAO,gBACvB2rD,EAAgB3rD,EAAO,eACvB2rD,EAAgB3rD,EAAO,aACvB2rD,EAAgB3rD,EAAO,SAQ3B,SAAS6gE,EAAaz8B,EAASz+B,GAC3B,GAAIA,EAAM6zD,aACN,OAAO7zD,EAAM6zD,eAAep6D,MAAK,SAAU+hD,GAAM,OAAOA,EAAG+d,cAE/D,MAA8B,IAAvB96B,EAAQ86B,YACX96B,EAAUA,EAAQo5B,cAEtB,OAAOp5B,EAQX,SAAS08B,EAAgBnE,EAAiBv4B,GACtC,IAAIhhC,EAAUu4D,EAAQgB,EAAiB,QAEnCoE,EADQtlE,EAAOkhE,EAAgBnjB,SAAUp2C,EAAQpD,OAChCvE,QAAO,SAAUulE,GAClC,OAAOA,EAAI7sB,SAAS/P,IAAa48B,EAAIxC,YAAcwC,EAAIxC,WAAWrqB,SAAS/P,MAE/E,OAAO28B,EAASj1D,OAAS,EAAIi1D,EAAS,GAAK38B,EAM/C,IA0BI68B,EAAiB,SAAUtE,GAC3B,IAAIxD,EAAOwC,EAAQgB,EAAiB,QAChC38D,EAAQvE,EAAOkhE,EAAgBnjB,SAAU2f,EAAKn5D,OAC9CkhE,EAAU3C,EAAWv+D,EAAOm5D,EAAKrhD,QACrC+kD,EAAaF,EAAiB,kBAAmB,QACjDhB,EAAQgB,EAAiB,YAAa,SACtCE,EAAaqE,EAAS,YAAa,QAEnChB,EAAiBvD,GAAiB,IAKR,IAAtBxD,EAAKoG,cAE0B,mBADjB3wD,UAAYoH,OAAOpH,UAAUg7B,cAAc,QACvC92B,UACdmhC,EAAiBitB,EAAS,aAAa,WACnC,IAA6B,IAAzBlhE,EAAMqiD,QAAQxlD,MACdA,KAAKiW,eAEJ,CAED,IADA,IAAIquD,EAAStkE,KAAK2gE,eACgB,IAA3Bx9D,EAAMqiD,QAAQ8e,IACjBA,EAASA,EAAO3D,cAEpB2D,EAAOruD,gBA4C3B,SAASgE,EAASsqD,EAAkBh+D,GAEhC,IAAI4/B,EAAS0xB,OAAOtxD,GAWpB,OAVAA,EAAUA,GAAW,GAEW,iBAArBg+D,IACPA,EAAmBxyD,SAASknC,iBAAiBsrB,IAG7CA,aAA4B9L,cAC5B8L,EAAmB,CAACA,IAExBA,EAAmBxrD,MAAML,UAAUM,MAAM22C,KAAK4U,GAC1C,YAAYz6B,KAAK3D,GACVo+B,EAAiB71D,KAAI,SAAU0M,GAClC,IAAIkhD,EAAOwC,EAAQ1jD,EAAmB,QACtC,OA1iBI,SAAWA,EAAmBopD,EAAsBC,GAIhE,QAH6B,IAAzBD,IAAmCA,EAAuB,SAAUrpD,EAAgBC,GAAqB,OAAOD,SAClF,IAA9BspD,IAAwCA,EAA4B,SAAUC,GAAuB,OAAOA,MAE1GtpD,aAA6Bq9C,cAAkD,IAAjCr9C,EAAkBinD,WAClE,MAAM,IAAIlT,MAAM,6DAGpB,GAAoC,mBAAzBqV,GAA4E,mBAA9BC,EACrD,MAAM,IAAItV,MAAM,uEAGpB,IACI7sD,EADUw8D,EAAQ1jD,EAAmB,QACtBjY,MAEfA,EAAQvE,EAAOwc,EAAkBuhC,SAAUr6C,GAC3CqiE,EAAkBxhE,EAAMuL,KAAI,SAAUpM,GACtC,MAAO,CACHgiE,OAAQlpD,EACRu9C,KAAMr2D,EACNoH,KAAMpH,EAAKknB,UACXnf,MAAOy2D,EAASx+D,EAAMa,OAQ9B,MAAO,CACH8O,UAAWwyD,EALC,CACZ9L,KAAMv9C,EACNwpD,UAAWD,EAAgB11D,SAI3B9L,MAAOwhE,EAAgBj2D,KAAI,SAAUpM,GAAQ,OAAOkiE,EAAqBliE,EAAM8Y,OA2gBpEypD,CAAUzpD,EAAmBkhD,EAAKphD,eAAgBohD,EAAK4G,yBAGtEqB,EAAiBh1D,SAAQ,SAAUuwD,GAC/B,GAAI,yBAAyBh2B,KAAK3D,GAC9B,OAAOlsB,EAASksB,GAAQ25B,GAG5B,CAAC,cAAe,gBAAgBvwD,SAAQ,SAAUu1D,GAC1CxlD,OAAO5G,UAAUqsD,eAAepV,KAAKppD,EAASu+D,IAAqC,OAAvBv+D,EAAQu+D,IACpE9mE,QAAQ27D,KAAK,8DAAiEmL,EAAY,6GAIlGv+D,EAAU+Y,OAAOkmB,OAAO,GAAIg9B,EAAsB3C,EAAMC,GAAiB/xC,OAAQxnB,GAEjFs5D,EAAMC,GAAiB/xC,OAASxnB,EAEhCu4D,EAAQgB,EAAiB,OAAQv5D,GAEjCu5D,EAAgBuC,YAAa,EAvDhB,SAAUvC,GAC3B,IAAIxD,EAAOwC,EAAQgB,EAAiB,QAChC38D,EAAQvE,EAAOkhE,EAAgBnjB,SAAU2f,EAAKn5D,OAC9CkhE,EAAU3C,EAAWv+D,EAAOm5D,EAAKrhD,QACrC6jD,EAAQgB,EAAiB,YAAa,SAEtC8D,EAAiBzgE,GACjB0gE,EAAsBxD,EAAiBI,GACvCjpB,EAAoB6sB,EAAS,aAE7B7sB,EAAoBsoB,EAAiB,YACrCtoB,EAAoBsoB,EAAiB,aACrCtoB,EAAoBsoB,EAAiB,QA6CjCkF,CAAelF,GAEf,IAEImF,EAFAC,EAAYtmE,EAAOkhE,EAAgBnjB,SAAUp2C,EAAQpD,OAGzD,GAA4B,OAAxBoD,EAAQ8B,kBAAgDD,IAAxB7B,EAAQ8B,YAA2B,CACnE,IAAI88D,EAAgBpzD,SAASg7B,cAAc+yB,EAAgBsF,SACvD7+D,EAAQ8B,uBAAuBowD,YAC/B0M,EAAcr3B,YAAYvnC,EAAQ8B,aAGlC88D,EAAcn4B,UAAYzmC,EAAQ8B,YAEtC48D,EAAoBE,EAAcxoB,SAAS,GAG/CkjB,EAAMC,GAAiBz3D,YAtiBT,SAAWy3D,EAAiBz3D,EAAau6D,GAC3D,IAAIzW,EAEJ,QADyB,IAArByW,IAA+BA,EAAmB,0BAChD9C,aAA2BrH,aAC7B,MAAM,IAAItJ,MAAM,mDAGpB,KAAM9mD,aAAuBowD,mBAAgCrwD,IAAhBC,EACzC,MAAM,IAAI8mD,MAAM,6EAoBpB,YAjBoB/mD,IAAhBC,IACI,CAAC,KAAM,MAAMc,SAAS22D,EAAgBsF,SACtC/8D,EAAc0J,SAASg7B,cAAc,MAEhC,CAAC,QAAS,SAAS5jC,SAAS22D,EAAgBsF,UACjD/8D,EAAc0J,SAASg7B,cAAc,OAEzBC,UAAY,0BAGxB3kC,EAAc0J,SAASg7B,cAAc,QAIb,iBAArB61B,IACNzW,EAAK9jD,EAAYgvC,WAAW7sC,IAAIsO,MAAMqzC,EAAIyW,EAAiBzoC,MAAM,MAE/D9xB,EA0gBkCg9D,CAAgBvF,EAAiBmF,EAAmB1+D,EAAQq8D,kBACjG9D,EAAQgB,EAAiB,QAASv5D,EAAQpD,OACtCoD,EAAQ+7D,WACRxD,EAAQgB,EAAiB,aAAcv5D,EAAQ+7D,YAE1C/7D,EAAQk8D,aACb3D,EAAQgB,EAAiB,cAAev5D,EAAQk8D,aAEpD2B,EAAetE,GACfE,EAAakF,EAAW,OAAQ,UAChClF,EAAakF,EAAW,eAAgB,SAMxC9tB,EAAiB0oB,EAAiB,aAAa,SAAU74D,GAErD,IAAI2gB,EAASq6B,EAAeh7C,GAC5B,IAA0B,IAAtB2gB,EAAOy6C,aAGXp7D,EAAEq+D,6BACG/+D,EAAQ0U,QAAW2M,EAAOsX,QAAQ34B,EAAQ0U,UAAiD,UAArC2M,EAAOy6B,aAAa,cAA/E,CAGA,IAAIjnC,EAAoB4oD,EAAap8C,EAAQ3gB,GACzCs+D,EAAWtB,EAAgB7oD,EAAmBwM,GAElD44C,EAA0B5hE,EAAOwc,EAAkBuhC,SAAUp2C,EAAQpD,OACrEm9D,EAAcE,EAAwBhb,QAAQ+f,GAC9ChF,EAAqBO,EAASyE,EAAUnqD,EAAkBuhC,UAC1D0jB,EAAkBjlD,EApcX,SAAWtS,EAAO+4D,EAAgBsB,GAEjD,KAAMr6D,aAAiB08D,OACnB,MAAM,IAAIrW,MAAM,4DAGpB,KAAM0S,aAA0BpJ,aAC5B,MAAM,IAAItJ,MAAM,qEAOpB,GAJKgU,IACDA,EAAkBvB,GAGlB94D,EAAM28D,cAAgB38D,EAAM28D,aAAaC,aAAc,CAEvD,IAEIC,EAAYxC,EAAgBtB,EAFZ/kB,EAAO+kB,GAEoC/4D,GAE/D,KAAM68D,EAAUp+B,mBAAmBkxB,cAA0C,iBAAnBkN,EAAU5D,MAA+C,iBAAnB4D,EAAU1D,KACtG,MAAM,IAAI9S,MAAM,uIAGpBrmD,EAAM28D,aAAaG,cAAgB,WAEnC98D,EAAM28D,aAAa3vB,QAAQ,aAAcmM,EAAen5C,GAAO7H,IAE/D6H,EAAM28D,aAAaC,aAAaC,EAAUp+B,QAASo+B,EAAU5D,KAAM4D,EAAU1D,OA0azEyD,CAAaz+D,EAAGs+D,EAAUh/D,EAAQ48D,iBAElChD,EAAiBkB,EAAiBkE,GAClCnF,EAAgBqB,EAAgB8D,GAChCA,EAASluB,UAAU7sC,IAAIjE,EAAQs8D,eAC/B3C,EA1PM,SAAU2F,EAAa5rD,GACrC,IAAI6rD,EAAQD,EAQZ,OAP0C,IAAtChG,EAAM5lD,GAAUylD,UAAU,UAE1BM,EADA8F,EAAQD,EAAYlmB,WAAU,GACV,cAAe,QACnCkmB,EAAYlF,cAAc7yB,YAAYg4B,GACtCA,EAAMp4B,MAAMuT,QAAU,OACtB6kB,EAAMC,WAAaF,EAAYn4B,MAAMuT,SAElC6kB,EAiPYE,CAAYT,EAAUnqD,GACjC4kD,EAAaE,EAAU,eAAgB,QAEvC9kD,EAAkBwqC,cAAc,IAAIqgB,YAAY,YAAa,CACzD1qD,OAAQ,CACJ6mD,OAAQ,CACJ8D,aAAc3F,EACdl2D,MAAOi2D,EACPruD,UAAWouD,GAEf/9D,KAAM49D,EACNiG,eAAgBv+C,UAO5BwvB,EAAiB0oB,EAAiB,aAAa,SAAU74D,GACrD,IAAI2gB,EAASq6B,EAAeh7C,GACxBmU,EAAoB4oD,EAAap8C,EAAQ3gB,GACzCmU,GAAqBA,IAAsBqlD,IAC3CC,EAA+B9hE,EAAOwc,EAAkBuhC,SAAUmiB,EAAQ1jD,EAAmB,UACxFxc,QAAO,SAAU0D,GAAQ,OAAOA,IAASu9D,EAAMC,GAAiBz3D,eACjE9B,EAAQw8D,0BACR3nD,EAAkBi8B,UAAU7sC,IAAIjE,EAAQw8D,0BAE5C3nD,EAAkBwqC,cAAc,IAAIqgB,YAAY,YAAa,CACzD1qD,OAAQ,CACJ6mD,OAAQ,CACJ8D,aAAc3F,EACdl2D,MAAOi2D,EACPruD,UAAWouD,GAEf7kD,YAAa,CACTvJ,UAAWmJ,EACXgrD,kBAAmB1F,GAEvBp+D,KAAM49D,EACNiG,eAAgBv+C,MAGxBwvB,EAAiBh8B,EAAmB,aAAa,SAAUnU,GAGvD,IAAIo/D,EAAYp/D,EAAE0kD,eAAiB1kD,EAAEq/D,YAChCr/D,EAAE6F,cAAcwqC,SAAS+uB,KACtB9/D,EAAQw8D,0BACR3nD,EAAkBi8B,UAAU5/B,OAAOlR,EAAQw8D,0BAE/C3nD,EAAkBwqC,cAAc,IAAIqgB,YAAY,YAAa,CACzD1qD,OAAQ,CACJ6mD,OAAQ,CACJ8D,aAAc3F,EACdl2D,MAAOi2D,EACPruD,UAAWmJ,GAEf9Y,KAAM49D,EACNiG,eAAgBv+C,WAMpC64C,EAAoBrlD,KAOxBg8B,EAAiB0oB,EAAiB,WAAW,SAAU74D,GACnD,GAAKi5D,EAAL,CAGAA,EAAS7oB,UAAU5/B,OAAOlR,EAAQs8D,eAClC7C,EAAaE,EAAU,eAAgB,SACM,SAAzCA,EAAS7d,aAAa,gBAA8D,SAAjCyc,EAAQoB,EAAU,YACrEA,EAASzoD,SAEbyoD,EAASxyB,MAAMuT,QAAUif,EAAS6F,kBAC3B7F,EAAS6F,WAChB,IAAIQ,EAAqBxtD,MAAM49B,KAAKqoB,EAAOpxD,UAAUc,KAAI,SAAUwC,GAAQ,OAAOA,EAAK7I,eAClFzJ,QAAO,SAAUyJ,GAAe,OAAOA,aAAuBowD,eAC9D75D,OAAOoiE,GAAS,GACjBuF,GACAA,EAAmB9uD,SAGvBqoD,EAAgBla,cAAc,IAAIqgB,YAAY,WAAY,CACtD1qD,OAAQ,CACJ6mD,OAAQ,CACJ8D,aAAc3F,EACdl2D,MAAOi2D,EACPruD,UAAWouD,GAEf/9D,KAAM49D,MAGdO,EAAoB,KACpBP,EAAW,KACXC,EAAiB,KACjBC,EAAgB,SAMpBhpB,EAAiB0oB,EAAiB,QAAQ,SAAU74D,GAChD,GAAKk7D,EAAerC,EAAiBI,EAASS,eAA9C,CAGA15D,EAAEsvB,iBACFtvB,EAAEmmD,kBACF0R,EAAQoB,EAAU,UAAW,QAE7B,IAAIqG,EAAqBxtD,MAAM49B,KAAKqoB,EAAOpxD,UAAUc,KAAI,SAAUwC,GAC/D,OAAOA,EAAK7I,eAGXzJ,QAAO,SAAUyJ,GAAe,OAAOA,aAAuBowD,eAE9D75D,OAAOoiE,GAAS,GAErBhjD,EAAYuoD,EAAoBrG,GAEhCqG,EAAmB9uD,SAInBqoD,EAAgBla,cAAc,IAAIqgB,YAAY,WAAY,CACtD1qD,OAAQ,CACJ6mD,OAAQ,CACJ8D,aAAc3F,EACdl2D,MAAOi2D,EACPruD,UAAWouD,GAEf/9D,KAAM49D,MAGd,IAAI73D,EAAcw3D,EAAMC,GAAiBz3D,YACrCm+D,EAAc5nE,EAAOyhE,EAAgB1jB,SAAUp2C,EAAQpD,OACtDvE,QAAO,SAAU0D,GAAQ,OAAOA,IAAS+F,KAC1Co+D,GAA2C,IAApBzmE,KAAKqiE,WAAsBriE,KAAOA,KAAK2gE,cAC9D+F,EAAmB9nE,EAAO6nE,EAAqB9pB,SAAUmiB,EAAQ2H,EAAsB,UACtF7nE,QAAO,SAAU0D,GAAQ,OAAOA,IAAS+F,KAC1Cs+D,EAA0B7F,EAASZ,EAAUnnD,MAAM49B,KAAKupB,EAASS,cAAchkB,UAC9E/9C,QAAO,SAAU0D,GAAQ,OAAOA,IAAS+F,MAC1Cu+D,EAAmB9F,EAASZ,EAAUwG,GACtCngE,EAAQw8D,0BACR0D,EAAqBpvB,UAAU5/B,OAAOlR,EAAQw8D,0BAM9CxC,IAAuBoG,GAA2BtG,IAAoBoG,GACtE3G,EAAgBla,cAAc,IAAIqgB,YAAY,aAAc,CACxD1qD,OAAQ,CACJ6mD,OAAQ,CACJ8D,aAAc3F,EACdl2D,MAAOi2D,EACPruD,UAAWouD,EACX+F,kBAAmB5F,EACnBr9D,MAAOqjE,GAEXhrD,YAAa,CACTnR,MAAOu8D,EACPV,aAAcS,EACd10D,UAAWw0D,EACXL,kBAAmB1F,EACnBv9D,MAAOujE,GAEXpkE,KAAM49D,UAKtB,IAn3BkBhzB,EAAMyxB,EAExBkI,EAi3BIC,GAn3Bc55B,EAm3BoB,SAAU4yB,EAAiBv4B,EAASy6B,EAAOE,GAC7E,GAAKhC,EAUL,GANI35D,EAAQyU,uBACR6kD,EAAMC,GAAiBz3D,YAAYqlC,MAAME,OAASuyB,EAAiB,KACnEN,EAAMC,GAAiBz3D,YAAYqlC,MAAMC,MAAQyyB,EAAgB,MAIjErnD,MAAM49B,KAAKmpB,EAAgBnjB,UAAU6I,QAAQje,IAAY,EAAG,CAC5D,IAAIw/B,EAAa1F,EAAiB95B,GAC9By/B,EAAYvF,EAAgBl6B,GAC5B0/B,EAAmBnG,EAASjB,EAAMC,GAAiBz3D,YAAak/B,EAAQo5B,cAAchkB,UACtFuqB,EAAYpG,EAASv5B,EAASA,EAAQo5B,cAAchkB,UAExD,GAAIoqB,EAAa5G,GAAkB6G,EAAY5G,EAAe,CAE1D,IAAI+G,EAAmBJ,EAAa5G,EAChCiH,EAAqBJ,EAAY5G,EACjCiH,EAAYvqB,EAAOvV,GAASwV,IAC5BuqB,EAAaxqB,EAAOvV,GAASmpB,KACjC,GAAIuW,EAAmBC,IACO,aAAxB3gE,EAAQ68D,aAA8BlB,EAAQmF,GACnB,eAAxB9gE,EAAQ68D,aAAgCpB,EAAQsF,GACrD,OAEJ,GAAIL,EAAmBC,IACO,aAAxB3gE,EAAQ68D,aAA8BlB,EAAQmF,EAAYN,EAAaI,GAC5C,eAAxB5gE,EAAQ68D,aAAgCpB,EAAQsF,EAAaN,EAAYI,GAC9E,YAGoBh/D,IAAxB83D,EAAS6F,aACT7F,EAAS6F,WAAa7F,EAASxyB,MAAMuT,SAEV,SAA3Bif,EAASxyB,MAAMuT,UACfif,EAASxyB,MAAMuT,QAAU,QAK7B,IAAIsmB,GAAa,EACjB,IACI,IAAIC,EAAwB1qB,EAAOvV,GAASwV,IAAMxV,EAAQuoB,aAAe,EACrE2X,EAA0B3qB,EAAOvV,GAASmpB,KAAOnpB,EAAQ6Z,YAAc,EAC3EmmB,EAAsC,aAAxBhhE,EAAQ68D,aAA+BlB,GAASsF,GACjC,eAAxBjhE,EAAQ68D,aAAiCpB,GAASyF,EAE3D,MAAOxgE,GACHsgE,EAAaN,EAAmBC,EAEhCK,EACAvpD,EAAYupB,EAASs4B,EAAMC,GAAiBz3D,aA92B7C,SAAUuf,EAAQ2f,GAAkB05B,EAAWr5C,EAAQ2f,EAAS,UAi3B/D4rB,CAAa5rB,EAASs4B,EAAMC,GAAiBz3D,aAGjD0Q,MAAM49B,KAAKqoB,EAAOpxD,UAEbhP,QAAO,SAAUsS,GAAQ,YAA4B9I,IAArB8I,EAAK7I,eAErCkH,SAAQ,SAAU2B,GACfA,EAAK7I,cAAgBw3D,EAAMC,GAAiBz3D,aAC5C6I,EAAK7I,YAAYoP,gBAIxB,CAED,IAAIiwD,EAAe3uD,MAAM49B,KAAKqoB,EAAOpxD,UAChChP,QAAO,SAAUsS,GAAQ,YAA4B9I,IAArB8I,EAAK7I,eACrCqG,KAAI,SAAUwC,GACf,OAAOA,EAAK7I,gBAGuB,IAAnCq/D,EAAaliB,QAAQje,IAAmBu4B,IAAoBv4B,GAAY3oC,EAAO2oC,EAAQoV,SAAUp2C,EAAQpD,OAAO8L,SAChHy4D,EAAan4D,SAAQ,SAAUg4B,GAAW,OAAOA,EAAQ9vB,YACzD8vB,EAAQuG,YAAY+xB,EAAMC,GAAiBz3D,qBAl8B9C,KADes2D,EAs8BrBp4D,EAAQyR,YAr8BQ2mD,EAAO,GAEvB,WAEH,IADA,IAAIrxB,EAAO,GACFo2B,EAAK,EAAGA,EAAKzqD,UAAUhK,OAAQy0D,IACpCp2B,EAAKo2B,GAAMzqD,UAAUyqD,GAEzB92D,aAAai6D,GACbA,EAAUh6D,YAAW,WACjBqgC,EAAKp0B,WAAM,EAAQw0B,KACpBqxB,KA67BCgJ,EAAkB,SAAU1gE,GAC5B,IAAIsgC,EAAUtgC,EAAE2gB,OACZk4C,GAAyC,IAAvBv4B,EAAQ86B,WAAsB96B,EAAUy8B,EAAaz8B,EAAStgC,GAEpF,GADAsgC,EAAU08B,EAAgBnE,EAAiBv4B,GACtC24B,GAAaiC,EAAerC,EAAiBI,EAASS,gBAA4D,SAA1C7B,EAAQgB,EAAiB,aAAtG,CAGA,IAAIv5D,EAAUu4D,EAAQgB,EAAiB,QACnCxuD,SAAS/K,EAAQ08D,WAAarkE,EAAOkhE,EAAgBnjB,SAAUmiB,EAAQgB,EAAiB,UAAU7wD,QAAUqC,SAAS/K,EAAQ08D,WAAa/C,EAASS,gBAAkBb,IAGzK74D,EAAEsvB,iBACFtvB,EAAEmmD,kBACFnmD,EAAEw+D,aAAamC,YAA0D,IAA7C/H,EAAMC,GAAiBJ,UAAU,QAAmB,OAAS,OACzFoH,EAAuBhH,EAAiBv4B,EAAStgC,EAAE+6D,MAAO/6D,EAAEi7D,UAEhE9qB,EAAiB8tB,EAAUxkC,OAAOo/B,GAAkB,WAAY6H,GAChEvwB,EAAiB8tB,EAAUxkC,OAAOo/B,GAAkB,YAAa6H,MAE9DpD,GAEXtqD,EAAS7C,QAAU,SAAU0oD,IAxdP,SAAUA,GAC5B,IAAIxD,EAAOwC,EAAQgB,EAAiB,SAAW,GAC3C38D,EAAQvE,EAAOkhE,EAAgBnjB,SAAU2f,EAAKn5D,OAC9CkhE,EAAU3C,EAAWv+D,EAAOm5D,EAAKrhD,QAErCooD,EAAiBvD,GAAiB,GAElCtoB,EAAoBsoB,EAAiB,YACrCtoB,EAAoBsoB,EAAiB,aACrCtoB,EAAoBsoB,EAAiB,aACrCtoB,EAAoBsoB,EAAiB,WACrCtoB,EAAoBsoB,EAAiB,QAErCgE,EAAmBhE,GAEnBtoB,EAAoB6sB,EAAS,aAC7BT,EAAiBzgE,GACjB4gE,EAAe5gE,GACf0gE,EAAsBxD,EAAiBI,GAEvCX,EAAgBuC,YAAa,EAqc7BwF,CAAgB/H,IAEpB7lD,EAASsf,OAAS,SAAUumC,GACxBsE,EAAetE,IAEnB7lD,EAASoyC,QAAU,SAAUyT,IAjaP,SAAUA,GAC5B,IAAIxD,EAAOwC,EAAQgB,EAAiB,QAChC38D,EAAQvE,EAAOkhE,EAAgBnjB,SAAU2f,EAAKn5D,OAC9CkhE,EAAU3C,EAAWv+D,EAAOm5D,EAAKrhD,QACrC+kD,EAAaF,EAAiB,kBAAmB,QACjDhB,EAAQgB,EAAiB,YAAa,QACtCE,EAAaqE,EAAS,YAAa,SACnC7sB,EAAoB6sB,EAAS,aAC7BhB,EAAiBvD,GAAiB,GA0ZlCgI,CAAgBhI,IAGpB7lD,EAAS8tD,UAAY,CAEjB72D,KAAM4tD,EACN8E,iBAAkBA,EAClBG,eAAgBA,EAChBD,mBAAoBA,EACpBD,sBAAuBA,GAG3BmE,EAAOC,QAAUhuD,G,0GC/wCjB,OAEC,WACG,aAEA,IAAIiuD,EAAK,CACLC,WAAY,OACZC,SAAU,OACVC,SAAU,OACVC,cAAe,OACf5J,OAAQ,UACR6J,YAAa,eACbC,KAAM,MACNC,SAAU,OACV7hE,KAAM,YACN8hE,OAAQ,WACRrgE,YAAa,2FACbhI,IAAK,sBACLsoE,WAAY,wBACZC,aAAc,aACdC,KAAM,SAGV,SAASC,EAAQzoE,GAEb,OAAO0oE,EAAeC,EAAc3oE,GAAM4Y,WAG9C,SAAS1Q,EAAS0gE,EAAKC,GACnB,OAAOJ,EAAQhwD,MAAM,KAAM,CAACmwD,GAAKvoC,OAAOwoC,GAAQ,KAGpD,SAASH,EAAeI,EAAYD,GAChC,IAAiDE,EAAkB/8B,EAAGgnB,EAAGgW,EAAIrmB,EAAKsmB,EAAeC,EAAYC,EAAaX,EAAtHY,EAAS,EAAGC,EAAcP,EAAWl6D,OAAawkC,EAAS,GAC/D,IAAKpH,EAAI,EAAGA,EAAIq9B,EAAar9B,IACzB,GAA6B,iBAAlB88B,EAAW98B,GAClBoH,GAAU01B,EAAW98B,QAEpB,GAA6B,iBAAlB88B,EAAW98B,GAAiB,CAExC,IADAg9B,EAAKF,EAAW98B,IACT1gB,KAEH,IADAy9C,EAAMF,EAAKO,GACNpW,EAAI,EAAGA,EAAIgW,EAAG19C,KAAK1c,OAAQokD,IAAK,CACjC,GAAWjrD,MAAPghE,EACA,MAAM,IAAIja,MAAM2Z,EAAQ,gEAAiEO,EAAG19C,KAAK0nC,GAAIgW,EAAG19C,KAAK0nC,EAAE,KAEnH+V,EAAMA,EAAIC,EAAG19C,KAAK0nC,SAItB+V,EADKC,EAAGM,SACFT,EAAKG,EAAGM,UAGRT,EAAKO,KAOf,GAJIvB,EAAGG,SAASv+B,KAAKu/B,EAAGjrE,OAAS8pE,EAAGI,cAAcx+B,KAAKu/B,EAAGjrE,OAASgrE,aAAeQ,WAC9ER,EAAMA,KAGNlB,EAAGK,YAAYz+B,KAAKu/B,EAAGjrE,OAAyB,iBAARgrE,GAAoB7N,MAAM6N,GAClE,MAAM,IAAIvK,UAAUiK,EAAQ,0CAA2CM,IAO3E,OAJIlB,EAAGxJ,OAAO50B,KAAKu/B,EAAGjrE,QAClBorE,EAAcJ,GAAO,GAGjBC,EAAGjrE,MACP,IAAK,IACDgrE,EAAM93D,SAAS83D,EAAK,IAAIz+B,SAAS,GACjC,MACJ,IAAK,IACDy+B,EAAMvR,OAAOgS,aAAav4D,SAAS83D,EAAK,KACxC,MACJ,IAAK,IACL,IAAK,IACDA,EAAM93D,SAAS83D,EAAK,IACpB,MACJ,IAAK,IACDA,EAAMh+D,KAAKmP,UAAU6uD,EAAK,KAAMC,EAAG17B,MAAQr8B,SAAS+3D,EAAG17B,OAAS,GAChE,MACJ,IAAK,IACDy7B,EAAMC,EAAGS,UAAY1nB,WAAWgnB,GAAKW,cAAcV,EAAGS,WAAa1nB,WAAWgnB,GAAKW,gBACnF,MACJ,IAAK,IACDX,EAAMC,EAAGS,UAAY1nB,WAAWgnB,GAAKtO,QAAQuO,EAAGS,WAAa1nB,WAAWgnB,GACxE,MACJ,IAAK,IACDA,EAAMC,EAAGS,UAAYjS,OAAOzmD,OAAOg4D,EAAIY,YAAYX,EAAGS,aAAe1nB,WAAWgnB,GAChF,MACJ,IAAK,IACDA,GAAO93D,SAAS83D,EAAK,MAAQ,GAAGz+B,SAAS,GACzC,MACJ,IAAK,IACDy+B,EAAMvR,OAAOuR,GACbA,EAAOC,EAAGS,UAAYV,EAAIr9B,UAAU,EAAGs9B,EAAGS,WAAaV,EACvD,MACJ,IAAK,IACDA,EAAMvR,SAASuR,GACfA,EAAOC,EAAGS,UAAYV,EAAIr9B,UAAU,EAAGs9B,EAAGS,WAAaV,EACvD,MACJ,IAAK,IACDA,EAAM9pD,OAAO5G,UAAUiyB,SAASglB,KAAKyZ,GAAKpwD,MAAM,GAAI,GAAGwO,cACvD4hD,EAAOC,EAAGS,UAAYV,EAAIr9B,UAAU,EAAGs9B,EAAGS,WAAaV,EACvD,MACJ,IAAK,IACDA,EAAM93D,SAAS83D,EAAK,MAAQ,EAC5B,MACJ,IAAK,IACDA,EAAMA,EAAIa,UACVb,EAAOC,EAAGS,UAAYV,EAAIr9B,UAAU,EAAGs9B,EAAGS,WAAaV,EACvD,MACJ,IAAK,IACDA,GAAO93D,SAAS83D,EAAK,MAAQ,GAAGz+B,SAAS,IACzC,MACJ,IAAK,IACDy+B,GAAO93D,SAAS83D,EAAK,MAAQ,GAAGz+B,SAAS,IAAIu/B,cAGjDhC,EAAGM,KAAK1+B,KAAKu/B,EAAGjrE,MAChBq1C,GAAU21B,IAGNlB,EAAGxJ,OAAO50B,KAAKu/B,EAAGjrE,OAAWorE,IAAeH,EAAGR,KAK/CA,EAAO,IAJPA,EAAOW,EAAc,IAAM,IAC3BJ,EAAMA,EAAIz+B,WAAWn5B,QAAQ02D,EAAGW,KAAM,KAK1CS,EAAgBD,EAAGc,SAA2B,MAAhBd,EAAGc,SAAmB,IAAMd,EAAGc,SAAS1c,OAAO,GAAK,IAClF8b,EAAaF,EAAG17B,OAASk7B,EAAOO,GAAKn6D,OACrC+zC,EAAMqmB,EAAG17B,OAAS47B,EAAa,EAAID,EAAcc,OAAOb,GAAoB,GAC5E91B,GAAU41B,EAAGn/D,MAAQ2+D,EAAOO,EAAMpmB,EAAyB,MAAlBsmB,EAAwBT,EAAO7lB,EAAMomB,EAAMpmB,EAAM6lB,EAAOO,GAI7G,OAAO31B,EAGX,IAAI42B,EAAgB/qD,OAAO4K,OAAO,MAElC,SAAS8+C,EAAcC,GACnB,GAAIoB,EAAcpB,GACd,OAAOoB,EAAcpB,GAIzB,IADA,IAAgBzgC,EAAZ8hC,EAAOrB,EAAYE,EAAa,GAAIoB,EAAY,EAC7CD,GAAM,CACT,GAAqC,QAAhC9hC,EAAQ0/B,EAAGthE,KAAK4iC,KAAK8gC,IACtBnB,EAAW75D,KAAKk5B,EAAM,SAErB,GAAuC,QAAlCA,EAAQ0/B,EAAGQ,OAAOl/B,KAAK8gC,IAC7BnB,EAAW75D,KAAK,SAEf,IAA4C,QAAvCk5B,EAAQ0/B,EAAG7/D,YAAYmhC,KAAK8gC,IA6ClC,MAAM,IAAIE,YAAY,oCA5CtB,GAAIhiC,EAAM,GAAI,CACV+hC,GAAa,EACb,IAAIE,EAAa,GAAIC,EAAoBliC,EAAM,GAAImiC,EAAc,GACjE,GAAuD,QAAlDA,EAAczC,EAAG7nE,IAAImpC,KAAKkhC,IAe3B,MAAM,IAAIF,YAAY,gDAbtB,IADAC,EAAWn7D,KAAKq7D,EAAY,IACwD,MAA5ED,EAAoBA,EAAkB3+B,UAAU4+B,EAAY,GAAG17D,UACnE,GAA8D,QAAzD07D,EAAczC,EAAGS,WAAWn/B,KAAKkhC,IAClCD,EAAWn7D,KAAKq7D,EAAY,QAE3B,IAAgE,QAA3DA,EAAczC,EAAGU,aAAap/B,KAAKkhC,IAIzC,MAAM,IAAIF,YAAY,gDAHtBC,EAAWn7D,KAAKq7D,EAAY,IAUxCniC,EAAM,GAAKiiC,OAGXF,GAAa,EAEjB,GAAkB,IAAdA,EACA,MAAM,IAAIpb,MAAM,6EAGpBga,EAAW75D,KACP,CACIjH,YAAamgC,EAAM,GACnBmhC,SAAanhC,EAAM,GACnB7c,KAAa6c,EAAM,GACnBqgC,KAAargC,EAAM,GACnB2hC,SAAa3hC,EAAM,GACnBt+B,MAAas+B,EAAM,GACnBmF,MAAanF,EAAM,GACnBshC,UAAathC,EAAM,GACnBpqC,KAAaoqC,EAAM,KAO/B8hC,EAAOA,EAAKv+B,UAAUvD,EAAM,GAAGv5B,QAEnC,OAAOo7D,EAAcpB,GAAOE,EAQ5BlB,EAAA,QAAqBa,EACrBb,EAAA,SAAsB1/D,EAEJ,oBAAX4Q,SACPA,OAAgB,QAAI2vD,EACpB3vD,OAAiB,SAAI5Q,OAQhB,KALD,aACI,MAAO,CACH,QAAWugE,EACX,SAAYvgE,IAEnB,+BAhOZ,I,wBCFDy/D,EAAOC,QAAU7uD,SCCbwxD,yBAA2B,GAG/B,SAASC,oBAAoBC,GAE5B,IAAIC,EAAeH,yBAAyBE,GAC5C,QAAqB1iE,IAAjB2iE,EACH,OAAOA,EAAa9C,QAGrB,IAAID,EAAS4C,yBAAyBE,GAAY,CAGjD7C,QAAS,IAOV,OAHA+C,oBAAoBF,GAAU9C,EAAQA,EAAOC,QAAS4C,qBAG/C7C,EAAOC,QCpBf4C,oBAAoBzM,EAAK4J,IACxB,IAAIiD,EAASjD,GAAUA,EAAOkD,WAC7B,IAAOlD,EAAiB,QACxB,IAAM,EAEP,OADA6C,oBAAoBzhB,EAAE6hB,EAAQ,CAAEhmC,EAAGgmC,IAC5BA,GCLRJ,oBAAoBzhB,EAAI,CAAC6e,EAASkD,KACjC,IAAI,IAAI9qE,KAAO8qE,EACXN,oBAAoBO,EAAED,EAAY9qE,KAASwqE,oBAAoBO,EAAEnD,EAAS5nE,IAC5Eif,OAAO01C,eAAeiT,EAAS5nE,EAAK,CAAEk/D,YAAY,EAAM/nD,IAAK2zD,EAAW9qE,MCJ3EwqE,oBAAoBO,EAAI,CAACxM,EAAK94D,IAAUwZ,OAAO5G,UAAUqsD,eAAepV,KAAKiP,EAAK94D,GCClF+kE,oBAAoBQ,EAAKpD,IACH,oBAAXqD,QAA0BA,OAAOC,aAC1CjsD,OAAO01C,eAAeiT,EAASqD,OAAOC,YAAa,CAAE9kE,MAAO,WAE7D6Y,OAAO01C,eAAeiT,EAAS,aAAc,CAAExhE,OAAO,K,wmBCCvDvI,iBAAiBwhD,MAAQ,CACxBrc,OAAQ,IAmBT,KACCtD,uBAAiB,YAChBC,qBAAiB,iBAAiB,EAAO,CAAEkH,QAAS,YAGpD,IAAIhf,UACJ,IAAI9lB,UACJ,IAAI4xB,UACJ,IAAIw3C,UACJ,IAAIC,UACJ,IAAIC,aAEJ,MAAQzhE,IACT+jC,sBAAkB/jC,K","file":"bundle.min.js","sourcesContent":["import $ from 'jquery';\r\n\r\nimport {\r\n    itemsObject,\r\n    getDOMElements,\r\n    isEmpty,\r\n    isDefined,\r\n    filterMeta,\r\n    filterMetaValue\r\n}                     from './Utilities.js';\r\nimport UserSelector   from './UserSelector.js';\r\nimport MetaboxItems   from './MetaboxItems.js';\r\nimport MetaboxFooter  from './MetaboxFooter.js';\r\nimport ItemCreatorAdd from './ItemCreatorAdd.js';\r\nimport Closures       from './Closures.js';\r\n\r\nclass Actions {\r\n\r\n    /**\r\n     * Renders all the actions in the UI\r\n     * @class\r\n     *\r\n     */\r\n\r\n    constructor(){\r\n        console.log(UncannyAutomator)\r\n        // Debugging: Create console group\r\n        // console.group( 'Actions' );\r\n\r\n        // Get and clear metabox\r\n        let $metabox = getDOMElements( 'metabox', { type: 'action' });\r\n        $metabox.empty();\r\n\r\n        // Check if we have to create the User Selector\r\n        if ( UncannyAutomator.recipe.type == 'anonymous' && isDefined( UncannyAutomator.wp ) && UncannyAutomator.wp ){\r\n            // Create User Selector\r\n            new UserSelector();\r\n        }\r\n\r\n        // Get recipe actions\r\n        let actions = itemsObject( 'get', {\r\n            filter: {\r\n                itemType: 'action',\r\n            }\r\n        });\r\n\r\n        let hasClosures = false;\r\n        let closuresLabel =  UncannyAutomator.i18n.action.asyncActions.closuresLabelInstant;\r\n\r\n        // Check if it has actions\r\n        if ( ! isEmpty( actions ) && isDefined( UncannyAutomator.wp ) && UncannyAutomator.wp ){\r\n\r\n            let instantActions = filterMeta( actions, 'async_mode', false );\r\n\r\n            // Render non async actions\r\n            new MetaboxItems( 'action', instantActions );\r\n\r\n            let delayedActions = filterMetaValue( actions, 'async_mode', 'delay' );\r\n            let scheduledActions = filterMetaValue( actions, 'async_mode', 'schedule' );\r\n\r\n            if ( ! isEmpty( delayedActions ) || ! isEmpty( scheduledActions ) ) {\r\n                closuresLabel =  UncannyAutomator.i18n.action.asyncActions.closuresLabelAsync;\r\n                // Add Closures early\r\n                new Closures( closuresLabel );\r\n\r\n                // Prevent closures from appearing later\r\n                hasClosures = true;\r\n            }\r\n\r\n            // Render async actions\r\n            new MetaboxItems( 'action', delayedActions );\r\n            new MetaboxItems( 'action', scheduledActions );\r\n  \r\n        } else if ( ! isEmpty( actions ) ) {\r\n            new MetaboxItems( 'action', actions );\r\n        } else {\r\n            // Render the first step of the item creator\r\n            new ItemCreatorAdd( 'action' );\r\n        }\r\n\r\n        // Create metabox footer\r\n        new MetaboxFooter( 'action' );\r\n\r\n        // Debugging: Close console group\r\n        // console.groupEnd();\r\n\r\n\r\n        // Show closures if they were not shown earlier\r\n        if ( ! hasClosures ) {\r\n            new Closures( closuresLabel );\r\n        }\r\n\r\n    }\r\n\r\n    \r\n}\r\n\r\nexport default Actions;","import $ from 'jquery';\r\n\r\nimport {\r\n    isDefined,\r\n    getDOMElements,\r\n    restCall,\r\n    vsprintf\r\n}                         from './Utilities.js';\r\nimport ItemHeaderMenu     from './ItemHeaderMenu.js';\r\nimport ItemHeaderIcon     from './ItemHeaderIcon.js';\r\nimport ItemHeaderTag      from './ItemHeaderTag.js';\r\nimport ItemHeaderSentence from './ItemHeaderSentence.js';\r\nimport Actions            from './Actions.js';\r\nimport Field              from './Field.js';\r\n\r\nclass Closures {\r\n\r\n    constructor( label ){\r\n        // Create console group\r\n        // console.group( 'Closures' );\r\n\r\n        // Get metabox\r\n        this.elements = {\r\n            $metabox: getDOMElements( 'metabox', { type: 'action' })\r\n        }\r\n\r\n        // Create closures. It's important to understand that we're going to create all the available closures, not only those already added to the item\r\n        // That's why we create a separate file instead of using Item.js\r\n        $.each( UncannyAutomator.closures, ( key, closure ) => this.createClosure( closure, label ) );\r\n\r\n        // Close console group\r\n        // console.groupEnd();\r\n    }\r\n\r\n    createClosure( closure, label ){\r\n        // Variable to check later if this closure already was added to the recipe\r\n        let wasAdded = false;\r\n\r\n        // Container\r\n        let $container = $( '<div/>', { 'class': 'metabox__footer' });\r\n\r\n        // Checkbox attributes. We're going to use this to create our checkbox later.\r\n        let checkboxAttributes = {\r\n            label:              label,\r\n            formElementClass:   'form-element--nomargin'\r\n        }\r\n\r\n        // Check if this closure already was added to the recipe\r\n        let closureInRecipe = this.getClosureByCodeFromItemsObject( closure.code );\r\n\r\n        if ( isDefined( closureInRecipe ) ){\r\n            wasAdded = true;\r\n\r\n            checkboxAttributes.currentValue = true;\r\n            checkboxAttributes.itemid       = closureInRecipe.id;\r\n\r\n            // Debug\r\n            // console.groupCollapsed( vsprintf( 'ID: %s', [ closureInRecipe.id ] ) );\r\n            // console.log( closureInRecipe );\r\n            // console.groupEnd();\r\n        }\r\n\r\n        // Create checkbox\r\n        let checkboxField = new Field( 'checkbox', checkboxAttributes ),\r\n            $checkbox      = checkboxField.getFormElement();\r\n\r\n        // Bind changes\r\n        $checkbox.on( 'change', function(){\r\n            let isChecked = checkboxField.getValue();\r\n            checkboxField.startLoadingAnimation();\r\n\r\n            // Check if it's checked\r\n            if ( isChecked ){\r\n                // Add item to the recipe\r\n                restCall( 'add', {\r\n                    recipePostID: UncannyAutomator.recipe.id,\r\n                    action:       'add-new-closure',\r\n                    item_code:    closure.code,\r\n                    default_meta: {\r\n                        integration_name: UncannyAutomator.integrations[ closure.integration ].name,\r\n                        sentence:         closure.sentence\r\n                    }\r\n                }, ( response ) => {\r\n                    new Actions();\r\n\r\n                    // Check if the ID of the new item is defined\r\n                    if ( isDefined( response.post_ID ) ){\r\n                        // Get item form element\r\n                        const $newItem = getDOMElements( 'item', {\r\n                            id: response.post_ID\r\n                        });\r\n\r\n                        // Get first token and trigger a click\r\n                        $newItem.item.find( '.item-title__token:not(.item-title__token--filled)' ).first().trigger( 'click' );\r\n                    }\r\n                }, ( response ) => {\r\n                    console.log( '‼️ ERROR-TODO. Couldn\\'t add the closure' );\r\n\r\n                    // Stop the loading animation\r\n                    checkboxField.stopLoadingAnimation();\r\n\r\n                    // Change back the value of the checkbox\r\n                    checkboxField.setValue( false, false );\r\n                });\r\n            }\r\n            else {\r\n                restCall( 'delete', {\r\n                    ID: closureInRecipe.id\r\n                }, () => {\r\n                    new Actions();\r\n                }, () => {\r\n                    console.log( '‼️ ERROR-TODO. Couldn\\'t delete the closure' );\r\n\r\n                    new Actions();\r\n                });\r\n            }\r\n        });\r\n\r\n        // Append checkbox to the container\r\n        $container.append( $checkbox );\r\n\r\n        // Create toggle section\r\n        let $toggleContent = $( '<div/>', { 'class': 'uo-toggle uo-toggle--show' });\r\n\r\n        // Check if it was already added. In that case show it\r\n        if ( wasAdded ){\r\n            $toggleContent.addClass( 'uo-toggle--show' );\r\n\r\n            let $item = $( '<div/>', {\r\n                'class':   'item item--closure item--margintop',\r\n                'data-id': closureInRecipe.id\r\n            });\r\n\r\n            let $itemHeader = this.createHeader(\r\n                UncannyAutomator.recipe.items[ closureInRecipe.id ].integrationCode,\r\n                'closure',\r\n                closure.code,\r\n                closureInRecipe.id,\r\n            );\r\n\r\n            $item.append( $itemHeader );\r\n\r\n            let $itemContent = $( '<div/>', { 'class': 'item__content' });\r\n            $item.append( $itemContent );\r\n\r\n            $toggleContent.append( $item );\r\n        }\r\n    \r\n        $container.append( $toggleContent );\r\n\r\n        // Append everything to the metabox\r\n        this.elements.$metabox.append( $container );\r\n    }\r\n\r\n    /**\r\n     * Creates item header\r\n     * \r\n     * @since 0.5\r\n     *\r\n     * @param {string}    integrationCode - The integration code\r\n     * @param {string}    itemType - The item type: 'trigger', 'action' or 'closure'\r\n     * @param {string}    itemCode - The code of the item\r\n     * @param {int}       itemId - The ID of the item\r\n     */\r\n\r\n    createHeader( integrationCode, itemType, itemCode, itemId ){\r\n        let $container = $( '<div/>' ),\r\n            $title     = $( '<div/>', { 'class': 'item-title uap-clear' });\r\n\r\n        let $actions = new ItemHeaderMenu( itemType, integrationCode, itemCode, itemId );\r\n        $container.append( $actions );\r\n\r\n        let $icon    = new ItemHeaderIcon( integrationCode );\r\n        $container.append( $icon );\r\n        \r\n        let $itemTag = new ItemHeaderTag( integrationCode );\r\n        $title.append( $itemTag );\r\n\r\n        let $titleSentence = new ItemHeaderSentence( itemType, integrationCode, itemCode, itemId );\r\n        $title.append( $titleSentence );\r\n\r\n        $container.append( $title );\r\n\r\n        return $container;\r\n    }\r\n\r\n    getClosureByCodeFromItemsObject( code ){\r\n        let theItem;\r\n\r\n        $.each( UncannyAutomator.recipe.items, function( itemID, item ){\r\n            if ( item.itemCode == code ){\r\n                theItem = item;\r\n            }\r\n        })\r\n\r\n        return theItem;\r\n    }\r\n}\r\n\r\nexport default Closures;","import $ from 'jquery';\r\n\r\nimport flatpickr from \"flatpickr\";\r\n\r\nimport {\r\n\tAJAXRequest,\r\n\tcompareStrings,\r\n\tgetCurrentFieldsValues,\r\n\tgetField,\r\n\tgetFieldTypes,\r\n\tgetUniqueId,\r\n\tinArray,\r\n\tisDefined,\r\n\tisEmpty,\r\n\tdebounce,\r\n\tremoveSpaces,\r\n\tvsprintf\r\n} from './Utilities.js';\r\n\r\nimport {\r\n\tinitURLChecker,\r\n\tvalidateField\r\n} from './Validation.js';\r\n\r\nimport TokenSelector from './tokens/token-selector';\r\n\r\n/**\r\n * Create a field\r\n *\r\n * @since 0.4\r\n *\r\n * @param {string}              type - Field type\r\n * @param {object}              attributes - Object with information about the field\r\n * @param {string}              attributes.itemType             Item type. Valid values are trigger, action and closure.\r\n * @param {int}                 attributes.itemID               ID of the recipe item\r\n * @param {(null|string|array)} attributes.defaultValue         Default value of the field\r\n * @param {string}              attributes.currentValue         Current value of the field\r\n * @param {string}              attributes.placeholder          Placeholder of the field\r\n * @param {string}              attributes.isHidden             Defines if the field should be hidden\r\n * @param {string}              attributes.label                Label of the field\r\n * @param {string}              attributes.description          Description of the field\r\n * @param {object}              attributes.options              Only used if the field is a select. All the options of the select.\r\n * @param {null|string}         [attributes.color]              Only used for checkboxes. Valid values are null, 'gutenberg' or 'green'\r\n * @param {null|string}         [attributes.align]              Only used for checkboxes. Valid values are null, 'left' or 'right'\r\n * @param {object}              [attributes.toggle]             Only used for checkboxes. Has On and Off strings\r\n * @param {string}              [attributes.toggle.on]          String shown when the toggle is selected\r\n * @param {string}              [attributes.toggle.off]         String shown when the toggle is unselected\r\n *\r\n * @param {boolean}             attributes.isAjax               Only used if the field is a select. Add listner for the AJAX request.\r\n * @param {(null|string|array)} attributes.targetField          Only used if the field is a select. AJAX return values and populate this field.\r\n * @param {string}              attributes.integrationID        Integration of plugin\r\n * @param {string}              attributes.endPoint             endPoint for Ajax Call\r\n */\r\n\r\nclass Field {\r\n\tconstructor( type, attributes, createDOMelements = true, customValidationFunction = null ){\r\n\t\tthis.type = type;\r\n\t\t\r\n\t\tthis.attributes \t\t\t  = this.setAttributes( attributes );\r\n\t\tthis.customValidationFunction = customValidationFunction;\r\n\r\n\t\tif ( createDOMelements ){\r\n\t\t\tthis.createFormElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Create a jQuery DOM element with the field\r\n\t *\r\n\t * @since 0.3\r\n\t */\r\n\r\n\tcreateFormElement( initLibraries = true ){\r\n\t\t// Create response object\r\n\t\tlet response = null;\r\n\r\n\t\t// Local variables\r\n\t\tlet type = this.type;\r\n\t  \tlet attributes = this.attributes;\r\n\r\n\t\t// Check if it's a valid field type\r\n\t\tif ( inArray( type, getFieldTypes() ) ){\r\n\t\t\t// Create form element container, this is global\r\n\t\t\tlet formElement = $( '<div/>', { 'class': 'form-element' } );\r\n\r\n\t\t\t// Check the user is trying to add a custom class to the formElement element\r\n\t\t\tif ( isDefined( attributes.formElementClass ) ){\r\n\t\t\t\tformElement.addClass( attributes.formElementClass );\r\n\t\t\t}\r\n\r\n\t\t\t// Fields attributes, those will be added to the field jQuery object\r\n\t\t\tlet fieldAttributes = {\r\n\t\t\t\t'name':                  attributes.optionCode,\r\n\t\t\t\t'id':                    attributes.uniqueFieldID,\r\n\r\n\t\t\t\t'data-isajax':           attributes.isAjax,\r\n\t\t\t\t'data-targetfield':      attributes.targetField,\r\n\t\t\t\t'data-integrationid':    attributes.integrationID,\r\n\t\t\t\t'data-endPoint':         attributes.endPoint,\r\n\r\n\t\t\t\t'data-supportsTokens':   attributes.supportsTokens,\r\n\t\t\t\t'data-supportsTinymce':  attributes.supportsTinyMCE,\r\n\t\t\t\t'data-required':         attributes.isRequired,\r\n\t\t\t\t'data-item_type':        attributes.itemType,\r\n\t\t\t\t'data-item-id':          attributes.itemId,\r\n\r\n\t\t\t\t'data-option-group':     attributes.groupId,\r\n\r\n\t\t\t\t'data-is-hidden':        attributes.isHidden,\r\n\t\t\t\t'data-is-child-field':   attributes.isChildField,\r\n\t\t\t}\r\n\r\n\t\t\t// Define field container variable once. An different jQuery object will be created based on the field type\r\n\t\t\tlet fieldContainer, field;\r\n\r\n\t\t\t// Create field based in field type\r\n\t\t\tswitch ( type ){\r\n\t\t\t\tcase 'select':\r\n\t\t\t\t\t// Field container\r\n\t\t\t\t\tfieldContainer = $( '<div/>', {\r\n\t\t\t\t\t\t'class': 'form-select'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tthis.fieldContainer = fieldContainer;\r\n\r\n\t\t\t\t\t// Create select element and add fieldAttributes to jQuery object. Merge second object into fieldAttributes, recursively\r\n\t\t\t\t\tfield = $( '<select/>', $.extend( {}, fieldAttributes, {\r\n\t\t\t\t\t\t'data-type': 'select',\r\n\t\t\t\t\t\t'class':\t 'form-element__select',\r\n\t\t\t\t\t\t'data-supports-custom-value': attributes.supportsCustomValue,\r\n\t\t\t\t\t}));\r\n\r\n\t\t\t\t\t// Check if it supports multiple values\r\n\t\t\t\t\tif ( attributes.supportsMultipleValues ){\r\n\t\t\t\t\t\t// Make it a multiple select\r\n\t\t\t\t\t\tfield.prop( 'multiple', 'multiple' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.field = field;\r\n\r\n\t\t\t\t\tlet hasSelectedOption = false,\r\n\t\t\t\t\t\tnumberOfOptions = 0,\r\n\t\t\t\t\t\tdefaultValue,\r\n\t\t\t\t\t\tdefaultOptionExists;\r\n\r\n\t\t\t\t\t// Check if it has default option and get the default option's value\r\n\t\t\t\t\tif ( attributes.hasDefaultValue ){\r\n\t\t\t\t\t\tif ( ! isEmpty( attributes.defaultValue.option_value ) && ! isEmpty( attributes.defaultValue.option_name ) ){\r\n\t\t\t\t\t\t\t// The default option has value and name, so we have to add a new option instead of searching for one\r\n\t\t\t\t\t\t\tdefaultValue = attributes.defaultValue.option_value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tdefaultValue = attributes.defaultValue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Create select options\r\n\t\t\t\t\tlet $normalOptions = $(\r\n\t\t\t\t\t\t`<optgroup\r\n\t\t\t\t\t\t\ttitle=\"form-element__select-normal-options\"\r\n\t\t\t\t\t\t\tclass=\"form-element__select-normal-options\">\r\n\t\t\t\t\t\t</optgroup>` \r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// console.log( attributes.label );\r\n\t\t\t\t\t// console.log( '👉 Original value: ' + attributes.currentValue );\r\n\r\n\t\t\t\t\t// Remove the \"automator_custom_value\" option\r\n\t\t\t\t\tattributes.options = attributes.options.filter(( option ) => {\r\n\t\t\t\t\t\treturn option.value !== 'automator_custom_value';\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$.each( attributes.options, function ( value, option_data ){\r\n\t\t\t\t\t\tlet selectOption = $( '<option/>', {\r\n\t\t\t\t\t\t\t'value':  option_data.value,\r\n\t\t\t\t\t\t\t'text':\t  option_data.text\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Check if one of the options value match with the default value. In that case, just select it instead of creating another one with the same value\r\n\t\t\t\t\t\tif ( attributes.hasDefaultValue && compareStrings( defaultValue, value ) ){\r\n\t\t\t\t\t\t\tselectOption.prop( 'selected', true );\r\n\t\t\t\t\t\t\tdefaultOptionExists = true;\r\n\t\t\t\t\t\t\thasSelectedOption   = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// But also check if the select has a value (and it's not empty), in that case we have to select that one\r\n\t\t\t\t\t\tif ( attributes.hasValue && compareStrings( attributes.currentValue, option_data.value ) ){\r\n\t\t\t\t\t\t\tselectOption.prop( 'selected', true );\r\n\t\t\t\t\t\t\thasSelectedOption = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tselectOption.appendTo( $normalOptions );\r\n\t\t\t\t\t\tnumberOfOptions++;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// Append options to the field\r\n\t\t\t\t\t$normalOptions.appendTo( field );\r\n\r\n\t\t\t\t\t// ⚠️ Check if it's a multiselect\r\n\t\t\t\t\tif ( attributes.supportsMultipleValues ){\r\n\t\t\t\t\t\t// If so, check if it's has a current value\r\n\t\t\t\t\t\tif ( ! isEmpty( attributes.currentValue ) ){\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tfield.val( attributes.currentValue );\r\n\t\t\t\t\t\t\t} catch ( e ){\r\n\t\t\t\t\t\t\t\t// console.log( e );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Check if it has a selected value\r\n\t\t\t\t\t\tif ( ! isEmpty( field.val() ) ){\r\n\t\t\t\t\t\t\thasSelectedOption = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if an option was selected, if not then check if we have a default option that doesn't exist in the select, in that case, create one\r\n\t\t\t\t\tif ( attributes.hasDefaultValue && ! defaultOptionExists ){\r\n\t\t\t\t\t\t// Create option\r\n\t\t\t\t\t\tif ( ! isEmpty( attributes.defaultValue.option_value ) && ! isEmpty( attributes.defaultValue.option_name ) ){\r\n\r\n\t\t\t\t\t\t\tlet defaultOption = $( '<option/>', {\r\n\t\t\t\t\t\t\t\t'value': attributes.defaultValue.option_value,\r\n\t\t\t\t\t\t\t\t'text':  attributes.defaultValue.option_name\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif ( ! attributes.hasValue && ! compareStrings( attributes.defaultValue.option_value, attributes.currentValue ) ){\r\n\t\t\t\t\t\t\t\tdefaultOption.prop( 'selected', true );\r\n\t\t\t\t\t\t\t\thasSelectedOption = true;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Add first (or second, if the select has a placeholder)\r\n\t\t\t\t\t\t\tdefaultOption.prependTo( field );\r\n\t\t\t\t\t\t\tnumberOfOptions++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if we have to add a placeholder\r\n\t\t\t\t\tif ( attributes.hasPlaceholder ){\r\n\t\t\t\t\t\t// Add empty option at the top\r\n\t\t\t\t\t\tfield.prepend( '<option></option>' );\r\n\r\n\t\t\t\t\t\t// If nothing else is selected, then remove the selected\r\n\t\t\t\t\t\t// value of the select\r\n\t\t\t\t\t\tif ( ! attributes.hasDefaultValue && ! attributes.hasValue ){\r\n\t\t\t\t\t\t\tfield.find( 'option:selected' ).prop( 'selected', false );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if this select supports the token selector\r\n\t\t\t\t\t// If it does, create the \"Custom value\" field\r\n\t\t\t\t\tif ( attributes.supportsCustomValue ){\r\n\t\t\t\t\t\tlet customFieldValue = attributes.customValue;\r\n\r\n\t\t\t\t\t\t// Create \"Other options\" section\r\n\t\t\t\t\t\tconst $otherOptions = $( `\r\n\t\t\t\t\t\t\t<optgroup label=\"${ UncannyAutomator.i18n.validation.field.select.otherOptions }\">\r\n\t\t\t\t\t\t\t\t<option value=\"automator_custom_value\">${ UncannyAutomator.i18n.validation.field.select.customValue }</option>\r\n\t\t\t\t\t\t\t</optgroup>\r\n\t\t\t\t\t\t` );\r\n\r\n\t\t\t\t\t\t// Append \"Other options\" to the field\r\n\t\t\t\t\t\tfield.append( $otherOptions );\r\n\r\n\t\t\t\t\t\t// Check if we have to select it\r\n\t\t\t\t\t\tif ( attributes.hasValue && compareStrings( attributes.currentValue, 'automator_custom_value' ) ){\r\n\t\t\t\t\t\t\t// Select that option\r\n\t\t\t\t\t\t\t$otherOptions.find( 'option' ).attr( 'selected', true );\r\n\t\t\t\t\t\t\thasSelectedOption = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Check if it doesn't have a selected value\r\n\t\t\t\t\t\tif ( attributes.hasValue && ! hasSelectedOption ){\r\n\t\t\t\t\t\t\t// Select that option\r\n\t\t\t\t\t\t\t$otherOptions.find( 'option' ).attr( 'selected', true );\r\n\t\t\t\t\t\t\thasSelectedOption = true;\r\n\r\n\t\t\t\t\t\t\t// Set the current value as the custom value\r\n\t\t\t\t\t\t\tcustomFieldValue = attributes.currentValue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Create the custom field\r\n\t\t\t\t\t\tthis.customValueField = new Field( 'text', {\r\n\t\t\t\t\t\t\titemId: attributes.itemId,\r\n\t\t\t\t\t\t\titemType: attributes.itemType,\r\n\r\n\t\t\t\t\t\t\tisRequired: attributes.isRequired,\r\n\t\t\t\t\t\t\tisReadOnly: false,\r\n\t\t\t\t\t\t\tsupportsTinyMCE: false,\r\n\t\t\t\t\t\t\tsupportsCopyToClipboard: false,\r\n\t\t\t\t\t\t\tsupportsTokens: attributes.supportsTokens,\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tisAjax: false, //\r\n\r\n\t\t\t\t\t\t\tfieldType: 'text', \r\n\t\t\t\t\t\t\toptionCode: `${ attributes.optionCode }_custom`,\r\n\r\n\t\t\t\t\t\t\tlabel: '',\r\n\t\t\t\t\t\t\tdescription: attributes.hasCustomValueDescription ? attributes.customValueDescription : undefined,\r\n\t\t\t\t\t\t\tplaceholder: '',\r\n\t\t\t\t\t\t\tisHidden: false,\r\n\t\t\t\t\t\t\ttokenName: vsprintf( UncannyAutomator.i18n.validation.field.select.customValueToken, [ attributes.label ]),\r\n\r\n\t\t\t\t\t\t\tdefaultValue: null,\r\n\t\t\t\t\t\t\tcurrentValue: customFieldValue,\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tisChildField: true,\r\n\t\t\t\t\t\t\tparentOptionCode: attributes.optionCode\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Has a selected option\r\n\t\t\t\t\tthis.selectHasSelectedOption = hasSelectedOption;\r\n\r\n\t\t\t\t\t// Check if it has options, if it doesn't then add one and disable\r\n\t\t\t\t\tif ( numberOfOptions == 0 ){\r\n\t\t\t\t\t\tlet $noResults = $( ( new Option( UncannyAutomator.i18n.noResults, '', true, true ) ) );\r\n\r\n\t\t\t\t\t\t$noResults.prop( 'disabled', true );\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.field.find( '.form-element__select-normal-options' ).append( $noResults );\r\n\r\n\t\t\t\t\t\tif ( ! this.attributes.supportsCustomValue ){\r\n\t\t\t\t\t\t\t// Disable the select\r\n\t\t\t\t\t\t\tthis.field.prop( 'disabled', true );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Bind changes\r\n\t\t\t\t\tfield.on( 'change', function( event, customData ){\r\n\t\t\t\t\t\tformElement.trigger( 'automator:field:change', customData );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'text':\r\n\t\t\t\tcase 'url':\r\n\t\t\t\tcase 'email':\r\n\t\t\t\tcase 'int':\r\n\t\t\t\tcase 'float':\r\n\t\t\t\tcase 'date':\r\n\t\t\t\tcase 'time':\r\n\t\t\t\t\t// FALLTHROUGH: These fields share the same structure as all of them are input text. The validation is done by another function. For now, these fields types only have two differences, the CSS class added in fieldContainer and the type property of the attributes object added to the field variable.\r\n\r\n\t\t\t\t\t// Create CSS classes that will be used by the field container element. This will create classes like \"form-input--url\". They are not used for validation but are useful to add custom CSS to each field\r\n\t\t\t\t\tlet fieldContainerClass = `form-input form-input--${ type }`;\r\n\r\n\t\t\t\t\t// Field container\r\n\t\t\t\t\tfieldContainer = $( '<div/>', {\r\n\t\t\t\t\t\t'class': fieldContainerClass\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t// Add the CodeMirror field\r\n\t\t\t\t\tconst $fakeCodemirrorField = $( '<div/>', {\r\n\t\t\t\t\t\t'class': 'form-element__input-cm'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tthis.$fakeCodemirrorField = $fakeCodemirrorField;\r\n\r\n\t\t\t\t\tfieldContainer.append( $fakeCodemirrorField );\r\n\r\n\t\t\t\t\tthis.fieldContainer = fieldContainer;\r\n\r\n\t\t\t\t\t// Create input element and add fieldAttributes to jQuery object. Merge second object into fieldAttributes, recursively\r\n\t\t\t\t\tfield = $( '<input/>', $.extend( {}, fieldAttributes, {\r\n\t\t\t\t\t\t'class':     'form-element__input',\r\n\t\t\t\t\t\t'type':      'text',\r\n\t\t\t\t\t\t'data-type': type,\r\n\t\t\t\t\t}));\r\n\r\n\t\t\t\t\t// Check if maxlength is defined\r\n\t\t\t\t\tif ( isDefined( attributes.maxLength ) ){\r\n\t\t\t\t\t\tfield.prop( 'maxlength', attributes.maxLength );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.field = field;\r\n\r\n\t\t\t\t\t// Add tokens CSS class to field. This will be used to render the Token Selector once the element is added to the DOM\r\n\t\t\t\t\tif ( attributes.supportsTokens ){\r\n\t\t\t\t\t\tfieldContainer.addClass( 'form-input--token' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if the field has a placeholder and add it\r\n\t\t\t\t\tif ( attributes.hasPlaceholder ){\r\n\t\t\t\t\t\tfield.prop( 'placeholder', attributes.placeholder );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if the field has a value and add it\r\n\t\t\t\t\tif ( attributes.hasValue ){\r\n\t\t\t\t\t\tfield.prop( 'value', attributes.currentValue );\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Now that we now that the field doesn't have a value we can check if the developer defined a default value\r\n\t\t\t\t\t\tif ( attributes.hasDefaultValue ){\r\n\t\t\t\t\t\t\tfield.prop( 'value', attributes.defaultValue );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Add \"clear\" button to date and time fields\r\n\t\t\t\t\tif ( [ 'date', 'time' ].includes( attributes.fieldType ) ){\r\n\t\t\t\t\t\t// Add button\r\n\t\t\t\t\t\tconst $clearButton = $( `\r\n\t\t\t\t\t\t\t\t<div class=\"form-element__input-clear\" uap-tooltip=\"${ UncannyAutomator.i18n.clear }\">\r\n\t\t\t\t\t\t\t\t\t<span class=\"uo-icon uo-icon--times\"></span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t` );\r\n\r\n\t\t\t\t\t\t// Add class to the container\r\n\t\t\t\t\t\tfieldContainer\r\n\t\t\t\t\t\t\t.addClass( 'form-input--has-clear' );\r\n\r\n\t\t\t\t\t\t// Append the clear button\r\n\t\t\t\t\t\tthis.$fakeCodemirrorField\r\n\t\t\t\t\t\t\t.append( $clearButton );\r\n\r\n\t\t\t\t\t\t// Listen clicks to the button\r\n\t\t\t\t\t\t$clearButton.on( 'click', () => {\r\n\t\t\t\t\t\t\tthis.clearValue();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Bind changes\r\n\t\t\t\t\tfield.on( 'input', function(){\r\n\t\t\t\t\t\tformElement.trigger( 'automator:field:change' );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'textarea':\r\n\t\t\t\t\t// Field container\r\n\t\t\t\t\tfieldContainer = $( '<div/>', {'class': 'form-textarea'} );\r\n\r\n\t\t\t\t\tthis.fieldContainer = fieldContainer;\r\n\r\n\t\t\t\t\t// Create textarea\r\n\t\t\t\t\tfield = $( '<textarea/>', $.extend( true, fieldAttributes, {\r\n\t\t\t\t\t\t'data-type':\t\t 'text',\r\n\t\t\t\t\t\t'class':\t\t\t 'form-element__textarea',\r\n\t\t\t\t\t\t'data-item_type':\t attributes.itemType\r\n\t\t\t\t\t}));\r\n\r\n\t\t\t\t\t// Check if maxlength is defined\r\n\t\t\t\t\tif ( isDefined( attributes.maxLength ) ){\r\n\t\t\t\t\t\tfield.prop( 'maxlength', attributes.maxLength );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.field = field;\r\n\r\n\t\t\t\t\t// Add tokens CSS class to field. This will be used to render the Token Selector once the element is added to the DOM\r\n\t\t\t\t\tif ( attributes.supportsTokens ){\r\n\t\t\t\t\t\tfieldContainer.addClass( 'form-textarea--token' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if the field has a placeholder and add it\r\n\t\t\t\t\tif ( attributes.hasPlaceholder ){\r\n\t\t\t\t\t\tfield.prop( 'placeholder', attributes.placeholder );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if the field has a value and add it\r\n\t\t\t\t\tif ( attributes.hasValue ){\r\n\t\t\t\t\t\tfield.text( attributes.currentValue );\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Now that we now that the field doesn't have a value we can check if the developer defined a default value\r\n\t\t\t\t\t\tif ( attributes.hasDefaultValue ){\r\n\t\t\t\t\t\t\tfield.text( attributes.defaultValue );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Bind changes\r\n\t\t\t\t\tfield.on( 'input', function(){\r\n\t\t\t\t\t\tformElement.trigger( 'automator:field:change' );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t   \r\n\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\t// Field container\r\n\t\t\t\t\tfieldContainer = $( '<div/>', {'class': 'form-checkbox' } );\r\n\r\n\t\t\t\t\tthis.fieldContainer = fieldContainer;\r\n\r\n\t\t\t\t\tlet checkboxLabel = $( '<label/>', {'class': 'form-checkbox__container' } );\r\n\t\t\t\t\tlet checkboxPseudo = $( '<div/>', {'class': 'checkbox--show' } );\r\n\r\n\t\t\t\t\t// Create checkbox\r\n\t\t\t\t\tfield = $( '<input/>', $.extend( {}, fieldAttributes, {\r\n\t\t\t\t\t\t'type':\t     'checkbox',\r\n\t\t\t\t\t\t'data-type': 'checkbox',\r\n\t\t\t\t\t\t'class':\t 'checkbox--hidden checkbox--primary',\r\n\t\t\t\t\t}));\r\n\r\n\t\t\t\t\t// Check if checked by default\r\n\t\t\t\t\tif ( attributes.hasValue && attributes.currentValue ){\r\n\t\t\t\t\t\tfield.prop( 'checked', true );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.field = field;\r\n\r\n\t\t\t\t\t// Add label\r\n\t\t\t\t\tif ( attributes.hasLabel ){\r\n\t\t\t\t\t\tcheckboxLabel.html( attributes.label );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Append elements\r\n\t\t\t\t\tfieldContainer.append( checkboxLabel );\r\n\t\t\t\t\tcheckboxLabel.append( field );\r\n\t\t\t\t\tcheckboxLabel.append( checkboxPseudo );\r\n\r\n\t\t\t\t\t// Check if we have to render a Toggle\r\n\t\t\t\t\tif ( isDefined( attributes.isToggle ) && attributes.isToggle ){\r\n\t\t\t\t\t\tfieldContainer.addClass( 'form-checkbox--toggle' );\r\n\r\n\t\t\t\t\t\t// Check if we have to add on and off strings divs\r\n\t\t\t\t\t\tif ( isDefined( attributes.toggle ) ){\r\n\t\t\t\t\t\t\t// Check \"on\"\r\n\t\t\t\t\t\t\tif ( isDefined( attributes.toggle.on ) ){\r\n\t\t\t\t\t\t\t\tlet checkboxToggleOn = $( '<span/>', { 'class': 'checkbox-label checkbox-label--on' }).text( attributes.toggle.on );\r\n\t\t\t\t\t\t\t\tcheckboxLabel.append( checkboxToggleOn );\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Check \"off\"\r\n\t\t\t\t\t\t\tif ( isDefined( attributes.toggle.off ) ){\r\n\t\t\t\t\t\t\t\tlet checkboxToggleOff = $( '<span/>', { 'class': 'checkbox-label checkbox-label--off' }).text( attributes.toggle.off );\r\n\t\t\t\t\t\t\t\tcheckboxLabel.append( checkboxToggleOff );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Define color\r\n\t\t\t\t\tif ( isDefined( attributes.color ) ){\r\n\t\t\t\t\t\t// Check if the color is valid\r\n\t\t\t\t\t\tif ( inArray( attributes.color, [ 'gutenberg', 'green' ] ) ){\r\n\t\t\t\t\t\t\t// Add class\r\n\t\t\t\t\t\t\tswitch ( attributes.color ){\r\n\t\t\t\t\t\t\t\tcase 'gutenberg':\r\n\t\t\t\t\t\t\t\t\tfieldContainer.addClass( 'form-checkbox--toggle-gutenberg' );\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\tcase 'green':\r\n\t\t\t\t\t\t\t\t\tfieldContainer.addClass( 'form-checkbox--toggle-green' );\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tconsole.error( vsprintf( 'The color %s does not exists. Default color will be used instead.', [ attributes.color ] ) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Define align\r\n\t\t\t\t\tif ( isDefined( attributes.align ) ){\r\n\t\t\t\t\t\t// Check if it's a valid value\r\n\t\t\t\t\t\tif ( inArray( attributes.align, [ 'left', 'right' ] ) ){\r\n\t\t\t\t\t\t\t// Check if it's 'right', otherwise ignore, since 'left' doesn't needs a class\r\n\t\t\t\t\t\t\tif ( attributes.align == 'right' ){\r\n\t\t\t\t\t\t\t\t// Add class\r\n\t\t\t\t\t\t\t\tfieldContainer.addClass( 'form-checkbox--toggle-right' );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tconsole.error( vsprintf( 'The alignment %s does not exists. %s will be used instead.', [ attributes.align, '\"left\"' ] ) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Bind changes\r\n\t\t\t\t\tfield.on( 'change', function( event, customData ){\r\n\t\t\t\t\t\tformElement.trigger( 'automator:field:change', customData );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Change field variable with all the container\r\n\t\t\t\t\tfield = checkboxLabel;\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'radio':\r\n\t\t\t\t\t// Field container\r\n\t\t\t\t\tfieldContainer = $( '<div/>', {'class': 'form-radio' } );\r\n\t\t\t\t\tthis.fieldContainer = fieldContainer;\r\n\r\n\t\t\t\t\t// Create array to save all the jQuery DOM elements\r\n\t\t\t\t\tlet $fields = $(),\r\n\t\t\t\t\t\t$fieldContainers = $();\r\n\r\n\t\t\t\t\t// Iterate options\r\n\t\t\t\t\t$.each( attributes.options, function( index, option ){\r\n\t\t\t\t\t\t// Create container\r\n\t\t\t\t\t\tconst $formRadioContainer = $( '<label/>', { 'class': 'form-radio__container' });\r\n\r\n\t\t\t\t\t\t// Add label\r\n\t\t\t\t\t\t$formRadioContainer.html( option.text );\r\n\r\n\t\t\t\t\t\t// Create radio\r\n\t\t\t\t\t\tconst $field = $( '<input/>', $.extend( {}, fieldAttributes, {\r\n\t\t\t\t\t\t\t'type':\t     'radio',\r\n\t\t\t\t\t\t\t'data-type': 'radio',\r\n\t\t\t\t\t\t\t'class':\t 'radio--hidden radio--primary',\r\n\r\n\t\t\t\t\t\t\t'value':      option.value,\r\n\t\t\t\t\t\t\t'name':       fieldAttributes.id\r\n\t\t\t\t\t\t}));\r\n\r\n\t\t\t\t\t\t// Save radio\r\n\t\t\t\t\t\t$fields = $fields.add( $field );\r\n\r\n\t\t\t\t\t\t// Create fake radio\r\n\t\t\t\t\t\tconst $fakeRadio = $( '<div/>', { 'class': 'radio--show' });\r\n\r\n\t\t\t\t\t\t// Append elements\r\n\t\t\t\t\t\t$formRadioContainer.append( $field );\r\n\t\t\t\t\t\t$formRadioContainer.append( $fakeRadio );\r\n\r\n\t\t\t\t\t\t// Check if this field has a value, if it does, and the value\r\n\t\t\t\t\t\t// matches the input radio name, then check it\r\n\t\t\t\t\t\tif ( attributes.hasValue && attributes.currentValue == option.value ){\r\n\t\t\t\t\t\t\t$field.prop( 'checked', true );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Otherwise, check if it has a default value and use that\r\n\t\t\t\t\t\telse if ( ! attributes.hasValue && attributes.hasDefaultValue && attributes.defaultValue == option.value ){\r\n\t\t\t\t\t\t\t$field.prop( 'checked', true );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Save container\r\n\t\t\t\t\t\t$fieldContainers = $fieldContainers.add( $formRadioContainer );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Save fields\r\n\t\t\t\t\tthis.field = $fieldContainers;\r\n\t\t\t\t\tfield = $fieldContainers;\r\n\r\n\t\t\t\t\t// Bind changes\r\n\t\t\t\t\t$fields.on( 'change', ( event, customData ) => {\r\n\t\t\t\t\t\t// Check if the value is different\r\n\t\t\t\t\t\tformElement.trigger( 'automator:field:change', customData );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Append field jQuery object to field container\r\n\t\t\tfieldContainer.append( field );\r\n\r\n\t\t\t// Create label\r\n\r\n\t\t\t// Create Label, even if it's empty but the field is required, so we can add the asterisk\r\n\t\t\tlet fieldLabel;\r\n\r\n\t\t\tif ( type != 'checkbox' && ( attributes.hasLabel || attributes.isRequired ) ){\r\n\t\t\t\tfieldLabel = $( '<label/>', {\r\n\t\t\t\t\t'class': 'form-element__label',\r\n\t\t\t\t\t'for': \t attributes.uniqueFieldID\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Add label text\r\n\t\t\t\tif ( attributes.hasLabel ){\r\n\t\t\t\t\tfieldLabel.html( attributes.label );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it's a required field\r\n\t\t\tif ( attributes.isRequired ){\r\n\t\t\t\t// Add required class to the field container\r\n\t\t\t\tfieldContainer.addClass( 'form-element--required' );\r\n\r\n\t\t\t\t// Check if it's a checkbox\r\n\t\t\t\tif ( attributes.fieldType == 'checkbox' ){\r\n\t\t\t\t\t// Add required attribute to the field\r\n\t\t\t\t\tfield.find( 'input' ).prop( 'required', true );\r\n\r\n\t\t\t\t\t// Add asterisk to the label\r\n\t\t\t\t\tif ( attributes.hasLabel ){\r\n\t\t\t\t\t\t// Add required icon next to label\r\n\t\t\t\t\t\tlet fieldLabelAsterisk = $( '<span/>', { 'class': 'form-element-label__required' } );\r\n\t\t\t\t\t\tfield.append( fieldLabelAsterisk );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Add required attribute to the field\r\n\t\t\t\t\tfield.prop( 'required', true );\r\n\r\n\t\t\t\t\t// Add asterisk to the label\r\n\t\t\t\t\tif ( attributes.hasLabel ){\r\n\t\t\t\t\t\t// Add required icon next to label\r\n\t\t\t\t\t\tlet fieldLabelAsterisk = $( '<span/>', { 'class': 'form-element-label__required' } );\r\n\t\t\t\t\t\tfieldLabel.append( fieldLabelAsterisk );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it's\r\n\t\t\tif ( isDefined( attributes.isReadOnly ) && attributes.isReadOnly ){\r\n\t\t\t\t// Check if it's a select\r\n\t\t\t\tif ( attributes.fieldType == 'select' ){\r\n\t\t\t\t\t// Disable the select\r\n\t\t\t\t\tfield.prop( 'disabled', true );\r\n\t\t\t\t}\r\n\t\t\t\telse if ( [ 'checkbox', 'radio' ].includes( attributes.fieldType ) ){\r\n\t\t\t\t\t// Disable the radio and checkbox\r\n\t\t\t\t\tfield.find( 'input' ).prop( 'disabled', true );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Add read only attribute to the field\r\n\t\t\t\t\tfield.prop( 'readonly', true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Append label element if is defined\r\n\t\t\tif ( attributes.hasLabel || attributes.isRequired ){\r\n\t\t\t\tfieldContainer.prepend( fieldLabel );\r\n\t\t\t}\r\n\r\n\t\t\t// Error container\r\n\t\t\tlet fieldError = $( '<div/>', { 'class': 'form-element__error' });\r\n\t\t\tfieldContainer.append( fieldError );\r\n\r\n\t\t\tthis.fieldContainer = fieldContainer;\r\n\r\n\t\t\t// Field description\r\n\t\t\tif ( attributes.hasDescription ){\r\n\t\t\t\tlet fieldDescription = $( '<div/>', { 'class': 'description' } );\r\n\t\t\t\tfieldDescription.html( attributes.description );\r\n\t\t\t\tfieldContainer.append( fieldDescription );\r\n\t\t\t}\r\n\r\n\t\t\t// Check if the field is hidden\r\n\t\t\tif ( attributes.isHidden ){\r\n\t\t\t\t// Add class to hide the field container\r\n\t\t\t\tfieldContainer.addClass( 'form-element--hidden' );\r\n\t\t\t}\r\n\r\n\t\t\t// Append everything to the form element container\r\n\t\t\tformElement.append( fieldContainer );\r\n\r\n\t\t\t// Check if it's a select and has a customField defined,\r\n\t\t\t// if so, add it\r\n\t\t\tif ( attributes.fieldType == 'select' && isDefined( this.customValueField ) ){\r\n\t\t\t\t// Create container for the custom value field\r\n\t\t\t\tthis.customValueFieldContainer = $(\r\n\t\t\t\t\t`<div class=\"form-select-custom\">\r\n\t\t\t\t\t\t<div class=\"form-element-children\"></div>\r\n\t\t\t\t\t</div>`\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Get the form element\r\n\t\t\t\tthis.customValueFieldContainer.find( '.form-element-children' ).append( this.customValueField.createFormElement() );\r\n\r\n\t\t\t\t// Append it\r\n\t\t\t\tformElement.append( this.customValueFieldContainer );\r\n\r\n\t\t\t\t// Check if we have to show the custom field\r\n\t\t\t\tif ( this.getValue() == 'automator_custom_value' ){\r\n\t\t\t\t\tthis.customValueFieldContainer.addClass( 'form-select-custom--visible' );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.customValueFieldContainer.removeClass( 'form-select-custom--visible' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Response\r\n\t\t\tresponse = formElement;\r\n\r\n\t\t\t// Save Form Element\r\n\t\t\tthis.formElement = formElement;\r\n\r\n\t\t\t// Init libraries\r\n\t\t\tif ( initLibraries ){\r\n\t\t\t\tthis.initLibraries();\r\n\t\t\t}\r\n\r\n\t\t\t// Trigger methods on change\r\n\t\t\tthis.onChange();\r\n\r\n\t\t\t// Trigger methods on focus\r\n\t\t\tthis.onFocus();\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Error: Invalid field type\r\n\t\t\tconsole.error( vsprintf( 'The field type \"%s\" is invalid. The valid ones are %s', [ type, getFieldTypes().join( ', ' ) ] ) );\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Set attributes. It add properties like hasValue, hasPlaceholder, etc, automatically\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @param  {object} attributes - The field attributes\r\n\t *\r\n\t * @return {object} attributes - The field attributes\r\n\t */\r\n\r\n\tsetAttributes( attributes ){\r\n\t\t// Save field type in the attributes\r\n\t\tattributes.fieldType = this.type;\r\n\r\n\t\t// Create an unique ID\r\n\t\tattributes.uniqueFieldID = `${ attributes.optionCode }__${ getUniqueId() }`;\r\n\r\n\t\t// Check if it's a checkbox and sanitaze the current value\r\n\t\tif ( attributes.fieldType == 'checkbox' && ! isEmpty( attributes.currentValue ) ){\r\n\t\t\t// Check if the value is \"true\" or \"false\"\r\n\t\t\tif ( [ 'true', 'false' ].includes( attributes.currentValue ) ){\r\n\t\t\t\t// Make it a boolean\r\n\t\t\t\tattributes.currentValue = attributes.currentValue == 'true' ? true : false;\r\n\r\n\t\t\t\t// If it's false, set hasValue to false\r\n\t\t\t\tif ( ! attributes.currentValue ){\r\n\t\t\t\t\tattributes.hasValue = false;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tattributes.hasValue = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has value\r\n\t\tif ( ! isDefined( attributes.hasValue ) ){\r\n\t\t\tif ( ! isEmpty( attributes.currentValue ) ){\r\n\t\t\t\tattributes.hasValue = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasValue = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has placeholder\r\n\t\tif ( ! isDefined( attributes.hasPlaceholder ) ){\r\n\t\t\tif ( ! isEmpty( attributes.placeholder ) ){\r\n\t\t\t\tattributes.hasPlaceholder = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasPlaceholder = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has default value\r\n\t\tif ( ! isDefined( attributes.hasDefaultValue ) ){\r\n\t\t\tif ( ! isEmpty( attributes.defaultValue ) ){\r\n\t\t\t\tattributes.hasDefaultValue = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasDefaultValue = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has label\r\n\t\tif ( ! isDefined( attributes.hasLabel ) ){\r\n\t\t\tif ( ! isEmpty( attributes.label ) ){\r\n\t\t\t\tattributes.hasLabel = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasLabel = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has description\r\n\t\tif ( ! isDefined( attributes.hasDescription ) ){\r\n\t\t\tif ( ! isEmpty( attributes.description ) ){\r\n\t\t\t\tattributes.hasDescription = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasDescription = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Is Required\r\n\t\tif ( ! isDefined( attributes.isRequired ) ){\r\n\t\t\tattributes.isRequired = false;\r\n\t\t}\r\n\r\n\t\t// Is children\r\n\t\tif ( ! isDefined( attributes.isChildField ) ){\r\n\t\t\tattributes.isChildField = false;\r\n\t\t}\r\n\r\n\t\t// Supports tokens\r\n\t\tif ( ! isDefined( attributes.supportsTokens ) ){\r\n\t\t\tattributes.supportsTokens = false;\r\n\t\t}\r\n\r\n\t\t// Check if it can support tokens\r\n\t\tif ( attributes.supportsTokens && attributes.fieldType == 'select' && ! [ 'action', 'closure' ].includes( attributes.itemType ) ){\r\n\t\t\tattributes.supportsTokens = false;\r\n\t\t}\r\n\r\n\t\t// Check default value for readOnly\r\n\t\tif ( ! isDefined( attributes.isReadOnly ) ){\r\n\t\t\tattributes.isReadOnly = false;\r\n\t\t}\r\n\r\n\t\t// Check if it's a select\r\n\t\tif ( attributes.fieldType == 'select' ){\r\n\t\t\t// Check if it supports multiple values\r\n\t\t\tif ( ! isDefined( attributes.supportsMultipleValues ) ){\r\n\t\t\t\tattributes.supportsMultipleValues = false;\r\n\t\t\t}\r\n\r\n\t\t\t// ⚠️ Check if it supports multiple values, if it does,\r\n\t\t\t// don't support custom values.\r\n\t\t\tif ( attributes.supportsMultipleValues ){\r\n\t\t\t\tattributes.supportsCustomValue = false;\r\n\t\t\t}\r\n\r\n\t\t\t// ⚠️ Check if the current dropdown is a multiselect,\r\n\t\t\t// if so, check if it has a current value. In case it \r\n\t\t\t// has a value, try to parse it, because it might be a \r\n\t\t\t// JSON string\r\n\t\t\tif ( attributes.supportsMultipleValues ){\r\n\t\t\t\ttry {\r\n\t\t\t\t\tattributes.currentValue = JSON.parse( attributes.currentValue );\r\n\t\t\t\t} catch ( e ){\r\n\t\t\t\t\t// console.log( e );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it can support custom tokens\r\n\t\t\tif ( ! isDefined( attributes.supportsCustomValue ) ){\r\n\t\t\t\tattributes.supportsCustomValue = false;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it can support tokens, but can't support custom values\r\n\t\t\t// if ( attributes.supportsTokens && ! attributes.supportsCustomValue ){\r\n\t\t\t// \tattributes.supportsCustomValue = true;\r\n\t\t\t// }\r\n\r\n\t\t\t// Check if the user defined a description for the custom field too\r\n\t\t\tattributes.hasCustomValueDescription = ! isEmpty( attributes.customValueDescription );\r\n\t\t}\r\n\t\t\r\n\t\t// Check if it's a date field\r\n\t\tif ( attributes.fieldType == 'date' ){\r\n\t\t\tattributes.isReadOnly = true;\r\n\r\n\t\t\t// Check if it doesn't have a custom date format\r\n\t\t\tif ( ! isDefined( attributes.dateFormat ) ){\r\n\t\t\t\tattributes.dateFormat = 'Y-m-d';\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it doesn't have a custom date alt format\r\n\t\t\tif ( ! isDefined( attributes.dateAltFormat ) ){\r\n\t\t\t\tattributes.dateAltFormat = UncannyAutomator.format.date;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it has a min date\r\n\t\t\tif ( isDefined( attributes.minDate ) ){\r\n\t\t\t\tattributes.minDate = attributes.minDate;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it has a max date\r\n\t\t\tif ( isDefined( attributes.maxDate ) ){\r\n\t\t\t\tattributes.maxDate = attributes.maxDate;\r\n\t\t\t}\r\n\r\n\t\t\t// Set default value for the supports range option\r\n\t\t\tif ( ! isDefined( attributes.supportsRange ) ){\r\n\t\t\t\tattributes.supportsRange = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check if it's a time field\r\n\t\tif ( attributes.fieldType == 'time' ){\r\n\t\t\tattributes.isReadOnly = true;\r\n\r\n\t\t\t// Check if it doesn't have a custom time format\r\n\t\t\tif ( ! isDefined( attributes.timeFormat ) ){\r\n\t\t\t\tattributes.timeFormat = 'H:i K';\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it doesn't have a custom time alt format\r\n\t\t\tif ( ! isDefined( attributes.timeAltFormat ) ){\r\n\t\t\t\tattributes.timeAltFormat = 'H:i K';\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it has a min time\r\n\t\t\tif ( isDefined( attributes.minTime ) ){\r\n\t\t\t\tattributes.minTime = attributes.minTime;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it has a max time\r\n\t\t\tif ( isDefined( attributes.maxTime ) ){\r\n\t\t\t\tattributes.maxTime = attributes.maxTime;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Supports tinyMCE\r\n\t\tif ( ! isDefined( attributes.supportsTinyMCE ) ){\r\n\t\t\tattributes.supportsTinyMCE = false;\r\n\t\t}\r\n\r\n\t\t// Is Toggle\r\n\t\tif ( ! isDefined( attributes.isToggle ) && isDefined( attributes.toggle ) ){\r\n\t\t\tattributes.isToggle = true;\r\n\t\t}\r\n\r\n\t\t// Is AJAX\r\n\t\tif ( ! isDefined( attributes.isAjax ) ){\r\n\t\t\tattributes.isAjax = false;\r\n\t\t}\r\n\r\n\t\t// Set the default value for isHidden\r\n\t\tif ( ! isDefined( attributes.isHidden ) ){\r\n\t\t\tattributes.isHidden = false;\r\n\t\t}\r\n\r\n\t\treturn attributes;\r\n\t}\r\n\r\n\t/**\r\n\t * Validate field\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @param  {boolean} renderError - TRUE if you want to render the field errors, FALSE if you only want to return the response object\r\n\t *\r\n\t * @return {validateField} validateField object. Read the comments on Validation.js to learn more\r\n\t */\r\n\r\n\tvalidate( renderError = true ){\r\n\t\t// Parameters\r\n\r\n\t\t// Field (DOM)\r\n\t\tlet field = null,\r\n\t\t\tvalue;\r\n\r\n\t\tif ( renderError ){\r\n\t\t\tfield = this.getFieldContainer();\r\n\t\t\tvalue = this.getValue();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvalue = this.attributes.currentValue;\r\n\t\t}\r\n\r\n\t\t// Type\r\n\t\tlet fieldType = this.type;\r\n\r\n\t\t// Attributes\r\n\t\tlet attributes = {\r\n\t\t\tsupportsTokens: this.attributes.supportsTokens,\r\n\t\t\trequired:  \t    this.attributes.isRequired\r\n\t\t}\r\n\r\n\t\t// This uses the validateField function. Check Validation.js for more information\r\n\t\treturn validateField( field, this.type, value, attributes, this.customValidationFunction );\r\n\t}\r\n\r\n\t/**\r\n\t * Invoke functions on field change\r\n\t * Those functions are global for all the Field objects\r\n\t * Don't use directly, use 'automator:field:change' instead\r\n\t */\r\n\r\n\tonChange(){\r\n\t\tthis.formElement.on( 'automator:field:change', ( event, customData ) => {\r\n\t\t\t// Check if it's a select that supports custom values (and that option is selected)\r\n\t\t\t// console.log( this.attributes.label );\r\n\t\t\t// console.log( '> 🚨 Change (automator:field:change)' );\r\n\r\n\t\t\tif ( this.attributes.fieldType == 'select' && this.attributes.supportsCustomValue ){\r\n\t\t\t\tif ( this.getValue() == 'automator_custom_value' ){\r\n\t\t\t\t\t// Show custom field container\r\n\t\t\t\t\tthis.customValueFieldContainer.addClass( 'form-select-custom--visible' );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Hide custom field container\r\n\t\t\t\t\tthis.customValueFieldContainer.removeClass( 'form-select-custom--visible' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst onChangeAJAXCallback = () => {\r\n\t\t\t\t// Check if it's an AJAX field\r\n\t\t\t\tif ( this.attributes.isAjax ){\r\n\t\t\t\t\t// Check if the target field is different\r\n\t\t\t\t\tif ( this.attributes.targetField !== this.attributes.optionCode ){\r\n\t\t\t\t\t\t// console.log( this.attributes.label );\r\n\t\t\t\t\t\t// console.log( '> AJAX (onChangeAJAXCallback)' );\r\n\r\n\t\t\t\t\t\tthis.doAJAX();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if it's a child field\r\n\t\t\t\tif ( isDefined( this.attributes.isChildField ) && this.attributes.isChildField ){\r\n\t\t\t\t\t// Check if the option code of the parent is defined\r\n\t\t\t\t\tif ( isDefined( this.attributes.parentOptionCode ) ){\r\n\t\t\t\t\t\t// Get the field\r\n\t\t\t\t\t\tconst parentField = getField( this.attributes.itemId, this.attributes.parentOptionCode );\r\n\r\n\t\t\t\t\t\t// Check if we found it\r\n\t\t\t\t\t\tif ( isDefined( parentField ) ){\r\n\t\t\t\t\t\t\t// console.log( this.attributes.label + ' --> ' + parentField.attributes.label );\r\n\t\t\t\t\t\t\t// console.log( '> AJAX (onChangeAJAXCallback)' );\r\n\r\n\t\t\t\t\t\t\t// Do AJAX call on parent\r\n\t\t\t\t\t\t\tparentField.doAJAX();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it's an AJAX field, has a target field\r\n\t\t\t// and the target field is different than the option code\r\n\t\t\tif (\r\n\t\t\t\t// Check if the field is ajax\r\n\t\t\t\tthis.attributes.isAjax\r\n\t\t\t\t// Check if there is a valid target field (Field instance)\r\n\t\t\t\t&& isDefined( this.attributes.targetField )\r\n\t\t\t\t// Check if the ID of the target field is different that the \r\n\t\t\t\t// ID of the parent field\r\n\t\t\t\t&& this.attributes.targetField !== this.attributes.optionCode\r\n\t\t\t\t&& (\r\n\t\t\t\t\t// Check if the parent field completed the first load\r\n\t\t\t\t\tthis.attributes.completedFirstLoad\r\n\t\t\t\t\t// Otherwise, even if the first load wasn't completed,\r\n\t\t\t\t\t// check if the \"current value\" (value saved) on\r\n\t\t\t\t\t// the database is empty, or if it doesn't have a default value\r\n\t\t\t\t\t|| ( \r\n\t\t\t\t\t\tisEmpty( this.attributes.currentValue ) \r\n\t\t\t\t\t\t&& ! this.attributes.hasDefaultValue \r\n\t\t\t\t\t\t&& ! this.attributes.completedFirstLoad\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t\t){\r\n\t\t\t\t// Get the target field\r\n\t\t\t\tlet targetField = getField( this.attributes.itemId, this.attributes.targetField );\r\n\r\n\t\t\t\t// console.log( 'Reset value of ' + targetField.attributes.label );\r\n\r\n\t\t\t\t// Reset the value of the target field\r\n\t\t\t\ttargetField.setValue( null, false );\r\n\t\t\t\ttargetField.setCustomValue( null, false );\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it's a dropdown, checkbox or radio\r\n\t\t\tif ( [ 'select', 'radio', 'checkbox' ].includes( this.attributes.fieldType ) ){\r\n\t\t\t\t// Do it right away\r\n\t\t\t\tonChangeAJAXCallback();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Check if the inverval exists, and clear it\r\n\t\t\t\tif ( isDefined( this.onChangeTimeout ) ){\r\n\t\t\t\t\tclearTimeout( this.onChangeTimeout );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Wait a few seconds before doing the change\r\n\t\t\t\tthis.onChangeTimeout = setTimeout(() => {\r\n\t\t\t\t\tonChangeAJAXCallback();\r\n\t\t\t\t}, 1500 );\r\n\t\t\t}\r\n\r\n\t\t\t// Return false to prevent bubbling in child fields\r\n\t\t\treturn false;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Invoke functions on field change\r\n\t * Those functions are global for all the Field objects\r\n\t * Don't use directly, use 'automator:field:change' instead\r\n\t */\r\n\r\n\tonFocus(){\r\n\t\tthis.field.on( 'focusin', ( event ) => {\r\n\t\t\t// Check if it's a read-only field\r\n\t\t\tif ( this.attributes.isReadOnly ){\r\n\t\t\t\t// Select the text\r\n\t\t\t\t$( event.currentTarget ).select();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.field.on( 'focusout', () => {});\r\n\t}\r\n\r\n\t/**\r\n\t * Check if the item's object has all the required properties\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tisReady(){\r\n\t\tlet ready = false;\r\n\r\n\t\tif ( isDefined( UncannyAutomator.recipe.items[ this.attributes.itemId ] ) ){\r\n\t\t\tready = true;\r\n\t\t}\r\n\r\n\t\treturn ready;\r\n\t}\r\n\r\n\t/**\r\n\t * Do AJAX\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tdoAJAX(){\r\n\t\t// Get field value. If it isn't defined in the DOM then get the default value\r\n\t\tlet fieldValue = isDefined( this.getValue() ) ? this.getValue() : this.getMetaValue();\r\n\r\n\t\t// Check if we have to do an AJAX call on this field\r\n\t\tif ( this.attributes.isAjax ){\r\n\t\t\t// Get the target field\r\n\t\t\tlet targetField = this;\r\n\r\n\t\t\tif ( this.attributes.optionCode != this.attributes.targetField ){\r\n\t\t\t\ttargetField = getField( this.attributes.itemId, this.attributes.targetField );\r\n\t\t\t}\r\n\r\n\t\t\t// Check that we have everything\r\n\t\t\tif ( ! isEmpty( this.attributes.integrationId ) && ! isEmpty( this.attributes.endpoint ) ){\r\n\t\t\t\t// Before doing the request, show a loading animation in the changed field\r\n\t\t\t\tthis.startLoadingAnimation();\r\n\t\t\t\t// And show animation in the target field too\r\n\t\t\t\ttargetField.startLoadingAnimation();\r\n\r\n\t\t\t\t// Get parent field value\r\n\t\t\t\tlet parentFieldValue = this.getValue(),\r\n\t\t\t\t      targetFieldValue = isDefined( targetField.getValue() ) ? targetField.getValue() : targetField.getMetaValue();\r\n\r\n\t\t\t\tAJAXRequest( this.attributes.endpoint, {\r\n\t\t\t\t\trecipe_id:      UncannyAutomator.recipe.id,\r\n\t\t\t\t\tintegration_id: this.attributes.integrationId,\r\n\t\t\t\t\titem_id: \t    this.attributes.itemId,\t\t\t\r\n\t\t\t\t\tgroup_id: \t    this.attributes.groupId,\r\n\t\t\t\t\tfield_id: \t    this.attributes.optionCode,\r\n\t\t\t\t\ttarget_field:   this.attributes.targetField,\r\n\t\t\t\t\tvalue: \t\t    parentFieldValue,\r\n\t\t\t\t\tvalues: \t\tgetCurrentFieldsValues( this.attributes.itemId )\r\n\t\t\t\t}, ( response ) => {\r\n\t\t\t\t\t// console.log( this.attributes.label );\r\n\t\t\t\t\t// console.log( '%c> AJAX completed', 'background: red; color: #fff;' );\r\n\r\n\t\t\t\t\t// Stop loading animation in both fields\r\n\t\t\t\t\tthis.stopLoadingAnimation();\r\n\t\t\t\t\ttargetField.stopLoadingAnimation();\r\n\r\n\t\t\t\t\tlet targetFieldAttributes = targetField.getAttributes();\r\n\r\n\t\t\t\t\t// console.table({\r\n\t\t\t\t\t// \tparentField:      this.getAttributes().optionCode,\r\n\t\t\t\t\t// \tparentFieldValue: parentFieldValue,\r\n\t\t\t\t\t// \ttargetField:      this.attributes.targetField,\r\n\t\t\t\t\t// \ttargetFieldValue: targetFieldValue\r\n\t\t\t\t\t// });\r\n\r\n\t\t\t\t\t// Check if the target field is a select and the response is an array\r\n\r\n\t\t\t\t\t// console.log( targetFieldAttributes.label );\r\n\t\t\t\t\t// console.log( '> Set options' );\r\n\r\n\t\t\t\t\tif ( targetFieldAttributes.fieldType == 'select' && $.isArray( response ) ){\r\n\t\t\t\t\t\t// Value of the target field before the call\r\n\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t// Check if the field is ajax\r\n\t\t\t\t\t\t\tthis.attributes.isAjax\r\n\t\t\t\t\t\t\t// Check if there is a valid target field (Field instance)\r\n\t\t\t\t\t\t\t&& isDefined( this.attributes.targetField )\r\n\t\t\t\t\t\t\t// Check if the ID of the target field is different that the \r\n\t\t\t\t\t\t\t// ID of the parent field\r\n\t\t\t\t\t\t\t&& this.attributes.targetField !== this.attributes.optionCode\r\n\t\t\t\t\t\t\t&& (\r\n\t\t\t\t\t\t\t\t// Check if the parent field completed the first load\r\n\t\t\t\t\t\t\t\tthis.attributes.completedFirstLoad\r\n\t\t\t\t\t\t\t\t// Otherwise, even if the first load wasn't completed,\r\n\t\t\t\t\t\t\t\t// check if the \"current value\" (value saved) on\r\n\t\t\t\t\t\t\t\t// the database is empty, or if it doesn't have a default value\r\n\t\t\t\t\t\t\t\t|| ( \r\n\t\t\t\t\t\t\t\t\tisEmpty( this.attributes.currentValue ) \r\n\t\t\t\t\t\t\t\t\t&& ! this.attributes.hasDefaultValue \r\n\t\t\t\t\t\t\t\t\t&& ! this.attributes.completedFirstLoad\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t){\r\n\t\t\t\t\t\t\ttargetFieldValue = null;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// console.log( this.attributes.label );\r\n\t\t\t\t\t\t// console.log( this.attributes.completedFirstLoad );\r\n\t\t\t\t\t\t// console.log( targetFieldValue );\r\n\t\t\t\t\t\t// console.log( targetField.attributes.currentValue );\r\n\t\t\t\t\t\t// debugger;\r\n\r\n\t\t\t\t\t\t// Check if the value of the target field is custom\r\n\t\t\t\t\t\tif ( targetFieldValue == 'automator_custom_value' ){\r\n\t\t\t\t\t\t\t// Get the custom field value\r\n\t\t\t\t\t\t\tconst customFieldValue = targetField.getSelectCustomValue();\r\n\r\n\t\t\t\t\t\t\t// Check if the value of the custom field is NOT empty\r\n\t\t\t\t\t\t\tif ( ! isEmpty( customFieldValue ) ){\r\n\t\t\t\t\t\t\t\t// Then use the custom value as the real value\r\n\t\t\t\t\t\t\t\ttargetFieldValue = customFieldValue;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t// Otherwise, don't use the custom value at all\r\n\t\t\t\t\t\t\t\ttargetFieldValue = null;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// console.log( targetField.attributes.label );\r\n\t\t\t\t\t\t// console.log( '> Value: ' + targetFieldValue );\r\n\r\n\t\t\t\t\t\t// The developer wants to set new options for a select\r\n\t\t\t\t\t\t// Don't trigger change (even though select2 needs it),\r\n\t\t\t\t\t\t// we're going to trigger it later\r\n\t\t\t\t\t\ttargetField.setSelectOptions( response, false );\r\n\r\n\t\t\t\t\t\t// console.log( targetField.attributes.label + ' (by ' + this.attributes.label + ')' );\r\n\t\t\t\t\t\t// console.log( '> Set: ' + targetFieldValue );\r\n\r\n\t\t\t\t\t\t// Set the value again\r\n\t\t\t\t\t\ttargetField.setValue( targetFieldValue );\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Try to set the value\r\n\t\t\t\t\t\ttargetField.setValue( response );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Update the \"completed first load\" status\r\n\t\t\t\t\tthis.attributes.completedFirstLoad = true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Get form element\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @return {object} jQuery object of the field's container\r\n\t */\r\n\r\n\tgetFormElement(){\r\n\t\tif ( this.isReady() ){\r\n\t\t\t// Reset the \"first load\" status\r\n\t\t\tthis.attributes.completedFirstLoad = false;\r\n\r\n\t\t\t// Do the AJAX call only if it's not a child field\r\n\t\t\t// Otherwise, we will just wait for the AJAX call\r\n\t\t\t// of the parent field to end. That will trigger an\r\n\t\t\t// AJAX call in the child field.\r\n\t\t\tlet isTargetField   = false;\r\n\r\n\t\t\ttry {\r\n\t\t\t\t// Get group of options\r\n\t\t\t\tconst fields = UncannyAutomator.recipe.items[ this.attributes.itemId ].options[ this.attributes.groupId ].fields;\r\n\r\n\t\t\t\t// Determine if it's a target field\r\n\t\t\t\tisTargetField = fields.reduce( ( accumulator, field ) => {\r\n\t\t\t\t\treturn accumulator || ( \r\n\t\t\t\t\t\t// Check if this field is the target field of another field\r\n\t\t\t\t\t\t( field.attributes.targetField == this.attributes.optionCode ) \r\n\t\t\t\t\t\t// But it's not the field itself\r\n\t\t\t\t\t\t&&  ( field.attributes.optionCode != this.attributes.optionCode )\r\n\t\t\t\t\t\t// And it's AJAX\r\n\t\t\t\t\t\t&& field.attributes.isAjax\r\n\t\t\t\t\t);\r\n\t\t\t\t}, false );\r\n\t\t\t}\r\n\t\t\tcatch ( e ){\r\n\t\t\t\t// console.log( 'Prevented error' );\r\n\t\t\t\t// console.log( e );\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! isTargetField ){\r\n\t\t\t\t// console.log( this.attributes.label );\r\n\t\t\t\t// console.log( '> AJAX (getFormElement)' );\r\n\r\n\t\t\t\t// Check if the field AJAX, and it's both the parent and target\r\n\t\t\t\tif (\r\n\t\t\t\t\tthis.attributes.targetField == this.attributes.optionCode\r\n\t\t\t\t\t&& this.attributes.isAjax\r\n\t\t\t\t){\r\n\t\t\t\t\tthis.doAJAX();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.field.trigger( 'automator:field:change', {\r\n\t\t\t\t\tmanuallySet: false\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.formElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Get field container\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @return {object} jQuery object of the field's container\r\n\t */\r\n\r\n\tgetFieldContainer(){\r\n\t\treturn this.fieldContainer;\r\n\t}\r\n\r\n\t/**\r\n\t * Get field ID\r\n\t * \r\n\t * @since 0.5\r\n\t *\r\n\t * @return {string} The field ID\r\n\t */\r\n\r\n\tgetFieldID(){\r\n\t\treturn this.attributes.optionCode;\r\n\t}\r\n\r\n\t/**\r\n\t * Get field\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @return {object} jQuery object of the field\r\n\t */\r\n\r\n\tgetField(){\r\n\t\treturn this.field;\r\n\t}\r\n\r\n\tgetFieldCM(){\r\n\t\treturn this.$fakeCodemirrorField;\r\n\t}\r\n\r\n\t/**\r\n\t * Get attributes\r\n\t * \r\n\t * @since 0.5\r\n\t *\r\n\t * @return {object} Field attributes\r\n\t */\r\n\r\n\tgetAttributes(){\r\n\t\treturn this.attributes;\r\n\t}\r\n\r\n\t/**\r\n\t * Get field's value FROM THE DOM ELEMENT\r\n\t * If you want to get the value from the main object then check {attributes.currentValue}\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @return {string|int} Value of the field\r\n\t */\r\n\r\n\tgetValue(){\r\n\t\tlet response = null;\r\n\r\n\t\tif ( isDefined( this.field ) ){\r\n\t\t\tswitch ( this.type ){\r\n\t\t\t\tcase 'select':\r\n\t\t\t\tcase 'text':\r\n\t\t\t\tcase 'url':\r\n\t\t\t\tcase 'email':\r\n\t\t\t\tcase 'int':\r\n\t\t\t\tcase 'float':\r\n\t\t\t\t\tresponse = this.field.val();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'textarea':\r\n\t\t\t\t\t// Check if it has a token selector\r\n\t\t\t\t\tif ( isDefined( this.TokenSelector ) ){\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tthis.TokenSelector.parseHTMLTokensInPlainTextarea();\r\n\t\t\t\t\t\t} catch ( e ){\r\n\t\t\t\t\t\t\tconsole.log( e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tresponse = this.field.val();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\tresponse = this.field.is( ':checked' );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'radio':\r\n\t\t\t\t\tresponse = this.field.find( 'input:checked' ).val();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'date':\r\n\t\t\t\t\tresponse = this.field.val();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'time':\r\n\t\t\t\t\tresponse = this.field.val();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\t! isDefined( this.field )\r\n\t\t\t|| ! isDefined( response )\r\n\t\t){\r\n\t\t\t// Check if the field has a value and add it\r\n\t\t\tif ( this.attributes.hasValue ){\r\n\t\t\t\t// Return that value\r\n\t\t\t\tresponse = this.attributes.currentValue;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// If it doesn't have a value, then check if it has a default\r\n\t\t\t\t// value\r\n\t\t\t\tif ( this.attributes.hasDefaultValue ){\r\n\t\t\t\t\t// Return the default value\r\n\t\t\t\t\tresponse = this.attributes.defaultValue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Get readable value\r\n\t *\r\n\t * @since 0.6\r\n\t *\r\n\t * @return string with the value\r\n\t */\r\n\r\n\tgetReadableValue(){\r\n\t\tlet response = null,\r\n\t\t\tvalue \t = this.getValue();\r\n\r\n\t\tswitch ( this.type ){\r\n\t\t\tcase 'select':\r\n\t\t\t\t// Check if the field DOM element is defined\r\n\t\t\t\tif ( isDefined( this.field ) ){\r\n\t\t\t\t\t// Check if it supports multiple values, and the value is an array\r\n\t\t\t\t\tif ( this.attributes.supportsMultipleValues && $.isArray( value ) ){\r\n\t\t\t\t\t\tlet optionsText = '';\r\n\r\n\t\t\t\t\t\tresponse = value.map(( optionValue ) => {\r\n\t\t\t\t\t\t\treturn this.field.find( vsprintf( 'option[value=\"%s\"]', [ optionValue ] ) ).text();\r\n\t\t\t\t\t\t}).join( `${ UncannyAutomator.i18n.itemSeparator } ` );\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tresponse = this.field.find( vsprintf( 'option[value=\"%s\"]', [ value ] ) ).text();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Check if it supports multiple values, and the value is an array\r\n\t\t\t\t\tif ( this.attributes.supportsMultipleValues && $.isArray( value ) ){\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tlet optionsText = '';\r\n\r\n\t\t\t\t\t\t\tresponse = value.map(( optionValue ) => {\r\n\t\t\t\t\t\t\t\treturn this.getSelectOptionByValue( optionValue ).text;\r\n\t\t\t\t\t\t\t}).join( `${ UncannyAutomator.i18n.itemSeparator } ` );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcatch ( e ){\r\n\t\t\t\t\t\t\t// console.log( e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t// Get option from the options array\r\n\t\t\t\t\t\t\tresponse = this.getSelectOptionByValue( value ).text;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcatch ( e ){\r\n\t\t\t\t\t\t\t// console.log( e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'url':\r\n\t\t\tcase 'email':\r\n\t\t\tcase 'int':\r\n\t\t\tcase 'float':\r\n\t\t\tcase 'textarea':\r\n\t\t\t\t// Create DOM element to remove the HTML tags\r\n\t\t\t\tvalue = $( '<p/>' ).html( value ).text();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'checkbox':\r\n\t\t\t\tif ( value ){\r\n\t\t\t\t\tresponse = UncannyAutomator.i18n.trueLabel;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tresponse = UncannyAutomator.i18n.falseLabel;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'radio':\r\n\t\t\t\t// Check if the field DOM element is defined\r\n\t\t\t\tif ( isDefined( this.field ) ){\r\n\t\t\t\t\t// Get checked radio\r\n\t\t\t\t\tconst $checkedRadio = this.field.find( 'input:checked' );\r\n\r\n\t\t\t\t\t// Check if there is a checked radio\r\n\t\t\t\t\tif ( $checkedRadio.length == 1 ){\r\n\t\t\t\t\t\t// Get container\r\n\t\t\t\t\t\tconst $radioContainer = $checkedRadio.closest( '.form-radio__container' );\r\n\r\n\t\t\t\t\t\t// Get text\r\n\t\t\t\t\t\tresponse = $radioContainer.text().trim();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// Get option from the options array\r\n\t\t\t\t\t\tresponse = this.getSelectOptionByValue( value ).text;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch ( e ){\r\n\t\t\t\t\t\t// console.log( e );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\r\n\t\t\tcase 'date':\r\n\t\t\t\t// Create DOM element to remove the HTML tags\r\n\t\t\t\tvalue = $( '<p/>' ).html( value ).text();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'time':\r\n\t\t\t\t// Create DOM element to remove the HTML tags\r\n\t\t\t\tvalue = $( '<p/>' ).html( value ).text();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Get the custom value of a select (if there is one)\r\n\t *\r\n\t * @since 2.5\r\n\t *\r\n\t * @return string, with the value\r\n\t */\r\n\tgetSelectCustomValue(){\r\n\t\t// Default response\r\n\t\tlet fieldValue = null;\r\n\r\n\t\t// Check if it's a select\r\n\t\tif ( this.attributes.fieldType == 'select' && this.attributes.supportsCustomValue && this.getValue() == 'automator_custom_value' ){\r\n\t\t\t// Check if the child field was created\r\n\t\t\tif ( isDefined( this.customValueField ) ){\r\n\t\t\t\tfieldValue = this.customValueField.getValue();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Try to get it from the meta\r\n\t\t\t\ttry {\r\n\t\t\t\t\tfieldValue = UncannyAutomator.recipe.items[ this.attributes.itemId ].meta[ `${ this.attributes.optionCode }_custom` ];\r\n\t\t\t\t}\r\n\t\t\t\tcatch ( e ){\r\n\t\t\t\t\t// console.log( e );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn fieldValue;\r\n\t}\r\n\r\n\t/**\r\n\t * Get a select option by option value\r\n\t *\r\n\t * @since 2.5\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetSelectOptionByValue( value = '' ){\r\n\t\tlet option = null;\r\n\r\n\t\t// Get the field options\r\n\t\tlet options = this.attributes.options;\r\n\r\n\t\t// Check if it supports a custom value\r\n\t\tif ( this.attributes.supportsCustomValue ){\r\n\t\t\toptions.push({\r\n\t\t\t\tvalue: 'automator_custom_value',\r\n\t\t\t\ttext:  UncannyAutomator.i18n.validation.field.select.customValue\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Check if the options are defined\r\n\t\tif ( ! isEmpty( options ) ){\r\n\t\t\t// Iterate options and find the value\r\n\t\t\toptions.forEach(( selectOption ) => {\r\n\t\t\t\t// Compare the option value with the value parameter\r\n\t\t\t\tif ( value == selectOption.value ){\r\n\t\t\t\t\toption = selectOption;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn option;\r\n\t}\r\n\r\n\t/**\r\n\t * Get field's meta value\r\n\t * \r\n\t * @since 0.5\r\n\t *\r\n\t * @return {string|int} Value of the field\r\n\t */\r\n\r\n\tgetMetaValue(){\r\n\t\tlet response;\r\n\r\n\t\t// If the item is defined\r\n\t\tif ( isDefined( UncannyAutomator.recipe.items[ this.attributes.itemId ] ) ){\r\n\t\t\tlet metaValue = UncannyAutomator.recipe.items[ this.attributes.itemId ].meta[ this.attributes.optionCode ];\r\n\r\n\t\t\tif ( isDefined( metaValue ) ){\r\n\t\t\t\tresponse = metaValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Set value\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @param {string} Value of the field\r\n\t */\r\n\r\n\tsetValue( value, doTrigger = true ){\r\n\t\t// console.log( this.attributes.label );\r\n\t\t// console.log( '> setValue: ' + value );\r\n\r\n\t\tif ( isDefined( this.field ) ){\r\n\t\t\tswitch ( this.type ){\r\n\t\t\t\tcase 'select':\r\n\t\t\t\t\t// Sanitize the value\r\n\t\t\t\t\tif ( ! isDefined( value ) ){\r\n\t\t\t\t\t\tif ( this.attributes.supportsMultipleValues ){\r\n\t\t\t\t\t\t\tvalue = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tvalue = '';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get all options\r\n\t\t\t\t\tlet allOptions = this.field.find( 'option' );\r\n\r\n\t\t\t\t\tif ( this.attributes.supportsMultipleValues ){\r\n\t\t\t\t\t\t// Unselect all the options\r\n\t\t\t\t\t\tallOptions.prop( 'selected', false );\r\n\r\n\t\t\t\t\t\t// Iterate the selected options\r\n\t\t\t\t\t\tif ( $.isArray( value ) && ! isEmpty( value ) ){\r\n\t\t\t\t\t\t\t// Iterate the values\r\n\t\t\t\t\t\t\tvalue.forEach(( optionID ) => {\r\n\t\t\t\t\t\t\t\t// Get option\r\n\t\t\t\t\t\t\t\tlet option = this.field.find( 'option[value=\"' + optionID + '\"]' );\r\n\r\n\t\t\t\t\t\t\t\t// Check if option exists\r\n\t\t\t\t\t\t\t\tif ( option.length > 0 ){\r\n\t\t\t\t\t\t\t\t\t// Select option\r\n\t\t\t\t\t\t\t\t\toption.prop( 'selected', true );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// Trigger change\r\n\t\t\t\t\t\t\tif ( doTrigger ){\r\n\t\t\t\t\t\t\t\tthis.field.trigger( 'change', {\r\n\t\t\t\t\t\t\t\t\tmanuallySet: false\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Get option\r\n\t\t\t\t\t\tlet option = this.field.find( 'option[value=\"' + value + '\"]' );\r\n\r\n\t\t\t\t\t\t// Check if option exists\r\n\t\t\t\t\t\tif ( option.length > 0 ){\r\n\t\t\t\t\t\t\t// Unselect all the options\r\n\t\t\t\t\t\t\tallOptions.prop( 'selected', false );\r\n\r\n\t\t\t\t\t\t\t// Select option\r\n\t\t\t\t\t\t\toption.prop( 'selected', true );\r\n\r\n\t\t\t\t\t\t\t// Trigger change\r\n\t\t\t\t\t\t\tif ( doTrigger ){\r\n\t\t\t\t\t\t\t\tthis.field.trigger( 'change', {\r\n\t\t\t\t\t\t\t\t\tmanuallySet: false\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// Unselect all the options\r\n\t\t\t\t\t\t\tallOptions.prop( 'selected', false );\r\n\r\n\t\t\t\t\t\t\t// Check if the field supports custom options\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tthis.attributes.supportsCustomValue\r\n\t\t\t\t\t\t\t\t&& ! isEmpty( value )\r\n\t\t\t\t\t\t\t){\r\n\t\t\t\t\t\t\t\t// Set the value as a custom option\r\n\t\t\t\t\t\t\t\tthis.setCustomValue( value, false );\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Trigger change\r\n\t\t\t\t\t\t\tif ( doTrigger ){\r\n\t\t\t\t\t\t\t\tthis.field.trigger( 'change', {\r\n\t\t\t\t\t\t\t\t\tmanuallySet: false\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// console.error( vsprintf( 'The option with ID %s does not exists', [ value ] ) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'text':\r\n\t\t\t\tcase 'url':\r\n\t\t\t\tcase 'email':\r\n\t\t\t\tcase 'int':\r\n\t\t\t\tcase 'float':\r\n\t\t\t\t\t// Set value\r\n\t\t\t\t\tthis.field.val( value );\r\n\r\n\t\t\t\t\t// Trigger change\r\n\t\t\t\t\tif ( doTrigger ){\r\n\t\t\t\t\t\tthis.field.trigger( 'automator:field:change' );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'textarea':\r\n\t\t\t\t\t// Set the value\r\n        \t\t\tthis.field.val( value );\r\n\r\n        \t\t\t// Set the value in the TinyMCE editor too\r\n        \t\t\tif ( isDefined( this.fieldTinyMCE ) ){\r\n        \t\t\t\tthis.fieldTinyMCE.setContent( value );\r\n        \t\t\t}\r\n\r\n        \t\t\t/*\r\n\t\t\t\t\t// Check if \"Text\" view is selected\r\n        \t\t\tif ( this.field.is( ':visible' ) ){\r\n        \t\t\t\t\r\n\t\t\t        }\r\n\t\t\t        else {\r\n\t\t\t            // Insert token\r\n\t\t\t            this.editor.execCommand( 'mceInsertContent', false, token );\r\n\t\t\t        }\r\n\t\r\n\r\n\r\n\t\t\t\t\t// Set value\r\n\t\t\t\t\tthis.field.val( value );*/\r\n\r\n\t\t\t\t\t// Trigger change\r\n\t\t\t\t\tif ( doTrigger ){\r\n\t\t\t\t\t\tthis.field.trigger( 'automator:field:change' );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\tlet wantsToCheck = value, // Just for readability\r\n\t\t\t\t\t\tisChecked = this.getValue();\r\n\r\n\t\t\t\t\t// If true, check\r\n\t\t\t\t\tif ( wantsToCheck && ! isChecked ){\r\n\t\t\t\t\t\tthis.field.prop( 'checked', true );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( ! wantsToCheck && isChecked ) {\r\n\t\t\t\t\t\tthis.field.prop( 'checked', false );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( doTrigger && ( ( wantsToCheck && ! isChecked ) || ( ! wantsToCheck && isChecked ) ) ){\r\n\t\t\t\t\t\t// Trigger change\r\n\t\t\t\t\t\tthis.field.trigger( 'automator:field:change' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'radio':\r\n\t\t\t\t\t// Search for the radio and check it\r\n\t\t\t\t\tthis.field.filter( `[name=\"${ value }\"]` ).prop( 'checked', true );\r\n\r\n\t\t\t\t\t// Trigger change\r\n\t\t\t\t\tif ( doTrigger ){\r\n\t\t\t\t\t\t// Trigger change\r\n\t\t\t\t\t\tthis.field.trigger( 'automator:field:change' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'date':\r\n\t\t\t\t\t// Set value\r\n\t\t\t\t\tthis.field.val( value );\r\n\r\n\t\t\t\t\t// Trigger change\r\n\t\t\t\t\tif ( doTrigger ){\r\n\t\t\t\t\t\tthis.field.trigger( 'automator:field:change' );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'time':\r\n\t\t\t\t\t// Set value\r\n\t\t\t\t\tthis.field.val( value );\r\n\r\n\t\t\t\t\t// Trigger change\r\n\t\t\t\t\tif ( doTrigger ){\r\n\t\t\t\t\t\tthis.field.trigger( 'automator:field:change' );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\t\r\n\t}\r\n\r\n\t/**\r\n\t * Clear the value\r\n\t *\r\n\t * @since 3.0\r\n\t */\r\n\t\r\n\tclearValue(){\r\n\t\t// Set an empty value\r\n\t\tthis.setValue( '', true );\r\n\r\n\t\t// Clear the value in the Codemirror instance\r\n\t\ttry {\r\n\t\t\tthis.fieldCM.setValue( '' );\r\n\t\t} catch ( e ){}\r\n\r\n\t\t// Check if it's a date or time field\r\n\t\tif ( [ 'date', 'time' ].includes( this.attributes.fieldType ) ){\r\n\t\t\t// Try to clear the flatpickr value\r\n\t\t\ttry {\r\n\t\t\t\tthis.flatpickrInstance.clear();\r\n\t\t\t} catch ( e ){}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Set value of the custom value\r\n\t *\r\n\t * @since 2.8.2\r\n\t */\r\n\t\r\n\tsetCustomValue( value, doTrigger = true ){\r\n\t\t// console.log( this.attributes.label );\r\n\t\t// console.log( '> setCustomValue: ' + value );\r\n\r\n\t\t// Check if it's a select and has a customField defined,\r\n\t\t// if so, add it\r\n\t\tif (\r\n\t\t\tthis.attributes.fieldType == 'select'\r\n\t\t\t&& isDefined( this.customValueField )\r\n\t\t){\r\n\t\t\t// First, select the custom option\r\n\t\t\tthis.field.val( 'automator_custom_value' );\r\n\r\n\t\t\t// Set the value in the custom value field\r\n\t\t\tthis.customValueField.setValue( value, doTrigger );\r\n\r\n\t\t\t// Check if the user wants to trigger the change event\r\n\t\t\tif ( doTrigger ){\r\n\t\t\t\tthis.field.trigger( 'change', {\r\n\t\t\t\t\tmanuallySet: false\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Check if a select has a selected option\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\thasSelectedOption(){\r\n\t\treturn this.selectHasSelectedOption;\r\n\t}\r\n\r\n\t/**\r\n\t * Set select options\r\n\t *\r\n\t * @since 0.5\r\n\t *\r\n\t * @param {array} \r\n\t */\r\n\r\n\tsetSelectOptions( options, triggerChange = true ){\r\n\t\t// Remove current options\r\n\t\tthis.removeSelectOptions();\r\n\r\n\t\t// Sanitize the select options\r\n\t\ttry {\r\n\t\t\toptions = options.filter(( option ) => {\r\n\t\t\t\treturn isDefined( option.value ) && isDefined( option.text );\r\n\t\t\t});\r\n\t\t} catch ( e ){}\r\n\r\n\t\tif ( isDefined( this.field ) ){\r\n\t\t\t// Get the container where we're going to add the options\r\n\t\t\tconst $optionsContainer = this.field.find( '.form-element__select-normal-options' );\r\n\r\n\t\t\tif ( options.length > 0 ){\r\n\t\t\t\t// Remove disabled\r\n\t\t\t\tthis.field.prop( 'disabled', false );\r\n\r\n\t\t\t\t// Get value\r\n\t\t\t\tlet value = isDefined( this.getValue() ) ? this.getValue() : this.getMetaValue();\r\n\r\n\t\t\t\t// Create array to save all options\r\n\t\t\t\tlet optionsDOM = [];\r\n\r\n\t\t\t\t// Create and append options\r\n\t\t\t\t$.each( options, ( index, option ) => {\r\n\t\t\t\t\tlet optionDOM = new Option( option.text, option.value, false, false );\r\n\r\n\t\t\t\t\t$optionsContainer.append( optionDOM );\r\n\t\t\t\t\toptionsDOM.push( optionDOM );\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif ( ! isEmpty( value ) ){\r\n\t\t\t\t\t$.each( this.field.find( 'option' ), ( index, option ) => {\r\n\t\t\t\t\t\tif ( option.value == value ){\r\n\t\t\t\t\t\t\t$( option ).prop( 'selected', true );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet $noResults = $( ( new Option( UncannyAutomator.i18n.noResults, '', ! this.attributes.supportsCustomValue, ! this.attributes.supportsCustomValue ) ) );\r\n\t\t\t\t$noResults.prop( 'disabled', true );\r\n\r\n\t\t\t\t$optionsContainer.append( $noResults );\r\n\r\n\t\t\t\tif ( ! this.attributes.supportsCustomValue ){\r\n\t\t\t\t\t// Disable the select\r\n\t\t\t\t\tthis.field.prop( 'disabled', true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( triggerChange ){\r\n\t\t\t\tthis.field.trigger( 'change' );\r\n\t\t\t\t// this.field.trigger( 'automator:field:change' );\r\n\t\t\t}\r\n\r\n\t\t\t// Render this select2 again\r\n\t\t\tthis.rerenderSelect2();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Remove select options\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tremoveSelectOptions(){\r\n\t\tif ( isDefined( this.field ) ){\r\n\t\t\tthis.field.find( '.form-element__select-normal-options' ).empty();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Check if field has loading animation\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @return {boolean} TRUE if the field has the loading animation\r\n\t */\r\n\r\n\tisLoading(){\r\n\t\treturn this.formElement.hasClass( 'form-element--loading' );\r\n\t}\r\n\r\n\t/**\r\n\t * Add loading animation to field\r\n\t * \r\n\t * @since 0.4\r\n\t */\r\n\r\n\tstartLoadingAnimation(){\r\n\t\t// Check if has class\r\n\t\tlet CSSclass = 'form-element--loading';\r\n\r\n\t\tif ( isDefined( this.formElement ) && ! this.formElement.hasClass( CSSclass ) ){\r\n\t\t\t\r\n\t\t\t// Add class\r\n\t\t\tthis.formElement.addClass( CSSclass );\r\n\r\n\t\t\t// Check if it's a checkbox\r\n\t\t\tif ( this.type == 'checkbox' && ! isDefined( this.attributes.isToggle ) ){\r\n\t\t\t\tthis.fieldContainer.addClass( 'form-checkbox--loading-inline' );\r\n\t\t\t}\r\n\r\n\t\t\t// Trigger\r\n\t\t\tthis.formElement.trigger( 'automator:field:loading' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Remove loading animation to field\r\n\t * \r\n\t * @since 0.4\r\n\t */\r\n\r\n\tstopLoadingAnimation(){\r\n\t\t// Check if has class\r\n\t\tlet CSSclass = 'form-element--loading';\r\n\r\n\t\tif ( isDefined( this.formElement ) && this.formElement.hasClass( CSSclass ) ){\r\n\t\t\t\r\n\t\t\t// Remove class\r\n\t\t\tthis.formElement.removeClass( CSSclass );\r\n\r\n\t\t\t// Remove checkbox class\r\n\t\t\tthis.fieldContainer.removeClass( 'form-checkbox--loading-inline' );\r\n\r\n\t\t\t// Trigger\r\n\t\t\tthis.formElement.trigger( 'automator:field:loading' );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Init field libraries, like Select2\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tinitLibraries(){\r\n\t\tswitch ( this.type ){\r\n\t\t\tcase 'select':\r\n\t\t\t\t// Select2\r\n\t\t\t\tthis.initSelect2( this.field );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'url':\r\n\t\t\tcase 'email':\r\n\t\t\tcase 'int':\r\n\t\t\tcase 'float':\r\n\t\t\tcase 'textarea':\r\n\t\t\t\t// URL Checker\r\n\t\t\t\tif ( this.attributes.fieldType == 'url' ){\r\n\t\t\t\t\tinitURLChecker( this.fieldContainer );\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'date':\r\n\t\t\tcase 'time':\r\n\t\t\t\t// Init flatpickr.js\r\n\t\t\t\tthis.initFlatpickr( this.field );\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Select\r\n\t * Get the select2 settings\r\n\t *\r\n\t * @since 2.7.3\r\n\t */\r\n\r\n\tgetSelect2Settings(){\r\n\t\t// Define select2 settings\r\n\t\tlet settings = {\r\n\t\t\ttheme: 'uap-select2',\r\n\t        searchInputPlaceholder: UncannyAutomator.i18n.search,\r\n\t        language: {\r\n\t            noResults: function () {\r\n\t                return UncannyAutomator.i18n.noResults;\r\n\t            },\r\n\t        },\r\n            templateResult: ( data ) => {\r\n            \tlet template = data.text;\r\n\r\n            \t// Check if the ID is defined\r\n                if ( isDefined( data.id ) ){\r\n                \t// Check if it's a number\r\n                    if ( Number.isInteger( parseInt( data.id ) ) && parseInt( data.id ) > 0 ){\r\n                        template = `<span class=\"uap-select2-item__meta\">(${ vsprintf( UncannyAutomator.i18n.postIDPlaceholder, [ data.id.replace( '-objectkey', '' )])})</span> ${ data.text }`; \r\n                    } \r\n                }\r\n\r\n                return template;\r\n            },\r\n            templateSelection: function ( data ) {\r\n                let template = data.text;\r\n\r\n            \t// Check if the ID is defined\r\n                if ( isDefined( data.id ) ){\r\n                \t// Check if it's a number\r\n                    if ( Number.isInteger( parseInt( data.id ) ) && parseInt( data.id ) > 0 ){\r\n                        template = `<span class=\"uap-select2-item__meta\">(${ vsprintf( UncannyAutomator.i18n.postIDPlaceholder, [ data.id.replace( '-objectkey', '' )])})</span> ${ template }`; \r\n                    } \r\n                }\r\n\r\n                return template;\r\n            },\r\n            escapeMarkup: function ( markUp ) {\r\n                return markUp;\r\n            }\r\n\t    };\r\n\r\n\t    // Check if we have to add a placeholder\r\n\t\tif ( this.attributes.hasPlaceholder ){\r\n\t\t\t// Add placeholder\r\n\t\t\tsettings.placeholder = this.attributes.placeholder;\r\n\t\t}\r\n\r\n\t\t// Check if we don't need the search field\r\n\t\tif ( this.attributes.customClass ){\r\n\t\t\tsettings.customClass = this.attributes.customClass;\r\n\t\t}\r\n\r\n\t\treturn settings;\r\n\t}\r\n\r\n\t/**\r\n\t * Init Select2\r\n\t * \r\n\t * @since 0.5\r\n\t */\r\n\r\n\tinitSelect2( $field ){\r\n\t\tlet settings = this.getSelect2Settings();\r\n\r\n\t\tif ( ! $field.hasClass( 'select2-hidden-accessible' ) ){\r\n\t\t\t$field.select2( settings );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Init Flatpickr\r\n\t *\r\n\t * @since 3.0\r\n\t */\r\n\t\r\n\tinitFlatpickr( $field ){\r\n\t\t// Create a global element to add the calendar\r\n\t\tif ( ! isDefined( document.getElementById( 'uap-flatpickr-calendar' ) ) ){\r\n\t\t\t$( 'body' )\r\n\t\t\t\t.append( $( `<div id=\"uap-flatpickr-calendar\" class=\"uap uap-flatpickr-calendar\"></div>` ) )\r\n\t\t}\r\n\t\tconst container = document.getElementById( 'uap-flatpickr-calendar' );\r\n\r\n\t\tlet settings = {\r\n\t\t\tallowInput: true,\r\n\r\n\t\t\tpositionElement: this.$fakeCodemirrorField[0],\r\n\r\n\t\t\taltInput:   true,\r\n\r\n\t\t\tclickOpens: false,\r\n\r\n\t\t\tappendTo: container,\r\n\r\n\t\t\tlocale: {\r\n\t\t\t\tweekdays: {\r\n\t\t\t\t\tshorthand: [\r\n\t\t\t\t\t\tUncannyAutomator.i18n.format.date.weekdays.shorthand.sunday, UncannyAutomator.i18n.format.date.weekdays.shorthand.monday, UncannyAutomator.i18n.format.date.weekdays.shorthand.tuesday, UncannyAutomator.i18n.format.date.weekdays.shorthand.wednesday, UncannyAutomator.i18n.format.date.weekdays.shorthand.thursday, UncannyAutomator.i18n.format.date.weekdays.shorthand.friday, UncannyAutomator.i18n.format.date.weekdays.shorthand.saturday ],\r\n\t\t\t\t\tlonghand: [ UncannyAutomator.i18n.format.date.weekdays.longhand.sunday, UncannyAutomator.i18n.format.date.weekdays.longhand.monday, UncannyAutomator.i18n.format.date.weekdays.longhand.tuesday, UncannyAutomator.i18n.format.date.weekdays.longhand.wednesday, UncannyAutomator.i18n.format.date.weekdays.longhand.thursday, UncannyAutomator.i18n.format.date.weekdays.longhand.friday, UncannyAutomator.i18n.format.date.weekdays.longhand.saturday ],\r\n\t\t\t\t},\r\n\t\t\t\tmonths: {\r\n\t\t\t\t\tshorthand: [\r\n\t\t\t\t\t\tUncannyAutomator.i18n.format.date.months.shorthand.january, UncannyAutomator.i18n.format.date.months.shorthand.february, UncannyAutomator.i18n.format.date.months.shorthand.march, UncannyAutomator.i18n.format.date.months.shorthand.april, UncannyAutomator.i18n.format.date.months.shorthand.may, UncannyAutomator.i18n.format.date.months.shorthand.june, UncannyAutomator.i18n.format.date.months.shorthand.july, UncannyAutomator.i18n.format.date.months.shorthand.august, UncannyAutomator.i18n.format.date.months.shorthand.september, UncannyAutomator.i18n.format.date.months.shorthand.october, UncannyAutomator.i18n.format.date.months.shorthand.november, UncannyAutomator.i18n.format.date.months.shorthand.december,\r\n\t\t\t\t\t],\r\n\t\t\t\tlonghand: [\r\n\t\t\t\t\t\tUncannyAutomator.i18n.format.date.months.longhand.january, UncannyAutomator.i18n.format.date.months.longhand.february, UncannyAutomator.i18n.format.date.months.longhand.march, UncannyAutomator.i18n.format.date.months.longhand.april, UncannyAutomator.i18n.format.date.months.longhand.may, UncannyAutomator.i18n.format.date.months.longhand.june, UncannyAutomator.i18n.format.date.months.longhand.july, UncannyAutomator.i18n.format.date.months.longhand.august, UncannyAutomator.i18n.format.date.months.longhand.september, UncannyAutomator.i18n.format.date.months.longhand.october, UncannyAutomator.i18n.format.date.months.longhand.november, UncannyAutomator.i18n.format.date.months.longhand.december,\r\n\t\t\t\t\t],\r\n\t\t\t\t},\r\n\t\t\t\trangeSeparator: ` ${ UncannyAutomator.i18n.format.date.rangeSeparator } `,\r\n\t\t\t\t// Numeric representation of the day of the week. 0 (for Sunday) through 6 (for Saturday)\r\n\t\t\t\t// In the translatable string we say that 1 is Sunday and Saturday is 7, so we have to subtract 1\r\n\t\t\t\tfirstDayOfWeek: ( parseInt( UncannyAutomator.i18n.format.date.firstDayOfWeek ) >= 1 && parseInt( UncannyAutomator.i18n.format.date.firstDayOfWeek ) <= 7 ) ? parseInt( UncannyAutomator.i18n.format.date.firstDayOfWeek ) - 1 : 0,\r\n\t\t\t\tweekAbbreviation: ` ${ UncannyAutomator.i18n.format.date.weekAbbreviation } `,\r\n\t\t\t\tscrollTitle: UncannyAutomator.i18n.scrollToIncrement,\r\n\t\t        toggleTitle: UncannyAutomator.i18n.clickToToggle,\r\n\t\t        amPM: [ UncannyAutomator.i18n.format.date.am, UncannyAutomator.i18n.format.date.pm ],\r\n\t\t        yearAriaLabel: UncannyAutomator.i18n.format.date.year,\r\n\t\t        monthAriaLabel: UncannyAutomator.i18n.format.date.month,\r\n\t\t        hourAriaLabel: UncannyAutomator.i18n.format.date.hour,\r\n\t\t        minuteAriaLabel: UncannyAutomator.i18n.format.date.minute,\r\n\t\t\t},\r\n\r\n\t\t\tonReady: ( selectedDates, dateStr, instance ) => {\r\n\t\t\t\t// Check if the value of the date field is not equal\r\n\t\t\t\t// to the value of the Codemirror field. That would mean\r\n\t\t\t\t// that the date field has a valid value, and that we\r\n\t\t\t\t// have to format it\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst formatCodemirrorDate = () => {\r\n\t\t\t\t\t\t// Check if the field value is not a token\r\n\t\t\t\t\t\tif ( ! this.getValue().includes( '}}' ) ){\r\n\t\t\t\t\t\t\t// Check if the date in the field is formatted differently than\r\n\t\t\t\t\t\t\t// the date in the alternative date field\r\n\t\t\t\t\t\t\tif ( this.fieldCM.getValue() != instance.altInput.value ){\r\n\t\t\t\t\t\t\t\tthis.fieldCM.setValue( instance.altInput.value );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if CodeMirror is ready\r\n\t\t\t\t\tif ( isDefined( this.fieldCM ) ){\r\n\t\t\t\t\t\tformatCodemirrorDate();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.field.on( 'ua-codemirror-ready', () => {\r\n\t\t\t\t\t\t\tformatCodemirrorDate();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch ( e ){ console.log( e ); }\r\n\t\t\t},\r\n\r\n\t\t\tonChange: ( selectedDates, dateStr, instance ) => {\r\n\t\t\t\t// Update the Codemirror field\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst setCodemirrorValue = () => {\r\n\t\t\t\t\t\t// Remove the current value from the Codemirror field,\r\n\t\t\t\t\t\t// and set the value of the alt date/time field as value\r\n\t\t\t\t\t\tthis.fieldCM.setValue( instance.altInput.value );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if CodeMirror is ready\r\n\t\t\t\t\tif ( isDefined( this.fieldCM ) ){\r\n\t\t\t\t\t\tsetCodemirrorValue();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.field.on( 'ua-codemirror-ready', () => {\r\n\t\t\t\t\t\t\tsetCodemirrorValue();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch ( e ){ console.log( e ); }\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Settings depending on the field type\r\n\t\t// https://github.com/flatpickr/flatpickr/blob/master/src/types/options.ts#L19\r\n\t\tif ( this.attributes.fieldType == 'date' ){\r\n\t\t\tsettings = $.extend( settings, {\r\n\t\t\t\t// https://flatpickr.js.org/formatting/\r\n\t\t\t\tdateFormat: this.attributes.dateFormat,\r\n\t\t\t\taltFormat:  this.attributes.dateAltFormat,\r\n\t\t\t});\r\n\r\n\t\t\t// Check if it supports a range\r\n\t\t\tif ( this.attributes.supportsRange ){\r\n\t\t\t\tsettings.mode = 'range';\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it has a min date\r\n\t\t\tif ( isDefined( this.attributes.minDate ) ){\r\n\t\t\t\tsettings.minDate = this.attributes.minDate;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it has a max date\r\n\t\t\tif ( isDefined( this.attributes.maxDate ) ){\r\n\t\t\t\tsettings.maxDate = this.attributes.maxDate;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ( this.attributes.fieldType == 'time' ){\r\n\t\t\tsettings = $.extend( settings, {\r\n\t\t\t\tenableTime: true,\r\n    \t\tnoCalendar: true,\r\n\r\n    \t\t// https://flatpickr.js.org/formatting/\r\n    \t\tdateFormat: this.attributes.timeFormat,\r\n\t\t\t\taltFormat:  this.attributes.timeAltFormat,\r\n\t\t\t});\r\n\r\n\t\t\t// Check if it has a min time\r\n\t\t\tif ( isDefined( this.attributes.minTime ) ){\r\n\t\t\t\tsettings.minTime = this.attributes.minTime;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it has a max time\r\n\t\t\tif ( isDefined( this.attributes.manTime ) ){\r\n\t\t\t\tsettings.manTime = this.attributes.manTime;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Init flatpickr\r\n\t\tthis.flatpickrInstance = $field.flatpickr( settings );\r\n\t}\r\n\r\n\t/**\r\n\t * Init CodeMirror\r\n\t *\r\n\t * @since 3.0\r\n\t */\r\n\t\r\n\tinitCodeMirror(){\r\n\t\t// Check if this isn't already a CodeMirror instance\r\n\t\tif ( \r\n\t\t\t[ 'text', 'url', 'email', 'int', 'float', 'date', 'time' ].includes( this.attributes.fieldType )\r\n\t\t){\r\n\t\t\t// Check if we already created a CodeMirror for this field\r\n\t\t\tthis.destroyCodeMirror();\r\n\r\n\t\t\tconst initialValue = this.getValue();\r\n\r\n\t\t\t// CodeMirror\r\n\t\t\tthis.fieldCM = CodeMirror( this.$fakeCodemirrorField[0], {\r\n\t\t\t\tlineNumbers: 0,\r\n\t\t\t\ttabSize: 4,\r\n\t\t\t\tvalue: initialValue,\r\n\t\t\t\tmode: 'default',\r\n\t\t\t\tdragDrop: false,\r\n\t\t\t\tnoNewlines: true,\r\n\t\t\t\tviewportMargin: Infinity,\r\n\t\t\t\tlineWrapping: true,\r\n\t\t\t\tautoRefresh: true,\r\n\t\t\t\textraKeys: {\r\n\t\t\t\t\tTab: false\r\n\t\t\t\t},\r\n\t\t\t\treadOnly: this.attributes.isReadOnly\r\n\t\t\t});\r\n\r\n\t\t\t// Add the placeholder\r\n\t\t\tif ( this.attributes.hasPlaceholder ){\r\n\t\t\t\tthis.fieldCM.setOption( 'placeholder', this.attributes.placeholder );\r\n\t\t\t}\r\n\r\n\t\t\tthis.fieldCM.on( 'changes', () => {\r\n\t\t\t\t// Check if the current field is NOT a date or time field\r\n\t\t\t\tif ( ! [ 'date', 'time' ].includes( this.attributes.fieldType ) ){\r\n\t\t\t\t\tthis.setValue( this.fieldCM.getValue() );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.fieldCM.on( 'focus', () => {\r\n\t\t\t\t// If it's a date or time field, try to open the calendar\r\n\t\t\t\tif ( [ 'date', 'time' ].includes( this.attributes.fieldType ) ){\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// Open calendar\r\n\t\t\t\t\t\tsetTimeout( () => {\r\n\t\t\t\t\t\t\tthis.flatpickrInstance.open();\r\n\t\t\t\t\t\t}, 50 );\r\n\t\t\t\t\t} catch ( e ){\r\n\t\t\t\t\t\tconsole.log( e );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.field.on( 'focus', () => {\r\n\t\t\t\tthis.fieldCM.focus();\r\n\t\t\t});\r\n\r\n\t\t\tthis.field.trigger( 'ua-codemirror-ready' );\r\n\t\t}\r\n\t\t\r\n\t\tif ( this.attributes.fieldType == 'select' ){\r\n\t\t\t// Check if it has a custom value\r\n\t\t\tif ( isDefined( this.customValueField ) ){\r\n\t\t\t\tthis.customValueField.initCodeMirror();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Destroy CodeMirror\r\n\t *\r\n\t * @since 3.0\r\n\t */\r\n\tdestroyCodeMirror(){\r\n\t\t// Check if we already created a CodeMirror for this field\r\n\t\tif ( isDefined( this.fieldCM ) ){\r\n\t\t\ttry {\r\n\t\t\t\tconst $field = this.fieldCM.getWrapperElement();\r\n\t\t\t\t$field.parentNode.removeChild( $field );\r\n\t\t\t\tthis.fieldCM = null;\r\n\t\t\t} catch ( e ){}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Select\r\n\t * Rerender the dropdown\r\n\t */\r\n\t\r\n\trerenderSelect2(){\r\n\t\tlet settings = this.getSelect2Settings();\r\n\r\n\t\tif ( ! isEmpty( this.field ) && this.field.hasClass( 'select2-hidden-accessible' ) ){\r\n\t\t\tthis.field.select2( 'destroy' ).select2( settings );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Init Token Selector\r\n\t *\r\n\t * @since 3.0\r\n\t */\r\n\r\n\tinitTokenSelector(){\r\n\t\tif (\r\n\t\t\tthis.attributes.supportsTokens\r\n\t\t){\r\n\t\t\t// Check if we already created the token selector\r\n\t\t\tthis.destroyTokenSelector();\r\n\r\n\t\t\tthis.tokenSelector = new TokenSelector( this );\r\n\t\t}\r\n\r\n\t\tif ( this.attributes.fieldType == 'select' ){\r\n\t\t\t// Check if it has a custom value\r\n\t\t\tif ( isDefined( this.customValueField ) ){\r\n\t\t\t\tthis.customValueField.initTokenSelector();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Destroy the Token selector\r\n\t *\r\n\t * @since 3.0\r\n\t */\r\n\r\n\tdestroyTokenSelector(){\r\n\t\t// Check if we already created the token selector\r\n\t \tif ( isDefined( this.tokenSelector ) ){\r\n\t\t\tthis.tokenSelector.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Init TinyMCE\r\n\t * We're going to call this in ItemOptions.js because TinyMCE needs the item in the DOM before changing it\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tinitTinyMCE(){\r\n\t\tlet $textarea = this.field;\r\n\r\n\t\t// TinyMCE\r\n\t\tif ( isDefined( this.field ) && this.attributes.fieldType == 'textarea' && this.attributes.supportsTinyMCE ){\r\n\t\t\t// Get field ID\r\n\t\t\tconst fieldId = this.field.prop( 'id' );\r\n\r\n\t\t\t// Get editor\r\n\t        let editor = tinymce.get( fieldId );\r\n\r\n\t        if ( isDefined( editor ) ){\r\n\t        \twp.editor.remove( fieldId );\r\n\t        }\r\n\r\n\t\t\twp.editor.initialize( fieldId, {\r\n\t\t\t\tmediaButtons: true,\r\n\t\t\t\ttinymce: { \r\n\t\t\t\t\twpautop: true, \r\n\t\t\t\t\ttoolbar1: 'formatselect bold italic bullist numlist blockquote alignleft aligncenter alignright link unlink wp_more',\r\n\t\t\t\t\ttoolbar2: 'strikethrough hr forecolor pastetext removeformat visualchars outdent indent undo redo'\r\n\t\t\t\t}, \r\n\t\t\t\tquicktags: true,\r\n\t\t\t});\r\n\r\n\t\t\t// Get editor\r\n\t        editor = tinymce.get( fieldId );\r\n\t        \r\n\t        // Mirror the content of the TinyMCE field\r\n\t        // to the normal textarea\r\n\t        editor.on( 'input paste undo redo', debounce(() => {\r\n\t        \t// Set the value of the normal field\r\n\t        \t// But don't trigger the change event\r\n\t\t\t\tthis.field.val( editor.getContent({\r\n\t\t\t\t\tformat : 'raw'\r\n\t\t\t\t}) );\r\n\t        }, 100 ));\r\n\r\n\t        // Detect changes on the \"Visual\" and \"Text\" tabs\r\n\t        this.formElement.find( '.switch-tmce' ).on( 'click', () => {\r\n\t        \tthis.field.trigger( 'ua-tinymce-activate-visual-view' );\r\n\t        });\r\n\r\n\t        this.formElement.find( '.switch-html' ).on( 'click', () => {\r\n\t        \tthis.field.trigger( 'ua-tinymce-activate-text-view' );\r\n\t        });\r\n\r\n\t        this.fieldTinyMCE = editor;\r\n\r\n\t        editor.on( 'init', () => {\r\n\t        \tthis.field.trigger( 'ua-tinymce-ready' );\r\n\t        });\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default Field;\r\n\r\n/**\r\n * Extend Select2 to add a placeholder in the search input\r\n *\r\n * @since 0.1\r\n *\r\n * @param   {object} Select2 Instance\r\n *\r\n * @return  {object} Select2 Instance\r\n */\r\n\r\n(function($){\r\n\t\r\n    // Get default settings\r\n    var Defaults = $.fn.select2.amd.require( 'select2/defaults' );\r\n\r\n    // Set default value for searchInputPlaceholder\r\n    $.extend( Defaults.defaults, {\r\n        searchInputPlaceholder: ''\r\n    });\r\n\t\r\n    // Get search element\r\n    var SearchDropdown = $.fn.select2.amd.require( 'select2/dropdown/search' );\r\n\r\n    // Save instance of search element\r\n    var _renderSearchDropdown = SearchDropdown.prototype.render;\r\n\r\n    SearchDropdown.prototype.render = function ( decorated ){\r\n        // Add placeholder attribute\r\n        var $rendered = _renderSearchDropdown.apply( this, Array.prototype.slice.apply( arguments ) );\r\n        this.$search.attr( 'placeholder', this.options.get( 'searchInputPlaceholder' ) );\r\n\t\tthis.$search.addClass( this.options.get( 'customClass' ) );\r\n        // Return search element\r\n        return $rendered;\r\n    };\r\n})( window.jQuery );","import $ from 'jquery';\r\n\r\nimport {\r\n\tisDefined,\r\n\tisEmpty\r\n} from './Utilities';\r\n\r\nimport Field from './Field';\r\n\r\nclass FieldsGroup {\r\n\tconstructor( attributes, createDOMelements = true, customValidationFunction = null ){\r\n\t\t// Save attributes\r\n\t\tthis.setAttributes( attributes );\r\n\r\n\t\t// Create fields\r\n\t\tthis.createFields();\r\n\t}\r\n\r\n\t/**\r\n\t * Set attributes. It add properties like hasValue, hasPlaceholder, etc, automatically\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @param  {object} attributes - The field attributes\r\n\t *\r\n\t * @return {object} attributes - The field attributes\r\n\t */\r\n\r\n\tsetAttributes( attributes ){\r\n\t\t// Has label\r\n\t\tif ( ! isDefined( attributes.hasLabel ) ){\r\n\t\t\tif ( ! isEmpty( attributes.label ) ){\r\n\t\t\t\tattributes.hasLabel = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasLabel = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has description\r\n\t\tif ( ! isDefined( attributes.hasDescription ) ){\r\n\t\t\tif ( ! isEmpty( attributes.description ) ){\r\n\t\t\t\tattributes.hasDescription = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasDescription = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.attributes = attributes;\r\n\t}\r\n\r\n\t/**\r\n\t * Create instances of Field\r\n\t *\r\n\t * @since  2.0\r\n\t *\r\n\t * @return undefined\r\n\t */\r\n\r\n\tcreateFields(){\r\n\t\t// Replace fields data with Field instances\r\n\t\tthis.fields = this.attributes.fields.map(( fieldData ) => {\r\n\t\t\t// Create Field\r\n\t\t\treturn new Field( fieldData.fieldType, fieldData );\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Create a jQuery DOM element with the field\r\n\t *\r\n\t * @since 0.3\r\n\t */\r\n\r\n\tcreateFormElement(){\r\n\t\t// Create response object\r\n\t\tlet response = null;\r\n\r\n\t\t// Create container\r\n\t\tconst $container = $( `<div class=\"form-group\"></div>` );\r\n\r\n\t\t// Check if it has a label\r\n\t\tif ( this.attributes.hasLabel ){\r\n\t\t\t// Create label\r\n\t\t\tconst $label = $( `<div class=\"form-group__label\">${ this.attributes.label }</div>` );\r\n\r\n\t\t\t// Append label\r\n\t\t\t$container.append( $label );\r\n\t\t}\r\n\r\n\t\t// Create form group. We're going to add the fields here\r\n\t\tconst $formGroup = $( `<div class=\"form-group__fields\"></div>` );\r\n\t\t// Iterate fields\r\n\t\tthis.fields.forEach(( field ) => {\r\n\t\t\t// Create form element\r\n\t\t\tconst $fieldElement = field.createFormElement();\r\n\r\n\t\t\t// Append form element\r\n\t\t\t$formGroup.append( $fieldElement );\r\n\t\t});\r\n\t\t// Append fields\r\n\t\t$container.append( $formGroup );\r\n\r\n\t\t// Check if it has a description\r\n\t\tif ( this.attributes.hasLabel ){\r\n\t\t\t// Create description\r\n\t\t\tconst $description = $( `<div class=\"form-group__description\">${ this.attributes.description }</div>` );\r\n\t\t\r\n\t\t\t// Append description\r\n\t\t\t$container.append( $description );\r\n\t\t}\r\n\r\n\t\t// Save form element\r\n\t\tthis.formElement = $container;\r\n\t\tresponse = $container;\r\n\r\n\t\t// Return form element\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Get value\r\n\t *\r\n\t * @since  2.0\r\n\t *\r\n\t * @return {object} Object where the key is the field ID and the value is the field's value\r\n\t */\r\n\t\r\n\tgetValue(){\r\n\t\t// Create object where we're going to save the values\r\n\t\tlet fieldsValue = {};\r\n\r\n\t\t// Iterate fields\r\n\t\tthis.fields.forEach(( field ) => {\r\n\t\t\t// Add the field value\r\n\t\t\tfieldsValue[ field.getFieldID() ] = field.getValue();\r\n\t\t});\r\n\r\n\t\t// Return validation object\r\n\t\treturn fieldsValue;\r\n\t}\r\n\r\n\t/**\r\n\t * Get form element\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @return {object} jQuery object of the field's container\r\n\t */\r\n\r\n\tgetFormElement(){\r\n\t\treturn this.formElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Get attributes\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @return {object} Field attributes\r\n\t */\r\n\r\n\tgetAttributes(){\r\n\t\treturn this.attributes;\r\n\t}\r\n\r\n\t/**\r\n\t * Validate the fields\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @param  {boolean} renderError - TRUE if you want to render the field errors, FALSE if you only want to return the response object\r\n\t *\r\n\t * @return {object} Object where the key is the field ID and the value is a validateField object\r\n\t */\r\n\t\r\n\tvalidate( renderError = true ){\r\n\t\t// Create validation object\r\n\t\tlet validationObject = {\r\n\t\t\tisValid: true,\r\n\t\t\tmessage: ''\r\n\t\t};\r\n\r\n\t\t// Iterate fields\r\n\t\tthis.fields.forEach(( field ) => {\r\n\t\t\t// Validate and add response to the validation object\r\n\t\t\tvalidationObject[ field.getFieldID() ] = field.validate( renderError );\r\n\r\n\t\t\t// Update main validation\r\n\t\t\tvalidationObject.isValid = validationObject.isValid && validationObject[ field.getFieldID() ].isValid;\r\n\t\t});\r\n\r\n\t\t// Return validation object\r\n\t\treturn validationObject;\r\n\t}\r\n}\r\n\r\nexport default FieldsGroup;","import $ from 'jquery';\r\n\r\nimport {\r\n\tisDefined,\r\n\tisEmpty\r\n} from './Utilities';\r\n\r\nimport Field from './Field';\r\n\r\nconst sortable = require( 'html5sortable' );\r\n\r\nclass FieldsRepeater {\r\n\tconstructor( attributes, createDOMelements = true, customValidationFunction = null ){\r\n\t\t// Save attributes\r\n\t\tthis.setAttributes( attributes );\r\n\r\n\t\t// Create fields\r\n\t\tthis.createFields();\r\n\t}\r\n\r\n\t/**\r\n\t * Set attributes. It add properties like hasValue, hasPlaceholder, etc, automatically\r\n\t * \r\n\t * @since 0.4\r\n\t *\r\n\t * @param  {object} attributes - The field attributes\r\n\t *\r\n\t * @return {object} attributes - The field attributes\r\n\t */\r\n\r\n\tsetAttributes( attributes ){\r\n\t\t// Has label\r\n\t\tif ( ! isDefined( attributes.hasLabel ) ){\r\n\t\t\tif ( ! isEmpty( attributes.label ) ){\r\n\t\t\t\tattributes.hasLabel = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasLabel = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Has description\r\n\t\tif ( ! isDefined( attributes.hasDescription ) ){\r\n\t\t\tif ( ! isEmpty( attributes.description ) ){\r\n\t\t\t\tattributes.hasDescription = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tattributes.hasDescription = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.attributes = attributes;\r\n\t}\r\n\r\n\t/**\r\n\t * Create instances of Field\r\n\t *\r\n\t * @since  2.0\r\n\t *\r\n\t * @return undefined\r\n\t */\r\n\r\n\tcreateFields(){\r\n\t\t// Get fields template\r\n\t\tconst rowFieldsTemplate = this.attributes.fields;\r\n\r\n\t\t// Create array with fields\r\n\t\tlet fieldsRows = [];\r\n\r\n\t\t// Check if there is data and create multiple rows of the repeater field\r\n\t\tif ( Array.isArray( this.attributes.currentValue ) && this.attributes.currentValue.length > 0 ){\r\n\t\t\t// https://regex101.com/r/tLL7S9/1/\r\n\t\t\t// Get field id and index from strings like FIELD_1\r\n\r\n\t\t\t// Iterate default rows\r\n\t\t\tthis.attributes.currentValue.forEach(( row, index ) => {\r\n\t\t\t\t// Clone template row\r\n\t\t\t\tlet rowFields = JSON.parse( JSON.stringify( rowFieldsTemplate ) );\r\n\r\n\t\t\t\t// Iterate the rows in the template and try to get their\r\n\t\t\t\t// value from the \"row\" array\r\n\t\t\t\trowFields = rowFields.map(( field, index ) => {\r\n\t\t\t\t\t// Check if there is a value for this field\r\n\t\t\t\t\tif ( isDefined( row[ field.optionCode ] ) ){\r\n\t\t\t\t\t\t// Save value\r\n\t\t\t\t\t\tfield.currentValue = row[ field.optionCode ];\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Set empty value\r\n\t\t\t\t\t\tfield.currentValue = '';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Return field\r\n\t\t\t\t\treturn field;\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Add row with fields\r\n\t\t\t\tfieldsRows.push( rowFields );\r\n\t\t\t});\r\n\t\t}\r\n\t\t// Otherwise, just create one row\r\n\t\telse {\r\n\t\t\t// Check if the field is required\r\n\t\t\tif ( this.attributes.isRequired ){\r\n\t\t\t\t// Create an empty row\r\n\t\t\t\tlet emptyRow = JSON.parse( JSON.stringify( rowFieldsTemplate ) );\r\n\r\n\t\t\t\t// Remove undefined current value\r\n\t\t\t\temptyRow.currentValue = '';\r\n\r\n\t\t\t\t// Add it to the main array\r\n\t\t\t\tfieldsRows.push( emptyRow );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Otherwise, do nothing\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Now iterate the row with fields\r\n\t\tfieldsRows = fieldsRows.map(( row, index ) => {\r\n\t\t\t// Now iterate each group of fields\r\n\t\t\trow = row.map(( fieldObject, index ) => {\r\n\t\t\t\t// Remove the label\r\n\t\t\t\tfieldObject.label = '';\r\n\r\n\t\t\t\t// Remove the description\r\n\t\t\t\tfieldObject.description = '';\r\n\r\n\t\t\t\t// Create field\r\n\t\t\t\tlet field = new Field( fieldObject.fieldType, fieldObject );\r\n\r\n\t\t\t\t// Return field instance\r\n\t\t\t\treturn field;\r\n\t\t\t});\r\n\r\n\t\t\t// Return row\r\n\t\t\treturn row;\r\n\t\t});\r\n\r\n\t\t// Update the fields property\r\n\t\tthis.fieldRows = fieldsRows;\r\n\t}\r\n\r\n\t/**\r\n\t * Create a jQuery DOM element with the field\r\n\t *\r\n\t * @since 0.3\r\n\t */\r\n\r\n\tcreateFormElement(){\r\n\t\t// Create response object\r\n\t\tlet response = null;\r\n\r\n\t\t// Create container\r\n\t\tconst $container = $( `<div class=\"form-repeater\"></div>` );\r\n\r\n\t\t// Check if it has a label\r\n\t\tif ( this.attributes.hasLabel ){\r\n\t\t\t// Create label\r\n\t\t\tconst $label = $( `\r\n\t\t\t\t<div class=\"form-repeater__label\">\r\n\t\t\t\t\t${ this.attributes.label }\r\n\t\t\t\t\t${ this.attributes.isRequired ? `<span class=\"form-repeater__label-required\"></span>` : `` }\r\n\t\t\t\t</div>\r\n\t\t\t` );\r\n\r\n\t\t\t// Append label\r\n\t\t\t$container.append( $label );\r\n\t\t}\r\n\r\n\t\t// Create table with the fields\r\n\t\tlet $table = this.getFieldsTable();\r\n\t\t$container.append( $table );\r\n\r\n\t\t// Add error container\r\n\t\t$table.append( $( `<div class=\"form-element__error\"></div>` ) );\r\n\r\n\t\t// Check if it has a description\r\n\t\tif ( this.attributes.hasDescription ){\r\n\t\t\t// Create description\r\n\t\t\tconst $description = $( `<div class=\"form-repeater__description\">${ this.attributes.description }</div>` );\r\n\t\t\r\n\t\t\t// Append description\r\n\t\t\t$container.append( $description );\r\n\t\t}\r\n\r\n\t\t// Save form element\r\n\t\tthis.formElement = $container;\r\n\t\tresponse = $container;\r\n\r\n\t\t// If there is more than one row, make list sortable\r\n\t\tif ( this.fieldRows.length > 1 ){\r\n\t\t\tthis.makeRowsSortable();\r\n\t\t}\r\n\r\n\t\t// Listen save\r\n\t\tthis.listenSave();\r\n\r\n\t\t// Return form element\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Listen save\r\n\t */\r\n\r\n\tlistenSave(){\r\n\t\t// Get form element\r\n\t\tthis.formElement.on( 'saved', ( event ) => {\r\n\t\t\t// Update the fields array\r\n\t\t\tthis.updateAttributesFieldsFromRow();\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Use fieldRows to update the original attributes.fields\r\n\t * We will use this to render the container again after it was\r\n\t * saved\r\n\t */\r\n\r\n\tupdateAttributesFieldsFromRow(){\r\n\t\t// Create the array where we're going to save the fields data\r\n\t\tlet fields = [];\r\n\r\n\t\t// Iterate fieldRows\r\n\t\tthis.fieldRows.forEach(( rowFields ) => {\r\n\t\t\t// Create array to save the row fields\r\n\t\t\tlet row = [];\r\n\r\n\t\t\t// Iterate row fields\r\n\t\t\trowFields.forEach(( Field ) => {\r\n\t\t\t\t// Add field\r\n\t\t\t\trow.push( Field.attributes );\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// Add row\r\n\t\t\tfields.push( row );\r\n\t\t});\r\n\r\n\t\t// Update fields\r\n\t\tthis.attributes.fields = fields;\r\n\t}\r\n\r\n\t/**\r\n\t * Make list of rows sortable\r\n\t */\r\n\t\r\n\tmakeRowsSortable(){\r\n\t\t// Make rows sortable\r\n\t\t// Use sortable from the html5sortable library\r\n\t\tsortable( this.formElement.find( '.form-repeater-fields__table-rows' ), {\r\n\t\t\tforcePlaceholderSize: true,\r\n\t\t\thandle: '.form-repeater-fields__table-rows-cell--number',\r\n\t\t\tplaceholder: `<tr><td colspan=\"${ ( this.fieldRows[0].length + 2 ) }\">&nbsp;</td></tr>`,\r\n\t\t\titemSerializer: ( serializedItem, sortableContainer ) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tposition: serializedItem.index,\r\n\t\t\t\t\thtml:     serializedItem.html\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Listen modifications to the rows order\r\n\t\tthis.formElement.find( '.form-repeater-fields__table-rows' ).on( 'sortupdate', ( event ) => {\r\n\t\t\t// Create an array where each element is the index of the row in the old order\r\n\t\t\tlet newOrder = [];\r\n\r\n\t\t\t// Iterate the rows (in their new order)\r\n\t\t\t$.each( event.detail.destination.items, ( index, row ) => {\r\n\t\t\t\tnewOrder.push( $( row ).data( 'order' ) );\r\n\t\t\t});\r\n\r\n\t\t\t// Change the order of the rows in the FieldRepeater instance\r\n\t\t\tlet newFieldRowsOrder = [];\r\n\t\t\tnewOrder.forEach(( oldIndex ) => {\r\n\t\t\t\tnewFieldRowsOrder.push( this.fieldRows[ oldIndex ] );\r\n\t\t\t});\r\n\t\t\tthis.fieldRows = newFieldRowsOrder;\r\n\r\n\t\t\t// Render the field agian\r\n\t\t\tthis.reRender();\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Create and return fields table\r\n\t *\r\n\t * @since  2.0\r\n\t */\r\n\t\r\n\tgetFieldsTable(){\r\n\t\t// Create variable to save the table\r\n\t\tconst $table = $( `\r\n\t\t\t<div class=\"form-repeater-fields\">\r\n\t\t\t\t<table class=\"form-repeater-fields__table\">\r\n\t\t\t\t\t<thead class=\"form-repeater-fields__table-heading\"></thead>\r\n\t\t\t\t\t<tbody class=\"form-repeater-fields__table-rows\"></tbody>\r\n\t\t\t\t</table>\r\n\t\t\t\t<div class=\"form-repeater-fields__actions\"></div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Create table with the rows\r\n\t\t// Get table headers\r\n\t\t// We will create a table where the name of the column will\r\n\t\t// be the label of the field\r\n\t\tlet heading = [];\r\n\r\n\t\t// Iterate the original fields object inside attributes (not the Field instances)\r\n\t\tthis.attributes.fields.forEach(( fieldData, index ) => {\r\n\t\t\t// Get column title\r\n\t\t\tconst title = isDefined( fieldData.label ) ? fieldData.label : '';\r\n\r\n\t\t\t// Check if the fields under this column are required\r\n\t\t\tconst isRequired = isDefined( fieldData.isRequired ) ? fieldData.isRequired : false;\r\n\r\n\t\t\t// Get the column description\r\n\t\t\tconst description = isDefined( fieldData.description ) ? fieldData.description : '';\r\n\r\n\t\t\t// Add heading column\r\n\t\t\theading.push({\r\n\t\t\t\ttitle:       title,\r\n\t\t\t\tdescription: description,\r\n\t\t\t\tisRequired:  isRequired\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// Create HTML of the heading\r\n\t\tconst $heading = $( `<tr></tr>` );\r\n\r\n\t\t// Add the column with for the row number\r\n\t\t$heading.append( $( `<th class=\"form-repeater-fields__table-heading-cell form-repeater-fields__table-heading-cell--number\">#</th>` ) );\r\n\r\n\t\t// Iterate heading columns\r\n\t\theading.forEach(( headingColumn, index ) => {\r\n\t\t\t// Create column\r\n\t\t\tlet $headingColumn = $( `<th class=\"form-repeater-fields__table-heading-cell\"></th>` );\r\n\r\n\t\t\t// Add the title\r\n\t\t\tif ( ! isEmpty( headingColumn.title ) ){\r\n\t\t\t\t$headingColumn.append( $( `\r\n\t\t\t\t\t<div class=\"form-repeater-fields__table-heading-cell-title\">\r\n\t\t\t\t\t\t${ headingColumn.title }\r\n\t\t\t\t\t\t${ headingColumn.isRequired ? `<span class=\"form-repeater-fields__table-heading-cell-required\"></span>` : `` }\r\n\t\t\t\t\t</div>\r\n\t\t\t\t` ) );\r\n\t\t\t}\r\n\r\n\t\t\t// Add the description\r\n\t\t\tif ( ! isEmpty( headingColumn.description ) ){\r\n\t\t\t\t$headingColumn.append( $( `\r\n\t\t\t\t\t<div class=\"form-repeater-fields__table-heading-cell-description\">\r\n\t\t\t\t\t\t${ headingColumn.description }\r\n\t\t\t\t\t</div>\r\n\t\t\t\t` ) );\r\n\t\t\t}\r\n\r\n\t\t\t// Add heading column\r\n\t\t\t$heading.append( $headingColumn );\r\n\t\t});\r\n\r\n\t\t// Add the column with for the actions\r\n\t\t$heading.append( $( `<th class=\"form-repeater-fields__table-heading-cell form-repeater-fields__table-heading-cell--actions\"></th>` ) );\r\n\r\n\t\t// Append heading\r\n\t\tconst $headingContainer = $table.find( '.form-repeater-fields__table-heading' );\r\n\t\t$headingContainer.append( $heading );\r\n\r\n\t\t// Create HTML of the rows\r\n\t\tconst $rows = $table.find( '.form-repeater-fields__table-rows' );\r\n\r\n\t\t// Get number of rows\r\n\t\tconst numberOfRows = this.fieldRows.length;\r\n\r\n\t\t// Iterate rows of fields\r\n\t\tthis.fieldRows.forEach(( row, index ) => {\r\n\t\t\t// Create container for the row\r\n\t\t\tconst $row = $( `<tr data-order=\"${ index }\"></tr>` );\r\n\r\n\t\t\t// Add the column with for the row number\r\n\t\t\t$row.append( $( `<td class=\"form-repeater-fields__table-rows-cell form-repeater-fields__table-rows-cell--number\">${ ( index + 1 ) }</td>` ) );\r\n\r\n\t\t\t// Add fields\r\n\t\t\trow.forEach(( Field, index ) => {\r\n\t\t\t\t// Create container\r\n\t\t\t\tconst $fieldCell = $( `<td class=\"form-repeater-fields__table-rows-cell\"></td>` );\r\n\r\n\t\t\t\t// Get field's DOM element\r\n\t\t\t\tconst $field = Field.getFormElement();\r\n\t\t\t\t// Make sure all the libraries had been initialized\r\n\t\t\t\tField.initLibraries();\r\n\r\n\t\t\t\t// Add field container\r\n\t\t\t\t$fieldCell.append( $field );\r\n\r\n\t\t\t\t// Append field cell to the row\r\n\t\t\t\t$row.append( $fieldCell );\r\n\t\t\t});\r\n\r\n\t\t\t// Add the column for the actions, and add the delete button\r\n\t\t\tconst $actions = $( `<td class=\"form-repeater-fields__table-rows-cell form-repeater-fields__table-rows-cell--actions\"></td>` );\r\n\t\t\t$row.append( $actions );\r\n\r\n\t\t\tlet fieldAtts = this.getAttributes();\r\n\r\n\t\t\t// Check if the field requires at least on row and if this is the first row\r\n\t\t\tif ( index != 0 || ( index == 0 && ( ! this.attributes.isRequired || numberOfRows > 1 ) ) ){\r\n\t\t\t\t// Check if there is a custom \"Remove row\" label. If there is one,\r\n\t\t\t\t// use that, otherwise use the default one\r\n\t\t\t\tlet removeRowLabel = isDefined( this.attributes.removeRowButtonLabel ) ? this.attributes.removeRowButtonLabel : UncannyAutomator.i18n.removeRow;\r\n\r\n\t\t\t\t// Create delete button\r\n\t\t\t\tconst $removeRowButton = $( `<div class=\"form-repeater-fields__table-rows-cell-remove\" uap-tooltip=\"${ removeRowLabel }\"><span></span></div>` );\r\n\r\n\t\t\t\t// Listen clicks to the remove button\r\n\t\t\t\t$removeRowButton.on( 'click', () => {\r\n\t\t\t\t\t// Remove the row by index\r\n\t\t\t\t\tthis.deleteRow( index );\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// if hideActions is false, Add Remove row button\r\n\t\t\t\tif( ! fieldAtts.hideActions ) {\r\n\t\t\t\t\t// Add remove button to the actions cell\r\n\t\t\t\t\t$actions.append($removeRowButton);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add $row to the $rows element\r\n\t\t\t$rows.append( $row );\r\n\t\t});\r\n\r\n\t\t// Create \"Add row\" button\r\n\t\tlet fieldAtts = this.getAttributes();\r\n\t\t// if hideActions is false, Add Pair button\r\n\t\tif( ! fieldAtts.hideActions ) {\r\n\t\t\tconst $addRowButton = $( `\r\n\t\t\t\t<div class=\"uap-btn uap-btn--primary uap-btn--small\">\r\n\t\t\t\t\t${ UncannyAutomator.i18n.addRow }\r\n\t\t\t\t</div>\r\n\t\t\t` );\r\n\r\n\t\t\t// Check if we have to change label of the button\r\n\t\t\tif ( isDefined( this.attributes.addRowButtonLabel ) ){\r\n\t\t\t\t$addRowButton.text( this.attributes.addRowButtonLabel );\r\n\t\t\t}\r\n\r\n\t\t\t// Listen clicks\r\n\t\t\t$addRowButton.on( 'click', () => {\r\n\t\t\t\t// Show loading animation\r\n\t\t\t\t$addRowButton.addClass( 'uap-btn--loading' );\r\n\r\n\t\t\t\t// Add another row\r\n\t\t\t\tthis.addRow();\r\n\t\t\t});\r\n\r\n\t\t\t// Add actions\r\n\t\t\tconst $actionsContainer = $table.find( '.form-repeater-fields__actions' );\r\n\t\t\t$actionsContainer.append($addRowButton);\r\n\t\t}\r\n\t\treturn $table;\r\n\t}\r\n\r\n\t/**\r\n\t * Get value\r\n\t *\r\n\t * @since  2.0\r\n\t *\r\n\t * @return {object} Object where the key is the field ID and the value is the field's value\r\n\t */\r\n\t\r\n\tgetValue(){\r\n\t\t// Create object where we're going to save the values\r\n\t\tlet value = [];\r\n\r\n\t\t// Iterate rows\r\n\t\tthis.fieldRows.forEach(( row, index ) => {\r\n\t\t\t// Get the value of the fields\r\n\t\t\tlet fieldsValue = {}\r\n\r\n\t\t\t// Iterate fields\r\n\t\t\trow.forEach(( Field, index ) => {\r\n\t\t\t\t// Add it to the fieldsValue object\r\n\t\t\t\tfieldsValue[ Field.getFieldID() ] = Field.getValue();\r\n\t\t\t});\r\n\r\n\t\t\t// Add fields value to the main array\r\n\t\t\tvalue.push( fieldsValue );\r\n\t\t});\r\n\r\n\t\t// Return value\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Add row\r\n\t *\r\n\t * @since  2.0\r\n\t */\r\n\t\r\n\taddRow( fieldsData = {}, reRender = true ){\r\n\t\t// Create an empty row\r\n\t\tlet emptyRow = JSON.parse( JSON.stringify( this.attributes.fields ) );\r\n\r\n\t\t// Remove undefined current value\r\n\t\temptyRow.currentValue = '';\r\n\r\n\t\t// Now iterate the fields\r\n\t\temptyRow = emptyRow.map(( fieldObject, index ) => {\r\n\t\t\t// Remove the label\r\n\t\t\tfieldObject.label = '';\r\n\r\n\t\t\t// Remove the description\r\n\t\t\tfieldObject.description = '';\r\n\r\n\t\t\t// Check if there is a default value for this field\r\n\t\t\tif ( isDefined( fieldsData[ fieldObject.optionCode ] ) ){\r\n\t\t\t\t// And if there is, use that data\r\n\t\t\t\tfieldObject.currentValue = fieldsData[ fieldObject.optionCode ];\r\n\t\t\t}\r\n\r\n\t\t\t// Create field\r\n\t\t\tlet field = new Field( fieldObject.fieldType, fieldObject );\r\n\r\n\t\t\t// Return field instance\r\n\t\t\treturn field;\r\n\t\t});\r\n\r\n\t\t// Add it to the rows of fields\r\n\t\tthis.fieldRows.push( emptyRow );\r\n\r\n\t\t// Render form element again\r\n\t\tif ( reRender ){\r\n\t\t\tthis.reRender();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Rerender the field again\r\n\t */\r\n\r\n\treRender(){\r\n\t\t// Destroy CodeMirror instances\r\n\t\tthis.destroyCodeMirror();\r\n\t\t// Destroy the token selector\r\n\t\tthis.destroyTokenSelector();\r\n\r\n\t\t// Create the form element again\r\n\t\tconst $currentFormElement = this.formElement;\r\n\t\tconst $newFormElement = this.createFormElement( false );\r\n\t\t$currentFormElement.replaceWith( $newFormElement );\r\n\r\n\t\t// Create the token selector\r\n\t\tthis.initTokenSelector();\r\n\t\t// Create the CodeMirror instances\r\n\t\tthis.initCodeMirror();\r\n\t}\r\n\r\n\t/**\r\n\t * Delete row\r\n\t *\r\n\t * @since  2.0\r\n\t */\r\n\t\r\n\tdeleteRow( index ){\r\n\t\t// Check if there is a row with that index\r\n\t\tif ( isDefined( this.fieldRows[ index ] ) ){\r\n\t\t\t// Remove element\r\n\t\t\tthis.fieldRows.splice( index, 1 );\r\n\t\t}\r\n\r\n\t\t// Render form element again\r\n\t\tthis.formElement.replaceWith( this.createFormElement() );\r\n\t}\r\n\r\n\t/**\r\n\t * Get form element\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @return {object} jQuery object of the field's container\r\n\t */\r\n\r\n\tgetFormElement(){\r\n\t\t// Return form element\r\n\t\treturn this.formElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Get attributes\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @return {object} Field attributes\r\n\t */\r\n\r\n\tgetAttributes(){\r\n\t\treturn this.attributes;\r\n\t}\r\n\r\n\t/**\r\n\t * Get field ID\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @return {string} The field ID\r\n\t */\r\n\r\n\tgetFieldID(){\r\n\t\treturn this.attributes.optionCode;\r\n\t}\r\n\r\n\t/**\r\n\t * Validate the fields\r\n\t * \r\n\t * @since 2.0\r\n\t *\r\n\t * @param  {boolean} renderError - TRUE if you want to render the field errors, FALSE if you only want to return the response object\r\n\t *\r\n\t * @return {object} Object where the key is the field ID and the value is a validateField object\r\n\t */\r\n\t\r\n\tvalidate( renderError = true ){\r\n\t\t// Create validation object\r\n\t\tlet validation = {\r\n\t\t\tisValid: true,\r\n\t\t\tmessage: ''\r\n\t\t}\r\n\r\n\t\t// Create array to save the validation of the rows\r\n\t\tlet rowsValidation = [];\r\n\r\n\t\t// Iterate fields\r\n\t\tthis.fieldRows.forEach(( row, index ) => {\r\n\t\t\t// Create object to save the row validation\r\n\t\t\tlet rowValidation = {}\r\n\r\n\t\t\t// Iterate each field\r\n\t\t\trow.forEach(( Field, index ) => {\r\n\t\t\t\t// Validate and add response to the validation object\r\n\t\t\t\trowValidation[ Field.getFieldID() ] = Field.validate( renderError );\r\n\r\n\t\t\t\t// Update global validation\r\n\t\t\t\tvalidation.isValid = validation.isValid && rowValidation[ Field.getFieldID() ].isValid;\r\n\t\t\t});\r\n\r\n\t\t\t// Add row validation to the main validation array\r\n\t\t\trowsValidation.push( rowValidation );\r\n\t\t});\r\n\r\n\t\t// Return validation object\r\n\t\treturn validation;\r\n\t}\r\n\r\n\tinitTokenSelector(){\r\n\t\tthis.fieldRows.forEach(( rowFields ) => {\r\n\t\t\t// Iterate row fields\r\n\t\t\trowFields.forEach(( Field ) => {\r\n\t\t\t\t// Add field\r\n\t\t\t\tField.initTokenSelector();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tdestroyTokenSelector(){\r\n\t\tthis.fieldRows.forEach(( rowFields ) => {\r\n\t\t\t// Iterate row fields\r\n\t\t\trowFields.forEach(( Field ) => {\r\n\t\t\t\t// Add field\r\n\t\t\t\tField.destroyTokenSelector();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tinitCodeMirror(){\r\n\t\tthis.fieldRows.forEach(( rowFields ) => {\r\n\t\t\t// Iterate row fields\r\n\t\t\trowFields.forEach(( Field ) => {\r\n\t\t\t\t// Add field\r\n\t\t\t\tField.initCodeMirror();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tdestroyCodeMirror(){\r\n\t\tthis.fieldRows.forEach(( rowFields ) => {\r\n\t\t\t// Iterate row fields\r\n\t\t\trowFields.forEach(( Field ) => {\r\n\t\t\t\t// Add field\r\n\t\t\t\tField.destroyCodeMirror();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default FieldsRepeater;","import $ from 'jquery';\r\n\r\nimport {\r\n    getDOMElements\r\n}                              from './Utilities.js';\r\nimport ItemCreatorIntegrations from './ItemCreatorIntegrations.js';\r\n\r\nclass ItemCreatorAdd {\r\n    constructor( itemType ){\r\n        let $container    = $( '<div/>', { 'class': 'item item--start' }),\r\n            $icon         = $( '<div/>', { 'class': 'item-icon' }),\r\n            $containerBox = $( '<div/>', { 'class': 'item-title uap-clear' }),\r\n            $button       = $( '<div/>', { 'class': 'uap-btn uap-btn--secondary uap-btn--small' });\r\n\r\n        $containerBox.append( $button );\r\n        $container.append( $icon );\r\n        $container.append( $containerBox );\r\n\r\n        // Add to the metabox\r\n        let $metabox = getDOMElements( 'metabox', {\r\n            type: itemType\r\n        });\r\n\r\n        $metabox.append( $container );\r\n\r\n        // Add text depending of the itemType\r\n        if ( itemType == 'trigger' ){\r\n            $button.text( UncannyAutomator.i18n.trigger.add );\r\n        }\r\n\r\n        if ( itemType == 'action' ){\r\n            $button.text( UncannyAutomator.i18n.action.add );\r\n        }\r\n\r\n        $button.on( 'click', () => new ItemCreatorIntegrations( itemType ) );\r\n    }\r\n}\r\n\r\nexport default ItemCreatorAdd;","import $ from 'jquery';\r\n\r\nimport {\r\n    sortArrayOfObjectsAlphabetically,\r\n    addParametersToURL,\r\n    getDOMElements,\r\n    filterDeprecatedItems,\r\n    isDefined,\r\n    vsprintf\r\n} from './Utilities.js';\r\nimport ItemHeaderMenu          from './ItemHeaderMenu.js';\r\nimport itemCreatorTaskSelector from './itemCreatorTaskSelector.js';\r\n\r\nclass ItemCreatorIntegrations {\r\n    constructor( itemType, $currentItem ){\r\n        this.itemType     = itemType;\r\n        this.$currentItem = $currentItem;\r\n        this.integrations = [];\r\n\r\n        // Render DOM elements\r\n        this.render();\r\n    }\r\n\r\n    render(){\r\n        // Create container\r\n        let container = $( '<div/>', { 'class': 'item' });\r\n        this.$item    = container;\r\n\r\n        let header       = this.createHeader(),\r\n            itemContent  = $( '<div/>', {'class': 'item__content' }),\r\n            integrations = this.createIntegrations(),\r\n            discoverMore = this.createDiscoverMoreIntegrations();\r\n\r\n        container.append( header );\r\n\r\n        itemContent.append( integrations );\r\n        itemContent.append( discoverMore );\r\n\r\n        container.append( itemContent );\r\n\r\n        // Check if the $item is defined, in that case we're going to replace the item element instead of creating a new one\r\n        if ( isDefined( this.$currentItem ) ){\r\n            // Empty container\r\n            this.$currentItem.replaceWith( container );\r\n        }\r\n        else {\r\n            // Get last item and append next to it\r\n            let lastItem = getDOMElements( 'lastItem', {\r\n                type: this.itemType\r\n            });\r\n\r\n            if ( this.itemType == 'trigger' ){\r\n                // Check if there is a last item\r\n                if ( lastItem.length > 0 ){\r\n                    container.insertAfter( lastItem );\r\n                }\r\n                else {\r\n                    // Otherwise append the item to the metabox\r\n                    let metabox = getDOMElements( 'metabox', {\r\n                        type: this.itemType\r\n                    });\r\n\r\n                    metabox.append( container );\r\n                }\r\n            }\r\n            \r\n            if ( this.itemType == 'action' ){\r\n                // Check if there is at least one item\r\n                let items = getDOMElements( 'items', {\r\n                    type: this.itemType\r\n                });\r\n\r\n                if ( items.length > 0 ){\r\n                    // Insert after the last item\r\n                    container.insertAfter( lastItem );\r\n                }\r\n                else {\r\n                    // Otherwise replace the itemCreatorAdd container with the new container\r\n                    let metabox = getDOMElements( 'metabox', {\r\n                        type: this.itemType\r\n                    });\r\n                    let itemCreatorAdd = metabox.find( '.item.item--start' );\r\n                    itemCreatorAdd.replaceWith( container );\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    createHeader(){\r\n        let header  = $( '<div/>' );\r\n\r\n        let icon           = $( '<div/>', { 'class': 'item-icon' }),\r\n            titleContainer = $( '<div/>', { 'class': 'item-title uap-clear' }),\r\n            titleContent   = $( '<div/>', { 'class': 'item-title__describe' }),\r\n            title          = $( '<div/>', { 'class': 'item-title__non-editable' }).text( UncannyAutomator.i18n.integration.select );\r\n\r\n        let actions        = new ItemHeaderMenu( this.itemType );\r\n        header.append( actions );\r\n\r\n        header.append( icon );\r\n\r\n        titleContent.append( title );\r\n        titleContainer.append( titleContent );\r\n        header.append( titleContainer );\r\n\r\n        return header;\r\n    }\r\n\r\n    createIntegrations(){\r\n        let container    = $( '<div/>', { 'class': 'item-integrations' });\r\n\r\n        // Get non empty integrations\r\n        this.filterByNonEmptyIntegrations( this.itemType );\r\n\r\n        // Order integrations alphabetically\r\n        this.sortIntegrationsAlphabetically();\r\n\r\n        // Iterate integrations\r\n        this.integrations.forEach(( integration ) => {\r\n            // Get integration ID\r\n            const integrationID = integration.id;\r\n\r\n            // Create integration element\r\n            let integrationElement = this.createIntegration( integrationID, integration );\r\n\r\n            // Bind\r\n            integrationElement.on( 'click', () => {\r\n                new itemCreatorTaskSelector( this.itemType, integrationID, this.$item );\r\n            });\r\n\r\n            // Append\r\n            container.append( integrationElement );\r\n        });\r\n\r\n        // Return jQuery element\r\n        return container;\r\n    }\r\n\r\n    createIntegration( integrationID, integration ){\r\n        let container   = $( '<div/>', { 'class': 'item-integration' }),\r\n            logo        = $( '<div/>', { 'class': 'item-integration__logo' }),\r\n            name        = $( '<div/>', { 'class': 'item-integration__name' });\r\n\r\n        // Check if it's a Pro only integration\r\n        if ( integration.isProOnly ){\r\n            // Add a class to identify it\r\n            container.addClass( 'item-integration--pro' );\r\n\r\n            // Add PRO tag\r\n            container.append( $( `\r\n                <div class=\"item-integration__badge\">${ UncannyAutomator.i18n.proOnly.pro }</div>\r\n            ` ) );\r\n        }\r\n        \r\n        // Check if the integration is not available\r\n        if ( ! integration.isAvailable ){\r\n            // Add a class to identify it\r\n            container.addClass( 'item-integration--unavailable' );\r\n\r\n            // Add tooltip\r\n            container.attr( 'uap-tooltip', vsprintf( UncannyAutomator.i18n.proOnly.requiresPro, [ UncannyAutomator.i18n.uncannyAutomatorPro ] ) );\r\n        }\r\n        else {\r\n            // Add a class to identify it\r\n            container.addClass( 'item-integration--available' );\r\n        }\r\n\r\n        // Create the variable where we're going to save the logo\r\n        let $logoImg;\r\n\r\n        // Check if it has a svg image\r\n        if ( isDefined( integration.icon_svg ) ){\r\n            $logoImg = $( `<img src=\"${ integration.icon_svg }\" alt=\"${ integration.name }\">` );\r\n        }\r\n        // Check if it has a png image\r\n        else if ( isDefined( integration.icon_32 ) && isDefined( integration.icon_64 ) ){\r\n            $logoImg = $( `<img src=\"${ integration.icon_32 }\" srcset=\"${ vsprintf( '%s 1x, %s 2x', [ integration.icon_32, integration.icon_64 ]) }\" alt=\"${ integration.name }\">` );\r\n        }\r\n\r\n        // TO-DO\r\n        // Improve UI/UX\r\n        // Set integration name\r\n        name.text( integration.name );\r\n\r\n        // Append\r\n        logo.append( $logoImg );\r\n        container.append( logo );\r\n        container.append( name );\r\n\r\n        // Return jQuery element\r\n        return container;\r\n    }\r\n\r\n    createDiscoverMoreIntegrations(){\r\n        return $( `\r\n            <div class=\"item-content__description\">\r\n                ${ UncannyAutomator.i18n.integration.discoverMore } <a href=\"${ addParametersToURL( 'https://automatorplugin.com/integrations/', {\r\n                        'utm_source':  'uncanny_automator',\r\n                        'utm_medium':  'select_an_integration',\r\n                        'utm_content': 'discover_more_integrations'\r\n                    }) }\" target=\"_blank\">${ UncannyAutomator.i18n.learnMore } <span class=\"uo-icon uo-icon--external-link-alt\"></span></a>\r\n            </div>\r\n        ` );\r\n    }\r\n\r\n    filterByNonEmptyIntegrations( itemType ){\r\n        // Check if it's a valid item type\r\n        if ( [ 'trigger', 'action' ].includes( itemType ) ){\r\n            // Get the integrations\r\n            const integrations = $.extend( true, {}, UncannyAutomator.integrations );\r\n\r\n            // Iterate each integration\r\n            Object.entries( integrations ).forEach(([ integrationID, integration ]) => {\r\n                // Evaluate if it has the requested items by item type\r\n                let hasItems = false;\r\n                // Also evaluate if it has available items\r\n                let isProOnly = false;\r\n                // Also evaluate if it has available items\r\n                let isAvailable = false;\r\n\r\n                // Remove deprecated items\r\n                let items;\r\n\r\n                if ( itemType == 'trigger' ){\r\n                    // Get items\r\n                    items       = filterDeprecatedItems( integration.items.triggers );\r\n\r\n                    hasItems    = items.hasTriggers;\r\n                    isAvailable = items.hasAvailableItems;\r\n                    isProOnly   = items.allItemsArePro;\r\n                }\r\n                else if ( itemType == 'action' ){\r\n                    // Get items\r\n                    items       = filterDeprecatedItems( integration.items.actions );\r\n\r\n                    hasItems    = items.hasActions;\r\n                    isAvailable = items.hasAvailableItems;\r\n                    isProOnly   = items.allItemsArePro;\r\n                }\r\n\r\n                // Check if it has the requested items by item type\r\n                if ( hasItems ){\r\n                    // Add integration to the list of integrations\r\n                    this.integrations.push( $.extend({}, integration, {\r\n                        id:          integrationID,\r\n                        isAvailable: isAvailable,\r\n                        isProOnly:   isProOnly\r\n                    }) );\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    sortIntegrationsAlphabetically(){\r\n        // Sort the array of integrations using the integration name\r\n        this.integrations = sortArrayOfObjectsAlphabetically( this.integrations, 'name' );\r\n    }\r\n}\r\n\r\nexport default ItemCreatorIntegrations;","import $ from 'jquery';\r\n\r\nimport {\r\n    restCall\r\n} from './Utilities.js';\r\n\r\nimport Field from './Field';\r\nimport Modal from './Modal.js';\r\nimport Actions  from './Actions.js';\r\n\r\nclass ItemHeaderAsync {\r\n\r\n    buttonContainer;\r\n    button;\r\n    buttonIcon;\r\n\r\n    removeButton;\r\n\r\n    asyncModeField;\r\n    asyncModeHTML;\r\n\r\n    delayNumberField;\r\n    delayNumberHTML;\r\n\r\n    delayUnitField;\r\n    delayUnitHTML;\r\n\r\n    scheduleDateField;\r\n    scheduleDateHTML;\r\n\r\n    scheduleTimeField;\r\n    scheduleTimeHTML;\r\n\r\n    scheduleNoticeHTML;\r\n\r\n    modal;\r\n\r\n    /**\r\n     * Create item actions\r\n     *\r\n     * @since 0.5\r\n     *\r\n     * @return jQuery DOM element with the item actions\r\n     */\r\n\r\n    constructor( itemType, integrationID, itemCode, itemId ){\r\n        this.itemType      = itemType;\r\n        this.integrationID = integrationID;\r\n        this.itemCode      = itemCode;\r\n        this.itemId        = itemId;\r\n        this.item          = UncannyAutomator.recipe.items[ itemId ];\r\n        this.asyncMode     = this.item.meta.async_mode;\r\n\r\n        if ( UncannyAutomator.proVersion.startsWith( \"2\" ) ) {\r\n            return null;\r\n        }\r\n\r\n        return this.createAsyncButton();\r\n        \r\n    }\r\n\r\n    hasSchedule() {\r\n        if ( ! this.asyncMode ) {\r\n            return false;\r\n        }\r\n\r\n        if ( this.asyncMode == 'delay' ) {\r\n            return this.item.meta.async_delay_number && this.item.meta.async_delay_unit;\r\n        }\r\n\r\n        if ( this.asyncMode == 'schedule' ) {\r\n            return this.item.meta.async_schedule_time && this.item.meta.async_schedule_date;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    getButtonText() {\r\n        if ( this.hasSchedule() ) {\r\n            let text = UncannyAutomator.i18n.action.asyncActions[this.asyncMode];\r\n            text += ' ';\r\n            text += '<strong>' + this.item.meta.async_sentence + '</strong>';\r\n            return  text;\r\n        }\r\n        return UncannyAutomator.i18n.action.asyncActions.delay;\r\n    }\r\n\r\n    createAsyncButton(){\r\n\r\n        // Create elements\r\n        this.buttonContainer     = $( '<div/>', { 'class': 'item-async' } );\r\n        this.button           = $( '<div/>', { 'class': 'item-async__btn' } );\r\n        this.buttonIcon       = $( '<i/>', { 'class': 'uo-icon uo-icon--watch' } );\r\n        \r\n\r\n        \r\n        this.button.html( this.getButtonText() );\r\n        this.button.prepend( this.buttonIcon );\r\n        this.buttonContainer.append( this.button );\r\n\r\n        if ( this.hasSchedule() ) {\r\n            this.createRemoveButton();\r\n        }\r\n\r\n        if ( this.isNew() ) {\r\n            this.createBadge( UncannyAutomator.i18n.action.asyncActions.new );\r\n        }\r\n\r\n        // Listen clicks to the open button\r\n        this.button.on( 'click', () => {\r\n            this.showModal();\r\n        } );\r\n\r\n\r\n        return this.buttonContainer;\r\n    }\r\n\r\n    isNew() {\r\n        // TODO When to hide this?\r\n        return true;\r\n    }\r\n\r\n    createBadge( label ) {\r\n        this.buttonBadge = $( '<span/>', { 'class': 'async-button__badge' } );\r\n        this.buttonBadge.text( label );\r\n        this.button.append( this.buttonBadge );\r\n    }\r\n\r\n    createRemoveButton() {\r\n        this.removeButton = $( '<span/>', { 'class': 'async-remove' } );\r\n        this.removeButtonIcon = $( '<i/>', { 'class': 'uo-icon uo-icon--times' } );\r\n\r\n        this.removeButton.text( UncannyAutomator.i18n.action.asyncActions.remove ) \r\n        this.removeButton.on( 'click', () => {\r\n            this.removeSchedule();\r\n        });\r\n        this.removeButton.prepend( this.removeButtonIcon );\r\n        this.buttonContainer.append( this.removeButton );\r\n    }\r\n\r\n    createModalContent() {\r\n        // Create the content for the modal\r\n        let modalContent = $( `<div/>`, { 'class': 'async-action-modal' } );\r\n\r\n        this.asyncModeHTML = this.createasyncModeHTML();\r\n\r\n        this.asyncModeHTML.find( \".form-radio__container:first\" ).after( this.createDelayOptions() );\r\n        this.asyncModeHTML.find( \".form-radio__container:last\" ).after( this.createScheduleOptions() );\r\n\r\n        this.attachModeChangeEvent();\r\n    \r\n        // Add the field\r\n        modalContent.append( this.asyncModeHTML );\r\n\r\n        if ( this.hasSchedule() ) {\r\n            let modalNoticeHTML = $( '<div/>', { 'class': 'async-notice async-notice__blue' } );\r\n            let modalNoticeIcon = $( '<i/>', { 'class': 'uo-icon uo-icon--exclamation-triangle' } );\r\n            modalNoticeHTML.append( modalNoticeIcon );\r\n            modalNoticeHTML.append( UncannyAutomator.i18n.action.asyncActions.modal.scheduleNotice2 );\r\n            modalContent.append( modalNoticeHTML );\r\n        } \r\n\r\n        return modalContent;\r\n    }\r\n\r\n    showModal() {\r\n        // Show a modal\r\n        this.modal = new Modal( {\r\n            title: UncannyAutomator.i18n.action.asyncActions.modal.title,\r\n            content: this.createModalContent(),\r\n            buttons: {\r\n                cancel:  UncannyAutomator.i18n.cancel,\r\n                confirm: UncannyAutomator.i18n.action.asyncActions.modal.confirm,\r\n            }\r\n        }, {\r\n            size: 'large',\r\n            customClass: 'async-action'\r\n        } );\r\n\r\n        this.modalEvents();\r\n    }\r\n\r\n    modalEvents() {\r\n        this.modal.setEvents( {\r\n            afterSetEvents: () => {\r\n                \r\n                this.modal.show();\r\n            },\r\n            onConfirm: () => {\r\n                this.submitModal();\r\n                \r\n            },\r\n            afterHide: () => {\r\n                this.modal.destroy();\r\n            }\r\n        } );\r\n    }\r\n\r\n    submitModal() {\r\n        let elements        = this.modal.getElements();\r\n        let confirmButton   = elements.modal.box.buttons.confirm;\r\n\r\n        // Add loading class to button\r\n        confirmButton.addClass( 'uap-btn--loading' ).prop( 'disabled', true );\r\n\r\n        if ( ! this.validateForm().isValid ) {\r\n            confirmButton.removeClass( 'uap-btn--loading' ).prop( 'disabled', false );\r\n            return;\r\n        }\r\n\r\n        let asyncMode = this.asyncModeField.getValue();\r\n        let delayNumber = this.delayNumberField.getValue();\r\n        let delayUnit = this.delayUnitField.getValue();\r\n        let scheduleTime = this.scheduleTimeField.getValue();\r\n        let scheduleDate = this.scheduleDateField.getValue();\r\n\r\n\r\n        let sentence;\r\n\r\n        if ( asyncMode == 'delay' ) {\r\n            sentence = this.delaySentence();\r\n        } else {\r\n            sentence = this.scheduleSentence();\r\n        }\r\n        \r\n        this.saveSchedule( asyncMode, delayNumber, delayUnit, scheduleTime, scheduleDate, sentence )\r\n        \r\n    }\r\n\r\n    delaySeconds() {\r\n        let delayUnit = this.delayUnitField.getValue();\r\n        let delayNumber = this.delayNumberField.getValue();\r\n        let multiplier;\r\n\r\n        switch ( delayUnit ) {\r\n            case 'seconds':\r\n                multiplier = 1;\r\n                break;\r\n            case 'minutes':\r\n                multiplier = 60;\r\n                break;\r\n            case 'hours':\r\n                multiplier = 60 * 60;\r\n                break;\r\n            case 'days':\r\n                multiplier = 60 * 60 * 24;\r\n                break;    \r\n            case 'years':\r\n                multiplier = 60 * 60 * 24 * 365;\r\n                break;\r\n            default:\r\n                multiplier = 1;\r\n                break;\r\n        }\r\n\r\n        return delayNumber * multiplier; \r\n    }\r\n\r\n    delaySentence() {\r\n        let unit = this.delayUnitField.getValue();\r\n\r\n        if ( this.delayNumberField.getValue() == 1 ) {\r\n            unit = unit.slice(0, -1);\r\n        }\r\n\r\n        return '' + this.delayNumberField.getValue() + ' ' + UncannyAutomator.i18n.action.asyncActions.modal[unit];\r\n    }\r\n\r\n    scheduleSeconds() {\r\n        return Date.parse( this.scheduleDateField.getValue() + ' ' + this.scheduleTimeField.getValue() );\r\n    }\r\n\r\n    scheduleSentence() {\r\n        return this.scheduleDateField.getValue() + ' @ ' + this.scheduleTimeField.getValue();\r\n    }\r\n\r\n    saveSchedule( asyncMode, delayNumber = null, delayUnit = null, scheduleTime = null, scheduleDate = null, sentence = null ) {\r\n        // Do call and hide\r\n        restCall( 'schedule_action', {\r\n            'recipeId': UncannyAutomator.recipe.id,\r\n            'actionId': this.itemId,\r\n            'asyncMode': asyncMode,\r\n            'delayNumber': delayNumber,\r\n            'delayUnit': delayUnit,\r\n            'scheduleTime': scheduleTime,\r\n            'scheduleDate': scheduleDate,\r\n            'scheduleSentence': sentence\r\n        }, () => {\r\n            // Destroy modal\r\n            this.modal.destroy();\r\n            \r\n            new Actions();\r\n\r\n            // Check if the recipe is still valid, if it isn't then make the recipe draft\r\n            if ( ! UncannyAutomator.recipe.isValid ){\r\n                UncannyAutomator.recipe.publish.statusToggle.setValue( false );\r\n            }\r\n        }, () => {\r\n            // Destroy modal\r\n            this.modal.destroy();\r\n\r\n            console.log( '‼️ ERROR-TODO. Couldn\\'t schedule the item' );\r\n\r\n            new Actions();\r\n            \r\n        });\r\n    }\r\n\r\n    removeSchedule() {\r\n\r\n        // Do call and hide\r\n        restCall( 'remove_schedule', {\r\n            'recipeId': UncannyAutomator.recipe.id,\r\n            'actionId': this.itemId,\r\n        }, () => {\r\n        \r\n            new Actions();\r\n\r\n            // Check if the recipe is still valid, if it isn't then make the recipe draft\r\n            if ( ! UncannyAutomator.recipe.isValid ){\r\n                UncannyAutomator.recipe.publish.statusToggle.setValue( false );\r\n            }\r\n        }, () => {\r\n\r\n            console.log( '‼️ ERROR-TODO. Couldn\\'t schedule the item' );\r\n\r\n            new Actions();\r\n            \r\n        });\r\n    }\r\n\r\n    createTimeZone() {\r\n\r\n        let timeZoneHelpIcon = $( '<i/>', { 'class': 'uo-icon uo-icon--question-circle' });\r\n\r\n        let timeZoneDesc = $( '<span/>', { 'class': 'schedule-fields__description' }).html( '<strong>' + UncannyAutomator.i18n.action.asyncActions.modal.timezone + '</strong>: ' + UncannyAutomator.i18n.action.asyncActions.modal.timezoneString );\r\n\r\n        timeZoneDesc.append( timeZoneHelpIcon );\r\n\r\n        return timeZoneDesc;\r\n\r\n    }\r\n\r\n    createasyncModeHTML() {\r\n        // Create the radio field\r\n        this.asyncModeField = new Field( 'radio', {\r\n            itemType: 'action',\r\n            optionCode: 'schedule_type',\r\n            name: 'schedule-type',\r\n            isRequired: true,\r\n            currentValue: this.asyncMode ? this.asyncMode : 'delay',\r\n            options: [\r\n                {\r\n                    value: 'delay',\r\n                    text: UncannyAutomator.i18n.action.asyncActions.delay\r\n                },\r\n                {\r\n                    value: 'schedule',\r\n                    text: UncannyAutomator.i18n.action.asyncActions.schedule\r\n                }\r\n            ]\r\n\r\n        }); \r\n\r\n        return this.asyncModeField.createFormElement().addClass( 'schedule-type-radio' );\r\n    }\r\n\r\n    attachModeChangeEvent() {\r\n        // Attach an event and change the confirm button text according to selection\r\n        this.asyncModeHTML.on( \"automator:field:change\", () => {\r\n            let selectedAsyncMode = this.asyncModeField.getValue();\r\n            if ( selectedAsyncMode == 'schedule' ) {  \r\n                this.scheduleNoticeHTML.removeClass( 'hidden' );\r\n                this.modal.elements.modal.box.buttons.confirm.text( UncannyAutomator.i18n.action.asyncActions.schedule );\r\n            } else {\r\n                this.scheduleNoticeHTML.addClass( 'hidden' );\r\n                this.modal.elements.modal.box.buttons.confirm.text( UncannyAutomator.i18n.action.asyncActions.modal.confirm );\r\n            }\r\n        });\r\n    }\r\n\r\n    createScheduleOptions() {\r\n\r\n        let scheduleOptions = $( `<div/>`, { 'class': 'schedule-options' } );\r\n\r\n        let scheduleDesc = $( '<span/>', { 'class': 'async-mode__description' } ).text( UncannyAutomator.i18n.action.asyncActions.modal.scheduleDesc );\r\n\r\n        let scheduleFields = $( '<div/>', { 'class': 'schedule-fields' } );\r\n\r\n        if ( ! this.hasSchedule() ) {\r\n            this.scheduleNoticeHTML = $( '<div/>', { 'class': 'schedule-notice hidden' } );\r\n            let scheduleNoticeIcon = $( '<i/>', { 'class': 'uo-icon uo-icon--question-circle' } );\r\n            this.scheduleNoticeHTML.text( UncannyAutomator.i18n.action.asyncActions.modal.scheduleNotice1 );\r\n            this.scheduleNoticeHTML.append( scheduleNoticeIcon );\r\n            this.scheduleNoticeHTML.addClass( 'schedule-notice__yellow' );\r\n        } \r\n\r\n        scheduleOptions.append( scheduleDesc );\r\n\r\n        scheduleFields.append( this.createScheduleDateHTML() );\r\n\r\n        scheduleFields.append( this.createScheduleTimeHTML() );\r\n\r\n        scheduleOptions.append( scheduleFields );\r\n       \r\n        scheduleOptions.append( this.createTimeZone() );\r\n\r\n        scheduleOptions.append( this.scheduleNoticeHTML );\r\n\r\n        return scheduleOptions;\r\n    }\r\n\r\n    createDelayOptions() {\r\n        let delayOptions = $( `<div/>`, { 'class': 'delay-options' } );\r\n\r\n        let delayDesc = $( '<span/>', { 'class': 'async-mode__description' } ).text( UncannyAutomator.i18n.action.asyncActions.modal.delayDesc );\r\n\r\n        let delayFields = $( '<div/>', { 'class': 'delay-fields' } );\r\n\r\n\r\n        this.delayNumberHTML = this.createDelayNumberHTML();\r\n\r\n        this.delayUnitHTML = this.createDelayUnitHTML();\r\n        \r\n        let delayFieldsDesc = $( '<span/>', { 'class': 'delay-fields__description' } ).text( UncannyAutomator.i18n.action.asyncActions.modal.after );\r\n\r\n\r\n\r\n        delayFields.append( this.delayNumberHTML );\r\n\r\n        delayFields.append( this.delayUnitHTML );\r\n\r\n        delayFields.append( delayFieldsDesc );\r\n\r\n\r\n        delayOptions.append( delayDesc );\r\n\r\n        delayOptions.append( delayFields );\r\n\r\n\r\n        return delayOptions;\r\n    }\r\n\r\n    createDelayNumberHTML() {\r\n\r\n        this.delayNumberField = new Field( 'int', {\r\n            itemType: 'action',\r\n            optionCode: 'delay-number',\r\n            isRequired: false,\r\n            supportsTokens: false,\r\n            currentValue: this.item.meta.async_delay_number ? this.item.meta.async_delay_number : ''\r\n        },\r\n        true,\r\n        this.validateDelayNumber);\r\n\r\n        return this.delayNumberField.createFormElement().addClass( 'delay-fields__number' );\r\n    }\r\n\r\n    createDelayUnitHTML() {\r\n\r\n        this.delayUnitField = new Field( 'select', {\r\n            itemType: 'action',\r\n            optionCode: 'delay-unit',\r\n            currentValue: this.item.meta.async_delay_unit ? this.item.meta.async_delay_unit : 'minutes',\r\n            customClass: 'hide-this',\r\n            isRequired: false,\r\n            options: [\r\n                {\r\n                    value: 'seconds',\r\n                    text:  UncannyAutomator.i18n.action.asyncActions.modal.seconds\r\n                },\r\n                {\r\n                    value: 'minutes',\r\n                    text:  UncannyAutomator.i18n.action.asyncActions.modal.minutes\r\n                },\r\n                {\r\n                    value: 'hours',\r\n                    text:  UncannyAutomator.i18n.action.asyncActions.modal.hours\r\n                },\r\n                {\r\n                    value: 'days',\r\n                    text:  UncannyAutomator.i18n.action.asyncActions.modal.days\r\n                },\r\n                {\r\n                    value: 'years',\r\n                    text:  UncannyAutomator.i18n.action.asyncActions.modal.years\r\n                },\r\n            ]\r\n        });\r\n\r\n        return this.delayUnitField.createFormElement().addClass( 'delay-fields__unit' );\r\n    }\r\n\r\n    createScheduleDateHTML() {\r\n        // Create value field\r\n        this.scheduleDateField = new Field( 'date', {\r\n            itemType: 'action',\r\n            optionCode: 'schedule-date',\r\n            isRequired: false,\r\n            dateFormat: UncannyAutomator.i18n.action.asyncActions.modal.dateFormat,\r\n            supportsTokens: false,\r\n            currentValue: this.item.meta.async_schedule_date ? this.item.meta.async_schedule_date : ''\r\n        });\r\n\r\n        // Create form element\r\n        const $scheduleDateField = this.scheduleDateField.createFormElement();\r\n\r\n        $scheduleDateField.addClass( 'schedule-fields__date' );\r\n\r\n        // Init Codemirror\r\n        this.scheduleDateField.initCodeMirror();\r\n\r\n        return $scheduleDateField;\r\n    }\r\n\r\n    createScheduleTimeHTML() {\r\n        // Create value field\r\n        this.scheduleTimeField = new Field( 'time', {\r\n            itemType: 'action',\r\n            optionCode: 'schedule-time',\r\n            isRequired: false,\r\n            timeFormat: UncannyAutomator.i18n.action.asyncActions.modal.timeFormat,\r\n            supportsTokens: false,\r\n            currentValue: this.item.meta.async_schedule_time ? this.item.meta.async_schedule_time : ''\r\n        });\r\n\r\n        // Create form element\r\n        const $scheduleTimeField = this.scheduleTimeField.createFormElement();\r\n\r\n        $scheduleTimeField.addClass( 'schedule-fields__time' )\r\n\r\n        // Init Codemirror\r\n        this.scheduleTimeField.initCodeMirror();\r\n\r\n        return $scheduleTimeField;\r\n    }\r\n\r\n    validateForm() {\r\n\r\n        let asyncMode = this.asyncModeField.getValue();\r\n\r\n        let validSchedule;\r\n\r\n        switch ( asyncMode ) {\r\n            case 'schedule':\r\n                validSchedule = this.validateScheduleFields();\r\n                break;\r\n            case 'delay':\r\n                validSchedule = this.delayNumberField.validate();\r\n                break;\r\n            default:\r\n                validSchedule = { isValid: false, message: UncannyAutomator.i18n.action.asyncActions.modal.validation.unsupported }\r\n                break;\r\n        }\r\n\r\n        if ( ! validSchedule.isValid ) {\r\n            return validSchedule;\r\n        }\r\n\r\n        return { isValid: true };\r\n    }\r\n\r\n    validateScheduleFields( value ) {\r\n        return { isValid: true };\r\n    }\r\n\r\n    validateDelayNumber( value, simulate_int ) {\r\n        \r\n        if ( value < 0 ) {\r\n            return { isValid: false, message: UncannyAutomator.i18n.action.asyncActions.modal.validation.positiveNumber }\r\n        }   \r\n\r\n        return { isValid: true };\r\n    }\r\n}\r\n\r\nexport default ItemHeaderAsync;\r\n","import $ from 'jquery';\r\n\r\nimport {\r\n\tvsprintf,\r\n\tisDefined\r\n} from './Utilities.js';\r\n\r\nclass ItemHeaderIcon {\r\n\tconstructor( integrationCode ){\r\n\t\tthis.integrationCode = integrationCode;\r\n\r\n\t\treturn this.createItemIcon();\r\n\t}\r\n\r\n\t/**\r\n     * Create item icon\r\n     *\r\n     * @since 0.5\r\n     *\r\n     * @return {object}   HTML with the item icon\r\n     */\r\n\r\n    createItemIcon(){\r\n    \tlet container   = $( '<div/>', { 'class': 'item-icon' });\r\n\r\n    \tif ( isDefined( UncannyAutomator.integrations[ this.integrationCode ] ) ){\r\n\t\t\t// Get integration by integrationCode\r\n\t        let integration = UncannyAutomator.integrations[ this.integrationCode ];\r\n\r\n\t        // Create the variable where we're going to save the icon\r\n\t        let $icon;\r\n\r\n\t\t\t// Check if it has a svg image\r\n\t\t\tif ( isDefined( integration.icon_svg ) ){\r\n\t\t\t\t$icon = $( `<img src=\"${ integration.icon_svg }\" alt=\"${ integration.name }\">` );\r\n\t\t\t}\r\n\t\t\t// Check if it has a png image\r\n\t\t\telse if ( isDefined( integration.icon_32 ) && isDefined( integration.icon_64 ) ){\r\n\t\t\t\t$icon = $( `<img src=\"${ integration.icon_32 }\" srcset=\"${ vsprintf( '%s 1x, %s 2x', [ integration.icon_32, integration.icon_64 ]) }\" alt=\"${ integration.name }\">` );\r\n\t\t\t}\r\n\r\n\t        container.append( $icon );\r\n    \t} \r\n\r\n        // Return element\r\n        return container;\r\n    }\r\n}\r\n\r\nexport default ItemHeaderIcon;","import $ from 'jquery';\r\n\r\nimport {\r\n    restCall,\r\n    getGlobalItem,\r\n    isDefined,\r\n    replaceCurlyBraces,\r\n    addParametersToURL\r\n} from './Utilities.js';\r\n\r\nimport Modal from './Modal.js';\r\n\r\nimport Triggers from './Triggers.js';\r\nimport Actions  from './Actions.js';\r\n\r\nclass ItemHeaderMenu {\r\n    /**\r\n     * Create item actions\r\n     *\r\n     * @since 0.5\r\n     *\r\n     * @return jQuery DOM element with the item actions\r\n     */\r\n\r\n    constructor( itemType, integrationID, itemCode, itemId ){\r\n        this.itemType      = itemType;\r\n        this.integrationID = integrationID;\r\n        this.itemCode      = itemCode;\r\n        this.itemId        = itemId;\r\n        this.item          = UncannyAutomator.recipe.items[ itemId ];\r\n\r\n        return this.createItemActions();\r\n    }\r\n\r\n    createItemActions(){\r\n        // Create elements\r\n        let container     = $( '<div/>', { 'class': 'item-actions' }),\r\n            btn           = $( '<div/>', { 'class': 'item-actions__btn' }),\r\n            btnIcon       = $( '<i/>', { 'class': 'uo-icon uo-icon--ellipsis-h-alt' }),\r\n            dropdown      = $( '<div/>', { 'class': 'item-actions__dropdown' }),\r\n            dropdownUl    = $( '<ul/>', { 'class': 'item-actions-dropdown__ul' });\r\n\r\n        btn.append( btnIcon );\r\n        container.append( btn );\r\n\r\n        // Delete\r\n        let deleteAction  = $( '<li/>', { 'class': 'item-actions-dropdown__action' }),\r\n            deleteText    = $( '<span/>' ).text( UncannyAutomator.i18n.delete );\r\n\r\n        deleteAction.append( deleteText );\r\n        dropdownUl.append( deleteAction );\r\n\r\n        // Support\r\n        if ( isDefined( this.itemType ) && isDefined( this.itemCode ) ) {\r\n            if ( ! isDefined( this.item) || isDefined( this.item ) && ! this.item.isMissing ){\r\n                let globalItemData = getGlobalItem( this.integrationID, this.itemType, this.itemCode );\r\n\r\n                if ( isDefined( globalItemData.support_link ) ){\r\n                    let utmContent = `support_menu_link-${ this.integrationID }-${ this.integrationID }_${ this.itemCode }-${ this.integrationID }_${ replaceCurlyBraces( globalItemData.select_option_name, '', '' ).toLowerCase().replace( /\\s+|{|}/g, '_' ) }`;\r\n\r\n                    let supportAction = $( '<a/>', {\r\n                        'href':  addParametersToURL( globalItemData.support_link, {\r\n                            'utm_source':  'uncanny_automator',\r\n                            'utm_medium':  'action_menu',\r\n                            'utm_content': utmContent\r\n                        }),\r\n                        'class': 'item-actions-dropdown__action',\r\n                        'target': '_blank'\r\n                    }),\r\n                        supportText   = $( '<span/>' ).text( UncannyAutomator.i18n.support );\r\n\r\n                    supportAction.append( supportText );\r\n                    dropdownUl.append( supportAction );\r\n                }\r\n            }\r\n        }\r\n\r\n        dropdown.append( dropdownUl );\r\n        container.append( dropdown );\r\n\r\n        // Listen clicks to the open button\r\n        btn.on( 'click', () => {\r\n            // Evaluate if it's open\r\n            const isOpen = container.hasClass( 'item-actions--open' );\r\n\r\n            // Check if it's not open\r\n            if ( ! isOpen ){\r\n                // Open the dropdown\r\n                container.addClass( 'item-actions--open' );\r\n\r\n                // Listen clicks outside the dropdown\r\n                $( document ).on( 'mouseup.uap-actions-click-outside', ( event ) => {\r\n                    if ( ! container.is( event.target ) && container.has( event.target ).length === 0 ){\r\n                        // Close dropdown\r\n                        container.removeClass( 'item-actions--open' );\r\n\r\n                        // Remove event listener to listen clicks outside the dropdown\r\n                        $( document ).off( 'mouseup.uap-actions-click-outside' );\r\n                    }\r\n                });           \r\n            }\r\n            else {\r\n                // Close dropdown\r\n                container.removeClass( 'item-actions--open' );\r\n\r\n                // Remove event listener to listen clicks outside the dropdown\r\n                $( document ).off( 'mouseup.uap-actions-click-outside' );\r\n            }\r\n        });\r\n\r\n        // Delete\r\n        deleteAction.on( 'click', () => {\r\n            if ( isDefined( this.itemId ) && UncannyAutomator.recipe.isLive && UncannyAutomator.recipe.items[ this.itemId ].isLive ){\r\n                // Hide dropdown with options\r\n                container.removeClass( 'item-actions--open' );\r\n\r\n                // Create modal box\r\n                // Read Modal.js comments for more information\r\n                let modal = new Modal({\r\n                    title:       UncannyAutomator.i18n.confirmationModal.title,\r\n                    warning:     replaceCurlyBraces( UncannyAutomator.i18n.confirmationModal.deleteWarning, '<strong>', '</strong>' ),\r\n                    buttons: {\r\n                        cancel:  UncannyAutomator.i18n.cancel,\r\n                        confirm: UncannyAutomator.i18n.confirm,\r\n                    }\r\n                });\r\n\r\n                modal.setEvents({\r\n                    afterSetEvents: () => {\r\n                        modal.show();\r\n                    },\r\n                    onConfirm: () => {\r\n                        let elements        = modal.getElements();\r\n                        let confirmButton   = elements.modal.box.buttons.confirm;\r\n\r\n                        // Add loading class to button\r\n                        confirmButton.addClass( 'uap-btn--loading' ).prop( 'disabled', true );\r\n\r\n                        // Do call and hide\r\n                        restCall( 'delete', {\r\n                            'ID': this.itemId\r\n                        }, () => {\r\n                            // Destroy modal\r\n                            modal.destroy();\r\n\r\n                            // Refresh UI\r\n                            if ( this.itemType == 'trigger' ){\r\n                                new Triggers();\r\n\r\n                                // Check if it's an anonymous recipe\r\n                                if ( UncannyAutomator.recipe.type == 'anonymous' ){\r\n                                    // Render the Actions metabox again\r\n                                    // We're doing this because we need to update the user selector\r\n                                    new Actions();\r\n                                }\r\n                            }\r\n                            \r\n                            if ( this.itemType == 'action' || this.itemType == 'closure' ){\r\n                                new Actions();\r\n                            }\r\n\r\n                            // Check if the recipe is still valid, if it isn't then make the recipe draft\r\n                            if ( ! UncannyAutomator.recipe.isValid ){\r\n                                UncannyAutomator.recipe.publish.statusToggle.setValue( false );\r\n                            }\r\n                        }, () => {\r\n                            // Destroy modal\r\n                            modal.destroy();\r\n\r\n                            console.log( '‼️ ERROR-TODO. Couldn\\'t delete the item' );\r\n\r\n                            // Refresh UI\r\n                            if ( this.itemType == 'trigger' ){\r\n                                new Triggers();\r\n                            }\r\n                            \r\n                            if ( this.itemType == 'action' || this.itemType == 'closure' ){\r\n                                new Actions();\r\n                            }\r\n                        });\r\n                    },\r\n                    afterHide: function(){\r\n                        modal.destroy();\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                // Delete without warning\r\n                if ( isDefined( this.itemId ) ){\r\n                    // Set loading to the \"delete\" option\r\n                    deleteAction.addClass( 'item-actions-dropdown__action--loading' );\r\n\r\n                    // Do the AJAX request to delete it\r\n                    restCall( 'delete', {\r\n                        'ID': this.itemId\r\n                    }, () => {\r\n                        // Reset UI\r\n                        if ( this.itemType == 'trigger' ){\r\n                            new Triggers();\r\n\r\n                            // Check if it's an anonymous recipe\r\n                            if ( UncannyAutomator.recipe.type == 'anonymous' ){\r\n                                // Render the Actions metabox again\r\n                                // We're doing this because we need to update the user selector\r\n                                new Actions();\r\n                            }\r\n                        }\r\n                        \r\n                        if ( this.itemType == 'action' || this.itemType == 'closure' ){\r\n                            new Actions();\r\n                        }\r\n                    }, () => {\r\n                        console.log( '‼️ ERROR-TODO. Couldn\\'t delete the item' );\r\n\r\n                        // Reset UI\r\n                        if ( this.itemType == 'trigger' ){\r\n                            new Triggers();\r\n                        }\r\n                        \r\n                        if ( this.itemType == 'action' || this.itemType == 'closure' ){\r\n                            new Actions();\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    // Reset UI\r\n                    if ( this.itemType == 'trigger' ){\r\n                        new Triggers();\r\n                    }\r\n                    \r\n                    if ( this.itemType == 'action' ){\r\n                        new Actions();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        return container;\r\n    }\r\n}\r\n\r\nexport default ItemHeaderMenu;\r\n","import $ from 'jquery';\r\n\r\nimport {\r\n    restCall,\r\n    getGlobalItem,\r\n    getDOMElements,\r\n    parseStringWithTokens,\r\n    isEmpty,\r\n    isDefined,\r\n    replaceCurlyBraces\r\n} from './Utilities.js';\r\n\r\nimport Modal       from './Modal.js';\r\nimport ItemOptions from './ItemOptions.js';\r\nimport Field       from './Field.js';\r\nimport Triggers    from './Triggers.js';\r\nimport Actions     from './Actions.js';\r\n\r\nimport {\r\n    validateItem\r\n} from './Validation.js';\r\n\r\nimport RecipeNotices from './RecipeNotices.js';\r\n\r\nclass ItemHeaderSentence {\r\n    constructor( itemType, integrationID, itemCode, itemId ){\r\n        this.itemType = itemType;\r\n        this.integrationID = integrationID;\r\n        this.itemCode = itemCode;\r\n        this.itemId   = itemId;\r\n        this.item     = UncannyAutomator.recipe.items[ itemId ];\r\n\r\n        return this.createItemSentence( itemType, itemCode, itemId );\r\n    }\r\n\r\n    /**\r\n     * Create item sentence + status toggle\r\n     * \r\n     * @since 0.5     \r\n     *\r\n     * @return {object}   jQuery DOM object with the item sentence + status toggle\r\n     */\r\n\r\n    createItemSentence( itemType, itemCode, itemId ){\r\n        // Get information about the global item\r\n        let globalItem = getGlobalItem( this.integrationID, itemType, itemCode );\r\n        this.globalItem = globalItem;\r\n\r\n        // Get sentence\r\n        let itemSentence;\r\n\r\n        if ( ! this.item.isMissing ){\r\n            itemSentence = getGlobalItem( this.integrationID, this.item.itemType, this.item.itemCode ).sentence;\r\n        }\r\n        else {\r\n            itemSentence = this.item.sentence;\r\n        }\r\n\r\n        itemSentence = parseStringWithTokens(\r\n            this.item,\r\n            itemSentence,\r\n            UncannyAutomator.recipe.items[ this.itemId ].meta,\r\n            true\r\n        );\r\n\r\n        // Bind elements\r\n        /*\r\n        itemSentence.elements.normal.on( 'click', function(){\r\n            //\r\n        });\r\n        */\r\n\r\n        if ( ! this.item.isMissing ){\r\n            // Listen clicks on tokens\r\n            itemSentence.elements.token.on( 'click', ( event ) => {\r\n                // Get token element\r\n                const $token = $( event.currentTarget );\r\n\r\n                // Remove \"open\" class from al items\r\n                itemSentence.elements.token.removeClass( 'item-title__token--open' );\r\n                // Add \"open\" class to the clicked token\r\n                $token.addClass( 'item-title__token--open' );\r\n\r\n                // Add \"open\" class to the item\r\n                const $item = $token.parents('.item');\r\n                $item.addClass( 'item--open' );\r\n\r\n                // Get options ID\r\n                let optionsID = $token.data( 'options-id' );\r\n\r\n                // Get option group\r\n                let optionGroupDOM = getDOMElements( 'optionGroup', {\r\n                    itemID:  itemId,\r\n                    groupID: optionsID,\r\n                });\r\n\r\n                // Create and show\r\n                new ItemOptions( itemId, optionsID );\r\n            });\r\n        }\r\n            \r\n        // Create DOM elements\r\n        let container = $( '<div/>', { 'class': 'item-title__describe-container' }),\r\n            status    = $( '<div/>', { 'class': 'item-status' });\r\n\r\n        container.append( itemSentence.html.addClass( 'item-title__describe' ) );\r\n\r\n        // Create toggle. We're using Field. Read Field.js comments for more information\r\n        var itemToggle = new Field( 'checkbox', {\r\n            color: 'green',\r\n            align: 'right',\r\n            toggle: {\r\n                on:  UncannyAutomator.i18n.status.liveRecipeItem,\r\n                off: UncannyAutomator.i18n.status.draftRecipeItem,\r\n            },\r\n            currentValue: UncannyAutomator.recipe.items[ itemId ].isLive\r\n        });\r\n\r\n        let itemStatusToggle = itemToggle.getFormElement();\r\n            status.append( itemStatusToggle );\r\n            container.append( status );\r\n\r\n        if ( ! this.item.isMissing ){\r\n            itemStatusToggle.on( 'automator:field:change', function(){\r\n                let makeLive = itemToggle.getValue();\r\n                var isValidItem = true; // True by default, will change to false is it's invalid\r\n\r\n                // Check if the user wants to make it live\r\n                if ( makeLive ){\r\n                    // Validate\r\n                    let validation = validateItem( itemId );\r\n                    isValidItem = validation.isValid; \r\n                }\r\n\r\n                // Do AJAX\r\n                // Show loading animation\r\n                itemToggle.startLoadingAnimation();\r\n\r\n                if ( isValidItem ){\r\n                    // Set post status\r\n                    let post_status = makeLive ? 'publish' : 'draft';\r\n\r\n                    // Check if they want to make an item draft in a live recipe\r\n                    if ( ! makeLive && UncannyAutomator.recipe.isLive ){\r\n                        // Create modal box\r\n                        // Read Modal.js comments for more information\r\n                        let modal = new Modal({\r\n                            title:       UncannyAutomator.i18n.confirmationModal.title,\r\n                            warning:     replaceCurlyBraces( UncannyAutomator.i18n.confirmationModal.statusWarning, '<strong>', '</strong>' ),\r\n                            buttons: {\r\n                                cancel:  UncannyAutomator.i18n.cancel,\r\n                                confirm: UncannyAutomator.i18n.confirm,\r\n                            }\r\n                        });\r\n\r\n                        modal.setEvents({\r\n                            afterSetEvents: function(){\r\n                                modal.show();\r\n                            },\r\n                            onConfirm: function(){\r\n                                let elements        = modal.getElements();\r\n                                let confirmButton   = elements.modal.box.buttons.confirm;\r\n\r\n                                // Add loading class to button\r\n                                confirmButton.addClass( 'uap-btn--loading' ).prop( 'disabled', true );\r\n\r\n                                // Start loading animation on toggle\r\n                                itemToggle.startLoadingAnimation();\r\n\r\n                                // Get the item sentence HTML\r\n                                let itemSentenceHTML;\r\n                                try {\r\n                                    itemSentenceHTML = itemSentence.html.get(0).outerHTML;\r\n                                } catch ( e ){}\r\n\r\n                                restCall( 'change_post_status', {\r\n                                    post_ID:      itemId,\r\n                                    post_status:  post_status,\r\n                                    sentence_human_readable: itemSentence.brackets,\r\n                                    sentence_human_readable_html: itemSentenceHTML\r\n                                }, function(){\r\n                                    // On success\r\n                                    // Destroy modal\r\n                                    modal.destroy();\r\n\r\n                                    // Refresh UI\r\n                                    new Triggers();\r\n                                    new Actions();\r\n\r\n                                    // Show error\r\n                                    new RecipeNotices();\r\n\r\n                                    // Check if the recipe is still valid, if it isn't then make the recipe draft\r\n                                    if ( ! UncannyAutomator.recipe.isValid ){\r\n                                        UncannyAutomator.recipe.publish.statusToggle.setValue( false );\r\n                                    }\r\n                                }, function(){\r\n                                    // On fail\r\n                                    console.log( '‼️ ERROR-TODO. Couldn\\'t set the item status' );\r\n\r\n                                    // Destroy modal\r\n                                    modal.destroy();\r\n\r\n                                    // Remove loading animation, data didn't change\r\n                                    itemToggle.stopLoadingAnimation();\r\n\r\n                                    // Revert user change\r\n                                    itemToggle.setValue( ! makeLive, false );\r\n                                });\r\n                            },\r\n                            onCancel: function(){\r\n                                // Destroy modal\r\n                                modal.destroy();\r\n\r\n                                // Revert user change\r\n                                itemToggle.setValue( ! makeLive, false );\r\n\r\n                                // Stop loading animation in the toggle\r\n                                itemToggle.stopLoadingAnimation();\r\n                            },\r\n                            afterHide: function(){\r\n                                modal.destroy();\r\n                            }\r\n                        });\r\n                    }\r\n                    else {\r\n                        // Get the item sentence HTML\r\n                        let itemSentenceHTML;\r\n                        try {\r\n                            itemSentenceHTML = itemSentence.html.get(0).outerHTML;\r\n                        } catch ( e ){}\r\n                                \r\n                        // Is valid, make live\r\n                        restCall( 'change_post_status', {\r\n                            post_ID:      itemId,\r\n                            post_status:  post_status,\r\n                            sentence_human_readable: itemSentence.brackets,\r\n                            sentence_human_readable_html: itemSentenceHTML\r\n                        }, function(){\r\n                            // On sucess\r\n                            // Update object\r\n\r\n                            // Refresh UI\r\n                            // Debugging! don't re-render the UI\r\n                            // new Triggers();\r\n                            // new Actions();\r\n\r\n                            // Remove loading animation, data didn't change\r\n                            itemToggle.stopLoadingAnimation();\r\n\r\n                            // Show error\r\n                            new RecipeNotices();\r\n                        }, function(){\r\n                            // On fail\r\n                            console.log( '‼️ ERROR-TODO. Couldn\\'t set the item status' );\r\n\r\n                            // Remove loading animation, data didn't change\r\n                            itemToggle.stopLoadingAnimation();\r\n\r\n                            // Revert user change\r\n                            itemToggle.setValue( ! makeLive, false );\r\n                        });\r\n                    }\r\n                }\r\n                else {\r\n                    // JS won't take more than some milliseconds to do this, so we're going to wait one second just for the user to understand what's happening\r\n                    setTimeout(function(){\r\n                        // Remove loading animation\r\n                        itemToggle.stopLoadingAnimation();\r\n\r\n                        // Revert user change\r\n                        itemToggle.setValue( false, false );\r\n                    }, 1000 );\r\n                }\r\n            });\r\n        }\r\n\r\n        return container;\r\n    }\r\n}\r\n\r\nexport default ItemHeaderSentence;","import $ from 'jquery';\r\n\r\nimport {\r\n    isDefined\r\n} from './Utilities.js';\r\n\r\nclass ItemHeaderTag {\r\n    constructor( integrationId, integrationName = null ){\r\n        this.integrationId = integrationId;\r\n        this.integrationName = integrationName;\r\n\r\n        return this.createItemTag();\r\n    }\r\n\r\n    /**\r\n     * Create item tag with the name of the integration\r\n     *\r\n     * @since 0.5\r\n     * \r\n     * @param {string}    integrationCode - The integration code\r\n     *\r\n     * @return {object}   HTML with the item tag\r\n     */\r\n\r\n    createItemTag(){\r\n        // Get integration by integrationId\r\n        let integration = UncannyAutomator.integrations[ this.integrationId ];\r\n\r\n        // Create tag element and set the integraiton name\r\n        let container   = $( '<div/>', { 'class': 'item-title__integration uap-clear' }),\r\n            tag         = $( '<div/>', { 'class': 'item-title__tag' });\r\n\r\n        if ( isDefined( integration ) ){\r\n            tag.text( integration.name );\r\n        }\r\n        else {\r\n            tag.text( this.integrationName );\r\n        }\r\n\r\n        container.append( tag );\r\n\r\n        // Return tag\r\n        return container;\r\n    }\r\n}\r\n\r\nexport default ItemHeaderTag;","import $ from 'jquery';\r\n\r\nimport {\r\n\tgetDOMElements,\r\n    restCall,\r\n    AJAXRequest,\r\n    isDefined,\r\n    isEmpty,\r\n    parseStringWithTokens,\r\n    vsprintf,\r\n    getCurrentFieldsValues\r\n} from './Utilities.js';\r\n\r\nimport {\r\n    validateItemFields,\r\n} from './Validation';\r\n\r\nimport Triggers from './Triggers.js';\r\nimport Actions  from './Actions.js';\r\n\r\nimport Modal    from './Modal.js';\r\nimport Markdown from './Markdown.js';\r\n\r\nclass ItemOptions {\r\n\tconstructor( itemId, optionId ){\r\n\t\tthis.itemId   = itemId;\r\n\t\tthis.optionId = optionId;\r\n\t\tthis.item \t  = UncannyAutomator.recipe.items[ itemId ];\r\n\r\n\t\t// Array to save the Field objects\r\n\t\tthis.fields   = this.item.options[ this.optionId ].fields;\r\n\t\t// Array to save the buttons\r\n\t\tthis.buttons  = this.item.options[ this.optionId ].buttons;\r\n\r\n\t\tthis.create();\r\n\r\n\t\t// AFTER we added the elements to the DOM let's call init \r\n\t\t// TokenSelector, TinyMCE and CodeMirror. We're going to call this in\r\n\t\t// ItemOptions.js because the TokenSelector, TinyMCE and \r\n\t\t// CodeMirror need the item in the DOM before changing it\r\n\t\t// Select2 and the URL checker are called in Field.js\r\n\t\tthis.initTokenSelector();\r\n\t\tthis.initTinyMCE();\r\n\t\tthis.initCodeMirror();\r\n\t}\r\n\r\n\tcreate(){\r\n\t\t// Container\r\n\t\tlet container = getDOMElements( 'item', {\r\n\t\t\tid: this.itemId\r\n\t\t}).contentContainer;\r\n\r\n\t\tlet itemOptions\t= $( '<div/>', { 'class': 'item-options' });\r\n\r\n\t\t// Buttons. We have to create these before the fields, but append after\r\n\t\tlet buttons = this.createButtons();\r\n\r\n\t\t// Fields\r\n\t\tlet fields = this.createFields();\r\n\t\tthis.fieldsContainer = fields;\r\n\t\titemOptions.append( fields );\r\n\r\n\t\t// Create notices container\r\n\t\tlet noticeContainer  = $( '<div/>', { 'class': 'item-options__notices' });\r\n\t\tthis.noticeContainer = noticeContainer;\r\n\t\titemOptions.append( noticeContainer );\r\n\r\n\t\t// Append buttons\r\n\t\titemOptions.append( buttons );\r\n\r\n\t\t// Append to the item\r\n\t\tcontainer.html( itemOptions );\r\n\t}\r\n\r\n\tcreateFields(){\r\n\t\tlet container = $( '<div/>', { 'class': 'item-options__group' });\r\n\r\n\t\t// Create fields\r\n\t\t$.each( this.fields, ( index, field ) => {\r\n\t\t\t// Get field type\r\n\t\t\tlet fieldType = field.getAttributes().fieldType;\r\n\r\n\t\t\t// Check if it's a repeater\r\n\t\t\tif ( fieldType == 'repeater' ){\r\n\t\t\t\t// Create the fields again first (to avoid showing unsaved changed)\r\n\t\t\t\tfield.createFields();\r\n\t\t\t}\r\n\r\n\t\t\t// Append the form element to the DOM\r\n\t\t\tfield.createFormElement();\r\n\t\t\tcontainer.append( field.getFormElement() );\r\n\r\n\t\t\t// Bind submit on Enter (for all except groups and textareas)\r\n\t\t\tif ( ! [ 'textarea', 'group', 'repeater' ].includes( fieldType ) ){\r\n\t\t\t\t// Get field element and bind 'keyup'\r\n\t\t\t\tfield.getField().on( 'keyup', ( event ) => {\r\n\t\t\t\t\t// Check if it's an enter\r\n\t\t\t\t\tif ( event.keyCode == 13 ){\r\n\t\t\t\t\t\t// Trigger a click on the Save Button\r\n\t\t\t\t\t\tthis.saveButton.trigger( 'click' );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t// Check if it's a group\r\n\t\t\telse if ( fieldType == 'group' ){\r\n\t\t\t\t// Iterate fields\r\n\t\t\t\tfield.fields.forEach(( field ) => {\r\n\t\t\t\t\t// Get the field type\r\n\t\t\t\t\tconst fieldType = field.getAttributes().fieldType;\r\n\r\n\t\t\t\t\t// Check if it's not a textarea\r\n\t\t\t\t\tif ( fieldType !== 'textarea' ){\r\n\t\t\t\t\t\t// Get field element and bind 'keyup'\r\n\t\t\t\t\t\tfield.getField().on( 'keyup', ( event ) => {\r\n\t\t\t\t\t\t\t// Check if it's an enter\r\n\t\t\t\t\t\t\tif ( event.keyCode == 13 ){\r\n\t\t\t\t\t\t\t\t// Trigger a click on the Save Button\r\n\t\t\t\t\t\t\t\tthis.saveButton.trigger( 'click' );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse if ( fieldType == 'repeater' ){\r\n\t\t\t\t// Iterate rows\r\n\t\t\t\tfield.fieldRows.forEach(( row, index ) => {\r\n\t\t\t\t\t// Iterate each row\r\n\t\t\t\t\trow.forEach(( Field, index ) => {\r\n\t\t\t\t\t\t// Get field element and bind 'keyup'\r\n\t\t\t\t\t\tField.getField().on( 'keyup', ( event ) => {\r\n\t\t\t\t\t\t\t// Check if it's an enter\r\n\t\t\t\t\t\t\tif ( event.keyCode == 13 ){\r\n\t\t\t\t\t\t\t\t// Trigger a click on the Save Button\r\n\t\t\t\t\t\t\t\tthis.saveButton.trigger( 'click' );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t}\r\n\r\n\tcreateButtons(){\r\n\t\t// Buttons\r\n\t\tlet container \t  \t = $( '<div/>', { 'class': 'item-options__buttons' });\r\n\r\n\t\t// Actions buttons\r\n\t\tlet automatorButtons = $( '<div/>', { 'class': 'item-options__automator-buttons' }),\r\n\t\t\tdeveloperButtons = $( '<div/>', { 'class': 'item-options__developer-buttons' });\r\n\r\n\t\tlet saveButton \t  \t = $( '<div/>', { 'class': 'uap-btn uap-btn--primary' }),\r\n\t\t\tcancelButton  \t = $( '<div/>', { 'class': 'uap-btn uap-btn--secondary' }).text( UncannyAutomator.i18n.cancel );\r\n\r\n\t\tif ( this.item.itemType == 'trigger' ){\r\n\t\t\tsaveButton.text( UncannyAutomator.i18n.save );\r\n\t\t}\r\n\r\n\t\tif ( this.item.itemType == 'action' ){\r\n\t\t\tsaveButton.text( UncannyAutomator.i18n.save );\r\n\t\t}\r\n\r\n        if ( this.item.itemType == 'closure' ){\r\n            saveButton.text( UncannyAutomator.i18n.save );\r\n        }\r\n\r\n        this.saveButton = saveButton;\r\n\r\n\t\tautomatorButtons.append( saveButton );\r\n\t\tautomatorButtons.append( cancelButton );\r\n\r\n\t\t// Check developer defined buttons\r\n\t\t$.each( this.buttons, ( index, button ) => {\r\n\t\t\t// Create button\r\n\t\t\tconst $buttonElement = $( '<div/>', { 'class': 'uap-btn' }).text( button.text );\r\n\r\n\t\t\t// Check if we have to add a custom class to the button\r\n\t\t\tif ( isDefined( button.css_classes ) ){\r\n\t\t\t\t// Add classes\r\n\t\t\t\t$buttonElement.addClass( button.css_classes );\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it has a defined onClick function\r\n\t\t\tlet doOnClick = () => {};\r\n\t\t\tif ( isDefined( button.on_click ) ){\r\n\t\t\t\t// Try to overwrite empty function\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// Try to convert the string to function, but first remove the <script> tags and trim the string\r\n\t\t\t\t\tdoOnClick = eval( `(${ button.on_click.replace( '<script>', '' ).replace( '</script>', '' ).trim() })` ); \r\n\t\t\t\t} catch ( e ){ console.log( e ); console.log( button.on_click ); }\r\n\t\t\t}\r\n\r\n\t\t\t// Listen clicks on the button\r\n\t\t\t$buttonElement.on( 'click', () => {\r\n\t\t\t\t// Invoke callback\r\n\t\t\t\tdoOnClick(\r\n\t\t\t\t\t// button\r\n\t\t\t\t\t$buttonElement,\r\n\t\t\t\t\t// data\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titem:      this.item,\r\n\t\t\t\t\t\tvalues:    getCurrentFieldsValues( this.itemId ),\r\n\t\t\t\t\t},\r\n\t\t\t\t\t// modules\r\n\t\t\t\t\t(function(){\r\n\t\t\t\t\t\t// Get required modules\r\n\t\t\t\t\t\tlet modules = {};\r\n\r\n\t\t\t\t\t\t// Check if the developer wants custom modules\r\n\t\t\t\t\t\tif ( isDefined( button.modules ) ){\r\n\t\t\t\t\t\t\t// Check if we have to add the modal module\r\n\t\t\t\t\t\t\tif ( button.modules.includes( 'modal' ) ){\r\n\t\t\t\t\t\t\t\t// Include modal\r\n\t\t\t\t\t\t\t\tmodules.Modal = Modal;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif ( button.modules.includes( 'markdown' ) ){\r\n\t\t\t\t\t\t\t\t// Include Markdown\r\n\t\t\t\t\t\t\t\tmodules.Markdown = Markdown;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Return modules\r\n\t\t\t\t\t\treturn modules;\r\n\t\t\t\t\t})()\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\t// Add button to the container\r\n\t\t\tdeveloperButtons.append( $buttonElement );\r\n\t\t});\r\n\r\n\t\tcontainer.append( automatorButtons );\r\n\t\tcontainer.append( developerButtons );\r\n\r\n\t\tsaveButton.on( 'click', () => {\r\n\t\t\t// Verify form\r\n            let formValidation = validateItemFields( this.fieldsContainer );\r\n\r\n            // Check if it's valid\r\n            if ( formValidation.isValid ){\r\n            \t// Disable button and show loading animation\r\n            \tsaveButton.addClass( 'uap-btn--loading uap-btn--disabled' );\r\n\r\n            \t// The REST call wants:\r\n            \t// - The item ID\r\n            \t// - The option code (the one from the token, the main one)\r\n            \t// - The value. If there is more than one then a serialized object\r\n            \tlet itemId \t\t= this.itemId,\r\n            \t\toptionCode \t= this.optionId,\r\n            \t\toptionValue = this.getOptionValue();\r\n\r\n            \t// Get a temporary item sentence\r\n            \t// This must use values that are not yet saved in the meta of the item\r\n            \tconst itemSentence = parseStringWithTokens( this.item, this.item.meta.sentence, $.extend({}, this.item.meta, getCurrentFieldsValues( this.itemId ) ) );\r\n\r\n            \t// Get the item sentence HTML\r\n            \tlet itemSentenceHTML;\r\n            \ttry {\r\n            \t\titemSentenceHTML = itemSentence.html.get(0).outerHTML;\r\n            \t} catch ( e ){}\r\n\r\n            \trestCall( 'update', {\r\n                    itemId:       itemId,\r\n                    optionCode:   optionCode,\r\n                    optionValue:  optionValue,\r\n                    sentence_human_readable: itemSentence.brackets,\r\n                    sentence_human_readable_html: itemSentenceHTML\r\n                }, ( response ) => {\r\n                \t// Trigger \"saved\" on all item fields\r\n                \tthis.fields.forEach(( Field ) => {\r\n                \t\tField.getFormElement().trigger( 'saved' );\r\n                \t});\r\n\r\n           \t        if ( this.item.itemType == 'trigger' ){\r\n                        new Triggers();\r\n                    }\r\n\r\n                    if ( this.item.itemType == 'action' || this.item.itemType == 'closure' ){\r\n                        new Actions();\r\n                    }\r\n\r\n                    // Determine if the item is already valid\r\n\t\t\t\t\t// This will be true only if the new item doesn't have\r\n\t\t\t\t\t// options, or all the options have a default value\r\n\t\t\t\t\tconst isValid = UncannyAutomator.recipe.items[ this.item.id ].isValid;\r\n\r\n                    // Get item form element\r\n                \tconst $item = getDOMElements( 'item', {\r\n                \t\tid: this.item.id\r\n                \t});\r\n\r\n                \t// Check if it's valid\r\n\t\t\t\t\tif ( isValid ){\r\n\t\t\t\t\t\t// Check if the recipe is NOT live\r\n\t\t\t\t\t\tif ( ! UncannyAutomator.recipe.isLive ){\r\n\t\t\t\t\t\t\t// Check if the ITEM isn't already live\r\n\t\t\t\t\t\t\t// Otherwise, we don't have to trigger it again\r\n\t\t\t\t\t\t\tif ( ! this.item.isLive ){\r\n\t\t\t\t\t\t\t\t// Set the item to live\r\n\t\t\t\t\t\t\t\t$item.item\r\n\t\t\t\t\t\t\t\t\t.find( '.item-status input[type=\"checkbox\"]' )\r\n\t\t\t\t\t\t\t\t\t.prop( 'checked', true )\r\n\t\t\t\t\t\t\t\t\t.trigger( 'change' );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Get first token and trigger a click\r\n\t\t\t\t\t\t// This will open the first group of options\r\n\t\t\t\t\t\t$item.item\r\n\t\t\t\t\t\t\t.find( '.item-title__token:not(.item-title__token--filled)' )\r\n\t\t\t\t\t\t\t.first()\r\n\t\t\t\t\t\t\t.trigger( 'click' );\r\n\t\t\t\t\t}\r\n                }, ( response ) => {\r\n                \tconsole.log( '‼️ ERROR-TODO. Couldn\\'t save the options of the item' );\r\n\r\n                \t// Reset UI\r\n\t\t\t\t\tif ( this.item.itemType == 'trigger' ){\r\n\t\t\t\t\t\tnew Triggers();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( this.item.itemType == 'action' || this.item.itemType == 'closure' ){\r\n\t\t\t\t\t\tnew Actions();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Try to open the options again\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// Get the item elements\r\n\t\t\t\t\t\tgetDOMElements( 'item', {\r\n\t\t\t\t\t\t\tid: this.itemId\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t// Get the main container\r\n\t\t\t\t\t\t.item\r\n\t\t\t\t\t\t// Find the token in the sentence\r\n\t\t\t\t\t\t.find( `.item-title__token[data-options-id=\"${ optionCode }\"]` )\r\n\t\t\t\t\t\t// Trigger a click\r\n\t\t\t\t\t\t.trigger( 'click' ); \r\n\t\t\t\t\t} catch ( e ){}\r\n                });\r\n            }\r\n\t\t});\r\n\r\n\t\tcancelButton.on( 'click', () => {\r\n\t\t\t// Reset UI\r\n\t\t\tif ( this.item.itemType == 'trigger' ){\r\n\t\t\t\tnew Triggers();\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.item.itemType == 'action' || this.item.itemType == 'closure' ){\r\n\t\t\t\tnew Actions();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t}\r\n\r\n\tinitTokenSelector(){\r\n\t\t$.each( this.fields, ( index, field ) => {\r\n\t\t\t// Get the field type\r\n\t\t\tfield.initTokenSelector();\t\t\r\n\t\t});\r\n\t}\r\n\r\n\tinitTinyMCE(){\r\n\t\t$.each( this.fields, ( index, field ) => {\r\n\t\t\t// Get the field type\r\n\t\t\tif ( field.getAttributes().fieldType == 'textarea' ){\r\n\t\t\t\t// TinyMCE will be initialized only if it's a textarea and supportsTinyMCE is true\r\n\t\t\t\tfield.initTinyMCE();\r\n\t\t\t}\t\t\t\r\n\t\t});\r\n\t}\r\n\r\n\tinitCodeMirror(){\r\n\t\t$.each( this.fields, ( index, field ) => {\r\n\t\t\t// Get the field type\r\n\t\t\tfield.initCodeMirror();\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Get the value that we have to send to the REST call\r\n\t *\r\n\t * @since 0.5\r\n\t */\r\n\r\n\tgetOptionValue(){\r\n\t\tlet response = {},\r\n\t\t\thasSelect = false,\r\n\t\t\thasRepeater = false;\r\n\r\n\t\t$.each( this.fields, ( index, field ) => {\r\n\t\t\tlet id \t  = field.getAttributes().optionCode,\r\n\t\t\t\tvalue = field.getValue();\r\n\r\n\t\t\tif ( [ 'select', 'radio' ].includes( field.getAttributes().fieldType ) ){\r\n\t\t\t\t// Has select\r\n\t\t\t\thasSelect = true;\r\n\r\n\t\t\t\t// Check if it's a multiselect\r\n\t\t\t\t// Then save the value as a JSON string, don't save it\r\n\t\t\t\t// as an array\r\n\t\t\t\tif ( field.getAttributes().supportsMultipleValues ){\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tvalue = JSON.stringify( value );\r\n\t\t\t\t\t} catch ( e ){\r\n\t\t\t\t\t\tconsole.log( e );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Save readable value\r\n\t\t\t\tresponse[ vsprintf( '%s_readable', [ id ] ) ] = field.getReadableValue();\r\n\r\n\t\t\t\t// Check if we have to save the custom value (only for selects)\r\n\t\t\t\tconst customValue = field.getSelectCustomValue();\r\n\t\t\t\tif ( value == 'automator_custom_value' ){\r\n\t\t\t\t\tresponse[ vsprintf( '%s_custom', [ id ] ) ] = customValue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if ( field.getAttributes().fieldType == 'repeater' ){\r\n\t\t\t\t// Has repeater\r\n\t\t\t\thasRepeater = true;\r\n\t\t\t\t\r\n\t\t\t\t// Convert data to a JSON string\r\n\t\t\t\tvalue = JSON.stringify( value );\r\n\t\t\t}\r\n\r\n\t\t\tresponse[ id ] = value;\r\n\t\t});\r\n\r\n\t\tif ( ! hasRepeater && ! hasSelect && Object.keys( response ).length == 1 ){\r\n\t\t\t// One field\r\n\t\t\tresponse = response[ Object.keys( response )[ 0 ] ];\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n}\r\n\r\nexport default ItemOptions;","import $ from 'jquery';\r\n\r\nimport {\r\n\tisDefined,\r\n\tescapeHTML\r\n} from './Utilities.js';\r\n\r\nclass Markdown {\r\n\tconstructor( content = '' ){\r\n\t\t// Save content\r\n\t\tthis.content = content;\r\n\t}\r\n\r\n\tgetHTML(){\r\n\t\t// Define content and escape HTML\r\n\t\tlet content = escapeHTML( this.content );\r\n\t\t\r\n\t\tcontent = this.parseItalicsAndBold( content );\r\n\t\tcontent = this.parseAnchors( content );\r\n\r\n\t\treturn content;\r\n\t}\r\n\r\n\tparseItalicsAndBold( content ){\r\n\t\t// Underscores\r\n\t\t// Since we are consuming a \\s character, we need to add it\r\n\t\tcontent = content.replace( /(^|\\s|>|\\b)__(?=\\S)([^]+?)__(?=\\b|<|\\s|$)/gm, '$1<strong>$2</strong>' );\r\n\t\tcontent = content.replace( /(^|\\s|>|\\b)_(?=\\S)([^]+?)_(?=\\b|<|\\s|$)/gm, '$1<em>$2</em>' );\r\n\r\n\t\t// Asterisks\r\n\t\tcontent = content.replace( /(\\*\\*)(?=\\S)([^\\r]*?\\S[*]*)\\1/g, '<strong>$2</strong>' );\r\n\t\tcontent = content.replace( /(\\*)(?=\\S)([^\\r]*?\\S)\\1/g, '<em>$2</em>' );\r\n\r\n\t\t// Return content\r\n\t\treturn content;\r\n\t}\r\n\r\n\tparseAnchors( content ){\r\n\t\t// Inline-style links: [link text](url \"optional title\")\r\n\t\tcontent = content.replace( /(\\[((?:\\[[^\\]]*]|[^\\[\\]])*)]\\([ \\t]*()<?(.*?(?:\\(.*?\\).*?)?)>?[ \\t]*((['\"])(.*?)\\6[ \\t]*)?\\))/g, function( wholeMatch, m1, m2, m3, m4, m5, m6, m7 ){\r\n\t\t\tif ( ! isDefined( m7 ) ){\r\n\t\t\t\tm7 = '';\r\n\t\t\t}\r\n\r\n\t\t\twholeMatch = m1;\r\n\t\t\t\r\n\t\t\tvar linkText = m2,\r\n\t\t\t\tlinkId \t = m3.toLowerCase(),\r\n\t\t\t\turl \t = m4,\r\n\t\t\t\ttitle \t = m7;\r\n\r\n\t\t\tif ( ! url ){\r\n\t\t\t\tif ( ! linkId ){\r\n\t\t\t\t\t// Lower-case and turn embedded newlines into spaces\r\n\t\t\t\t\tlinkId = linkText.toLowerCase().replace( / ?\\n/g, ' ' );\r\n\t\t\t\t}\r\n\r\n\t\t\t\turl = '#' + linkId;\r\n\r\n\t\t\t\tif ( wholeMatch.search( /\\(\\s*\\)$/m ) > -1 ){\r\n\t\t\t\t\t// Special case for explicit empty url\r\n\t\t\t\t\turl = '';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn wholeMatch;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\turl = encodeURI( url, '*_', false );\r\n\t\t\tvar result = '<a href=\"' + url + '\" target=\"_blank\"';\r\n\r\n\t\t\tif ( title !== '' && title !== null ){\r\n\t\t\t\ttitle = title.replace( /\"/g, '&quot;' );\r\n\t\t\t\ttitle = encodeURI( title, '*_', false );\r\n\t\t\t\tresult += ' title=\"' + title + '\"';\r\n\t\t\t}\r\n\r\n\t\t\tresult += '>' + linkText + '</a>';\r\n\r\n\t\t\treturn result;\r\n\t\t});\r\n\r\n\t\t// Return content\r\n\t\treturn content;\r\n\t}\r\n}\r\n\r\nexport default Markdown;","import $ from 'jquery';\r\n\r\nimport {\r\n    itemsObject,\r\n    getDOMElements,\r\n    isEmpty,\r\n    isDefined,\r\n    vsprintf,\r\n    addParametersToURL\r\n} from './Utilities.js';\r\nimport ItemCreatorIntegrations from './ItemCreatorIntegrations.js';\r\nimport Triggers from './Triggers';\r\nimport Actions from './Actions';\r\nimport MetaboxItems from './MetaboxItems';\r\n\r\nclass MetaboxFooter {\r\n\r\n    constructor( itemType ){\r\n        this.itemType = itemType;\r\n\r\n        if ( this.shouldCreateMetaboxFooter() ){\r\n            this.createFooter();\r\n        }\r\n    }\r\n\r\n    shouldCreateMetaboxFooter(){\r\n        // Check if we should create the metabox\r\n        // For the triggers we're going to create it always,\r\n        // but for the actions we're going to create only if there is at least one action\r\n\r\n        let create = false;\r\n\r\n        if ( this.itemType == 'trigger' ){\r\n            // Get triggers\r\n            let recipeActions = itemsObject( 'get', {\r\n                filter: {\r\n                    itemType: 'trigger'\r\n                }\r\n            });\r\n\r\n            // Check if has triggers\r\n            let hasTriggers = ! isEmpty( recipeActions );\r\n\r\n            // Create metabox if hasTriggers\r\n            if ( ( hasTriggers || ( ! isDefined( UncannyAutomator.wp ) || ! UncannyAutomator.wp ) ) || UncannyAutomator.recipe.type == 'anonymous' ){\r\n                create = true;\r\n            }\r\n        }\r\n\r\n        if ( this.itemType == 'action' ){\r\n            // Get actions\r\n            let recipeActions = itemsObject( 'get', {\r\n                filter: {\r\n                    itemType: 'action'\r\n                }\r\n            });\r\n\r\n            // Check if has actions\r\n            let hasActions = ! isEmpty( recipeActions );\r\n\r\n            // Create metabox if hasActions\r\n            if ( hasActions ){\r\n                create = true;\r\n            }\r\n        }\r\n\r\n        return create;\r\n    }\r\n\r\n    createFooter(){\r\n        // Create error container\r\n        let container  = $( '<div/>', { 'class': 'metabox__footer' });\r\n\r\n        // \"Add another\" button\r\n        let addAnother = $( '<div/>', { 'class': 'uap-btn uap-btn--secondary' });\r\n\r\n        // Add button, but don't add it in the triggers metabox for anonymous recipes\r\n        if ( this.itemType == 'action' || ( this.itemType == 'trigger' && UncannyAutomator.recipe.type == 'user' ) ){\r\n            // Append \"Add another\" button\r\n            container.append( addAnother );\r\n        }\r\n\r\n        if ( this.itemType == 'trigger' ){\r\n            // Do only for \"user\" recipes\r\n            if ( UncannyAutomator.recipe.type == 'user' ){\r\n                // Set text to the \"Add Another\" button\r\n                addAnother.text( UncannyAutomator.i18n.trigger.addAnother );\r\n            }\r\n\r\n            // Do only for \"anonymous\" recipes\r\n            if ( UncannyAutomator.recipe.type == 'anonymous' ){\r\n                // Create and append anonymous notice\r\n                let $anonymousNotice = this.createAnonymousNotice();\r\n                container.append( $anonymousNotice );\r\n            }\r\n        }\r\n\r\n        if ( this.itemType == 'action' ){\r\n            // Set text to the \"Add Another\" button\r\n            addAnother.text( UncannyAutomator.i18n.action.addAnother );\r\n        }\r\n\r\n        // Bind button\r\n        if ( ( this.itemType == 'trigger' ) || this.itemType == 'action' ){\r\n            // Listen clicks to the \"Add another\" button\r\n            addAnother.on( 'click', () => {\r\n                // Multiple triggers are only allowed in the pro version\r\n                // So we're only doing this for actions\r\n                new ItemCreatorIntegrations( this.itemType );\r\n            });\r\n        }\r\n\r\n        // Append to the metabox\r\n        let metabox = getDOMElements( 'metabox', {\r\n            type: this.itemType\r\n        })\r\n\r\n        metabox.append( container );\r\n    }\r\n\r\n    createAnonymousNotice(){\r\n        let $notice = $( `\r\n            <div class=\"description\">\r\n                ${ UncannyAutomator.i18n.recipeType.anonymousOnlyOneTrigger } <a href=\"${ addParametersToURL( 'https://automatorplugin.com/knowledge-base/managing-triggers/', {\r\n                        'utm_source':  'uncanny_automator',\r\n                        'utm_medium':  'anonymous_recipe_one_trigger',\r\n                        'utm_content': 'learn_more'\r\n                    }) }\" target=\"_blank\">${ UncannyAutomator.i18n.learnMore } <span class=\"uo-icon uo-icon--external-link-alt\"></span></a>\r\n            </div>\r\n        ` );\r\n\r\n        return $notice;\r\n    }\r\n}\r\n\r\nexport default MetaboxFooter;","import $ from 'jquery';\r\n\r\nimport {\r\n    getDOMElements,\r\n    isEmpty,\r\n    isDefined\r\n} from './Utilities.js';\r\n\r\nimport ItemHeaderMenu     from './ItemHeaderMenu.js';\r\nimport ItemHeaderIcon     from './ItemHeaderIcon.js';\r\nimport ItemHeaderTag      from './ItemHeaderTag.js';\r\nimport ItemHeaderAsync from './ItemHeaderAsync.js';\r\nimport ItemHeaderSentence from './ItemHeaderSentence.js';\r\n\r\nclass MetaboxItems {\r\n    constructor( itemType, items ){\r\n        $.each( items, ( itemId, item ) => {\r\n            if ( itemType == item.itemType ){\r\n                // Create item\r\n                let item = this.createItem( itemId );\r\n\r\n                // Append to the metabox\r\n                let metabox = getDOMElements( 'metabox', {\r\n                    type: itemType\r\n                });\r\n\r\n                metabox.append( item );\r\n            }\r\n        });\r\n    }\r\n\r\n    createItem( itemId ){\r\n        // Get item data\r\n        let item = UncannyAutomator.recipe.items[ itemId ];\r\n\r\n        // Create container\r\n        let container = $( '<div/>', {\r\n            'class':   'item',\r\n            'data-id': itemId\r\n        });\r\n\r\n        if ( item.isMissing ){\r\n            container.addClass( 'item--missing' );\r\n        }\r\n\r\n        if ( item.meta.async_mode ){\r\n            container.addClass( 'item--async' );\r\n        }\r\n\r\n        // Replace tokens in the CSS\r\n        if ( ! isEmpty( item.inlineCss ) ){\r\n            item.inlineCss = item.inlineCss.replace( /{{item_id}}/g, itemId );\r\n\r\n            // Add inline inlineCss\r\n            container.prepend( item.inlineCss );\r\n        }\r\n\r\n        // Create header\r\n        let header = this.createHeader(\r\n            item.integrationCode,\r\n            item.itemType,\r\n            item.itemCode,\r\n            itemId,\r\n        );\r\n\r\n        let notice = this.createNotice( item );\r\n\r\n        container.append( header );\r\n        container.append( notice );\r\n\r\n        // Debug\r\n        // console.groupCollapsed( vsprintf( 'ID: %s', [ itemId ] ) );\r\n        // console.log( item );\r\n        // console.groupEnd();\r\n\r\n        return container;\r\n    }\r\n\r\n    /**\r\n     * Creates item header\r\n     * \r\n     * @since 0.5\r\n     *\r\n     * @param {string}    integrationCode - The integration code\r\n     * @param {string}    itemType - The item type: 'trigger', 'action' or 'closure'\r\n     * @param {string}    itemCode - The code of the item\r\n     * @param {int}       itemId - The ID of the item\r\n     */\r\n\r\n    createHeader( integrationCode, itemType, itemCode, itemId ){\r\n        let container = $( '<div/>' ),\r\n            title     = $( '<div/>', { 'class': 'item-title uap-clear' });\r\n\r\n        // Get item data\r\n        let item = UncannyAutomator.recipe.items[ itemId ];\r\n\r\n        // If the item is missing remove the integrationCode\r\n        // We don't want to show the integration icon\r\n        if ( item.isMissing ){\r\n            integrationCode = null;\r\n        }\r\n\r\n        if ( itemType == 'action' && isDefined( UncannyAutomator.wp ) && UncannyAutomator.wp ) {\r\n            let schedule = new ItemHeaderAsync( itemType, integrationCode, itemCode, itemId );\r\n            container.append( schedule );\r\n        }\r\n        \r\n        let actions = new ItemHeaderMenu( itemType, integrationCode, itemCode, itemId );\r\n        container.append( actions );\r\n\r\n        let icon    = new ItemHeaderIcon( integrationCode );\r\n        container.append( icon );\r\n\r\n        // Integration name for missing items\r\n        let integrationName = item.integrationName;\r\n        \r\n        let itemTag = new ItemHeaderTag( integrationCode, integrationName );\r\n        title.append( itemTag );\r\n\r\n        let titleSentence = new ItemHeaderSentence( itemType, integrationCode, itemCode, itemId );\r\n        title.append( titleSentence );\r\n        container.append( title );\r\n\r\n        let itemContent = $( '<div/>', { 'class': 'item__content' });\r\n        container.append( itemContent );\r\n\r\n        return container;\r\n    }\r\n\r\n    /**\r\n     * Create item notice\r\n     *\r\n     * @since 0.6\r\n     *\r\n     */\r\n\r\n    createNotice( item ){\r\n        let container;\r\n\r\n        if ( item.isMissing ){\r\n            container = $( '<div/>', { 'class': 'item-notice' });\r\n            container.text( UncannyAutomator.i18n.itemMissing );\r\n        }\r\n\r\n        return container;\r\n    }\r\n}\r\n\r\nexport default MetaboxItems;","import $ from 'jquery';\r\n\r\nimport {\r\n\tgetDOMElements,\r\n\tisDefined,\r\n\tvsprintf\r\n} from './Utilities.js';\r\n\r\nclass MetaboxNotice {\r\n\tconstructor( itemType, noticeType, noticeMessage ){\r\n\t\tthis.itemType \t\t= itemType;\r\n\t\tthis.noticeType \t= noticeType;\r\n\t\tthis.noticeMessage \t= noticeMessage;\r\n\r\n\t\t// Create notice\r\n        this.create();\r\n\t}\r\n\r\n\tcreate(){\r\n\t\t// Append to the metabox\r\n        let metabox = getDOMElements( 'metabox', {\r\n            type: this.itemType\r\n        });\r\n\r\n        // Get notice\r\n        let notice = this.createNotice();\r\n\r\n        // Append to the metabox\r\n        metabox.append( notice );\r\n\t}\r\n\r\n\tcreateNotice(){\r\n\t\tlet container = $( '<div/>', { 'class': 'metabox__notice' });\r\n\r\n\t\tif ( isDefined( this.noticeType ) ){\r\n\t\t\tcontainer.addClass( vsprintf( 'metabox__notice--%s', [ this.noticeType ] ) );\r\n\t\t}\r\n\r\n\t\tcontainer.html( this.noticeMessage );\r\n\t\treturn container;\r\n\t}\r\n}\r\n\r\nexport default MetaboxNotice;","import $ from 'jquery';\r\n\r\nimport {\r\n\tisDefined\r\n} from './Utilities.js';\r\n\r\n/**\r\n * Create a new modal box\r\n *\r\n * @since 0.4\r\n */\r\n\r\nclass Modal {\r\n\t/*\r\n\t * Construct method\r\n\t *\r\n\t * @since 0.4\r\n\t *\r\n\t * @param  {object} settings\r\n\t * @param  {object} [settings.content]\r\n\t * @param  {string} [settings.content.title] - Title of the metabox\r\n\t * @param  {string} [settings.content.warning] - Content of warning in the metabox\r\n\t * @param  {object} [settings.content.buttons]\r\n\t * @param  {string} [settings.content.buttons.cancel] - Text of the cancel button\r\n\t * @param  {string} [settings.content.buttons.confirm] - Text of the confirm button\r\n\t * @param  {object} [settings.events.onConfirm] - Function that is going to be invoked when the user press the confirm button\r\n\t * @param  {object} [settings.events.onCancel] - Function that is going to be invoked when the user press the cancel button\r\n\t * @param  {object} [settings.events.onShow] - Function that is going to be invoked when the modal box is shown\r\n\t * @param  {object} [settings.events.onHide] - Function that is going to be invoked when the modal box is hidden\r\n\t * \r\n\t * @return {object} - The modal box object\r\n\t */\r\n\r\n\tconstructor( content, config = {} ){\r\n\t\t// Create elements object\r\n\t\tthis.elements = {\r\n\t\t\tcontainer: null,\r\n\t\t\tautomatorContainer: null, // ( .uap ) This DIV is only created to avoid conflicts with other plugins\r\n\t\t\tmodal: {\r\n\t\t\t\tcontainer: null,\r\n\t\t\t\tbox: {\r\n\t\t\t\t\tcontainer: null,\r\n\t\t\t\t\ttitle: null,\r\n\t\t\t\t\twarning: null,\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tcontainer: null,\r\n\t\t\t\t\t\tcancel: null,\r\n\t\t\t\t\t\tconfirm: null\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Set container\r\n\t\tthis.elements.container = $( 'body' );\r\n\r\n\t\t// Set isVisible property\r\n\t\tthis.isVisible = false;\r\n\r\n\t\t// Define default configuration\r\n\t\tthis.config = $.extend( true, {\r\n\t\t\tfadeDuration: 150,\r\n\t\t\tsize: 'medium',\r\n\t\t\twarningFirst: false\r\n\t\t}, config );\r\n\r\n\t\t// Save modal box content. Add default values\r\n\t\tthis.content = $.extend( {}, {\r\n\t\t\tbuttons: {\r\n\t\t\t\tcancel: UncannyAutomator.i18n.cancel,\r\n\t\t\t}\r\n\t\t}, content );\r\n\r\n\t\t// Create new modal box\r\n\t\tthis.create();\r\n\r\n\t\t// Return object\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/*\r\n\t * Create modal box DOM elements\r\n\t *\r\n\t * @since 0.4\r\n\t */\r\n\r\n\tcreate(){\r\n\t\tlet automatorContainer = $( '<div/>', { 'class': 'uap' });\r\n\t\tlet modal = $( '<div/>', { 'class': 'modal' });\r\n\t\tlet modalBox = $( '<div/>', { 'class': 'modal__box' });\r\n\r\n\t\t// Check if the user wants a different modal size than the default size\r\n\t\tif ( isDefined( this.config.size ) && [ 'small', 'medium', 'large', 'extra-large' ].includes( this.config.size ) ){\r\n\t\t\t// Add the correct size class\r\n\t\t\tmodal.addClass( `modal--${ this.config.size }` );\r\n\t\t}\r\n\r\n\t\t// Check if the user wants to add a custom class\r\n\t\tif ( isDefined( this.config.customClass ) ){\r\n\t\t\tmodal.addClass( `modal--${ this.config.customClass }` );\r\n\t\t}\r\n\r\n\t\t// Save elements\r\n\t\tthis.elements.automatorContainer = automatorContainer;\r\n\t\tthis.elements.modal.container = modal;\r\n\t\tthis.elements.modal.box.container = modalBox;\r\n\r\n\t\t// Set title\r\n\t\tif ( isDefined( this.content.title ) ){\r\n\t\t\tlet modalTitle = $( '<div/>', { 'class': 'modal__title' }).html( this.content.title );\r\n\t\t\tmodalBox.append( modalTitle );\r\n\r\n\t\t\t// Save element\r\n\t\t\tthis.elements.modal.box.title = modalTitle;\r\n\t\t}\r\n\r\n\t\t// Set content\r\n\t\tlet modalContent;\r\n\t\tif ( isDefined( this.content.content ) ){\r\n\t\t\tmodalContent = $( '<div/>', { 'class': 'modal__content' });\r\n\r\n\t\t\t// Check if the content is node element\r\n\t\t\ttry {\r\n\t\t\t\tmodalContent.append( this.content.content );\r\n\t\t\t} catch ( e ){\r\n\t\t\t\tmodalContent.html( this.content.content );\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tmodalBox.append( modalContent );\r\n\r\n\t\t\t// Save element\r\n\t\t\tthis.elements.modal.box.content = modalContent;\r\n\t\t}\r\n\r\n\t\t// Set warning\r\n\t\tlet modalWarning;\r\n\t\tif ( isDefined( this.content.warning ) ){\r\n\t\t\tmodalWarning = $( '<div/>', { 'class': 'modal__warning' }).html( this.content.warning );\r\n\t\t\t\r\n\t\t\t// Save element\r\n\t\t\tthis.elements.modal.box.warning = modalWarning;\r\n\t\t}\r\n\r\n\t\t// Check the order of the warning\r\n\t\tif ( isDefined( this.config.warningFirst ) && this.config.warningFirst ){\r\n\t\t\tif ( isDefined( this.content.warning ) ){\r\n\t\t\t\tmodalBox.append( modalWarning );\r\n\t\t\t}\r\n\r\n\t\t\tif ( isDefined( this.content.content ) ){\r\n\t\t\t\tmodalBox.append( modalContent );\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif ( isDefined( this.content.content ) ){\r\n\t\t\t\tmodalBox.append( modalContent );\r\n\t\t\t}\r\n\r\n\t\t\tif ( isDefined( this.content.warning ) ){\r\n\t\t\t\tmodalBox.append( modalWarning );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Set buttons\r\n\t\tlet modalButtons = $( '<div/>', { 'class': 'modal__buttons' });\r\n\t\tlet cancelButton = $( '<button/>', { 'class': 'uap-btn uap-btn--secondary' }).html( this.content.buttons.cancel );\r\n\t\tmodalButtons.append( cancelButton );\r\n\r\n\t\t// Save elements\r\n\t\tthis.elements.modal.box.buttons.container = modalButtons;\r\n\t\tthis.elements.modal.box.buttons.cancel = cancelButton;\r\n\r\n\t\tif ( isDefined( this.content.buttons.confirm ) ){\r\n\t\t\tlet confirmButton = $( '<button/>', { 'class': 'uap-btn uap-btn--primary' }).html( this.content.buttons.confirm );\r\n\t\t\tmodalButtons.append( confirmButton );\r\n\r\n\t\t\t// Save element\r\n\t\t\tthis.elements.modal.box.buttons.confirm = confirmButton;\r\n\t\t}\r\n\r\n\t\tmodalBox.append( modalButtons );\r\n\r\n\t\t// Append elements and add to the container\r\n\t\tmodal.append( modalBox );\r\n\t\tautomatorContainer.append( modal );\r\n\t\tthis.elements.container.append( automatorContainer );\r\n\r\n\t\t// Add open class to the html tag\r\n\t\t$( 'html' ).addClass( 'automator-modal-open' );\r\n\r\n\t\t// Bind\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\t/*\r\n\t * Define events\r\n\t *\r\n\t * @since 0.4\r\n\t */\r\n\r\n\tsetEvents( events ){\r\n\t\tlet emptyFunction = () => {};\r\n\r\n\t\t// Define events\r\n\t\tthis.events = {\r\n\t\t\tafterSetEvents: isDefined( events.afterSetEvents ) \t? events.afterSetEvents : emptyFunction,\r\n\t\t\tafterShow: \t\tisDefined( events.afterShow ) \t \t? events.afterShow \t\t: emptyFunction,\r\n\t\t\tafterHide: \t\tisDefined( events.afterHide ) \t \t? events.afterHide \t\t: emptyFunction,\r\n\t\t\tonConfirm:  \tisDefined( events.onConfirm ) \t\t? events.onConfirm \t\t: emptyFunction,\r\n\t\t\tonCancel:   \tisDefined( events.onCancel )  \t\t? events.onCancel \t\t: emptyFunction,\r\n\t\t};\r\n\r\n\t\tif ( ! isDefined( events.onCancel ) ){\r\n\t\t\tthis.events.onCancel = () => {\r\n\t\t\t\t// Default onCancel function\r\n\t\t\t\t// Hide modal box\r\n\t\t\t\tthis.hide();\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Fire afterSetEvents event\r\n\t\tthis.events.afterSetEvents();\r\n\t}\r\n\r\n\t/*\r\n\t * Remove all the DOM elements\r\n\t *\r\n\t * @since 0.4\r\n\t */\r\n\r\n\tdestroy(){\r\n\t\tlet thisModal = this;\r\n\r\n\t\t// Unbind everything\r\n\t\tthis.unbind();\r\n\r\n\t\t// Check if it's visible\r\n\t\tif ( this.isVisible ){\r\n\t\t\t// We have to hide it first\r\n\t\t\tthis.hide(function(){\r\n\t\t\t\tthisModal.elements.automatorContainer.remove();\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthisModal.elements.automatorContainer.remove();\r\n\t\t}\r\n\r\n\t\t// Remove modal open class from the html tag\r\n\t\t$( 'html' ).removeClass( 'automator-modal-open' );\r\n\t}\r\n\r\n\t/*\r\n\t * Bind the clicks on the buttons\r\n\t *\r\n\t * @since 0.4\r\n\t */\r\n\r\n\tbind(){\r\n\t\tlet thisModal = this;\r\n\r\n\t\t// Bind cancel button\r\n\t\tif ( isDefined( this.elements.modal.box.buttons.cancel ) ){\r\n\t\t\tthis.elements.modal.box.buttons.cancel.on( 'click', function(){\r\n\t\t\t\tthisModal.events.onCancel();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Bind confirm button\r\n\t\tif ( isDefined( this.elements.modal.box.buttons.confirm ) ){\r\n\t\t\tthis.elements.modal.box.buttons.confirm.on( 'click', function(){\r\n\t\t\t\tthisModal.events.onConfirm();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t * Unbind all events\r\n\t *\r\n\t * @since 0.4\r\n\t */\r\n\r\n\tunbind(){\r\n\t\tthis.elements.modal.box.buttons.cancel.unbind( 'click' );\r\n\t\tthis.elements.modal.box.buttons.confirm.unbind( 'click' );\r\n\t}\r\n\r\n\t/*\r\n\t * Show modal box\r\n\t *\r\n\t * @since 0.4\r\n\t *\r\n\t * @param {object} [callback] - Custom function that it's going to be invoked after we show the modal box\r\n\t */\r\n\r\n\tshow( callback = null ){\r\n\t\tlet thisModal = this;\r\n\r\n\t\t// Set callback\r\n\t\tlet event = function(){};\r\n\r\n\t\tif ( isDefined( callback ) ){\r\n\t\t\tevent = callback;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tevent = this.events.afterShow;\r\n\t\t}\r\n\r\n\t\tcallback = event;\r\n\r\n\t\t// Change is visible status\r\n\t\tthis.isVisible = true;\r\n\r\n\t\t// Fade in\r\n\t\tthis.elements.modal.container.fadeIn( thisModal.config.fadeDuration, callback );\r\n\t}\r\n\r\n\t/*\r\n\t * Show modal box\r\n\t *\r\n\t * @since 0.4\r\n\t *\r\n\t * @param {object} [callback] - Custom function that it's going to be invoked after we hide the modal box\r\n\t */\r\n\r\n\thide( callback = null ){\r\n\t\tlet thisModal = this;\r\n\r\n\t\t// Set callback\r\n\t\tlet event = function(){};\r\n\r\n\t\tif ( isDefined( callback ) ){\r\n\t\t\tevent = callback;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tevent = this.events.afterHide;\r\n\t\t}\r\n\r\n\t\tcallback = event;\r\n\r\n\t\t// Change is visible status\r\n\t\tthis.isVisible = false;\r\n\r\n\t\t// Fade out\r\n\t\tthis.elements.modal.container.fadeOut( thisModal.config.fadeDuration, callback );\r\n\r\n\t\t// Remove modal open class from the html tag\r\n\t\t$( 'html' ).removeClass( 'automator-modal-open' );\r\n\t}\r\n\r\n\t/*\r\n\t * Returns all the DOM elements\r\n\t *\r\n\t * @since 0.4\r\n\t *\r\n\t * @return {object} All the DOM elements created by this class\r\n\t */\r\n\r\n\tgetElements(){\r\n\t\treturn this.elements;\r\n\t}\r\n}\r\n\r\nexport default Modal;\r\n","import $ from 'jquery';\r\n\r\nimport {\r\n\taddParametersToURL,\r\n\titemsObject,\r\n\tisDefined,\r\n\tisEmpty,\r\n\tinArray,\r\n\tvsprintf,\r\n\trestCall,\r\n} from './Utilities.js';\r\n\r\nimport RecipeNotices from './RecipeNotices.js';\r\n\r\nimport Field from './Field.js';\r\n\r\nclass Publish {\r\n\r\n\tconstructor(){\r\n\t\t// Get metabox element\r\n\t\tthis.elements = {\r\n\t\t\tmetabox: $( '#uo-automator-publish-metabox' ),\r\n\t\t\ttimesPerUser: {\r\n\t\t\t\teditLink:\t\tnull,\r\n\t\t\t\thiddenBox: \t\tnull,\r\n\t\t\t\tsaveButton: \tnull,\r\n\t\t\t\tcancelButton: \tnull,\r\n\t\t\t\tendPoint: \t\t'recipe_completions_allowed'\r\n\t\t\t},\r\n\t\t\ttimesPerRecipe: {\r\n\t\t\t\teditLink:\t\tnull,\r\n\t\t\t\thiddenBox: \t\tnull,\r\n\t\t\t\tsaveButton: \tnull,\r\n\t\t\t\tcancelButton: \tnull,\r\n\t\t\t\tendPoint: \t\t'recipe_max_completions_allowed'\r\n\t\t\t},\r\n\t\t\ttoggle: null\r\n\t\t}\r\n\r\n\t\t// Create new metabox\r\n\t\tthis.createMetabox();\r\n\t}\r\n\r\n\tcreateMetabox(){\r\n\t\tlet container          = $( '<div/>', { id: 'uap-publish-metabox' }),\r\n\t\t\tcontent            = $( '<div/>', { class: 'metabox__content' }),\r\n\t\t\tfooter             = $( '<div/>', { class: 'metabox__footer' });\r\n\r\n\t\t// Check if we have to add the times per user row\r\n\t\tif ( UncannyAutomator.recipe.type != 'anonymous' ){\r\n\t\t\t// Times per user row\r\n\t\t\tlet timesRow \t       = $( '<div/>', { class: 'publish-row' }),\r\n\t\t\t\ttimesRowVisible    = $( '<div/>', { class: 'publish-row__visible' }),\r\n\t\t\t\ttimesRowIconBox    = $( '<span/>', { class: 'publish-row__icon' }),\r\n\t\t\t\ttimesRowIcon       = $( '<i/>', { class: 'uo-icon uo-icon--sync-alt' }),\r\n\t\t\t\ttimesRowName       = $( '<span/>', { class: 'publish-row__name' }).text( UncannyAutomator.i18n.publish.timesPerUser );\r\n\r\n\t\t\t// Change value of numbers of times from -1 to empty\r\n\t\t\tUncannyAutomator.recipe.publish.timesPerUser = UncannyAutomator.recipe.publish.timesPerUser == -1 ? '' : UncannyAutomator.recipe.publish.timesPerUser;\r\n\t\t\tlet timesValue \t\t   = isEmpty( UncannyAutomator.recipe.publish.timesPerUser ) ? UncannyAutomator.i18n.publish.unlimited : UncannyAutomator.recipe.publish.timesPerUser;\r\n\r\n\t\t\tlet timesRowValue      = $( '<span/>', { class: 'publish-row__value' }).text( timesValue ),\r\n\t\t\t\ttimesRowEdit       = $( '<span/>', { class: 'publish-row__edit' }).text( UncannyAutomator.i18n.edit ),\r\n\t\t\t\ttimesRowHidden     = $( '<div/>', { class: 'publish-row__hidden' }),\r\n\t\t\t\ttimesRowHiddenBox  = $( '<div/>', { class: 'publish-row__settings' });\r\n\r\n\t\t\tthis.elements.timesPerUser.editLink  = timesRowEdit;\r\n\t\t\tthis.elements.timesPerUser.hiddenBox = timesRowHidden;\r\n\r\n\t\t\tlet timesRowField \t   = new Field( 'int', {\r\n\t\t\t\tcurrentValue: UncannyAutomator.recipe.publish.timesPerUser,\r\n\t\t\t\tdescription:  UncannyAutomator.i18n.publish.leaveEmpty,\r\n\t\t\t\tplaceholder:  UncannyAutomator.i18n.publish.unlimited,\r\n\t\t\t}, true, function( value, simulatedValue ){\r\n\t\t\t\t// Custom validation function\r\n\t\t\t\t// Create response object\r\n\t\t\t\tlet response = {\r\n\t\t\t\t\tisValid: false,\r\n\t\t\t\t\tmessage: ''\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if the number is 1 or bigger\r\n\t\t\t\tif ( value >= 1 ){\r\n\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tresponse.message = UncannyAutomator.i18n.publish.oneOrBigger\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Return response\r\n\t\t\t\treturn response;\r\n\t\t\t});\r\n\r\n\t\t\tthis.timesField \t   = timesRowField;\r\n\r\n\t\t\tlet timesRowButtons    = $( '<div/>', { class: 'publish-row__buttons' }),\r\n\t\t\t\ttimesRowSaveBtn    = $( '<div/>', { class: 'uap-btn uap-btn--primary' }).text( UncannyAutomator.i18n.save ),\r\n\t\t\t\ttimesRowCancelBtn  = $( '<div/>', { class: 'uap-btn uap-btn--secondary' }).text( UncannyAutomator.i18n.cancel );\r\n\r\n\t\t\tthis.elements.timesPerUser.saveButton   = timesRowSaveBtn;\r\n\t\t\tthis.elements.timesPerUser.cancelButton = timesRowCancelBtn;\r\n\r\n\t\t\ttimesRowButtons.append( timesRowSaveBtn );\r\n\t\t\ttimesRowButtons.append( timesRowCancelBtn );\r\n\r\n\t\t\ttimesRowHiddenBox.append( timesRowField.getFormElement() );\r\n\t\t\ttimesRowHiddenBox.append( timesRowButtons );\r\n\t\t\ttimesRowHidden.append( timesRowHiddenBox );\r\n\r\n\t\t\ttimesRowIconBox.append( timesRowIcon );\r\n\t\t\ttimesRowVisible.append( timesRowIconBox );\r\n\t\t\ttimesRowVisible.append( timesRowName );\r\n\t\t\ttimesRowVisible.append( timesRowValue );\r\n\t\t\ttimesRowVisible.append( timesRowEdit );\r\n\r\n\t\t\ttimesRow.append( timesRowVisible );\r\n\t\t\ttimesRow.append( timesRowHidden );\r\n\r\n\t\t\tcontent.append( timesRow );\r\n\t\t}\r\n\r\n\t\tlet timesPerRecipe = this.timesPerRecipe();\r\n\t\tcontent.append( timesPerRecipe );\r\n\r\n\t\t// Recipe type\r\n\t\tlet recipeTypeRow        = $( '<div/>',  { class: 'publish-row' }),\r\n\t\t\trecipeTypeRowVisible = $( '<div/>',  { class: 'publish-row__visible' }),\r\n\t\t\trecipeTypeRowIconBox = $( '<span/>', { class: 'publish-row__icon' }),\r\n\t\t\trecipeTypeRowIcon    = $( '<i/>',    { class: 'uo-icon uo-icon--utensils' }),\r\n\t\t\trecipeTypeRowName    = $( '<span/>', { class: 'publish-row__name' }).text( UncannyAutomator.i18n.publish.recipeType ),\r\n\t\t\trecipeTypeRowValue   = $( '<span/>', { class: 'publish-row__value' }),\r\n\t\t\trecipeTypeLearnMore  = $( `\r\n\t\t\t\t<a href=\"${ addParametersToURL( 'https://automatorplugin.com/knowledge-base/creating-a-recipe/', {\r\n                        'utm_source':  'uncanny_automator',\r\n                        'utm_medium':  'publish_metabox',\r\n                        'utm_content': 'recipe_type_question_icon'\r\n                    }) }\" class=\"publish-row__learn-more\" target=\"_blank\"><span class=\"uo-icon uo-icon--question-circle\"></span></a>\r\n\t\t\t` );\r\n\r\n\t\tif ( UncannyAutomator.recipe.type == 'user' ){\r\n\t\t\trecipeTypeRowValue.text( UncannyAutomator.i18n.recipeType.userRecipeName );\r\n\t\t}\r\n\r\n\t\tif ( UncannyAutomator.recipe.type == 'anonymous' ){\r\n\t\t\trecipeTypeRowValue.text( UncannyAutomator.i18n.recipeType.anonymousRecipeName );\r\n\t\t}\r\n\r\n\t\trecipeTypeRowIconBox.append( recipeTypeRowIcon );\r\n\t\trecipeTypeRowVisible.append( recipeTypeRowIconBox );\r\n\t\trecipeTypeRowVisible.append( recipeTypeRowName );\r\n\t\trecipeTypeRowVisible.append( recipeTypeRowValue );\r\n\t\trecipeTypeRowVisible.append( recipeTypeLearnMore );\r\n\t\trecipeTypeRow.append( recipeTypeRowVisible );\r\n\r\n\t\tcontent.append( recipeTypeRow );\r\n\r\n\t\t// Created on row\r\n\t\tlet createdRow \t\t   = $( '<div/>', { class: 'publish-row' }),\r\n\t\t\tcreatedRowVisible  = $( '<div/>', { class: 'publish-row__visible' }),\r\n\t\t\tcreatedRowIconBox  = $( '<span/>', { class: 'publish-row__icon' }),\r\n\t\t\tcreatedRowIcon     = $( '<i/>', { class: 'uo-icon uo-icon--calendar-alt' }),\r\n\t\t\tcreatedRowName     = $( '<span/>', { class: 'publish-row__name' }).text( UncannyAutomator.i18n.publish.createdOn ),\r\n\t\t\tcreatedRowValue    = $( '<span/>', { class: 'publish-row__value' }).text( UncannyAutomator.recipe.publish.createdOn );\r\n\r\n\t\tcreatedRowIconBox.append( createdRowIcon );\r\n\t\tcreatedRowVisible.append( createdRowIconBox );\r\n\t\tcreatedRowVisible.append( createdRowName );\r\n\t\tcreatedRowVisible.append( createdRowValue );\r\n\t\tcreatedRow.append( createdRowVisible );\r\n\r\n\t\tcontent.append( createdRow );\r\n\r\n\t\t// Copy/Duplicate Recipe\r\n\t\tlet copyRecipeRow \t\t   = $( '<div/>', { class: 'publish-row' }),\r\n\t\t\tcopyRecipeRowVisible  = $( '<div/>', { class: 'publish-row__visible' }),\r\n\t\t\tcopyRecipeRowName     = $( '<a/>', { class: 'publish-row__copy-to-draft button button-secondary', href: UncannyAutomator.recipe.publish.copyToDraft.replace( /&amp;/g, '&' ) }).text( UncannyAutomator.i18n.publish.copyRecipe );\r\n\r\n\t\tcopyRecipeRowVisible.append( copyRecipeRowName );\r\n\t\tcopyRecipeRow.append( copyRecipeRowVisible );\r\n\r\n\t\tcontent.append( copyRecipeRow );\r\n\r\n\t\t// Footer\r\n\r\n\t\tlet footerRow          = $( '<div/>', { class: 'publish-footer__row uap-clear' }),\r\n\t\t\tfooterRowLeft      = $( '<div/>', { class: 'publish-footer__left' }),\r\n\t\t\tfooterMoveToDraft  = $( '<a/>', { class: 'publish-footer__move-to-draft', href: UncannyAutomator.recipe.publish.moveToTrash.replace( /&amp;/g, '&' ) }).text( UncannyAutomator.i18n.proOnly.moveToTrash ),\r\n\t\t\tfooterRowRight     = $( '<div/>', { class: 'publish-footer__right' });\r\n\r\n\t\tlet recipeStatusToggle = new Field( 'checkbox', {\r\n            color: 'gutenberg',\r\n            align: 'right',\r\n            toggle: {\r\n                on:  UncannyAutomator.i18n.status.liveRecipe,\r\n                off: UncannyAutomator.i18n.status.draftRecipe,\r\n            },\r\n            currentValue: UncannyAutomator.recipe.isLive\r\n\t\t});\r\n\r\n\t\t// Save toggle Field in main object\r\n\t\tUncannyAutomator.recipe.publish.statusToggle = recipeStatusToggle;\r\n\r\n\t\tlet recipeStatusToggleDOM = recipeStatusToggle.getFormElement();\r\n\t\tthis.recipeStatusToggle   = recipeStatusToggle;\r\n\r\n\t\tthis.elements.toggle   = recipeStatusToggleDOM;\r\n\r\n\t\tfooterRowLeft.append( footerMoveToDraft );\r\n\t\tfooterRowRight.append( recipeStatusToggleDOM );\r\n\t\tfooterRow.append( footerRowLeft );\r\n\t\tfooterRow.append( footerRowRight );\r\n\t\t\r\n\t\tfooter.append( footerRow );\r\n\r\n\t\t// Append main elements to the metabox\r\n\t\tcontainer.append( content );\r\n\t\tcontainer.append( footer );\r\n\r\n\t\t// Render metabox\r\n\t\tthis.elements.metabox.html( container );\r\n\r\n\t\t// Render errors\r\n\t\tnew RecipeNotices();\r\n\r\n\t\t// Bind\r\n\t\tthis.bind();\r\n\r\n\t\t// Validate status\r\n\t\tthis.validateStatus();\r\n\t}\r\n\r\n\ttimesPerRecipe(){\r\n\t\t// Times per recipe row\r\n\t\tlet timesRecipeRow \t       = $( '<div/>', { class: 'publish-row' }),\r\n\t\t\ttimesRecipeRowVisible    = $( '<div/>', { class: 'publish-row__visible' }),\r\n\t\t\ttimesRecipeRowIconBox    = $( '<span/>', { class: 'publish-row__icon' }),\r\n\t\t\ttimesRecipeRowIcon       = $( '<i/>', { class: 'uo-icon uo-icon--unlock-alt' }),\r\n\t\t\ttimesRecipeRowName       = $( '<span/>', { class: 'publish-row__name' }).text( UncannyAutomator.i18n.publish.timesPerRecipe );\r\n\r\n\t\t// Change value of numbers of times from -1 to empty\r\n\t\tUncannyAutomator.recipe.publish.timesPerRecipe = UncannyAutomator.recipe.publish.timesPerRecipe == -1 ? '' : UncannyAutomator.recipe.publish.timesPerRecipe;\r\n\t\tlet timesRecipeValue \t\t   = isEmpty( UncannyAutomator.recipe.publish.timesPerRecipe ) ? UncannyAutomator.i18n.publish.unlimited : UncannyAutomator.recipe.publish.timesPerRecipe;\r\n\r\n\t\tlet timesRecipeRowValue      = $( '<span/>', { class: 'publish-row__value' }).text( timesRecipeValue ),\r\n\t\t\ttimesRecipeRowEdit       = $( '<span/>', { class: 'publish-row__edit' }).text( UncannyAutomator.i18n.edit ),\r\n\t\t\ttimesRecipeRowHidden     = $( '<div/>', { class: 'publish-row__hidden' }),\r\n\t\t\ttimesRecipeRowHiddenBox  = $( '<div/>', { class: 'publish-row__settings' });\r\n\r\n\t\tthis.elements.timesPerRecipe.editLink  = timesRecipeRowEdit;\r\n\t\tthis.elements.timesPerRecipe.hiddenBox = timesRecipeRowHidden;\r\n\r\n\t\tlet timesRecipeRowField \t   = new Field( 'int', {\r\n\t\t\tcurrentValue: UncannyAutomator.recipe.publish.timesPerRecipe,\r\n\t\t\tdescription:  UncannyAutomator.i18n.publish.leaveEmpty,\r\n\t\t\tplaceholder:  UncannyAutomator.i18n.publish.unlimited,\r\n\t\t}, true, function( value, simulatedValue ){\r\n\t\t\t// Custom validation function\r\n\t\t\t// Create response object\r\n\t\t\tlet response = {\r\n\t\t\t\tisValid: false,\r\n\t\t\t\tmessage: ''\r\n\t\t\t}\r\n\r\n\t\t\t// Check if the number is 1 or bigger\r\n\t\t\tif ( value >= 1 ){\r\n\t\t\t\tresponse.isValid = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tresponse.message = UncannyAutomator.i18n.publish.oneOrBigger\r\n\t\t\t}\r\n\r\n\t\t\t// Return response\r\n\t\t\treturn response;\r\n\t\t});\r\n\r\n\t\tthis.timesRecipeField \t   = timesRecipeRowField;\r\n\r\n\t\tlet timesRecipeRowButtons    = $( '<div/>', { class: 'publish-row__buttons' }),\r\n\t\t\ttimesRecipeRowSaveBtn    = $( '<div/>', { class: 'uap-btn uap-btn--primary' }).text( UncannyAutomator.i18n.save ),\r\n\t\t\ttimesRecipeRowCancelBtn  = $( '<div/>', { class: 'uap-btn uap-btn--secondary' }).text( UncannyAutomator.i18n.cancel );\r\n\r\n\t\tthis.elements.timesPerRecipe.saveButton   = timesRecipeRowSaveBtn;\r\n\t\tthis.elements.timesPerRecipe.cancelButton = timesRecipeRowCancelBtn;\r\n\r\n\t\ttimesRecipeRowButtons.append( timesRecipeRowSaveBtn );\r\n\t\ttimesRecipeRowButtons.append( timesRecipeRowCancelBtn );\r\n\r\n\t\ttimesRecipeRowHiddenBox.append( timesRecipeRowField.getFormElement() );\r\n\t\ttimesRecipeRowHiddenBox.append( timesRecipeRowButtons );\r\n\t\ttimesRecipeRowHidden.append( timesRecipeRowHiddenBox );\r\n\r\n\t\ttimesRecipeRowIconBox.append( timesRecipeRowIcon );\r\n\t\ttimesRecipeRowVisible.append( timesRecipeRowIconBox );\r\n\t\ttimesRecipeRowVisible.append( timesRecipeRowName );\r\n\t\ttimesRecipeRowVisible.append( timesRecipeRowValue );\r\n\t\ttimesRecipeRowVisible.append( timesRecipeRowEdit );\r\n\r\n\t\ttimesRecipeRow.append( timesRecipeRowVisible );\r\n\t\ttimesRecipeRow.append( timesRecipeRowHidden );\r\n\r\n\t\treturn timesRecipeRow;\r\n\t}\r\n\r\n\tvalidateStatus(){\r\n\t\t// We're going to use this method to check if the recipe is live but it's invalid\r\n\t\tif ( UncannyAutomator.recipe.isLive && ! UncannyAutomator.recipe.isValid ){\r\n\t\t\t// Make Draft\r\n\t\t\tUncannyAutomator.recipe.publish.statusToggle.setValue( false );\r\n\t\t}\r\n\t}\r\n\r\n\tvalidateTimesPerFields($element, $fieldValue, $timeField){\r\n\t\t// Times per user, click on \"Edit\"\r\n\t\t$element.editLink.on( 'click', () => {\r\n\t\t\t// Slide toggle\r\n\t\t\t$element.hiddenBox.slideToggle( 300 );\r\n\t\t});\r\n\r\n\t\t// Times per user, click on \"Cancel\"\r\n\t\t$element.cancelButton.on( 'click', () => {\r\n\t\t\t// Slide toggle\r\n\t\t\t$element.hiddenBox.slideToggle( 300, () => {\r\n\t\t\t\t// Reset UI\r\n\t\t\t\tnew Publish();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// Timer per user, click on \"Save\"\r\n\t\t$element.saveButton.on( 'click', () => {\r\n\t\t\t// Validate input\r\n\t\t\tlet validation = $timeField.validate();\r\n\r\n\t\t\t// Check if it's valid. Otherwise do nothing. Field.js will show an error\r\n\t\t\tif ( validation.isValid ){\r\n\r\n\t\t\t\t// Add loading class to save button\r\n\t\t\t\t$element.saveButton.addClass( 'uap-btn--loading uap-btn--disabled' );\r\n\r\n\t\t\t\t// Get value. We have to check if it's empty and change it to -1\r\n\t\t\t\tlet numberOfTimes = $timeField.getValue();\r\n\r\n\t\t\t\tif ( isEmpty( numberOfTimes ) ){\r\n\t\t\t\t\tnumberOfTimes = -1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\trestCall( $element.endPoint, {\r\n\t\t\t\t\tpost_ID: \t\t\t\t\tUncannyAutomator.recipe.id,\r\n\t\t\t\t\trecipe_completions_allowed: numberOfTimes\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\t// Update JS object\r\n\t\t\t\t\tif ( 'recipe_completions_allowed' == $element.endPoint ) {\r\n\t\t\t\t\t\tUncannyAutomator.recipe.publish.timesPerUser = numberOfTimes;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tUncannyAutomator.recipe.publish.timesPerRecipe = numberOfTimes;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//$fieldValue = numberOfTimes;\r\n\t\t\t\t\t// Slide toggle fields container and refresh the Publish UI\r\n\t\t\t\t\t$element.hiddenBox.slideToggle( 300, () => {\r\n\t\t\t\t\t\t// Reset UI\r\n\t\t\t\t\t\tnew Publish();\r\n\t\t\t\t\t});\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\tconsole.log( '‼️ ERROR-TODO. Couldn\\'t save times per user' );\r\n\r\n\t\t\t\t\t// Revert changes\r\n\t\t\t\t\t$timeField.setValue( $fieldValue );\r\n\r\n\t\t\t\t\t// Remove the loading class to save button\r\n\t\t\t\t\t$element.saveButton.removeClass( 'uap-btn--loading uap-btn--disabled' );\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Get field element and bind 'keyup'\r\n\t\t$timeField.getField().on( 'keyup', ( event ) => {\r\n\t\t\t// Check if it's an enter\r\n\t\t\tif ( event.keyCode == 13 ){\r\n\t\t\t\t// Trigger a click on the Save Button\r\n\t\t\t\t$element.saveButton.trigger( 'click' );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tbind(){\r\n\t\t// Check if we have to add the event listeners to the \"times per user\" row\r\n\t\tif ( UncannyAutomator.recipe.type != 'anonymous' ){\r\n\t\t\t// Times per user, click on \"Edit\"\r\n\t\t\tthis.validateTimesPerFields( this.elements.timesPerUser, UncannyAutomator.recipe.publish.timesPerUser, this.timesField );\r\n\t\t\t// this.elements.timesPerUser.editLink.on( 'click', () => {\r\n\t\t\t// \t// Slide toggle\r\n\t\t\t// \tthis.elements.timesPerUser.hiddenBox.slideToggle( 300 );\r\n\t\t\t// });\r\n\t\t\t//\r\n\t\t\t// // Times per user, click on \"Cancel\"\r\n\t\t\t// this.elements.timesPerUser.cancelButton.on( 'click', () => {\r\n\t\t\t// \t// Slide toggle\r\n\t\t\t// \tthis.elements.timesPerUser.hiddenBox.slideToggle( 300, () => {\r\n\t\t\t// \t\t// Reset UI\r\n\t\t\t// \t\tnew Publish();\r\n\t\t\t// \t});\r\n\t\t\t// });\r\n\t\t\t//\r\n\t\t\t// // Timer per user, click on \"Save\"\r\n\t\t\t// this.elements.timesPerUser.saveButton.on( 'click', () => {\r\n\t\t\t// \t// Validate input\r\n\t\t\t// \tlet validation = this.timesField.validate();\r\n\t\t\t//\r\n\t\t\t// \t// Check if it's valid. Otherwise do nothing. Field.js will show an error\r\n\t\t\t// \tif ( validation.isValid ){\r\n\t\t\t//\r\n\t\t\t// \t\t// Add loading class to save button\r\n\t\t\t// \t\tthis.elements.timesPerUser.saveButton.addClass( 'uap-btn--loading uap-btn--disabled' );\r\n\t\t\t//\r\n\t\t\t// \t\t// Get value. We have to check if it's empty and change it to -1\r\n\t\t\t// \t\tlet numberOfTimes = this.timesField.getValue();\r\n\t\t\t//\r\n\t\t\t// \t\tif ( isEmpty( numberOfTimes ) ){\r\n\t\t\t// \t\t\tnumberOfTimes = -1;\r\n\t\t\t// \t\t}\r\n\t\t\t//\r\n\t\t\t// \t\trestCall( 'recipe_completions_allowed', {\r\n\t\t\t// \t\t\tpost_ID: \t\t\t\t\tUncannyAutomator.recipe.id,\r\n\t\t\t// \t\t\trecipe_completions_allowed: numberOfTimes\r\n\t\t\t// \t\t}, () => {\r\n\t\t\t// \t\t\t// Update JS object\r\n\t\t\t// \t\t\tUncannyAutomator.recipe.publish.timesPerUser = numberOfTimes;\r\n\t\t\t//\r\n\t\t\t// \t\t\t// Slide toggle fields container and refresh the Publish UI\r\n\t\t\t// \t\t\tthis.elements.timesPerUser.hiddenBox.slideToggle( 300, () => {\r\n\t\t\t// \t\t\t\t// Reset UI\r\n\t\t\t// \t\t\t\tnew Publish();\r\n\t\t\t// \t\t\t});\r\n\t\t\t// \t\t}, () => {\r\n\t\t\t// \t\t\tconsole.log( '‼️ ERROR-TODO. Couldn\\'t save times per user' );\r\n\t\t\t//\r\n\t\t\t// \t\t\t// Revert changes\r\n\t\t\t// \t\t\tthis.timesField.setValue( UncannyAutomator.recipe.publish.timesPerUser );\r\n\t\t\t//\r\n\t\t\t// \t\t\t// Remove the loading class to save button\r\n\t\t\t// \t\t\tthis.elements.timesPerUser.saveButton.removeClass( 'uap-btn--loading uap-btn--disabled' );\r\n\t\t\t// \t\t});\r\n\t\t\t// \t}\r\n\t\t\t// });\r\n\t\t\t//\r\n\t\t\t// // Get field element and bind 'keyup'\r\n\t\t\t// this.timesField.getField().on( 'keyup', ( event ) => {\r\n\t\t\t// \t// Check if it's an enter\r\n\t\t\t// \tif ( event.keyCode == 13 ){\r\n\t\t\t// \t\t// Trigger a click on the Save Button\r\n\t\t\t// \t\tthis.elements.timesPerUser.saveButton.trigger( 'click' );\r\n\t\t\t// \t}\r\n\t\t\t// });\r\n\t\t}\r\n\r\n\t\t//Validate Recipe max times\r\n\t\tthis.validateTimesPerFields( this.elements.timesPerRecipe, UncannyAutomator.recipe.publish.timesPerRecipe, this.timesRecipeField );\r\n\t\t// Status change\r\n\t\tthis.elements.toggle.on( 'automator:field:change', () => {\r\n\t\t\t// Set loading status\r\n\t\t\tthis.recipeStatusToggle.startLoadingAnimation();\r\n\r\n\t\t\t// Set post status\r\n\t\t\tlet makeLive   = this.recipeStatusToggle.getValue(),\r\n\t\t\t\tpostStatus = makeLive ? 'publish' : 'draft';\r\n\r\n\t\t\t// Check if can make it live\r\n\t\t\tlet recipeTriggers = itemsObject( 'get', {\r\n\t\t\t\t\tfilter: {\r\n\t\t\t\t\t\titemType: 'trigger'\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n                canMakeLive = true;\r\n\r\n\t\t\t// Check if the user is trying to make the recipe live\r\n\t\t\tif ( canMakeLive && ( ! makeLive || ( makeLive && UncannyAutomator.recipe.isValid ) ) ){\r\n\r\n\t\t\t\trestCall( 'change_post_status', {\r\n\t\t\t\t\tpost_ID: \t UncannyAutomator.recipe.id,\r\n\t\t\t\t\tpost_status: postStatus\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\t// Update main object\r\n\t\t\t\t\tUncannyAutomator.recipe.isLive = makeLive;\r\n\r\n\t\t\t\t\t// Reset the UI\r\n\t\t\t\t\tnew Publish();\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\t// Shomething went wrong, show error\r\n\t\t\t\t\tconsole.log( '‼️ ERROR-TODO. Couldn\\'t set the recipe status' );\r\n\r\n\t\t\t\t\t// Revert user change\r\n\t\t\t\t\tsetTimeout( () => {\r\n\t\t\t\t\t\t// Stop loading animation\r\n\t\t\t\t\t\tthis.recipeStatusToggle.stopLoadingAnimation();\r\n\r\n\t\t\t\t\t\t// Revert value\r\n\t\t\t\t\t\tthis.recipeStatusToggle.setValue( false, false );\r\n\t\t\t\t\t}, 1000);\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif ( ! canMakeLive ){\r\n\t\t\t\t\t// Set error message\r\n                    UncannyAutomator.recipe.message.error = vsprintf( UncannyAutomator.i18n.proOnly.proToPublish, [ UncannyAutomator.i18n.uncannyAutomatorPro ] );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set error mode\r\n\t\t\t\tUncannyAutomator.recipe.errorMode = true;\r\n\r\n\t\t\t\t// Show error\r\n\t\t\t\tnew RecipeNotices();\r\n\r\n\t\t\t\t// Revert user change\r\n\t\t\t\tsetTimeout( () => {\r\n\t\t\t\t\t// Stop loading animation\r\n\t\t\t\t\tthis.recipeStatusToggle.stopLoadingAnimation();\r\n\r\n\t\t\t\t\t// Revert value\r\n\t\t\t\t\tthis.recipeStatusToggle.setValue( false, false );\r\n\t\t\t\t}, 1000);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default Publish;\r\n","import $ from 'jquery';\r\n\r\nimport {\r\n\tisEmpty,\r\n\tvsprintf,\r\n} from './Utilities.js';\r\n\r\nclass RecipeNotices {\r\n\tconstructor(){\r\n\t\t// Get main element\r\n\t\tthis.elements = {\r\n\t\t\tcontainer: $( '#uo-uap-notices' )\r\n\t\t}\r\n\r\n\t\t// Check if the container exists\r\n\t\t// If not, then create it\r\n\t\tif ( this.elements.container.length == 0 ){\r\n\t\t\tthis.createContainer();\r\n\t\t\tthis.elements.container = $( '#uo-uap-notices' );\r\n\t\t}\r\n\r\n\t\t// Empty the container\r\n\t\tthis.emptyContainer();\r\n\r\n\t\t// Create warning\r\n\t\tthis.createWarning();\r\n\r\n\t\t// Check if error mode is enabled\r\n\t\tif ( UncannyAutomator.recipe.errorMode ){\r\n\t\t\t// Create error\r\n\t\t\tthis.createError();\r\n\t\t}\t\r\n\t}\r\n\r\n\temptyContainer(){\r\n\t\tthis.elements.container.empty();\r\n\t}\r\n\r\n\tcreateContainer(){\r\n\t\t/* Create notice containers */\r\n\t    let noticeContainer = $( '<div/>', { id: 'uo-uap-notices', class: 'uap' });\r\n\t    $( '#uap-publish-metabox' ).prepend( noticeContainer );\r\n\t}\r\n\r\n\tcreateError(){\r\n\t\tlet thisRecipeNotices = this;\r\n\r\n\t\t// Check if we have to create the notice\r\n\t\tif ( ! isEmpty( UncannyAutomator.recipe.message.error ) ){\r\n\t\t\t// Create error container\r\n\t\t\tlet notice = $( '<div/>', { class: 'uo-notice uo-notice--error' }).text( UncannyAutomator.recipe.message.error );\r\n\t\t\tthis.elements.container.append( notice );\r\n\t\t}\r\n\t}\r\n\r\n\tcreateWarning(){\r\n\t\tlet thisRecipeNotices = this;\r\n\r\n\t\t// Check if we have to create the notice\r\n\t\tif ( ! isEmpty( UncannyAutomator.recipe.message.warning ) ){\r\n\t\t\tlet notice = $( '<div/>', { class: 'uo-notice uo-notice--warning' }).text( UncannyAutomator.recipe.message.warning );\r\n\t\t\tthis.elements.container.append( notice );\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default RecipeNotices;","import $ from 'jquery';\r\n\r\nimport {\r\n    restCall\r\n} from './Utilities.js';\r\n\r\nclass RecipeTitle {\r\n    constructor(){\r\n        this.elements = {\r\n            container: $( '#titlediv' ),\r\n            input:     $( '#titlediv #title' ),\r\n            status:    {}\r\n        }\r\n\r\n        this.publishedTitle = this.elements.input.val();\r\n\r\n        // Create DOM elements\r\n        this.createStatus();\r\n\r\n        // Bind changes\r\n        this.bindChanges();\r\n\r\n        // Unbind beforeunload.edit-post\r\n        this.notSavedAlert();\r\n    }\r\n\r\n    createStatus(){\r\n        let container    = $( '<div/>', { 'class': 'uap-title-status' }),\r\n            uapContainer = $( '<div/>', { 'class': 'uap' });\r\n\r\n        // Saving\r\n        let saving       = $( '<div/>', { 'class': 'uo-status uo-status--saving' }),\r\n            savingIcon   = $( '<span/>', { 'class': 'uo-status-icon uo-icon uo-icon--loading uo-icon--rotate' }),\r\n            savingText   = $( '<span/>', { 'class': 'uo-status__text' }).text( UncannyAutomator.i18n.title.saving );\r\n\r\n        saving.append( savingIcon );\r\n        saving.append( savingText );\r\n\r\n        this.elements.status.saving = saving;\r\n\r\n        // Saved\r\n        let saved        = $( '<div/>', { 'class': 'uo-status uo-status--saved' }),\r\n            savedIcon    = $( '<span/>', { 'class': 'uo-status-icon uo-icon uo-icon--check' }),\r\n            savedText    = $( '<span/>', { 'class': 'uo-status__text' }).text( UncannyAutomator.i18n.title.saved );\r\n\r\n        saved.append( savedIcon );\r\n        saved.append( savedText );\r\n\r\n        this.elements.status.saved = saved;\r\n\r\n        uapContainer.append( saving );\r\n        uapContainer.append( saved );\r\n        container.append( uapContainer );\r\n\r\n        // Append to the WP container\r\n        this.elements.container.append( container );\r\n    }\r\n\r\n    setStatusSaving(){\r\n        this.elements.status.saving.stop().fadeIn( 150 );\r\n    }\r\n\r\n    setStatusSaved(){\r\n        this.elements.status.saving.stop().fadeOut( 150 );\r\n\r\n        this.elements.status.saved.stop().fadeIn( 150, () => {\r\n            setTimeout( () => {\r\n                this.elements.status.saved.fadeOut( 150 );\r\n            }, 3000 );\r\n        });\r\n    }\r\n\r\n    revertChanges(){\r\n        // Revert the title\r\n        this.elements.input.val( this.publishedTitle );\r\n\r\n        // Stop the saving animation\r\n        this.elements.status.saving.stop().fadeOut( 150 );\r\n    }\r\n\r\n    bindChanges(){\r\n        let typingTimeout;\r\n\r\n        // Bind\r\n        this.elements.input.on( 'input', () => {\r\n            // Clear the timeout if it has already been set.\r\n            // This will prevent the previous task from executing\r\n            clearTimeout( typingTimeout );\r\n\r\n            // Wait 1.5 seconds\r\n            typingTimeout = setTimeout( () => {\r\n                // Set status saving\r\n                this.setStatusSaving();\r\n\r\n                // Update title\r\n                this.updateTitle();\r\n            }, 1500 );\r\n        });\r\n    }\r\n\r\n    getTitle(){\r\n        return this.elements.input.val();\r\n    }\r\n\r\n    updateTitle(){\r\n        restCall( 'change_post_title', {\r\n            post_ID:    UncannyAutomator.recipe.id,\r\n            post_title: this.getTitle()\r\n        }, () => {\r\n            this.setStatusSaved();\r\n\r\n            // Update the published title\r\n            this.publishedTitle = this.getTitle();\r\n        }, () => {\r\n            console.log( '‼️ ERROR-TODO. Couldn\\'t save the title' );\r\n\r\n            // Revert the changes\r\n            this.revertChanges();\r\n        });\r\n    }\r\n\r\n    notSavedAlert(){\r\n        $(document).ready( () => {\r\n            $( window ).off( 'beforeunload.edit-post' );\r\n        });\r\n    }\r\n}\r\n\r\nexport default RecipeTitle;","import $ from 'jquery';\r\n\r\nimport {\r\n\trestCall,\r\n\tgetDOMElements,\r\n\tisEmpty\r\n} from './Utilities.js';\r\n\r\nclass RecipeTypeSelector {\r\n\tconstructor( doWhenReady ){\r\n\t\t// Save callbacks\r\n\t\tthis.doWhenReady = doWhenReady;\r\n\r\n\t\t// Render\r\n\t\tthis.render();\r\n\r\n\t\t// Get elements\r\n\t\tthis.getElements();\r\n\r\n\t\t// Listen to the form submission\r\n\t\tthis.listenSubmission();\r\n\t}\r\n\r\n\trender(){\r\n\t\t// Create HTML\r\n\t\tconst $recipeTypeSelector = $( `\r\n\t\t\t<div class=\"uap\">\r\n\t\t\t\t<div id=\"uap-type-selector\" class=\"uap-type-selector\">\r\n\t\t\t\t\t<div class=\"uap-type-selector__box\">\r\n\t\t\t\t\t\t<form id=\"uap-type-selector-form\" class=\"uap-type-selector__form\">\r\n\t\t\t\t\t\t\t<div class=\"uap-type-selector__title\">\r\n\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.recipeType.title }\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"uap-type-selector__content\">\r\n\t\t\t\t\t\t\t\t<div class=\"uap-type-selector__types\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type uap-type-selector-type--user\">\r\n\t\t\t\t\t\t\t\t\t\t<input class=\"uap-type-selector-type__hidden-field\" type=\"radio\" name=\"uap-recipe-type\" value=\"user\" id=\"uap-recipe-type-user\">\r\n\t\t\t\t\t\t\t\t\t\t<label class=\"uap-type-selector-type__label\" for=\"uap-recipe-type-user\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__container\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__icon\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__icon-img uap-type-selector-type__icon-img--user\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__title\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.recipeType.userRecipeName }\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__description\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.recipeType.userRecipeDescription }\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type uap-type-selector-type--anonymous\">\r\n\t\t\t\t\t\t\t\t\t\t<input class=\"uap-type-selector-type__hidden-field\" type=\"radio\" name=\"uap-recipe-type\" value=\"anonymous\" id=\"uap-recipe-type-anonymous\">\r\n\t\t\t\t\t\t\t\t\t\t<label class=\"uap-type-selector-type__label\" for=\"uap-recipe-type-anonymous\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__container\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__icon\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__icon-img uap-type-selector-type__icon-img--anonymous\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__title\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.recipeType.anonymousRecipeName }\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"uap-type-selector-type__description\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.recipeType.anonymousRecipeDescription }\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"uap-type-selector__warning\">\r\n\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.recipeType.cantChangeLaterNotice }\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"uap-type-selector__buttons\">\r\n\t\t\t\t\t\t\t\t<button type=\"submit\" id=\"uap-type-selector-submit-button\" class=\"uap-btn uap-btn--primary\">${ UncannyAutomator.i18n.confirm }</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</form>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Append container to the body\r\n\t\t$( 'body' ).append( $recipeTypeSelector );\r\n\t}\r\n\r\n\tgetElements(){\r\n\t\t// Get elements\r\n\t\tthis.$elements = {\r\n\t\t\tcontainer:    $( '#uap-type-selector' ),\r\n\t\t\tform:         $( '#uap-type-selector-form' ),\r\n\t\t\twarning:      $( '#uap-type-selector .uap-type-selector__warning' ),\r\n\t\t\tsubmitButton: $( '#uap-type-selector-submit-button' )\r\n\t\t}\r\n\t}\r\n\r\n\tlistenSubmission(){\r\n\t\t// Listen submission\r\n\t\tthis.$elements.form.on( 'submit', ( event ) => {\r\n\t\t\t// Prevent default\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\t// Get recipe type\r\n\t\t\tconst recipeType = this.$elements.form.find( 'input[name=\"uap-recipe-type\"]:checked' ).val();\r\n\r\n\t\t\t// Check if it's defined and it's a valid value\r\n\t\t\tif ( ! isEmpty( recipeType ) ){\r\n\t\t\t\t// Check if it has a valid value\r\n\t\t\t\tif ( [ 'user', 'anonymous' ].includes( recipeType ) ){\r\n\t\t\t\t\t// Save recipe type\r\n\t\t\t\t\tthis.saveRecipeType( recipeType );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// The user is trying save a different value\r\n\t\t\t\t\tthis.showError( UncannyAutomator.i18n.recipeType.errorTryingToSaveOtherValue );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// The user didn't select an option\r\n\t\t\t\tthis.showError( UncannyAutomator.i18n.recipeType.errorDidNotSelectType );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tsaveRecipeType( recipeType ){\r\n\t\t// Define endpoint\r\n\t\tconst endpoint = 'change_post_recipe_type';\r\n\r\n\t\t// Define data to send\r\n\t\tconst data = {\r\n\t\t\tpost_ID:     UncannyAutomator.recipe.id,\r\n\t\t\trecipe_type: recipeType\r\n\t\t}\r\n\r\n\t\t// Add loading animation to the button\r\n\t\tthis.$elements.submitButton.addClass( 'uap-btn--loading uap-btn--disabled' );\r\n\r\n\t\t// Do a REST call to save the recipe type\r\n\t\trestCall( endpoint, data,\r\n\t\t\t( response ) => {\r\n\t\t\t\t// Check if it was successful\r\n\t\t\t\tif ( response.success ){\r\n\t\t\t\t\t// Remove container \r\n\t\t\t\t\t// We should render everything again and \r\n\t\t\t\t\t// add a conditional to not render the elements\r\n\t\t\t\t\tthis.$elements.container.remove();\r\n\r\n\t\t\t\t\t// Save in main object\r\n\t\t\t\t\tUncannyAutomator.recipe.type = recipeType;\r\n\r\n\t\t\t\t\t// Get the container of the title\r\n\t\t\t\t\tlet $triggersMetaboxTitle = $( '#uo-recipe-triggers-meta-box-ui h2.hndle.ui-sortable-handle' );\r\n\r\n\t\t\t\t\t// Create the title of triggers metabox\r\n\t\t\t\t\tlet triggersMetaboxTitle = UncannyAutomator.i18n.trigger.userTriggers;\r\n\t\t\t\t\tif ( UncannyAutomator.recipe.type == 'anonymous' ){\r\n\t\t\t\t\t\ttriggersMetaboxTitle = UncannyAutomator.i18n.trigger.anonymousTrigger;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Change text the title container\r\n\t\t\t\t\t$triggersMetaboxTitle.text( triggersMetaboxTitle );\r\n\r\n\t\t\t\t\t// Call callbacks\r\n\t\t\t\t\tthis.doWhenReady( recipeType );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Show error\r\n\t\t\t\t\tthis.showError( UncannyAutomator.i18n.recipeType.errorSomethingWentWrong );\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t( response ) => {\r\n\t\t\t\tconsole.log( '‼️ ERROR-TODO. Couldn\\'t save the recipe type' );\r\n\r\n\t\t\t\t// Remove loading class\r\n\t\t\t\tthis.$elements.submitButton.removeClass( 'uap-btn--loading uap-btn--disabled' );\r\n\r\n\t\t\t\t// Show error message\r\n\t\t\t\tthis.showError( UncannyAutomator.i18n.recipeType.errorSomethingWentWrong );\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tshowError( errorMessage ){\r\n\t\t// Create error\r\n\t\tconst $error = $( `\r\n\t\t\t<div class=\"uap-type-selector__error\">\r\n\t\t\t\t${ errorMessage }\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Check if the container already has an error container\r\n\t\tconst $oldErrorContainer = this.$elements.container.find( '.uap-type-selector__error' );\r\n\t\tif ( $oldErrorContainer.length > 0 ){\r\n\t\t\t$oldErrorContainer.remove();\r\n\t\t}\r\n\r\n\t\t// Add error container\r\n\t\t$error.insertAfter( this.$elements.warning );\r\n\r\n\t\t// Add class to shake\r\n\t\tsetTimeout(() => {\r\n\t\t\t$error.addClass( 'uap-type-selector__error--shake' );\r\n\t\t}, 10 );\r\n\t}\r\n}\r\n\r\nexport default RecipeTypeSelector;","import $ from 'jquery';\r\n\r\nimport {\r\n\tisDefined,\r\n\tvsprintf\r\n} from './Utilities.js';\r\n\r\nclass SendFeedback {\r\n\r\n\tconstructor(){\r\n\t\tthis.build();\r\n\t}\r\n\r\n\tbuild(){\r\n\t\tlet sendFeedbackContainer = $( '<div/>', { 'class': 'uap-report-bug' });\r\n\r\n\t\t// Temporal\r\n\r\n\t\t/*\r\n\t\tif ( this.showAgain() ){\r\n\t\t\tsendFeedbackContainer.addClass( 'uap-report-bug--open' );\r\n\r\n\t\t\tlet sendFeedbackOverlay = $( '<div/>', { 'class': 'uap-report-bug__overlay' });\r\n\t\t\tlet sendFeedbackCircle = $( '<div/>', { 'class': 'uap-report-bug-circle' });\r\n\t\t\tlet sendFeedbackCircleContainer = $( '<div/>', { 'class': 'uap-report-bug-circle__container' });\r\n\r\n\t\t\tlet sendFeedbackCircleText = $( '<div/>', { 'class': 'uap-report-bug-circle__text' });\r\n\t\t\tsendFeedbackCircleText.text( vsprintf( UncannyAutomator.i18n.sendFeedback.message, [ 'Uncanny Automator' ] ) );\r\n\t\t\tsendFeedbackCircleText.appendTo( sendFeedbackCircleContainer );\r\n\r\n\t\t\tlet sendFeedbackDontShowContainer = $( '<div/>', { 'class': 'uap-report-bug-circle__dont-show' });\r\n\t\t\tlet sendFeedbackDontShowLabel = $( '<label/>', { 'class': 'uap-report-bug-circle-checkbox' });\r\n\t\t\tlet sendFeedbackDontShowSpan = $( '<span/>', { 'class': 'uap-report-bug-circle__span' });\r\n\t\t\tsendFeedbackDontShowSpan.text( UncannyAutomator.i18n.sendFeedback.dontShowAgain );\r\n\t\t\tsendFeedbackDontShowSpan.appendTo( sendFeedbackDontShowLabel );\r\n\t\t\tlet sendFeedbackDontShowInput = $( '<input/>', { 'class': 'uap-report-bug-circle-checkbox__input', 'type': 'checkbox' });\r\n\t\t\tlet sendFeedbackDontShowInputRender = $( '<div/>', { 'class': 'uap-report-bug-circle-checkbox__render' });\r\n\t\t\tsendFeedbackDontShowInputRender.prependTo( sendFeedbackDontShowLabel );\r\n\t\t\tsendFeedbackDontShowInput.prependTo( sendFeedbackDontShowLabel );\r\n\t\t\tsendFeedbackDontShowLabel.appendTo( sendFeedbackDontShowContainer );\r\n\t\t\tsendFeedbackDontShowContainer.appendTo( sendFeedbackCircleContainer );\r\n\r\n\t\t\tlet sendFeedbackFooter = $( '<div/>', { 'class': 'uap-report-bug-circle__footer' });\r\n\t\t\tlet sendFeedbackFooterBtn = $( '<div/>', { 'class': 'uap-report-bug-circle__btn' });\r\n\t\t\tsendFeedbackFooterBtn.text( UncannyAutomator.i18n.sendFeedback.gotIt );\r\n\t\t\tsendFeedbackFooterBtn.appendTo( sendFeedbackFooter );\r\n\t\t\tsendFeedbackFooter.appendTo( sendFeedbackCircleContainer );\r\n\r\n\t\t\tsendFeedbackCircleContainer.appendTo( sendFeedbackCircle );\r\n\t\t\tsendFeedbackCircle.appendTo( sendFeedbackOverlay );\r\n\t\t\tsendFeedbackOverlay.appendTo( sendFeedbackContainer );\r\n\r\n\t\t\t// Bind\r\n\t\t\tthis.bind( sendFeedbackFooterBtn, sendFeedbackDontShowInput, sendFeedbackOverlay, sendFeedbackContainer );\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t// Check version\r\n\t\tlet version,\r\n\t\t\tutmSource;\r\n\r\n\t\tif ( ! isDefined( UncannyAutomator.wp ) || ! UncannyAutomator.wp ){\r\n\t\t\tversion   = vsprintf( 'Uncanny Automator %s', [ UncannyAutomator.version ] );\r\n\t\t\tutmSource = 'uncanny_automator';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tversion   = vsprintf( 'Uncanny Automator %s %s', [ 'Pro', UncannyAutomator.version ] );\r\n\t\t\tutmSource = vsprintf( 'uncanny_automator_%s', [ 'pro' ] );\r\n\t\t}\r\n\r\n\t\tlet sendFeedbackButton = $( '<a/>', {\r\n\t\t\t'class': 'uap-report-bug__btn',\r\n\t\t\t'uap-tooltip': UncannyAutomator.i18n.sendFeedback.title,\r\n\t\t\t'uap-flow': 'left',\r\n\t\t\t'href': vsprintf( 'https://automatorplugin.com/feedback/?version=%s&utm_source=%s&utm_medium=%s&utm_content=%s', [ version, utmSource, 'send_feedback', 'bulb_icon' ] ),\r\n\t\t\t'target': '_blank'\r\n\t\t});\r\n\r\n\t\tlet sendFeedbackButtonIcon = $( '<span/>', { 'class': 'uap-report-bug__icon' });\r\n\t\tsendFeedbackButton.append( sendFeedbackButtonIcon );\r\n\t\tsendFeedbackButton.appendTo( sendFeedbackContainer );\r\n\r\n\t\t// Append to the body\r\n\r\n\t\t$('body').append( sendFeedbackContainer );\r\n\t}\r\n\r\n\tbind( close_btn, dont_show_again_checkbox, overlay, mainContainer ){\r\n\r\n\t\tclose_btn.on( 'click', function(){\r\n\t\t\t// Storage\r\n\t\t\tif ( dont_show_again_checkbox.is(':checked') ){\r\n\t\t\t\tlocalStorage.uapSendFeedbackWelcome = 'hide';\r\n\t\t\t}\r\n\r\n\t\t\t// Hide\r\n\t\t\toverlay.fadeOut(150);\r\n\t\t\tmainContainer.removeClass( 'uap-report-bug--open' );\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tshowAgain(){\r\n\t\t/**\r\n\t\t * Version 2.0 introduced the recipe selector, which is\r\n\t\t * shown as an overlay on page load. As having two overlays\r\n\t\t * is bad for UX, we will hide this one\r\n\t\t */\r\n\t\t\r\n\t\tlet output = false;\r\n\r\n\t\t/*\r\n\t\tlet output = true;\r\n\r\n\t\tif ( localStorage.uapSendFeedbackWelcome && localStorage.uapSendFeedbackWelcome == 'hide' ){\r\n\t\t\toutput = false;\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\treturn output;\r\n\t}\r\n}\r\n\r\nexport default SendFeedback;","import $ from 'jquery';\r\n\r\nimport {\r\n\trestCall\r\n} from './Utilities.js';\r\n\r\nclass Taxonomies {\r\n\tconstructor(){\r\n\t\t// Save categories\r\n\t\tnew Categories();\r\n\r\n\t\t// Save tags\r\n\t\tnew Tags();\r\n\t}\r\n}\r\n\r\nclass Categories {\r\n\tconstructor(){\r\n\t\t// Get elements\r\n\t\tthis.getElements();\r\n\r\n\t\t// Check if the required element exist before adding\r\n\t\t// the event listeners\r\n\t\tif ( this.$elements.allCategories.length == 1 ){\r\n\t\t\t// Listen changes to the checkboxes\r\n\t\t\tthis.listenCheckboxes();\r\n\t\t}\r\n\t}\r\n\r\n\tgetElements(){\r\n\t\tthis.$elements = {\r\n\t\t\tcontainer:     $( '#recipe_categorydiv' ),\r\n\t\t\tallCategories: $( '#recipe_categorychecklist' )\r\n\t\t}\r\n\t}\r\n\r\n\tlistenCheckboxes(){\r\n\t\t// Listen changes to each checkbox\r\n\t\tthis.$elements.container.on( 'change', 'input[type=\"checkbox\"][name=\"tax_input[recipe_category][]\"], .popular-category input[type=\"checkbox\"]', ( event ) => {\r\n\t\t\t// Get checkbox\r\n\t\t\tconst $checkbox = $( event.currentTarget );\r\n\r\n\t\t\t// Save category\r\n\t\t\tthis.saveCategory( $checkbox );\r\n\t\t});\r\n\r\n\t\t// Listen when the user adds a new category. This will be\r\n\t\t// triggered when WP creates a new category after the user\r\n\t\t// used the \"+ Add New Category\" form\r\n\t\tnew MutationObserver(( mutations ) => {\r\n\t\t\t// Iterate mutations\r\n\t\t\tmutations.forEach( ( mutation ) => {\r\n\t\t\t\t// Iterate new categories\r\n\t\t\t\tmutation.addedNodes.forEach(( addedNode ) => {\r\n\t\t\t\t\t// Get the checkbox of the new category\r\n\t\t\t\t\tconst $checkbox = $( addedNode ).find( 'input[type=\"checkbox\"][name=\"tax_input[recipe_category][]\"]' );\r\n\r\n\t\t\t\t\t// Save category\r\n\t\t\t\t\tthis.saveCategory( $checkbox );\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}).observe( this.$elements.allCategories[0], {\r\n\t\t\tchildList: true\r\n\t\t});\r\n\t}\r\n\r\n\tgetCheckboxData( $checkbox ){\r\n\t\treturn {\r\n\t\t\tid:        $checkbox.val(),\r\n\t\t\tisChecked: $checkbox.is( ':checked' ),\r\n\t\t}\r\n\t}\r\n\r\n\tsaveCategory( $checkbox ){\r\n\t\t// Get the data\r\n\t\tlet checkboxData = this.getCheckboxData( $checkbox );\r\n\r\n\t\t// Set checkbox as loading\r\n\t\tthis.setStatus( 'loading', true, $checkbox );\r\n\r\n\t\t// Do call\r\n\t\trestCall( 'set_recipe_terms', {\r\n\t\t\tterm_id:      'recipe_category',\r\n\t\t\trecipe_id:    UncannyAutomator.recipe.id,\r\n\t\t\tcategory_id:  checkboxData.id,\r\n\t\t\tset_category: checkboxData.isChecked\r\n\t\t}, ( response ) => {\r\n\t\t\t// If the call (not necessarily the task) was successful...\r\n\r\n\t\t\tif ( response.success ){\r\n\t\t\t\t// If everything went well...\r\n\t\t\t\t// Show a green check icon\r\n\t\t\t\tthis.setStatus( 'success', true, $checkbox );\r\n\r\n\t\t\t\t// Remove it after 2 seconds\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// Remove the green check icon\r\n\t\t\t\t\tthis.setStatus( 'success', false, $checkbox );\r\n\t\t\t\t}, 2000 );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.log( '‼️ ERROR-TODO. Couldn\\'t change the status of the recipe category' );\r\n\r\n\t\t\t\t// If something went wrong,\r\n\t\t\t\t// revert the value of the checkbox\r\n\t\t\t\tthis.revertCheckboxValue( $checkbox );\r\n\r\n\t\t\t\t// Show an error icon\r\n\t\t\t\tthis.setStatus( 'error', true, $checkbox );\r\n\t\t\t\t// Remove it after 2 seconds\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// Remove the error icon\r\n\t\t\t\t\tthis.setStatus( 'error', false, $checkbox );\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Remove loading animation\r\n\t\t\tthis.setStatus( 'loading', false, $checkbox );\r\n\t\t}, ( response ) => {\r\n\t\t\t// On error...\r\n\r\n\t\t\t// Revert the value of the checkbox\r\n\t\t\tthis.revertCheckboxValue( $checkbox );\r\n\r\n\t\t\t// Remove loading animation\r\n\t\t\tthis.setStatus( 'loading', false, $checkbox );\r\n\r\n\t\t\t// Show an error icon\r\n\t\t\tthis.setStatus( 'error', true, $checkbox );\r\n\t\t\t// Remove it after 2 seconds\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t// Remove the error icon\r\n\t\t\t\tthis.setStatus( 'error', false, $checkbox );\r\n\t\t\t});\r\n\t\t}, {\r\n\t\t\trequiresRecipesObject: false,\r\n\t\t\trenderUI:              false\r\n\t\t});\r\n\t}\r\n\r\n\trevertCheckboxValue( $checkbox ){\r\n\t\t// Revert the value of the checkbox\r\n\t\t$checkbox.prop( 'checked', ! $checkbox.is( ':checked' ) );\r\n\t}\r\n\r\n\tsetStatus( status = '', enable = true, $checkbox ){\r\n\t\t// Get label container\r\n\t\tconst $label = $checkbox.closest( '.selectit' );\r\n\r\n\t\t// Check what status we have to set or unset\r\n\t\tif ( status == 'loading' ){\r\n\t\t\t// Check if we have to add or remove the loading status\r\n\t\t\tif ( enable ){\r\n\t\t\t\t// Add loading animation\r\n\t\t\t\t$label.addClass( 'uap-taxonomy-loading' );\r\n\r\n\t\t\t\t// Disable checkbox\r\n\t\t\t\t$checkbox.prop( 'disabled', true );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Remove loading animation\r\n\t\t\t\t$label.removeClass( 'uap-taxonomy-loading' );\r\n\r\n\t\t\t\t// Enable checkbox\r\n\t\t\t\t$checkbox.prop( 'disabled', false );\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ( status == 'success' ){\r\n\t\t\t// Check if we have to add or remove the loading status\r\n\t\t\tif ( enable ){\r\n\t\t\t\t// Add loading animation\r\n\t\t\t\t$label.addClass( 'uap-taxonomy-success' );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Remove loading animation\r\n\t\t\t\t$label.removeClass( 'uap-taxonomy-success' );\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ( status == 'error' ){\r\n\t\t\t// Check if we have to add or remove the loading status\r\n\t\t\tif ( enable ){\r\n\t\t\t\t// Add loading animation\r\n\t\t\t\t$label.addClass( 'uap-taxonomy-error' );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Remove loading animation\r\n\t\t\t\t$label.removeClass( 'uap-taxonomy-error' );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass Tags {\r\n\tconstructor(){\r\n\t\t// Get elements\r\n\t\tthis.getElements();\r\n\r\n\t\t// Check if the required elements exist before adding\r\n\t\t// the event listeners\r\n\t\tif ( this.$elements.tagsTextarea.length == 1 ){\r\n\t\t\t// Listen modifications to the textarea\r\n\t\t\tthis.listenModificationsToTags();\r\n\t\t}\r\n\t}\r\n\r\n\tgetElements(){\r\n\t\tthis.$elements = {\r\n\t\t\tcontainer:    $( '#tagsdiv-recipe_tag' ),\r\n\t\t\ttagsTextarea: $( 'textarea#tax-input-recipe_tag' ),\r\n\t\t\ttagsList:     $( '#tagsdiv-recipe_tag .tagchecklist' )\r\n\t\t}\r\n\t}\r\n\r\n\tlistenModificationsToTags(){\r\n\t\t// Listen when the user adds a new tag. This will be\r\n\t\t// triggered when the user uses the input to add tags\r\n\t\tnew MutationObserver(( mutations ) => {\r\n\t\t\t// Save tags\r\n\t\t\tthis.saveTags();\r\n\t\t}).observe( this.$elements.tagsList[0], {\r\n\t\t\tchildList: true\r\n\t\t});\r\n\t}\r\n\r\n\tsaveTags(){\r\n\t\t// Get tags\r\n\t\tconst tags = this.getTags();\r\n\r\n\t\t// Set checkbox as loading\r\n\t\tthis.setStatus( 'loading', true );\r\n\r\n\t\t// Do call\r\n\t\trestCall( 'set_recipe_terms', {\r\n\t\t\tterm_id:      'recipe_tag',\r\n\t\t\trecipe_id:    UncannyAutomator.recipe.id,\r\n\t\t\ttags:         tags,\r\n\t\t}, ( response ) => {\r\n\t\t\t// If the call (not necessarily the task) was successful...\r\n\r\n\t\t\tif ( response.success ){\r\n\t\t\t\t// If everything went well...\r\n\t\t\t\t// Show a green check icon\r\n\t\t\t\tthis.setStatus( 'success', true );\r\n\r\n\t\t\t\t// Remove it after 2 seconds\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// Remove the green check icon\r\n\t\t\t\t\tthis.setStatus( 'success', false );\r\n\t\t\t\t}, 2000 );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Reload\r\n\t\t\t\t// location.reload();\r\n\t\t\t}\r\n\r\n\t\t\t// Remove loading animation\r\n\t\t\tthis.setStatus( 'loading', false );\r\n\t\t}, ( response ) => {\r\n\t\t\t// On error...\r\n\r\n\t\t\t// Reload\r\n\t\t\tlocation.reload();\r\n\t\t}, {\r\n\t\t\trequiresRecipesObject: false,\r\n\t\t\trenderUI:              false\r\n\t\t});\r\n\t}\r\n\r\n\tsetStatus( status = '', enable = true ){\r\n\t\t// Check what status we have to set or unset\r\n\t\tif ( status == 'loading' ){\r\n\t\t\t// Check if we have to add or remove the loading status\r\n\t\t\tif ( enable ){\r\n\t\t\t\t// Add loading animation\r\n\t\t\t\tthis.$elements.container.addClass( 'uap-tags-loading' );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Remove loading animation\r\n\t\t\t\tthis.$elements.container.removeClass( 'uap-tags-loading' );\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ( status == 'success' ){\r\n\t\t\t// Check if we have to add or remove the loading status\r\n\t\t\tif ( enable ){\r\n\t\t\t\t// Add loading animation\r\n\t\t\t\tthis.$elements.container.addClass( 'uap-tags-success' );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Remove loading animation\r\n\t\t\t\tthis.$elements.container.removeClass( 'uap-tags-success' );\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ( status == 'error' ){\r\n\t\t\t// Check if we have to add or remove the loading status\r\n\t\t\tif ( enable ){\r\n\t\t\t\t// Add loading animation\r\n\t\t\t\tthis.$elements.container.addClass( 'uap-tags-error' );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Remove loading animation\r\n\t\t\t\tthis.$elements.container.removeClass( 'uap-tags-error' );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetTags(){\r\n\t\t// Get tags separated by comma\r\n\t\tconst tagsCommaSeparated = this.$elements.tagsTextarea.val();\r\n\r\n\t\t// Create array\r\n\t\tconst tagsArray = tagsCommaSeparated.split( ',' );\r\n\r\n\t\t// Return both\r\n\t\treturn {\r\n\t\t\tasArray:        tagsArray,\r\n\t\t\tcommaSeparated: tagsCommaSeparated\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default Taxonomies;","import $ from 'jquery';\r\n\r\nimport {\r\n    itemsObject,\r\n    getDOMElements,\r\n    isEmpty,\r\n    isDefined,\r\n    vsprintf\r\n} from './Utilities.js';\r\nimport ItemCreatorIntegrations  from './ItemCreatorIntegrations.js';\r\nimport MetaboxNotice            from './MetaboxNotice.js';\r\nimport MetaboxItems             from './MetaboxItems.js';\r\nimport MetaboxFooter            from './MetaboxFooter.js';\r\n\r\nclass Triggers {\r\n    constructor(){\r\n        // Create console group\r\n        // console.group( 'Triggers' );\r\n\r\n        // Get and clear metabox\r\n        let metabox = getDOMElements( 'metabox', { type: 'trigger' });\r\n        metabox.empty();\r\n\r\n        // Get recipe triggers\r\n        let triggers = itemsObject( 'get', {\r\n            filter: {\r\n                itemType: 'trigger'\r\n            }\r\n        });\r\n\r\n        // Check if it has triggers\r\n        if ( ! isEmpty( triggers ) ){\r\n            // Render items\r\n            new MetaboxItems( 'trigger', triggers );\r\n        }\r\n        else {\r\n            new ItemCreatorIntegrations( 'trigger' );\r\n        }\r\n\r\n        // Create metabox footer\r\n        new MetaboxFooter( 'trigger' );\r\n\r\n        // Close console group\r\n        // console.groupEnd();\r\n    }\r\n}\r\n\r\nexport default Triggers;","import $ from 'jquery';\r\n\r\nimport {\r\n\tuserSelectorObject,\r\n\trecipeObject,\r\n\trestCall,\r\n\tgetDOMElements,\r\n\tisDefined,\r\n\tisEmpty,\r\n\tvsprintf\r\n} from './Utilities';\r\n\r\nimport Field from './Field.js';\r\n\r\nimport Actions from './Actions';\r\n\r\nimport RecipeNotices from './RecipeNotices';\r\n\r\nclass UserSelector {\r\n\tconstructor(){\r\n\t\t// On page load, get current step\r\n\t\tUncannyAutomator.recipe.userSelector.step = userSelectorObject( 'get-step' );\r\n\r\n\t\t// Render\r\n\t\tthis.render();\r\n\t}\r\n\r\n\trender(){\r\n\t\t// Create variable to save the content to be added\r\n\t\tlet $content = ``;\r\n\r\n\t\t// Get content depending of the step\r\n\t\tswitch ( UncannyAutomator.recipe.userSelector.step ){\r\n\t\t\tcase 'select-source':\r\n\t\t\t\t// Set validation to false\r\n\t\t\t\t// We're setting it to false here in case the user already\r\n\t\t\t\t// has valid values, but wanted to go to the first step\r\n\t\t\t\t// to change the source\r\n\t\t\t\tUncannyAutomator.recipe.userSelector.isValid = false;\r\n\r\n\t\t\t\t// Validate recipe\r\n\t\t\t\trecipeObject( 'validate' );\r\n\r\n\t\t\t\t// Where the recipe creator select the source of the user.\r\n\t\t\t\t// The options are \"Existing user\" and \"New user\".\r\n\t\t\t\t$content = this.getSelectSourceNodes();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'set-options':\r\n\t\t\t\t// Where the recipe creator defines values of the fields\r\n\t\t\t\t$content = this.getOptionsNodes();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'show-sentence':\r\n\t\t\t\t// Validate recipe\r\n\t\t\t\trecipeObject( 'validate' );\r\n\r\n\t\t\t\t// Set error mode\r\n\t\t\t\tUncannyAutomator.recipe.errorMode = false;\r\n\r\n\t\t\t\t// Show error\r\n\t\t\t\tnew RecipeNotices();\r\n\r\n\t\t\t\t// When the data is complete and valid.\r\n\t\t\t\t$content = this.getSentenceNodes();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// Get container\r\n\t\tlet $metabox = getDOMElements( 'metabox', {\r\n            type: 'action'\r\n        });\r\n\r\n        console.log( '%cRender User Selector', 'background: red; color: #fff; padding: 2px 10px;');\r\n\r\n        // Append content\r\n        $metabox.prepend( $content );\r\n\t}\r\n\r\n\tgetSelectSourceNodes(){\r\n\t\t// Create elements\r\n\t\tlet $userSelector = $( `\r\n\t\t\t<div class=\"user-selector\">\r\n\t\t\t\t<div class=\"item item--user-selector\">\r\n\t\t\t\t\t<div class=\"item__content\">\r\n\t\t\t\t\t\t<div class=\"item-integrations\">\r\n\t\t\t\t\t\t\t<div class=\"item-integration user-selector-option user-selector-option--existing-user\" data-source=\"existingUser\">\r\n\t\t\t\t\t\t\t\t<div class=\"item-integration__logo\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"item-integration__name\">\r\n\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.userSelector.userType.existing }\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"item-integration user-selector-option user-selector-option--new-user\" data-source=\"newUser\">\r\n\t\t\t\t\t\t\t\t<div class=\"item-integration__logo\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"item-integration__name\">\r\n\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.userSelector.userType.new }\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\t\r\n\t\t` );\r\n\r\n\t\t// Add header\r\n\t\t$userSelector.find( '.item' ).prepend( this.getHeaderNodes() );\r\n\r\n\t\t// Get user type boxes\r\n\t\tlet $userTypeButtons = $userSelector.find( '.user-selector-option' );\r\n\r\n\t\t// Bind click on the user type buttons\r\n\t\t$userTypeButtons.on( 'click', ( event ) => {\r\n\t\t\t// Get clicked button\r\n\t\t\tlet $option = $( event.currentTarget );\r\n\r\n\t\t\t// Get user type\r\n\t\t\tlet userSource = $option.data( 'source' );\r\n\t\t\t\r\n\t\t\t// Save selected source in main object\r\n\t\t\tuserSelectorObject( 'set-source', {\r\n\t\t\t\tsource: userSource\r\n\t\t\t});\r\n\r\n\t\t\t// Define next step\r\n\t\t\tUncannyAutomator.recipe.userSelector.step = 'set-options';\r\n\r\n\t\t\t// Render the actions metabox again\r\n\t\t\tnew Actions();\r\n\t\t});\r\n\r\n\t\t// Return element\r\n\t\treturn $userSelector;\r\n\t}\r\n\r\n\tgetOptionsNodes(){\r\n\t\t// Create elements\r\n\t\tlet $optionsContainer = $( `\r\n\t\t\t<div class=\"user-selector\">\r\n\t\t\t\t<div class=\"item item--user-selector\">\r\n\t\t\t\t\t<div class=\"item__content\">\r\n\t\t\t\t\t\t<div class=\"item-options\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Add header\r\n\t\t$optionsContainer.find( '.item' ).prepend( this.getHeaderNodes() );\r\n\r\n\t\t// Get options container, we will add the fields there\r\n\t\tlet $fieldsContainer = $optionsContainer.find( '.item-options' );\r\n\r\n\t\t// Add fields\r\n\t\t$fieldsContainer.append( this.getOptionsFields() );\r\n\r\n\t\t// Return node\r\n\t\treturn $optionsContainer;\r\n\t}\r\n\r\n\tgetOptionsFields(){\r\n\t\t// Create container\r\n\t\tconst $container = $( `<div></div>` );\r\n\r\n\t\t// Create the fields container\r\n\t\tlet $fields = $( `<div class=\"item-options__group\"></div>` );\r\n\r\n\t\t// Create array to save all the fields\r\n\t\tlet optionsFields = [];\r\n\r\n\t\t// Update fields data object so it's an object and not an array\r\n\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\tsource: 'existingUser',\r\n\t\t\tfields: {}\r\n\t\t});\r\n\r\n\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\tsource: 'newUser',\r\n\t\t\tfields: {}\r\n\t\t});\r\n\r\n\t\t// Get WordPress roles, but remove the \"administrator\" one\r\n\t\tlet roles = UncannyAutomator.recipe.userSelector.resources.roles;\r\n\t\tdelete roles.administrator;\r\n\r\n\t\t// Check what's the source\r\n\t\tswitch ( UncannyAutomator.recipe.userSelector.source ){\r\n\t\t\tcase 'existingUser':\r\n\t\t\t\t// Create group\r\n\t\t\t\tlet $groupOfFields = $( `<div class=\"user-selector__field-group user-selector__field-group--two-columns\"></div>` );\r\n\r\n\t\t\t\t// Create \"Unique field\" field\r\n\t\t\t\tlet uniqueField = new Field( 'select', {\r\n\t\t\t\t\titemType: 'user-selector',\r\n\t\t\t\t\toptionCode: 'uniqueField',\r\n\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.existingUser.uniqueFieldLabel,\r\n\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.uniqueField,\r\n\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'email',\r\n\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.userSelector.existingUser.uniqueFieldOptionEmail\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'id',\r\n\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.userSelector.existingUser.uniqueFieldOptionId\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'username',\r\n\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.userSelector.existingUser.uniqueFieldOptionUsername\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t]\r\n\t\t\t\t});\r\n\t\t\t\toptionsFields.push( uniqueField );\r\n\r\n\t\t\t\t// Create value field\r\n\t\t\t\tlet valueField = new Field( 'text', {\r\n\t\t\t\t\titemType: 'user-selector',\r\n\t\t\t\t\toptionCode: 'uniqueFieldValue',\r\n\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.uniqueFieldValue,\r\n\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.existingUser.valueFieldLabel,\r\n\t\t\t\t\tplaceholder: UncannyAutomator.i18n.userSelector.existingUser.valueFieldPlaceholder,\r\n\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t});\r\n\t\t\t\toptionsFields.push( valueField );\r\n\r\n\t\t\t\t// Create and add form element\r\n\t\t\t\tlet $uniqueFieldFormElement = uniqueField.getFormElement();\r\n\t\t\t\t$groupOfFields.append( $uniqueFieldFormElement );\r\n\r\n\t\t\t\tlet $valueFieldFormElement = valueField.getFormElement();\r\n\t\t\t\t$groupOfFields.append( $valueFieldFormElement );\r\n\r\n\t\t\t\t// Add elements to the main container\r\n\t\t\t\t$fields.append( $groupOfFields );\r\n\r\n\t\t\t\t// Create field to decide what to do if the user doesn't exist\r\n\t\t\t\tlet fallbackField = new Field( 'radio', {\r\n\t\t\t\t\titemType: 'user-selector',\r\n\t\t\t\t\toptionCode: 'fallback',\r\n\t\t\t\t\tname: 'user-selector-existing-user-fallback',\r\n\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.existingUser.createNewUserFieldLabel,\r\n\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.fallback,\r\n\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'create-new-user',\r\n\t\t\t\t\t\t\ttext: UncannyAutomator.i18n.userSelector.existingUser.createNewUserFieldOptionCreateUser\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'do-nothing',\r\n\t\t\t\t\t\t\ttext: UncannyAutomator.i18n.userSelector.existingUser.createNewUserFieldOptionDoNothing\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t});\r\n\t\t\t\toptionsFields.push( fallbackField );\r\n\r\n\t\t\t\t// Create and add form element\r\n\t\t\t\tlet $fallbackFieldFormElement = fallbackField.getFormElement();\r\n\t\t\t\t$fields.append( $fallbackFieldFormElement );\r\n\r\n\t\t\t\t// Listen changes\r\n\t\t\t\t$uniqueFieldFormElement.on( 'automator:field:change', () => {\r\n\t\t\t\t\t// Get and save value\r\n\t\t\t\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\t\t\t\tsource: 'existingUser',\r\n\t\t\t\t\t\tfields: {\r\n\t\t\t\t\t\t\tuniqueField: uniqueField.getValue()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$valueFieldFormElement.on( 'automator:field:change', () => {\r\n\t\t\t\t\t// Get and save value\r\n\t\t\t\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\t\t\t\tsource: 'existingUser',\r\n\t\t\t\t\t\tfields: {\r\n\t\t\t\t\t\t\tuniqueFieldValue: valueField.getValue()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Listen changes\r\n\t\t\t\t$fallbackFieldFormElement.on( 'automator:field:change', () => {\r\n\t\t\t\t\t// Get and save value\r\n\t\t\t\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\t\t\t\tsource: 'existingUser',\r\n\t\t\t\t\t\tfields: {\r\n\t\t\t\t\t\t\tfallback: fallbackField.getValue()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Render the actions metabox again\r\n\t\t\t\t\tnew Actions();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Check if we have to add more fields or the do-nothing notice\r\n\t\t\t\tif ( UncannyAutomator.recipe.userSelector.fields.existingUser.fallback == 'do-nothing' ){\r\n\t\t\t\t\t// Create \"Do nothing\" notice\r\n\t\t\t\t\tconst $doNothingNotice = $( `\r\n\t\t\t\t\t\t<div class=\"user-selector__warning\">\r\n\t\t\t\t\t\t\t${ UncannyAutomator.i18n.userSelector.existingUser.doNothingMessage }\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t` );\r\n\r\n\t\t\t\t\t$fields.append( $doNothingNotice );\r\n\t\t\t\t}\r\n\t\t\t\telse if ( UncannyAutomator.recipe.userSelector.fields.existingUser.fallback == 'create-new-user' ){\r\n\t\t\t\t\t// Create container\r\n\t\t\t\t\tlet $subOptionsContainer = $( '<div/>', {\r\n\t\t\t\t\t\t'class': 'item-options'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Create new users fields\r\n\t\t\t\t\tlet newUserFields = [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\t\toptionCode: 'firstName',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.firstName,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.firstName,\r\n\t\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\t\toptionCode: 'lastName',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.lastName,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.lastName,\r\n\t\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\t\toptionCode: 'email',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.email,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.email,\r\n\t\t\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\t\toptionCode: 'username',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.username,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.username,\r\n\t\t\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\t\toptionCode: 'displayName',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.displayName,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.displayName,\r\n\t\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\t\toptionCode: 'password',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.existingUser.password,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.password,\r\n\t\t\t\t\t\t\tdescription: UncannyAutomator.i18n.userSelector.newUser.passwordDescription,\r\n\t\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\t\tfieldType:  'select',\r\n\t\t\t\t\t\t\toptionCode: 'role',\r\n\t\t\t\t\t\t\tcurrentValue: ! isEmpty( UncannyAutomator.recipe.userSelector.fields.existingUser.role ) ? UncannyAutomator.recipe.userSelector.fields.existingUser.role : 'subscriber',\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.role,\r\n\t\t\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\t\t\tsupportsTokens: false,\r\n\t\t\t\t\t\t\toptions: Object.keys( roles ).map( ( key, index ) => {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tvalue: key,\r\n\t\t\t\t\t\t\t\t\ttext:  roles[ key ]\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\titemType: 'user-selector',\r\n\t\t\t\t\t\t\tfieldType: 'radio',\r\n\t\t\t\t\t\t\toptionCode: 'logUserIn',\r\n\t\t\t\t\t\t\tname: 'logUserIn',\r\n\t\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.canLogNewUserIn ? ( ! isEmpty( UncannyAutomator.recipe.userSelector.fields.existingUser.logUserIn ) ? UncannyAutomator.recipe.userSelector.fields.existingUser.logUserIn : 'no' ) : 'no',\r\n\t\t\t\t\t\t\tisHidden: ! UncannyAutomator.recipe.canLogNewUserIn,\r\n\t\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.logUserIn,\r\n\t\t\t\t\t\t\tsupportsTokens: false,\r\n\t\t\t\t\t\t\toptions: [{\r\n\t\t\t\t\t\t\t\t\tvalue: 'yes',\r\n\t\t\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.yes\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tvalue: 'no',\r\n\t\t\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.no\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t];\r\n\r\n\t\t\t\t\t// Create fields\r\n\t\t\t\t\tnewUserFields.forEach(( fieldObject ) => {\r\n\t\t\t\t\t\t// Create field\r\n\t\t\t\t\t\tconst field = new Field( fieldObject.fieldType, fieldObject );\r\n\r\n\t\t\t\t\t\t// Get container\r\n\t\t\t\t\t\tlet $fieldFormElement = field.getFormElement();\r\n\t\t\t\t\t\t$subOptionsContainer.append( $fieldFormElement );\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * We don't need this for now, but we could need it in the future\r\n\t\t\t\t\t\t * \r\n\r\n\t\t\t\t\t\t// Listen changes\r\n\t\t\t\t\t\t$fieldFormElement.on( 'automator:field:change', () => {\r\n\t\t\t\t\t\t\t// Get ID\r\n\t\t\t\t\t\t\tconst fieldId = fieldObject.optionCode;\r\n\r\n\t\t\t\t\t\t\t// Get value\r\n\t\t\t\t\t\t\tconst value = field.getValue();\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t*/\r\n\r\n\t\t\t\t\t\t// Save field\r\n\t\t\t\t\t\toptionsFields.push( field );\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Append container\r\n\t\t\t\t\t$fields.append( $subOptionsContainer );\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'newUser':\r\n\t\t\t\t// Create new users fields\r\n\t\t\t\tlet newUserFields = [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\toptionCode: 'firstName',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.firstName,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.firstName,\r\n\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\toptionCode: 'lastName',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.lastName,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.lastName,\r\n\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\toptionCode: 'email',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.email,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.email,\r\n\t\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\toptionCode: 'username',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.username,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.username,\r\n\t\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\toptionCode: 'displayName',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.displayName,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.displayName,\r\n\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'text',\r\n\t\t\t\t\t\toptionCode: 'password',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.password,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.password,\r\n\t\t\t\t\t\tdescription: UncannyAutomator.i18n.userSelector.newUser.passwordDescription,\r\n\t\t\t\t\t\tisRequired: false,\r\n\t\t\t\t\t\tsupportsTokens: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\t\tfieldType:  'select',\r\n\t\t\t\t\t\toptionCode: 'role',\r\n\t\t\t\t\t\tcurrentValue: ! isEmpty( UncannyAutomator.recipe.userSelector.fields.newUser.role ) ? UncannyAutomator.recipe.userSelector.fields.newUser.role : 'subscriber',\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.role,\r\n\t\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\t\tsupportsTokens: false,\r\n\t\t\t\t\t\toptions: Object.keys( roles ).map( ( key, index ) => {\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tvalue: key,\r\n\t\t\t\t\t\t\t\ttext:  roles[ key ]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titemType: 'user-selector',\r\n\t\t\t\t\t\tfieldType: 'radio',\r\n\t\t\t\t\t\toptionCode: 'logUserIn',\r\n\t\t\t\t\t\tname: 'logUserIn',\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.canLogNewUserIn ? ( ! isEmpty( UncannyAutomator.recipe.userSelector.fields.newUser.logUserIn ) ? UncannyAutomator.recipe.userSelector.fields.newUser.logUserIn : 'no' ) : 'no',\r\n\t\t\t\t\t\tisHidden: ! UncannyAutomator.recipe.canLogNewUserIn,\r\n\t\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.logUserIn,\r\n\t\t\t\t\t\tsupportsTokens: false,\r\n\t\t\t\t\t\toptions: [{\r\n\t\t\t\t\t\t\t\tvalue: 'yes',\r\n\t\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.yes\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tvalue: 'no',\r\n\t\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.no\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t}\r\n\t\t\t\t];\r\n\r\n\t\t\t\t// Create fields\r\n\t\t\t\tnewUserFields.forEach(( fieldObject ) => {\r\n\t\t\t\t\t// Create field\r\n\t\t\t\t\tconst field = new Field( fieldObject.fieldType, fieldObject );\r\n\r\n\t\t\t\t\t// Get container\r\n\t\t\t\t\tlet $fieldFormElement = field.getFormElement();\r\n\t\t\t\t\t$fields.append( $fieldFormElement );\r\n\r\n\t\t\t\t\t// Save field\r\n\t\t\t\t\toptionsFields.push( field );\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Create fallback field\r\n\t\t\t\tlet newUserFallbackField = new Field( 'radio', {\r\n\t\t\t\t\titemType:   'user-selector',\r\n\t\t\t\t\toptionCode: 'fallback',\r\n\t\t\t\t\tname: 'user-selector-new-user-fallback',\r\n\t\t\t\t\tlabel: UncannyAutomator.i18n.userSelector.newUser.existingUserFieldLabel,\r\n\t\t\t\t\tisRequired: true,\r\n\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.fallback,\r\n\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'select-existing-user',\r\n\t\t\t\t\t\t\ttext: UncannyAutomator.i18n.userSelector.newUser.existingUserFieldOptionExisting\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvalue: 'do-nothing',\r\n\t\t\t\t\t\t\ttext: UncannyAutomator.i18n.userSelector.newUser.existingUserFieldOptionDoNothing\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t});\r\n\t\t\t\toptionsFields.push( newUserFallbackField );\r\n\r\n\t\t\t\t// Add fallback field to the container\r\n\t\t\t\tlet $newUserfallbackFieldFormElement = newUserFallbackField.getFormElement();\r\n\t\t\t\t$fields.append( $newUserfallbackFieldFormElement );\r\n\r\n\t\t\t\t// Listen changes\r\n\t\t\t\t$newUserfallbackFieldFormElement.on( 'automator:field:change', () => {\r\n\t\t\t\t\t// Update the value of all the fields (don't validate them yet)\r\n\t\t\t\t\tlet fieldsValues = {};\r\n\r\n\t\t\t\t\t// Iterate fields\r\n\t\t\t\t\toptionsFields.forEach(( Field ) => {\r\n\t\t\t\t\t\t// Save the field using the optionCode as ID and field value as value\r\n\t\t\t\t\t\tfieldsValues[ Field.getAttributes().optionCode ] = Field.getValue();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Get and save value\r\n\t\t\t\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\t\t\t\tsource: 'newUser',\r\n\t\t\t\t\t\tfields: fieldsValues\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Render the actions metabox again\r\n\t\t\t\t\tnew Actions();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Check if we have to add more fields or the do-nothing notice\r\n\t\t\t\tif ( UncannyAutomator.recipe.userSelector.fields.newUser.fallback == 'do-nothing' ){\r\n\t\t\t\t\t// Create \"Do nothing\" notice\r\n\t\t\t\t\tconst $doNothingNotice = $( `\r\n\t\t\t\t\t\t<div class=\"user-selector__warning\">\r\n\t\t\t\t\t\t\t${ UncannyAutomator.i18n.userSelector.newUser.doNothingMessage }\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t` );\r\n\r\n\t\t\t\t\t$fields.append( $doNothingNotice );\r\n\t\t\t\t}\r\n\t\t\t\telse if ( UncannyAutomator.recipe.userSelector.fields.newUser.fallback == 'select-existing-user' ){\r\n\t\t\t\t\t// Create container\r\n\t\t\t\t\tlet $subOptionsContainer = $( '<div/>', {\r\n\t\t\t\t\t\t'class': 'item-options'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Create \"Prioritized Field\" field\r\n\t\t\t\t\tlet prioritizedField = new Field( 'select', {\r\n\t\t\t\t\t\titemType:     'user-selector',\r\n\t\t\t\t\t\toptionCode:   'prioritizedField',\r\n\t\t\t\t\t\tlabel:        UncannyAutomator.i18n.userSelector.newUser.prioritizedFieldLabel,\r\n\t\t\t\t\t\tcurrentValue: UncannyAutomator.recipe.userSelector.fields.newUser.prioritizedField,\r\n\t\t\t\t\t\tdefaultValue: 'email',\r\n\t\t\t\t\t\tdescription:  UncannyAutomator.i18n.userSelector.newUser.prioritizedFieldDescription,\r\n\t\t\t\t\t\tisRequired:   true,\r\n\t\t\t\t\t\toptions: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tvalue: 'email',\r\n\t\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.userSelector.newUser.email\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tvalue: 'username',\r\n\t\t\t\t\t\t\t\ttext:  UncannyAutomator.i18n.userSelector.newUser.username\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t});\r\n\t\t\t\t\toptionsFields.push( prioritizedField );\r\n\r\n\t\t\t\t\t// Get field container\r\n\t\t\t\t\tlet $prioritizedField = prioritizedField.getFormElement();\r\n\t\t\t\t\t$subOptionsContainer.append( $prioritizedField );\r\n\r\n\t\t\t\t\t// Append container\r\n\t\t\t\t\t$fields.append( $subOptionsContainer );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// Add fields\r\n\t\t$container.append( $fields );\r\n\r\n\t\t// Create and add save and cancel buttons\r\n\t\tconst $buttonsContainer = $( `<div class=\"item-options__buttons\"></div>` );\r\n\r\n\t\t// Save button\r\n\t\tconst $saveButton = $( `<div class=\"uap-btn uap-btn--primary\">${ UncannyAutomator.i18n.save }</div>` );\r\n\t\tconst $cancelButton = $( `<div class=\"uap-btn uap-btn--secondary\">${ UncannyAutomator.i18n.cancel }</div>` );\r\n\r\n\t\t// Add listeners\r\n\t\t// On save\r\n\t\t$saveButton.on( 'click', () => {\r\n\t\t\t// Validate fields\r\n\t\t\t// Create default response\r\n\t\t\tlet areAllFieldsValid = true;\r\n\r\n\t\t\t// Create object to get all the fields values\r\n\t\t\tlet fieldsValues = {}\r\n\r\n\t\t\t// Iterate fields and validate them\r\n\t\t\toptionsFields.forEach(( Field ) => {\r\n\t\t\t\t// Get field validation\r\n\t\t\t\tconst isFieldValid = Field.validate().isValid;\r\n\r\n\t\t\t\t// Update global validation\r\n\t\t\t\tareAllFieldsValid = areAllFieldsValid && isFieldValid;\r\n\r\n\t\t\t\t// Check if the field is valid\r\n\t\t\t\tif ( isFieldValid ){\r\n\t\t\t\t\t// Save value\r\n\t\t\t\t\tfieldsValues[ Field.getAttributes().optionCode ] = Field.getValue();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Save values\r\n\t\t\tuserSelectorObject( 'update-fields', {\r\n\t\t\t\tsource: UncannyAutomator.recipe.userSelector.source,\r\n\t\t\t\tfields: fieldsValues\r\n\t\t\t});\r\n\r\n\t\t\t// Check if all fields are valid, otherwise\r\n\t\t\t// do nothing. The .validate() method will\r\n\t\t\t// render the errors\r\n\t\t\tif ( areAllFieldsValid ){\r\n\t\t\t\t// Add loading class to button\r\n\t\t\t\t$saveButton.addClass( 'uap-btn--primary uap-btn--loading uap-btn--disabled' );\r\n\r\n\t\t\t\t// Make request\r\n\t\t\t\trestCall( 'user-selector', {\r\n\t\t\t\t\trecipeId: UncannyAutomator.recipe.id,\r\n\t\t\t\t\tsource: UncannyAutomator.recipe.userSelector.source,\r\n\t\t\t\t\tfields: UncannyAutomator.recipe.userSelector.fields[ UncannyAutomator.recipe.userSelector.source ]\r\n\t\t\t\t}, ( response ) => {\r\n\t\t\t\t\t// On success\r\n\t\t\t\t\t// Set user selector as valid\r\n\t\t\t\t\tUncannyAutomator.recipe.userSelector.isValid = true;\r\n\r\n\t\t\t\t\t// Set step\r\n\t\t\t\t\tuserSelectorObject( 'set-step', {\r\n\t\t\t\t\t\tstep: 'show-sentence'\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Render actions again\r\n\t\t\t\t\tnew Actions();\r\n\t\t\t\t}, ( response ) => {\r\n\t\t\t\t\t// On error\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// On cancel\r\n\t\t$cancelButton.on( 'click', () => {\r\n\t\t\t// Delete fields information\r\n\t\t\t// userSelectorObject( 'reset-fields' );\r\n\r\n\t\t\t// Set step\r\n\t\t\tuserSelectorObject( 'set-step', {\r\n\t\t\t\tstep: 'select-source'\r\n\t\t\t});\r\n\r\n\t\t\t// Render actions again\r\n\t\t\tnew Actions();\r\n\t\t})\r\n\r\n\t\t// Add buttons\r\n\t\t$buttonsContainer.append( $saveButton );\r\n\t\t$buttonsContainer.append( $cancelButton );\r\n\t\t$container.append( $buttonsContainer );\r\n\r\n\t\treturn $container;\r\n\t}\r\n\r\n\tgetSentenceNodes(){\r\n\t\t// Create elements\r\n\t\tlet $optionsContainer = $( `\r\n\t\t\t<div class=\"user-selector user-selector--summary\">\r\n\t\t\t\t<div class=\"item item--user-selector\">\r\n\t\t\t\t\t<div class=\"item__content\">\r\n\t\t\t\t\t\t<div class=\"item-options\">\r\n\t\t\t\t\t\t\t<div class=\"user-selector-summary\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t$optionsContainer.find( '.item' ).prepend( this.getHeaderNodes() );\r\n\r\n\t\t// Get container\r\n\t\tlet $summaryContainer = $optionsContainer.find( '.user-selector-summary' );\r\n\r\n\t\t// Create first row\r\n\t\tlet $sourceRow = $( `\r\n\t\t\t<div class=\"user-selector-summary-row\">\r\n\t\t\t\t<div class=\"user-selector-summary-row__icon\">\r\n\t\t\t\t\t<span class=\"uo-icon uo-icon--atom\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"user-selector-summary-row__content\"></div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Create token\r\n\t\tlet $sourceRowToken = $( `\r\n\t\t\t<div class=\"user-selector-summary-row__token\"></div>\r\n\t\t` );\r\n\t\t$sourceRow.find( '.user-selector-summary-row__content' ).append( $sourceRowToken );\r\n\r\n\t\t// If the source is \"existingUser\"\r\n\t\tif ( UncannyAutomator.recipe.userSelector.source == 'existingUser' ){\r\n\t\t\t// Then add the \"Existing user\" string\r\n\t\t\t$sourceRowToken.text( UncannyAutomator.i18n.userSelector.userType.existing );\r\n\t\t}\r\n\t\t// If it's \"newUser\"\r\n\t\telse if ( UncannyAutomator.recipe.userSelector.source == 'newUser' ){\r\n\t\t\t// Then add the \"New user\" string\r\n\t\t\t$sourceRowToken.text( UncannyAutomator.i18n.userSelector.userType.new );\r\n\t\t}\r\n\r\n\t\t// Listen clicks\r\n\t\t$sourceRowToken.on( 'click', () => {\r\n\t\t\t// Go to the first step.\r\n\t\t\t\r\n\t\t\t// Delete fields information\r\n\t\t\t// userSelectorObject( 'reset-fields' );\r\n\r\n\t\t\t// Set step\r\n\t\t\tuserSelectorObject( 'set-step', {\r\n\t\t\t\tstep: 'select-source'\r\n\t\t\t});\r\n\r\n\t\t\t// Render actions again\r\n\t\t\tnew Actions();\r\n\t\t});\r\n\r\n\t\t// Add to container\r\n\t\t$summaryContainer.append( $sourceRow );\r\n\r\n\t\t// Create first row\r\n\t\tlet $dataRow = $( `\r\n\t\t\t<div class=\"user-selector-summary-row\">\r\n\t\t\t\t<div class=\"user-selector-summary-row__icon\">\r\n\t\t\t\t\t<span class=\"uo-icon uo-icon--fingerprint\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"user-selector-summary-row__content\"></div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Create token\r\n\t\tlet $dataRowSentence;\r\n\r\n\t\tif ( UncannyAutomator.recipe.userSelector.source == 'existingUser' ){\r\n\t\t\t$dataRowSentence = $( `\r\n\t\t\t\t<div>\r\n\t\t\t\t${\r\n\t\t\t\t\tvsprintf(\r\n\t\t\t\t\t\tUncannyAutomator.i18n.userSelector.summary.matches,\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t`<div class=\"user-selector-summary-row__token\">${ UncannyAutomator.i18n.userSelector.summary[ UncannyAutomator.recipe.userSelector.fields.existingUser.uniqueField ] }</div>`,\r\n\t\t\t\t\t\t\t`<div class=\"user-selector-summary-row__token\">${ UncannyAutomator.recipe.userSelector.fields.existingUser.uniqueFieldValue }</div>`\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t\t</div>`\r\n\t\t\t);\r\n\t\t}\r\n\t\telse if ( UncannyAutomator.recipe.userSelector.source == 'newUser' ){\r\n\t\t\t$dataRowSentence = $( `\r\n\t\t\t\t<div>\r\n\t\t\t\t${\r\n\t\t\t\t\tvsprintf(\r\n\t\t\t\t\t\tUncannyAutomator.i18n.userSelector.summary.withEmail,\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t`<div class=\"user-selector-summary-row__token\">${ UncannyAutomator.recipe.userSelector.fields.newUser.email }</div>`\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t`\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t$dataRow.find( '.user-selector-summary-row__content' ).append( $dataRowSentence );\r\n\r\n\t\t// Listen clicks\r\n\t\t$dataRowSentence.find( '.user-selector-summary-row__token' ).on( 'click', () => {\r\n\t\t\t// Go to the second step.\r\n\t\t\t\r\n\t\t\t// Set step\r\n\t\t\tuserSelectorObject( 'set-step', {\r\n\t\t\t\tstep: 'set-options'\r\n\t\t\t});\r\n\r\n\t\t\t// Render actions again\r\n\t\t\tnew Actions();\r\n\t\t});\r\n\r\n\t\t// Add data row\r\n\t\t$summaryContainer.append( $dataRow );\r\n\r\n\t\t// Add fallback row\r\n\t\tlet $fallbackRow = $( `\r\n\t\t\t<div class=\"user-selector-summary-row\">\r\n\t\t\t\t<div class=\"user-selector-summary-row__icon\">\r\n\t\t\t\t\t<span class=\"uo-icon uo-icon--directions\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"user-selector-summary-row__content\"></div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\tlet otherwiseText = '';\r\n\r\n\t\tif ( UncannyAutomator.recipe.userSelector.source == 'existingUser' ){\r\n\t\t\tif ( UncannyAutomator.recipe.userSelector.fields.existingUser.fallback == 'create-new-user' ){\r\n\t\t\t\totherwiseText = UncannyAutomator.i18n.userSelector.summary.createNewUser;\r\n\t\t\t}\r\n\t\t\telse if ( UncannyAutomator.recipe.userSelector.fields.existingUser.fallback == 'do-nothing' ){\r\n\t\t\t\totherwiseText = UncannyAutomator.i18n.userSelector.summary.doNothing;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ( UncannyAutomator.recipe.userSelector.source == 'newUser' ){\r\n\t\t\tif ( UncannyAutomator.recipe.userSelector.fields.newUser.fallback == 'select-existing-user' ){\r\n\t\t\t\totherwiseText = UncannyAutomator.i18n.userSelector.summary.selectExistingUser;\r\n\t\t\t}\r\n\t\t\telse if ( UncannyAutomator.recipe.userSelector.fields.newUser.fallback == 'do-nothing' ){\r\n\t\t\t\totherwiseText = UncannyAutomator.i18n.userSelector.summary.doNothing;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet $fallbackRowSentence = $( `\r\n\t\t\t<div>\r\n\t\t\t${\r\n\t\t\t\tvsprintf(\r\n\t\t\t\t\tUncannyAutomator.i18n.userSelector.summary.otherwise,\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t`<div class=\"user-selector-summary-row__token\">${ otherwiseText }</div>`\r\n\t\t\t\t\t]\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t\t</div>`\r\n\t\t);\r\n\t\t$fallbackRow.find( '.user-selector-summary-row__content' ).append( $fallbackRowSentence );\r\n\r\n\t\t// Listen clicks\r\n\t\t$fallbackRow.find( '.user-selector-summary-row__token' ).on( 'click', () => {\r\n\t\t\t// Go to the second step.\r\n\r\n\t\t\t// Set step\r\n\t\t\tuserSelectorObject( 'set-step', {\r\n\t\t\t\tstep: 'set-options'\r\n\t\t\t});\r\n\r\n\t\t\t// Render actions again\r\n\t\t\tnew Actions();\r\n\t\t});\r\n\r\n\t\t// Add data row\r\n\t\t$summaryContainer.append( $fallbackRow );\r\n\r\n\t\t// Return nodes\r\n\t\treturn $optionsContainer;\r\n\t}\r\n\r\n\tgetHeaderNodes(){\r\n\t\t// Define title variable\r\n\t\tlet title;\r\n\r\n\t\t// Get title variable\r\n\t\tswitch ( UncannyAutomator.recipe.userSelector.step ){\r\n\t\t\tcase 'select-source':\r\n\t\t\tcase 'show-sentence':\r\n\t\t\t\t// Define title\r\n\t\t\t\ttitle = UncannyAutomator.i18n.userSelector.sentenceTitle;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'set-options':\r\n\t\t\t\t// Define title\r\n\t\t\t\ttitle = UncannyAutomator.i18n.userSelector.setOptions;\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// Create output\r\n\t\tlet $output = $( `\r\n\t\t\t<div>\r\n\t\t\t\t<div class=\"item-actions\">\r\n\t\t\t\t\t<div class=\"item-actions__btn\">\r\n\t\t\t\t\t\t<i class=\"uo-icon uo-icon--ellipsis-h-alt\"></i>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"item-actions__dropdown\">\r\n\t\t\t\t\t\t<ul class=\"item-actions-dropdown__ul\">\r\n\t\t\t\t\t\t\t<a href=\"#\" target=\"_blank\" class=\"item-actions-dropdown__action\">\r\n\t\t\t\t\t\t\t\t<span>${ UncannyAutomator.i18n.support }</span>\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"item-icon\"></div>\r\n\t\t\t\t<div class=\"item-title uap-clear\">\r\n\t\t\t\t\t<div class=\"item-title__describe\">\r\n\t\t\t\t\t\t<div class=\"item-title__non-editable\">\r\n\t\t\t\t\t\t\t${ title }\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Add functionality to open and close the actions dropdown\r\n\t\t// Listen click on the three dots icon\r\n        $output.find( '.item-actions__btn' ).on( 'click', () => {\r\n        \t// Find the actions container and toogle the open class\r\n        \t$output.find( '.item-actions' ).toggleClass( 'item-actions--open' )\r\n        } );\r\n\r\n\t\t// Return output\r\n\t\treturn $output;\r\n\t}\r\n}\r\n\r\nexport default UserSelector;","import $ from 'jquery';\r\n\r\nimport {\r\n    validateField\r\n} from './Validation';\r\n\r\nimport RecipeTypeSelector from './RecipeTypeSelector';\r\nimport Field              from './Field';\r\nimport FieldsGroup        from './FieldsGroup';\r\nimport FieldsRepeater     from './FieldsRepeater';\r\nimport Modal              from './Modal.js';\r\n\r\nimport Tokens from './tokens/tokens';\r\n\r\n/**\r\n * Create the data required for Automator to render\r\n *\r\n * @since 2.1.6\r\n *\r\n * @param  {Function} callback The function to invoke after the data is ready\r\n * @return undefined\r\n */\r\nexport function createDataOnLoad( callback = '' ){\r\n\tconsoleLogLabel( 'Start creating the main object' );\r\n\r\n\t// Check if there is a callback defined\r\n\tcallback = ! isEmpty( callback ) ? callback : () => {};\r\n\r\n\t// Create a function to continue with the process once we know what's\r\n\t// the recipe type\r\n\tconst completeProcess = () => {\r\n\t\t// Filter Automator items\r\n\t\tfilterAutomatorItemsByRecipeType();\r\n\t\t// Group the triggers and actions by integration\r\n\t\tgroupItemsByIntegration();\r\n\r\n\t\t// Get recipe items on page load\r\n\t\trecipeObject( 'create', {\r\n\t\t\tallRecipes: UncannyAutomator.recipes_object\r\n\t\t});\r\n\r\n\t\t// Remove unnecessary data\r\n\t\t// delete UncannyAutomator.recipes_object;\r\n\t    delete UncannyAutomator.triggers;\r\n\t    delete UncannyAutomator.actions;\r\n\r\n\t    consoleLogLabel( 'Ended creating the main object' );\r\n\r\n\t    // Invoke the callback\r\n\t    callback();\r\n\t}\r\n\r\n\t// Check if WP is ready\r\n\tif ( ! isDefined( UncannyAutomator.wp ) || ! UncannyAutomator.wp ){\r\n\t\t// Define recipe type manually\r\n\t\tUncannyAutomator.recipe.type = 'user';\r\n\r\n\t\t// Complete the process\r\n\t\tcompleteProcess();\r\n\t}\r\n\telse {\r\n\t\tif ( ! isEmpty( UncannyAutomator.recipe.type ) ){\r\n\t\t\t// Complete the process\r\n\t\t\tcompleteProcess();\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Call to Recipe Type Selector\r\n\t\t\tnew RecipeTypeSelector(() => {\r\n\t\t\t\t// Complete the process\r\n\t\t\t\tcompleteProcess();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Update all the objects used for the UI using the recipes_object object\r\n *\r\n * @since 0.5\r\n *\r\n * @param {string}   action - Action to perform. Valid actions: 'create', 'delete',\r\n * @param {object}   attributes - Data, check each switch to see the required data\r\n *\r\n * @return {boolean} TRUE if the action was made successfully\r\n */\r\n\r\nexport function recipeObject( action = null, attributes = {} ){\r\n    // Create response variable and set default value\r\n    let response     = false;\r\n\r\n    // Define valid actions\r\n    let validActions = [ 'create', 'validate' ];\r\n\r\n    // Check if the action is not undefined and if it's a valid action\r\n    if ( isDefined( action ) && inArray( action, validActions ) ){\r\n        switch ( action ){\r\n            case 'create':\r\n                // Define required attributes properties\r\n                let requiredData = [ 'allRecipes' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Get this recipe in the allRecipes object\r\n                    let recipe;\r\n\r\n                    // Create allRecipes variable\r\n                    let allRecipes = attributes.allRecipes;\r\n\r\n                    $.each( allRecipes, function( index, theRecipe ){\r\n                        if ( theRecipe.ID == UncannyAutomator.recipe.id ){\r\n                            recipe = theRecipe;\r\n                        }\r\n                    });\r\n\r\n                    // Add element to all triggers, actions and closures to define the itemType. We're going to need this later\r\n                    $.each( recipe.triggers, ( index, trigger ) => trigger.itemType = 'trigger' );\r\n                    $.each( recipe.actions,  ( index, action  ) => action.itemType  = 'action'  );\r\n                    $.each( recipe.closures, ( index, closure ) => closure.itemType = 'closure' );\r\n\r\n                    // Merge all the recipe triggers, actions and closures into one array\r\n                    let items = [].concat.apply( [], [ recipe.triggers, recipe.actions, recipe.closures ] );\r\n\r\n                    // Reset items object\r\n                    itemsObject( 'reset' );\r\n\r\n                    // Check if the recipe is anonymous\r\n                    const recipeIsAnonymous = UncannyAutomator.recipe.type == 'anonymous';\r\n\r\n                    // Iterate each item and add it to the itemsObject\r\n                    $.each( items, function( index, item ){\r\n                        // We're going to get all the required information to before adding the item to the items object\r\n                        let itemToAdd;\r\n\r\n                        // Get the data from the global item\r\n                        let globalItem = getGlobalItem( item.meta.integration, item.itemType, item.meta.code );\r\n\r\n                        // Get the item code in this variable\r\n                        let itemCode = item.meta.code;\r\n\r\n                        // Check if the required PHP code for this item exists\r\n                        if ( isDefined( globalItem ) ){\r\n                            // Create variable to save all the options\r\n                            let options = {};\r\n\r\n                            // Check if it has simple options (options that aren't part of a group of options)\r\n                            if ( isDefined( globalItem.options ) ){\r\n                                $.each( globalItem.options, function( index, option ){\r\n                                    options[ option.option_code ] = [ option ];\r\n                                });\r\n                            }\r\n\r\n                            // Add group of options\r\n                            if ( isDefined( globalItem.options_group ) ){\r\n                                $.extend( true, options, globalItem.options_group );\r\n                            }\r\n\r\n                            // We're going to create another options variable to create the options object as we're going to add it to the item object\r\n                            let groupsOfOptions = {}\r\n\r\n                            $.each( options, function( groupKey, fields ){\r\n                                let allFieldsOnThisGroup = [];\r\n\r\n                                // Check if it has more this group of fields has more than one option\r\n                                let hasMoreThanOneOption = fields.length > 1;\r\n\r\n                                $.each( fields, function( index, field ){\r\n                                    // Check if value is undefined but has a default value\r\n                                    /*\r\n                                    if ( ! isDefined( item.meta[ field.option_code ] ) && isDefined( item.meta.default_value ) ){\r\n                                        item.meta[ field.option_code ] = field.default_value;\r\n                                    }\r\n                                    */\r\n\r\n                                    // Sanitize field data\r\n                                    const sanitizeFieldData = ( field ) => {\r\n                                        // Create field object\r\n                                        let fieldObject = {\r\n                                            isGroup:            hasMoreThanOneOption,\r\n                                            itemId:             item.ID,\r\n                                            itemType:           item.itemType,\r\n\r\n                                            isRequired:         isDefined( field.required ) ? field.required : false,\r\n                                            isReadOnly:         isDefined( field.read_only ) ? field.read_only : false,\r\n                                            supportsTinyMCE:    isDefined( field.supports_tinymce ) ? field.supports_tinymce : false,\r\n                                            supportsCopyToClipboard: isDefined( field.copy_to_clipboard ) ? field.copy_to_clipboard : false,\r\n\r\n                                            isAjax:             isDefined( field.is_ajax ) ? field.is_ajax : false,\r\n\r\n                                            groupId:            groupKey,\r\n                                            optionCode:         field.option_code,\r\n                                            fieldType:          field.input_type,\r\n\r\n                                            label:              field.label,\r\n                                            description:        field.description,\r\n                                            placeholder:        field.placeholder,\r\n                                            isHidden:           isDefined( field.is_hidden ) ? field.is_hidden : false,\r\n                                            tokenName:          isDefined( field.token_name ) ? field.token_name : field.label,\r\n\r\n                                            defaultValue:       field.default_value,\r\n                                            currentValue:       isDefined( item.meta[ field.option_code ] ) ? item.meta[ field.option_code ] : field.default_value,\r\n                                            customFieldTokens:    isDefined( field.relevant_tokens ) ? field.relevant_tokens : false,\r\n                                            relevant_tokens:    isDefined( field.relevant_tokens ) ? field.relevant_tokens : false,\r\n\r\n                                            maxLength:          isDefined( field.max_length ) ? field.max_length : null,\r\n                                        }\r\n\r\n                                        /**\r\n                                         * Check for type-specific options\r\n                                         */\r\n                                        if ( fieldObject.fieldType == 'date' ){\r\n                                            fieldObject.dateFormat    = isDefined( field.date_format ) ? field.date_format : 'Y-m-d';\r\n                                            fieldObject.dateAltFormat = isDefined( field.date_alt_format ) ? field.date_alt_format : UncannyAutomator.format.date;\r\n\r\n                                            // Check if it supports a range\r\n                                            fieldObject.supportsRange = isDefined( field.supports_range ) ? field.supports_range : false;\r\n\r\n                                            // Check if it has min date defined\r\n                                            if ( isDefined( field.min_date ) ){\r\n                                                fieldObject.minDate = field.min_date;\r\n                                            }\r\n\r\n                                            // Check if it has max date defined\r\n                                            if ( isDefined( field.max_date ) ){\r\n                                                fieldObject.maxDate = field.max_date;\r\n                                            }\r\n                                        }\r\n\r\n                                        if ( fieldObject.fieldType == 'time' ){\r\n                                            fieldObject.timeFormat    = isDefined( field.time_format ) ? field.time_format : 'H:i K';\r\n                                            fieldObject.timeAltFormat = isDefined( field.time_alt_format ) ? field.time_alt_format : 'H:i K';\r\n\r\n                                            // Check if it has min time defined\r\n                                            if ( isDefined( field.min_time ) ){\r\n                                                fieldObject.minTime = field.min_time;\r\n                                            }\r\n\r\n                                            // Check if it has max date defined\r\n                                            if ( isDefined( field.max_date ) ){\r\n                                                fieldObject.maxTime = field.max_time;\r\n                                            }\r\n                                        }\r\n\r\n                                        /**\r\n                                         * We want to make supportsTokens true by\r\n                                         * default, but we have to check if the field\r\n                                         * should support tokens first.\r\n                                         *\r\n                                         * - Field type: For now, the token selector\r\n                                         * only supports text, textarea, integer, float,\r\n                                         * email, and URL fields. Check if this field\r\n                                         * is one of those.\r\n                                         *\r\n                                         * - Item type: The tokens are rendered only in\r\n                                         * the user selector, actions and closures.\r\n                                         * Check if the item type if one of those.\r\n                                         *\r\n                                         * - Read-only property: Check if the field is\r\n                                         * not read-only. Even if the field meets the\r\n                                         * previous conditions, it doesn't make sense\r\n                                         * to render the token selector on a field\r\n                                         * which value is supposed to be unmodifiable.\r\n                                         *\r\n                                         * If the field meets all the previous\r\n                                         * conditions, check if it has a defined value\r\n                                         * for the supportsTokens property. Otherwise,\r\n                                         * set it true. If it doesn't meet at least\r\n                                         * one of the conditions, make it false.\r\n                                         */\r\n\r\n                                        if (\r\n                                            [ 'text', 'textarea', 'int', 'float', 'email', 'url', 'select', 'date', 'time' ].includes( fieldObject.fieldType ) &&\r\n                                            [ 'action', 'closure' ].includes( fieldObject.itemType ) &&\r\n                                            ! fieldObject.isReadOnly\r\n                                        ){\r\n                                            fieldObject.supportsTokens = isDefined( field.supports_tokens ) ? field.supports_tokens : true;\r\n                                        }\r\n                                        else {\r\n                                            fieldObject.supportsTokens = false;\r\n                                        }\r\n\r\n                                        // If it's a select, check if it support custom values\r\n                                        if ( fieldObject.fieldType == 'select' ){\r\n                                            // Check if the supportsCustomValue parameter is defined. If it's not,\r\n                                            // then check if the field is being used on an action or closure. If so, make it true\r\n                                            // by default, or false otherwise. Then, on \"Field\", set the default value to false.\r\n                                            // We're doing this because, for now, we're supporting custom values on dropdowns\r\n                                            // only on actions and closures, nowhere else. So if someone tries to use a dropdown\r\n                                            // outside an action or closure, it shouldn't render the \"custom value\" option by default\r\n                                            fieldObject.supportsCustomValue = isDefined( field.supports_custom_value ) ? field.supports_custom_value : ( [ 'action', 'closure' ].includes( fieldObject.itemType ) ? true : false );\r\n                                            // ⚠️ Disable functionality\r\n                                            // fieldObject.supportsCustomValue = false;\r\n\r\n                                            // Check if it supports custom values and it also supports tokens\r\n                                            if ( fieldObject.supportsCustomValue ){\r\n                                                // Add custom value\r\n                                                fieldObject.customValue = isDefined( item.meta[ `${ fieldObject.optionCode }_custom` ] ) ? item.meta[ `${ fieldObject.optionCode }_custom` ] : '';\r\n                                            }\r\n\r\n                                            // Check if it has a description for the custom value field\r\n                                            if ( isDefined( field.custom_value_description ) ){\r\n                                                fieldObject.customValueDescription = field.custom_value_description;\r\n                                            }\r\n\r\n                                            // Check if it supports multiple values\r\n                                            if ( isDefined( field.supports_multiple_values ) ){\r\n                                                 fieldObject.supportsMultipleValues = field.supports_multiple_values;\r\n                                            }\r\n                                        }\r\n\r\n                                        // Check if it an AJAX field\r\n                                        if ( fieldObject.isAjax ){\r\n                                            fieldObject.targetField   = isDefined( field.fill_values_in ) ? field.fill_values_in : '';\r\n                                            fieldObject.endpoint      = isDefined( field.endpoint ) ? field.endpoint : '';\r\n                                            fieldObject.integrationId = globalItem.integration;\r\n\r\n                                            // Check if it's an ajax field without target field\r\n                                            // This means no other field will change when this one changes\r\n                                            // and that we have to do an AJAX request when rendering the field, on page load\r\n                                            if ( isEmpty( fieldObject.targetField ) ){\r\n                                                fieldObject.targetField = field.option_code;\r\n                                            }\r\n                                        }\r\n\r\n                                        // Check if it's select or radio. In that case, add the options\r\n                                        if ( [ 'select', 'radio' ].includes( fieldObject.fieldType ) ){\r\n                                            fieldObject.options = isDefined( field.options ) ? field.options : [];\r\n                                        }\r\n\r\n                                        // Return field object\r\n                                        return fieldObject;\r\n                                    }\r\n\r\n                                    let fieldObject, fieldInstance;\r\n\r\n                                    // Check if it's a group of fields\r\n                                    if ( field.input_type == 'group' ){\r\n                                        // Get the field data\r\n                                        fieldObject = {\r\n                                            groupId:          groupKey,\r\n                                            optionCode:       field.option_code,\r\n                                            fieldType:        field.input_type,\r\n\r\n                                            isGroup:          hasMoreThanOneOption,\r\n                                            itemId:           item.ID,\r\n                                            itemType:         item.itemType,\r\n\r\n                                            label:            field.label,\r\n                                            description:      field.description,\r\n\r\n                                            tokenName:        isDefined( field.token_name ) ? field.token_name : field.label,\r\n\r\n                                            isRequired:       isDefined( field.required ) ? field.required : false,\r\n\r\n                                            fields: field.fields.map(( fieldData ) => {\r\n                                                return sanitizeFieldData( fieldData );\r\n                                            })\r\n                                        }\r\n\r\n                                        // Create field instance\r\n                                        fieldInstance = new FieldsGroup( fieldObject );\r\n                                    }\r\n                                    else if ( field.input_type == 'repeater' ){\r\n                                        // Try to parse the value of the repeater\r\n                                        try {\r\n                                            item.meta[ field.option_code ] = JSON.parse( item.meta[ field.option_code ] );\r\n                                        } catch ( e ){}\r\n\r\n                                        // Get field data\r\n                                        fieldObject = {\r\n                                            groupId:          groupKey,\r\n                                            optionCode:       field.option_code,\r\n                                            fieldType:        field.input_type,\r\n\r\n                                            isGroup:          hasMoreThanOneOption,\r\n                                            itemId:           item.ID,\r\n                                            itemType:         item.itemType,\r\n\r\n                                            label:            field.label,\r\n                                            description:      field.description,\r\n\r\n                                            tokenName:        isDefined( field.token_name ) ? field.token_name : field.label,\r\n\r\n                                            defaultValue:     field.default_value,\r\n                                            currentValue:     isDefined( item.meta[ field.option_code ] ) ? item.meta[ field.option_code ] : field.default_value,\r\n\r\n                                            isRequired:       isDefined( field.required ) ? field.required : false,\r\n\r\n                                            hideActions:       isDefined( field.hide_actions ) ? field.hide_actions : false,\r\n\r\n                                            fields: field.fields.map(( fieldData ) => {\r\n                                                return sanitizeFieldData( fieldData );\r\n                                            })\r\n                                        }\r\n\r\n                                        // Check if this one has a custom \"Add row\" label\r\n                                        if ( isDefined( field.add_row_button ) ){\r\n                                            fieldObject.addRowButtonLabel = field.add_row_button;\r\n                                        }\r\n\r\n                                        // Check if this one has a custom \"Remove row\" label\r\n                                        if ( isDefined( field.remove_row_button ) ){\r\n                                            fieldObject.removeRowButtonLabel = field.remove_row_button;\r\n                                        }\r\n\r\n                                        // Create field instance\r\n                                        fieldInstance = new FieldsRepeater( fieldObject );\r\n                                    }\r\n                                    // Otherwise, treat it as a normal field\r\n                                    else {\r\n                                        // Get the field data\r\n                                        fieldObject = sanitizeFieldData( field );\r\n\r\n                                        // Create the field instance\r\n                                        fieldInstance = new Field( fieldObject.fieldType, fieldObject, false );\r\n                                    }\r\n\r\n                                    // Add field to the group of fields\r\n                                    allFieldsOnThisGroup.push( fieldInstance );\r\n                                });\r\n\r\n                                // Array where we're going to save the buttons of this item\r\n                                let buttons = [];\r\n\r\n                                // Check if this group of options has buttons\r\n                                if ( isDefined( globalItem.buttons ) ){\r\n                                    // Iterate buttons\r\n                                    $.each( globalItem.buttons, ( index, button ) => {\r\n                                        // Check if we have to add the button to this group\r\n                                        if ( button.show_in == groupKey ){\r\n                                            buttons.push( button );\r\n                                        }\r\n                                    });\r\n                                }\r\n\r\n                                // Push fields to the groupsOfOptions object\r\n                                groupsOfOptions[ groupKey ] = {\r\n                                    fields:  allFieldsOnThisGroup,\r\n                                    isValid: false, // FALSE by default, but we're going to do a validation later\r\n                                    buttons: buttons\r\n                                }\r\n                            });\r\n\r\n                            // Create object with the item data\r\n                            itemToAdd = {\r\n                                id:              item.ID,\r\n                                itemType:        item.itemType,\r\n                                itemCode:        itemCode,\r\n                                integrationCode: globalItem.integration,\r\n                                isLive:          item.post_status == 'publish' ? true : false,\r\n                                options:         groupsOfOptions,\r\n                                meta:            item.meta,\r\n                                isMissing:       false,\r\n                                tokens:          isDefined( item.tokens ) ? item.tokens : [],\r\n                                inlineCss:       isDefined( globalItem.inline_css ) ? globalItem.inline_css : '',\r\n                                filterTokens:    isDefined( globalItem.filter_tokens ) ? globalItem.filter_tokens : '',\r\n                            }\r\n\r\n                            // Check if the support link is defined\r\n                            if ( isDefined( globalItem.support ) ){\r\n                                itemToAdd.support = globalItem.support;\r\n                            }\r\n\r\n                            // Create meta for those field that don't have a value saved in the database but have a default value\r\n\r\n                            // Get all fields\r\n                            let fields = {};\r\n\r\n                            // Create an object with all the options from the field\r\n                            $.each( groupsOfOptions, function( optionKey, options ){\r\n                                $.each( options.fields, function( index, field ){\r\n                                    fields[ field.getAttributes().optionCode ] = field;\r\n                                });\r\n                            });\r\n\r\n                            $.each( fields, ( index, field ) => {\r\n                                let fieldAttributes = field.getAttributes();\r\n                                if ( ( ! isDefined( itemToAdd.meta[ fieldAttributes.optionCode ] ) || isEmpty( itemToAdd.meta[ fieldAttributes.optionCode ] ) ) && ! isEmpty( fieldAttributes.currentValue ) ){\r\n                                    itemToAdd.meta[ fieldAttributes.optionCode ] = fieldAttributes.currentValue;\r\n                                }\r\n                            });\r\n\r\n                            // If it's anonymous, add the \"canLogUserIn\" property\r\n                            // Also set the default value\r\n                            if ( recipeIsAnonymous ){\r\n                                itemToAdd.canLogNewUserIn = isDefined( globalItem.can_log_in_new_user ) ? globalItem.can_log_in_new_user : true;\r\n                            }\r\n\r\n                            /*\r\n\r\n                            // Create readable meta\r\n                            itemToAdd.metaReadable = jQuery.extend( true, {}, itemToAdd.meta );\r\n\r\n                            // Iterate each meta and search for a readable value\r\n                            $.each( itemToAdd.metaReadable, ( metaKey, metaValue ) => {\r\n                                let field = fields[ metaKey ];\r\n\r\n                                // Check if there is a field with that ID\r\n                                if ( isDefined( field ) ){\r\n                                    field = field.getAttributes();\r\n\r\n                                    // Check if it's a select\r\n                                    if ( field.fieldType == 'select' ){\r\n                                        let value;\r\n\r\n                                        // Iterate each option of the select and search for the text instead of the value\r\n                                        $.each( field.options, function( index, selectOption ){\r\n                                            // Compare the value with the metaValue\r\n                                            if ( selectOption.value == metaValue ){\r\n                                                // Set new metaValue\r\n                                                itemToAdd.metaReadable[ metaKey ] = selectOption.text;\r\n                                            }\r\n                                        });\r\n                                    }\r\n                                }\r\n                            });\r\n\r\n                            // Check if we have to add default values\r\n                            $.each( fields, function( index, field ){\r\n                                if ( ! isDefined( itemToAdd.metaReadable[ field.optionCode ] ) && ! isEmpty( field.defaultValue ) ){\r\n                                    if ( field.fieldType == 'select' ){\r\n\r\n                                        // Iterate each option of the select and search for the text instead of the value\r\n                                        $.each( field.options, function( index, selectOption ){\r\n                                            // Compare the value with the metaValue\r\n                                            if ( selectOption.value == metaValue ){\r\n                                                // Set new metaValue\r\n                                                itemToAdd.metaReadable[ field.optionCode ] = selectOption.text;\r\n                                            }\r\n                                        });\r\n                                    }\r\n                                    else {\r\n                                        itemToAdd.metaReadable[ field.optionCode ] = field.defaultValue;\r\n                                    }\r\n                                }\r\n                            });\r\n\r\n                            */\r\n                        }\r\n                        else {\r\n                            // Create object with the item data\r\n                            itemToAdd = {\r\n                                id:              item.ID,\r\n                                itemType:        item.itemType,\r\n                                itemCode:        item.meta.code,\r\n                                integrationCode: item.meta.integration,\r\n                                integrationName: item.meta.integration_name,\r\n                                sentence:        item.meta.sentence,\r\n                                isLive:          item.post_status == 'publish' ? true : false,\r\n                                tokens:          [],\r\n                                options:         {},\r\n                                meta:            item.meta,\r\n                                isMissing:       true,\r\n                            }\r\n\r\n                            // If it's anonymous, add the \"canLogUserIn\" property\r\n                            // Also set the default value\r\n                            if ( recipeIsAnonymous ){\r\n                                itemToAdd.canLogNewUserIn = isDefined( item.meta.can_log_in_new_user ) ? ( item.meta.can_log_in_new_user == 'true' ) : true;\r\n                            }\r\n                        }\r\n\r\n                        // We have to add it\r\n                        itemsObject( 'add', itemToAdd );\r\n                    });\r\n\r\n                    // Check if the recipe is anonymous and can log the new user in\r\n                    if ( recipeIsAnonymous ){\r\n                        // Set the default value\r\n                        UncannyAutomator.recipe.canLogNewUserIn = false;\r\n\r\n                        // Get the recipe items\r\n                        const recipeTriggers = itemsObject( 'get', {\r\n                            filter: {\r\n                                itemType: 'trigger'\r\n                            }\r\n                        });\r\n\r\n                        // Check if it has items\r\n                        if ( Object.keys( recipeTriggers ) > 0 ){\r\n                            // Change the default value\r\n                            UncannyAutomator.recipe.canLogNewUserIn = true;\r\n\r\n                            // Iterate the triggers\r\n                            $.each( recipeTriggers, ( index, trigger ) => {\r\n                                // Check if this trigger allows the recipe\r\n                                // to log the new user in\r\n                                UncannyAutomator.recipe.canLogNewUserIn = UncannyAutomator.recipe.canLogNewUserIn && trigger.canLogNewUserIn;\r\n                            });\r\n                        }\r\n                    }\r\n\r\n\t\t\t\t\t// Check if we should validate the data\r\n\t\t\t\t\tif ( ! isDefined( attributes.validate ) || ( isDefined( attributes.validate ) && attributes.validate ) ){\r\n\t\t\t\t\t\t// Validate the recipe to update the isValid elements\r\n                    \trecipeObject( 'validate' );\r\n\t\t\t\t\t}\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'recipeObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'validate':\r\n                // Valid by default, will be changed to false if we find an error\r\n                let isRecipeValid = true;\r\n\r\n                // Check if the recipe has triggers, actions and/or closures\r\n                // Update UncannyAutomator.recipe.hasLive\r\n                $.each( UncannyAutomator.recipe.hasLive, function( itemType, has ){\r\n                    // All false\r\n                    UncannyAutomator.recipe.hasLive[ itemType ] = false;\r\n                });\r\n\r\n                // Check if there is at least one item of that type in the main object\r\n                $.each( UncannyAutomator.recipe.items, function( itemID, itemData ){\r\n                    // If at least one live item, then set TRUE\r\n                    if ( itemData.isLive ){\r\n                        UncannyAutomator.recipe.hasLive[ itemData.itemType ] = true;\r\n                    }\r\n                });\r\n\r\n                // Iterate each item\r\n                $.each( UncannyAutomator.recipe.items, function( itemID, itemData ){\r\n\r\n                    // We will use this variable to decide if the item is valid or not\r\n                    let itemIsValid = true;\r\n\r\n                    // Iterate each group of fields\r\n                    $.each( itemData.options, function( optionsGroupID, optionsGroupData ){\r\n\r\n                        // We will use this variable to decide if the group of fields is valid or not\r\n                        let groupIsValid = true;\r\n\r\n                        // Iterate each field\r\n                        $.each( optionsGroupData.fields, function( index, field ){\r\n                            // Validate the field. Read validateField comments to learn more.\r\n                            let fieldValidation = field.validate( false );\r\n\r\n                            // Check if the option is invalid, if at least one field is invalid make all the group invalid\r\n                            if ( ! fieldValidation.isValid ){\r\n                                groupIsValid = false;\r\n                            }\r\n                        });\r\n\r\n                        // Set result\r\n                        UncannyAutomator.recipe.items[ itemID ].options[ optionsGroupID ].isValid = groupIsValid;\r\n\r\n                        // Check if the group is invalid, if at least on group of fields is invalid make all the item invalid\r\n                        if ( ! groupIsValid ){\r\n                            itemIsValid = false;\r\n                        }\r\n                    });\r\n\r\n                    UncannyAutomator.recipe.items[ itemID ].isValid = itemIsValid;\r\n\r\n                    // Check if the item is invalid. If at least one item is invalid make all the recipe invalid\r\n                    if ( itemData.isLive && ! itemIsValid ){\r\n                        isRecipeValid = false;\r\n                    }\r\n                });\r\n\r\n                // Now check what items we have in the object\r\n                // We must have at least one trigger and an action or closure\r\n                // Check if it has at least one trigger\r\n                if ( ! UncannyAutomator.recipe.hasLive.trigger ){\r\n                    isRecipeValid = false;\r\n\r\n                    // Set error message\r\n                    UncannyAutomator.recipe.message.error = UncannyAutomator.i18n.validation.recipe.oneTrigger;\r\n                }\r\n                else {\r\n                    // Validate user selector\r\n                    if ( UncannyAutomator.recipe.type == 'anonymous' && ! UncannyAutomator.recipe.userSelector.isValid ){\r\n                        // Then the recipe is not valid\r\n                        isRecipeValid = false;\r\n\r\n                        // Add message\r\n                        UncannyAutomator.recipe.message.error = UncannyAutomator.i18n.validation.recipe.userSelector;\r\n                    }\r\n                    else {\r\n                        // Check if it has at least one action or closure\r\n                        if ( ! UncannyAutomator.recipe.hasLive.action && ! UncannyAutomator.recipe.hasLive.closure ){\r\n                            isRecipeValid = false;\r\n\r\n                            // Set error message\r\n                            UncannyAutomator.recipe.message.error = UncannyAutomator.i18n.validation.recipe.oneAction;\r\n                        }\r\n                        else {\r\n                            // Check if the message has to be more generic\r\n                            if ( ! UncannyAutomator.recipe.hasLive.trigger && ( ! UncannyAutomator.recipe.hasLive.action && ! UncannyAutomator.recipe.hasLive.closure ) ){\r\n                                // Set error message\r\n                                UncannyAutomator.recipe.message.error = UncannyAutomator.i18n.validation.recipe.liveItems;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                UncannyAutomator.recipe.isValid = isRecipeValid;\r\n\r\n                // Reset message if recipe is valid\r\n                if ( isRecipeValid ){\r\n                    // Reset message, we don't need it\r\n                    UncannyAutomator.recipe.message.error = '';\r\n                }\r\n\r\n                // Everything is ok, return true\r\n                response = true;\r\n\r\n                break;\r\n        }\r\n    }\r\n    else {\r\n        // Has to add error code\r\n        console.error( vsprintf( '%s: The action \"%s\" isn\\'t defined', [ 'recipeObject', action ] ) );\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Add, update, delete, update, validate and clean the main recipe object\r\n *\r\n * @since 0.2\r\n *\r\n * @param {string}   action - Action to perform. Valid actions: 'add', 'update', 'delete', 'reset', 'get', and 'clean'.\r\n * @param {object}   attributes\r\n * The required properties depend of the requested action.\r\n * For the 'update' action it have to include the properties that need to be updated in the items object.\r\n * For the 'add' action:\r\n * @param {int}      attributes.id        Item ID\r\n * @param {string}   attributes.itemType  The item type. The valid types are 'trigger', 'action' and 'closure'\r\n *\r\n * @return {boolean} TRUE if the action was made successfully\r\n */\r\n\r\nexport function itemsObject( action = null, attributes = {} ){\r\n    // Create response variable and set default value\r\n    let response     = false;\r\n\r\n    // Define valid actions\r\n    let validActions = [ 'add', 'delete', 'clean', 'reset', 'update', 'get' ];\r\n\r\n    // Check if the action is not undefined and if it's a valid action\r\n    if ( isDefined( action ) && inArray( action, validActions ) ){\r\n\r\n        switch ( action ){\r\n            case 'add':\r\n                // Extend default attributes object with default values\r\n                attributes = $.extend({\r\n                    isValid: false, // Because it's going to be empty\r\n                    isLive: false, // Draft by default\r\n                }, attributes );\r\n\r\n                // Define required attributes properties\r\n                let requiredData = [ 'id', 'itemType' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n\r\n                    // Has ID, check if it wasn't added\r\n                    if ( ! isDefined( UncannyAutomator.recipe.items[ attributes.id ] ) ){\r\n\r\n                        // Create property\r\n                        UncannyAutomator.recipe.items[ attributes.id ] = attributes;\r\n\r\n                        // Clean undefined properties\r\n                        itemsObject( 'clean', {} );\r\n\r\n                        // Everything is ok, return true\r\n                        response = true;\r\n                    }\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'itemsObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'delete':\r\n                attributes = $.extend({\r\n                    isValid: false,\r\n                }, attributes );\r\n\r\n                if ( ! isEmpty( attributes.id ) ){\r\n\r\n                    if ( isDefined( UncannyAutomator.recipe.items[ attributes.id ] ) ){\r\n                        delete UncannyAutomator.recipe.items[ attributes.id ];\r\n\r\n                        // Everything is ok, return true\r\n                        response = true;\r\n                    }\r\n                    else {\r\n                        console.error( vsprintf( '%s: We didn\\'t find an item with this the ID %s', [ 'itemsObject', attributes.id ] ) );\r\n                    }\r\n\r\n                }\r\n                else {\r\n                    console.error( vsprintf( '%s: Invalid item ID', [ 'itemsObject' ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'clean':\r\n                // Delete undefined and null properties\r\n\r\n                let items = {};\r\n\r\n                $.each( UncannyAutomator.recipe.items, function( index, value ){\r\n                    if ( isDefined( value ) ){\r\n                        items[ index ] = value;\r\n                    }\r\n                });\r\n\r\n                UncannyAutomator.recipe.items = items;\r\n\r\n                // Everything is ok, return true\r\n                response = true;\r\n\r\n                break;\r\n\r\n            case 'update':\r\n                // Update item attributes\r\n\r\n                if ( ! isEmpty( attributes.id ) ){\r\n\r\n                    if ( isDefined( UncannyAutomator.recipe.items[ attributes.id ] ) ){\r\n\r\n                        // Extend item object properties with new ones\r\n                        UncannyAutomator.recipe.items[ attributes.id ] = $.extend( {}, UncannyAutomator.recipe.items[ attributes.id ], attributes );\r\n\r\n                        // Everything is ok, return true\r\n                        response = true;\r\n\r\n                    }\r\n                    else {\r\n                        console.error( vsprintf( '%s: We didn\\'t find an item with this the ID %s', [ 'itemsObject', attributes.id ] ) );\r\n                    }\r\n\r\n                }\r\n                else {\r\n                    console.error( vsprintf( '%s: Invalid item ID', [ 'itemsObject' ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'reset':\r\n                // Delete all the items in the items object\r\n                UncannyAutomator.recipe.items = {}\r\n\r\n                // Return true\r\n                response = true;\r\n                break;\r\n\r\n            case 'get':\r\n                // Check if we have to filter items\r\n                if ( ! isEmpty( attributes.filter ) ){\r\n                    // Create a new items object. We're going to add items to this one if the filters match\r\n                    let items = {}\r\n                    // Iterate all current items\r\n                    $.each( UncannyAutomator.recipe.items, function( itemId, item ){\r\n                        let matchFilters = true;\r\n\r\n                        $.each( attributes.filter, function( key, value ){\r\n                            if ( item[ key ] != value ){\r\n                                matchFilters = false;\r\n                            }\r\n                        });\r\n\r\n                        // Check if we have to add this item\r\n                        if ( matchFilters ){\r\n                            items[ itemId ] = item;\r\n                        }\r\n                    });\r\n\r\n                    // Return the new items object\r\n                    response = items;\r\n                }\r\n                else {\r\n                    response = UncannyAutomator.recipe.items;\r\n                }\r\n\r\n                break;\r\n        }\r\n    }\r\n    else {\r\n        // Has to add error code\r\n        console.error( vsprintf( '%s: The action \"%s\" isn\\'t defined', [ 'itemsObject', action ] ) );\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Add the triggers and actions to each integration.\r\n * Change the data structure so it's possible to know\r\n * what items and integrations are pro\r\n *\r\n * @since 2.1.4\r\n */\r\nexport function groupItemsByIntegration(){\r\n    // Iterate the integrations\r\n    Object.entries( UncannyAutomator.integrations ).forEach(([ integrationID, integration ]) => {\r\n        // Get the list of available triggers and actions\r\n        // Sort them alphabetically\r\n        let triggers = {\r\n                available:   sortArrayOfObjectsAlphabetically( UncannyAutomator.triggers.filter( item => item.integration == integrationID ), 'select_option_name', sentence => replaceCurlyBraces( sentence ) ),\r\n                unavailable: [],\r\n            },\r\n            actions  = {\r\n                available:   sortArrayOfObjectsAlphabetically( UncannyAutomator.actions.filter( item => item.integration == integrationID ), 'select_option_name', sentence => replaceCurlyBraces( sentence ) ),\r\n                unavailable: []\r\n            };\r\n\r\n        if ( ! isDefined( UncannyAutomator.wp ) || ! UncannyAutomator.wp ){\r\n            // Check if there are PRO items for this integration\r\n            if (\r\n                isDefined( UncannyAutomator.proFeatures ) &&\r\n                isDefined( UncannyAutomator.proFeatures[ integrationID ] )\r\n            ){\r\n                // Push the pro logged-in triggers to the unavailable triggers array\r\n                // Sort them alphabetically\r\n                triggers.unavailable = sortArrayOfObjectsAlphabetically( UncannyAutomator.proFeatures[ integrationID ].triggers.filter( trigger => trigger.type == 'logged-in' ), 'name', sentence => replaceCurlyBraces( sentence ) );\r\n\r\n                // Push the pro actions to the unavailable actions array\r\n                // Sort them alphabetically\r\n                actions.unavailable  = sortArrayOfObjectsAlphabetically( UncannyAutomator.proFeatures[ integrationID ].actions, 'name', sentence => replaceCurlyBraces( sentence ) );\r\n            }\r\n        }\r\n\r\n        // Evaluate if all the available items are pro\r\n        // To do that, iterate every element using the method every\r\n        // and return the value of \"is_pro\"\r\n        triggers.allItemsArePro     = triggers.available.every( item => isDefined( item.is_pro ) ? item.is_pro : false );\r\n        actions.allItemsArePro      = actions.available.every( item => isDefined( item.is_pro ) ? item.is_pro : false );\r\n\r\n        // Check if the integration has available triggers and actions\r\n        triggers.hasAvailableItems  = triggers.available.length > 0;\r\n        actions.hasAvailableItems   = actions.available.length > 0;\r\n\r\n        // Check if the integration has unavailable triggers and actions\r\n        triggers.hasUnavailableItems = triggers.unavailable.length > 0;\r\n        actions.hasUnavailableItems  = actions.unavailable.length > 0;\r\n\r\n        // Check if it has any kind of items\r\n        triggers.hasTriggers = triggers.hasAvailableItems || triggers.unavailable.length > 0;\r\n        actions.hasActions   = actions.hasAvailableItems || actions.unavailable.length > 0;\r\n\r\n        // Add the items to the integration\r\n        UncannyAutomator.integrations[ integrationID ].items = {\r\n            triggers: triggers,\r\n            actions:  actions\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Sort an array of objects using one of the properties\r\n *\r\n * @since  2.1.4\r\n * @param  {Array}  items             The array\r\n * @param  {String} propertyToCompare The property used to compare the elements\r\n * @return {Array}                    The array, sorted\r\n */\r\nexport function sortArrayOfObjectsAlphabetically( items = [], propertyToCompare = '', filter ){\r\n    // Check if there isn't a filter defined\r\n    if ( ! isDefined( filter ) ){\r\n        filter = value => value;\r\n    }\r\n\r\n    // Check if it's an array and it's not empty\r\n    if ( Array.isArray( items ) && ! isEmpty( items ) ){\r\n        // Sort the array of integrations using the integration name\r\n        items = items.sort(( a, b ) => {\r\n            // Define the default value\r\n            let compare = 0;\r\n\r\n            // Check if the elements have the properties we're going to use to compare\r\n            if ( isDefined( a[ propertyToCompare ] ) && isDefined( b[ propertyToCompare ] ) ){\r\n                // Filter the values\r\n                let valueA = filter( a[ propertyToCompare ] ),\r\n                    valueB = filter( b[ propertyToCompare ] );\r\n\r\n                // Check which integration name should go first\r\n                compare = valueA.localeCompare( valueB );\r\n\r\n                // Validate the value\r\n                // Do NOT rely on exact return values of -1 or 1\r\n                // Negative and positive integer results vary between browsers (as well as between browser versions) because the W3C specification only mandates negative and positive values. Some browsers may return -2 or 2, or even some other negative or positive value.\r\n                compare = compare > 0 ? 1 : compare;\r\n                compare = compare < 0 ? -1 : compare;\r\n            }\r\n\r\n            // Return result\r\n            return compare;\r\n        });\r\n    }\r\n\r\n    // Return the new array\r\n    return items;\r\n}\r\n\r\n/**\r\n * Get a list of triggers or actions by integration\r\n * @param  {String} integrationID The integration ID\r\n * @param  {String} itemType      The item type. Valid values: \"trigger\", \"triggers\", \"action\" and \"actions\"\r\n * @return {Object}               And object with the available and unavailable items\r\n *\r\n * @since 2.1.4\r\n */\r\nexport function getItemsByIntegration( integrationID = '', itemType = 'triggers', options ){\r\n    // Extend the options\r\n    options = Object.assign({\r\n        addDeprecatedItems: false\r\n    }, options );\r\n\r\n    // Create the array where we're going to save the items\r\n    let items = {\r\n        available: {},\r\n        unavailable: {}\r\n    };\r\n\r\n    // Convert itemType \"trigger\" to \"triggers\"\r\n    itemType = itemType == 'trigger' ? 'triggers' : itemType;\r\n    // Convert itemType \"action\" to \"actions\"\r\n    itemType = itemType == 'action' ? 'actions' : itemType;\r\n\r\n    // Validate the parameter itemType\r\n    if ( [ 'triggers', 'actions' ].includes( itemType ) ){\r\n        // Check if the integration ID is defined\r\n        if ( ! isEmpty( integrationID ) ){\r\n            // Check if the integration exists\r\n            if ( isDefined( UncannyAutomator.integrations[ integrationID ] ) ){\r\n                // Get the requested items\r\n                items = $.extend( true, {}, UncannyAutomator.integrations[ integrationID ].items[ itemType ] );\r\n\r\n                // Check if we have to remove the deprecated items\r\n                if ( ! options.addDeprecatedItems ){\r\n                    // Remove deprecated items\r\n                    items = filterDeprecatedItems( items );\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Return the triggers\r\n    return items;\r\n}\r\n\r\n/**\r\n * Removes deprecated items from an items object\r\n *\r\n * @param  Object   items  Items object\r\n * @return Object          Items object, without deprecated items\r\n */\r\nexport function filterDeprecatedItems( items ){\r\n    // Remove deprecated items\r\n    items.available = items.available.filter( item => ! item.is_deprecated );\r\n\r\n    // Check if there are still available items\r\n    items.hasAvailableItems = items.available.length > 0;\r\n\r\n    // Check if it still has triggers or actions\r\n    if ( isDefined( items.hasTriggers ) ){\r\n        items.hasTriggers = items.hasAvailableItems || items.unavailable.length > 0;\r\n    }\r\n    else if ( isDefined( items.hasActions ) ){\r\n        items.hasActions  = items.hasAvailableItems || items.unavailable.length > 0;\r\n    }\r\n\r\n    // Check if all the available items are pro now\r\n    items.allItemsArePro = items.available.every( item => isDefined( item.is_pro ) ? item.is_pro : false );\r\n\r\n    return items;\r\n}\r\n\r\n/**\r\n * Update user selector data\r\n *\r\n * @since  2.0\r\n */\r\n\r\nexport function userSelectorObject( action = null, attributes = {} ){\r\n    // Create response variable and set default value\r\n    let response     = false;\r\n\r\n    // Define valid actions\r\n    let validActions = [ 'set-step', 'get-step', 'set-source', 'update-fields', 'reset-fields' ];\r\n\r\n    // Create shortcut of the user selector object\r\n    const userSelector = UncannyAutomator.recipe.userSelector;\r\n\r\n    // Check if the action is not undefined and if it's a valid action\r\n    if ( isDefined( action ) && inArray( action, validActions ) ){\r\n        // Create empty array to check if the actions have the required data\r\n        let requiredData = [];\r\n\r\n        switch ( action ){\r\n            /**\r\n             * Get the current step so we know what we have to render\r\n             * There are 4 steps:\r\n             *\r\n             * 1. select-source: Where the recipe creator select the source of the user.\r\n             *                   The options are \"Existing user\" and \"New user\".\r\n             * 2. set-options: Where the recipe creator defines values of the fields.\r\n             * 3. show-sentence: When the data is complete and valid.\r\n             */\r\n\r\n            case 'set-step':\r\n                // Define required attributes properties\r\n                requiredData = [ 'step' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Set status\r\n                    UncannyAutomator.recipe.userSelector.step = attributes.step;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'userSelectorObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'get-step':\r\n                // Create the variable we're going to return\r\n                // Set default value\r\n                let step = 'select-source';\r\n\r\n                // Check if the step property is defined\r\n                if ( isDefined( UncannyAutomator.recipe.userSelector.step ) ){\r\n                    // If it is, then return that value\r\n                    step = UncannyAutomator.recipe.userSelector.step;\r\n                }\r\n                else {\r\n                    // Try to get step\r\n                    // Check if there are fields saved\r\n                    if ( ! isEmpty( UncannyAutomator.recipe.userSelector.fields[ UncannyAutomator.recipe.userSelector.source ] ) ){\r\n                        // Show sentence\r\n                        step = 'show-sentence';\r\n\r\n                        // If we have fields it's because we already valid them before,\r\n                        // thus the user selector is valid\r\n                        UncannyAutomator.recipe.userSelector.isValid = true;\r\n                    }\r\n                }\r\n\r\n                // Return step\r\n                response = step;\r\n\r\n                break;\r\n\r\n            case 'set-source':\r\n                // Define required attributes properties\r\n                requiredData = [ 'source' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Set status\r\n                    UncannyAutomator.recipe.userSelector.source = attributes.source;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'userSelectorObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'update-fields':\r\n                // Define required attributes properties\r\n                requiredData = [ 'source', 'fields' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Check if the source parameter is valid\r\n                    if ( [ 'existingUser', 'newUser' ].includes( attributes.source ) ){\r\n                        // Check if we already have fields\r\n                        if ( isEmpty( UncannyAutomator.recipe.userSelector.fields ) ){\r\n                            UncannyAutomator.recipe.userSelector.fields = {\r\n                                existingUser: {},\r\n                                newUser: {}\r\n                            }\r\n                        }\r\n\r\n                        // Update fields\r\n                        UncannyAutomator.recipe.userSelector.fields[ attributes.source ] = $.extend( {}, UncannyAutomator.recipe.userSelector.fields[ attributes.source ], attributes.fields );\r\n                    }\r\n                    else {\r\n                        // Show to the developer what's wrong\r\n                        console.error( vsprintf( '%s: The source parameter is invalid. Valid values are: %s', [ 'userSelectorObject', [ 'existingUser', 'newUser' ] ] ) );\r\n                    }\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'userSelectorObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'reset-fields':\r\n                // Return boolean\r\n                UncannyAutomator.recipe.userSelector.fields = {\r\n                    existingUser: {},\r\n                    newUser: {}\r\n                }\r\n                break;\r\n        }\r\n    }\r\n    else {\r\n        // Has to add error code\r\n        console.error( vsprintf( '%s: The action \"%s\" isn\\'t defined', [ 'userSelectorObject', action ] ) );\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Filter triggers, actions and closures by recipe type.\r\n * This won't filter the items of a recipe, but the available\r\n * items in Automator\r\n *\r\n * @since 2.0\r\n *\r\n * @return null\r\n */\r\n\r\nexport function filterAutomatorItemsByRecipeType(){\r\n    // Check if the type attribute has a valid value\r\n    if ( [ 'user', 'anonymous' ].includes( UncannyAutomator.recipe.type ) ){\r\n        // Check if debug mode is enabled\r\n        if ( UncannyAutomator.dev.debugMode ){\r\n            // Start group\r\n            consoleLogLabel( 'Filter Automator items', true, {\r\n                collapseGroup: true\r\n            });\r\n\r\n            // Show current recipe type\r\n            console.log( vsprintf( 'Current recipe type: %s', [ UncannyAutomator.recipe.type ] ) );\r\n        }\r\n\r\n        // Filter triggers\r\n        UncannyAutomator.triggers = UncannyAutomator.triggers.filter(( trigger ) => {\r\n            // Check if debug mode is enabled\r\n            if ( UncannyAutomator.dev.debugMode ){\r\n                // Show trigger\r\n                console.log( trigger );\r\n\r\n                // Show decision\r\n                if ( trigger.type == UncannyAutomator.recipe.type ){\r\n                    consoleLogResult( 'success', 'Keep' );\r\n                }\r\n                else {\r\n                    consoleLogResult( 'error', 'Remove' );\r\n                }\r\n            }\r\n\r\n            // Check if it matches the recipe type\r\n            return trigger.type == UncannyAutomator.recipe.type;\r\n        });\r\n\r\n        // Check if debug mode is enabled\r\n        if ( UncannyAutomator.dev.debugMode ){\r\n            // Start group\r\n            console.groupEnd();\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Performs a REST Call\r\n *\r\n * @since     0.1\r\n * @modified  0.5\r\n *\r\n * @param {string}    endPoint - Endpoint of the REST call\r\n * @param {object}    data - Data to be sent in the call\r\n * @param {callback}  [onSuccess] - Function to be invoked if the call is successful\r\n * @param {callback}  [onFail] - Function to be invoked if the call fails\r\n *\r\n * @return null\r\n */\r\n\r\nexport function restCall( endPoint = null, data = null, onSuccess = null, onFail = null, options = {} ){\r\n    // Define the valid endpoints\r\n    let validEndpoints = [ 'add', 'delete', 'update', 'change_post_status', 'recipe_completions_allowed', 'recipe_max_completions_allowed', 'change_post_title', 'change_post_recipe_type', 'user-selector', 'set_recipe_terms', 'schedule_action', 'remove_schedule' ];\r\n\r\n    // Check custom options\r\n    options = $.extend({}, {\r\n        'requiresRecipesObject': true,\r\n        'renderUI':              true\r\n    }, options );\r\n\r\n    // Check if the endPoint parameter is a valid endpoint\r\n    if ( inArray( endPoint, validEndpoints ) ){\r\n\r\n        // Do AJAX\r\n        $.ajax({\r\n            method:   'POST',\r\n            url:      `${ UncannyAutomator.restURL }/${endPoint}/`,\r\n            data:     $.param( data ) + '&' + $.param({ doing_rest: 1 }),\r\n            dataType: 'json',\r\n\r\n            // Attach Nonce the the header of the request\r\n            beforeSend: function( xhr ){\r\n                xhr.setRequestHeader( 'X-WP-Nonce', UncannyAutomator.nonce );\r\n            },\r\n\r\n            success: function( response ){\r\n                // Show console messages if debug is enabled\r\n                if ( UncannyAutomator.dev.debugMode ){\r\n                    consoleLogLabel( 'REST call ✅', true, {\r\n                        collapseGroup: true\r\n                    });\r\n                    console.log( `Endpoint: ${ endPoint }` );\r\n                    console.log( 'Data:' );\r\n                    console.log( data );\r\n                    console.log( 'Response:' );\r\n                    console.log( response );\r\n                    console.groupEnd();\r\n                }\r\n\r\n                // Check if the request succeeded\r\n                if ( response.success ){\r\n                    // Check if we have the new recipes_object, otherwise the data will change on the server but not in the UI\r\n                    if ( isDefined( response.recipes_object ) || ! options.requiresRecipesObject ){\r\n                        // Check if onSuccess\r\n                        if ( isDefined( onSuccess ) ){\r\n                            // Check if we have to render the UI again\r\n                            if ( options.renderUI ){\r\n                                recipeObject( 'create', {\r\n                                    allRecipes: response.recipes_object\r\n                                });\r\n                            }\r\n\r\n                            // Invoke callback\r\n                            onSuccess( response );\r\n                        }\r\n                    }\r\n                    else {\r\n                        // The call was successful, but the new recipes_object is missing\r\n                        console.error( 'The call was successful, but the new recipes_object is missing.' );\r\n\r\n                        // Check if the onFail callback is defined\r\n                        if ( isDefined( onFail ) ){\r\n                            // Invoke callback\r\n                            onFail( response );\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    // The call was successful, but there were errors,\r\n                    console.error( 'The call was successful, but there were errors.' );\r\n                    // console.log( response );\r\n\r\n                    // Check if the onFail callback is defined\r\n                    if ( isDefined( onFail ) ){\r\n                        // Invoke callback\r\n                        onFail( response );\r\n                    }\r\n                }\r\n            },\r\n\r\n            statusCode: {\r\n                403: function( response ){\r\n                    // Show console messages if debug is enabled\r\n                    if ( UncannyAutomator.dev.debugMode ){\r\n                        consoleLogLabel( 'REST call 🔴', true, {\r\n                            collapseGroup: true\r\n                        });\r\n                        console.log( 'Data:' );\r\n                        console.log( data );\r\n                        console.log( 'Response' );\r\n                        console.log( '%c403: Access denied', 'color: red' );\r\n                        console.groupEnd();\r\n                    }\r\n\r\n                    if ( isDefined( onFail ) ){\r\n                        onFail( response );\r\n                    }\r\n                }\r\n            },\r\n\r\n            error: function( jqXHR, textStatus, errorThrown ){\r\n                // Show console messages if debug is enabled\r\n                if ( UncannyAutomator.dev.debugMode ){\r\n                    consoleLogLabel( 'REST call 🔴', true, {\r\n                        collapseGroup: true\r\n                    });\r\n                    console.log( 'Data:' );\r\n                    console.log( data );\r\n                    console.log( 'Response' );\r\n                    console.log( '%cUnknown error', 'color: red' );\r\n                    console.groupEnd();\r\n                }\r\n\r\n                if ( isDefined( onFail ) ){\r\n                    onFail({\r\n                        success: false,\r\n                    });\r\n                }\r\n            },\r\n\r\n            fail: function ( response ){\r\n                // Show console messages if debug is enabled\r\n                if ( UncannyAutomator.dev.debugMode ){\r\n                    consoleLogLabel( 'REST call 🔴', true, {\r\n                        collapseGroup: true\r\n                    });\r\n                    console.log( 'Data:' );\r\n                    console.log( data );\r\n                    console.log( 'Response' );\r\n                    console.log( '%cUnknown error', 'color: red' );\r\n                    console.groupEnd();\r\n                }\r\n\r\n                if ( isDefined( onFail ) ){\r\n                    onFail( response );\r\n                }\r\n            },\r\n        });\r\n    }\r\n    else {\r\n        console.error( vsprintf( 'The %s endPoint does not exists. The valid endpoints are %s', [ endPoint, validEndpoints.join( ', ' ) ] ) );\r\n    }\r\n}\r\n\r\n/**\r\n * Performs an AJAX request\r\n *\r\n * @since 0.5\r\n *\r\n * @param {object}    data - Data to be sent in the request\r\n * @param {callback}  [onSuccess] - Function to be invoked if the request is successful\r\n * @param {callback}  [onFail] - Function to be invoked if the request fails\r\n *\r\n * @return null\r\n */\r\n\r\nexport function AJAXRequest( action = null, data = null, onSuccess = null, onFail = null ){\r\n\r\n    // Check that {action} is defined\r\n    if ( isDefined( action ) ){\r\n        // Add {action} to the data object\r\n        data = $.extend( true, data, {\r\n            action: action,\r\n            nonce: UncannyAutomator.nonce\r\n        });\r\n\r\n        // Do AJAX\r\n        $.ajax({\r\n            method:   'POST',\r\n            dataType: 'json',\r\n            url:      ajaxurl,\r\n            data:     data,\r\n\r\n            success: function( response  ){\r\n                // Show console messages if debug is enabled\r\n                if ( UncannyAutomator.dev.debugMode ){\r\n                    consoleLogLabel( 'AJAX call ✅', true, {\r\n                        collapseGroup: true\r\n                    });\r\n                    console.log( 'Data:' );\r\n                    console.log( data );\r\n                    console.log( 'Response' );\r\n                    console.log( response );\r\n                    console.groupEnd();\r\n                }\r\n\r\n                // Reload page if user authentication fails\r\n                if ( isDefined( response.status ) && response.status == 'auth-failed' ){\r\n                    location.reload();\r\n                }\r\n                else {\r\n                    // Check if onSuccess is defined\r\n                    if ( isDefined( onSuccess ) ){\r\n                        // Invoke callback\r\n                        onSuccess( response, data );\r\n                    }\r\n                }\r\n            },\r\n\r\n            statusCode: {\r\n                403: function(){\r\n                    // Show console messages if debug is enabled\r\n                    if ( UncannyAutomator.dev.debugMode ){\r\n                        consoleLogLabel( 'AJAX call 🔴', true, {\r\n                            collapseGroup: true\r\n                        });\r\n                        console.log( 'Data:' );\r\n                        console.log( data );\r\n                        console.log( 'Response' );\r\n                        consoleLogLabel( '403: Access denied', false, { bgColor: '#ff0000' });\r\n                        console.groupEnd();\r\n                    }\r\n\r\n                    if ( isDefined( onFail ) ){\r\n                        onFail( response );\r\n                    }\r\n\r\n                    // Check if the onFail callback is defined\r\n                    if ( isDefined( onFail ) ){\r\n                        // Invoke callback\r\n                        onFail( response );\r\n                    }\r\n                }\r\n            },\r\n\r\n            fail: function ( response ){\r\n                // Show console messages if debug is enabled\r\n                if ( UncannyAutomator.dev.debugMode ){\r\n                    consoleLogLabel( 'AJAX call 🔴', true, {\r\n                        collapseGroup: true\r\n                    });\r\n                    console.log( 'Data:' );\r\n                    console.log( data );\r\n                    console.log( 'Response' );\r\n                    console.log( '%cUnknown error', 'color: red' );\r\n                    console.groupEnd();\r\n                }\r\n\r\n                if ( isDefined( onFail ) ){\r\n                    onFail( response );\r\n                }\r\n\r\n                // console.log( '%c Failed ', 'background: #ba3535; padding: 2px; color: #fff' );\r\n                // console.log( response );\r\n            }\r\n        });\r\n    }\r\n    else {\r\n        console.error( 'We cannot do this AJAX request. {action} is not defined.' );\r\n    }\r\n}\r\n\r\n/**\r\n * This will return all the current value of the field, even if they aren't saved on the database\r\n * This will use .val() to get the values\r\n *\r\n * @since  1.0\r\n *\r\n * @param {int} itemId - The ID of the item\r\n */\r\n\r\nexport function getCurrentFieldsValues( itemId ){\r\n    let values = {};\r\n\r\n    // Iterate the items' group of fields\r\n    $.each( UncannyAutomator.recipe.items[ itemId ].options, ( index, groupOfFields) => {\r\n        // Iterate each field\r\n        $.each( groupOfFields.fields, ( index, field ) => {\r\n            // Get value\r\n            let fieldId    = field.getFieldID(),\r\n                fieldValue = field.getValue();\r\n\r\n            // Check if it isn't defined. In that case get the current value from the currentValue attribute\r\n            if ( ! isDefined( fieldValue ) ){\r\n                fieldValue = field.getAttributes().currentValue;\r\n            }\r\n\r\n            // Check if the field is a select with custom value\r\n            if ( field.getAttributes().fieldType == 'select' && fieldValue == 'automator_custom_value' ){\r\n                values[ `${ fieldId }_custom` ] = field.getSelectCustomValue();\r\n            }\r\n\r\n            // Save value\r\n            values[ fieldId ] = fieldValue;\r\n\r\n            // Check if it's a select and also get the readable value\r\n            if ( ! isEmpty( fieldValue ) && field.getAttributes().fieldType == 'select' ){\r\n                // Get and save the readable value\r\n                values[ `${ fieldId }_readable` ] = field.getReadableValue();\r\n            }\r\n        });\r\n    });\r\n\r\n    return values;\r\n}\r\n\r\n/**\r\n * Get a Field instance\r\n *\r\n * @since 0.5\r\n *\r\n * @param {int}     itemId - The item ID\r\n * @param {string}  fieldId - The field ID\r\n *\r\n * @return {Field}  a Field instance\r\n */\r\n\r\nexport function getField( itemId, fieldId ){\r\n    let field;\r\n\r\n    $.each( UncannyAutomator.recipe.items[ itemId ].options, function( optionsGroupId, optionsGroup ){\r\n        $.each( optionsGroup.fields, function( index, fieldInstance ){\r\n            if ( fieldId == fieldInstance.getFieldID() ){\r\n                field = fieldInstance;\r\n            }\r\n        });\r\n    });\r\n\r\n    return field;\r\n}\r\n\r\n/**\r\n * Get data about a trigger, action or closure\r\n *\r\n * @since 0.5\r\n *\r\n * @param {string}   itemType - The item type. Valid values are trigger, action and closure\r\n * @param {string}   itemCode - The item code\r\n *\r\n * @return {object}  Item's data\r\n */\r\n\r\nexport function getGlobalItem( integrationID = '', itemType = '', itemCode = '' ){\r\n\tlet theItem;\r\n\r\n\t// Check if all are defined\r\n\tif ( ! isEmpty( integrationID ) && ! isEmpty( itemType ) && ! isEmpty( itemCode ) ){\r\n\t\tlet integrationItems = {};\r\n\r\n\t\t// Check if the we're trying to get a trigger or action\r\n\t\tif ( itemType == 'trigger' || itemType == 'action' ){\r\n\t\t\t// Check if the integration exists\r\n\t\t\tif ( isDefined( UncannyAutomator.integrations[ integrationID ] ) ){\r\n\t\t\t\t// Create a reference to the integration\r\n\t\t\t\tlet integration = UncannyAutomator.integrations[ integrationID ];\r\n\r\n\t\t\t\t// Check if the items are defined\r\n\t\t\t\tif ( isDefined( integration.items ) ){\r\n\t\t\t\t\t// Set integrationItems\r\n\t\t\t\t\tintegrationItems = itemType == 'trigger' ? integration.items.triggers.available : integration.items.actions.available;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconsole.log( '%cNot ready, who is calling this?', 'background: red; color: #fff; font-weight: 500; padding: 2px 6px;' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ( itemType == 'closure' ){\r\n\t\t\tintegrationItems = UncannyAutomator.closures;\r\n\t\t}\r\n\r\n\t\t// Search for the item\r\n\t\t$.each( integrationItems, function( index, item ){\r\n\t\t\tif ( item.code == itemCode ){\r\n\t\t\t\t// Save the item\r\n\t\t\t\ttheItem = item;\r\n\r\n\t\t\t\t// Return false in the loop callback to break the loop\r\n\t\t \t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Return the item\r\n\treturn theItem;\r\n}\r\n\r\n/**\r\n * In Automator DOM elements are deleted and created in each step, so the reference to a DOM element change.\r\n * Use this method to get a metabox, item of optionGroup\r\n *\r\n * @since 0.2\r\n *\r\n * @param {string}   element - Code of the element that you want to get\r\n * @param {object}   attributes - Contains required data to get the elements. Depends of the \"element\" value. Check the variable requiredData in each case.\r\n *\r\n * @return {object}  Object with DOM elements. The properties depend of \"element\"\r\n */\r\n\r\nexport function getDOMElements( element, attributes = {} ){\r\n    // Create response object\r\n    let response = {}\r\n\r\n    // Define valid actions\r\n    let validElements = [ 'metabox', 'items', 'item', 'optionGroup', 'lastItem', 'user-selector' ];\r\n\r\n    // Check if the action is not undefined and if it's a valid action\r\n    if ( isDefined( element ) && inArray( element, validElements ) ){\r\n        // Create array that will store all the requires attributes properties based on the requested element\r\n        let requiredData = [];\r\n\r\n        switch ( element ){\r\n            case 'metabox':\r\n                // Extend default attributes object with default values\r\n                attributes = $.extend({}, attributes );\r\n\r\n                // Define required attributes properties\r\n                requiredData = [ 'type' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    attributes.cssSelector__metabox;\r\n\r\n                    // Check the itemType\r\n                    if ( attributes.type == 'trigger' ){\r\n                        attributes.cssSelector__metabox = '#recipe-triggers-ui';\r\n                    }\r\n                    else if ( attributes.type == 'action' ){\r\n                        attributes.cssSelector__metabox = '#recipe-actions-ui';\r\n                    }\r\n\r\n                    let $metabox = $( attributes.cssSelector__metabox )\r\n\r\n                    response = $metabox;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'itemsObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'items':\r\n                // Extend default attributes object with default values\r\n                attributes = $.extend({}, attributes );\r\n\r\n                // Define required attributes properties\r\n                requiredData = [ 'type' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    let metabox = getDOMElements( 'metabox', {\r\n                        type: attributes.type\r\n                    });\r\n\r\n                    // Get jQuery DOM element\r\n                    let $items = metabox.find( '.item:not(.item--user-selector):not(.item--start):not(.item--closure)' );\r\n\r\n                    // Add element to the response\r\n                    response = $items;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'itemsObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'item':\r\n                // Extend default attributes object with default values\r\n                attributes = $.extend({}, attributes );\r\n\r\n                // Define required attributes properties\r\n                requiredData = [ 'id' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Define CSS Selector\r\n                    attributes.cssSelector = '.uap .item[data-id=\"' + attributes.id + '\"]';\r\n\r\n                    // Get jQuery DOM element\r\n                    let $item = $( attributes.cssSelector ),\r\n                        $contentContainer = $item.find( '.item__content' );\r\n\r\n                    // Add element to the response\r\n                    response.item = $item;\r\n                    response.contentContainer = $contentContainer;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'itemsObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'optionGroup':\r\n                // Extend default attributes object with default values\r\n                attributes = $.extend({}, attributes );\r\n\r\n                // Define required attributes properties\r\n                requiredData = [ 'itemID', 'groupID' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Get main object\r\n                    let item = getDOMElements( 'item', { id: attributes.itemID } ).item;\r\n\r\n                    // Define CSS Selector\r\n                    attributes.cssSelector__tokenInSentence = '.item-title__token[data-token-id=\"' + attributes.groupID + '\"]';\r\n                    attributes.cssSelector__fieldsContainer = '.item-options__group[data-optiongroup=\"' + attributes.groupID + '\"]';\r\n\r\n                    let $tokenInSentence  = item.find( attributes.cssSelector__tokenInSentence ),\r\n                        $fieldsContainer  = item.find( attributes.cssSelector__fieldsContainer ),\r\n                        $optionsContainer = item.find( '.item-options' );\r\n\r\n                    response.tokenInSentence  = $tokenInSentence;\r\n                    response.fieldsContainer  = $fieldsContainer;\r\n                    response.optionsContainer = $optionsContainer;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'itemsObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'lastItem':\r\n                // Extend default attributes object with default values\r\n                attributes = $.extend({}, attributes );\r\n\r\n                // Define required attributes properties\r\n                requiredData = [ 'type' ];\r\n\r\n                // Check if the attributes object has all the required properties\r\n                if ( inArray( requiredData, Object.keys( attributes ) ) ){\r\n                    // Get metabox\r\n                    let metabox = getDOMElements( 'metabox', {\r\n                        type: attributes.type\r\n                    });\r\n\r\n                    // Get last item\r\n                    let lastItem = metabox.find( '.item:not(.item--user-selector):not(.item--start):not(.item--closure)' ).last();\r\n\r\n                    response = lastItem;\r\n                }\r\n                else {\r\n                    // Show to the developer what attributes are missing\r\n                    let missingAttributes = JSON.stringify( arrayDifference( attributes, requiredData ) );\r\n                    console.error( vsprintf( '%s: Some attributes are missing: %s', [ 'itemsObject', missingAttributes ] ) );\r\n                }\r\n\r\n                break;\r\n\r\n            case 'user-selector':\r\n                // Get user selector container\r\n                response = $( '.user-selector' );\r\n\r\n                break;\r\n        }\r\n    }\r\n    else {\r\n         // Has to add error code\r\n        console.error( vsprintf( '%s: The element \"%s\" isn\\'t defined', [ 'getDOMElements', element ] ) );\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Get all valid field types.\r\n * Used for validation\r\n *\r\n * @since 0.4\r\n *\r\n * @return {array} All the valid field types\r\n */\r\n\r\nexport function getFieldTypes(){\r\n    // Set valid field types\r\n    let validFieldTypes = [ 'select', 'textarea', 'text', 'url', 'email', 'int', 'float', 'checkbox', 'radio', 'group', 'date', 'time', 'repeater' ];\r\n\r\n    return validFieldTypes;\r\n}\r\n\r\n/**\r\n * Parse string with SENTENCE tokens\r\n *\r\n * @since 0.5\r\n *\r\n * @param {object}   item - The item\r\n * @param {string}   string - The string with the tokens\r\n * @param {object}   data - Object with the data to replace the text in the tokens.\r\n *\r\n * @return {object}  Object with information about the string\r\n *         {string}  response.plain - The string with the tokens replaced with the data\r\n *         {string}  response.html - The string with the tokens replaced with the data and enclosed in HTML tags\r\n *         {object}  response.elements\r\n *         {array}   response.elements.normal - Array of jQuery object. All the non-tokens part of the sentence\r\n *         {array}   response.elements.tokens - Array of jQuery object. All the tokens part of the sentence\r\n *         {array}   response.parts\r\n *         {object}  response.parts[ n ] - Object with information about each part of the sentence\r\n */\r\n\r\nexport function parseStringWithTokens( item = null, string = '', data = {}, forceReDo = true ){\r\n    let response = null;\r\n\r\n    if (\r\n        /* isDefined( UncannyAutomator.recipe.items[ item.id ].itemSentence )\r\n        && forceReDo == false */\r\n        false\r\n    ){\r\n        response = UncannyAutomator.recipe.items[ item.id ].itemSentence;\r\n    }\r\n    else {\r\n        // Create response object\r\n        response = {\r\n            plain:      '',\r\n            brackets:   '',\r\n            html:       $( '<div/>' ),\r\n            elements:   {\r\n                normal: [],\r\n                token: []\r\n            },\r\n            parts: []\r\n        }\r\n\r\n        // Trim string\r\n        string = string.trim();\r\n\r\n        // Check if the string isn't empty\r\n        if ( ! isEmpty( string ) ){\r\n            // Create regex\r\n            let tokensRegex  = new RegExp( /\\{\\{(.*?)\\}\\}/gm ),\r\n                normals      = [],\r\n                tokens       = [],\r\n                mappedString = string;\r\n\r\n            // Get tokens\r\n            let tokenNumber = 0,\r\n                token;\r\n\r\n            string = string.replace( tokensRegex, function( full_match, token ){\r\n                let tokenParts = token.split( ':' );\r\n\r\n                // Get the token placeholder text\r\n                const tokenPlaceholderText = tokenParts[ 0 ];\r\n\r\n                // Get the token value ID\r\n                const tokenValueID = tokenParts[ 1 ];\r\n\r\n                // Get the ID of the group of fields this token has to open\r\n                // Check if the token should open a different group of options\r\n                const optionsID = isDefined( tokenParts[ 2 ] ) ? tokenParts[ 2 ] : tokenValueID;\r\n\r\n                token = {\r\n                    type:      'token',\r\n                    id:        tokenValueID,\r\n                    text:      tokenPlaceholderText,\r\n                    optionsID: optionsID,\r\n                    hasFields: isDefined( item.options[ optionsID ] )\r\n                }\r\n\r\n                // Check if we have data for the token\r\n                if ( isDefined( data[ token.id ] ) ){\r\n                    let readableText;\r\n\r\n                    if ( data[ token.id ] == 'automator_custom_value' && isDefined( data[ vsprintf( '%s_custom', [ token.id ] ) ] ) ){\r\n                        readableText = data[ vsprintf( '%s_custom', [ token.id ] ) ];\r\n                    }\r\n                    else if ( isDefined( data[ vsprintf( '%s_readable', [ token.id ] ) ] ) ){\r\n                        readableText    = data[ vsprintf( '%s_readable', [ token.id ] ) ];\r\n                    }\r\n\r\n                    token.originalText  = token.text;\r\n                    token.text          = isDefined( readableText ) ? readableText : data[ token.id ];\r\n                }\r\n\r\n                // Add token\r\n                tokens.push( token );\r\n\r\n                // Add token to the mapped string\r\n                mappedString = mappedString.replace( full_match, '{{token:' + tokenNumber + '}}' );\r\n                tokenNumber++;\r\n\r\n                return '{{v}}';\r\n            });\r\n\r\n            let stringParts = string.split( '{{v}}' );\r\n\r\n            // Get normals\r\n            let normalNumber = 0;\r\n            $.each( stringParts, function( key, sentenceSection ){\r\n                if ( sentenceSection != '' ){\r\n                    // Create normal part\r\n                    let normal = {\r\n                        type: 'normal',\r\n                        text: sentenceSection\r\n                    }\r\n\r\n                    // Add normal text\r\n                    normals.push( normal );\r\n\r\n                    // Add \"normal\" part to the mapped string\r\n                    mappedString = mappedString.replace( sentenceSection, '{{normal:' + normalNumber + '}}' );\r\n                    normalNumber++;\r\n                }\r\n            });\r\n\r\n            // Create response.parts\r\n            let match;\r\n\r\n            while ( ( match = tokensRegex.exec( mappedString ) ) !== null ){\r\n                // Get info\r\n                let part = match[ 1 ].split( ':' );\r\n\r\n                part = {\r\n                    type:  part[ 0 ],\r\n                    index: part[ 1 ]\r\n                }\r\n\r\n                // Get part object and add to parts\r\n                if ( part.type == 'normal' ){\r\n                    response.parts.push( normals[ part.index ] );\r\n                }\r\n                else {\r\n                    response.parts.push( tokens[ part.index ] );\r\n                }\r\n            }\r\n\r\n            // Check if the sentence has tokens\r\n            let itemTokens = null;\r\n\r\n            // Create plain text and HTML versions\r\n            $.each( response.parts, function( index, part ){\r\n                // Plain text\r\n                response.plain += part.text;\r\n\r\n                // HTML\r\n                if ( part.text != ' ' ){\r\n                    let elementAttributes,\r\n                        text = part.text;\r\n\r\n                    let contentIsNode  = false,\r\n                        tagNodeContent = null;\r\n\r\n                    // Check if first character is a space\r\n                    let startsWithSpace = text[ 0 ] == ' ';\r\n                    if ( startsWithSpace ){\r\n                        text = text.slice( 1 );\r\n                    }\r\n\r\n                    // Check if last character is a space\r\n                    let endsWithSpace   = text[ text.length - 1 ] == ' ';\r\n                    if ( endsWithSpace ){\r\n                        text = text.slice( 0, -1 );\r\n                    }\r\n\r\n                    if ( ( part.type == 'normal' ) || ( part.type == 'token' && ! part.hasFields && ! item.isMissing ) ){\r\n                        elementAttributes = {\r\n                            'class': 'item-title__normal'\r\n                        }\r\n\r\n                        // Add normal-text part to the brackets version\r\n                        response.brackets += part.text;\r\n                    }\r\n                    else {\r\n                        let CSSClass = 'item-title__token';\r\n\r\n                        elementAttributes = {\r\n                            'class':           CSSClass,\r\n                            'data-token-id':   part.id,\r\n                            'data-options-id': part.optionsID\r\n                        }\r\n\r\n                        // Check if it's using a valid ID\r\n                        if ( isDefined( item.options[ part.optionsID ] ) ){\r\n                            // Check if the section is valid\r\n                            if ( item.options[ part.optionsID ].isValid ){\r\n                                // Add filled class\r\n                                elementAttributes[ 'class' ] += ' item-title__token--filled';\r\n                            }\r\n                        }\r\n\r\n                        // Check if it's filled\r\n                        if ( isDefined( part.originalText ) ){\r\n                            // Add filled class\r\n                            // elementAttributes[ 'class' ] += ' item-title__token--filled';\r\n\r\n                            // Check if the text is a token\r\n                            let isValidToken = false;\r\n\r\n                            if ( tokensRegex.test( text ) ){\r\n                                // Check if we already have the tokens data\r\n                                if ( ! isDefined( itemTokens ) ){\r\n                                    itemTokens = new Tokens(\r\n                                        item.itemType,\r\n                                        'text',\r\n                                        {\r\n                                            includeGroupName: false\r\n                                        }\r\n                                    );\r\n                                }\r\n\r\n                                // Check if it's a valid token\r\n                                let token = itemTokens.renderTextWithTokens( text );\r\n\r\n                                if ( isDefined( token ) ){\r\n                                    // Change the validity of the token\r\n                                    isValidToken   = true;\r\n                                    contentIsNode  = true;\r\n                                    tagNodeContent = token;\r\n                                }\r\n                            }\r\n\r\n                            if ( ! contentIsNode ){\r\n                                // Define text of the token\r\n                                let abbreviatedText = abbreviateText( text, 30 );\r\n\r\n                                // Check if the text was long enough to abbreviate it\r\n                                if ( abbreviatedText.isAbbreviated ){\r\n                                    // Add tooltip with the complete text\r\n                                    elementAttributes[ 'uap-tooltip' ] = text;\r\n\r\n                                    // Replace original text\r\n                                    text = abbreviatedText.text;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        // Add token to the brackets version\r\n                        response.brackets += `{{${ decodeEntities( text ) }}}`;\r\n                    }\r\n\r\n                    let element = $( '<span/>', elementAttributes );\r\n\r\n                    if ( contentIsNode ){\r\n                        element\r\n                            .append( tagNodeContent );\r\n                    }\r\n                    else {\r\n                        element\r\n                            .text( decodeEntities( text ) );\r\n                    }\r\n\r\n                    // Add to the elements array\r\n                    response.elements[ part.type ].push( element );\r\n\r\n                    // Check if we have to preppend a space\r\n                    if ( startsWithSpace ){\r\n                        // response.html.append( ' ' );\r\n                    }\r\n\r\n                    // Append HTML\r\n                    response.html.append( element );\r\n\r\n                    /*\r\n\r\n                    // Append to the HTML\r\n                    // 2.0, remove \"item-title__normal\"\r\n                    // If it's a token, add the element\r\n                    if ( part.type == 'token' ){\r\n                        response.html.append( element );\r\n                    }\r\n                    // Otherwise, add the text\r\n                    else {\r\n                        response.html.append( text );\r\n                    }\r\n\r\n                    */\r\n\r\n                    // Check if we have to append a space\r\n                    if ( endsWithSpace ){\r\n                        // response.html.append( ' ' );\r\n                    }\r\n                }\r\n                else {\r\n                    // response.html.append( ' ' );\r\n\r\n                    // Add white spaces to the brackets version\r\n                    response.brackets += part.text;\r\n                }\r\n            });\r\n\r\n            // Convert array of jQuery elements into wrapped set of elements\r\n            response.elements.normal = $( response.elements.normal ).map( function(){ return this.get() });\r\n            response.elements.token  = $( response.elements.token ).map( function(){ return this.get() }).filter( ':not(.item-title__normal)' );\r\n        }\r\n\r\n        UncannyAutomator.recipe.items[ item.id ].itemSentence = response;\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Determine if a variable is set and is not NULL\r\n *\r\n * @since 0.2\r\n *\r\n * @param  {mixed}      variable - The variable being evaluated\r\n * @return {boolean}    TRUE if the variable is defined\r\n */\r\n\r\nexport function isDefined( variable ){\r\n    // Returns true if the variable is undefined\r\n    return typeof variable !== 'undefined' && variable !== null;\r\n}\r\n\r\n/**\r\n * Determine whether a variable is empty\r\n *\r\n * @since 0.2\r\n *\r\n * @param   {mixed}     variable - The variable being evaluated\r\n * @return  {boolean}   TRUE if the variable is empty\r\n */\r\n\r\nexport function isEmpty( variable ){\r\n    let response = true;\r\n\r\n    // Check if the variable is defined, otherwise is empty\r\n    if ( isDefined( variable ) ){\r\n        // Check if it's array\r\n        if ( $.isArray( variable ) ){\r\n            response = variable.length == 0;\r\n        }\r\n        else if ( isObject( variable ) ){\r\n            response = $.isEmptyObject( variable );\r\n        }\r\n        else {\r\n            response = variable == '';\r\n        }\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Check if two strings are equal\r\n *\r\n * @since 0.2\r\n *\r\n * @param   {string}    string1 - String to be compared\r\n * @param   {string}    string2 - String to be compared\r\n * @param   {object}    settings - Object with settings\r\n * @param   {boolean}   settings.caseSensitive=true - If true, uppercase and lowercase chars will be treated as distinct\r\n *\r\n * @return  {boolean} TRUE if both strings are equal\r\n */\r\n\r\nexport function compareStrings( string1, string2, settings = { caseSensitive: true } ){\r\n    // Create response variable\r\n    let response = false;\r\n\r\n    // Check if it's case sensitive\r\n    if ( ! settings.caseSensitive ){\r\n        response = string1.toString().toLowerCase() == string2.toString().toLowerCase();\r\n    }\r\n    else {\r\n        response = string1.toString() == string2.toString();\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Check if a value exists in an array\r\n * If the needle is an array then it will check if all his elements exists in the haystack\r\n *\r\n * @since 0.2\r\n *\r\n * @param   {mixed}     needle - The searched value. The comparison between values is strict. If the needle is an array then it will check if all his elements exists in the haystack\r\n * @param   {array}     haystack - An array through which to search.\r\n *\r\n * @return  {boolean} TRUE if needle is found in the array or if needle is an array, TRUE if all the elements from the needle are in haystack\r\n */\r\n\r\nexport function inArray( needle, haystack ){\r\n    let response = false;\r\n\r\n    if ( Array.isArray( needle ) ){\r\n        // Check that all the elements from the array \"value\" are in the array \"array\"\r\n        response = arrayDifference( needle, haystack ).length == 0;\r\n    }\r\n    else {\r\n        // Check if one element is in an array\r\n        response = $.inArray( needle, haystack ) !== -1;\r\n    }\r\n\r\n    return response;\r\n}\r\n\r\n/**\r\n * Compare the values of two arrays and get the difference\r\n * Compares array1 against one array and returns the values in array1 that are not present in array2.\r\n * Examples:\r\n * +-------------------+-------------+--------------+\r\n * |      array1       |   array2    |    return    |\r\n * +-------------------+-------------+--------------+\r\n * | [ 1, 2, 3, 4, 5 ] | [ 1, 3, 4 ] | [ 2, 5]      |\r\n * | [ 1, 2, 3 ]       | [ 2, 3 ]    | [ 1 ]        |\r\n * | [ 2, 3 ]          | [ 1, 2, 3 ] | []           |\r\n * | [ 1, 2 ]          | [ 1, 2 ]    | []           |\r\n * | [ '1', '2' ]      | [ 1, 2 ]    | [ '1', '2' ] |\r\n * +-------------------+-------------+--------------+\r\n *\r\n * @since 0.2\r\n *\r\n * @param   {array} array1 - The array to compare from\r\n * @param   {array} array2 - An array to compare against\r\n *\r\n * @return  {array} Array containing all the entries from array1 that are not present in array2\r\n */\r\n\r\nexport function arrayDifference( array1, array2 ){\r\n    return $( array1 ).not( array2 ).get();\r\n}\r\n\r\n/**\r\n * JavaScript vsprintf implementation\r\n * Return a formatted string\r\n *\r\n * @requires sprintf-js\r\n *\r\n * @since 0.2\r\n *\r\n * @param {string}  format - The placeholders in the format string are marked by % and are followed by one or more of these elements, in this order:\r\n *    1. An optional number followed by a $ sign that selects which argument index to use for the value.\r\n *       If not specified, arguments will be placed in the same order as the placeholders in the input string.\r\n *    2. An optional + sign that forces to preceed the result with a plus or minus sign on numeric values. By default, only the - sign is used on negative numbers.\r\n *    3. An optional padding specifier that says what character to use for padding (if specified).\r\n *       Possible values are 0 or any other character precedeed by a ' (single quote). The default is to pad with spaces.\r\n *    4. An optional - sign, that causes sprintf to left-align the result of this placeholder. The default is to right-align the result.\r\n *    5. An optional number, that says how many characters the result should have.\r\n *       If the value to be returned is shorter than this number, the result will be padded.\r\n *       When used with the j (JSON) type specifier, the padding length specifies the tab size used for indentation.\r\n *    6. An optional precision modifier, consisting of a . (dot) followed by a number, that says how many digits should be displayed for floating point numbers.\r\n *       When used with the g type specifier, it specifies the number of significant digits. When used on a string, it causes the result to be truncated.\r\n *    7. A type specifier that can be any of:\r\n *    7.1  % — yields a literal % character\r\n *    7.2  b — yields an integer as a binary number\r\n *    7.3  c — yields an integer as the character with that ASCII value\r\n *    7.4  d or i — yields an integer as a signed decimal number\r\n *    7.5  e — yields a float using scientific notation\r\n *    7.6  u — yields an integer as an unsigned decimal number\r\n *    7.7  f — yields a float as is; see notes on precision above\r\n *    7.8  g — yields a float as is; see notes on precision above\r\n *    7.9  o — yields an integer as an octal number\r\n *    7.10 s — yields a string as is\r\n *    7.11 t — yields true or false\r\n *    7.12 T — yields the type of the argument1\r\n *    7.13 v — yields the primitive value of the specified argument\r\n *    7.14 x — yields an integer as a hexadecimal number (lower-case)\r\n *    7.15 X — yields an integer as a hexadecimal number (upper-case)\r\n *    7.16 j — yields a JavaScript object or array as a JSON encoded string\r\n * @param {array}  arguments_array - array of arguments\r\n *\r\n * @return {string} Return array values as a formatted string according to format.\r\n */\r\n\r\nexport function vsprintf( format, arguments_array ){\r\n    var vsprintf = require('sprintf-js').vsprintf;\r\n    return vsprintf( format, arguments_array );\r\n}\r\n\r\n/**\r\n * Find whether a variable is a string\r\n *\r\n * @since 0.2\r\n *\r\n * @param   {mixed}     variable - The variable being evaluated\r\n * @return  {boolean}   TRUE if the variable is an string\r\n */\r\n\r\nexport function isString( string ){\r\n    return typeof string === 'string';\r\n}\r\n\r\n/**\r\n * Find whether a variable is an object\r\n *\r\n * @since 0.2\r\n *\r\n * @param   {mixed}     variable - The variable being evaluated\r\n * @return  {boolean}   TRUE if the variable is an object\r\n */\r\n\r\nexport function isObject( variable ){\r\n    return variable !== null && typeof variable === 'object';\r\n}\r\n\r\n/**\r\n * Remove all spaces from a string\r\n *\r\n * @since 0.3\r\n *\r\n * @param   {string}    String\r\n * @return  {string}    String without spaces\r\n */\r\n\r\nexport function removeSpaces( string ){\r\n    return string.replace( /\\s/g, '' );\r\n}\r\n\r\n/**\r\n * Replace curly braces\r\n *\r\n * @since 0.5\r\n *\r\n * @param {string} string - The string to be searched\r\n * @param {string} start - The value to replace the for {{\r\n * @param {string} end - The value to replace the for }}\r\n *\r\n * @return {string} The value with the replaced values\r\n */\r\n\r\nexport function replaceCurlyBraces( string = '', start = '', end = '' ){\r\n    string = string.replace( /{{/g, start );\r\n    string = string.replace( /}}/g, end );\r\n    return string;\r\n}\r\n\r\n/**\r\n * Creates a console log label\r\n *\r\n * @since  1.1\r\n *\r\n * @param  {String} text - Text to show after the label\r\n * @param  {Boolean} isGroup - Define if we have to do a console.group instead of console.log\r\n */\r\n\r\nexport function consoleLogLabel( text = '', isGroup = false, options = {} ){\r\n\t// Check if the user defined a custom background color\r\n\tif ( ! isDefined( options.bgColor ) ){\r\n\t\toptions.bgColor = '#0790e8';\r\n\t}\r\n\r\n    // Define console log Automator style\r\n    let labelStyle = `background: ${ options.bgColor }; color: #fff; font-weight: 500; padding: 2px 6px; font-family: -apple-system, system-ui, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;`;\r\n\r\n    // Do console log\r\n    if ( isGroup ){\r\n        if ( isDefined( options.collapseGroup ) && options.collapseGroup ){\r\n            console.groupCollapsed( '%c🤖Automator', labelStyle, text );\r\n        }\r\n        else {\r\n            console.group( '%c🤖Automator', labelStyle, text );\r\n        }\r\n    }\r\n    else {\r\n        console.log( '%c🤖Automator', labelStyle, text );\r\n    }\r\n}\r\n\r\n/**\r\n * Creates a custom console log with colors to\r\n * represent success and failure\r\n *\r\n * @since  2.0\r\n *\r\n * @param  {String} status - Message type. Use 'success' or 'error'\r\n * @param  {String} text - Text to show after the label\r\n */\r\n\r\nexport function consoleLogResult( status = 'error', text = '' ){\r\n    // Define console log Automator style\r\n    let labelStyle = 'color: #fff; padding: 2px 7px; font-family: -apple-system, system-ui, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif; font-weight: normal';\r\n\r\n    // Add error or success colors\r\n    if ( status == 'error' ){\r\n        labelStyle = `background: #f13c3c; ${ labelStyle }`;\r\n    }\r\n\r\n    if ( status == 'success' ){\r\n        labelStyle = `background: #40b528; ${ labelStyle }`;\r\n    }\r\n\r\n    // Do console log\r\n    console.log( `%c${ text }`, labelStyle );\r\n}\r\n\r\n/**\r\n * Escape HTML characters\r\n *\r\n * @since  1.1\r\n * @param  {String} html The HTML\r\n * @return {String}      Scaped HTML\r\n */\r\n\r\nexport function escapeHTML( html = '' ){\r\n    let tagsToReplace = {\r\n        '&': '&amp;',\r\n        '<': '&lt;',\r\n        '>': '&gt;'\r\n    };\r\n\r\n    let replaceTag = function( tag ){\r\n        return tagsToReplace[ tag ] || tag;\r\n    }\r\n\r\n    return html.replace( /[&<>]/g, replaceTag );\r\n}\r\n\r\n/**\r\n * Abbreviate long texts. This function will convert a string\r\n * like \"123456789\" to \"123...789\"\r\n *\r\n * @param  {String} text    The string\r\n * @param  {Int}    length  The max length of the string\r\n * @return {Object}         Response two properties, isAbbreviated and text\r\n */\r\n\r\nexport function abbreviateText( text = '', length = 10 ){\r\n    // Default response\r\n    let response = {\r\n        isAbbreviated: false,\r\n        text: text\r\n    }\r\n\r\n    // Only abbreviate the text if the text is longer than the length\r\n    if ( text.length > length ){\r\n        // Get length of each parts (start and end)\r\n        let partLengths = Math.floor( length / 2 );\r\n\r\n        // Get parts\r\n        let textParts = {\r\n            start: text.substring( 0, partLengths ),\r\n            end:   text.slice( -partLengths )\r\n        }\r\n\r\n        // Create abbrevited text\r\n        response.text = `${ textParts.start } ... ${ textParts.end }`;\r\n        response.isAbbreviated = true;\r\n    }\r\n\r\n    // Return response\r\n    return response;\r\n}\r\n\r\n/**\r\n * Get an unique ID\r\n */\r\n\r\nexport function getUniqueId(){\r\n    // Math.random should be unique because of its seeding algorithm.\r\n    // Convert it to base 36 (numbers + letters), and grab the first 9 characters\r\n    // after the decimal.\r\n    return '_' + Math.random().toString( 36 ).substr( 2, 9 );\r\n}\r\n\r\n/**\r\n * Insert parameter to an URL.\r\n * If the parameter already exists it will update it\r\n *\r\n * @param  {String} url        The URL\r\n * @param  {Object} parameters The parameters\r\n * @param  {Object} options    The options. It supports two properties, \"setAsURL\" and \"refresh\"\r\n * @return {String}            The URL with the parameters\r\n */\r\nexport function addParametersToURL( url = '', parameters = {}, options = {} ){\r\n    // If the URL is empty, use the site URL\r\n    if ( isEmpty( url ) ){\r\n        url = window.location.href;\r\n    }\r\n\r\n    // Try to get an URL object\r\n    try {\r\n        url = new URL( url );\r\n    } catch ( e ){\r\n        // If something goes wrong, just return the original URL\r\n        return url;\r\n    }\r\n\r\n    // Get the current parameters in the URL\r\n    let urlParameters = url.search.substr( 1 ).split( '&' );\r\n\r\n    // Iterate the parameters\r\n    for ( let [ key, value ] of Object.entries( parameters ) ){\r\n        key   = encodeURI( key );\r\n        value = encodeURI( value );\r\n\r\n        let i = urlParameters.length;\r\n        let x;\r\n\r\n        while ( i-- ){\r\n            x = urlParameters[ i ].split( '=' );\r\n\r\n            if ( x[ 0 ] == key ){\r\n                x[ 1 ] = value;\r\n                urlParameters[i] = x.join( '=' );\r\n                break;\r\n            }\r\n        }\r\n\r\n        if ( i < 0 ){\r\n            urlParameters[ urlParameters.length ] = [ key, value ].join( '=' );\r\n        }\r\n    }\r\n\r\n    // Remove empty parameters\r\n    urlParameters = urlParameters.filter( parameter => ! isEmpty( parameter ) );\r\n\r\n    // Add parameters to the URL\r\n    url.search = urlParameters.join( '&' );\r\n\r\n    // Set default options\r\n    options = $.extend({}, {\r\n        setAsURL: false,\r\n        refresh:  false\r\n    }, options );\r\n\r\n    // Check if we have to set it as the current URL\r\n    if ( options.setAsURL ){\r\n        // Check if we have to reload\r\n        if ( options.refresh ){\r\n            // This will reload the page, it's likely better to store this until finished\r\n            window.location.href = url.href;\r\n        }\r\n        else {\r\n            // Get title of the current page\r\n            let pageTitle = document.title;\r\n\r\n            // Push history and update URL\r\n            window.history.pushState({}, pageTitle, url.href );\r\n        }\r\n    }\r\n\r\n    // Return URL\r\n    return url.href;\r\n}\r\n\r\n/**\r\n * Decodes HTML entities\r\n *\r\n * @since  2.1.4\r\n * @param  {String} encodedString The string with encoded entities\r\n * @return {String}               The same string, with the entities decoded\r\n */\r\nexport function decodeEntities( encodedString = '' ){\r\n    const $textarea = document.createElement( 'textarea' );\r\n    $textarea.innerHTML = encodedString;\r\n    return $textarea.value;\r\n}\r\n\r\nexport function throttle( func, interval ){\r\n    var lastCall = 0;\r\n\r\n    return function(){\r\n        var now = Date.now();\r\n        if ( lastCall + interval < now ){\r\n            lastCall = now;\r\n            return func.apply( this, arguments );\r\n        }\r\n    };\r\n};\r\n\r\nexport function debounce( func, interval ){\r\n    var lastCall = -1;\r\n\r\n    return function(){\r\n        clearTimeout( lastCall );\r\n        var args = arguments;\r\n        var self = this;\r\n        lastCall = setTimeout( function(){\r\n            func.apply( self, args );\r\n        }, interval );\r\n    };\r\n};\r\n\r\nexport function copyToClipboard( string ){\r\n    // Create temporal textarea\r\n    const $tempTextarea = document.createElement( 'textarea' );\r\n\r\n    // Make the textarea really small\r\n    $tempTextarea.style.width  = '0px';\r\n    $tempTextarea.style.height = '0px';\r\n\r\n    // Set the string as the textarea value\r\n    $tempTextarea.value = string;\r\n\r\n    // Add the textarea to the body\r\n    document.body.appendChild( $tempTextarea );\r\n\r\n    // Select all the text from the textarea\r\n    $tempTextarea.select();\r\n\r\n    // Copy content\r\n    document.execCommand( 'copy' );\r\n\r\n    // Remove the element from the body\r\n    document.body.removeChild( $tempTextarea );\r\n}\r\n\r\n/**\r\n * Creates a Modal with information about a Fatal error\r\n *\r\n * @since 3.0\r\n * @param {Error}\r\n */\r\n\r\nexport function handleFatalError( error ){\r\n    // Create report log\r\n    let reportLog = '';\r\n\r\n    let recipeData;\r\n    try {\r\n        // Get the recipe data\r\n        recipeData = UncannyAutomator.recipes_object.filter( ( recipe ) => {\r\n            return recipe.ID == UncannyAutomator.recipe.id;\r\n        })[0];\r\n    } catch ( e ){\r\n        console.log( e );\r\n    }\r\n\r\n    // Get general information about the recipe\r\n    try {\r\n        let logRecipe = `====== ${ UncannyAutomator.i18n.debugging.recipeTitle } ====== \\n`;\r\n\r\n        // Add recipe type\r\n        let recipeType = recipeData.recipe_type == 'user' ? UncannyAutomator.i18n.debugging.recipeTypeUser : ( recipeData.recipe_type == 'anonymous' ? UncannyAutomator.i18n.debugging.recipeTypeAnonymous : '' );\r\n        logRecipe += `${ UncannyAutomator.i18n.debugging.recipeType }: ${ recipeType }`;\r\n\r\n        // Add recipe status\r\n        let recipeStatus = recipeData.post_status == 'draft' ? UncannyAutomator.i18n.debugging.recipeStatusDraft : ( recipeData.post_status == 'publish' ? UncannyAutomator.i18n.debugging.recipeStatusLive : '' );\r\n        logRecipe += `\\n${ UncannyAutomator.i18n.debugging.recipeStatus }: ${ recipeStatus }`;\r\n\r\n        reportLog = logRecipe;\r\n    }\r\n    catch ( e ){\r\n        console.log( e );\r\n    }\r\n\r\n    // Get information about the recipe items\r\n    try {\r\n        let logRecipeItems = `=== ${ UncannyAutomator.i18n.debugging.recipeItemsTitle } === \\n`;\r\n\r\n        // Create function to clean extra data and leave on relevant data\r\n        // from the recipe items array\r\n        const cleanItemData = ( item ) => {\r\n            // Get status\r\n            const recipeStatus = item.post_status == 'publish' ? UncannyAutomator.i18n.debugging.itemStatusLive : UncannyAutomator.i18n.debugging.itemStatusDraft;\r\n\r\n            return `> ${ item.meta.integration } - ${ item.meta.code } - ${ recipeStatus }`;\r\n        }\r\n\r\n        // Get triggers\r\n        const triggers    = recipeData.triggers.map( cleanItemData );\r\n        const hasTriggers = triggers.length > 0;\r\n\r\n        // Get actions\r\n        const actions     = recipeData.actions.map( cleanItemData );\r\n        const hasActions  = actions.length > 0;\r\n\r\n        // Get closures\r\n        const closures    = recipeData.closures.map( cleanItemData );\r\n        const hasClosures = closures.length > 0;\r\n\r\n        // Check if it has recipe items\r\n        if ( hasTriggers || hasActions || hasClosures ){\r\n            // Add triggers\r\n            logRecipeItems += `${ UncannyAutomator.i18n.debugging.triggersTitle }\\n`;\r\n\r\n            // Check if it has triggers\r\n            if ( hasTriggers ){\r\n                logRecipeItems += triggers.join( '\\n' );\r\n            }\r\n            else {\r\n                logRecipeItems += `> ${ UncannyAutomator.i18n.debugging.noTriggers }`;\r\n            }\r\n\r\n            // Add actions\r\n            logRecipeItems += `\\n${ UncannyAutomator.i18n.debugging.actionsTitle }\\n`;\r\n\r\n            // Check if it has actions\r\n            if ( hasActions ){\r\n                logRecipeItems += actions.join( '\\n' );\r\n            }\r\n            else {\r\n                logRecipeItems += `> ${ UncannyAutomator.i18n.debugging.noActions }`;\r\n            }\r\n\r\n            // Add closures\r\n            logRecipeItems += `\\n${ UncannyAutomator.i18n.debugging.closuresTitle }\\n`;\r\n\r\n            // Check if it has closures\r\n            if ( hasClosures ){\r\n                logRecipeItems += closures.join( '\\n' );\r\n            }\r\n            else {\r\n                logRecipeItems += `> ${ UncannyAutomator.i18n.debugging.noClosures }`;\r\n            }\r\n        }\r\n        else {\r\n            logRecipeItems += `${ UncannyAutomator.i18n.debugging.noRecipeItemsFound }`;\r\n        }\r\n\r\n        reportLog = ( reportLog !== '' ) ? `${ reportLog }\\n\\n${ logRecipeItems }` : reportLog;\r\n    }\r\n    catch ( e ){\r\n        console.log( e );\r\n    }\r\n\r\n    // Add JS console\r\n    try {\r\n        let jsConsole = `====== ${ UncannyAutomator.i18n.debugging.jsConsole } ====== \\n`;\r\n\r\n        // Add JS console\r\n        jsConsole += `${ error.stack.replaceAll( UncannyAutomator.siteURL, '{site_url}' ) }`;\r\n\r\n        reportLog = reportLog !== '' ? `${ reportLog }\\n\\n${ jsConsole }` : reportLog;\r\n    }\r\n    catch ( e ){\r\n        console.log( e );\r\n    }\r\n\r\n    const $modal = new Modal({\r\n        title:   `<span class=\"modal__title-icon uo-icon uo-icon--exclamation-triangle\"></span> ${ UncannyAutomator.i18n.debugging.recipeCouldntBeLoaded }`,\r\n        warning: `${ UncannyAutomator.i18n.debugging.recipeFailedNotice }`,\r\n        content: `\r\n            <div>\r\n                <p>\r\n                    Ut venenatis justo eget nisi congue sodales. Ut id dignissim massa. Donec sit amet sapien a est venenatis pulvinar efficitur id lorem.\r\n                </p>\r\n                <p>\r\n                    Nullam eros lacus, convallis eu condimentum vel, tempus luctus lectus.\r\n                </p>\r\n                <p>\r\n                    <div>\r\n                        <pre id=\"uap-debugging\">${ reportLog }</pre>\r\n                    </div>\r\n                </p>\r\n            </div>\r\n        `,\r\n        buttons: {\r\n            cancel:  UncannyAutomator.i18n.debugging.buttonGoBack,\r\n            confirm: UncannyAutomator.i18n.debugging.learnMore,\r\n        },\r\n    }, {\r\n        size: 'extra-large',\r\n        warningFirst: true\r\n    });\r\n\r\n    $modal.setEvents({\r\n        onConfirm: () => {\r\n            // Learn more\r\n            window.open( UncannyAutomator.dev.debuggingURL, '_blank' );\r\n        },\r\n        onCancel: () => {\r\n            // Go back to the recipes page\r\n            window.location.replace( UncannyAutomator.dev.recipesUrl );\r\n        },\r\n        afterSetEvents: () => {\r\n            // Get the element with the debugging\r\n            const $debuggingConsole = $( '#uap-debugging' );\r\n\r\n            // On click, copy the content\r\n            $debuggingConsole.on( 'click', () => {\r\n                // Get the content\r\n                const debugContent = $debuggingConsole.text();\r\n\r\n                // Copy the content to the console\r\n                // const el = document.createElement( 'textarea' );\r\n                // el.value = debugContent;\r\n                // document.body.appendChild( el );\r\n                // el.select();\r\n                // document.execCommand( 'copy' );\r\n                // document.body.removeChild( el );\r\n\r\n                // Select the content of the container\r\n                // This is just to improve the UX\r\n                var range = document.createRange();\r\n                range.selectNodeContents( $debuggingConsole[0] );\r\n                window.getSelection().removeAllRanges();\r\n                window.getSelection().addRange( range );\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Filters items with specific post meta value\r\n *\r\n * @since 3.0\r\n * @param {array}   items The array of items to filter\r\n * @param {String}  meta Meta key\r\n * @param {String}  value Meta value\r\n * \r\n * @return {array} Array of filtered items\r\n * \r\n */    \r\n export function filterMetaValue( items, meta, value ) {\r\n\r\n    let itemsWithMeta = {};\r\n\r\n    $.each( items, ( itemId, item ) => {\r\n        if ( item.meta[meta] && item.meta[meta] == value ) {\r\n            itemsWithMeta[itemId] = item;\r\n        }\r\n    });\r\n\r\n    return itemsWithMeta;\r\n};\r\n\r\n/**\r\n * Filters items without specific post meta\r\n *\r\n * @since 3.0\r\n * @param {array}   items The array of items to filter\r\n * @param {String}  meta Meta key\r\n * @param {String}  value Meta value\r\n * \r\n * @return {array} Array of filtered items\r\n * \r\n */    \r\n export function filterMeta( items, meta, exist = true ) {\r\n\r\n    let filteredItems = {};\r\n\r\n    $.each( items, ( itemId, item ) => {\r\n        if ( ( meta in item.meta ) === exist ) {\r\n            filteredItems[itemId] = item;\r\n        }\r\n    });\r\n\r\n    return filteredItems;\r\n};","import $ from 'jquery';\r\n\r\nimport {\r\n\titemsObject,\r\n\tisString,\r\n\tisEmpty,\r\n\tisDefined,\r\n\tinArray,\r\n\tgetDOMElements,\r\n\tgetFieldTypes,\r\n\trestCall,\r\n\tvsprintf\r\n} from './Utilities.js';\r\n\r\nimport Publish from './Publish.js';\r\n\r\nimport Tokens from './tokens/tokens';\r\n\r\n/**\r\n * Validate form using the global object UncannyAutomator.recipe, which contains\r\n * all the recipe items \r\n *\r\n * @since 0.3\r\n *\r\n * @return {object}\r\n * @return {boolean}  response.canSubmit - TRUE if the recipe is valid\r\n */\r\n\r\nexport function validateRecipe(){\r\n\t// Set response object\r\n\tlet response = {\r\n\t\tcanSubmit: UncannyAutomator.recipe.isValid\r\n\t}\r\n\t\r\n\t// Check if the recipe is not valid\r\n\tif ( ! UncannyAutomator.recipe.isValid ){\r\n\r\n\t\t// Enable error mode\r\n\t\t// UncannyAutomator.recipe.errorMode = true;\r\n\r\n\t\t// Iterate each item\r\n\t\t$.each( UncannyAutomator.recipe.items, function( itemID, itemData ){\r\n\r\n\t\t\t// Validate each item\r\n\t\t\tvalidateItem( itemID );\r\n\t\t});\r\n\t}\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Validate item using the itemID\r\n *\r\n * @since 0.4\r\n *\r\n * @param  {int} \t  itemID - ID of the item\r\n * @param  {object}   [$item] - jQuery object of the item. Necessary only if itemID is undefined\r\n *\r\n * @return {object}\r\n * @return {boolean}  response.isValid - TRUE if the item is valid\r\n */\r\n\r\nexport function validateItem( itemID, $item = null ){\r\n\t// Create response object\r\n\tlet response = {\r\n\t\tisValid: false\r\n\t}\r\n\r\n\t// Check if the itemID is defined\r\n\tif ( isDefined( itemID ) ){\r\n\t\t// Get item\r\n\t\tlet item = UncannyAutomator.recipe.items[ itemID ];\r\n\r\n\t\t// Check if the item exists, otherwise do nothing, isValid will be false (because of the default value)\r\n\t\tif ( ! item.isMissing && ! isEmpty( item ) ){\r\n\t\t\t// Save result\r\n\t\t\tresponse.isValid = item.isValid;\r\n\r\n\t\t\t// Check if this item is invalid\r\n\t\t\tif ( ! item.isValid ){\r\n\r\n\t\t\t\t// Get DOM element of the item\r\n\t\t\t\tlet itemElement = getDOMElements( 'item', {\r\n\t\t\t\t\tid: itemID\r\n\t\t\t\t}).item;\r\n\r\n\t\t\t\t// Add CSS class to it\r\n\t\t\t\titemElement.addClass( 'item--error' );\r\n\r\n\t\t\t\t// Iterate each group of fields\r\n\t\t\t\t$.each( item.options, function( optionsGroupID, optionsGroupData ){\r\n\r\n\t\t\t\t\t// Check if a group of fields is invalid\r\n\t\t\t\t\tif ( ! optionsGroupData.isValid ){\r\n\r\n\t\t\t\t\t\t// Get DOM elements of the container with all the fields\r\n\t\t\t\t\t\tlet optionsGroupElements = getDOMElements( 'optionGroup', {\r\n\t\t\t\t\t\t\titemID: \titemID,\r\n\t\t\t\t\t\t\tgroupID: \toptionsGroupID\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Add error classes\r\n\t\t\t\t\t\toptionsGroupElements.tokenInSentence.addClass( 'item-title__token--error item-title__token--error-shake' );\r\n\t\t\t\t\t\toptionsGroupElements.fieldsContainer.addClass( 'item-options__group--error' );\r\n\t\t\t\t\t\toptionsGroupElements.optionsContainer.addClass( 'item-options--error' );\r\n\r\n\t\t\t\t\t\t// Remove \"shake\" class from tokenInSentence so the element can shake if the user clicks again\r\n\t\t\t\t\t\tsetTimeout( function(){\r\n\t\t\t\t\t\t\toptionsGroupElements.tokenInSentence.removeClass( 'item-title__variable--error-shake' );\r\n\t\t\t\t\t\t}, 1000 );\r\n\r\n\t\t\t\t\t\t// Show errors in the UI for each invalid field\r\n\t\t\t\t\t\tif ( isDefined( optionsGroupElements.optionsContainer ) ){\r\n\r\n\t\t\t\t\t\t\t// Validate the form of the group of fields. Check validateItemFields comments for more information.\r\n\t\t\t\t\t\t\tvalidateItemFields( optionsGroupElements.optionsContainer );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\t// ID is not defined, the item doesn't have an ID yet\r\n\t\tresponse.isValid = false;\r\n\r\n\t\t// Check if $item is defined \r\n\t\tif ( ! isEmpty( $item ) ){\r\n\t\t\t\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.error( 'Neither itemID nor the $item are defined. One of them must be defined.' );\t\r\n\t\t}\r\n\t}\r\n\r\n\t// Return response\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Validate form using a DOM element that contains the fields\r\n * \r\n * @since 0.1\r\n *\r\n * @param {object}\t form - jQuery DOM element that contains the fields\r\n *\r\n * @return {object}\r\n * @return {boolean}  response.isValid - TRUE if the form is valid\r\n */\r\n\r\nexport function validateItemFields( form, validateChildren = false ){\r\n\t// Create response object\r\n\tlet response = {\r\n\t\tisValid: false\r\n\t}\r\n\r\n\t// Get all fields, input, textareas and selects\r\n\tlet fields = form.find( `\r\n\t\tinput.form-element__input[data-is-child-field=\"${ validateChildren ? 'true' : 'false' }\"],\r\n\t\ttextarea.form-element__textarea[data-is-child-field=\"${ validateChildren ? 'true' : 'false' }\"],\r\n\t\tselect.form-element__select[data-is-child-field=\"${ validateChildren ? 'true' : 'false' }\"],\r\n\t\t.form-checkbox input,\r\n\t\t.form-radio` );\r\n\r\n\t// Set the variable that will be used to decide if the form is valid or not\r\n\t// It's true by default, but it will changed to false if at least one field has an error\r\n\tlet isFormValid = true;\r\n\r\n\t// Go through all fields\r\n\tfields.each(function(){\r\n\t\t// Save $(this) jQuery element (from the each loop) in the field variable\r\n\t\t// form-element__input, form-element__textarea or form-element__select\r\n\t\tlet field = $( this );\r\n\r\n\t\t// Get field type\r\n\t\tlet fieldType = field.data( 'type' );\r\n\r\n\t\t// Define field data\r\n\t\tlet fieldData = {}\r\n\r\n\t\t// Check if it's a radio\r\n\t\tif ( field.hasClass( 'form-radio' ) ){\r\n\t\t\t// Overwrite field type\r\n\t\t\tfieldType = 'radio';\r\n\r\n\t\t\t// Get one of the radios\r\n\t\t\tlet radioInput     = field.find( 'input' ).first();\r\n\r\n\t\t\t// Get value of the selected radio (if there is any)\r\n\t\t\tlet selectedRadio  = field.find( 'input:checked' ),\r\n\t\t\t    radioValue     = selectedRadio.length > 0 ? selectedRadio.val() : '';\r\n\r\n\t\t\t// Create object with the data that will be used in the verification process\r\n\t\t\tfieldData = {\r\n\t\t\t\tfield_type: \t\t 'radio',\r\n\t\t\t\tvalue: \t\t\t\t radioValue,\r\n\t\t\t\tattributes: {\r\n\t\t\t\t\tsupportsTokens:  radioInput.data( 'supportstokens' ),\r\n\t\t\t\t\trequired: \t\t radioInput.data( 'required' ),\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Check if it's a select\r\n\t\telse if ( field.hasClass( 'form-element__select' ) ){\r\n\t\t\tfieldData = {\r\n\t\t\t\tfield_type: \t\t 'select',\r\n\t\t\t\tvalue: \t\t\t\t field.val(),\r\n\t\t\t\tattributes: {\r\n\t\t\t\t\tsupportsTokens:      field.data( 'supportstokens' ),\r\n\t\t\t\t\trequired: \t\t     field.data( 'required' ),\r\n\t\t\t\t\tsupportsCustomValue: field.data( 'supports-custom-value' ),\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Create object with the data that will be used in the verification process\r\n\t\t\tfieldData = {\r\n\t\t\t\tfield_type: \t\t field.data( 'type' ),\r\n\t\t\t\tvalue: \t\t\t\t field.val(),\r\n\t\t\t\tattributes: {\r\n\t\t\t\t\tsupportsTokens:  field.data( 'supportstokens' ),\r\n\t\t\t\t\trequired: \t\t field.data( 'required' ),\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check if it's a checkbox and overwrite the value\r\n\t\tif ( fieldData.field_type == 'checkbox' ){\r\n\t\t\tfieldData.value = field.is( ':checked' );\r\n\t\t}\r\n\r\n\t\t// Check if the field is required, the value is undefined but has a default value in the settings\r\n\t\t/*\r\n\t\tif ( fieldData.attributes.required && ! isDefined( fieldData.value ) && isDefined( fieldData.defaultValue ) ){\r\n\t\t\t// Set default value as value\r\n\t\t\tfieldData.value = fieldData.attributes.defaultValue;\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t// Validate form. Read validateField comments for more information\r\n\t\tlet fieldValidation = validateField( field, fieldData.field_type, fieldData.value, fieldData.attributes );\r\n\r\n\t\t// Check if the field is invalid\r\n\t\tif ( ! fieldValidation.isValid ){\r\n\t\t\tisFormValid = false;\r\n\r\n\t\t\t// Add error class to form container\r\n\t\t\tform.addClass( 'item-options--error' );\r\n\t\t}\r\n\t});\r\n\r\n\tresponse.isValid = isFormValid;\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Validates the value of a field.\r\n * Supports all field types\r\n *\r\n * Only supports one token. The object is prepared to support more than one, we only have to remove the if statement\r\n * that checks the number of tokens per string. This functionality will be change in another version\r\n *\r\n * @since 0.1\r\n *\r\n * @param {object} \t\tfield - jQuery object of the field used to add CSS classes. Use null if you just want to get the validation response\r\n * @param {string} \t\tfieldType - A valid field type\r\n * @param {string} \t\tvalue - The value of the field.\r\n * @param {object}   \tattributes - Object with some of the field attributes\r\n * @param {boolean} \tattributes.supportsTokens - TRUE if the field should support tokens\r\n * @param {boolean} \tattributes.required - TRUE if the field is required\r\n * @param {object} \t\t[customValidationFunction] Just in case you want to add a custom validation function. Must return an object with two properties { isValid: {boolean}, message: {string} }\r\n *\r\n * @return {object}\r\n * @return {boolean} \tresponse.isValid - TRUE if the field is valid\r\n * @return {string}  \tresponse.message - Message showing the reason the field is invalid\r\n */\r\n\r\nexport function validateField( field, fieldType, value, attributes = { supportsTokens: false, required: false }, customValidationFunction ){\r\n\t// Create response object\r\n\tlet response = {\r\n\t\tisValid: false,\r\n\t\tmessage: '',\r\n\t}\r\n\r\n\t// Define valid field types\r\n\tlet fieldTypes = getFieldTypes();\r\n\r\n\t// Set messages\r\n\tlet messages = {\r\n\t\tselect: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.select.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.select.invalid,\r\n\t\t},\r\n\t\ttext: {\r\n\t\t\tempty:   UncannyAutomator.i18n.validation.field.text.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.text.invalid,\r\n\t\t},\r\n\t\ttextarea: {\r\n\t\t\tempty:   UncannyAutomator.i18n.validation.field.textarea.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.textarea.invalid,\r\n\t\t},\r\n\t\tint: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.int.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.int.invalid,\r\n\t\t\tmultipleTokens: UncannyAutomator.i18n.validation.field.int.multipleTokens,\r\n\t\t},\r\n\t\tfloat: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.float.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.float.invalid,\r\n\t\t\tmultipleTokens: UncannyAutomator.i18n.validation.field.float.multipleTokens,\r\n\t\t},\r\n\t\temail: {\r\n\t\t\tempty:   UncannyAutomator.i18n.validation.field.email.empty,\r\n\t\t\tsingle:  {\r\n\t\t\t\tinvalid: UncannyAutomator.i18n.validation.field.email.single.invalid,\r\n\t\t\t\tmultipleTokens: UncannyAutomator.i18n.validation.field.email.single.multipleTokens,\r\n\t\t\t},\r\n\t\t\tmultiple: {\r\n\t\t\t\tinvalid: UncannyAutomator.i18n.validation.field.email.multiple.invalid,\r\n\t\t\t\tmultipleTokens: UncannyAutomator.i18n.validation.field.email.multiple.multipleTokens,\r\n\t\t\t}\t\r\n\t\t},\r\n\t\turl: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.url.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.url.invalid,\r\n\t\t},\r\n\t\tcheckbox: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.checkbox.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.checkbox.invalid,\r\n\t\t},\r\n\t\tradio: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.radio.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.radio.invalid,\r\n\t\t},\r\n\t\tdate: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.date.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.date.invalid,\r\n\t\t},\r\n\t\ttime: {\r\n\t\t\tempty: \t UncannyAutomator.i18n.validation.field.time.empty,\r\n\t\t\tinvalid: UncannyAutomator.i18n.validation.field.time.invalid,\r\n\t\t},\r\n\t\tinvalidType: UncannyAutomator.i18n.validation.field.invalidType,\r\n\t}\r\n\r\n\t// Check if it's a valid field type\r\n\tif ( inArray( fieldType, fieldTypes ) ){\r\n\t\t// Check if it's a checkbox and sanitaze the current value\r\n\t\tif ( fieldType == 'checkbox' && ! isEmpty( value ) ){\r\n\t\t\t// Check if the value is \"true\" or \"false\"\r\n\t\t\tif ( [ 'true', 'false' ].includes( value ) ){\r\n\t\t\t\t// Make it a boolean\r\n\t\t\t\tvalue = value == 'true' ? true : false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check if it's a required field and it's empty.\r\n\t\t// Show \"empty\" error\r\n\t\tif ( attributes.required && ( isEmpty( value ) || fieldType == 'checkbox' && value === false ) ){\r\n\t\t\tresponse.message = messages[ fieldType ].empty;\r\n\t\t}\r\n\t\t// Check if it isn't a required field and it's empty.\r\n\t\t// We don't have to validate it\r\n\t\telse if ( ! attributes.required && isEmpty( value ) ){\r\n\t\t\tresponse.isValid = true;\r\n\t\t}\r\n\t\t// The field has a value\r\n\t\telse if ( value != '' ){\r\n\t\t\t// This variable will be used multiple times in the following code. Let's define it here.\r\n\t\t\tlet tokensInString;\r\n\r\n\t\t\t// Check what's our field type.\r\n\t\t\tswitch ( fieldType ){\r\n\r\n\t\t\t\tcase 'select':\r\n\t\t\t\t\tresponse.isValid = true; \r\n\r\n\t\t\t\t\t// Check if the value is a custom value, if so, validate it\r\n\t\t\t\t\tif ( attributes.supportsCustomValue && value == 'automator_custom_value' ){\r\n\t\t\t\t\t\t// Get the child field\r\n\t\t\t\t\t\tconst $childrenFields = field.closest( '.form-element' ).find( '.form-element-children' );\r\n\r\n\t\t\t\t\t\t// Check if we found it\r\n\t\t\t\t\t\tif ( $childrenFields.length == 1 ){\r\n\t\t\t\t\t\t\t// Validate it and pass the result to the parent\r\n\t\t\t\t\t\t\tresponse.isValid = validateItemFields( $childrenFields, true ).isValid;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( response.isValid && isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'text':\r\n\t\t\t\tcase 'textarea':\r\n\t\t\t\t\tresponse.isValid = true;\r\n\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'int':\r\n\t\t\t\t\t// Regular expression to check if it's a valid int number\r\n\t\t\t\t\t// https://regex101.com/r/Gz3RvN/4\r\n\t\t\t\t\tlet int_regex = new RegExp(/^([+-]?[1-9]\\d*|0)$/gm);\r\n\r\n\t\t\t\t\t// Get tokens. Read getTokensFromString comments for more information\r\n\t\t\t\t\ttokensInString = getTokensFromString( value );\r\n\r\n\t\t\t\t\t// Create variable to simulate int (replace tokens)\r\n\t\t\t\t\tlet simulate_int;\r\n\r\n\t\t\t\t\t// Check if the string has tokens (and if it should support them)\r\n\t\t\t\t\tif ( attributes.supportsTokens && tokensInString.hasTokens ){\r\n\t\t\t\t\t\t// Check if the string has only one token. As we said before, this can be easily changed in future versions\r\n\t\t\t\t\t\tif ( tokensInString.tokens.length == 1 ){\r\n\t\t\t\t\t\t\t// If it has ONE token, and the field support it, then let's just make the data valid\r\n\t\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// We only support one token for now. Show multiple tokens error.\r\n\t\t\t\t\t\t\tresponse.message = messages.int.multipleTokens;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Doesn't have tokens, so we only have to perform the regular expression test\r\n\t\t\t\t\t\tif ( int_regex.test( value ) ){\r\n\t\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// Show \"invalid\" message\r\n\t\t\t\t\t\t\tresponse.message = messages.int.invalid;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Custom validation. Check if it's valid, if it isn't then do nothing\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( response.isValid && isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value, simulate_int );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'float':\r\n\t\t\t\t\t// Regular expression to check if it's a valid float number\r\n\t\t\t\t\t// https://regex101.com/r/KDLmre/2/\r\n\t\t\t\t\tlet float_regex = new RegExp(/^[+-]?((\\d+(\\.|\\,)?\\d*)|(\\.\\d+))$/gm);\r\n\r\n\t\t\t\t\t// Get tokens. Read getTokensFromString comments for more information\r\n\t\t\t\t\ttokensInString = getTokensFromString( value );\r\n\r\n\t\t\t\t\t// Create variable to simulate the float (replace tokens)\r\n\t\t\t\t\tlet simulate_float;\r\n\r\n\t\t\t\t\t// Check if the string has tokens (and if it should support them)\r\n\t\t\t\t\tif ( attributes.supportsTokens && tokensInString.hasTokens ){\r\n\t\t\t\t\t\t// Check if the string has only one token. As we said before, this can be easily changed in future versions\r\n\t\t\t\t\t\tif ( tokensInString.tokens.length == 1 ){\r\n\t\t\t\t\t\t\t// If it has ONE token, and the field support it, then let's just make the data valid\r\n\t\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// We only support one token for now. Show multiple tokens error.\r\n\t\t\t\t\t\t\tresponse.message = messages.float.multipleTokens;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Doesn't have tokens, so we only have to perform the regular expression test\r\n\t\t\t\t\t\tif ( float_regex.test( value ) ){\r\n\t\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// Show \"invalid\" message\r\n\t\t\t\t\t\t\tresponse.message = messages.float.invalid;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Custom validation. Check if it's valid, if it isn't then do nothing\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( response.isValid && isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value, simulate_float );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'email':\r\n\t\t\t\t\t// Regular expression to check if it's a valid email address\r\n\t\t\t\t\t// https://regex101.com/r/ThUWEz/1/\r\n\t\t\t\t\tlet email_regex = new RegExp(/^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/);\r\n\r\n\t\t\t\t\t// Create array with all the emails we have to validate\r\n\t\t\t\t\t// We're going to check if the user is trying to validate more than one searching for a comma in the input value\r\n\t\t\t\t\t// In that case, we're going to split the value and get an array with emails, otherwise we're going to create an array with one element: the input value\r\n\t\t\t\t\t// Doing that we can use the same code for both cases\r\n\t\t\t\t\tlet emails = [];\r\n\r\n\t\t\t\t\t// Check if the user wants to validate multiple emails\r\n\t\t\t\t\tif ( value.includes( ',' ) ){\r\n\t\t\t\t\t\temails = value.split( ',' );\r\n\r\n\t\t\t\t\t\t// Remove whitespace from both sides of each email, just in case the user wrote \", \" or \" ,\" instead of \",\"\r\n\t\t\t\t\t\t$.each( emails, function( index, email ){\r\n\t\t\t\t\t\t\temails[ index ] = email.trim();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Add value, but remove whitespace from both sides before\r\n\t\t\t\t\t\temails.push( value.trim() );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get tokens. Read getTokensFromString comments for more information\r\n\t\t\t\t\ttokensInString = getTokensFromString( value );\r\n\r\n\t\t\t\t\t// Create variable to simulate the email (replace tokens)\r\n\t\t\t\t\tlet simulate_email;\r\n\t\t\t\t\t\r\n\t\t\t\t\t// We're going to use this variable to validate all the emails in a loop. TRUE by default, FALSE if at least one of them fails.\r\n\t\t\t\t\tlet allEmailsAreValid = true;\r\n\r\n\t\t\t\t\t// Create variable used to know if there is more than one email\r\n\t\t\t\t\tlet hasMultipleEmails = emails.length > 1;\r\n\r\n\t\t\t\t\t// Check if the string has tokens\r\n\t\t\t\t\tif ( attributes.supportsTokens && tokensInString.hasTokens ){\r\n\t\t\t\t\t\t// Create variable to check if the error was due to multiple variables\r\n\t\t\t\t\t\tlet hasMultipleVariables = false;\r\n\r\n\t\t\t\t\t\t// Iterate each email\r\n\t\t\t\t\t\t$.each( emails, function( index, email ){\r\n\t\t\t\t\t\t\t// Get tokens from this specific email\r\n\t\t\t\t\t\t\ttokensInString = getTokensFromString( email );\r\n\r\n\t\t\t\t\t\t\t// Check if the string has only one token. As we said before, this can be easily changed in future versions\r\n\t\t\t\t\t\t\tif ( tokensInString.tokens.length <= 1 ){\r\n\t\t\t\t\t\t\t\t// If it has ONE token, and the field support it, then let's just make the data valid\r\n\t\t\t\t\t\t\t\t// In this case, we have to do nothing\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t// Change value of hasMultipleVariables. We're going to use this to show a \"Multiple Tokens\" error\r\n\t\t\t\t\t\t\t\thasMultipleVariables = true;\r\n\r\n\t\t\t\t\t\t\t\t// Return false, we don't have to continue checking\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Check result of iteration\r\n\t\t\t\t\t\tif ( allEmailsAreValid && ! hasMultipleVariables ){\r\n\t\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tif ( hasMultipleVariables ){\r\n\t\t\t\t\t\t\t\t// We only support one token for now. Show multiple tokens error.\r\n\t\t\t\t\t\t\t\tif ( hasMultipleEmails ){\r\n\t\t\t\t\t\t\t\t\tresponse.message = messages.email.multiple.multipleTokens;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tresponse.message = messages.email.single.multipleTokens;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t// Show \"invalid\" message\r\n\t\t\t\t\t\t\t\tif ( hasMultipleEmails ){\r\n\t\t\t\t\t\t\t\t\tresponse.message = messages.email.multiple.invalid;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tresponse.message = messages.email.single.invalid;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Doesn't have tokens, so we only have to perform the regular expression test in each email\r\n\t\t\t\t\t\t$.each( emails, function( index, email ){\r\n\t\t\t\t\t\t\t// Do regex\r\n\t\t\t\t\t\t\tif ( ! email_regex.test( email ) ){\r\n\t\t\t\t\t\t\t\t// If one is valid, all are invalid\r\n\t\t\t\t\t\t\t\tallEmailsAreValid = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Check result of iteration\r\n\t\t\t\t\t\tif ( allEmailsAreValid ){\r\n\t\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// Show \"invalid\" message\r\n\t\t\t\t\t\t\tif ( hasMultipleEmails ){\r\n\t\t\t\t\t\t\t\tresponse.message = messages.email.multiple.invalid;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tresponse.message = messages.email.single.invalid;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Custom validation. Check if it's valid, if it isn't then do nothing\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( response.isValid && isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value, simulate_email );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'url':\r\n\t\t\t\t\t// This will try to return a valid URL, but can fail, so we have to verify. Read parseURL comments for more information\r\n\t\t\t\t\tlet validateURL = parseURL( value, attributes );\r\n\r\n\t\t\t\t\t// Check if the URL is valid\r\n\t\t\t\t\tif ( validateURL.isValid ){\r\n\t\t\t\t\t\tresponse.isValid = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Show \"invalid\" message\r\n\t\t\t\t\t\tresponse.message = messages.invalidType;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Custom validation. Check if it's valid, if it isn't then do nothing\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( response.isValid && isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value, validateURL.simulatedURL );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\tresponse.isValid = true;\r\n\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'radio':\r\n\t\t\t\t\tresponse.isValid = true;\r\n\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\t\t// TODO validation\r\n\t\t\t\tcase 'date':\r\n\t\t\t\t\tresponse.isValid = true;\r\n\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t// TODO validation\r\n\t\t\t\tcase 'time':\r\n\t\t\t\t\tresponse.isValid = true;\r\n\r\n\t\t\t\t\t// Check if we have to do a custom validation\r\n\t\t\t\t\tif ( isDefined( customValidationFunction ) ){\r\n\t\t\t\t\t\t// Do custom validation\r\n\t\t\t\t\t\tlet customValidation = customValidationFunction( value );\r\n\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\tresponse.isValid = customValidation.isValid;\r\n\r\n\t\t\t\t\t\t// If it isn't then add message\r\n\t\t\t\t\t\tif ( ! customValidation.isValid ){\r\n\t\t\t\t\t\t\tresponse.message = customValidation.message;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t// The field type doesn't match\r\n\t\t\t\t\tresponse.isValid = false;\r\n\t\t\t\t\tresponse.message = '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tresponse.message = messages[ 'invalidType' ];\r\n\t}\r\n\r\n\t// Add CSS classes to elements showing or hiding the error state\r\n\t// .form-element will have form-element--success or form-element--error classes\r\n\t// The message will be shown in the .form-element__error element\r\n\tif ( ! isEmpty( field ) ){\r\n\t\tlet $container = field.closest( '.form-element' );\r\n\t\tlet $error_container = $container.find( '.form-element__error' ).filter(function(){\r\n\t\t\treturn $( this ).closest( '.form-element' ).is( $container );\r\n\t\t});\r\n\r\n\t\tif ( ! response.isValid ){\r\n\t\t\t$container.removeClass( 'form-element--success' );\r\n\t\t\t$container.addClass( 'form-element--error' );\r\n\t\t}\r\n\t\telse {\r\n\t\t\t$container.removeClass( 'form-element--error' );\r\n\t\t\t$container.addClass( 'form-element--success' );\r\n\t\t}\r\n\r\n\t\tif ( response.message != '' ){\r\n\t\t\t$error_container.addClass( 'form-element__error--show' );\r\n\t\t\t$error_container.text( response.message );\r\n\t\t}\r\n\t\telse {\r\n\t\t\t$error_container.removeClass( 'form-element__error--show' );\r\n\t\t\t$error_container.text('');\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Get all the valid tokens from a string.\r\n * It compares the tokens in the string with the valid tokens in the system and only returns the valid ones.\r\n * Ex: \"Lorem ipsum {{valid_token}} dolor {{invalid_token}}\" returns tokens = [ 'valid_token' ]\r\n *\r\n * @since 0.1\r\n *\r\n * @param  {string} \tstring - A normal string with tokens (or not, response.tokens will return an empty array, that's all)\r\n *\r\n * @return {object}\r\n * @return {boolean} \tresponse.hasTokens - TRUE if there is at least one token\r\n * @return {array} \t\tresponse.tokens - Array with all the tokens on the string\r\n */\r\n\r\nexport function getTokensFromString( string ){\r\n\t// Create response object\r\n\tlet response = {\r\n\t\thasTokens: false,\r\n\t\ttokens: [],\r\n\t};\r\n\r\n\t// Regex to find text between double curly brackets\r\n\t// https://regex101.com/r/TecqPq/1\r\n\tlet regex = new RegExp(/\\{\\{(.*?)\\}\\}/gm);\r\n\t\r\n\t// Get all valid tokens. Read getTokens comments for more information\r\n\tlet allTokens = new Tokens( null, null, {\r\n\t\tincludeGroupName: false,\r\n\t\tincludeGroupIcon: false,\r\n\t}).tokens;\r\n\r\n\t// Check if the string attribute is defined\r\n\tif ( isDefined( string ) ){\r\n\t\t// Check if the string attribute is empty, in that case just ignore it\r\n\t\tif ( ! isEmpty( string ) ){\r\n\t\t\t// Check if the token is a string, if not, convert it\r\n\t\t\tif ( ! isString( string ) ){\r\n\t\t\t\tstring = string.toString();\r\n\t\t\t}\r\n\r\n\t\t\t// Create array that will store the tokens\r\n\t\t\tlet tokens = [];\r\n\r\n\t\t\t// Perform the regex check.\r\n\t\t\tlet match;\r\n\t\t\twhile ( ( match = regex.exec( string ) ) !== null ){\r\n\t\t\t\tlet matchedToken = match[ 1 ];\r\n\r\n\t\t\t\t// Check if it's an \"smart\" token. Those where you can modify the ID of it and get different data.\r\n\t\t\t\tif ( \r\n\t\t\t\t\tmatchedToken.startsWith( 'USERMETA:' )\r\n\t\t\t\t\t|| matchedToken.startsWith( 'POSTMETA:' )\r\n\t\t\t\t){\r\n\t\t\t\t\t// Push the token as valid\r\n\t\t\t\t\ttokens.push( matchedToken );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Check if the token is defined in the main tokens object, if it's is then it's a valid token and we have to add it to the tokens array\r\n\t\t\t\t\t$.each( allTokens, ( index, tokenGroup ) => {\r\n\t\t\t\t\t\t$.each( tokenGroup.tokens, ( index, token ) => {\r\n\t\t\t\t\t\t\tif ( matchedToken == token.id ){\r\n\t\t\t\t\t\t\t\ttokens.push( token );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tresponse.tokens = tokens;\r\n\r\n\t\t\t// Check if the string has at least one token\r\n\t\t\tif ( response.tokens.length > 0 ){\r\n\t\t\t\tresponse.hasTokens = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\t// Show error in the console\r\n\t\tconsole.error( 'Undefined string attribute' );\r\n\t}\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * Replace tokens in a string with dummy valid values to check if it's valid.\r\n * This is a simple way to validate if strings like {{site_url}} is a valid URL.\r\n * There is going to be another validation in the backend before doing actions\r\n * Ex: {{site_url}}/relative_path gets converted to https://example.com/relative_path\r\n *\r\n * @since 0.1\r\n *\r\n * @param  {string} string - A normal string with tokens (or not, the returned string will be the same, that's all)\r\n *\r\n * @return {string}\tThe new string with dummy data\r\n */\r\n\r\nexport function replaceTokensInString( string ){\r\n\t// Create variable that will hold the new string\r\n\t// The default value is the original string. We are going to check if the string has tokens,\r\n\t// and if it doesn't then we just return the same original string\r\n\tlet output = string;\r\n\r\n\t// Get tokens. Read getTokensFromString comments for more information\r\n\tlet tokensInString = getTokensFromString( string );\r\n\r\n\t// Check if this string has tokens\r\n\tif ( tokensInString.hasTokens ){\r\n\r\n\t\t// Iterate through each token\r\n\t\t$.each( tokensInString.tokens, function( index, token ){\r\n\t\t\t// Remember that each token has a token group id and a token id\r\n\t\t\t// For example, in {{WORDPRESS_1:order_id}} WORDPRESS_1 is the token group id and order_id is the token id\r\n\t\t\t// We have the token group id and the token id in different object properties, and we need to create the original (complete) token string again\r\n\r\n\t\t\t// Escape regex characters\r\n\t\t\tlet regexCondition = token.id.replace( /[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&' );\r\n\r\n\t\t\t// Create tokenCode variable, this will store the first part (token group id)\r\n\t\t\tregexCondition = vsprintf( '{{%s}}', [ regexCondition ] );\r\n\r\n\t\t\t// Create regular expression to find all appearances of the token in the string\r\n\t\t\t// https://regex101.com/r/AWKmKp/1\r\n\t\t\tlet regex = new RegExp( regexCondition, 'g' );\r\n\r\n\t\t\t// Use regex to replace all appaerences with a dummy value\r\n\t\t\toutput = output.replace( regex, function( full_match, group ){\r\n\t\t\t\t// Get dummy value using the fieldType. Read getExampleValueByFieldType comments for more information\r\n\r\n\t\t\t\treturn getExampleValueByFieldType( token.type );\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\treturn output;\r\n}\r\n\r\n/**\r\n * Get a dummy value given a fieldType\r\n * This function is useful for validation functions. We don't know in the recipe creating process if a token will store a correct value,\r\n * but we can use the token type to check if an email, url, int, float or other field type values are valid when they include a token.\r\n * For example, using this function we can know that {{site_url}}/profile/?user_id={{user_id}} is a valid url\r\n * \r\n * @since 0.1\r\n * \r\n * @param {string} \tfieldType - A valid field type\r\n *\r\n * @return {string} A valid dummy value for that field type\r\n */\r\n\r\nexport function getExampleValueByFieldType( fieldType ){\r\n\tlet value = '';\r\n\r\n\tswitch( fieldType ){\r\n\r\n\t\tcase 'select':\r\n\t\t\tvalue = 'option';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'text':\r\n\t\t\tvalue = 'lorem-ipsum';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'textarea':\r\n\t\t\tvalue = '<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum finibus eros nunc, et posuere libero posuere a. Nam viverra mattis finibus. Aenean purus lorem, mollis vel ullamcorper ac</p>';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'int':\r\n\t\t\tvalue = 1;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'float':\r\n\t\t\tvalue = 1.1;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'url':\r\n\t\t\tvalue = 'https://example.com';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'email':\r\n\t\t\tvalue = 'example@example.com';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'checkbox':\r\n\t\t\tvalue = true;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'radio':\r\n\t\t\tvalue = 'option';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'date':\r\n\t\t\tvalue = '2021-12-31';\r\n\t\t\tbreak;\r\n\r\n\t\tcase '':\r\n\t\t\tvalue = '01:00 PM';\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn value;\r\n}\r\n\r\n/**\r\n * Convert an invalid url into a valid one.\r\n * This function checks if the url is valid, if it is then it returns the url without modifying it, but if it is not then adds\r\n * the {{site_url}} before the string. It also checks if the string starts with / or not to recognize relative paths\r\n * Examples:\r\n * string \t\t\t\t=> {{site_url}}/string\r\n * /string \t\t\t\t=> {{site_url}}/string\r\n * https://google.com \t=> https://google.com\r\n * {{non_url_token}} \t=> {{site_url}}/{{non_url_token}}\r\n * /?id={{id}} \t\t\t=> {{site_url}}/?id={{id}}\r\n * \r\n * @since 0.1\r\n *\r\n * @param {string} \t\turl - The url\r\n * @param {object} \t\tattributes - URL attributes\r\n * @param {boolean} \tattributes.supportsTokens - TRUE if the URL should support tokens\r\n *\r\n * @return {object}\r\n * @return {boolean} \tresponse.changed - TRUE if the returned URL is different from the original one\r\n * @return {boolean} \tresponse.isValid - TRUE if the URL is valid\r\n * @return {string} \tresponse.newURL - New valid URL. If the URL was already valid then it just have the original URL\r\n * @return {string} \tresponse.simulatedURL - Simulated URL\r\n */\r\n\r\nexport function parseURL( url, attributes = { supportsTokens: false } ){\r\n\t// Create response object\r\n\tlet response = {\r\n\t\tchanged: false,\r\n\t\tisValid: false,\r\n\t\tnewURL: null,\r\n\t\tsimulatedURL: null\r\n\t}\r\n\r\n\t// Replace all spaces with %20\r\n\turl = url.replace( / /g, '%20' );\r\n\r\n\t// Create regular expression to be used to check if an URL is valid\r\n\t// https://regex101.com/r/0TFlPM/1/\r\n\tlet regexURL = new RegExp( \"^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?\" );\r\n\r\n\t// Get tokens. Read getTokensFromString comments for more information\r\n\tlet tokensInValue = getTokensFromString( url );\r\n\r\n\t// Create variable that will store the new URL. The default value is the original URL because we're going to compare\r\n\t// this variable with the \"url\" variable. If both are the same then we know that the original value wasn't modified and it was already valid\r\n\tlet newURL = url;\r\n\r\n\t// Check if it supports tokens and has tokens\r\n\tif ( attributes.supportsTokens && tokensInValue.hasTokens ){\r\n\t\t// Replace tokens in string with dummy values. Read replaceTokensInString comments for more information\r\n\t\tlet simulate_url = replaceTokensInString( url );\r\n\t\tresponse.simulatedURL = simulate_url;\r\n\r\n\t\t// Check if it's a valid URL\r\n\t\tif ( regexURL.test( simulate_url ) ){\r\n\t\t\tresponse.isValid = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// It's not valid, so now we have to create a valid one\r\n\t\t\t// Check if it starts with /\r\n\t\t\tif ( url[0] == '/' ){\r\n\t\t\t\t// In that case we only have to prepend the site URL to it\r\n\t\t\t\tnewURL = UncannyAutomator.siteURL + url;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// If it doesn't start with / then add it\r\n\t\t\t\tnewURL = UncannyAutomator.siteURL + '/' + url;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it's a valid URL now\r\n\t\t\tif ( regexURL.test( newURL ) ){\r\n\t\t\t\tresponse.isValid = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\t// URL without tokens, check if it's a valid\r\n\t\tif ( regexURL.test( url ) ){\r\n\t\t\tresponse.isValid = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// It's not valid, so now we have to create a valid one\r\n\t\t\t// Check if it starts with /\r\n\t\t\tif ( url[0] == '/' ){\r\n\t\t\t\t// In that case we only have to prepend the site URL to it\r\n\t\t\t\tnewURL = UncannyAutomator.siteURL + url;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// If it doesn't start with / then add it\r\n\t\t\t\tnewURL = UncannyAutomator.siteURL + '/' + url;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it's a valid URL now\r\n\t\t\tif ( regexURL.test( newURL ) ){\r\n\t\t\t\tresponse.isValid = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tresponse.newURL = newURL;\r\n\r\n\t// Check if the newURL it's the same as the original URL. \r\n\t// If both are the same then we know that the original value wasn't modified and it was already valid\r\n\tif ( response.newURL != url ){\r\n\t\tresponse.changed = true;\r\n\t}\r\n\r\n\treturn response;\r\n}\r\n\r\n/**\r\n * jQuery plugin used to validate the URL fields while user writes a value (input event)\r\n * If the value is not valid then it shows to the user how the URL is going to be converted\r\n * in the plugin to make it valid. Check parseURL comments to learn more about how a URL can be changed.\r\n *\r\n * @since 0.1\r\n *\r\n * @return {object} jQuery Object\r\n */\r\n\r\n(function ($){\r\n\t$.fn.checkURL = function ( options ){\r\n\t\treturn this.each( function (){\r\n\t\t\t// Just for version 0.1 and 0.2 we are not fixing the URL, instead we're only checking if the original value is a valid URL\r\n\t\t\t// This has to be uncommented\r\n\r\n\t\t\t// Get current jQuery object\r\n\t\t\tlet $this = $(this);\r\n\r\n\t\t\t// Overwrite default settings with the ones given by the user\r\n\t\t\tlet settings = $.extend({\r\n\t\t\t\t'preURL': 'Final URL: '\r\n\t\t\t}, options);\r\n\r\n\t\t\t// Create object with useful jQuery objects\r\n\t\t\tlet elements = {\r\n\t\t\t\tcontainer:  $this,\r\n\t\t\t\tinput: \t\t$this.find( '.form-element__input' ),\r\n\t\t\t}\r\n\r\n\t\t\t// Get input attributes\r\n\t\t\tlet input_attributes = {\r\n\t\t\t\trequired: \t\t\telements.input.data( 'required' ),\r\n\t\t\t\tsupportsTokens: \telements.input.data( 'supportstokens' )\r\n\t\t\t}\r\n\r\n\t\t\t// Create DOM elements that will show the final URL to the user\r\n\t\t\tlet validationNotice = $( '<div/>', { 'class': 'form-input-url-notice' });\r\n\t\t\tlet validationNoticeHeader = $( '<div/>', { 'class': 'form-input-url-notice__header' });\r\n\t\t\tlet validationNoticeURL = $( '<div/>', { 'class': 'form-input-url-notice__url' });\r\n\r\n\t\t\tvalidationNoticeHeader.text( settings.preURL );\r\n\t\t\tvalidationNoticeHeader.appendTo( validationNotice );\r\n\t\t\tvalidationNoticeURL.appendTo( validationNotice );\r\n\t\t\tvalidationNotice.appendTo( elements.container );\r\n\r\n\t\t\t// Function to check if the URL is valid\r\n\t\t\tfunction validate( value ){\r\n\t\t\t\tlet url = parseURL( value, input_attributes );\r\n\r\n\t\t\t\t// If the URL is different then show the \"Final URL\" container\r\n\t\t\t\tif ( value != '' && url.isValid && url.changed ){\r\n\t\t\t\t\tvalidationNotice.addClass( 'form-input-url-notice--show' );\r\n\t\t\t\t\tvalidationNoticeURL.text( url.newURL );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvalidationNotice.removeClass( 'form-input-url-notice--show' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check on page load to verify if the default value will be converted\r\n\t\t\tif ( elements.input.val() != '' ){\r\n\t\t\t\tvalidate( elements.input.val() );\r\n\t\t\t}\r\n\r\n\t\t\t// Bind input event and invoke validate\r\n\t\t\telements.container.on( 'automator:field:change', function(){\r\n\t\t\t\tvalidate( elements.input.val() );\r\n\t\t\t});\r\n\r\n\t\t\treturn this;\r\n\t\t});\r\n\t}\r\n}(jQuery));\r\n\r\n/**\r\n * Call checkURL jQuery plugin in each URL field\r\n *\r\n * @since 0.1\r\n *\r\n * @param {...objects} \tfields - jQuery objects \r\n *\r\n * @return {object} jQuery object\r\n */\r\n\r\nexport function initURLChecker( fields ){\r\n\tfields.checkURL();\r\n}","import $ from 'jquery';\r\n\r\nimport {\r\n\tgetItemsByIntegration,\r\n\tgetDOMElements,\r\n    restCall,\r\n    isDefined,\r\n    isEmpty,\r\n    replaceCurlyBraces,\r\n    addParametersToURL\r\n} from './Utilities.js';\r\n\r\nimport ItemCreatorIntegrations from './ItemCreatorIntegrations.js';\r\n\r\nimport ItemHeaderMenu from './ItemHeaderMenu.js';\r\nimport ItemHeaderIcon from './ItemHeaderIcon.js';\r\nimport ItemHeaderTag  from './ItemHeaderTag.js';\r\n\r\nimport Triggers \t  from './Triggers.js';\r\nimport Actions \t\t  from './Actions.js';\r\n\r\nclass itemCreatorTaskSelector {\r\n\tconstructor( itemType, integrationID, $currentItem ){\r\n\t\tthis.itemType \t\t= itemType;\r\n\t\tthis.integrationID \t= integrationID;\r\n\t\tthis.$currentItem \t= $currentItem;\r\n\r\n\t\t// Render DOM elements\r\n\t\tthis.render();\r\n\t}\r\n\r\n\trender(){\r\n\t\t// Create $container\r\n\t\tthis.$container = $( `<div class=\"item\"></div>` );\r\n\t\tthis.$item = this.$container;\r\n\r\n\t\tthis.createHeader();\r\n\t\tthis.createItemsList();\r\n\r\n        this.$currentItem.replaceWith( this.$container );\r\n\t}\r\n\r\n\tcreateHeader(){\r\n\t\tconst $header = $( `\r\n\t\t\t<div>\r\n\t\t\t\t<div class=\"item-title uap-clear\">\r\n\t\t\t\t\t<div class=\"item-title__describe\">\r\n\t\t\t\t\t\t<div class=\"item-title__non-editable\">\r\n\t\t\t\t\t\t\t${ this.itemType == 'trigger' ? UncannyAutomator.i18n.trigger.select : UncannyAutomator.i18n.action.select }\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Add the item actions (the three dots)\r\n        let $itemActions = new ItemHeaderMenu( this.itemType );\r\n        $header.append( $itemActions );\r\n\r\n        // Add the item icon\r\n        let $itemIcon = new ItemHeaderIcon( this.integrationID );\r\n        $header.append( $itemIcon );\r\n\r\n        // Add the integration tag\r\n        let $integrationTag = new ItemHeaderTag( this.integrationID );\r\n        $header.find( '.item-title' ).prepend( $integrationTag );\r\n\r\n        // Append the header to the main container\r\n        this.$container.append( $header );\r\n\t}\r\n\r\n\tcreateItemsList(){\r\n\t\tlet items, searchPlaceholder, unlockItems;\r\n\r\n\t\t// Get data depending on the item type\r\n\t\tif ( this.itemType == 'trigger' ){\r\n\t\t\titems \t           = getItemsByIntegration( this.integrationID, 'triggers' );\r\n\t\t\tsearchPlaceholder  = UncannyAutomator.i18n.trigger.search;\r\n\t\t\tunlockItems        = UncannyAutomator.i18n.proOnly.unlockTriggers;\r\n\t\t}\r\n\t\telse if ( this.itemType == 'action' ){\r\n\t\t\titems              = getItemsByIntegration( this.integrationID, 'actions' );\r\n\t\t\tsearchPlaceholder  = UncannyAutomator.i18n.action.search;\r\n\t\t\tunlockItems        = UncannyAutomator.i18n.proOnly.unlockActions;\r\n\t\t}\r\n\r\n\t\t// Create the main container\r\n\t\tconst $container   = $( `\r\n\t\t\t<div class=\"item__content\">\r\n\t\t\t\t<div class=\"item-options item-options--nopadding item-options--noborder\">\r\n\t\t\t\t\t<div class=\"form-element\">\r\n\t\t\t\t\t\t<div class=\"item__task-selector\">\r\n\t\t\t\t\t\t\t<div class=\"item-task-selector__search\">\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\t\tclass=\"item-task-selector__search-input\"\r\n\t\t\t\t\t\t\t\t\tplaceholder=\"${ searchPlaceholder }\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"item-task-selector__options\">\r\n\t\t\t\t\t\t\t\t<div class=\"item-task-selector-options__group item-task-selector-options__group--available\"></div>\r\n\t\t\t\t\t\t\t\t<div class=\"item-task-selector-options__group item-task-selector-options__group--unavailable\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"item-task-selector-options__group-items\"></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class=\"item-task-selector__option item-task-selector__option--no-results item-task-selector__option--hide\">\r\n\t\t\t\t\t\t\t\t\t${ UncannyAutomator.i18n.noResults }\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t` );\r\n\r\n\t\t// Get important elements\r\n\t\tconst $optionsContainer = $container.find( '.item-options' ),\r\n\t\t      $taskSelector     = $container.find( '.item__task-selector' ),\r\n\t\t      $searchField      = $container.find( '.item-task-selector__search-input' ),\r\n\t\t      $itemsList        = {\r\n\t\t      \tcontainer: $container.find( '.item-task-selector__options' ),\r\n\t\t      \tavailable: $container.find( '.item-task-selector-options__group--available' ),\r\n\t\t      \tunavailable: {\r\n\t\t      \t\tcontainer: $container.find( '.item-task-selector-options__group--unavailable' ),\r\n\t\t      \t\tlist:      $container.find( '.item-task-selector-options__group-items' )\r\n\t\t      \t},\r\n\t\t      \tnoResults: $container.find( '.item-task-selector__option--no-results' )\r\n\t\t      };\r\n\r\n\t\t// Check if it has available items\r\n\t\tif ( items.hasAvailableItems ){\r\n\t\t\t// Append available items to the list container\r\n\t\t\t$itemsList.available.append( items.available.map(( item ) => {\r\n\t\t\t\t// Check if it's a Pro item\r\n\t\t\t\tconst isPro = item.is_pro;\r\n\r\n\t\t\t\t// Create container\r\n\t\t\t\tconst $item = $( `\r\n\t\t\t\t\t<div class=\"item-task-selector__option ${ isPro ? 'item-task-selector__option--pro' : '' }\"\r\n\t\t\t\t\t\tdata-search=\"${ item.select_option_name.toLowerCase().replace( /\\s+|{|}/g, '' ) }\">\r\n\t\t\t\t\t\t${ replaceCurlyBraces( item.select_option_name, '<span class=\"item-task-selector__option-variable\">', '</span>' ) }\r\n\t\t\t\t\t\t${ isPro ? `<span class=\"item-task-selector-option__badge\">${ UncannyAutomator.i18n.proOnly.pro }</span>` : '' }\r\n\t\t\t\t\t</div>\r\n\t\t\t\t` );\r\n\r\n\t\t\t\t// Listen clicks on the container\r\n\t\t\t\t$item.on( 'click', () => {\r\n\t\t\t\t\t// Add loading class to the parent container\r\n\t\t\t\t\t$taskSelector.addClass( 'item__task-selector--loading' );\r\n\r\n\t\t\t\t\t// Add loading class to the container\r\n\t\t\t\t\t$item.addClass( 'item-task-selector__option--loading' );\r\n\r\n\t\t\t\t\t// Get the correct request code\r\n\t\t\t\t\tconst restRequestCode = [ 'trigger', 'action' ].includes( this.itemType ) ? `add-new-${ this.itemType }` : '';\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Save the value of the fields with default values\r\n\t\t\t\t\t// in the item meta\r\n\t\t\t\t\tlet defaultMeta = {}\r\n\t\t\t\t\t$.each( item.options, ( index, option ) => {\r\n\t\t\t\t\t\tif ( isDefined( option.default_value ) ){\r\n\t\t\t\t\t\t\tdefaultMeta[ option.option_code ] = option.default_value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Check if the trigger is an anonymous trigger\r\n\t\t\t\t\tif ( item.type == 'anonymous' ){\r\n\t\t\t\t\t\t// Save the \"can_log_in_new_user\" value\r\n\t\t\t\t\t\tdefaultMeta.can_log_in_new_user = isDefined( item.can_log_in_new_user ) ? item.can_log_in_new_user : true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Do REST call to add the item\r\n\t\t\t\t\trestCall( 'add', {\r\n\t\t\t\t\t\trecipePostID: UncannyAutomator.recipe.id,\r\n\t\t\t\t\t\taction:       restRequestCode,\r\n\t\t\t\t\t\titem_code:    item.code,\r\n\t\t\t\t\t\tdefault_meta: $.extend( {}, defaultMeta, {\r\n\t\t\t\t\t\t\tintegration_name: UncannyAutomator.integrations[ this.integrationID ].name,\r\n\t\t\t\t\t\t\tsentence: \t\t  item.sentence\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, ( response ) => {\r\n\t\t\t\t\t\t// Render both metaboxes again\r\n\t\t\t\t\t\t// This will close the options panel if it's opened\r\n\t\t\t\t\t\tnew Triggers();\r\n\t\t\t\t\t\tnew Actions();\r\n\r\n\t\t\t\t\t\t/*\r\n\t\t\t\t\t\tif ( this.itemType == 'trigger' ){\r\n\t\t\t\t\t\t\tnew Triggers();\r\n\r\n\t\t\t\t\t\t\t// Check if it's an anonymous recipe\r\n\t                        if ( UncannyAutomator.recipe.type == 'anonymous' ){\r\n\t                        \t// Render the Actions metabox again\r\n\t                        \t// We're doing this because we need to update the user selector\r\n\t                        \tnew Actions();\r\n\t                        }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ( this.itemType == 'action' ){\r\n\t\t\t\t\t\t\tnew Actions();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t*/\r\n\r\n\t\t\t\t\t\t// Check if the ID of the new item is defined\r\n\t\t\t\t\t\tif ( isDefined( response.post_ID ) ){\r\n\t\t\t\t\t\t\t// Get item form element\r\n\t\t\t\t\t\t\tconst $newItem = getDOMElements( 'item', {\r\n\t\t\t\t\t\t\t\tid: response.post_ID\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// Determine if the item is already valid\r\n\t\t\t\t\t\t\t// This will be true only if the new item doesn't have\r\n\t\t\t\t\t\t\t// options, or all the options have a default value\r\n\t\t\t\t\t\t\tconst isValid = UncannyAutomator.recipe.items[ response.post_ID ].isValid;\r\n\r\n\t\t\t\t\t\t\t// Check if it's valid\r\n\t\t\t\t\t\t\tif ( isValid ){\r\n\t\t\t\t\t\t\t\t// Check if the recipe is NOT live\r\n\t\t\t\t\t\t\t\tif ( ! UncannyAutomator.recipe.isLive ){\r\n\t\t\t\t\t\t\t\t\t// Set the item to live\r\n\t\t\t\t\t\t\t\t\t$newItem.item\r\n\t\t\t\t\t\t\t\t\t\t.find( '.item-status input[type=\"checkbox\"]' )\r\n\t\t\t\t\t\t\t\t\t\t.prop( 'checked', true )\r\n\t\t\t\t\t\t\t\t\t\t.trigger( 'change' );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t// Get first token and trigger a click\r\n\t\t\t\t\t\t\t\t// This will open the first group of options\r\n\t\t\t\t\t\t\t\t$newItem.item\r\n\t\t\t\t\t\t\t\t\t.find( '.item-title__token:not(.item-title__token--filled)' )\r\n\t\t\t\t\t\t\t\t\t.first()\r\n\t\t\t\t\t\t\t\t\t.trigger( 'click' );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, ( response ) => {\r\n\t\t\t\t\t\tconsole.log( '‼️ ERROR-TODO. Couldn\\'t add the item' );\r\n\r\n\t\t\t\t\t\t// Remove loading class to the parent container\r\n\t\t\t\t\t\t$taskSelector.removeClass( 'item__task-selector--loading' );\r\n\r\n\t\t\t\t\t\t// Remove loading class to the container\r\n\t\t\t\t\t\t$item.removeClass( 'item-task-selector__option--loading' );\r\n\r\n\t\t\t\t\t\t// Check if it's an invalid action\r\n\t\t\t\t\t\tif ( response.success == false ){\r\n\t\t\t\t\t\t\tnew Triggers();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Return the\r\n\t\t\t\treturn $item;\r\n\t\t\t}));\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Remove the available items container\r\n\t\t\t$itemsList.available.remove();\r\n\t\t}\r\n\r\n\t\t// Check if it has unavailable items\r\n\t\tif ( items.hasUnavailableItems ){\r\n\t\t\t// Append unavailable items to the list container\r\n\t\t\t$itemsList.unavailable.list.append( items.unavailable.map(( item ) => {\r\n\r\n\t\t\t\t// Create the UTM medium\r\n\t\t\t\tconst utm_medium = `unavailable_item-${ this.integrationID }-${ this.integrationID }_${ replaceCurlyBraces( item.name, '', '' ).toLowerCase().replace( /\\s+|{|}/g, '_' ) }`;\r\n\r\n\t\t\t\t// Create container\r\n\t\t\t\tconst $item = $( `\r\n\t\t\t\t\t<a href=\"${ addParametersToURL( 'https://automatorplugin.com/pricing/', {\r\n\t\t\t\t\t\t    'utm_source':   'uncanny_automator',\r\n\t\t\t\t\t\t    'utm_medium':   'select_an_item',\r\n\t\t\t\t\t\t    'utm_campaign': 'update_to_pro',\r\n\t\t\t\t\t\t    'utm_content':  utm_medium,\r\n\t\t\t\t\t\t}) }\"\r\n\t\t\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\t\t\tclass=\"item-task-selector__option item-task-selector__option--pro\"\r\n\t\t\t\t\t\tdata-search=\"${ item.name.toLowerCase().replace( /\\s+|{|}/g, '' ) }\">\r\n\t\t\t\t\t\t<span class=\"uo-icon uo-icon--lock-alt\"></span>\r\n\t\t\t\t\t\t${ replaceCurlyBraces( item.name, '<span class=\"item-task-selector__option-variable\">', '</span>' ) }\r\n\t\t\t\t\t\t<span class=\"item-task-selector-option__badge\">${ UncannyAutomator.i18n.proOnly.pro }</span>\r\n\t\t\t\t\t</a>\r\n\t\t\t\t` );\r\n\r\n\t\t\t\treturn $item;\r\n\t\t\t}));\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Remove the unavailable items container\r\n\t\t\t$itemsList.unavailable.container.remove();\r\n\t\t}\r\n\r\n\t\t// Get the list of items\r\n\t\tconst $items = $itemsList.container.find( '.item-task-selector__option:not(.item-task-selector__option--no-results)' );\r\n\r\n\t\t// Listen changes on the search field\r\n        $searchField.on( 'input', () => {\r\n        \t// Get the current value\r\n            const query = $searchField.val().toLowerCase().replace( /\\s+|{|}/g, '' );\r\n\r\n            // Reset before searching\r\n            $items.removeClass( 'item-task-selector__option--show item-task-selector__option--hide' );\r\n\r\n            // Create variable to evaluate later if there were results\r\n            let hasResults = true;\r\n\r\n            // Check if the query is not empty\r\n            if ( ! isEmpty( query ) ){\r\n\t\t\t\t// If value it isn't empty then we have to check if there are going to be results, so false by default\r\n\t\t\t\thasResults = false;\r\n\r\n\t\t\t\t$.each( $items, ( index, item ) => {\r\n\t\t\t\t\tlet $item = $( item ),\r\n\t\t\t\t\t    text  = $item.data( 'search' );\r\n\r\n\t\t\t\t\tif ( text.search( query ) !== -1 ){\r\n\t\t\t\t\t    $item.addClass( 'item-task-selector__option--show' );\r\n\r\n\t\t\t\t\t    // At least one result, so true\r\n\t\t\t\t\t    hasResults = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t    $item.addClass( 'item-task-selector__option--hide' );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n            }\r\n\r\n            // Show and hide noResults\r\n            $itemsList.noResults.removeClass( 'item-task-selector__option--hide item-task-selector__option--show' );\r\n\r\n            if ( ! hasResults ){\r\n\t\t\t\t$itemsList.noResults.addClass( 'item-task-selector__option--show' );\r\n            }\r\n            else {\r\n\t\t\t\t$itemsList.noResults.addClass( 'item-task-selector__option--hide' )\r\n            }\r\n        });\r\n\r\n        // Append \"Cancel\" button\r\n        $optionsContainer.append( this.createCancelButton() );\r\n\r\n\t\t// Append the header to the main container\r\n        this.$container.append( $container );\r\n\t}\r\n\r\n\tcreateCancelButton(){\r\n\t\tlet $cancelButton = $( '<div/>', { 'class': 'uap-btn uap-btn--secondary' }).text( UncannyAutomator.i18n.cancel );\r\n\r\n\t\t$cancelButton.on( 'click', () => {\r\n\t\t\tnew ItemCreatorIntegrations( this.itemType, this.$item );\r\n\t\t});\r\n\r\n\t\treturn $cancelButton;\r\n\t}\r\n}\r\n\r\nexport default itemCreatorTaskSelector;","import $ from 'jquery';\r\n\r\nimport Tokens from './tokens';\r\n\r\nimport {\r\n    isEmpty,\r\n    isDefined,\r\n    debounce,\r\n    throttle,\r\n    copyToClipboard,\r\n    vsprintf\r\n} from '../Utilities';\r\n\r\nimport Field from '../Field';\r\n\r\nimport Modal from '../Modal';\r\n\r\nexport default class TokenSelector {\r\n    constructor( Field ){\r\n        // Check if the field supports tokens\r\n        if ( Field.attributes.supportsTokens ){\r\n            // Create different Tokens Selectors depending on the field type\r\n            if ( Field.type == 'textarea' ){\r\n                return new TokenSelectorTextarea( Field );\r\n            }\r\n            else {\r\n                return new TokenSelectorInput( Field );\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nclass TokenSelectorInput extends Tokens {\r\n    constructor( Field ){\r\n        super(\r\n            Field.attributes.itemType,\r\n            Field.type\r\n        );\r\n\r\n        // Save field\r\n        this.Field = Field;\r\n\r\n        // Save the Token Selector instance in the field\r\n        this.Field.TokenSelector = this;\r\n\r\n        // Render the token selector\r\n        this.render();\r\n\r\n        // Set data\r\n        this.setData();\r\n\r\n        // CodeMirror methods\r\n        this.Field.getField().on( 'ua-codemirror-ready', () => {\r\n            // Get the CodeMirror editor\r\n            this.getCodeMirrorEditor();\r\n\r\n            // Render tokens right away, without the delay\r\n            this.editor.setValue( this.editor.getValue() );\r\n            this.renderTokens();\r\n\r\n            // Handle requests to add tokens to the field\r\n            this.handleAddTokens();\r\n\r\n            // Render tokens in real time\r\n            this.renderTokensInRealTime();\r\n        }); \r\n    }\r\n\r\n    render(){\r\n        this.RenderTokenSelector = new RenderTokenSelector( this.Field, this.tokens );\r\n    }\r\n\r\n    setData(){\r\n        this.data = {\r\n            tokenRenderingDebounce: 200,\r\n            // cachedCMWidgets: []\r\n        }\r\n    }\r\n\r\n    getCodeMirrorEditor(){\r\n        this.editor = this.Field.fieldCM;\r\n    }\r\n\r\n    handleAddTokens(){\r\n        // Listen events that are trying to add a token\r\n        this.Field.field\r\n            .off( 'ua-add-token' )\r\n            .on( 'ua-add-token', ( event, token ) => {\r\n                // Check if it's a date or time field\r\n                if ( [ 'date', 'time' ].includes( this.Field.attributes.fieldType ) ){\r\n                    // Remove the value of the field\r\n                    this.editor.setValue( '' );\r\n                }\r\n\r\n                // Add it to the editor\r\n                this.insertTextAtCursor( `{{${ token.id }}}` );\r\n\r\n                // Render tokens right away, without the delay\r\n                this.renderTokens();\r\n\r\n                // Check if it's NOT a date or time field\r\n                if ( ! [ 'date', 'time' ].includes( this.Field.attributes.fieldType ) ){\r\n                    // Focus the field again\r\n                    this.editor.focus();\r\n                }\r\n\r\n                 // Check if it's a date or time field\r\n                if ( [ 'date', 'time' ].includes( this.Field.attributes.fieldType ) ){\r\n                    // Set value in the real field\r\n                    this.Field.setValue( `{{${ token.id }}}` );\r\n                }\r\n            });\r\n    }\r\n\r\n    destroy(){\r\n        // Destroy wrapper\r\n        this.RenderTokenSelector.destroy();\r\n    }\r\n\r\n    /**\r\n     * Insert content in the CM field at the current position\r\n     *\r\n     * @since 3.0\r\n     * \r\n     * @param  String   text The content to be added\r\n     */\r\n    insertTextAtCursor( text ){\r\n        this.editor.doc.replaceRange( text, this.editor.doc.getCursor() );\r\n    }\r\n\r\n    renderTokensInRealTime(){\r\n        this.editor.on( 'changes', debounce( ( event ) => {\r\n            // Render tokens\r\n            this.renderTokens();\r\n        }, this.data.tokenRenderingDebounce ) );\r\n    }\r\n\r\n    renderTokens(){\r\n        // Clear all the current widgets\r\n        // this.data.cachedCMWidgets.forEach( marker => marker.clear() );\r\n        // this.data.cachedCMWidgets = [];\r\n\r\n        // Search tokens\r\n        const querySearchTokens = this.editor.getSearchCursor( /\\{\\{(.*?)\\}\\}/ );\r\n\r\n        // Iterate them\r\n        while ( querySearchTokens.findNext() ){\r\n            // Get position\r\n            const position = {\r\n                from: querySearchTokens.from(),\r\n                to:   querySearchTokens.to()\r\n            }\r\n\r\n            // Get the content\r\n            const content = this.editor.getRange(\r\n                position.from,\r\n                position.to\r\n            );\r\n\r\n            // Remove the opening and closing brackets\r\n            const tokenId = content.replace( '{{', '' ).replace( '}}', '' );\r\n            \r\n            // Get the token HMTL\r\n            const $tokenNode = this.createTokenDOMNode( tokenId );\r\n\r\n            const widget = this.editor.markText( \r\n                position.from,\r\n                position.to,\r\n                {\r\n                    replacedWith: $tokenNode\r\n                }\r\n            );\r\n\r\n            // Save the widget\r\n            // this.data.cachedCMWidgets.push( widget );\r\n\r\n            // Add events to the tokens, but only if the field is not read only\r\n            if ( ! this.Field.attributes.isReadOnly ){\r\n                // Select on click\r\n                $tokenNode.addEventListener( 'click', () => {\r\n                    // Check if it's focus\r\n                    if ( ! $tokenNode.classList.contains( 'uap-token--cm-focused' ) ){\r\n                        // Add focus class\r\n                        $tokenNode.classList.add( 'uap-token--cm-focused' );\r\n\r\n                        const onFocusOut = () => {\r\n                            // Remove focus class\r\n                            $tokenNode.classList.remove( 'uap-token--cm-focused' );\r\n\r\n                            // Remove the event listener that listen clicks\r\n                            // outside the token\r\n                            document.removeEventListener( 'mouseup', onClickOutside );\r\n\r\n                            // Remove the event listener to copy to the\r\n                            // token to the clipboard\r\n                            document.removeEventListener( 'copy', onCopy );\r\n\r\n                            // Remove the event listener to remove the token\r\n                            document.removeEventListener( 'keydown', onDelete );\r\n\r\n                            // Remove the event listener to move the cursor\r\n                            // to the left or right using the direction keys\r\n                            document.removeEventListener( 'keydown', onNavigation );\r\n                        }\r\n\r\n                        // Listen clicks outside\r\n                        const onClickOutside = ( event ) => {\r\n                            if (\r\n                                // Check if the clicked element is not the token\r\n                                ! ( $tokenNode === event.target )\r\n                                // And check if the clicked element is NOT a child\r\n                                // of the token\r\n                                && ! ( $tokenNode.contains( event.target ) )\r\n                            ){\r\n                                onFocusOut();\r\n                            }\r\n                        };\r\n                        document.addEventListener( 'mouseup', onClickOutside );\r\n\r\n                        // Listen copy event\r\n                        const onCopy = ( event ) => {\r\n                            onFocusOut();\r\n\r\n                            // Copy the token ID\r\n                            copyToClipboard( `{{${ tokenId }}}` );\r\n                        };\r\n                        document.addEventListener( 'copy', onCopy );\r\n\r\n                        // Listen delete event\r\n                        const onDelete = ( event ) => {\r\n                            // Get the pressed key\r\n                            const key = event.keyCode || event.charCode;\r\n\r\n                            // Check if it's the \"backspace\" or \"del\" key\r\n                            if ( key == 8 || key == 46 ){\r\n                                // Get the widget position\r\n                                const widgetPosition = widget.find();\r\n\r\n                                // Remove the widget\r\n                                widget.clear();\r\n\r\n                                // Remove the token content\r\n                                this.editor.replaceRange(\r\n                                    '',\r\n                                    widgetPosition.from,\r\n                                    widgetPosition.to\r\n                                );\r\n\r\n                                onFocusOut();\r\n                            }\r\n                        }\r\n                        document.addEventListener( 'keydown', onDelete );\r\n\r\n                        // Listen navigation events\r\n                        const onNavigation = ( event ) => {\r\n                            // Get the pressed key\r\n                            const key = event.keyCode || event.charCode;\r\n\r\n                            // Check if it's one of the <- or -> keys\r\n                            if ( key == 37 || key == 39 ){\r\n                                onFocusOut();\r\n\r\n                                // Get the widget position\r\n                                const widgetPosition = widget.find();\r\n\r\n                                // Get the new position\r\n                                let position;\r\n\r\n                                // Check if it's the \"<-\" (left) key\r\n                                if ( key == 37 ){\r\n                                    // Get the left position\r\n                                    position = widgetPosition.from;\r\n                                }\r\n\r\n                                // Check if it's the \"->\" (right) key\r\n                                if ( key == 39 ){\r\n                                    // Get the right position\r\n                                    position = widgetPosition.to;\r\n                                }\r\n\r\n                                // Set focus\r\n                                this.editor.focus();\r\n\r\n                                // Set the cursor\r\n                                this.editor.setCursor( position )\r\n                            }\r\n                        }\r\n                        document.addEventListener( 'keydown', onNavigation );\r\n                    }\r\n                });\r\n            }  \r\n        }\r\n    }\r\n}\r\n\r\nclass TokenSelectorTextarea extends Tokens {\r\n    constructor( Field ){\r\n        super(\r\n            Field.attributes.itemType,\r\n            Field.type\r\n        );\r\n\r\n        // Save field\r\n        this.Field = Field;\r\n\r\n        // Save the Token Selector instance in the field\r\n        this.Field.TokenSelector = this;\r\n\r\n        // Set the required data\r\n        this.setData();\r\n\r\n        // Render the token selector\r\n        this.render();\r\n\r\n        // TinyMCE methods\r\n        this.Field.getField().on( 'ua-tinymce-ready', () => {\r\n            // Get the CodeMirror editor\r\n            this.getTinyMCEEditor();\r\n\r\n            // Add styles to the editor\r\n            this.addStylesToEditor();\r\n\r\n            // Parse tokens in the TinyMCE editor\r\n            setTimeout(() => {\r\n                this.parsePlainTokensInTinyMCE();\r\n            }, this.data.tokenRenderingDebounce );\r\n\r\n            // Parse tokens in the text editor\r\n            setTimeout(() => {\r\n                this.parseHTMLTokensInPlainTextarea();\r\n            }, this.data.tokenRenderingDebounce );\r\n            \r\n            // Handle requests to add tokens to the field\r\n            this.handleAddTokens();\r\n\r\n            // Handle tokens added to the textarea (HTML)\r\n            this.handleHTMLTokensInPlainTextarea();\r\n\r\n            // Handle tokens added to TinyMCE (plain)\r\n            this.handlePlainTokensInTinyMCE();\r\n        }); \r\n    }\r\n\r\n    setData(){\r\n        this.data = {\r\n            tokenRenderingDebounce: 200,\r\n            tokenCSSClass: 'uap-token-tinymce' \r\n        }\r\n    }\r\n\r\n    render(){\r\n        this.RenderTokenSelector = new RenderTokenSelector( this.Field, this.tokens );\r\n    }\r\n\r\n    handleAddTokens(){\r\n        // Listen events that are trying to add a token\r\n        this.Field.field.on( 'ua-add-token', ( event, token ) => {\r\n            // Add it to the editor\r\n            this.insertTextAtCursor( token.id );\r\n        });\r\n    }\r\n\r\n    insertTextAtCursor( token = '' ){\r\n        // Create token with brackets\r\n        const tokenWithBrackets = `{{${ token }}}`;\r\n\r\n        // Check if \"Text\" view is selected\r\n        if ( this.Field.getField().is( ':visible' ) ){\r\n            // Get the current cursor position, and the position of it\r\n            // after the token is added to the editor\r\n            const cursorPosition    = this.Field.getField().prop( 'selectionStart' );\r\n            const newCursorPosition = cursorPosition + tokenWithBrackets.length;\r\n\r\n            // Get the current content\r\n            const currentValue = this.Field.getField().val();\r\n\r\n            // Get the value of the field after adding the token\r\n            const newValue     = currentValue.substr( 0, cursorPosition ) + tokenWithBrackets + currentValue.substr( cursorPosition );\r\n\r\n            // Set new value and focus\r\n            this.Field.setValue( newValue, false );\r\n\r\n            // Set focus\r\n            this.Field.getField().focus();\r\n\r\n            // Set position of the cursor\r\n            this.Field.getField().prop( 'selectionEnd', newCursorPosition );\r\n        }\r\n        else {\r\n            // Get the token HMTL\r\n            const $tokenNode = this.createTokenDOMNode( token );\r\n\r\n            // Insert token\r\n            this.editor.execCommand( 'mceInsertContent', false, `<span class=\"${ this.data.tokenCSSClass }\" contenteditable=\"false\" data-token-id=\"${ token }\">${ $tokenNode.outerHTML }</span>` );\r\n        }\r\n\r\n        // Trigger a change event in the field\r\n        this.Field.getField()\r\n            .trigger( 'change input' );\r\n    }\r\n\r\n    getTinyMCEEditor(){\r\n        this.editor = this.Field.fieldTinyMCE;\r\n    }\r\n\r\n    addStylesToEditor(){\r\n        this.editor.dom.addStyle( `\r\n            html body {\r\n                font-family: -apple-system, system-ui, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\r\n                font-size: 15px;\r\n                margin-left: 12px;\r\n                margin-right: 12px;\r\n            }\r\n\r\n            .uap-token {\r\n                display: inline-flex;\r\n                align-items: center;\r\n                background: #eee;\r\n                line-height: 1;\r\n                padding: 3px 8px;\r\n                border-radius: 150px;\r\n\r\n                font-size: 15px;\r\n                font-family: -apple-system, system-ui, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\r\n                -webkit-font-smoothing:antialiased;\r\n                -moz-osx-font-smoothing:grayscale;\r\n            }\r\n\r\n                .uap-token-tinymce {\r\n                    display: inline-block;\r\n                    line-height: 1;\r\n                    border-radius: 150px;\r\n                    box-shadow: 0 0 0 2px transparent;\r\n                    transition: box-shadow 150ms ease-in-out;\r\n                    cursor: pointer;\r\n                }\r\n\r\n                .uap-token-tinymce[data-mce-selected=\"1\"] {\r\n                    outline: 0 !important;\r\n                    box-shadow: 0 0 0 2px #0790e8;\r\n                }\r\n\r\n                .uap-token img {\r\n                    width: 12px;\r\n                    height: 11px;\r\n                    margin-right: 5px;\r\n                    object-fit: contain;\r\n                    object-position: center;\r\n                    display: block;\r\n                }\r\n\r\n                .uap-token .uo-icon {\r\n                    width: 14px;\r\n                    height: 14px;\r\n                    border: 1px solid #444;\r\n                    border-radius: 50%;\r\n                    font-size: 9px;\r\n                    color: #444;\r\n                    text-align: center;\r\n                    line-height: 15px;\r\n                    background: #fff;\r\n                    opacity: .8;\r\n                    margin-right: 5px;\r\n                    position: relative;\r\n                }\r\n\r\n                    .uap-token .uo-icon.uo-icon--bolt:before {\r\n                        content: '';\r\n\r\n                        width: 9px;\r\n                        height: 9px;\r\n\r\n                        background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 384 512'%3E%3Cpath fill='%23444' d='M377.8 167.9c-8.2-14.3-23.1-22.9-39.6-22.9h-94.4l28.7-87.5c3.7-13.8.8-28.3-7.9-39.7C255.8 6.5 242.5 0 228.2 0H97.7C74.9 0 55.4 17.1 52.9 37.1L.5 249.3c-1.9 13.8 2.2 27.7 11.3 38.2C20.9 298 34.1 304 48 304h98.1l-34.9 151.7c-3.2 13.7-.1 27.9 8.6 38.9 8.7 11.1 21.8 17.4 35.9 17.4 16.3 0 31.5-8.8 38.8-21.6l183.2-276.7c8.4-14.3 8.4-31.5.1-45.8zM160.1 457.4L206.4 256H47.5L97.7 48l127.6-.9L177.5 193H334L160.1 457.4z'%3E%3C/path%3E%3C/svg%3E\");\r\n\r\n                        background-size: contain;\r\n                        background-position: center;\r\n                        background-repeat: no-repeat;\r\n\r\n                        position: absolute;\r\n                        top: 50%;\r\n                        left: 50%;\r\n                        transform: translate(-50%,-50%);\r\n                    }\r\n\r\n                .uap-token__name {\r\n                    color: #444444;\r\n                    font-size: 14px;\r\n                    font-weight: 600;\r\n                }\r\n\r\n                    .uap-token--invalid {\r\n                        background: #f9e2e2;\r\n                    }\r\n\r\n                    .uap-token--invalid .uo-icon {\r\n                        color: #c00;\r\n                        border-color: #c00;\r\n                    }\r\n\r\n        ` );\r\n    }\r\n\r\n    handleHTMLTokensInPlainTextarea(){\r\n        // Listen changes to the field\r\n        this.Field.getField()\r\n            .on( 'change input',\r\n                debounce(() => {\r\n                    // Parse tokens\r\n                    this.parseHTMLTokensInPlainTextarea();\r\n                }, this.data.tokenRenderingDebounce )\r\n            );\r\n\r\n        // Trigger a change event in the text field \r\n        // when the user changes to the \"Text\" tab\r\n        this.Field.getField()\r\n            .on( 'ua-tinymce-activate-text-view', () => {\r\n                // Parse tokens\r\n                setTimeout(() => {\r\n                    this.parseHTMLTokensInPlainTextarea();\r\n                }, this.data.tokenRenderingDebounce );\r\n            });\r\n    }\r\n\r\n    handlePlainTokensInTinyMCE(){\r\n        // Trigger a change event in the text field \r\n        // when the user changes to the \"Text\" tab\r\n        this.Field.getField()\r\n            .on( 'ua-tinymce-activate-visual-view', () => {\r\n                // Parse tokens in the editor\r\n                setTimeout(() => {\r\n                    this.parsePlainTokensInTinyMCE();\r\n                }, this.data.tokenRenderingDebounce );\r\n            });\r\n    }\r\n\r\n    parsePlainTokensInTinyMCE(){\r\n        // Get the content of the TinyMCE field\r\n        const editorContent = this.editor.getContent({\r\n            format: 'raw'\r\n        });\r\n\r\n        // Render the tokens\r\n        const editorContentWithTokens = this.renderTextWithTokens(\r\n            editorContent,\r\n            {\r\n                // 1. Token HTML, 2. Token ID\r\n                template: `<span class=\"${ this.data.tokenCSSClass }\" contenteditable=\"false\" data-token-id=\"%2$s\">%1$s</span>`\r\n            }\r\n        );\r\n\r\n        // Check if the content is different\r\n        if ( editorContent != editorContentWithTokens ){\r\n            // Set the content again\r\n            this.editor.setContent( editorContentWithTokens.innerHTML );\r\n        }   \r\n    }\r\n\r\n    parseHTMLTokensInPlainTextarea(){\r\n        // Get the content of the field\r\n        let content = this.Field.getField().val();\r\n\r\n        // Remove the HTML and leave the tokens as plain text\r\n        let $temporalContainer = document.createElement( 'div' );\r\n        $temporalContainer.innerHTML = content;\r\n\r\n        // Get the HTML tokens\r\n        const $tokens = $temporalContainer.querySelectorAll( `.${ this.data.tokenCSSClass }` );\r\n\r\n        // Check if it has tokens\r\n        // Otherwise, do nothing\r\n        if ( $tokens.length > 0 ){\r\n            // Iterate the tokens\r\n            $tokens.forEach(( $tokenNode ) => {\r\n                // Get the token ID\r\n                const tokenID = $tokenNode.dataset.tokenId;\r\n\r\n                // Replace the tokenNode with the tokenID\r\n                $tokenNode.outerHTML = `{{${ tokenID }}}`;\r\n            });\r\n\r\n            // Update the content\r\n            content = $temporalContainer.innerHTML;\r\n\r\n            // Set the value of the field without triggering\r\n            // the change event\r\n            this.Field.getField().val( content );\r\n        }    \r\n    }\r\n\r\n    destroy(){\r\n        this.RenderTokenSelector.destroy();\r\n    }\r\n}\r\n\r\nclass RenderTokenSelector {\r\n    constructor( Field, tokens ){\r\n        this.Field  = Field;\r\n        this.tokens = tokens;\r\n\r\n        // Get data\r\n        this.getData();\r\n\r\n        // Get elements\r\n        this.getElements();\r\n\r\n        // Create wrapper\r\n        this.createWrapper();\r\n\r\n        // Create filter\r\n        this.createFilter();\r\n\r\n        // Create groups of tokens\r\n        this.createGroupsOfTokens();\r\n\r\n        // Open tokens on click\r\n        this.listenToggleButton();\r\n\r\n        // Resize dropdown on window resize\r\n        this.resizeDropdownOnWindowResize();\r\n\r\n        // Resize on scroll\r\n        this.resizeDropdownOnWindowScroll();\r\n\r\n        // Refresh when the field value changes\r\n        this.refreshOnFieldChange();\r\n\r\n        // Search\r\n        this.search();\r\n\r\n        // Set default filter\r\n        if ( this.shouldSupportFilters() ){\r\n            this.setFilter( true );\r\n        }\r\n    }\r\n\r\n    getData(){\r\n        this.data = {\r\n            isOpen:   false,\r\n            position: 'below'\r\n        }\r\n    }\r\n\r\n    getElements(){\r\n        this.$elements = {\r\n            wrapper: null,\r\n            toggleButton: null,\r\n            searchField: null,\r\n            dropdown: null,\r\n            allGroups: null,\r\n            dropdownGroupsContainer: null,\r\n            dropdownTokens: null,\r\n            noResultsOption: null\r\n        };\r\n    }\r\n\r\n    createWrapper(){\r\n        const $wrapper = $( `\r\n            <div class=\"form-variable\">\r\n                <div class=\"form-variable__element\">\r\n                    <div class=\"form-variable__render-container\"></div>\r\n                    <div class=\"form-variable__toggle\">\r\n                        <span class=\"uo-icon uo-icon--asterisk\"></span>\r\n                    </div>\r\n                </div>\r\n                <div class=\"form-variable__dropdown\">\r\n                    <div class=\"form-variable__dropdown-container\">\r\n                        <div class=\"form-variable__search\">\r\n                            <input \r\n                                class=\"form-variable__search-input\" \r\n                                placeholder=\"${ UncannyAutomator.i18n.tokens.search }\"\r\n                            >\r\n                        </div>\r\n                        <div class=\"form-variable__groups\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        ` );\r\n\r\n        // Get the field that we have to move\r\n        const $fieldToMove = this.Field.type == 'textarea' ? this.Field.getField() : this.Field.getFieldCM();\r\n\r\n        // Move the field\r\n        $wrapper\r\n            .insertAfter( $fieldToMove );\r\n\r\n        $wrapper\r\n            .find( '.form-variable__render-container' )\r\n            .append( $fieldToMove );\r\n\r\n        // Save the element\r\n        this.$elements.wrapper = $wrapper;\r\n\r\n        // Save the element that has the field inside\r\n        this.$elements.renderContainer = $wrapper\r\n            .find( '.form-variable__render-container' );\r\n\r\n        // Save the search field container\r\n        this.$elements.searchFieldContainer = $wrapper.find( '.form-variable__search' );\r\n\r\n        // Save the search field\r\n        this.$elements.searchField = $wrapper.find( '.form-variable__search-input' );\r\n\r\n        // Save the toggle button\r\n        this.$elements.toggleButton = $wrapper.find( '.form-variable__toggle' );\r\n\r\n        // Save the dropdown\r\n        this.$elements.dropdown = $wrapper.find( '.form-variable__dropdown' );\r\n\r\n        // Save the container of the groups\r\n        this.$elements.dropdownGroupsContainer = $wrapper.find( '.form-variable__groups' );\r\n    }\r\n\r\n    createFilter(){\r\n        // Check if it's a field that should filter tokens\r\n        if ( this.shouldSupportFilters() ){\r\n            // Get the field type\r\n            const fieldType = this.Field.attributes.fieldType;\r\n\r\n            // Get the field type human-readable name\r\n            const fieldTypeHumanReadable = isDefined( UncannyAutomator.i18n.tokens.tokenType[ fieldType ] ) ? UncannyAutomator.i18n.tokens.tokenType[ fieldType ] : fieldType;\r\n\r\n            // Create filter container\r\n            const $filterContainer = $( `\r\n                <div class=\"form-variable__filter\"></div>\r\n            ` );\r\n\r\n            // Create checkbox\r\n            const filterToggle = new Field( 'checkbox', {\r\n                optionCode:   'token__enableFilter',\r\n                currentValue: true,\r\n                label: `<span class=\"form-variable__filter-label\">` + vsprintf( UncannyAutomator.i18n.tokens.filter, [ `<span class=\"form-variable__filter-type\">${ fieldTypeHumanReadable }</span>` ] ) + `<span>`,\r\n            });\r\n\r\n            // Get checkbox form element\r\n            const $filterFormElement = filterToggle.createFormElement();\r\n\r\n            // Add the field\r\n            $filterContainer.prepend( $filterFormElement );\r\n\r\n            // Add filter to the DOM\r\n            this.$elements.searchFieldContainer.append( $filterContainer );\r\n\r\n            // Save the filter container\r\n            this.$elements.filterContainer = $filterContainer;\r\n\r\n            // Listen changes to the checkbox value\r\n            $filterFormElement.on( 'automator:field:change', () => {\r\n                // Get value\r\n                const filterValue = filterToggle.getValue();\r\n\r\n                // Check if we have to filter or remove the filter\r\n                if ( filterValue ){\r\n                    this.setFilter( true );\r\n                }\r\n                else {\r\n                    this.setFilter( false );\r\n                }\r\n            });\r\n        }    \r\n    }\r\n\r\n    createGroupsOfTokens(){\r\n        // Get the container\r\n        const $container = this.$elements.wrapper.find( '.form-variable__groups' );\r\n\r\n        // Iterate the groups of tokens\r\n        this.tokens.forEach(( groupOfTokens ) => {\r\n            $container.append( this.createIndividualGroupOfTokens( groupOfTokens ) );\r\n        });\r\n\r\n        // Save all the groups\r\n        this.$elements.allGroups = $container.find( '.form-variable__group' );\r\n\r\n        // Save all the items\r\n        this.$elements.dropdownTokens = $container.find( '.form-variable__group-item' );\r\n\r\n        // Add the \"no results\" option\r\n        this.$elements.noResultsOption = $( `\r\n            <div class=\"form-variable__group-item-no-results form-variable__group-item-no-results--hide\">\r\n                <div class=\"form-variable__group-item-no-results-title\">\r\n                    ${ UncannyAutomator.i18n.tokens.noResults }\r\n                </div>\r\n                <div class=\"form-variable__group-item-no-results-description\">\r\n                    ${ this.shouldSupportFilters() ? UncannyAutomator.i18n.tokens.noResultsDescriptionWithFilter : UncannyAutomator.i18n.tokens.noResultsDescription }\r\n                </div>\r\n            </div>\r\n        ` );\r\n        $container.append( this.$elements.noResultsOption );\r\n    }\r\n\r\n    createIndividualGroupOfTokens( groupOfTokens ){\r\n        const $group = $( `\r\n            <div \r\n                class=\"form-variable__group\"\r\n                data-id=\"${ groupOfTokens.id }\"\r\n            >\r\n                <div class=\"form-variable__group-source\">\r\n                    <div class=\"form-variable-group-source__icon\"></div>\r\n                    <div class=\"form-variable-group-source__description\"></div>\r\n                    <div class=\"form-variable-group-source__toggle\">\r\n                        <span class=\"form-variable-group-source__toggle-icon\"></span>\r\n                    </div>\r\n                </div>\r\n                <span class=\"form-variable__group-children\"></span>\r\n            </div>\r\n        ` );\r\n\r\n        // Add the name\r\n        const groupName = groupOfTokens.name;\r\n        if ( ! typeof groupName == 'string' ){\r\n            groupName = groupName.html.clone();\r\n        }\r\n\r\n        $group\r\n            .find( '.form-variable-group-source__description' )\r\n            .append( groupOfTokens.name );\r\n\r\n        // Create the icon\r\n        let $icon = groupOfTokens.icon.clone();\r\n\r\n        // Add the icon to the group\r\n        $group.find( '.form-variable-group-source__icon' ).append( $icon );\r\n\r\n        // Get the toggle button\r\n        const $toggleButton = $group.find( '.form-variable__group-source' );\r\n        // Listen clicks to the toggle button\r\n        $toggleButton.on( 'click', () => {\r\n            $group.toggleClass( 'form-variable__group--open' );\r\n        });\r\n\r\n        // Get the container where we're going to add the tokens\r\n        const $tokensListContainer = $group.find( '.form-variable__group-children' );\r\n\r\n        // Add tokens\r\n        groupOfTokens.tokens.forEach(( token ) => {\r\n            // Create the token\r\n            const $token = $( `\r\n                <div \r\n                    class=\"form-variable__group-item\"\r\n                    data-search=\"${\r\n                        token.name\r\n                            .trim()\r\n                            .toLowerCase()\r\n                            .replace( /\\s/g, '' )\r\n                    }\"\r\n                    data-type=\"${ token.type }\"\r\n                >\r\n                    ${ token.name }\r\n                </div>\r\n            ` );\r\n\r\n            // Check if it's the \"USERMETA:KEY\" token\r\n            if ( token.id == 'USERMETA:KEY' ){\r\n                // Listen clicks to the tokens\r\n                $token.on( 'click', () => {\r\n                    // Close the token selector\r\n                    this.close();\r\n\r\n                    // Create the content for the modal\r\n                    const $modalContent = $( `<div></div>` );\r\n\r\n                    // Create the field\r\n                    const metaKeyField = new Field( 'text', {\r\n                        optionCode: 'token__metaKeyField',\r\n                        label: UncannyAutomator.i18n.tokens.specialTokens.userMeta.modal.userMetaKey,\r\n                        description: UncannyAutomator.i18n.tokens.specialTokens.userMeta.modal.userMetaKeyDescription,\r\n                        isRequired: true,\r\n                    }); \r\n\r\n                    // Add the field\r\n                    $modalContent.append( metaKeyField.createFormElement() );\r\n\r\n                    // Show a modal\r\n                    const modal = new Modal({\r\n                        title: UncannyAutomator.i18n.tokens.specialTokens.userMeta.modal.title,\r\n                        content: $modalContent,\r\n                        buttons: {\r\n                            cancel:  UncannyAutomator.i18n.cancel,\r\n                            confirm: UncannyAutomator.i18n.tokens.specialTokens.userMeta.modal.confirmButton,\r\n                        }\r\n                    });\r\n\r\n                    modal.setEvents({\r\n                        afterSetEvents: () => {\r\n                            modal.show();\r\n                        },\r\n                        onConfirm: () => {\r\n                            // Validate the field\r\n                            const fieldValidation = metaKeyField.validate();\r\n\r\n                            // Get the field value\r\n                            const fieldValue = metaKeyField.getValue();\r\n\r\n                            // Check if the field is valid\r\n                            if ( fieldValidation.isValid ){\r\n                                // Clone the token, don't modify the original\r\n                                token = $.extend( true, {}, token );\r\n\r\n                                // Change ID of the token\r\n                                token.id = token.id.replace( 'KEY', fieldValue );\r\n\r\n                                // Change name of the token\r\n                                token.name = vsprintf( UncannyAutomator.i18n.tokens.global.userMetaKeyTemplate, [ fieldValue ] );\r\n\r\n                                // Add the token\r\n                                this.Field.field.trigger( 'ua-add-token', token );\r\n\r\n                                // Destroy the modal\r\n                                modal.destroy();\r\n                            }\r\n                        },\r\n                        afterHide: function(){\r\n                            modal.destroy();\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n            else {\r\n                // Listen clicks to the tokens\r\n                $token.on( 'click', () => {\r\n                    // Trigger event to add the token\r\n                    this.Field.field.trigger( 'ua-add-token', token );\r\n\r\n                    // Close the token selector\r\n                    this.close();\r\n                });\r\n            }\r\n\r\n            // Add token\r\n            $tokensListContainer.append( $token );\r\n        });\r\n\r\n        return $group;\r\n    }\r\n\r\n    listenToggleButton(){\r\n        this.$elements.toggleButton.on( 'click', () => {\r\n            // Check if it's NOT open\r\n            if ( ! this.data.isOpen ){\r\n                this.open();\r\n            }\r\n            else {\r\n                this.close();\r\n            }\r\n        });\r\n    }\r\n\r\n    search(){\r\n        // Listen changes to the search field\r\n        this.$elements.searchField.on( 'input', throttle( () => {\r\n            // Get the value\r\n            let query = this.$elements.searchField.val();\r\n\r\n            // Remove spaces and make the query lowercase\r\n            query = query\r\n                .trim()\r\n                .toLowerCase()\r\n                .replace( /\\s/g, '' );\r\n\r\n            if ( ! isEmpty( query ) ){\r\n                // Open all groups of tokens\r\n                this.$elements.allGroups\r\n                    .addClass( 'form-variable__group--open' );\r\n\r\n                // Hide all elements\r\n                this.$elements.dropdownTokens\r\n                    .addClass( 'form-variable__group-item--hidden-by-search' );\r\n\r\n                // Get search matches\r\n                const $searchMatches = this.$elements.dropdownTokens\r\n                    .filter(( i, token ) => {\r\n                        return token.dataset.search.search( query ) !== -1\r\n                    }\r\n                );\r\n\r\n                // Show the search matches\r\n                $searchMatches\r\n                    .removeClass( 'form-variable__group-item--hidden-by-search' );\r\n            }\r\n            else {\r\n                // Close all groups\r\n                this.$elements.allGroups\r\n                    .removeClass( 'form-variable__group--open' );\r\n\r\n                // Show all tokens\r\n                this.$elements.dropdownTokens\r\n                    .removeClass( 'form-variable__group-item--hidden-by-search' );\r\n            }\r\n\r\n            // Set the visibility of the group of tokens\r\n            this.updateGroupsOfTokensVisibility();\r\n        }, 30 ) );\r\n    }\r\n\r\n    setFilter( filterByType = true ){\r\n        // Check if we have to filter\r\n        if ( filterByType ){\r\n            // Hide all elements\r\n            this.$elements.dropdownTokens\r\n                .addClass( 'form-variable__group-item--hidden-by-filter' );\r\n\r\n            // Get the tokens by type\r\n            const $tokensByType = this.$elements.dropdownTokens\r\n                .filter(( i, token ) => {\r\n                    // Check if the field is a \"float\" field. In that case,\r\n                    // promote all the \"int\" tokens to \"float\". All integers\r\n                    // are floats\r\n                    const tokenType = ( token.dataset.type == 'int' && this.Field.attributes.fieldType == 'float' ) ? 'float' : token.dataset.type;\r\n\r\n                    // Return the tokens that match the field type\r\n                    return tokenType == this.Field.attributes.fieldType;\r\n                }\r\n            );\r\n\r\n            // Show the tokens that match the field type\r\n            $tokensByType\r\n                .removeClass( 'form-variable__group-item--hidden-by-filter' );\r\n        }\r\n        else {\r\n            // Show all tokens\r\n            this.$elements.dropdownTokens\r\n                .removeClass( 'form-variable__group-item--hidden-by-filter' );\r\n        }\r\n\r\n        // Set the visibility of the group of tokens\r\n        this.updateGroupsOfTokensVisibility();\r\n    }\r\n\r\n    updateGroupsOfTokensVisibility(){\r\n        // this.$elements.allGroups\r\n            // .removeClass( 'form-variable__group--open' );\r\n\r\n        // Create the variable that we will use to evaluate\r\n        // if there are available tokens\r\n        let hasResults = false;\r\n\r\n        // Show all the groups of tokens\r\n        this.$elements.allGroups\r\n            .removeClass( 'form-variable__group--without-available-tokens' );\r\n\r\n        // Hide the group of tokens that don't have available tokens\r\n        this.$elements.allGroups\r\n            .filter(( i, group ) => {\r\n                // Check if the group has available tokens\r\n                const groupHasAvailableTokens = group\r\n                    .querySelectorAll( '.form-variable__group-item:not(.form-variable__group-item--hidden-by-filter):not(.form-variable__group-item--hidden-by-search)' )\r\n                    .length > 0;\r\n\r\n                // If it doesn't have available tokens, then hide the group\r\n                if ( ! groupHasAvailableTokens ){\r\n                    group.classList.add( 'form-variable__group--without-available-tokens' );\r\n                }\r\n                else {\r\n                    // The group has available tokens, update \"hasResults\"\r\n                    hasResults = true;\r\n                }\r\n            }\r\n        );\r\n\r\n        // Check if there are available tokens at all\r\n        if ( hasResults ){\r\n            this.$elements.noResultsOption\r\n                .addClass( 'form-variable__group-item-no-results--hide' );\r\n        }\r\n        else {\r\n            this.$elements.noResultsOption\r\n                .removeClass( 'form-variable__group-item-no-results--hide' );\r\n        }\r\n    }\r\n\r\n    open(){\r\n        // If it's a date or time field, try to close\r\n        // the calendar\r\n        if ( [ 'date', 'time' ].includes( this.Field.attributes.fieldType ) ){\r\n            try {\r\n                this.Field.flatpickrInstance.close();\r\n            } catch ( e ){}\r\n        }\r\n\r\n        // Add open class\r\n        this.$elements.wrapper.addClass( 'form-variable--open' );\r\n\r\n        // Save status\r\n        this.data.isOpen = true;\r\n\r\n        // Listen clicks outside the token selector and close it\r\n        this.closeWhenClickedOutside();\r\n\r\n        // Reset the search field (remove the value)\r\n        this.$elements.searchField\r\n            .val( '' )\r\n            .trigger( 'input' )\r\n            // Set padding of the search field depending on the width\r\n            // of the checkbox label\r\n            .css({\r\n                'padding-right': `${ ( ( isDefined( this.$elements.filterContainer ) ? this.$elements.filterContainer.outerWidth() : 0 ) + 12 ) }px`\r\n            });;\r\n\r\n        // Focus the search field\r\n        this.$elements.searchField\r\n            .focus();\r\n                                \r\n        // Determine direction of the selector\r\n        this.setDropdownDirection();\r\n\r\n        // Set scroll\r\n        this.setDropdownHeight();\r\n    }\r\n\r\n    close(){\r\n        this.$elements.wrapper.removeClass( 'form-variable--open' );\r\n\r\n        // Save status\r\n        this.data.isOpen = false;\r\n\r\n        // Rest input value and trigger 'input' event\r\n        this.$elements.searchField\r\n            .val( '' )\r\n            .trigger( 'input' );\r\n\r\n        // Stop listening clicks outside the token selector\r\n        $( document ).off( 'mouseup.uap-token-selector-click-outside' );\r\n    }\r\n\r\n    destroy(){\r\n        // Remove all the elements but the original field\r\n        this.$elements.renderContainer.children().insertAfter( this.$elements.wrapper );\r\n        this.$elements.wrapper.remove();\r\n    }\r\n\r\n    closeWhenClickedOutside(){\r\n        $( document ).on( 'mouseup.uap-token-selector-click-outside', ( event ) => {\r\n            // Set the targetted container\r\n            const $container = this.$elements.wrapper;\r\n\r\n            if ( ! $container.is( event.target ) && $container.has( event.target ).length === 0 ){\r\n                // Hide\r\n                this.close();\r\n            }\r\n        });\r\n    }\r\n\r\n    getDropdownPosition(){\r\n        const $window = $( window );\r\n\r\n        const position = {}\r\n        position.above = this.$elements.wrapper.offset().top - $window.scrollTop();\r\n        position.below = $window.height() - ( position.above + this.$elements.wrapper.outerHeight() );\r\n\r\n        // Check if the current field is a textarea\r\n        if ( this.Field.type == 'textarea' ){\r\n            // Recalculate the space below\r\n            position.below = $window.height() - ( position.above + 38 );\r\n        }\r\n\r\n        // Add \"real size\" class. We're using this to\r\n        // get the real size of the dropdown\r\n        this.$elements.dropdown.addClass( 'uo-realsize' );\r\n        // Get the dropdown height\r\n        const dropdownHeight = this.$elements.dropdown.outerHeight() + 110; // + 75px to show at least 1 option\r\n        this.$elements.dropdown.removeClass( 'uo-realsize' );\r\n\r\n        // Show dropdown always below for textareas\r\n        if ( this.Field.type == 'textarea' ){\r\n            position.hasSpaceBelow = true;\r\n        }\r\n        else {\r\n            position.hasSpaceBelow = position.below >= dropdownHeight;\r\n        }\r\n\r\n        return position;\r\n    }\r\n\r\n    setDropdownDirection(){\r\n        // Get the position of the dropdown\r\n        const position = this.getDropdownPosition();\r\n\r\n        // Remove the position classes\r\n        this.$elements.wrapper.removeClass( 'form-variable--above form-variable--below' );\r\n\r\n        // Determine the position\r\n        if ( position.below > position.above || position.hasSpaceBelow ){\r\n            // Let's show it below\r\n            this.$elements.wrapper.addClass( 'form-variable--below' );\r\n\r\n            // Save the position\r\n            this.data.position = 'below';\r\n        }\r\n        else {\r\n            // Let's show it above\r\n            this.$elements.wrapper.addClass( 'form-variable--above' );\r\n\r\n            // Save the position\r\n            this.data.position = 'above';\r\n        }\r\n    }\r\n\r\n    setDropdownHeight(){\r\n        // Check if it's open\r\n        if ( this.data.isOpen ){\r\n            // Get the max height of the dropdown\r\n            const maxHeight = this.getDropdownPosition()[ this.data.position ] - this.$elements.searchField.outerHeight() - 45;\r\n\r\n            // Set the max height\r\n            this.$elements.dropdownGroupsContainer\r\n                .css({ \r\n                    'max-height' : `${ maxHeight }px`\r\n                });\r\n        }\r\n    }\r\n\r\n    focusSearchField(){\r\n        this.$elements.searchField\r\n            .focus();\r\n    }\r\n\r\n    resizeDropdownOnWindowResize(){\r\n        $( window ).on( 'resize', \r\n            throttle( () => {\r\n                // Determine direction of the selector\r\n                this.setDropdownDirection();\r\n\r\n                // Set height\r\n                this.setDropdownHeight();\r\n            }, 20 )\r\n        );\r\n    }\r\n\r\n    resizeDropdownOnWindowScroll(){\r\n        $( window ).on( 'scroll', \r\n            debounce( () => {\r\n                // Determine direction of the selector\r\n                this.setDropdownDirection();\r\n\r\n                // Set height\r\n                this.setDropdownHeight();\r\n            }, 300 )\r\n        );\r\n    }\r\n\r\n    refreshOnFieldChange(){\r\n        // CodeMirror methods\r\n        this.Field.formElement.on( 'automator:field:change', () => {\r\n            // Determine direction of the selector\r\n            this.setDropdownDirection();\r\n\r\n            // Set height\r\n            this.setDropdownHeight();\r\n        });\r\n    }\r\n\r\n    shouldSupportFilters(){\r\n        // Get the field type\r\n        const fieldType = this.Field.attributes.fieldType;\r\n\r\n        return [ 'email', 'int', 'float', 'url', 'date', 'time' ].includes( fieldType );\r\n    }\r\n}","import $ from 'jquery';\r\n\r\nimport {\r\n\titemsObject,\r\n\tgetGlobalItem,\r\n\tparseStringWithTokens,\r\n\tisEmpty,\r\n\tisDefined,\r\n\tisObject,\r\n\tvsprintf\r\n} from '../Utilities';\r\n\r\nexport default class Tokens {\r\n\tconstructor( itemType, fieldType = 'text', options = {} ){\r\n\t\t// Save data\r\n\t\tthis.saveData( itemType, fieldType, options );\r\n\r\n\t\t// Get data\r\n\t\tthis.getData();\r\n\t}\r\n\r\n\tsaveData( itemType, fieldType, options ){\r\n\t\tthis.itemType  = itemType;\r\n\t\tthis.fieldType = fieldType;\r\n\r\n\t\tthis.options = Object.assign( {\r\n\t\t\tincludeGroupName:   true,\r\n\t\t\tincludeGroupIcon:   true,\r\n\t\t\tincludeGroupTokens: true,\r\n\t\t}, options );\r\n\r\n\t\tthis.tokensRegEx = new RegExp( /\\{\\{(.*?)\\}\\}/gm );\r\n\t}\r\n\r\n\tgetData(){\r\n\t\t// Get all tokens\r\n\t\tthis.tokens = this.getAllTokens();\r\n\t}\r\n\r\n\t/**\r\n\t * Get all the tokens that can be used a given item\r\n\t * These are also going to be filtered by the fieldType\r\n\t *\r\n\t * @since 3.0\r\n\t * \r\n\t * @return Array  Groups of tokens\r\n\t */\r\n\tgetAllTokens(){\r\n\t\tlet tokensList = [];\r\n\r\n\t    // Get the common tokens\r\n\t\tconst commonTokens = this.getCommonTokens();\r\n\t\t// Add tokens to the main array\r\n\t\tif ( commonTokens.tokens.length > 0 ){\r\n\t\t\ttokensList.push( commonTokens );\r\n\t\t}\r\n\r\n\t    // Get the advanced tokens\r\n\t\tconst advancedTokens = this.getAdvancedTokens();\r\n\t\t// Add tokens to the main array\r\n\t\tif ( advancedTokens.tokens.length > 0 ){\r\n\t\t\ttokensList.push( advancedTokens );\r\n\t\t}\r\n\r\n\t\t// Get the items tokens\r\n\t\tconst itemsTokens = this.getItemsTokens();\r\n\t\t// Add tokens to the main array\r\n\t\ttokensList = [ ...tokensList, ...itemsTokens ];\r\n\r\n\t\treturn tokensList;\r\n\t}\r\n\r\n\t/**\r\n\t * Get all the common tokens that can be used a given item\r\n\t * These tokens are independent of the items in the recipe\r\n\t * They are hardcoded, and vary depending on the characteristics\r\n\t * of the recipe itself (for example, if the recipe is anon or logged-in)\r\n\t * These are also going to be filtered by the fieldType\r\n\t *\r\n\t * @since 3.0\r\n\t * \r\n\t * @return Object  Group of tokens\r\n\t */\r\n\tgetCommonTokens(){\r\n\t\t// Create common tokens\r\n\t\tconst commonTokens = {\r\n\t\t\tid:     'common',\r\n\t\t}\r\n\r\n\t\t// Add the name\r\n\t\tif ( this.options.includeGroupName ){\r\n\t\t\tcommonTokens.name = UncannyAutomator.i18n.tokens.global.common;\r\n\t\t}\r\n\r\n\t\t// Add the icon\r\n\t\tif ( this.options.includeGroupIcon ){\r\n\t\t\tcommonTokens.icon = $( `\r\n                <i class=\"uo-icon uo-icon--bolt\"></i>\r\n            ` );\r\n\t\t}\r\n\r\n\t\t// Add the tokens\r\n\t\tif ( this.options.includeGroupTokens ){\r\n\t\t\tcommonTokens.tokens = [\r\n\t\t\t\t{\r\n\t\t\t\t\tid:   'site_name',\r\n\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\tname:  UncannyAutomator.i18n.tokens.global.siteName,\r\n\t\t\t\t\tcacheable: true\r\n\t\t\t\t},\r\n\t\t\t];\r\n\r\n\t\t\t// Check if it's a field in a trigger or user-selector section,\r\n\t\t\t// in an anonymous recipe then don't add user related tokens\r\n\t\t\tif ( \r\n\t\t\t\t! ( \r\n\t\t\t\t\tUncannyAutomator.recipe.type == 'anonymous' \r\n\t\t\t\t\t&& ( this.itemType == 'trigger' || this.itemType == 'user-selector' )\r\n\t\t\t\t)\r\n\t\t\t){\r\n\t\t\t    // Add user related tokens\r\n\t\t\t    commonTokens.tokens.push(\r\n\t\t\t        {\r\n\t\t\t            id:   'user_id',\r\n\t\t\t            type: 'int',\r\n\t\t\t            name:  UncannyAutomator.i18n.tokens.global.userID,\r\n\t\t\t            cacheable: true\r\n\t\t\t        },\r\n\t\t\t        {\r\n\t\t\t            id:   'user_username',\r\n\t\t\t            type: 'text',\r\n\t\t\t            name:  UncannyAutomator.i18n.tokens.global.userUsername,\r\n\t\t\t            cacheable: true\r\n\t\t\t        },\r\n\t\t\t        {\r\n\t\t\t            id:   'user_firstname',\r\n\t\t\t            type: 'text',\r\n\t\t\t            name:  UncannyAutomator.i18n.tokens.global.userFirstName,\r\n\t\t\t            cacheable: true\r\n\t\t\t        },\r\n\t\t\t        {\r\n\t\t\t            id:   'user_lastname',\r\n\t\t\t            type: 'text',\r\n\t\t\t            name:  UncannyAutomator.i18n.tokens.global.userLastName,\r\n\t\t\t            cacheable: true\r\n\t\t\t        },\r\n\t\t\t        {\r\n\t\t\t            id:   'user_email',\r\n\t\t\t            type: 'email',\r\n\t\t\t            name:  UncannyAutomator.i18n.tokens.global.userEmail,\r\n\t\t\t            cacheable: true\r\n\t\t\t        },\r\n\t\t\t        {\r\n\t\t\t            id:   'user_displayname',\r\n\t\t\t            type: 'text',\r\n\t\t\t            name:  UncannyAutomator.i18n.tokens.global.userDisplay,\r\n\t\t\t            cacheable: true\r\n\t\t\t        },\r\n\t\t\t        {\r\n\t\t\t            id:   'reset_pass_link',\r\n\t\t\t            type: 'url',\r\n\t\t\t            name:  UncannyAutomator.i18n.tokens.global.userResetPassLink,\r\n\t\t\t            cacheable: true\r\n\t\t\t        }\r\n\t\t\t    );\r\n\t\t\t}\r\n\r\n\t\t\t// Add other common tokens\r\n\t\t\tcommonTokens.tokens.push(\r\n\t\t\t\t{\r\n\t\t\t\t    id:   'admin_email',\r\n\t\t\t\t    type: 'email',\r\n\t\t\t\t    name:  UncannyAutomator.i18n.tokens.global.adminEmail,\r\n\t\t\t\t    cacheable: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t    id:   'site_url',\r\n\t\t\t\t    type: 'url',\r\n\t\t\t\t    name:  UncannyAutomator.i18n.tokens.global.siteUrl,\r\n\t\t\t\t    cacheable: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t    id:   'recipe_name',\r\n\t\t\t\t    type: 'text',\r\n\t\t\t\t    name:  UncannyAutomator.i18n.tokens.global.recipeName,\r\n\t\t\t\t    cacheable: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t    id:   'current_date',\r\n\t\t\t\t    type: 'text',\r\n\t\t\t\t    name:  UncannyAutomator.i18n.tokens.global.currentDate,\r\n\t\t\t\t    cacheable: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t    id:   'current_time',\r\n\t\t\t\t    type: 'text',\r\n\t\t\t\t    name:  UncannyAutomator.i18n.tokens.global.currentTime,\r\n\t\t\t\t    cacheable: true\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\t// Filter tokens\r\n\t\t\t// commonTokens.tokens = this.filterTokensByType( commonTokens.tokens, this.fieldType );\r\n\t\t}\r\n\r\n\t\treturn commonTokens;\r\n\t}\r\n\r\n\t/**\r\n\t * Get all the advanced tokens that can be used a given item\r\n\t * These tokens are independent of the items in the recipe\r\n\t * They are hardcoded, and vary depending on the characteristics\r\n\t * of the recipe itself (for example, if the recipe is anon or logged-in)\r\n\t * These are also going to be filtered by the fieldType\r\n\t *\r\n\t * @since 3.0\r\n\t * \r\n\t * @return Object  Group of tokens\r\n\t */\r\n\tgetAdvancedTokens(){\r\n\t\t// Create common tokens\r\n\t\tconst advancedTokens = {\r\n\t\t\tid:     'advanced',\r\n\t\t\ttokens: []\r\n\t\t}\r\n\r\n\t\t// Add the name\r\n\t\tif ( this.options.includeGroupName ){\r\n\t\t\tadvancedTokens.name = UncannyAutomator.i18n.tokens.global.advanced;\r\n\t\t}\r\n\r\n\t\t// Add the icon\r\n\t\tif ( this.options.includeGroupIcon ){\r\n\t\t\tadvancedTokens.icon = $( `\r\n                <i class=\"uo-icon uo-icon--bolt\"></i>\r\n            ` );\r\n\t\t}\r\n\r\n\t\t// Add the tokens\r\n\t\tif ( this.options.includeGroupTokens ){\r\n\t\t\t// Check if it's a field in a trigger or user-selector section,\r\n\t\t    // in an anonymous recipe then don't add user related tokens\r\n\t\t    if (\r\n\t\t    \t! ( \r\n\t\t    \t\tUncannyAutomator.recipe.type == 'anonymous' \r\n\t\t    \t\t&& ( this.itemType == 'trigger' || this.itemType == 'user-selector' ) \r\n\t\t    \t)\r\n\t\t    ){\r\n\t\t\t\tadvancedTokens.tokens.push({\r\n\t\t\t\t\tid:   'USERMETA:KEY',\r\n\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\tname:  UncannyAutomator.i18n.tokens.global.userMetaKey,\r\n\t\t\t\t\tcacheable: false\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif ( \r\n\t\t\t\t\tisDefined( UncannyAutomator.wp ) \r\n\t\t\t\t\t&& '1' === UncannyAutomator.wp\r\n\t\t\t\t){\r\n\t\t\t\t\tadvancedTokens.tokens.push({\r\n\t\t\t\t\t\tid:   'AUTOLOGINLINK',\r\n\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\tname:  UncannyAutomator.i18n.tokens.global.autoLoginLink,\r\n\t\t\t\t\t\tcacheable: true\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t    }\r\n\r\n\t\t    // Filter tokens\r\n\t\t\t// advancedTokens.tokens = this.filterTokensByType( advancedTokens.tokens, this.fieldType );\r\n\t\t}\r\n\r\n\t    return advancedTokens;\r\n\t}\r\n\r\n\t/**\r\n\t * Get all the item tokens that can be used a given item\r\n\t * This method just iterates all the items and calls \"getItemTokens\"\r\n\t * to get the tokens of each item in the recipe\r\n\t *\r\n\t * @since 3.0\r\n\t * \r\n\t * @return Object  Groups of tokens\r\n\t */\r\n\tgetItemsTokens(){\r\n\t\tlet itemsTokens = [];\r\n\r\n\t\t// Get all the recipe items, by item type\r\n\t\t// If this.itemType is not defined, all items are going to be returned\r\n\t\tlet items = UncannyAutomator.recipe.items;\r\n\t\tif ( isDefined( this.itemType ) ){\r\n\t\t\t// Remove all the items, we're going to filter them\r\n\t\t\titems = {};\r\n\r\n\t\t    if ( [ 'action', 'closure', 'user-selector' ].includes( this.itemType ) ){\r\n\t\t        items = $.extend( {}, items, itemsObject( 'get', {\r\n\t\t            filter: {\r\n\t\t                itemType: 'trigger'\r\n\t\t            }\r\n\t\t        }));\r\n\t\t    }\r\n\r\n\t\t    if ( this.itemType == 'closure' ){\r\n\t\t        items = $.extend( {}, items, itemsObject( 'get', {\r\n\t\t            filter: {\r\n\t\t                itemType: 'action'\r\n\t\t            }\r\n\t\t        }));\r\n\t\t    }\r\n\t\t}\r\n\r\n\t\t// Iterate items\r\n\t\tObject.entries( items ).forEach( ( [ itemID, item ] ) => {\r\n\t\t\t// Get the item tokens\r\n\t\t\tconst itemTokens = this.getItemTokens( item );\r\n\r\n\t\t\t// Check if it has tokens\r\n\t\t\tif ( \r\n\t\t\t\titemTokens.tokens.length > 0\r\n\t\t\t\t|| ! this.options.includeGroupTokens\r\n\t\t\t){\r\n\t\t\t\titemsTokens.push( itemTokens );\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn itemsTokens;\r\n\t}\r\n\r\n\t/**\r\n\t * Get all the tokens generated by a given item\r\n\t * The tokens added by this method can be divided into two groups:\r\n\t * - Automatic tokens: These are created using the fields of\r\n\t *   the trigger/action. For example, if the item has a dropdown\r\n\t *   to select a page, with the label \"Page\", then this method will\r\n\t *   create a text token called \"Page\".\r\n\t * - Custom dynamic tokens: These are created dynamically with PHP.\r\n\t *   For example, a trigger that lets you select a Gravity Form would\r\n\t *   have the fields as tokens.\r\n\t *\r\n\t * @since 3.0\r\n\t * \r\n\t * @param  Object  item  The item\r\n\t * \r\n\t * @return Object         Groups of tokens\r\n\t */\r\n\tgetItemTokens( item ){\r\n\t\t// Create the tokens group\r\n\t\tlet tokensGroup = {\r\n            id:             item.itemCode,\r\n            integrationId:  item.integrationCode,\r\n        }\r\n\r\n        // Add the name\r\n\t\tif ( this.options.includeGroupName ){\r\n\t\t\t// Get the name of the groups of tokens\r\n\t        // For this, we will use the item sentence\r\n\t\t\tlet itemSentence = item.sentence;\r\n\t\t\tif ( ! item.isMissing ){\r\n\t\t\t    itemSentence = getGlobalItem( item.integrationCode, item.itemType, item.itemCode ).sentence;\r\n\t\t\t}\r\n\r\n\t\t\t// Get or create the parsed item sentence\r\n\t\t\ttokensGroup.name = parseStringWithTokens(\r\n            \titem, \r\n            \titemSentence, \r\n            \tUncannyAutomator.recipe.items[ item.id ].meta,\r\n            \tfalse\r\n            ).html;\r\n\t\t}\r\n\r\n\t\t// Add the icon\r\n\t\tif ( this.options.includeGroupIcon ){\r\n\t\t\t// Create the icon\r\n\t        let $icon;\r\n\r\n\t        if ( isDefined( UncannyAutomator.integrations[ item.integrationCode ] ) ){\r\n\t            // Search for an icon\r\n\t            const integration = UncannyAutomator.integrations[ item.integrationCode ];\r\n\r\n\t            // Check if it has a svg image\r\n\t            if ( isDefined( integration.icon_svg ) ){\r\n\t                $icon = $( `\r\n\t                    <img \r\n\t                        src=\"${ integration.icon_svg }\" \r\n\t                        alt=\"${ integration.name }\"\r\n\t                    >\r\n\t                ` );\r\n\t            }\r\n\t            // Check if it has a png image\r\n\t            else if ( isDefined( integration.icon_16 ) && isDefined( integration.icon_32 ) ){\r\n\t                $icon = $( `\r\n\t                    <img \r\n\t                        src=\"${ integration.icon_16 }\" \r\n\t                        srcset=\"${ vsprintf( '%s 1x, %s 2x', [ integration.icon_16, integration.icon_32 ]) }\"\r\n\t                        alt=\"${ integration.name }\"\r\n\t                    >\r\n\t                ` );\r\n\t            }\r\n\t        }\r\n\r\n\t        // Add the icon\r\n\t        tokensGroup.icon = $icon;\r\n\t\t}\r\n\r\n\t\t// Add the tokens\r\n\t\tif ( this.options.includeGroupTokens ){\r\n\t\t\tlet itemTokens = [];\r\n\r\n\t\t\t// FIELD tokens\r\n\t\t\t// Create tokens using the fields\r\n\t        // Iterate the groups of options\r\n\t        Object.entries( item.options ).forEach( ( [ optionsGroupID, optionsGroup ] ) => {\r\n\t        \t// Iterate each field\r\n\t        \toptionsGroup.fields.forEach( ( Field ) => {\r\n\t        \t\t// Get the field attributes\r\n\t        \t\tconst fieldAttributes = Field.getAttributes();\r\n\r\n\t        \t\t// Check the field type\r\n\t        \t\t// Check if it's a repeater field\r\n\t        \t\t// Check the field type\r\n\t                if ( fieldAttributes.fieldType == 'repeater' ){\r\n\t                    // Iterate the rows\r\n\t                    Field.fieldRows.forEach(( row, index ) => {\r\n\t                        // Get the row index\r\n\t                        const rowIndex = index;\r\n\r\n\t                        // Iterate the row fields\r\n\t                        row.forEach(( Field ) => {\r\n\t                            // Add field\r\n\t                            itemTokens.push({\r\n\t                                // Create the token\r\n\t                                // ITEM_ID : ITEM_CODE : REPEATER_FIELD_ID : ROW_INDEX : FIELD_ID\r\n\t                                id:      `${ item.id }:${ item.itemCode }:${ fieldAttributes.optionCode }:${ rowIndex }:${ Field.getAttributes().optionCode }`,\r\n\t                                // Field name:\r\n\t                                // REPEATER_FIELD_NAME - \"Row\" ROW_INDEX - FIELD_NAME\r\n\t                                name:    `${ fieldAttributes.tokenName } - ${ vsprintf( UncannyAutomator.i18n.rowNumber, [ ( rowIndex + 1 ) ] ) } - ${ Field.getAttributes().tokenName }`,\r\n\t                                type:    Field.getAttributes().fieldType == 'select' || Field.getAttributes().fieldType == 'textarea' ? 'text' : Field.getAttributes().fieldType,\r\n\t                                value:   Field.getValue(),\r\n\t                                fieldId: Field.getAttributes().optionCode,\r\n\t                                itemID:  item.id,\r\n\t                                cacheable: false\r\n\t                            });\r\n\t                        });\r\n\t                    });\r\n\t                }\r\n\t                else if ( fieldAttributes.fieldType == 'group' ){\r\n\t                \t// Nothing here yet\r\n\t                }\r\n\t                else {\r\n\t                \t// Check if it has custom field tokens, also called\r\n\t                \t// \"relevant tokens\"\r\n\t                \tif ( \r\n\t                \t\tisDefined( fieldAttributes.customFieldTokens )\r\n\t                \t\t&& isObject( fieldAttributes.customFieldTokens )\r\n\t                \t){\r\n\t                \t\t// Iterate the relevant tokens\r\n\t                \t\tObject.entries( fieldAttributes.customFieldTokens ).forEach(( [ tokenId, tokenName ] ) => {\r\n\t                \t\t\titemTokens.push({\r\n\t                                id:       `${ item.id }:${ item.itemCode }:${ tokenId }`,\r\n\t                                name:      tokenName,\r\n\t                                type:      fieldAttributes.fieldType == 'select' || fieldAttributes.fieldType == 'textarea' ? 'text' : fieldAttributes.fieldType,\r\n\t                                value:     Field.getValue(),\r\n\t                                fieldId:   fieldAttributes.optionCode,\r\n\t                                itemID:    item.id,\r\n\t                                cacheable: true\r\n\t                            });\r\n\t                \t\t});\r\n\t                \t}\r\n\t                \telse {\r\n\t                \t\t// Create a token using the field label\r\n\t                \t\titemTokens.push({\r\n\t                            id:      `${ item.id }:${ item.itemCode }:${ fieldAttributes.optionCode }`,\r\n\t                            name:    fieldAttributes.tokenName,\r\n\t                            type:    fieldAttributes.fieldType == 'select' || fieldAttributes.fieldType == 'textarea' ? 'text' : fieldAttributes.fieldType,\r\n\t                            value:   Field.getValue(),\r\n\t                            fieldId: fieldAttributes.optionCode,\r\n\t                            itemID:  item.id,\r\n\t                            cacheable: true\r\n\t                        });\r\n\t                \t}\r\n\t                }\r\n\t        \t});\r\n\t        });\r\n\r\n\t        // Custom ITEM tokens\r\n\t        // These are dynamic tokens, for example, the fields of a form\r\n\t        item.tokens.forEach(( token ) => {\r\n\t        \titemTokens.push({\r\n\t                id:   `${ item.id }:${ token.tokenIdentifier }:${ token.tokenId }`,\r\n\t                name: token.tokenName,\r\n\t                type: isDefined( token.tokenType ) ? token.tokenType : 'text',\r\n\t                itemID: item.id,\r\n\t                cacheable: true\r\n\t            });\r\n\t        });\r\n\r\n\t        // Add the tokens to the group\r\n\t        tokensGroup.tokens = itemTokens;\r\n\r\n\t        // Filter tokens using a custom function (if it has one)\r\n\t        if ( ! isEmpty( item.filterTokens ) ){\r\n\t            // Try to overwrite empty function\r\n\t            try {\r\n\t                // Try to convert the string to function, but first remove the <script> tags and trim the string\r\n\t                const filterTokens = eval( `(${ item.filterTokens.replace( '<script>', '' ).replace( '</script>', '' ).trim() })` ); \r\n\r\n\t                // Filter the tokens\r\n\t                itemTokens = filterTokens( tokensGroup, item );\r\n\t            } catch ( e ){\r\n\t            \tconsole.log( e );\r\n\t            \tconsole.log( item.filterTokens );\r\n\t            }\r\n\t        }\r\n\r\n\t        // Filter tokens with the global filter\r\n\t        // This will filter the tokens by type\r\n        \t/*\r\n        \ttokensGroup.tokens = this.filterTokensByType(\r\n        \t\ttokensGroup.tokens,\r\n        \t\tthis.fieldType\r\n        \t);\r\n        \t*/\r\n\t\t}\r\n\r\n        // Add the group of tokens\r\n        return tokensGroup;\r\n\t}\r\n\r\n\t/**\r\n\t * Filters the tokens based on the field type\r\n\t *\r\n\t * @since  3.0\r\n\t * \r\n\t * @param  Array  tokens  The tokens to be filtered\r\n\t * \r\n\t * @return Array  tokens  The tokens, filtered\r\n\t */\r\n\tfilterTokensByType( tokens ){\r\n\t\t// Check if the field type is defined\r\n\t\t// Otherwise, don't filter the tokens\r\n\t\tif ( isDefined( this.fieldType ) ){\r\n\t\t\t// Check if it's NOT a text, textarea or url field\r\n\t\t\t// We don't have to filter tokens for those\r\n\t\t\tif ( ! [ 'text', 'textarea', 'url' ].includes( this.fieldType ) ){\r\n\t\t\t\t// Iterate the tokens\r\n\t\t\t\ttokens = tokens.filter(( token ) => {\r\n\t\t\t\t\t// Get the token type\r\n\t\t\t\t\tlet tokenType = token.type;\r\n\r\n\t\t\t\t\t// Check if the field is a \"float\" field. In that case,\r\n\t\t\t\t\t// promote all the \"int\" tokens to \"float\". All integers\r\n\t\t\t\t\t// are floats\r\n\t\t\t\t\tif ( \r\n\t\t\t\t\t\tthis.fieldType == 'float' \r\n\t\t\t\t\t\t&& tokenType == 'int'\r\n\t\t\t\t\t){\r\n\t\t\t\t\t\ttokenType = 'float';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Check if the token type matches the field type\r\n\t\t\t\t\treturn this.fieldType == tokenType;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn tokens;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a DOM node with the token data\r\n\t *\r\n\t * @since  3.0\r\n\t * \r\n\t * @param  String  tokenID  A token ID\r\n\t * \r\n\t * @return String           The HTML\r\n\t */\r\n\tcreateTokenDOMNode( tokenID ){\r\n\t\t// Default response\r\n\t\tlet $tokenNode = null;\r\n\r\n\t\t// Get more information about the token\r\n\t\tconst token = this.getTokenDataByID( tokenID );\r\n\r\n\t\t// Check if the token is valid\r\n\t\tif ( isDefined( token ) ){\r\n\t\t\t// Check if we already created this element\r\n\t\t\tif ( isDefined( UncannyAutomator.cache.tokens[ token.id ] ) ){\r\n\t\t\t\t$tokenNode = UncannyAutomator.cache.tokens[ token.id ];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Create the token node\r\n\t\t\t\t// VanillaJS because of the performance, this might be heavy\r\n\t\t\t\t$tokenNode = document.createElement( 'span' );\r\n\t\t\t\t$tokenNode.classList.add( 'uap-token' );\r\n\r\n\t\t\t\t// Insert the icon\r\n\t\t\t\t$tokenNode.appendChild( token.group.icon[0].cloneNode() );\r\n\r\n\t\t\t\t// Insert the name\r\n\t\t\t\tconst $tokenName = document.createElement( 'span' );\r\n\t\t\t\t$tokenName.classList.add( 'uap-token__name' );\r\n\t\t\t\t$tokenName.innerHTML = token.name;\r\n\t\t\t\t$tokenNode.appendChild( $tokenName );\r\n\r\n\t\t\t\t// Check if we can save the token in the cache\r\n\t\t\t\tif ( token.cacheable ){\r\n\t\t\t\t\t// Save node in the cache\r\n\t\t\t\t\tUncannyAutomator.cache.tokens[ token.id ] = $tokenNode;\r\n\t\t\t\t}\t\r\n\t\t\t}\r\n\r\n\t\t\t// Clone the node\r\n\t\t\t$tokenNode = $tokenNode.cloneNode( true );\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Create the token node\r\n\t\t\t// VanillaJS because of the performance, this might be heavy\r\n\t\t\t$tokenNode = document.createElement( 'span' );\r\n\t\t\t$tokenNode.classList.add( 'uap-token', 'uap-token--invalid' );\r\n\r\n\t\t\t// Insert the icon\r\n\t\t\tconst $tokenIcon = document.createElement( 'i' );\r\n\t\t\t$tokenIcon.classList.add( 'uo-icon', 'uo-icon--exclamation' );\r\n\t\t\t$tokenNode.appendChild( $tokenIcon );\r\n\r\n\t\t\t// Insert the name\r\n\t\t\tconst $tokenName = document.createElement( 'span' );\r\n\t\t\t$tokenName.classList.add( 'uap-token__name' );\r\n\t\t\t$tokenName.innerHTML = tokenID;\r\n\t\t\t$tokenNode.appendChild( $tokenName );\r\n\t\t}\r\n\r\n\t\treturn $tokenNode;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns more data about a token by just using the token ID\r\n\t *\r\n\t * @since  3.0\r\n\t * \r\n\t * @param  String  tokenID  A token ID\r\n\t * \r\n\t * @return Object           [description]\r\n\t */\r\n\tgetTokenDataByID( tokenID = '' ){\r\n\t\t// Create a copy of the parameter\r\n\t\t// We might change the parameter value later\r\n\t\tconst originalTokenID = tokenID;\r\n\r\n\t\t// Default response\r\n\t\tlet token = null;\r\n\r\n\t\t// Add exception for special tokens\r\n\t\tif ( tokenID.startsWith( 'USERMETA:' ) ){\r\n\t\t\t// Change the token ID so we can get the required data\r\n\t\t\ttokenID = 'USERMETA:KEY';\r\n\t\t}\r\n\r\n\t\t// Check if the tokenID is not empty\r\n\t\tif ( ! isEmpty( tokenID ) ){\r\n\t\t\t// Iterate the groups of tokens\r\n\t\t\tthis.tokens.some(( tokensGroup ) => {\r\n\t\t\t\t// Get the token using the tokenID\r\n\t\t\t\ttoken = tokensGroup.tokens.reduce(( locatedToken, currentToken ) => {\r\n\t\t\t\t\treturn currentToken.id == tokenID ? currentToken : locatedToken;\r\n\t\t\t\t}, null );\r\n\r\n\t\t\t\t// Check if we found a token\r\n\t\t\t\tif ( isDefined( token ) ){\r\n\t\t\t\t\t// Add more data to the token\r\n\t\t\t\t\ttoken.group = {\r\n\t\t\t\t\t\tid:   tokensGroup.id,\r\n\t\t\t\t\t\tname: tokensGroup.name,\r\n\t\t\t\t\t\ticon: tokensGroup.icon,\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Add exception for special tokens\r\n\t\tif ( isDefined( token ) && tokenID.startsWith( 'USERMETA:' ) ){\r\n\t\t\t// Clone the token, don't modify the original\r\n            token = $.extend( true, {}, token );\r\n\r\n\t\t\t// Get the key the user wants to get\r\n\t\t\tconst key  = originalTokenID.replace( 'USERMETA:', '' );\r\n\r\n\t\t\t// Change ID of the token\r\n            token.id   = token.id.replace( 'KEY', key );\r\n\r\n            // Change name of the token\r\n            token.name = vsprintf( UncannyAutomator.i18n.tokens.global.userMetaKeyTemplate, [ key ] ); \r\n\t\t}\r\n\r\n\t\treturn token;\r\n\t}\r\n\r\n\t/**\r\n\t * Render text that has tokens\r\n\t *\r\n\t * @since 3.0\r\n\t * \r\n\t * @param  String   textWithTokens  The text\r\n\t * @return Node                     Node with the text + tokens rendered\r\n\t */\r\n\trenderTextWithTokens( textWithTokens, options = {}){\r\n\t\t// Get the options\r\n\t\toptions = Object.assign({\r\n\t\t\ttemplate: '',\r\n\t\t}, options );\r\n\r\n\t\t// Check if it has a template\r\n\t\tconst hasTemplate = ! isEmpty( options.template );\r\n\r\n\t\t// Create the container\r\n\t\tconst $container = document.createElement( 'span' );\r\n\r\n\t\t// Replace the tokens in the text with tokens\r\n\t\ttextWithTokens = textWithTokens.replace(\r\n\t\t\tthis.tokensRegEx,\r\n\t\t\t( fullMatch, token ) => {\r\n\t\t\t\t// Get token node\r\n\t\t\t\tconst $token = this.createTokenDOMNode( token );\r\n\r\n\t\t\t\t// Get the token node HTML\r\n\t\t\t\tlet tokenHTML = $token.outerHTML;\r\n\r\n\t\t\t\t// Check if we have to add a wrapper to it\r\n\t\t\t\tif ( hasTemplate ){\r\n\t\t\t\t\t// Add the variable data to the template\r\n\t\t\t\t\ttokenHTML = vsprintf( options.template, [\r\n\t\t\t\t\t\ttokenHTML,\r\n\t\t\t\t\t\ttoken\r\n\t\t\t\t\t]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Replace the content with the HTML of the token node\r\n\t\t\t\treturn tokenHTML;\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\t// Add the text, now with the tokens rendered, to the container\r\n\t\t$container.innerHTML = textWithTokens;\r\n\r\n\t\treturn $container;\r\n\t}\r\n}","import { defaults as defaultOptions, HOOKS, } from \"./types/options\";\nimport English from \"./l10n/default\";\nimport { arrayify, debounce, int, pad } from \"./utils\";\nimport { clearNode, createElement, createNumberInput, findParent, toggleClass, getEventTarget, } from \"./utils/dom\";\nimport { compareDates, createDateParser, createDateFormatter, duration, isBetween, getDefaultHours, } from \"./utils/dates\";\nimport { tokenRegex, monthToStr } from \"./utils/formatting\";\nimport \"./utils/polyfills\";\nconst DEBOUNCED_CHANGE_MS = 300;\nfunction FlatpickrInstance(element, instanceConfig) {\n    const self = {\n        config: Object.assign(Object.assign({}, defaultOptions), flatpickr.defaultConfig),\n        l10n: English,\n    };\n    self.parseDate = createDateParser({ config: self.config, l10n: self.l10n });\n    self._handlers = [];\n    self.pluginElements = [];\n    self.loadedPlugins = [];\n    self._bind = bind;\n    self._setHoursFromDate = setHoursFromDate;\n    self._positionCalendar = positionCalendar;\n    self.changeMonth = changeMonth;\n    self.changeYear = changeYear;\n    self.clear = clear;\n    self.close = close;\n    self._createElement = createElement;\n    self.destroy = destroy;\n    self.isEnabled = isEnabled;\n    self.jumpToDate = jumpToDate;\n    self.open = open;\n    self.redraw = redraw;\n    self.set = set;\n    self.setDate = setDate;\n    self.toggle = toggle;\n    function setupHelperFunctions() {\n        self.utils = {\n            getDaysInMonth(month = self.currentMonth, yr = self.currentYear) {\n                if (month === 1 && ((yr % 4 === 0 && yr % 100 !== 0) || yr % 400 === 0))\n                    return 29;\n                return self.l10n.daysInMonth[month];\n            },\n        };\n    }\n    function init() {\n        self.element = self.input = element;\n        self.isOpen = false;\n        parseConfig();\n        setupLocale();\n        setupInputs();\n        setupDates();\n        setupHelperFunctions();\n        if (!self.isMobile)\n            build();\n        bindEvents();\n        if (self.selectedDates.length || self.config.noCalendar) {\n            if (self.config.enableTime) {\n                setHoursFromDate(self.config.noCalendar ? self.latestSelectedDateObj : undefined);\n            }\n            updateValue(false);\n        }\n        setCalendarWidth();\n        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n        if (!self.isMobile && isSafari) {\n            positionCalendar();\n        }\n        triggerEvent(\"onReady\");\n    }\n    function bindToInstance(fn) {\n        return fn.bind(self);\n    }\n    function setCalendarWidth() {\n        const config = self.config;\n        if (config.weekNumbers === false && config.showMonths === 1) {\n            return;\n        }\n        else if (config.noCalendar !== true) {\n            window.requestAnimationFrame(function () {\n                if (self.calendarContainer !== undefined) {\n                    self.calendarContainer.style.visibility = \"hidden\";\n                    self.calendarContainer.style.display = \"block\";\n                }\n                if (self.daysContainer !== undefined) {\n                    const daysWidth = (self.days.offsetWidth + 1) * config.showMonths;\n                    self.daysContainer.style.width = daysWidth + \"px\";\n                    self.calendarContainer.style.width =\n                        daysWidth +\n                            (self.weekWrapper !== undefined\n                                ? self.weekWrapper.offsetWidth\n                                : 0) +\n                            \"px\";\n                    self.calendarContainer.style.removeProperty(\"visibility\");\n                    self.calendarContainer.style.removeProperty(\"display\");\n                }\n            });\n        }\n    }\n    function updateTime(e) {\n        if (self.selectedDates.length === 0) {\n            const defaultDate = self.config.minDate === undefined ||\n                compareDates(new Date(), self.config.minDate) >= 0\n                ? new Date()\n                : new Date(self.config.minDate.getTime());\n            const defaults = getDefaultHours(self.config);\n            defaultDate.setHours(defaults.hours, defaults.minutes, defaults.seconds, defaultDate.getMilliseconds());\n            self.selectedDates = [defaultDate];\n            self.latestSelectedDateObj = defaultDate;\n        }\n        if (e !== undefined && e.type !== \"blur\") {\n            timeWrapper(e);\n        }\n        const prevValue = self._input.value;\n        setHoursFromInputs();\n        updateValue();\n        if (self._input.value !== prevValue) {\n            self._debouncedChange();\n        }\n    }\n    function ampm2military(hour, amPM) {\n        return (hour % 12) + 12 * int(amPM === self.l10n.amPM[1]);\n    }\n    function military2ampm(hour) {\n        switch (hour % 24) {\n            case 0:\n            case 12:\n                return 12;\n            default:\n                return hour % 12;\n        }\n    }\n    function setHoursFromInputs() {\n        if (self.hourElement === undefined || self.minuteElement === undefined)\n            return;\n        let hours = (parseInt(self.hourElement.value.slice(-2), 10) || 0) % 24, minutes = (parseInt(self.minuteElement.value, 10) || 0) % 60, seconds = self.secondElement !== undefined\n            ? (parseInt(self.secondElement.value, 10) || 0) % 60\n            : 0;\n        if (self.amPM !== undefined) {\n            hours = ampm2military(hours, self.amPM.textContent);\n        }\n        const limitMinHours = self.config.minTime !== undefined ||\n            (self.config.minDate &&\n                self.minDateHasTime &&\n                self.latestSelectedDateObj &&\n                compareDates(self.latestSelectedDateObj, self.config.minDate, true) ===\n                    0);\n        const limitMaxHours = self.config.maxTime !== undefined ||\n            (self.config.maxDate &&\n                self.maxDateHasTime &&\n                self.latestSelectedDateObj &&\n                compareDates(self.latestSelectedDateObj, self.config.maxDate, true) ===\n                    0);\n        if (limitMaxHours) {\n            const maxTime = self.config.maxTime !== undefined\n                ? self.config.maxTime\n                : self.config.maxDate;\n            hours = Math.min(hours, maxTime.getHours());\n            if (hours === maxTime.getHours())\n                minutes = Math.min(minutes, maxTime.getMinutes());\n            if (minutes === maxTime.getMinutes())\n                seconds = Math.min(seconds, maxTime.getSeconds());\n        }\n        if (limitMinHours) {\n            const minTime = self.config.minTime !== undefined\n                ? self.config.minTime\n                : self.config.minDate;\n            hours = Math.max(hours, minTime.getHours());\n            if (hours === minTime.getHours() && minutes < minTime.getMinutes())\n                minutes = minTime.getMinutes();\n            if (minutes === minTime.getMinutes())\n                seconds = Math.max(seconds, minTime.getSeconds());\n        }\n        setHours(hours, minutes, seconds);\n    }\n    function setHoursFromDate(dateObj) {\n        const date = dateObj || self.latestSelectedDateObj;\n        if (date) {\n            setHours(date.getHours(), date.getMinutes(), date.getSeconds());\n        }\n    }\n    function setHours(hours, minutes, seconds) {\n        if (self.latestSelectedDateObj !== undefined) {\n            self.latestSelectedDateObj.setHours(hours % 24, minutes, seconds || 0, 0);\n        }\n        if (!self.hourElement || !self.minuteElement || self.isMobile)\n            return;\n        self.hourElement.value = pad(!self.config.time_24hr\n            ? ((12 + hours) % 12) + 12 * int(hours % 12 === 0)\n            : hours);\n        self.minuteElement.value = pad(minutes);\n        if (self.amPM !== undefined)\n            self.amPM.textContent = self.l10n.amPM[int(hours >= 12)];\n        if (self.secondElement !== undefined)\n            self.secondElement.value = pad(seconds);\n    }\n    function onYearInput(event) {\n        const eventTarget = getEventTarget(event);\n        const year = parseInt(eventTarget.value) + (event.delta || 0);\n        if (year / 1000 > 1 ||\n            (event.key === \"Enter\" && !/[^\\d]/.test(year.toString()))) {\n            changeYear(year);\n        }\n    }\n    function bind(element, event, handler, options) {\n        if (event instanceof Array)\n            return event.forEach((ev) => bind(element, ev, handler, options));\n        if (element instanceof Array)\n            return element.forEach((el) => bind(el, event, handler, options));\n        element.addEventListener(event, handler, options);\n        self._handlers.push({\n            remove: () => element.removeEventListener(event, handler),\n        });\n    }\n    function triggerChange() {\n        triggerEvent(\"onChange\");\n    }\n    function bindEvents() {\n        if (self.config.wrap) {\n            [\"open\", \"close\", \"toggle\", \"clear\"].forEach((evt) => {\n                Array.prototype.forEach.call(self.element.querySelectorAll(`[data-${evt}]`), (el) => bind(el, \"click\", self[evt]));\n            });\n        }\n        if (self.isMobile) {\n            setupMobile();\n            return;\n        }\n        const debouncedResize = debounce(onResize, 50);\n        self._debouncedChange = debounce(triggerChange, DEBOUNCED_CHANGE_MS);\n        if (self.daysContainer && !/iPhone|iPad|iPod/i.test(navigator.userAgent))\n            bind(self.daysContainer, \"mouseover\", (e) => {\n                if (self.config.mode === \"range\")\n                    onMouseOver(getEventTarget(e));\n            });\n        bind(window.document.body, \"keydown\", onKeyDown);\n        if (!self.config.inline && !self.config.static)\n            bind(window, \"resize\", debouncedResize);\n        if (window.ontouchstart !== undefined)\n            bind(window.document, \"touchstart\", documentClick);\n        else\n            bind(window.document, \"mousedown\", documentClick);\n        bind(window.document, \"focus\", documentClick, { capture: true });\n        if (self.config.clickOpens === true) {\n            bind(self._input, \"focus\", self.open);\n            bind(self._input, \"click\", self.open);\n        }\n        if (self.daysContainer !== undefined) {\n            bind(self.monthNav, \"click\", onMonthNavClick);\n            bind(self.monthNav, [\"keyup\", \"increment\"], onYearInput);\n            bind(self.daysContainer, \"click\", selectDate);\n        }\n        if (self.timeContainer !== undefined &&\n            self.minuteElement !== undefined &&\n            self.hourElement !== undefined) {\n            const selText = (e) => getEventTarget(e).select();\n            bind(self.timeContainer, [\"increment\"], updateTime);\n            bind(self.timeContainer, \"blur\", updateTime, { capture: true });\n            bind(self.timeContainer, \"click\", timeIncrement);\n            bind([self.hourElement, self.minuteElement], [\"focus\", \"click\"], selText);\n            if (self.secondElement !== undefined)\n                bind(self.secondElement, \"focus\", () => self.secondElement && self.secondElement.select());\n            if (self.amPM !== undefined) {\n                bind(self.amPM, \"click\", (e) => {\n                    updateTime(e);\n                    triggerChange();\n                });\n            }\n        }\n        if (self.config.allowInput) {\n            bind(self._input, \"blur\", onBlur);\n        }\n    }\n    function jumpToDate(jumpDate, triggerChange) {\n        const jumpTo = jumpDate !== undefined\n            ? self.parseDate(jumpDate)\n            : self.latestSelectedDateObj ||\n                (self.config.minDate && self.config.minDate > self.now\n                    ? self.config.minDate\n                    : self.config.maxDate && self.config.maxDate < self.now\n                        ? self.config.maxDate\n                        : self.now);\n        const oldYear = self.currentYear;\n        const oldMonth = self.currentMonth;\n        try {\n            if (jumpTo !== undefined) {\n                self.currentYear = jumpTo.getFullYear();\n                self.currentMonth = jumpTo.getMonth();\n            }\n        }\n        catch (e) {\n            e.message = \"Invalid date supplied: \" + jumpTo;\n            self.config.errorHandler(e);\n        }\n        if (triggerChange && self.currentYear !== oldYear) {\n            triggerEvent(\"onYearChange\");\n            buildMonthSwitch();\n        }\n        if (triggerChange &&\n            (self.currentYear !== oldYear || self.currentMonth !== oldMonth)) {\n            triggerEvent(\"onMonthChange\");\n        }\n        self.redraw();\n    }\n    function timeIncrement(e) {\n        const eventTarget = getEventTarget(e);\n        if (~eventTarget.className.indexOf(\"arrow\"))\n            incrementNumInput(e, eventTarget.classList.contains(\"arrowUp\") ? 1 : -1);\n    }\n    function incrementNumInput(e, delta, inputElem) {\n        const target = e && getEventTarget(e);\n        const input = inputElem ||\n            (target && target.parentNode && target.parentNode.firstChild);\n        const event = createEvent(\"increment\");\n        event.delta = delta;\n        input && input.dispatchEvent(event);\n    }\n    function build() {\n        const fragment = window.document.createDocumentFragment();\n        self.calendarContainer = createElement(\"div\", \"flatpickr-calendar\");\n        self.calendarContainer.tabIndex = -1;\n        if (!self.config.noCalendar) {\n            fragment.appendChild(buildMonthNav());\n            self.innerContainer = createElement(\"div\", \"flatpickr-innerContainer\");\n            if (self.config.weekNumbers) {\n                const { weekWrapper, weekNumbers } = buildWeeks();\n                self.innerContainer.appendChild(weekWrapper);\n                self.weekNumbers = weekNumbers;\n                self.weekWrapper = weekWrapper;\n            }\n            self.rContainer = createElement(\"div\", \"flatpickr-rContainer\");\n            self.rContainer.appendChild(buildWeekdays());\n            if (!self.daysContainer) {\n                self.daysContainer = createElement(\"div\", \"flatpickr-days\");\n                self.daysContainer.tabIndex = -1;\n            }\n            buildDays();\n            self.rContainer.appendChild(self.daysContainer);\n            self.innerContainer.appendChild(self.rContainer);\n            fragment.appendChild(self.innerContainer);\n        }\n        if (self.config.enableTime) {\n            fragment.appendChild(buildTime());\n        }\n        toggleClass(self.calendarContainer, \"rangeMode\", self.config.mode === \"range\");\n        toggleClass(self.calendarContainer, \"animate\", self.config.animate === true);\n        toggleClass(self.calendarContainer, \"multiMonth\", self.config.showMonths > 1);\n        self.calendarContainer.appendChild(fragment);\n        const customAppend = self.config.appendTo !== undefined &&\n            self.config.appendTo.nodeType !== undefined;\n        if (self.config.inline || self.config.static) {\n            self.calendarContainer.classList.add(self.config.inline ? \"inline\" : \"static\");\n            if (self.config.inline) {\n                if (!customAppend && self.element.parentNode)\n                    self.element.parentNode.insertBefore(self.calendarContainer, self._input.nextSibling);\n                else if (self.config.appendTo !== undefined)\n                    self.config.appendTo.appendChild(self.calendarContainer);\n            }\n            if (self.config.static) {\n                const wrapper = createElement(\"div\", \"flatpickr-wrapper\");\n                if (self.element.parentNode)\n                    self.element.parentNode.insertBefore(wrapper, self.element);\n                wrapper.appendChild(self.element);\n                if (self.altInput)\n                    wrapper.appendChild(self.altInput);\n                wrapper.appendChild(self.calendarContainer);\n            }\n        }\n        if (!self.config.static && !self.config.inline)\n            (self.config.appendTo !== undefined\n                ? self.config.appendTo\n                : window.document.body).appendChild(self.calendarContainer);\n    }\n    function createDay(className, date, dayNumber, i) {\n        const dateIsEnabled = isEnabled(date, true), dayElement = createElement(\"span\", \"flatpickr-day \" + className, date.getDate().toString());\n        dayElement.dateObj = date;\n        dayElement.$i = i;\n        dayElement.setAttribute(\"aria-label\", self.formatDate(date, self.config.ariaDateFormat));\n        if (className.indexOf(\"hidden\") === -1 &&\n            compareDates(date, self.now) === 0) {\n            self.todayDateElem = dayElement;\n            dayElement.classList.add(\"today\");\n            dayElement.setAttribute(\"aria-current\", \"date\");\n        }\n        if (dateIsEnabled) {\n            dayElement.tabIndex = -1;\n            if (isDateSelected(date)) {\n                dayElement.classList.add(\"selected\");\n                self.selectedDateElem = dayElement;\n                if (self.config.mode === \"range\") {\n                    toggleClass(dayElement, \"startRange\", self.selectedDates[0] &&\n                        compareDates(date, self.selectedDates[0], true) === 0);\n                    toggleClass(dayElement, \"endRange\", self.selectedDates[1] &&\n                        compareDates(date, self.selectedDates[1], true) === 0);\n                    if (className === \"nextMonthDay\")\n                        dayElement.classList.add(\"inRange\");\n                }\n            }\n        }\n        else {\n            dayElement.classList.add(\"flatpickr-disabled\");\n        }\n        if (self.config.mode === \"range\") {\n            if (isDateInRange(date) && !isDateSelected(date))\n                dayElement.classList.add(\"inRange\");\n        }\n        if (self.weekNumbers &&\n            self.config.showMonths === 1 &&\n            className !== \"prevMonthDay\" &&\n            dayNumber % 7 === 1) {\n            self.weekNumbers.insertAdjacentHTML(\"beforeend\", \"<span class='flatpickr-day'>\" + self.config.getWeek(date) + \"</span>\");\n        }\n        triggerEvent(\"onDayCreate\", dayElement);\n        return dayElement;\n    }\n    function focusOnDayElem(targetNode) {\n        targetNode.focus();\n        if (self.config.mode === \"range\")\n            onMouseOver(targetNode);\n    }\n    function getFirstAvailableDay(delta) {\n        const startMonth = delta > 0 ? 0 : self.config.showMonths - 1;\n        const endMonth = delta > 0 ? self.config.showMonths : -1;\n        for (let m = startMonth; m != endMonth; m += delta) {\n            const month = self.daysContainer.children[m];\n            const startIndex = delta > 0 ? 0 : month.children.length - 1;\n            const endIndex = delta > 0 ? month.children.length : -1;\n            for (let i = startIndex; i != endIndex; i += delta) {\n                const c = month.children[i];\n                if (c.className.indexOf(\"hidden\") === -1 && isEnabled(c.dateObj))\n                    return c;\n            }\n        }\n        return undefined;\n    }\n    function getNextAvailableDay(current, delta) {\n        const givenMonth = current.className.indexOf(\"Month\") === -1\n            ? current.dateObj.getMonth()\n            : self.currentMonth;\n        const endMonth = delta > 0 ? self.config.showMonths : -1;\n        const loopDelta = delta > 0 ? 1 : -1;\n        for (let m = givenMonth - self.currentMonth; m != endMonth; m += loopDelta) {\n            const month = self.daysContainer.children[m];\n            const startIndex = givenMonth - self.currentMonth === m\n                ? current.$i + delta\n                : delta < 0\n                    ? month.children.length - 1\n                    : 0;\n            const numMonthDays = month.children.length;\n            for (let i = startIndex; i >= 0 && i < numMonthDays && i != (delta > 0 ? numMonthDays : -1); i += loopDelta) {\n                const c = month.children[i];\n                if (c.className.indexOf(\"hidden\") === -1 &&\n                    isEnabled(c.dateObj) &&\n                    Math.abs(current.$i - i) >= Math.abs(delta))\n                    return focusOnDayElem(c);\n            }\n        }\n        self.changeMonth(loopDelta);\n        focusOnDay(getFirstAvailableDay(loopDelta), 0);\n        return undefined;\n    }\n    function focusOnDay(current, offset) {\n        const dayFocused = isInView(document.activeElement || document.body);\n        const startElem = current !== undefined\n            ? current\n            : dayFocused\n                ? document.activeElement\n                : self.selectedDateElem !== undefined && isInView(self.selectedDateElem)\n                    ? self.selectedDateElem\n                    : self.todayDateElem !== undefined && isInView(self.todayDateElem)\n                        ? self.todayDateElem\n                        : getFirstAvailableDay(offset > 0 ? 1 : -1);\n        if (startElem === undefined) {\n            self._input.focus();\n        }\n        else if (!dayFocused) {\n            focusOnDayElem(startElem);\n        }\n        else {\n            getNextAvailableDay(startElem, offset);\n        }\n    }\n    function buildMonthDays(year, month) {\n        const firstOfMonth = (new Date(year, month, 1).getDay() - self.l10n.firstDayOfWeek + 7) % 7;\n        const prevMonthDays = self.utils.getDaysInMonth((month - 1 + 12) % 12, year);\n        const daysInMonth = self.utils.getDaysInMonth(month, year), days = window.document.createDocumentFragment(), isMultiMonth = self.config.showMonths > 1, prevMonthDayClass = isMultiMonth ? \"prevMonthDay hidden\" : \"prevMonthDay\", nextMonthDayClass = isMultiMonth ? \"nextMonthDay hidden\" : \"nextMonthDay\";\n        let dayNumber = prevMonthDays + 1 - firstOfMonth, dayIndex = 0;\n        for (; dayNumber <= prevMonthDays; dayNumber++, dayIndex++) {\n            days.appendChild(createDay(prevMonthDayClass, new Date(year, month - 1, dayNumber), dayNumber, dayIndex));\n        }\n        for (dayNumber = 1; dayNumber <= daysInMonth; dayNumber++, dayIndex++) {\n            days.appendChild(createDay(\"\", new Date(year, month, dayNumber), dayNumber, dayIndex));\n        }\n        for (let dayNum = daysInMonth + 1; dayNum <= 42 - firstOfMonth &&\n            (self.config.showMonths === 1 || dayIndex % 7 !== 0); dayNum++, dayIndex++) {\n            days.appendChild(createDay(nextMonthDayClass, new Date(year, month + 1, dayNum % daysInMonth), dayNum, dayIndex));\n        }\n        const dayContainer = createElement(\"div\", \"dayContainer\");\n        dayContainer.appendChild(days);\n        return dayContainer;\n    }\n    function buildDays() {\n        if (self.daysContainer === undefined) {\n            return;\n        }\n        clearNode(self.daysContainer);\n        if (self.weekNumbers)\n            clearNode(self.weekNumbers);\n        const frag = document.createDocumentFragment();\n        for (let i = 0; i < self.config.showMonths; i++) {\n            const d = new Date(self.currentYear, self.currentMonth, 1);\n            d.setMonth(self.currentMonth + i);\n            frag.appendChild(buildMonthDays(d.getFullYear(), d.getMonth()));\n        }\n        self.daysContainer.appendChild(frag);\n        self.days = self.daysContainer.firstChild;\n        if (self.config.mode === \"range\" && self.selectedDates.length === 1) {\n            onMouseOver();\n        }\n    }\n    function buildMonthSwitch() {\n        if (self.config.showMonths > 1 ||\n            self.config.monthSelectorType !== \"dropdown\")\n            return;\n        const shouldBuildMonth = function (month) {\n            if (self.config.minDate !== undefined &&\n                self.currentYear === self.config.minDate.getFullYear() &&\n                month < self.config.minDate.getMonth()) {\n                return false;\n            }\n            return !(self.config.maxDate !== undefined &&\n                self.currentYear === self.config.maxDate.getFullYear() &&\n                month > self.config.maxDate.getMonth());\n        };\n        self.monthsDropdownContainer.tabIndex = -1;\n        self.monthsDropdownContainer.innerHTML = \"\";\n        for (let i = 0; i < 12; i++) {\n            if (!shouldBuildMonth(i))\n                continue;\n            const month = createElement(\"option\", \"flatpickr-monthDropdown-month\");\n            month.value = new Date(self.currentYear, i).getMonth().toString();\n            month.textContent = monthToStr(i, self.config.shorthandCurrentMonth, self.l10n);\n            month.tabIndex = -1;\n            if (self.currentMonth === i) {\n                month.selected = true;\n            }\n            self.monthsDropdownContainer.appendChild(month);\n        }\n    }\n    function buildMonth() {\n        const container = createElement(\"div\", \"flatpickr-month\");\n        const monthNavFragment = window.document.createDocumentFragment();\n        let monthElement;\n        if (self.config.showMonths > 1 ||\n            self.config.monthSelectorType === \"static\") {\n            monthElement = createElement(\"span\", \"cur-month\");\n        }\n        else {\n            self.monthsDropdownContainer = createElement(\"select\", \"flatpickr-monthDropdown-months\");\n            self.monthsDropdownContainer.setAttribute(\"aria-label\", self.l10n.monthAriaLabel);\n            bind(self.monthsDropdownContainer, \"change\", (e) => {\n                const target = getEventTarget(e);\n                const selectedMonth = parseInt(target.value, 10);\n                self.changeMonth(selectedMonth - self.currentMonth);\n                triggerEvent(\"onMonthChange\");\n            });\n            buildMonthSwitch();\n            monthElement = self.monthsDropdownContainer;\n        }\n        const yearInput = createNumberInput(\"cur-year\", { tabindex: \"-1\" });\n        const yearElement = yearInput.getElementsByTagName(\"input\")[0];\n        yearElement.setAttribute(\"aria-label\", self.l10n.yearAriaLabel);\n        if (self.config.minDate) {\n            yearElement.setAttribute(\"min\", self.config.minDate.getFullYear().toString());\n        }\n        if (self.config.maxDate) {\n            yearElement.setAttribute(\"max\", self.config.maxDate.getFullYear().toString());\n            yearElement.disabled =\n                !!self.config.minDate &&\n                    self.config.minDate.getFullYear() === self.config.maxDate.getFullYear();\n        }\n        const currentMonth = createElement(\"div\", \"flatpickr-current-month\");\n        currentMonth.appendChild(monthElement);\n        currentMonth.appendChild(yearInput);\n        monthNavFragment.appendChild(currentMonth);\n        container.appendChild(monthNavFragment);\n        return {\n            container,\n            yearElement,\n            monthElement,\n        };\n    }\n    function buildMonths() {\n        clearNode(self.monthNav);\n        self.monthNav.appendChild(self.prevMonthNav);\n        if (self.config.showMonths) {\n            self.yearElements = [];\n            self.monthElements = [];\n        }\n        for (let m = self.config.showMonths; m--;) {\n            const month = buildMonth();\n            self.yearElements.push(month.yearElement);\n            self.monthElements.push(month.monthElement);\n            self.monthNav.appendChild(month.container);\n        }\n        self.monthNav.appendChild(self.nextMonthNav);\n    }\n    function buildMonthNav() {\n        self.monthNav = createElement(\"div\", \"flatpickr-months\");\n        self.yearElements = [];\n        self.monthElements = [];\n        self.prevMonthNav = createElement(\"span\", \"flatpickr-prev-month\");\n        self.prevMonthNav.innerHTML = self.config.prevArrow;\n        self.nextMonthNav = createElement(\"span\", \"flatpickr-next-month\");\n        self.nextMonthNav.innerHTML = self.config.nextArrow;\n        buildMonths();\n        Object.defineProperty(self, \"_hidePrevMonthArrow\", {\n            get: () => self.__hidePrevMonthArrow,\n            set(bool) {\n                if (self.__hidePrevMonthArrow !== bool) {\n                    toggleClass(self.prevMonthNav, \"flatpickr-disabled\", bool);\n                    self.__hidePrevMonthArrow = bool;\n                }\n            },\n        });\n        Object.defineProperty(self, \"_hideNextMonthArrow\", {\n            get: () => self.__hideNextMonthArrow,\n            set(bool) {\n                if (self.__hideNextMonthArrow !== bool) {\n                    toggleClass(self.nextMonthNav, \"flatpickr-disabled\", bool);\n                    self.__hideNextMonthArrow = bool;\n                }\n            },\n        });\n        self.currentYearElement = self.yearElements[0];\n        updateNavigationCurrentMonth();\n        return self.monthNav;\n    }\n    function buildTime() {\n        self.calendarContainer.classList.add(\"hasTime\");\n        if (self.config.noCalendar)\n            self.calendarContainer.classList.add(\"noCalendar\");\n        const defaults = getDefaultHours(self.config);\n        self.timeContainer = createElement(\"div\", \"flatpickr-time\");\n        self.timeContainer.tabIndex = -1;\n        const separator = createElement(\"span\", \"flatpickr-time-separator\", \":\");\n        const hourInput = createNumberInput(\"flatpickr-hour\", {\n            \"aria-label\": self.l10n.hourAriaLabel,\n        });\n        self.hourElement = hourInput.getElementsByTagName(\"input\")[0];\n        const minuteInput = createNumberInput(\"flatpickr-minute\", {\n            \"aria-label\": self.l10n.minuteAriaLabel,\n        });\n        self.minuteElement = minuteInput.getElementsByTagName(\"input\")[0];\n        self.hourElement.tabIndex = self.minuteElement.tabIndex = -1;\n        self.hourElement.value = pad(self.latestSelectedDateObj\n            ? self.latestSelectedDateObj.getHours()\n            : self.config.time_24hr\n                ? defaults.hours\n                : military2ampm(defaults.hours));\n        self.minuteElement.value = pad(self.latestSelectedDateObj\n            ? self.latestSelectedDateObj.getMinutes()\n            : defaults.minutes);\n        self.hourElement.setAttribute(\"step\", self.config.hourIncrement.toString());\n        self.minuteElement.setAttribute(\"step\", self.config.minuteIncrement.toString());\n        self.hourElement.setAttribute(\"min\", self.config.time_24hr ? \"0\" : \"1\");\n        self.hourElement.setAttribute(\"max\", self.config.time_24hr ? \"23\" : \"12\");\n        self.hourElement.setAttribute(\"maxlength\", \"2\");\n        self.minuteElement.setAttribute(\"min\", \"0\");\n        self.minuteElement.setAttribute(\"max\", \"59\");\n        self.minuteElement.setAttribute(\"maxlength\", \"2\");\n        self.timeContainer.appendChild(hourInput);\n        self.timeContainer.appendChild(separator);\n        self.timeContainer.appendChild(minuteInput);\n        if (self.config.time_24hr)\n            self.timeContainer.classList.add(\"time24hr\");\n        if (self.config.enableSeconds) {\n            self.timeContainer.classList.add(\"hasSeconds\");\n            const secondInput = createNumberInput(\"flatpickr-second\");\n            self.secondElement = secondInput.getElementsByTagName(\"input\")[0];\n            self.secondElement.value = pad(self.latestSelectedDateObj\n                ? self.latestSelectedDateObj.getSeconds()\n                : defaults.seconds);\n            self.secondElement.setAttribute(\"step\", self.minuteElement.getAttribute(\"step\"));\n            self.secondElement.setAttribute(\"min\", \"0\");\n            self.secondElement.setAttribute(\"max\", \"59\");\n            self.secondElement.setAttribute(\"maxlength\", \"2\");\n            self.timeContainer.appendChild(createElement(\"span\", \"flatpickr-time-separator\", \":\"));\n            self.timeContainer.appendChild(secondInput);\n        }\n        if (!self.config.time_24hr) {\n            self.amPM = createElement(\"span\", \"flatpickr-am-pm\", self.l10n.amPM[int((self.latestSelectedDateObj\n                ? self.hourElement.value\n                : self.config.defaultHour) > 11)]);\n            self.amPM.title = self.l10n.toggleTitle;\n            self.amPM.tabIndex = -1;\n            self.timeContainer.appendChild(self.amPM);\n        }\n        return self.timeContainer;\n    }\n    function buildWeekdays() {\n        if (!self.weekdayContainer)\n            self.weekdayContainer = createElement(\"div\", \"flatpickr-weekdays\");\n        else\n            clearNode(self.weekdayContainer);\n        for (let i = self.config.showMonths; i--;) {\n            const container = createElement(\"div\", \"flatpickr-weekdaycontainer\");\n            self.weekdayContainer.appendChild(container);\n        }\n        updateWeekdays();\n        return self.weekdayContainer;\n    }\n    function updateWeekdays() {\n        if (!self.weekdayContainer) {\n            return;\n        }\n        const firstDayOfWeek = self.l10n.firstDayOfWeek;\n        let weekdays = [...self.l10n.weekdays.shorthand];\n        if (firstDayOfWeek > 0 && firstDayOfWeek < weekdays.length) {\n            weekdays = [\n                ...weekdays.splice(firstDayOfWeek, weekdays.length),\n                ...weekdays.splice(0, firstDayOfWeek),\n            ];\n        }\n        for (let i = self.config.showMonths; i--;) {\n            self.weekdayContainer.children[i].innerHTML = `\n      <span class='flatpickr-weekday'>\n        ${weekdays.join(\"</span><span class='flatpickr-weekday'>\")}\n      </span>\n      `;\n        }\n    }\n    function buildWeeks() {\n        self.calendarContainer.classList.add(\"hasWeeks\");\n        const weekWrapper = createElement(\"div\", \"flatpickr-weekwrapper\");\n        weekWrapper.appendChild(createElement(\"span\", \"flatpickr-weekday\", self.l10n.weekAbbreviation));\n        const weekNumbers = createElement(\"div\", \"flatpickr-weeks\");\n        weekWrapper.appendChild(weekNumbers);\n        return {\n            weekWrapper,\n            weekNumbers,\n        };\n    }\n    function changeMonth(value, isOffset = true) {\n        const delta = isOffset ? value : value - self.currentMonth;\n        if ((delta < 0 && self._hidePrevMonthArrow === true) ||\n            (delta > 0 && self._hideNextMonthArrow === true))\n            return;\n        self.currentMonth += delta;\n        if (self.currentMonth < 0 || self.currentMonth > 11) {\n            self.currentYear += self.currentMonth > 11 ? 1 : -1;\n            self.currentMonth = (self.currentMonth + 12) % 12;\n            triggerEvent(\"onYearChange\");\n            buildMonthSwitch();\n        }\n        buildDays();\n        triggerEvent(\"onMonthChange\");\n        updateNavigationCurrentMonth();\n    }\n    function clear(triggerChangeEvent = true, toInitial = true) {\n        self.input.value = \"\";\n        if (self.altInput !== undefined)\n            self.altInput.value = \"\";\n        if (self.mobileInput !== undefined)\n            self.mobileInput.value = \"\";\n        self.selectedDates = [];\n        self.latestSelectedDateObj = undefined;\n        if (toInitial === true) {\n            self.currentYear = self._initialDate.getFullYear();\n            self.currentMonth = self._initialDate.getMonth();\n        }\n        if (self.config.enableTime === true) {\n            const { hours, minutes, seconds } = getDefaultHours(self.config);\n            setHours(hours, minutes, seconds);\n        }\n        self.redraw();\n        if (triggerChangeEvent)\n            triggerEvent(\"onChange\");\n    }\n    function close() {\n        self.isOpen = false;\n        if (!self.isMobile) {\n            if (self.calendarContainer !== undefined) {\n                self.calendarContainer.classList.remove(\"open\");\n            }\n            if (self._input !== undefined) {\n                self._input.classList.remove(\"active\");\n            }\n        }\n        triggerEvent(\"onClose\");\n    }\n    function destroy() {\n        if (self.config !== undefined)\n            triggerEvent(\"onDestroy\");\n        for (let i = self._handlers.length; i--;) {\n            self._handlers[i].remove();\n        }\n        self._handlers = [];\n        if (self.mobileInput) {\n            if (self.mobileInput.parentNode)\n                self.mobileInput.parentNode.removeChild(self.mobileInput);\n            self.mobileInput = undefined;\n        }\n        else if (self.calendarContainer && self.calendarContainer.parentNode) {\n            if (self.config.static && self.calendarContainer.parentNode) {\n                const wrapper = self.calendarContainer.parentNode;\n                wrapper.lastChild && wrapper.removeChild(wrapper.lastChild);\n                if (wrapper.parentNode) {\n                    while (wrapper.firstChild)\n                        wrapper.parentNode.insertBefore(wrapper.firstChild, wrapper);\n                    wrapper.parentNode.removeChild(wrapper);\n                }\n            }\n            else\n                self.calendarContainer.parentNode.removeChild(self.calendarContainer);\n        }\n        if (self.altInput) {\n            self.input.type = \"text\";\n            if (self.altInput.parentNode)\n                self.altInput.parentNode.removeChild(self.altInput);\n            delete self.altInput;\n        }\n        if (self.input) {\n            self.input.type = self.input._type;\n            self.input.classList.remove(\"flatpickr-input\");\n            self.input.removeAttribute(\"readonly\");\n        }\n        [\n            \"_showTimeInput\",\n            \"latestSelectedDateObj\",\n            \"_hideNextMonthArrow\",\n            \"_hidePrevMonthArrow\",\n            \"__hideNextMonthArrow\",\n            \"__hidePrevMonthArrow\",\n            \"isMobile\",\n            \"isOpen\",\n            \"selectedDateElem\",\n            \"minDateHasTime\",\n            \"maxDateHasTime\",\n            \"days\",\n            \"daysContainer\",\n            \"_input\",\n            \"_positionElement\",\n            \"innerContainer\",\n            \"rContainer\",\n            \"monthNav\",\n            \"todayDateElem\",\n            \"calendarContainer\",\n            \"weekdayContainer\",\n            \"prevMonthNav\",\n            \"nextMonthNav\",\n            \"monthsDropdownContainer\",\n            \"currentMonthElement\",\n            \"currentYearElement\",\n            \"navigationCurrentMonth\",\n            \"selectedDateElem\",\n            \"config\",\n        ].forEach((k) => {\n            try {\n                delete self[k];\n            }\n            catch (_) { }\n        });\n    }\n    function isCalendarElem(elem) {\n        if (self.config.appendTo && self.config.appendTo.contains(elem))\n            return true;\n        return self.calendarContainer.contains(elem);\n    }\n    function documentClick(e) {\n        if (self.isOpen && !self.config.inline) {\n            const eventTarget = getEventTarget(e);\n            const isCalendarElement = isCalendarElem(eventTarget);\n            const isInput = eventTarget === self.input ||\n                eventTarget === self.altInput ||\n                self.element.contains(eventTarget) ||\n                (e.path &&\n                    e.path.indexOf &&\n                    (~e.path.indexOf(self.input) ||\n                        ~e.path.indexOf(self.altInput)));\n            const lostFocus = e.type === \"blur\"\n                ? isInput &&\n                    e.relatedTarget &&\n                    !isCalendarElem(e.relatedTarget)\n                : !isInput &&\n                    !isCalendarElement &&\n                    !isCalendarElem(e.relatedTarget);\n            const isIgnored = !self.config.ignoredFocusElements.some((elem) => elem.contains(eventTarget));\n            if (lostFocus && isIgnored) {\n                if (self.timeContainer !== undefined &&\n                    self.minuteElement !== undefined &&\n                    self.hourElement !== undefined &&\n                    self.input.value !== \"\" &&\n                    self.input.value !== undefined) {\n                    updateTime();\n                }\n                self.close();\n                if (self.config &&\n                    self.config.mode === \"range\" &&\n                    self.selectedDates.length === 1) {\n                    self.clear(false);\n                    self.redraw();\n                }\n            }\n        }\n    }\n    function changeYear(newYear) {\n        if (!newYear ||\n            (self.config.minDate && newYear < self.config.minDate.getFullYear()) ||\n            (self.config.maxDate && newYear > self.config.maxDate.getFullYear()))\n            return;\n        const newYearNum = newYear, isNewYear = self.currentYear !== newYearNum;\n        self.currentYear = newYearNum || self.currentYear;\n        if (self.config.maxDate &&\n            self.currentYear === self.config.maxDate.getFullYear()) {\n            self.currentMonth = Math.min(self.config.maxDate.getMonth(), self.currentMonth);\n        }\n        else if (self.config.minDate &&\n            self.currentYear === self.config.minDate.getFullYear()) {\n            self.currentMonth = Math.max(self.config.minDate.getMonth(), self.currentMonth);\n        }\n        if (isNewYear) {\n            self.redraw();\n            triggerEvent(\"onYearChange\");\n            buildMonthSwitch();\n        }\n    }\n    function isEnabled(date, timeless = true) {\n        var _a;\n        const dateToCheck = self.parseDate(date, undefined, timeless);\n        if ((self.config.minDate &&\n            dateToCheck &&\n            compareDates(dateToCheck, self.config.minDate, timeless !== undefined ? timeless : !self.minDateHasTime) < 0) ||\n            (self.config.maxDate &&\n                dateToCheck &&\n                compareDates(dateToCheck, self.config.maxDate, timeless !== undefined ? timeless : !self.maxDateHasTime) > 0))\n            return false;\n        if (!self.config.enable && self.config.disable.length === 0)\n            return true;\n        if (dateToCheck === undefined)\n            return false;\n        const bool = !!self.config.enable, array = (_a = self.config.enable) !== null && _a !== void 0 ? _a : self.config.disable;\n        for (let i = 0, d; i < array.length; i++) {\n            d = array[i];\n            if (typeof d === \"function\" &&\n                d(dateToCheck))\n                return bool;\n            else if (d instanceof Date &&\n                dateToCheck !== undefined &&\n                d.getTime() === dateToCheck.getTime())\n                return bool;\n            else if (typeof d === \"string\") {\n                const parsed = self.parseDate(d, undefined, true);\n                return parsed && parsed.getTime() === dateToCheck.getTime()\n                    ? bool\n                    : !bool;\n            }\n            else if (typeof d === \"object\" &&\n                dateToCheck !== undefined &&\n                d.from &&\n                d.to &&\n                dateToCheck.getTime() >= d.from.getTime() &&\n                dateToCheck.getTime() <= d.to.getTime())\n                return bool;\n        }\n        return !bool;\n    }\n    function isInView(elem) {\n        if (self.daysContainer !== undefined)\n            return (elem.className.indexOf(\"hidden\") === -1 &&\n                elem.className.indexOf(\"flatpickr-disabled\") === -1 &&\n                self.daysContainer.contains(elem));\n        return false;\n    }\n    function onBlur(e) {\n        const isInput = e.target === self._input;\n        if (isInput &&\n            (self.selectedDates.length > 0 || self._input.value.length > 0) &&\n            !(e.relatedTarget && isCalendarElem(e.relatedTarget))) {\n            self.setDate(self._input.value, true, e.target === self.altInput\n                ? self.config.altFormat\n                : self.config.dateFormat);\n        }\n    }\n    function onKeyDown(e) {\n        const eventTarget = getEventTarget(e);\n        const isInput = self.config.wrap\n            ? element.contains(eventTarget)\n            : eventTarget === self._input;\n        const allowInput = self.config.allowInput;\n        const allowKeydown = self.isOpen && (!allowInput || !isInput);\n        const allowInlineKeydown = self.config.inline && isInput && !allowInput;\n        if (e.keyCode === 13 && isInput) {\n            if (allowInput) {\n                self.setDate(self._input.value, true, eventTarget === self.altInput\n                    ? self.config.altFormat\n                    : self.config.dateFormat);\n                return eventTarget.blur();\n            }\n            else {\n                self.open();\n            }\n        }\n        else if (isCalendarElem(eventTarget) ||\n            allowKeydown ||\n            allowInlineKeydown) {\n            const isTimeObj = !!self.timeContainer &&\n                self.timeContainer.contains(eventTarget);\n            switch (e.keyCode) {\n                case 13:\n                    if (isTimeObj) {\n                        e.preventDefault();\n                        updateTime();\n                        focusAndClose();\n                    }\n                    else\n                        selectDate(e);\n                    break;\n                case 27:\n                    e.preventDefault();\n                    focusAndClose();\n                    break;\n                case 8:\n                case 46:\n                    if (isInput && !self.config.allowInput) {\n                        e.preventDefault();\n                        self.clear();\n                    }\n                    break;\n                case 37:\n                case 39:\n                    if (!isTimeObj && !isInput) {\n                        e.preventDefault();\n                        if (self.daysContainer !== undefined &&\n                            (allowInput === false ||\n                                (document.activeElement && isInView(document.activeElement)))) {\n                            const delta = e.keyCode === 39 ? 1 : -1;\n                            if (!e.ctrlKey)\n                                focusOnDay(undefined, delta);\n                            else {\n                                e.stopPropagation();\n                                changeMonth(delta);\n                                focusOnDay(getFirstAvailableDay(1), 0);\n                            }\n                        }\n                    }\n                    else if (self.hourElement)\n                        self.hourElement.focus();\n                    break;\n                case 38:\n                case 40:\n                    e.preventDefault();\n                    const delta = e.keyCode === 40 ? 1 : -1;\n                    if ((self.daysContainer &&\n                        eventTarget.$i !== undefined) ||\n                        eventTarget === self.input ||\n                        eventTarget === self.altInput) {\n                        if (e.ctrlKey) {\n                            e.stopPropagation();\n                            changeYear(self.currentYear - delta);\n                            focusOnDay(getFirstAvailableDay(1), 0);\n                        }\n                        else if (!isTimeObj)\n                            focusOnDay(undefined, delta * 7);\n                    }\n                    else if (eventTarget === self.currentYearElement) {\n                        changeYear(self.currentYear - delta);\n                    }\n                    else if (self.config.enableTime) {\n                        if (!isTimeObj && self.hourElement)\n                            self.hourElement.focus();\n                        updateTime(e);\n                        self._debouncedChange();\n                    }\n                    break;\n                case 9:\n                    if (isTimeObj) {\n                        const elems = [\n                            self.hourElement,\n                            self.minuteElement,\n                            self.secondElement,\n                            self.amPM,\n                        ]\n                            .concat(self.pluginElements)\n                            .filter((x) => x);\n                        const i = elems.indexOf(eventTarget);\n                        if (i !== -1) {\n                            const target = elems[i + (e.shiftKey ? -1 : 1)];\n                            e.preventDefault();\n                            (target || self._input).focus();\n                        }\n                    }\n                    else if (!self.config.noCalendar &&\n                        self.daysContainer &&\n                        self.daysContainer.contains(eventTarget) &&\n                        e.shiftKey) {\n                        e.preventDefault();\n                        self._input.focus();\n                    }\n                    break;\n                default:\n                    break;\n            }\n        }\n        if (self.amPM !== undefined && eventTarget === self.amPM) {\n            switch (e.key) {\n                case self.l10n.amPM[0].charAt(0):\n                case self.l10n.amPM[0].charAt(0).toLowerCase():\n                    self.amPM.textContent = self.l10n.amPM[0];\n                    setHoursFromInputs();\n                    updateValue();\n                    break;\n                case self.l10n.amPM[1].charAt(0):\n                case self.l10n.amPM[1].charAt(0).toLowerCase():\n                    self.amPM.textContent = self.l10n.amPM[1];\n                    setHoursFromInputs();\n                    updateValue();\n                    break;\n            }\n        }\n        if (isInput || isCalendarElem(eventTarget)) {\n            triggerEvent(\"onKeyDown\", e);\n        }\n    }\n    function onMouseOver(elem) {\n        if (self.selectedDates.length !== 1 ||\n            (elem &&\n                (!elem.classList.contains(\"flatpickr-day\") ||\n                    elem.classList.contains(\"flatpickr-disabled\"))))\n            return;\n        const hoverDate = elem\n            ? elem.dateObj.getTime()\n            : self.days.firstElementChild.dateObj.getTime(), initialDate = self.parseDate(self.selectedDates[0], undefined, true).getTime(), rangeStartDate = Math.min(hoverDate, self.selectedDates[0].getTime()), rangeEndDate = Math.max(hoverDate, self.selectedDates[0].getTime());\n        let containsDisabled = false;\n        let minRange = 0, maxRange = 0;\n        for (let t = rangeStartDate; t < rangeEndDate; t += duration.DAY) {\n            if (!isEnabled(new Date(t), true)) {\n                containsDisabled =\n                    containsDisabled || (t > rangeStartDate && t < rangeEndDate);\n                if (t < initialDate && (!minRange || t > minRange))\n                    minRange = t;\n                else if (t > initialDate && (!maxRange || t < maxRange))\n                    maxRange = t;\n            }\n        }\n        for (let m = 0; m < self.config.showMonths; m++) {\n            const month = self.daysContainer.children[m];\n            for (let i = 0, l = month.children.length; i < l; i++) {\n                const dayElem = month.children[i], date = dayElem.dateObj;\n                const timestamp = date.getTime();\n                const outOfRange = (minRange > 0 && timestamp < minRange) ||\n                    (maxRange > 0 && timestamp > maxRange);\n                if (outOfRange) {\n                    dayElem.classList.add(\"notAllowed\");\n                    [\"inRange\", \"startRange\", \"endRange\"].forEach((c) => {\n                        dayElem.classList.remove(c);\n                    });\n                    continue;\n                }\n                else if (containsDisabled && !outOfRange)\n                    continue;\n                [\"startRange\", \"inRange\", \"endRange\", \"notAllowed\"].forEach((c) => {\n                    dayElem.classList.remove(c);\n                });\n                if (elem !== undefined) {\n                    elem.classList.add(hoverDate <= self.selectedDates[0].getTime()\n                        ? \"startRange\"\n                        : \"endRange\");\n                    if (initialDate < hoverDate && timestamp === initialDate)\n                        dayElem.classList.add(\"startRange\");\n                    else if (initialDate > hoverDate && timestamp === initialDate)\n                        dayElem.classList.add(\"endRange\");\n                    if (timestamp >= minRange &&\n                        (maxRange === 0 || timestamp <= maxRange) &&\n                        isBetween(timestamp, initialDate, hoverDate))\n                        dayElem.classList.add(\"inRange\");\n                }\n            }\n        }\n    }\n    function onResize() {\n        if (self.isOpen && !self.config.static && !self.config.inline)\n            positionCalendar();\n    }\n    function open(e, positionElement = self._positionElement) {\n        if (self.isMobile === true) {\n            if (e) {\n                e.preventDefault();\n                const eventTarget = getEventTarget(e);\n                if (eventTarget) {\n                    eventTarget.blur();\n                }\n            }\n            if (self.mobileInput !== undefined) {\n                self.mobileInput.focus();\n                self.mobileInput.click();\n            }\n            triggerEvent(\"onOpen\");\n            return;\n        }\n        else if (self._input.disabled || self.config.inline) {\n            return;\n        }\n        const wasOpen = self.isOpen;\n        self.isOpen = true;\n        if (!wasOpen) {\n            self.calendarContainer.classList.add(\"open\");\n            self._input.classList.add(\"active\");\n            triggerEvent(\"onOpen\");\n            positionCalendar(positionElement);\n        }\n        if (self.config.enableTime === true && self.config.noCalendar === true) {\n            if (self.config.allowInput === false &&\n                (e === undefined ||\n                    !self.timeContainer.contains(e.relatedTarget))) {\n                setTimeout(() => self.hourElement.select(), 50);\n            }\n        }\n    }\n    function minMaxDateSetter(type) {\n        return (date) => {\n            const dateObj = (self.config[`_${type}Date`] = self.parseDate(date, self.config.dateFormat));\n            const inverseDateObj = self.config[`_${type === \"min\" ? \"max\" : \"min\"}Date`];\n            if (dateObj !== undefined) {\n                self[type === \"min\" ? \"minDateHasTime\" : \"maxDateHasTime\"] =\n                    dateObj.getHours() > 0 ||\n                        dateObj.getMinutes() > 0 ||\n                        dateObj.getSeconds() > 0;\n            }\n            if (self.selectedDates) {\n                self.selectedDates = self.selectedDates.filter((d) => isEnabled(d));\n                if (!self.selectedDates.length && type === \"min\")\n                    setHoursFromDate(dateObj);\n                updateValue();\n            }\n            if (self.daysContainer) {\n                redraw();\n                if (dateObj !== undefined)\n                    self.currentYearElement[type] = dateObj.getFullYear().toString();\n                else\n                    self.currentYearElement.removeAttribute(type);\n                self.currentYearElement.disabled =\n                    !!inverseDateObj &&\n                        dateObj !== undefined &&\n                        inverseDateObj.getFullYear() === dateObj.getFullYear();\n            }\n        };\n    }\n    function parseConfig() {\n        const boolOpts = [\n            \"wrap\",\n            \"weekNumbers\",\n            \"allowInput\",\n            \"allowInvalidPreload\",\n            \"clickOpens\",\n            \"time_24hr\",\n            \"enableTime\",\n            \"noCalendar\",\n            \"altInput\",\n            \"shorthandCurrentMonth\",\n            \"inline\",\n            \"static\",\n            \"enableSeconds\",\n            \"disableMobile\",\n        ];\n        const userConfig = Object.assign(Object.assign({}, JSON.parse(JSON.stringify(element.dataset || {}))), instanceConfig);\n        const formats = {};\n        self.config.parseDate = userConfig.parseDate;\n        self.config.formatDate = userConfig.formatDate;\n        Object.defineProperty(self.config, \"enable\", {\n            get: () => self.config._enable,\n            set: (dates) => {\n                self.config._enable = parseDateRules(dates);\n            },\n        });\n        Object.defineProperty(self.config, \"disable\", {\n            get: () => self.config._disable,\n            set: (dates) => {\n                self.config._disable = parseDateRules(dates);\n            },\n        });\n        const timeMode = userConfig.mode === \"time\";\n        if (!userConfig.dateFormat && (userConfig.enableTime || timeMode)) {\n            const defaultDateFormat = flatpickr.defaultConfig.dateFormat || defaultOptions.dateFormat;\n            formats.dateFormat =\n                userConfig.noCalendar || timeMode\n                    ? \"H:i\" + (userConfig.enableSeconds ? \":S\" : \"\")\n                    : defaultDateFormat + \" H:i\" + (userConfig.enableSeconds ? \":S\" : \"\");\n        }\n        if (userConfig.altInput &&\n            (userConfig.enableTime || timeMode) &&\n            !userConfig.altFormat) {\n            const defaultAltFormat = flatpickr.defaultConfig.altFormat || defaultOptions.altFormat;\n            formats.altFormat =\n                userConfig.noCalendar || timeMode\n                    ? \"h:i\" + (userConfig.enableSeconds ? \":S K\" : \" K\")\n                    : defaultAltFormat + ` h:i${userConfig.enableSeconds ? \":S\" : \"\"} K`;\n        }\n        Object.defineProperty(self.config, \"minDate\", {\n            get: () => self.config._minDate,\n            set: minMaxDateSetter(\"min\"),\n        });\n        Object.defineProperty(self.config, \"maxDate\", {\n            get: () => self.config._maxDate,\n            set: minMaxDateSetter(\"max\"),\n        });\n        const minMaxTimeSetter = (type) => (val) => {\n            self.config[type === \"min\" ? \"_minTime\" : \"_maxTime\"] = self.parseDate(val, \"H:i:S\");\n        };\n        Object.defineProperty(self.config, \"minTime\", {\n            get: () => self.config._minTime,\n            set: minMaxTimeSetter(\"min\"),\n        });\n        Object.defineProperty(self.config, \"maxTime\", {\n            get: () => self.config._maxTime,\n            set: minMaxTimeSetter(\"max\"),\n        });\n        if (userConfig.mode === \"time\") {\n            self.config.noCalendar = true;\n            self.config.enableTime = true;\n        }\n        Object.assign(self.config, formats, userConfig);\n        for (let i = 0; i < boolOpts.length; i++)\n            self.config[boolOpts[i]] =\n                self.config[boolOpts[i]] === true ||\n                    self.config[boolOpts[i]] === \"true\";\n        HOOKS.filter((hook) => self.config[hook] !== undefined).forEach((hook) => {\n            self.config[hook] = arrayify(self.config[hook] || []).map(bindToInstance);\n        });\n        self.isMobile =\n            !self.config.disableMobile &&\n                !self.config.inline &&\n                self.config.mode === \"single\" &&\n                !self.config.disable.length &&\n                !self.config.enable &&\n                !self.config.weekNumbers &&\n                /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n        for (let i = 0; i < self.config.plugins.length; i++) {\n            const pluginConf = self.config.plugins[i](self) || {};\n            for (const key in pluginConf) {\n                if (HOOKS.indexOf(key) > -1) {\n                    self.config[key] = arrayify(pluginConf[key])\n                        .map(bindToInstance)\n                        .concat(self.config[key]);\n                }\n                else if (typeof userConfig[key] === \"undefined\")\n                    self.config[key] = pluginConf[key];\n            }\n        }\n        if (!userConfig.altInputClass) {\n            self.config.altInputClass =\n                getInputElem().className + \" \" + self.config.altInputClass;\n        }\n        triggerEvent(\"onParseConfig\");\n    }\n    function getInputElem() {\n        return self.config.wrap\n            ? element.querySelector(\"[data-input]\")\n            : element;\n    }\n    function setupLocale() {\n        if (typeof self.config.locale !== \"object\" &&\n            typeof flatpickr.l10ns[self.config.locale] === \"undefined\")\n            self.config.errorHandler(new Error(`flatpickr: invalid locale ${self.config.locale}`));\n        self.l10n = Object.assign(Object.assign({}, flatpickr.l10ns.default), (typeof self.config.locale === \"object\"\n            ? self.config.locale\n            : self.config.locale !== \"default\"\n                ? flatpickr.l10ns[self.config.locale]\n                : undefined));\n        tokenRegex.K = `(${self.l10n.amPM[0]}|${self.l10n.amPM[1]}|${self.l10n.amPM[0].toLowerCase()}|${self.l10n.amPM[1].toLowerCase()})`;\n        const userConfig = Object.assign(Object.assign({}, instanceConfig), JSON.parse(JSON.stringify(element.dataset || {})));\n        if (userConfig.time_24hr === undefined &&\n            flatpickr.defaultConfig.time_24hr === undefined) {\n            self.config.time_24hr = self.l10n.time_24hr;\n        }\n        self.formatDate = createDateFormatter(self);\n        self.parseDate = createDateParser({ config: self.config, l10n: self.l10n });\n    }\n    function positionCalendar(customPositionElement) {\n        if (typeof self.config.position === \"function\") {\n            return void self.config.position(self, customPositionElement);\n        }\n        if (self.calendarContainer === undefined)\n            return;\n        triggerEvent(\"onPreCalendarPosition\");\n        const positionElement = customPositionElement || self._positionElement;\n        const calendarHeight = Array.prototype.reduce.call(self.calendarContainer.children, ((acc, child) => acc + child.offsetHeight), 0), calendarWidth = self.calendarContainer.offsetWidth, configPos = self.config.position.split(\" \"), configPosVertical = configPos[0], configPosHorizontal = configPos.length > 1 ? configPos[1] : null, inputBounds = positionElement.getBoundingClientRect(), distanceFromBottom = window.innerHeight - inputBounds.bottom, showOnTop = configPosVertical === \"above\" ||\n            (configPosVertical !== \"below\" &&\n                distanceFromBottom < calendarHeight &&\n                inputBounds.top > calendarHeight);\n        const top = window.pageYOffset +\n            inputBounds.top +\n            (!showOnTop ? positionElement.offsetHeight + 2 : -calendarHeight - 2);\n        toggleClass(self.calendarContainer, \"arrowTop\", !showOnTop);\n        toggleClass(self.calendarContainer, \"arrowBottom\", showOnTop);\n        if (self.config.inline)\n            return;\n        let left = window.pageXOffset + inputBounds.left;\n        let isCenter = false;\n        let isRight = false;\n        if (configPosHorizontal === \"center\") {\n            left -= (calendarWidth - inputBounds.width) / 2;\n            isCenter = true;\n        }\n        else if (configPosHorizontal === \"right\") {\n            left -= calendarWidth - inputBounds.width;\n            isRight = true;\n        }\n        toggleClass(self.calendarContainer, \"arrowLeft\", !isCenter && !isRight);\n        toggleClass(self.calendarContainer, \"arrowCenter\", isCenter);\n        toggleClass(self.calendarContainer, \"arrowRight\", isRight);\n        const right = window.document.body.offsetWidth -\n            (window.pageXOffset + inputBounds.right);\n        const rightMost = left + calendarWidth > window.document.body.offsetWidth;\n        const centerMost = right + calendarWidth > window.document.body.offsetWidth;\n        toggleClass(self.calendarContainer, \"rightMost\", rightMost);\n        if (self.config.static)\n            return;\n        self.calendarContainer.style.top = `${top}px`;\n        if (!rightMost) {\n            self.calendarContainer.style.left = `${left}px`;\n            self.calendarContainer.style.right = \"auto\";\n        }\n        else if (!centerMost) {\n            self.calendarContainer.style.left = \"auto\";\n            self.calendarContainer.style.right = `${right}px`;\n        }\n        else {\n            const doc = getDocumentStyleSheet();\n            if (doc === undefined)\n                return;\n            const bodyWidth = window.document.body.offsetWidth;\n            const centerLeft = Math.max(0, bodyWidth / 2 - calendarWidth / 2);\n            const centerBefore = \".flatpickr-calendar.centerMost:before\";\n            const centerAfter = \".flatpickr-calendar.centerMost:after\";\n            const centerIndex = doc.cssRules.length;\n            const centerStyle = `{left:${inputBounds.left}px;right:auto;}`;\n            toggleClass(self.calendarContainer, \"rightMost\", false);\n            toggleClass(self.calendarContainer, \"centerMost\", true);\n            doc.insertRule(`${centerBefore},${centerAfter}${centerStyle}`, centerIndex);\n            self.calendarContainer.style.left = `${centerLeft}px`;\n            self.calendarContainer.style.right = \"auto\";\n        }\n    }\n    function getDocumentStyleSheet() {\n        let editableSheet = null;\n        for (let i = 0; i < document.styleSheets.length; i++) {\n            const sheet = document.styleSheets[i];\n            try {\n                sheet.cssRules;\n            }\n            catch (err) {\n                continue;\n            }\n            editableSheet = sheet;\n            break;\n        }\n        return editableSheet != null ? editableSheet : createStyleSheet();\n    }\n    function createStyleSheet() {\n        const style = document.createElement(\"style\");\n        document.head.appendChild(style);\n        return style.sheet;\n    }\n    function redraw() {\n        if (self.config.noCalendar || self.isMobile)\n            return;\n        buildMonthSwitch();\n        updateNavigationCurrentMonth();\n        buildDays();\n    }\n    function focusAndClose() {\n        self._input.focus();\n        if (window.navigator.userAgent.indexOf(\"MSIE\") !== -1 ||\n            navigator.msMaxTouchPoints !== undefined) {\n            setTimeout(self.close, 0);\n        }\n        else {\n            self.close();\n        }\n    }\n    function selectDate(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const isSelectable = (day) => day.classList &&\n            day.classList.contains(\"flatpickr-day\") &&\n            !day.classList.contains(\"flatpickr-disabled\") &&\n            !day.classList.contains(\"notAllowed\");\n        const t = findParent(getEventTarget(e), isSelectable);\n        if (t === undefined)\n            return;\n        const target = t;\n        const selectedDate = (self.latestSelectedDateObj = new Date(target.dateObj.getTime()));\n        const shouldChangeMonth = (selectedDate.getMonth() < self.currentMonth ||\n            selectedDate.getMonth() >\n                self.currentMonth + self.config.showMonths - 1) &&\n            self.config.mode !== \"range\";\n        self.selectedDateElem = target;\n        if (self.config.mode === \"single\")\n            self.selectedDates = [selectedDate];\n        else if (self.config.mode === \"multiple\") {\n            const selectedIndex = isDateSelected(selectedDate);\n            if (selectedIndex)\n                self.selectedDates.splice(parseInt(selectedIndex), 1);\n            else\n                self.selectedDates.push(selectedDate);\n        }\n        else if (self.config.mode === \"range\") {\n            if (self.selectedDates.length === 2) {\n                self.clear(false, false);\n            }\n            self.latestSelectedDateObj = selectedDate;\n            self.selectedDates.push(selectedDate);\n            if (compareDates(selectedDate, self.selectedDates[0], true) !== 0)\n                self.selectedDates.sort((a, b) => a.getTime() - b.getTime());\n        }\n        setHoursFromInputs();\n        if (shouldChangeMonth) {\n            const isNewYear = self.currentYear !== selectedDate.getFullYear();\n            self.currentYear = selectedDate.getFullYear();\n            self.currentMonth = selectedDate.getMonth();\n            if (isNewYear) {\n                triggerEvent(\"onYearChange\");\n                buildMonthSwitch();\n            }\n            triggerEvent(\"onMonthChange\");\n        }\n        updateNavigationCurrentMonth();\n        buildDays();\n        updateValue();\n        if (!shouldChangeMonth &&\n            self.config.mode !== \"range\" &&\n            self.config.showMonths === 1)\n            focusOnDayElem(target);\n        else if (self.selectedDateElem !== undefined &&\n            self.hourElement === undefined) {\n            self.selectedDateElem && self.selectedDateElem.focus();\n        }\n        if (self.hourElement !== undefined)\n            self.hourElement !== undefined && self.hourElement.focus();\n        if (self.config.closeOnSelect) {\n            const single = self.config.mode === \"single\" && !self.config.enableTime;\n            const range = self.config.mode === \"range\" &&\n                self.selectedDates.length === 2 &&\n                !self.config.enableTime;\n            if (single || range) {\n                focusAndClose();\n            }\n        }\n        triggerChange();\n    }\n    const CALLBACKS = {\n        locale: [setupLocale, updateWeekdays],\n        showMonths: [buildMonths, setCalendarWidth, buildWeekdays],\n        minDate: [jumpToDate],\n        maxDate: [jumpToDate],\n        clickOpens: [\n            () => {\n                if (self.config.clickOpens === true) {\n                    bind(self._input, \"focus\", self.open);\n                    bind(self._input, \"click\", self.open);\n                }\n                else {\n                    self._input.removeEventListener(\"focus\", self.open);\n                    self._input.removeEventListener(\"click\", self.open);\n                }\n            },\n        ],\n    };\n    function set(option, value) {\n        if (option !== null && typeof option === \"object\") {\n            Object.assign(self.config, option);\n            for (const key in option) {\n                if (CALLBACKS[key] !== undefined)\n                    CALLBACKS[key].forEach((x) => x());\n            }\n        }\n        else {\n            self.config[option] = value;\n            if (CALLBACKS[option] !== undefined)\n                CALLBACKS[option].forEach((x) => x());\n            else if (HOOKS.indexOf(option) > -1)\n                self.config[option] = arrayify(value);\n        }\n        self.redraw();\n        updateValue(true);\n    }\n    function setSelectedDate(inputDate, format) {\n        let dates = [];\n        if (inputDate instanceof Array)\n            dates = inputDate.map((d) => self.parseDate(d, format));\n        else if (inputDate instanceof Date || typeof inputDate === \"number\")\n            dates = [self.parseDate(inputDate, format)];\n        else if (typeof inputDate === \"string\") {\n            switch (self.config.mode) {\n                case \"single\":\n                case \"time\":\n                    dates = [self.parseDate(inputDate, format)];\n                    break;\n                case \"multiple\":\n                    dates = inputDate\n                        .split(self.config.conjunction)\n                        .map((date) => self.parseDate(date, format));\n                    break;\n                case \"range\":\n                    dates = inputDate\n                        .split(self.l10n.rangeSeparator)\n                        .map((date) => self.parseDate(date, format));\n                    break;\n                default:\n                    break;\n            }\n        }\n        else\n            self.config.errorHandler(new Error(`Invalid date supplied: ${JSON.stringify(inputDate)}`));\n        self.selectedDates = (self.config.allowInvalidPreload\n            ? dates\n            : dates.filter((d) => d instanceof Date && isEnabled(d, false)));\n        if (self.config.mode === \"range\")\n            self.selectedDates.sort((a, b) => a.getTime() - b.getTime());\n    }\n    function setDate(date, triggerChange = false, format = self.config.dateFormat) {\n        if ((date !== 0 && !date) || (date instanceof Array && date.length === 0))\n            return self.clear(triggerChange);\n        setSelectedDate(date, format);\n        self.latestSelectedDateObj =\n            self.selectedDates[self.selectedDates.length - 1];\n        self.redraw();\n        jumpToDate(undefined, triggerChange);\n        setHoursFromDate();\n        if (self.selectedDates.length === 0) {\n            self.clear(false);\n        }\n        updateValue(triggerChange);\n        if (triggerChange)\n            triggerEvent(\"onChange\");\n    }\n    function parseDateRules(arr) {\n        return arr\n            .slice()\n            .map((rule) => {\n            if (typeof rule === \"string\" ||\n                typeof rule === \"number\" ||\n                rule instanceof Date) {\n                return self.parseDate(rule, undefined, true);\n            }\n            else if (rule &&\n                typeof rule === \"object\" &&\n                rule.from &&\n                rule.to)\n                return {\n                    from: self.parseDate(rule.from, undefined),\n                    to: self.parseDate(rule.to, undefined),\n                };\n            return rule;\n        })\n            .filter((x) => x);\n    }\n    function setupDates() {\n        self.selectedDates = [];\n        self.now = self.parseDate(self.config.now) || new Date();\n        const preloadedDate = self.config.defaultDate ||\n            ((self.input.nodeName === \"INPUT\" ||\n                self.input.nodeName === \"TEXTAREA\") &&\n                self.input.placeholder &&\n                self.input.value === self.input.placeholder\n                ? null\n                : self.input.value);\n        if (preloadedDate)\n            setSelectedDate(preloadedDate, self.config.dateFormat);\n        self._initialDate =\n            self.selectedDates.length > 0\n                ? self.selectedDates[0]\n                : self.config.minDate &&\n                    self.config.minDate.getTime() > self.now.getTime()\n                    ? self.config.minDate\n                    : self.config.maxDate &&\n                        self.config.maxDate.getTime() < self.now.getTime()\n                        ? self.config.maxDate\n                        : self.now;\n        self.currentYear = self._initialDate.getFullYear();\n        self.currentMonth = self._initialDate.getMonth();\n        if (self.selectedDates.length > 0)\n            self.latestSelectedDateObj = self.selectedDates[0];\n        if (self.config.minTime !== undefined)\n            self.config.minTime = self.parseDate(self.config.minTime, \"H:i\");\n        if (self.config.maxTime !== undefined)\n            self.config.maxTime = self.parseDate(self.config.maxTime, \"H:i\");\n        self.minDateHasTime =\n            !!self.config.minDate &&\n                (self.config.minDate.getHours() > 0 ||\n                    self.config.minDate.getMinutes() > 0 ||\n                    self.config.minDate.getSeconds() > 0);\n        self.maxDateHasTime =\n            !!self.config.maxDate &&\n                (self.config.maxDate.getHours() > 0 ||\n                    self.config.maxDate.getMinutes() > 0 ||\n                    self.config.maxDate.getSeconds() > 0);\n    }\n    function setupInputs() {\n        self.input = getInputElem();\n        if (!self.input) {\n            self.config.errorHandler(new Error(\"Invalid input element specified\"));\n            return;\n        }\n        self.input._type = self.input.type;\n        self.input.type = \"text\";\n        self.input.classList.add(\"flatpickr-input\");\n        self._input = self.input;\n        if (self.config.altInput) {\n            self.altInput = createElement(self.input.nodeName, self.config.altInputClass);\n            self._input = self.altInput;\n            self.altInput.placeholder = self.input.placeholder;\n            self.altInput.disabled = self.input.disabled;\n            self.altInput.required = self.input.required;\n            self.altInput.tabIndex = self.input.tabIndex;\n            self.altInput.type = \"text\";\n            self.input.setAttribute(\"type\", \"hidden\");\n            if (!self.config.static && self.input.parentNode)\n                self.input.parentNode.insertBefore(self.altInput, self.input.nextSibling);\n        }\n        if (!self.config.allowInput)\n            self._input.setAttribute(\"readonly\", \"readonly\");\n        self._positionElement = self.config.positionElement || self._input;\n    }\n    function setupMobile() {\n        const inputType = self.config.enableTime\n            ? self.config.noCalendar\n                ? \"time\"\n                : \"datetime-local\"\n            : \"date\";\n        self.mobileInput = createElement(\"input\", self.input.className + \" flatpickr-mobile\");\n        self.mobileInput.tabIndex = 1;\n        self.mobileInput.type = inputType;\n        self.mobileInput.disabled = self.input.disabled;\n        self.mobileInput.required = self.input.required;\n        self.mobileInput.placeholder = self.input.placeholder;\n        self.mobileFormatStr =\n            inputType === \"datetime-local\"\n                ? \"Y-m-d\\\\TH:i:S\"\n                : inputType === \"date\"\n                    ? \"Y-m-d\"\n                    : \"H:i:S\";\n        if (self.selectedDates.length > 0) {\n            self.mobileInput.defaultValue = self.mobileInput.value = self.formatDate(self.selectedDates[0], self.mobileFormatStr);\n        }\n        if (self.config.minDate)\n            self.mobileInput.min = self.formatDate(self.config.minDate, \"Y-m-d\");\n        if (self.config.maxDate)\n            self.mobileInput.max = self.formatDate(self.config.maxDate, \"Y-m-d\");\n        if (self.input.getAttribute(\"step\"))\n            self.mobileInput.step = String(self.input.getAttribute(\"step\"));\n        self.input.type = \"hidden\";\n        if (self.altInput !== undefined)\n            self.altInput.type = \"hidden\";\n        try {\n            if (self.input.parentNode)\n                self.input.parentNode.insertBefore(self.mobileInput, self.input.nextSibling);\n        }\n        catch (_a) { }\n        bind(self.mobileInput, \"change\", (e) => {\n            self.setDate(getEventTarget(e).value, false, self.mobileFormatStr);\n            triggerEvent(\"onChange\");\n            triggerEvent(\"onClose\");\n        });\n    }\n    function toggle(e) {\n        if (self.isOpen === true)\n            return self.close();\n        self.open(e);\n    }\n    function triggerEvent(event, data) {\n        if (self.config === undefined)\n            return;\n        const hooks = self.config[event];\n        if (hooks !== undefined && hooks.length > 0) {\n            for (let i = 0; hooks[i] && i < hooks.length; i++)\n                hooks[i](self.selectedDates, self.input.value, self, data);\n        }\n        if (event === \"onChange\") {\n            self.input.dispatchEvent(createEvent(\"change\"));\n            self.input.dispatchEvent(createEvent(\"input\"));\n        }\n    }\n    function createEvent(name) {\n        const e = document.createEvent(\"Event\");\n        e.initEvent(name, true, true);\n        return e;\n    }\n    function isDateSelected(date) {\n        for (let i = 0; i < self.selectedDates.length; i++) {\n            if (compareDates(self.selectedDates[i], date) === 0)\n                return \"\" + i;\n        }\n        return false;\n    }\n    function isDateInRange(date) {\n        if (self.config.mode !== \"range\" || self.selectedDates.length < 2)\n            return false;\n        return (compareDates(date, self.selectedDates[0]) >= 0 &&\n            compareDates(date, self.selectedDates[1]) <= 0);\n    }\n    function updateNavigationCurrentMonth() {\n        if (self.config.noCalendar || self.isMobile || !self.monthNav)\n            return;\n        self.yearElements.forEach((yearElement, i) => {\n            const d = new Date(self.currentYear, self.currentMonth, 1);\n            d.setMonth(self.currentMonth + i);\n            if (self.config.showMonths > 1 ||\n                self.config.monthSelectorType === \"static\") {\n                self.monthElements[i].textContent =\n                    monthToStr(d.getMonth(), self.config.shorthandCurrentMonth, self.l10n) + \" \";\n            }\n            else {\n                self.monthsDropdownContainer.value = d.getMonth().toString();\n            }\n            yearElement.value = d.getFullYear().toString();\n        });\n        self._hidePrevMonthArrow =\n            self.config.minDate !== undefined &&\n                (self.currentYear === self.config.minDate.getFullYear()\n                    ? self.currentMonth <= self.config.minDate.getMonth()\n                    : self.currentYear < self.config.minDate.getFullYear());\n        self._hideNextMonthArrow =\n            self.config.maxDate !== undefined &&\n                (self.currentYear === self.config.maxDate.getFullYear()\n                    ? self.currentMonth + 1 > self.config.maxDate.getMonth()\n                    : self.currentYear > self.config.maxDate.getFullYear());\n    }\n    function getDateStr(format) {\n        return self.selectedDates\n            .map((dObj) => self.formatDate(dObj, format))\n            .filter((d, i, arr) => self.config.mode !== \"range\" ||\n            self.config.enableTime ||\n            arr.indexOf(d) === i)\n            .join(self.config.mode !== \"range\"\n            ? self.config.conjunction\n            : self.l10n.rangeSeparator);\n    }\n    function updateValue(triggerChange = true) {\n        if (self.mobileInput !== undefined && self.mobileFormatStr) {\n            self.mobileInput.value =\n                self.latestSelectedDateObj !== undefined\n                    ? self.formatDate(self.latestSelectedDateObj, self.mobileFormatStr)\n                    : \"\";\n        }\n        self.input.value = getDateStr(self.config.dateFormat);\n        if (self.altInput !== undefined) {\n            self.altInput.value = getDateStr(self.config.altFormat);\n        }\n        if (triggerChange !== false)\n            triggerEvent(\"onValueUpdate\");\n    }\n    function onMonthNavClick(e) {\n        const eventTarget = getEventTarget(e);\n        const isPrevMonth = self.prevMonthNav.contains(eventTarget);\n        const isNextMonth = self.nextMonthNav.contains(eventTarget);\n        if (isPrevMonth || isNextMonth) {\n            changeMonth(isPrevMonth ? -1 : 1);\n        }\n        else if (self.yearElements.indexOf(eventTarget) >= 0) {\n            eventTarget.select();\n        }\n        else if (eventTarget.classList.contains(\"arrowUp\")) {\n            self.changeYear(self.currentYear + 1);\n        }\n        else if (eventTarget.classList.contains(\"arrowDown\")) {\n            self.changeYear(self.currentYear - 1);\n        }\n    }\n    function timeWrapper(e) {\n        e.preventDefault();\n        const isKeyDown = e.type === \"keydown\", eventTarget = getEventTarget(e), input = eventTarget;\n        if (self.amPM !== undefined && eventTarget === self.amPM) {\n            self.amPM.textContent =\n                self.l10n.amPM[int(self.amPM.textContent === self.l10n.amPM[0])];\n        }\n        const min = parseFloat(input.getAttribute(\"min\")), max = parseFloat(input.getAttribute(\"max\")), step = parseFloat(input.getAttribute(\"step\")), curValue = parseInt(input.value, 10), delta = e.delta ||\n            (isKeyDown ? (e.which === 38 ? 1 : -1) : 0);\n        let newValue = curValue + step * delta;\n        if (typeof input.value !== \"undefined\" && input.value.length === 2) {\n            const isHourElem = input === self.hourElement, isMinuteElem = input === self.minuteElement;\n            if (newValue < min) {\n                newValue =\n                    max +\n                        newValue +\n                        int(!isHourElem) +\n                        (int(isHourElem) && int(!self.amPM));\n                if (isMinuteElem)\n                    incrementNumInput(undefined, -1, self.hourElement);\n            }\n            else if (newValue > max) {\n                newValue =\n                    input === self.hourElement ? newValue - max - int(!self.amPM) : min;\n                if (isMinuteElem)\n                    incrementNumInput(undefined, 1, self.hourElement);\n            }\n            if (self.amPM &&\n                isHourElem &&\n                (step === 1\n                    ? newValue + curValue === 23\n                    : Math.abs(newValue - curValue) > step)) {\n                self.amPM.textContent =\n                    self.l10n.amPM[int(self.amPM.textContent === self.l10n.amPM[0])];\n            }\n            input.value = pad(newValue);\n        }\n    }\n    init();\n    return self;\n}\nfunction _flatpickr(nodeList, config) {\n    const nodes = Array.prototype.slice\n        .call(nodeList)\n        .filter((x) => x instanceof HTMLElement);\n    const instances = [];\n    for (let i = 0; i < nodes.length; i++) {\n        const node = nodes[i];\n        try {\n            if (node.getAttribute(\"data-fp-omit\") !== null)\n                continue;\n            if (node._flatpickr !== undefined) {\n                node._flatpickr.destroy();\n                node._flatpickr = undefined;\n            }\n            node._flatpickr = FlatpickrInstance(node, config || {});\n            instances.push(node._flatpickr);\n        }\n        catch (e) {\n            console.error(e);\n        }\n    }\n    return instances.length === 1 ? instances[0] : instances;\n}\nif (typeof HTMLElement !== \"undefined\" &&\n    typeof HTMLCollection !== \"undefined\" &&\n    typeof NodeList !== \"undefined\") {\n    HTMLCollection.prototype.flatpickr = NodeList.prototype.flatpickr = function (config) {\n        return _flatpickr(this, config);\n    };\n    HTMLElement.prototype.flatpickr = function (config) {\n        return _flatpickr([this], config);\n    };\n}\nvar flatpickr = function (selector, config) {\n    if (typeof selector === \"string\") {\n        return _flatpickr(window.document.querySelectorAll(selector), config);\n    }\n    else if (selector instanceof Node) {\n        return _flatpickr([selector], config);\n    }\n    else {\n        return _flatpickr(selector, config);\n    }\n};\nflatpickr.defaultConfig = {};\nflatpickr.l10ns = {\n    en: Object.assign({}, English),\n    default: Object.assign({}, English),\n};\nflatpickr.localize = (l10n) => {\n    flatpickr.l10ns.default = Object.assign(Object.assign({}, flatpickr.l10ns.default), l10n);\n};\nflatpickr.setDefaults = (config) => {\n    flatpickr.defaultConfig = Object.assign(Object.assign({}, flatpickr.defaultConfig), config);\n};\nflatpickr.parseDate = createDateParser({});\nflatpickr.formatDate = createDateFormatter({});\nflatpickr.compareDates = compareDates;\nif (typeof jQuery !== \"undefined\" && typeof jQuery.fn !== \"undefined\") {\n    jQuery.fn.flatpickr = function (config) {\n        return _flatpickr(this, config);\n    };\n}\nDate.prototype.fp_incr = function (days) {\n    return new Date(this.getFullYear(), this.getMonth(), this.getDate() + (typeof days === \"string\" ? parseInt(days, 10) : days));\n};\nif (typeof window !== \"undefined\") {\n    window.flatpickr = flatpickr;\n}\nexport default flatpickr;\n","export const english = {\n    weekdays: {\n        shorthand: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"],\n        longhand: [\n            \"Sunday\",\n            \"Monday\",\n            \"Tuesday\",\n            \"Wednesday\",\n            \"Thursday\",\n            \"Friday\",\n            \"Saturday\",\n        ],\n    },\n    months: {\n        shorthand: [\n            \"Jan\",\n            \"Feb\",\n            \"Mar\",\n            \"Apr\",\n            \"May\",\n            \"Jun\",\n            \"Jul\",\n            \"Aug\",\n            \"Sep\",\n            \"Oct\",\n            \"Nov\",\n            \"Dec\",\n        ],\n        longhand: [\n            \"January\",\n            \"February\",\n            \"March\",\n            \"April\",\n            \"May\",\n            \"June\",\n            \"July\",\n            \"August\",\n            \"September\",\n            \"October\",\n            \"November\",\n            \"December\",\n        ],\n    },\n    daysInMonth: [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31],\n    firstDayOfWeek: 0,\n    ordinal: (nth) => {\n        const s = nth % 100;\n        if (s > 3 && s < 21)\n            return \"th\";\n        switch (s % 10) {\n            case 1:\n                return \"st\";\n            case 2:\n                return \"nd\";\n            case 3:\n                return \"rd\";\n            default:\n                return \"th\";\n        }\n    },\n    rangeSeparator: \" to \",\n    weekAbbreviation: \"Wk\",\n    scrollTitle: \"Scroll to increment\",\n    toggleTitle: \"Click to toggle\",\n    amPM: [\"AM\", \"PM\"],\n    yearAriaLabel: \"Year\",\n    monthAriaLabel: \"Month\",\n    hourAriaLabel: \"Hour\",\n    minuteAriaLabel: \"Minute\",\n    time_24hr: false,\n};\nexport default english;\n","export const HOOKS = [\n    \"onChange\",\n    \"onClose\",\n    \"onDayCreate\",\n    \"onDestroy\",\n    \"onKeyDown\",\n    \"onMonthChange\",\n    \"onOpen\",\n    \"onParseConfig\",\n    \"onReady\",\n    \"onValueUpdate\",\n    \"onYearChange\",\n    \"onPreCalendarPosition\",\n];\nexport const defaults = {\n    _disable: [],\n    allowInput: false,\n    allowInvalidPreload: false,\n    altFormat: \"F j, Y\",\n    altInput: false,\n    altInputClass: \"form-control input\",\n    animate: typeof window === \"object\" &&\n        window.navigator.userAgent.indexOf(\"MSIE\") === -1,\n    ariaDateFormat: \"F j, Y\",\n    autoFillDefaultTime: true,\n    clickOpens: true,\n    closeOnSelect: true,\n    conjunction: \", \",\n    dateFormat: \"Y-m-d\",\n    defaultHour: 12,\n    defaultMinute: 0,\n    defaultSeconds: 0,\n    disable: [],\n    disableMobile: false,\n    enableSeconds: false,\n    enableTime: false,\n    errorHandler: (err) => typeof console !== \"undefined\" && console.warn(err),\n    getWeek: (givenDate) => {\n        const date = new Date(givenDate.getTime());\n        date.setHours(0, 0, 0, 0);\n        date.setDate(date.getDate() + 3 - ((date.getDay() + 6) % 7));\n        var week1 = new Date(date.getFullYear(), 0, 4);\n        return (1 +\n            Math.round(((date.getTime() - week1.getTime()) / 86400000 -\n                3 +\n                ((week1.getDay() + 6) % 7)) /\n                7));\n    },\n    hourIncrement: 1,\n    ignoredFocusElements: [],\n    inline: false,\n    locale: \"default\",\n    minuteIncrement: 5,\n    mode: \"single\",\n    monthSelectorType: \"dropdown\",\n    nextArrow: \"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M13.207 8.472l-7.854 7.854-0.707-0.707 7.146-7.146-7.146-7.148 0.707-0.707 7.854 7.854z' /></svg>\",\n    noCalendar: false,\n    now: new Date(),\n    onChange: [],\n    onClose: [],\n    onDayCreate: [],\n    onDestroy: [],\n    onKeyDown: [],\n    onMonthChange: [],\n    onOpen: [],\n    onParseConfig: [],\n    onReady: [],\n    onValueUpdate: [],\n    onYearChange: [],\n    onPreCalendarPosition: [],\n    plugins: [],\n    position: \"auto\",\n    positionElement: undefined,\n    prevArrow: \"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 17 17'><g></g><path d='M5.207 8.471l7.146 7.147-0.707 0.707-7.853-7.854 7.854-7.853 0.707 0.707-7.147 7.146z' /></svg>\",\n    shorthandCurrentMonth: false,\n    showMonths: 1,\n    static: false,\n    time_24hr: false,\n    weekNumbers: false,\n    wrap: false,\n};\n","import { tokenRegex, revFormat, formats, } from \"./formatting\";\nimport { defaults } from \"../types/options\";\nimport { english } from \"../l10n/default\";\nexport const createDateFormatter = ({ config = defaults, l10n = english, isMobile = false, }) => (dateObj, frmt, overrideLocale) => {\n    const locale = overrideLocale || l10n;\n    if (config.formatDate !== undefined && !isMobile) {\n        return config.formatDate(dateObj, frmt, locale);\n    }\n    return frmt\n        .split(\"\")\n        .map((c, i, arr) => formats[c] && arr[i - 1] !== \"\\\\\"\n        ? formats[c](dateObj, locale, config)\n        : c !== \"\\\\\"\n            ? c\n            : \"\")\n        .join(\"\");\n};\nexport const createDateParser = ({ config = defaults, l10n = english }) => (date, givenFormat, timeless, customLocale) => {\n    if (date !== 0 && !date)\n        return undefined;\n    const locale = customLocale || l10n;\n    let parsedDate;\n    const dateOrig = date;\n    if (date instanceof Date)\n        parsedDate = new Date(date.getTime());\n    else if (typeof date !== \"string\" &&\n        date.toFixed !== undefined)\n        parsedDate = new Date(date);\n    else if (typeof date === \"string\") {\n        const format = givenFormat || (config || defaults).dateFormat;\n        const datestr = String(date).trim();\n        if (datestr === \"today\") {\n            parsedDate = new Date();\n            timeless = true;\n        }\n        else if (/Z$/.test(datestr) ||\n            /GMT$/.test(datestr))\n            parsedDate = new Date(date);\n        else if (config && config.parseDate)\n            parsedDate = config.parseDate(date, format);\n        else {\n            parsedDate =\n                !config || !config.noCalendar\n                    ? new Date(new Date().getFullYear(), 0, 1, 0, 0, 0, 0)\n                    : new Date(new Date().setHours(0, 0, 0, 0));\n            let matched, ops = [];\n            for (let i = 0, matchIndex = 0, regexStr = \"\"; i < format.length; i++) {\n                const token = format[i];\n                const isBackSlash = token === \"\\\\\";\n                const escaped = format[i - 1] === \"\\\\\" || isBackSlash;\n                if (tokenRegex[token] && !escaped) {\n                    regexStr += tokenRegex[token];\n                    const match = new RegExp(regexStr).exec(date);\n                    if (match && (matched = true)) {\n                        ops[token !== \"Y\" ? \"push\" : \"unshift\"]({\n                            fn: revFormat[token],\n                            val: match[++matchIndex],\n                        });\n                    }\n                }\n                else if (!isBackSlash)\n                    regexStr += \".\";\n                ops.forEach(({ fn, val }) => (parsedDate = fn(parsedDate, val, locale) || parsedDate));\n            }\n            parsedDate = matched ? parsedDate : undefined;\n        }\n    }\n    if (!(parsedDate instanceof Date && !isNaN(parsedDate.getTime()))) {\n        config.errorHandler(new Error(`Invalid date provided: ${dateOrig}`));\n        return undefined;\n    }\n    if (timeless === true)\n        parsedDate.setHours(0, 0, 0, 0);\n    return parsedDate;\n};\nexport function compareDates(date1, date2, timeless = true) {\n    if (timeless !== false) {\n        return (new Date(date1.getTime()).setHours(0, 0, 0, 0) -\n            new Date(date2.getTime()).setHours(0, 0, 0, 0));\n    }\n    return date1.getTime() - date2.getTime();\n}\nexport function compareTimes(date1, date2) {\n    return (3600 * (date1.getHours() - date2.getHours()) +\n        60 * (date1.getMinutes() - date2.getMinutes()) +\n        date1.getSeconds() -\n        date2.getSeconds());\n}\nexport const isBetween = (ts, ts1, ts2) => {\n    return ts > Math.min(ts1, ts2) && ts < Math.max(ts1, ts2);\n};\nexport const duration = {\n    DAY: 86400000,\n};\nexport function getDefaultHours(config) {\n    let hours = config.defaultHour;\n    let minutes = config.defaultMinute;\n    let seconds = config.defaultSeconds;\n    if (config.minDate !== undefined) {\n        const minHour = config.minDate.getHours();\n        const minMinutes = config.minDate.getMinutes();\n        const minSeconds = config.minDate.getSeconds();\n        if (hours < minHour) {\n            hours = minHour;\n        }\n        if (hours === minHour && minutes < minMinutes) {\n            minutes = minMinutes;\n        }\n        if (hours === minHour && minutes === minMinutes && seconds < minSeconds)\n            seconds = config.minDate.getSeconds();\n    }\n    if (config.maxDate !== undefined) {\n        const maxHr = config.maxDate.getHours();\n        const maxMinutes = config.maxDate.getMinutes();\n        hours = Math.min(hours, maxHr);\n        if (hours === maxHr)\n            minutes = Math.min(maxMinutes, minutes);\n        if (hours === maxHr && minutes === maxMinutes)\n            seconds = config.maxDate.getSeconds();\n    }\n    return { hours, minutes, seconds };\n}\n","export function toggleClass(elem, className, bool) {\n    if (bool === true)\n        return elem.classList.add(className);\n    elem.classList.remove(className);\n}\nexport function createElement(tag, className, content) {\n    const e = window.document.createElement(tag);\n    className = className || \"\";\n    content = content || \"\";\n    e.className = className;\n    if (content !== undefined)\n        e.textContent = content;\n    return e;\n}\nexport function clearNode(node) {\n    while (node.firstChild)\n        node.removeChild(node.firstChild);\n}\nexport function findParent(node, condition) {\n    if (condition(node))\n        return node;\n    else if (node.parentNode)\n        return findParent(node.parentNode, condition);\n    return undefined;\n}\nexport function createNumberInput(inputClassName, opts) {\n    const wrapper = createElement(\"div\", \"numInputWrapper\"), numInput = createElement(\"input\", \"numInput \" + inputClassName), arrowUp = createElement(\"span\", \"arrowUp\"), arrowDown = createElement(\"span\", \"arrowDown\");\n    if (navigator.userAgent.indexOf(\"MSIE 9.0\") === -1) {\n        numInput.type = \"number\";\n    }\n    else {\n        numInput.type = \"text\";\n        numInput.pattern = \"\\\\d*\";\n    }\n    if (opts !== undefined)\n        for (const key in opts)\n            numInput.setAttribute(key, opts[key]);\n    wrapper.appendChild(numInput);\n    wrapper.appendChild(arrowUp);\n    wrapper.appendChild(arrowDown);\n    return wrapper;\n}\nexport function getEventTarget(event) {\n    try {\n        if (typeof event.composedPath === \"function\") {\n            const path = event.composedPath();\n            return path[0];\n        }\n        return event.target;\n    }\n    catch (error) {\n        return event.target;\n    }\n}\n","import { int, pad } from \"../utils\";\nconst doNothing = () => undefined;\nexport const monthToStr = (monthNumber, shorthand, locale) => locale.months[shorthand ? \"shorthand\" : \"longhand\"][monthNumber];\nexport const revFormat = {\n    D: doNothing,\n    F: function (dateObj, monthName, locale) {\n        dateObj.setMonth(locale.months.longhand.indexOf(monthName));\n    },\n    G: (dateObj, hour) => {\n        dateObj.setHours(parseFloat(hour));\n    },\n    H: (dateObj, hour) => {\n        dateObj.setHours(parseFloat(hour));\n    },\n    J: (dateObj, day) => {\n        dateObj.setDate(parseFloat(day));\n    },\n    K: (dateObj, amPM, locale) => {\n        dateObj.setHours((dateObj.getHours() % 12) +\n            12 * int(new RegExp(locale.amPM[1], \"i\").test(amPM)));\n    },\n    M: function (dateObj, shortMonth, locale) {\n        dateObj.setMonth(locale.months.shorthand.indexOf(shortMonth));\n    },\n    S: (dateObj, seconds) => {\n        dateObj.setSeconds(parseFloat(seconds));\n    },\n    U: (_, unixSeconds) => new Date(parseFloat(unixSeconds) * 1000),\n    W: function (dateObj, weekNum, locale) {\n        const weekNumber = parseInt(weekNum);\n        const date = new Date(dateObj.getFullYear(), 0, 2 + (weekNumber - 1) * 7, 0, 0, 0, 0);\n        date.setDate(date.getDate() - date.getDay() + locale.firstDayOfWeek);\n        return date;\n    },\n    Y: (dateObj, year) => {\n        dateObj.setFullYear(parseFloat(year));\n    },\n    Z: (_, ISODate) => new Date(ISODate),\n    d: (dateObj, day) => {\n        dateObj.setDate(parseFloat(day));\n    },\n    h: (dateObj, hour) => {\n        dateObj.setHours(parseFloat(hour));\n    },\n    i: (dateObj, minutes) => {\n        dateObj.setMinutes(parseFloat(minutes));\n    },\n    j: (dateObj, day) => {\n        dateObj.setDate(parseFloat(day));\n    },\n    l: doNothing,\n    m: (dateObj, month) => {\n        dateObj.setMonth(parseFloat(month) - 1);\n    },\n    n: (dateObj, month) => {\n        dateObj.setMonth(parseFloat(month) - 1);\n    },\n    s: (dateObj, seconds) => {\n        dateObj.setSeconds(parseFloat(seconds));\n    },\n    u: (_, unixMillSeconds) => new Date(parseFloat(unixMillSeconds)),\n    w: doNothing,\n    y: (dateObj, year) => {\n        dateObj.setFullYear(2000 + parseFloat(year));\n    },\n};\nexport const tokenRegex = {\n    D: \"(\\\\w+)\",\n    F: \"(\\\\w+)\",\n    G: \"(\\\\d\\\\d|\\\\d)\",\n    H: \"(\\\\d\\\\d|\\\\d)\",\n    J: \"(\\\\d\\\\d|\\\\d)\\\\w+\",\n    K: \"\",\n    M: \"(\\\\w+)\",\n    S: \"(\\\\d\\\\d|\\\\d)\",\n    U: \"(.+)\",\n    W: \"(\\\\d\\\\d|\\\\d)\",\n    Y: \"(\\\\d{4})\",\n    Z: \"(.+)\",\n    d: \"(\\\\d\\\\d|\\\\d)\",\n    h: \"(\\\\d\\\\d|\\\\d)\",\n    i: \"(\\\\d\\\\d|\\\\d)\",\n    j: \"(\\\\d\\\\d|\\\\d)\",\n    l: \"(\\\\w+)\",\n    m: \"(\\\\d\\\\d|\\\\d)\",\n    n: \"(\\\\d\\\\d|\\\\d)\",\n    s: \"(\\\\d\\\\d|\\\\d)\",\n    u: \"(.+)\",\n    w: \"(\\\\d\\\\d|\\\\d)\",\n    y: \"(\\\\d{2})\",\n};\nexport const formats = {\n    Z: (date) => date.toISOString(),\n    D: function (date, locale, options) {\n        return locale.weekdays.shorthand[formats.w(date, locale, options)];\n    },\n    F: function (date, locale, options) {\n        return monthToStr(formats.n(date, locale, options) - 1, false, locale);\n    },\n    G: function (date, locale, options) {\n        return pad(formats.h(date, locale, options));\n    },\n    H: (date) => pad(date.getHours()),\n    J: function (date, locale) {\n        return locale.ordinal !== undefined\n            ? date.getDate() + locale.ordinal(date.getDate())\n            : date.getDate();\n    },\n    K: (date, locale) => locale.amPM[int(date.getHours() > 11)],\n    M: function (date, locale) {\n        return monthToStr(date.getMonth(), true, locale);\n    },\n    S: (date) => pad(date.getSeconds()),\n    U: (date) => date.getTime() / 1000,\n    W: function (date, _, options) {\n        return options.getWeek(date);\n    },\n    Y: (date) => pad(date.getFullYear(), 4),\n    d: (date) => pad(date.getDate()),\n    h: (date) => (date.getHours() % 12 ? date.getHours() % 12 : 12),\n    i: (date) => pad(date.getMinutes()),\n    j: (date) => date.getDate(),\n    l: function (date, locale) {\n        return locale.weekdays.longhand[date.getDay()];\n    },\n    m: (date) => pad(date.getMonth() + 1),\n    n: (date) => date.getMonth() + 1,\n    s: (date) => date.getSeconds(),\n    u: (date) => date.getTime(),\n    w: (date) => date.getDay(),\n    y: (date) => String(date.getFullYear()).substring(2),\n};\n","export const pad = (number, length = 2) => `000${number}`.slice(length * -1);\nexport const int = (bool) => (bool === true ? 1 : 0);\nexport function debounce(fn, wait) {\n    let t;\n    return function () {\n        clearTimeout(t);\n        t = setTimeout(() => fn.apply(this, arguments), wait);\n    };\n}\nexport const arrayify = (obj) => obj instanceof Array ? obj : [obj];\n","\"use strict\";\nif (typeof Object.assign !== \"function\") {\n    Object.assign = function (target, ...args) {\n        if (!target) {\n            throw TypeError(\"Cannot convert undefined or null to object\");\n        }\n        for (const source of args) {\n            if (source) {\n                Object.keys(source).forEach((key) => (target[key] = source[key]));\n            }\n        }\n        return target;\n    };\n}\n","/*\n * HTML5Sortable package\n * https://github.com/lukasoppermann/html5sortable\n *\n * Maintained by Lukas Oppermann <lukas@vea.re>\n *\n * Released under the MIT license.\n */\n'use strict';\n\n/**\n * Get or set data on element\n * @param {HTMLElement} element\n * @param {string} key\n * @param {any} value\n * @return {*}\n */\nfunction addData(element, key, value) {\n    if (value === undefined) {\n        return element && element.h5s && element.h5s.data && element.h5s.data[key];\n    }\n    else {\n        element.h5s = element.h5s || {};\n        element.h5s.data = element.h5s.data || {};\n        element.h5s.data[key] = value;\n    }\n}\n/**\n * Remove data from element\n * @param {HTMLElement} element\n */\nfunction removeData(element) {\n    if (element.h5s) {\n        delete element.h5s.data;\n    }\n}\n\n/* eslint-env browser */\n/**\n * Filter only wanted nodes\n * @param {NodeList|HTMLCollection|Array} nodes\n * @param {String} selector\n * @returns {Array}\n */\nvar filter = (function (nodes, selector) {\n    if (!(nodes instanceof NodeList || nodes instanceof HTMLCollection || nodes instanceof Array)) {\n        throw new Error('You must provide a nodeList/HTMLCollection/Array of elements to be filtered.');\n    }\n    if (typeof selector !== 'string') {\n        return Array.from(nodes);\n    }\n    return Array.from(nodes).filter(function (item) { return item.nodeType === 1 && item.matches(selector); });\n});\n\n/* eslint-env browser */\n/* eslint-disable no-use-before-define */\nvar stores = new Map();\n/* eslint-enable no-use-before-define */\n/**\n * Stores data & configurations per Sortable\n * @param {Object} config\n */\nvar Store = /** @class */ (function () {\n    function Store() {\n        this._config = new Map(); // eslint-disable-line no-undef\n        this._placeholder = undefined; // eslint-disable-line no-undef\n        this._data = new Map(); // eslint-disable-line no-undef\n    }\n    Object.defineProperty(Store.prototype, \"config\", {\n        /**\n         * get the configuration map of a class instance\n         * @method config\n         * @return {object}\n         */\n        get: function () {\n            // transform Map to object\n            var config = {};\n            this._config.forEach(function (value, key) {\n                config[key] = value;\n            });\n            // return object\n            return config;\n        },\n        /**\n         * set the configuration of a class instance\n         * @method config\n         * @param {object} config object of configurations\n         */\n        set: function (config) {\n            if (typeof config !== 'object') {\n                throw new Error('You must provide a valid configuration object to the config setter.');\n            }\n            // combine config with default\n            var mergedConfig = Object.assign({}, config);\n            // add config to map\n            this._config = new Map(Object.entries(mergedConfig));\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * set individual configuration of a class instance\n     * @method setConfig\n     * @param  key valid configuration key\n     * @param  value any value\n     * @return void\n     */\n    Store.prototype.setConfig = function (key, value) {\n        if (!this._config.has(key)) {\n            throw new Error(\"Trying to set invalid configuration item: \" + key);\n        }\n        // set config\n        this._config.set(key, value);\n    };\n    /**\n     * get an individual configuration of a class instance\n     * @method getConfig\n     * @param  key valid configuration key\n     * @return any configuration value\n     */\n    Store.prototype.getConfig = function (key) {\n        if (!this._config.has(key)) {\n            throw new Error(\"Invalid configuration item requested: \" + key);\n        }\n        return this._config.get(key);\n    };\n    Object.defineProperty(Store.prototype, \"placeholder\", {\n        /**\n         * get the placeholder for a class instance\n         * @method placeholder\n         * @return {HTMLElement|null}\n         */\n        get: function () {\n            return this._placeholder;\n        },\n        /**\n         * set the placeholder for a class instance\n         * @method placeholder\n         * @param {HTMLElement} placeholder\n         * @return {void}\n         */\n        set: function (placeholder) {\n            if (!(placeholder instanceof HTMLElement) && placeholder !== null) {\n                throw new Error('A placeholder must be an html element or null.');\n            }\n            this._placeholder = placeholder;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * set an data entry\n     * @method setData\n     * @param {string} key\n     * @param {any} value\n     * @return {void}\n     */\n    Store.prototype.setData = function (key, value) {\n        if (typeof key !== 'string') {\n            throw new Error('The key must be a string.');\n        }\n        this._data.set(key, value);\n    };\n    /**\n     * get an data entry\n     * @method getData\n     * @param {string} key an existing key\n     * @return {any}\n     */\n    Store.prototype.getData = function (key) {\n        if (typeof key !== 'string') {\n            throw new Error('The key must be a string.');\n        }\n        return this._data.get(key);\n    };\n    /**\n     * delete an data entry\n     * @method deleteData\n     * @param {string} key an existing key\n     * @return {boolean}\n     */\n    Store.prototype.deleteData = function (key) {\n        if (typeof key !== 'string') {\n            throw new Error('The key must be a string.');\n        }\n        return this._data.delete(key);\n    };\n    return Store;\n}());\n/**\n * @param {HTMLElement} sortableElement\n * @returns {Class: Store}\n */\nvar store = (function (sortableElement) {\n    // if sortableElement is wrong type\n    if (!(sortableElement instanceof HTMLElement)) {\n        throw new Error('Please provide a sortable to the store function.');\n    }\n    // create new instance if not avilable\n    if (!stores.has(sortableElement)) {\n        stores.set(sortableElement, new Store());\n    }\n    // return instance\n    return stores.get(sortableElement);\n});\n\n/**\n * @param {Array|HTMLElement} element\n * @param {Function} callback\n * @param {string} event\n */\nfunction addEventListener(element, eventName, callback) {\n    if (element instanceof Array) {\n        for (var i = 0; i < element.length; ++i) {\n            addEventListener(element[i], eventName, callback);\n        }\n        return;\n    }\n    element.addEventListener(eventName, callback);\n    store(element).setData(\"event\" + eventName, callback);\n}\n/**\n * @param {Array<HTMLElement>|HTMLElement} element\n * @param {string} eventName\n */\nfunction removeEventListener(element, eventName) {\n    if (element instanceof Array) {\n        for (var i = 0; i < element.length; ++i) {\n            removeEventListener(element[i], eventName);\n        }\n        return;\n    }\n    element.removeEventListener(eventName, store(element).getData(\"event\" + eventName));\n    store(element).deleteData(\"event\" + eventName);\n}\n\n/**\n * @param {Array<HTMLElement>|HTMLElement} element\n * @param {string} attribute\n * @param {string} value\n */\nfunction addAttribute(element, attribute, value) {\n    if (element instanceof Array) {\n        for (var i = 0; i < element.length; ++i) {\n            addAttribute(element[i], attribute, value);\n        }\n        return;\n    }\n    element.setAttribute(attribute, value);\n}\n/**\n * @param {Array|HTMLElement} element\n * @param {string} attribute\n */\nfunction removeAttribute(element, attribute) {\n    if (element instanceof Array) {\n        for (var i = 0; i < element.length; ++i) {\n            removeAttribute(element[i], attribute);\n        }\n        return;\n    }\n    element.removeAttribute(attribute);\n}\n\n/**\n * @param {HTMLElement} element\n * @returns {Object}\n */\nvar offset = (function (element) {\n    if (!element.parentElement || element.getClientRects().length === 0) {\n        throw new Error('target element must be part of the dom');\n    }\n    var rect = element.getClientRects()[0];\n    return {\n        left: rect.left + window.pageXOffset,\n        right: rect.right + window.pageXOffset,\n        top: rect.top + window.pageYOffset,\n        bottom: rect.bottom + window.pageYOffset\n    };\n});\n\n/**\n * Creates and returns a new debounced version of the passed function which will postpone its execution until after wait milliseconds have elapsed\n * @param {Function} func to debounce\n * @param {number} time to wait before calling function with latest arguments, 0 - no debounce\n * @returns {function} - debounced function\n */\nvar debounce = (function (func, wait) {\n    if (wait === void 0) { wait = 0; }\n    var timeout;\n    return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        clearTimeout(timeout);\n        timeout = setTimeout(function () {\n            func.apply(void 0, args);\n        }, wait);\n    };\n});\n\n/* eslint-env browser */\n/**\n * Get position of the element relatively to its sibling elements\n * @param {HTMLElement} element\n * @returns {number}\n */\nvar getIndex = (function (element, elementList) {\n    if (!(element instanceof HTMLElement) || !(elementList instanceof NodeList || elementList instanceof HTMLCollection || elementList instanceof Array)) {\n        throw new Error('You must provide an element and a list of elements.');\n    }\n    return Array.from(elementList).indexOf(element);\n});\n\n/* eslint-env browser */\n/**\n * Test whether element is in DOM\n * @param {HTMLElement} element\n * @returns {boolean}\n */\nvar isInDom = (function (element) {\n    if (!(element instanceof HTMLElement)) {\n        throw new Error('Element is not a node element.');\n    }\n    return element.parentNode !== null;\n});\n\n/* eslint-env browser */\n/**\n * Insert node before or after target\n * @param {HTMLElement} referenceNode - reference element\n * @param {HTMLElement} newElement - element to be inserted\n * @param {String} position - insert before or after reference element\n */\nvar insertNode = function (referenceNode, newElement, position) {\n    if (!(referenceNode instanceof HTMLElement) || !(referenceNode.parentElement instanceof HTMLElement)) {\n        throw new Error('target and element must be a node');\n    }\n    referenceNode.parentElement.insertBefore(newElement, (position === 'before' ? referenceNode : referenceNode.nextElementSibling));\n};\n/**\n * Insert before target\n * @param {HTMLElement} target\n * @param {HTMLElement} element\n */\nvar insertBefore = function (target, element) { return insertNode(target, element, 'before'); };\n/**\n * Insert after target\n * @param {HTMLElement} target\n * @param {HTMLElement} element\n */\nvar insertAfter = function (target, element) { return insertNode(target, element, 'after'); };\n\n/* eslint-env browser */\n/**\n * Filter only wanted nodes\n * @param {HTMLElement} sortableContainer\n * @param {Function} customSerializer\n * @returns {Array}\n */\nvar serialize = (function (sortableContainer, customItemSerializer, customContainerSerializer) {\n    if (customItemSerializer === void 0) { customItemSerializer = function (serializedItem, sortableContainer) { return serializedItem; }; }\n    if (customContainerSerializer === void 0) { customContainerSerializer = function (serializedContainer) { return serializedContainer; }; }\n    // check for valid sortableContainer\n    if (!(sortableContainer instanceof HTMLElement) || !sortableContainer.isSortable === true) {\n        throw new Error('You need to provide a sortableContainer to be serialized.');\n    }\n    // check for valid serializers\n    if (typeof customItemSerializer !== 'function' || typeof customContainerSerializer !== 'function') {\n        throw new Error('You need to provide a valid serializer for items and the container.');\n    }\n    // get options\n    var options = addData(sortableContainer, 'opts');\n    var item = options.items;\n    // serialize container\n    var items = filter(sortableContainer.children, item);\n    var serializedItems = items.map(function (item) {\n        return {\n            parent: sortableContainer,\n            node: item,\n            html: item.outerHTML,\n            index: getIndex(item, items)\n        };\n    });\n    // serialize container\n    var container = {\n        node: sortableContainer,\n        itemCount: serializedItems.length\n    };\n    return {\n        container: customContainerSerializer(container),\n        items: serializedItems.map(function (item) { return customItemSerializer(item, sortableContainer); })\n    };\n});\n\n/* eslint-env browser */\n/**\n * create a placeholder element\n * @param {HTMLElement} sortableElement a single sortable\n * @param {string|undefined} placeholder a string representing an html element\n * @param {string} placeholderClasses a string representing the classes that should be added to the placeholder\n */\nvar makePlaceholder = (function (sortableElement, placeholder, placeholderClass) {\n    var _a;\n    if (placeholderClass === void 0) { placeholderClass = 'sortable-placeholder'; }\n    if (!(sortableElement instanceof HTMLElement)) {\n        throw new Error('You must provide a valid element as a sortable.');\n    }\n    // if placeholder is not an element\n    if (!(placeholder instanceof HTMLElement) && placeholder !== undefined) {\n        throw new Error('You must provide a valid element as a placeholder or set ot to undefined.');\n    }\n    // if no placeholder element is given\n    if (placeholder === undefined) {\n        if (['UL', 'OL'].includes(sortableElement.tagName)) {\n            placeholder = document.createElement('li');\n        }\n        else if (['TABLE', 'TBODY'].includes(sortableElement.tagName)) {\n            placeholder = document.createElement('tr');\n            // set colspan to always all rows, otherwise the item can only be dropped in first column\n            placeholder.innerHTML = '<td colspan=\"100\"></td>';\n        }\n        else {\n            placeholder = document.createElement('div');\n        }\n    }\n    // add classes to placeholder\n    if (typeof placeholderClass === 'string') {\n        (_a = placeholder.classList).add.apply(_a, placeholderClass.split(' '));\n    }\n    return placeholder;\n});\n\n/* eslint-env browser */\n/**\n * Get height of an element including padding\n * @param {HTMLElement} element an dom element\n */\nvar getElementHeight = (function (element) {\n    if (!(element instanceof HTMLElement)) {\n        throw new Error('You must provide a valid dom element');\n    }\n    // get calculated style of element\n    var style = window.getComputedStyle(element);\n    // get only height if element has box-sizing: border-box specified\n    if (style.getPropertyValue('box-sizing') === 'border-box') {\n        return parseInt(style.getPropertyValue('height'), 10);\n    }\n    // pick applicable properties, convert to int and reduce by adding\n    return ['height', 'padding-top', 'padding-bottom']\n        .map(function (key) {\n        var int = parseInt(style.getPropertyValue(key), 10);\n        return isNaN(int) ? 0 : int;\n    })\n        .reduce(function (sum, value) { return sum + value; });\n});\n\n/* eslint-env browser */\n/**\n * Get width of an element including padding\n * @param {HTMLElement} element an dom element\n */\nvar getElementWidth = (function (element) {\n    if (!(element instanceof HTMLElement)) {\n        throw new Error('You must provide a valid dom element');\n    }\n    // get calculated style of element\n    var style = window.getComputedStyle(element);\n    // pick applicable properties, convert to int and reduce by adding\n    return ['width', 'padding-left', 'padding-right']\n        .map(function (key) {\n        var int = parseInt(style.getPropertyValue(key), 10);\n        return isNaN(int) ? 0 : int;\n    })\n        .reduce(function (sum, value) { return sum + value; });\n});\n\n/* eslint-env browser */\n/**\n * get handle or return item\n * @param {Array<HTMLElement>} items\n * @param {string} selector\n */\nvar getHandles = (function (items, selector) {\n    if (!(items instanceof Array)) {\n        throw new Error('You must provide a Array of HTMLElements to be filtered.');\n    }\n    if (typeof selector !== 'string') {\n        return items;\n    }\n    return items\n        // remove items without handle from array\n        .filter(function (item) {\n        return item.querySelector(selector) instanceof HTMLElement ||\n            (item.shadowRoot && item.shadowRoot.querySelector(selector) instanceof HTMLElement);\n    })\n        // replace item with handle in array\n        .map(function (item) {\n        return item.querySelector(selector) || (item.shadowRoot && item.shadowRoot.querySelector(selector));\n    });\n});\n\n/**\n * @param {Event} event\n * @returns {HTMLElement}\n */\nvar getEventTarget = (function (event) {\n    return (event.composedPath && event.composedPath()[0]) || event.target;\n});\n\n/* eslint-env browser */\n/**\n * defaultDragImage returns the current item as dragged image\n * @param {HTMLElement} draggedElement - the item that the user drags\n * @param {object} elementOffset - an object with the offsets top, left, right & bottom\n * @param {Event} event - the original drag event object\n * @return {object} with element, posX and posY properties\n */\nvar defaultDragImage = function (draggedElement, elementOffset, event) {\n    return {\n        element: draggedElement,\n        posX: event.pageX - elementOffset.left,\n        posY: event.pageY - elementOffset.top\n    };\n};\n/**\n * attaches an element as the drag image to an event\n * @param {Event} event - the original drag event object\n * @param {HTMLElement} draggedElement - the item that the user drags\n * @param {Function} customDragImage - function to create a custom dragImage\n * @return void\n */\nvar setDragImage = (function (event, draggedElement, customDragImage) {\n    // check if event is provided\n    if (!(event instanceof Event)) {\n        throw new Error('setDragImage requires a DragEvent as the first argument.');\n    }\n    // check if draggedElement is provided\n    if (!(draggedElement instanceof HTMLElement)) {\n        throw new Error('setDragImage requires the dragged element as the second argument.');\n    }\n    // set default function of none provided\n    if (!customDragImage) {\n        customDragImage = defaultDragImage;\n    }\n    // check if setDragImage method is available\n    if (event.dataTransfer && event.dataTransfer.setDragImage) {\n        // get the elements offset\n        var elementOffset = offset(draggedElement);\n        // get the dragImage\n        var dragImage = customDragImage(draggedElement, elementOffset, event);\n        // check if custom function returns correct values\n        if (!(dragImage.element instanceof HTMLElement) || typeof dragImage.posX !== 'number' || typeof dragImage.posY !== 'number') {\n            throw new Error('The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].');\n        }\n        // needs to be set for HTML5 drag & drop to work\n        event.dataTransfer.effectAllowed = 'copyMove';\n        // Firefox requires it to use the event target's id for the data\n        event.dataTransfer.setData('text/plain', getEventTarget(event).id);\n        // set the drag image on the event\n        event.dataTransfer.setDragImage(dragImage.element, dragImage.posX, dragImage.posY);\n    }\n});\n\n/**\n * Check if curList accepts items from destList\n * @param {sortable} destination the container an item is move to\n * @param {sortable} origin the container an item comes from\n */\nvar listsConnected = (function (destination, origin) {\n    // check if valid sortable\n    if (destination.isSortable === true) {\n        var acceptFrom = store(destination).getConfig('acceptFrom');\n        // check if acceptFrom is valid\n        if (acceptFrom !== null && acceptFrom !== false && typeof acceptFrom !== 'string') {\n            throw new Error('HTML5Sortable: Wrong argument, \"acceptFrom\" must be \"null\", \"false\", or a valid selector string.');\n        }\n        if (acceptFrom !== null) {\n            return acceptFrom !== false && acceptFrom.split(',').filter(function (sel) {\n                return sel.length > 0 && origin.matches(sel);\n            }).length > 0;\n        }\n        // drop in same list\n        if (destination === origin) {\n            return true;\n        }\n        // check if lists are connected with connectWith\n        if (store(destination).getConfig('connectWith') !== undefined && store(destination).getConfig('connectWith') !== null) {\n            return store(destination).getConfig('connectWith') === store(origin).getConfig('connectWith');\n        }\n    }\n    return false;\n});\n\n/**\n * default configurations\n */\nvar defaultConfiguration = {\n    items: null,\n    // deprecated\n    connectWith: null,\n    // deprecated\n    disableIEFix: null,\n    acceptFrom: null,\n    copy: false,\n    placeholder: null,\n    placeholderClass: 'sortable-placeholder',\n    draggingClass: 'sortable-dragging',\n    hoverClass: false,\n    dropTargetContainerClass: false,\n    debounce: 0,\n    throttleTime: 100,\n    maxItems: 0,\n    itemSerializer: undefined,\n    containerSerializer: undefined,\n    customDragImage: null,\n    orientation: 'vertical'\n};\n\n/**\n * make sure a function is only called once within the given amount of time\n * @param {Function} fn the function to throttle\n * @param {number} threshold time limit for throttling\n */\n// must use function to keep this context\nfunction throttle (fn, threshold) {\n    var _this = this;\n    if (threshold === void 0) { threshold = 250; }\n    // check function\n    if (typeof fn !== 'function') {\n        throw new Error('You must provide a function as the first argument for throttle.');\n    }\n    // check threshold\n    if (typeof threshold !== 'number') {\n        throw new Error('You must provide a number as the second argument for throttle.');\n    }\n    var lastEventTimestamp = null;\n    return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var now = Date.now();\n        if (lastEventTimestamp === null || now - lastEventTimestamp >= threshold) {\n            lastEventTimestamp = now;\n            fn.apply(_this, args);\n        }\n    };\n}\n\n/* eslint-env browser */\n/**\n * enable or disable hoverClass on mouseenter/leave if container Items\n * @param {sortable} sortableContainer a valid sortableContainer\n * @param {boolean} enable enable or disable event\n */\nvar enableHoverClass = (function (sortableContainer, enable) {\n    if (typeof store(sortableContainer).getConfig('hoverClass') === 'string') {\n        var hoverClasses_1 = store(sortableContainer).getConfig('hoverClass').split(' ');\n        // add class on hover\n        if (enable === true) {\n            addEventListener(sortableContainer, 'mousemove', throttle(function (event) {\n                // check of no mouse button was pressed when mousemove started == no drag\n                if (event.buttons === 0) {\n                    filter(sortableContainer.children, store(sortableContainer).getConfig('items')).forEach(function (item) {\n                        var _a, _b;\n                        if (item !== event.target) {\n                            (_a = item.classList).remove.apply(_a, hoverClasses_1);\n                        }\n                        else {\n                            (_b = item.classList).add.apply(_b, hoverClasses_1);\n                        }\n                    });\n                }\n            }, store(sortableContainer).getConfig('throttleTime')));\n            // remove class on leave\n            addEventListener(sortableContainer, 'mouseleave', function () {\n                filter(sortableContainer.children, store(sortableContainer).getConfig('items')).forEach(function (item) {\n                    var _a;\n                    (_a = item.classList).remove.apply(_a, hoverClasses_1);\n                });\n            });\n            // remove events\n        }\n        else {\n            removeEventListener(sortableContainer, 'mousemove');\n            removeEventListener(sortableContainer, 'mouseleave');\n        }\n    }\n});\n\n/* eslint-env browser */\n/*\n * variables global to the plugin\n */\nvar dragging;\nvar draggingHeight;\nvar draggingWidth;\n/*\n * Keeps track of the initialy selected list, where 'dragstart' event was triggered\n * It allows us to move the data in between individual Sortable List instances\n */\n// Origin List - data from before any item was changed\nvar originContainer;\nvar originIndex;\nvar originElementIndex;\nvar originItemsBeforeUpdate;\n// Previous Sortable Container - we dispatch as sortenter event when a\n// dragged item enters a sortableContainer for the first time\nvar previousContainer;\n// Destination List - data from before any item was changed\nvar destinationItemsBeforeUpdate;\n/**\n * remove event handlers from items\n * @param {Array|NodeList} items\n */\nvar removeItemEvents = function (items) {\n    removeEventListener(items, 'dragstart');\n    removeEventListener(items, 'dragend');\n    removeEventListener(items, 'dragover');\n    removeEventListener(items, 'dragenter');\n    removeEventListener(items, 'drop');\n    removeEventListener(items, 'mouseenter');\n    removeEventListener(items, 'mouseleave');\n};\n// Remove container events\nvar removeContainerEvents = function (originContainer, previousContainer) {\n    if (originContainer) {\n        removeEventListener(originContainer, 'dragleave');\n    }\n    if (previousContainer && (previousContainer !== originContainer)) {\n        removeEventListener(previousContainer, 'dragleave');\n    }\n};\n/**\n * getDragging returns the current element to drag or\n * a copy of the element.\n * Is Copy Active for sortable\n * @param {HTMLElement} draggedItem - the item that the user drags\n * @param {HTMLElement} sortable a single sortable\n */\nvar getDragging = function (draggedItem, sortable) {\n    var ditem = draggedItem;\n    if (store(sortable).getConfig('copy') === true) {\n        ditem = draggedItem.cloneNode(true);\n        addAttribute(ditem, 'aria-copied', 'true');\n        draggedItem.parentElement.appendChild(ditem);\n        ditem.style.display = 'none';\n        ditem.oldDisplay = draggedItem.style.display;\n    }\n    return ditem;\n};\n/**\n * Remove data from sortable\n * @param {HTMLElement} sortable a single sortable\n */\nvar removeSortableData = function (sortable) {\n    removeData(sortable);\n    removeAttribute(sortable, 'aria-dropeffect');\n};\n/**\n * Remove data from items\n * @param {Array<HTMLElement>|HTMLElement} items\n */\nvar removeItemData = function (items) {\n    removeAttribute(items, 'aria-grabbed');\n    removeAttribute(items, 'aria-copied');\n    removeAttribute(items, 'draggable');\n    removeAttribute(items, 'role');\n};\n/**\n * find sortable from element. travels up parent element until found or null.\n * @param {HTMLElement} element a single sortable\n * @param {Event} event - the current event. We need to pass it to be able to\n * find Sortable whith shadowRoot (document fragment has no parent)\n */\nfunction findSortable(element, event) {\n    if (event.composedPath) {\n        return event.composedPath().find(function (el) { return el.isSortable; });\n    }\n    while (element.isSortable !== true) {\n        element = element.parentElement;\n    }\n    return element;\n}\n/**\n * Dragging event is on the sortable element. finds the top child that\n * contains the element.\n * @param {HTMLElement} sortableElement a single sortable\n * @param {HTMLElement} element is that being dragged\n */\nfunction findDragElement(sortableElement, element) {\n    var options = addData(sortableElement, 'opts');\n    var items = filter(sortableElement.children, options.items);\n    var itemlist = items.filter(function (ele) {\n        return ele.contains(element) || (ele.shadowRoot && ele.shadowRoot.contains(element));\n    });\n    return itemlist.length > 0 ? itemlist[0] : element;\n}\n/**\n * Destroy the sortable\n * @param {HTMLElement} sortableElement a single sortable\n */\nvar destroySortable = function (sortableElement) {\n    var opts = addData(sortableElement, 'opts') || {};\n    var items = filter(sortableElement.children, opts.items);\n    var handles = getHandles(items, opts.handle);\n    // disable adding hover class\n    enableHoverClass(sortableElement, false);\n    // remove event handlers & data from sortable\n    removeEventListener(sortableElement, 'dragover');\n    removeEventListener(sortableElement, 'dragenter');\n    removeEventListener(sortableElement, 'dragstart');\n    removeEventListener(sortableElement, 'dragend');\n    removeEventListener(sortableElement, 'drop');\n    // remove event data from sortable\n    removeSortableData(sortableElement);\n    // remove event handlers & data from items\n    removeEventListener(handles, 'mousedown');\n    removeItemEvents(items);\n    removeItemData(items);\n    removeContainerEvents(originContainer, previousContainer);\n    // clear sortable flag\n    sortableElement.isSortable = false;\n};\n/**\n * Enable the sortable\n * @param {HTMLElement} sortableElement a single sortable\n */\nvar enableSortable = function (sortableElement) {\n    var opts = addData(sortableElement, 'opts');\n    var items = filter(sortableElement.children, opts.items);\n    var handles = getHandles(items, opts.handle);\n    addAttribute(sortableElement, 'aria-dropeffect', 'move');\n    addData(sortableElement, '_disabled', 'false');\n    addAttribute(handles, 'draggable', 'true');\n    // enable hover class\n    enableHoverClass(sortableElement, true);\n    // @todo: remove this fix\n    // IE FIX for ghost\n    // can be disabled as it has the side effect that other events\n    // (e.g. click) will be ignored\n    if (opts.disableIEFix === false) {\n        var spanEl = (document || window.document).createElement('span');\n        if (typeof spanEl.dragDrop === 'function') {\n            addEventListener(handles, 'mousedown', function () {\n                if (items.indexOf(this) !== -1) {\n                    this.dragDrop();\n                }\n                else {\n                    var parent = this.parentElement;\n                    while (items.indexOf(parent) === -1) {\n                        parent = parent.parentElement;\n                    }\n                    parent.dragDrop();\n                }\n            });\n        }\n    }\n};\n/**\n * Disable the sortable\n * @param {HTMLElement} sortableElement a single sortable\n */\nvar disableSortable = function (sortableElement) {\n    var opts = addData(sortableElement, 'opts');\n    var items = filter(sortableElement.children, opts.items);\n    var handles = getHandles(items, opts.handle);\n    addAttribute(sortableElement, 'aria-dropeffect', 'none');\n    addData(sortableElement, '_disabled', 'true');\n    addAttribute(handles, 'draggable', 'false');\n    removeEventListener(handles, 'mousedown');\n    enableHoverClass(sortableElement, false);\n};\n/**\n * Reload the sortable\n * @param {HTMLElement} sortableElement a single sortable\n * @description events need to be removed to not be double bound\n */\nvar reloadSortable = function (sortableElement) {\n    var opts = addData(sortableElement, 'opts');\n    var items = filter(sortableElement.children, opts.items);\n    var handles = getHandles(items, opts.handle);\n    addData(sortableElement, '_disabled', 'false');\n    // remove event handlers from items\n    removeItemEvents(items);\n    removeContainerEvents(originContainer, previousContainer);\n    removeEventListener(handles, 'mousedown');\n    // remove event handlers from sortable\n    removeEventListener(sortableElement, 'dragover');\n    removeEventListener(sortableElement, 'dragenter');\n    removeEventListener(sortableElement, 'drop');\n};\n/**\n * Public sortable object\n * @param {Array|NodeList} sortableElements\n * @param {object|string} options|method\n */\nfunction sortable(sortableElements, options) {\n    // get method string to see if a method is called\n    var method = String(options);\n    options = options || {};\n    // check if the user provided a selector instead of an element\n    if (typeof sortableElements === 'string') {\n        sortableElements = document.querySelectorAll(sortableElements);\n    }\n    // if the user provided an element, return it in an array to keep the return value consistant\n    if (sortableElements instanceof HTMLElement) {\n        sortableElements = [sortableElements];\n    }\n    sortableElements = Array.prototype.slice.call(sortableElements);\n    if (/serialize/.test(method)) {\n        return sortableElements.map(function (sortableContainer) {\n            var opts = addData(sortableContainer, 'opts');\n            return serialize(sortableContainer, opts.itemSerializer, opts.containerSerializer);\n        });\n    }\n    sortableElements.forEach(function (sortableElement) {\n        if (/enable|disable|destroy/.test(method)) {\n            return sortable[method](sortableElement);\n        }\n        // log deprecation\n        ['connectWith', 'disableIEFix'].forEach(function (configKey) {\n            if (Object.prototype.hasOwnProperty.call(options, configKey) && options[configKey] !== null) {\n                console.warn(\"HTML5Sortable: You are using the deprecated configuration \\\"\" + configKey + \"\\\". This will be removed in an upcoming version, make sure to migrate to the new options when updating.\");\n            }\n        });\n        // merge options with default options\n        options = Object.assign({}, defaultConfiguration, store(sortableElement).config, options);\n        // init data store for sortable\n        store(sortableElement).config = options;\n        // set options on sortable\n        addData(sortableElement, 'opts', options);\n        // property to define as sortable\n        sortableElement.isSortable = true;\n        // reset sortable\n        reloadSortable(sortableElement);\n        // initialize\n        var listItems = filter(sortableElement.children, options.items);\n        // create element if user defined a placeholder element as a string\n        var customPlaceholder;\n        if (options.placeholder !== null && options.placeholder !== undefined) {\n            var tempContainer = document.createElement(sortableElement.tagName);\n            if (options.placeholder instanceof HTMLElement) {\n                tempContainer.appendChild(options.placeholder);\n            }\n            else {\n                tempContainer.innerHTML = options.placeholder;\n            }\n            customPlaceholder = tempContainer.children[0];\n        }\n        // add placeholder\n        store(sortableElement).placeholder = makePlaceholder(sortableElement, customPlaceholder, options.placeholderClass);\n        addData(sortableElement, 'items', options.items);\n        if (options.acceptFrom) {\n            addData(sortableElement, 'acceptFrom', options.acceptFrom);\n        }\n        else if (options.connectWith) {\n            addData(sortableElement, 'connectWith', options.connectWith);\n        }\n        enableSortable(sortableElement);\n        addAttribute(listItems, 'role', 'option');\n        addAttribute(listItems, 'aria-grabbed', 'false');\n        /*\n         Handle drag events on draggable items\n         Handle is set at the sortableElement level as it will bubble up\n         from the item\n         */\n        addEventListener(sortableElement, 'dragstart', function (e) {\n            // ignore dragstart events\n            var target = getEventTarget(e);\n            if (target.isSortable === true) {\n                return;\n            }\n            e.stopImmediatePropagation();\n            if ((options.handle && !target.matches(options.handle)) || target.getAttribute('draggable') === 'false') {\n                return;\n            }\n            var sortableContainer = findSortable(target, e);\n            var dragItem = findDragElement(sortableContainer, target);\n            // grab values\n            originItemsBeforeUpdate = filter(sortableContainer.children, options.items);\n            originIndex = originItemsBeforeUpdate.indexOf(dragItem);\n            originElementIndex = getIndex(dragItem, sortableContainer.children);\n            originContainer = sortableContainer;\n            // add transparent clone or other ghost to cursor\n            setDragImage(e, dragItem, options.customDragImage);\n            // cache selsection & add attr for dragging\n            draggingHeight = getElementHeight(dragItem);\n            draggingWidth = getElementWidth(dragItem);\n            dragItem.classList.add(options.draggingClass);\n            dragging = getDragging(dragItem, sortableContainer);\n            addAttribute(dragging, 'aria-grabbed', 'true');\n            // dispatch sortstart event on each element in group\n            sortableContainer.dispatchEvent(new CustomEvent('sortstart', {\n                detail: {\n                    origin: {\n                        elementIndex: originElementIndex,\n                        index: originIndex,\n                        container: originContainer\n                    },\n                    item: dragging,\n                    originalTarget: target\n                }\n            }));\n        });\n        /*\n         We are capturing targetSortable before modifications with 'dragenter' event\n        */\n        addEventListener(sortableElement, 'dragenter', function (e) {\n            var target = getEventTarget(e);\n            var sortableContainer = findSortable(target, e);\n            if (sortableContainer && sortableContainer !== previousContainer) {\n                destinationItemsBeforeUpdate = filter(sortableContainer.children, addData(sortableContainer, 'items'))\n                    .filter(function (item) { return item !== store(sortableElement).placeholder; });\n                if (options.dropTargetContainerClass) {\n                    sortableContainer.classList.add(options.dropTargetContainerClass);\n                }\n                sortableContainer.dispatchEvent(new CustomEvent('sortenter', {\n                    detail: {\n                        origin: {\n                            elementIndex: originElementIndex,\n                            index: originIndex,\n                            container: originContainer\n                        },\n                        destination: {\n                            container: sortableContainer,\n                            itemsBeforeUpdate: destinationItemsBeforeUpdate\n                        },\n                        item: dragging,\n                        originalTarget: target\n                    }\n                }));\n                addEventListener(sortableContainer, 'dragleave', function (e) {\n                    // TODO: rename outTarget to be more self-explanatory\n                    // e.fromElement for very old browsers, similar to relatedTarget\n                    var outTarget = e.relatedTarget || e.fromElement;\n                    if (!e.currentTarget.contains(outTarget)) {\n                        if (options.dropTargetContainerClass) {\n                            sortableContainer.classList.remove(options.dropTargetContainerClass);\n                        }\n                        sortableContainer.dispatchEvent(new CustomEvent('sortleave', {\n                            detail: {\n                                origin: {\n                                    elementIndex: originElementIndex,\n                                    index: originIndex,\n                                    container: sortableContainer\n                                },\n                                item: dragging,\n                                originalTarget: target\n                            }\n                        }));\n                    }\n                });\n            }\n            previousContainer = sortableContainer;\n        });\n        /*\n         * Dragend Event - https://developer.mozilla.org/en-US/docs/Web/Events/dragend\n         * Fires each time dragEvent end, or ESC pressed\n         * We are using it to clean up any draggable elements and placeholders\n         */\n        addEventListener(sortableElement, 'dragend', function (e) {\n            if (!dragging) {\n                return;\n            }\n            dragging.classList.remove(options.draggingClass);\n            addAttribute(dragging, 'aria-grabbed', 'false');\n            if (dragging.getAttribute('aria-copied') === 'true' && addData(dragging, 'dropped') !== 'true') {\n                dragging.remove();\n            }\n            dragging.style.display = dragging.oldDisplay;\n            delete dragging.oldDisplay;\n            var visiblePlaceholder = Array.from(stores.values()).map(function (data) { return data.placeholder; })\n                .filter(function (placeholder) { return placeholder instanceof HTMLElement; })\n                .filter(isInDom)[0];\n            if (visiblePlaceholder) {\n                visiblePlaceholder.remove();\n            }\n            // dispatch sortstart event on each element in group\n            sortableElement.dispatchEvent(new CustomEvent('sortstop', {\n                detail: {\n                    origin: {\n                        elementIndex: originElementIndex,\n                        index: originIndex,\n                        container: originContainer\n                    },\n                    item: dragging\n                }\n            }));\n            previousContainer = null;\n            dragging = null;\n            draggingHeight = null;\n            draggingWidth = null;\n        });\n        /*\n         * Drop Event - https://developer.mozilla.org/en-US/docs/Web/Events/drop\n         * Fires when valid drop target area is hit\n         */\n        addEventListener(sortableElement, 'drop', function (e) {\n            if (!listsConnected(sortableElement, dragging.parentElement)) {\n                return;\n            }\n            e.preventDefault();\n            e.stopPropagation();\n            addData(dragging, 'dropped', 'true');\n            // get the one placeholder that is currently visible\n            var visiblePlaceholder = Array.from(stores.values()).map(function (data) {\n                return data.placeholder;\n            })\n                // filter only HTMLElements\n                .filter(function (placeholder) { return placeholder instanceof HTMLElement; })\n                // only elements in DOM\n                .filter(isInDom)[0];\n            // attach element after placeholder\n            insertAfter(visiblePlaceholder, dragging);\n            // remove placeholder from dom\n            visiblePlaceholder.remove();\n            /*\n             * Fires Custom Event - 'sortstop'\n             */\n            sortableElement.dispatchEvent(new CustomEvent('sortstop', {\n                detail: {\n                    origin: {\n                        elementIndex: originElementIndex,\n                        index: originIndex,\n                        container: originContainer\n                    },\n                    item: dragging\n                }\n            }));\n            var placeholder = store(sortableElement).placeholder;\n            var originItems = filter(originContainer.children, options.items)\n                .filter(function (item) { return item !== placeholder; });\n            var destinationContainer = this.isSortable === true ? this : this.parentElement;\n            var destinationItems = filter(destinationContainer.children, addData(destinationContainer, 'items'))\n                .filter(function (item) { return item !== placeholder; });\n            var destinationElementIndex = getIndex(dragging, Array.from(dragging.parentElement.children)\n                .filter(function (item) { return item !== placeholder; }));\n            var destinationIndex = getIndex(dragging, destinationItems);\n            if (options.dropTargetContainerClass) {\n                destinationContainer.classList.remove(options.dropTargetContainerClass);\n            }\n            /*\n             * When a list item changed container lists or index within a list\n             * Fires Custom Event - 'sortupdate'\n             */\n            if (originElementIndex !== destinationElementIndex || originContainer !== destinationContainer) {\n                sortableElement.dispatchEvent(new CustomEvent('sortupdate', {\n                    detail: {\n                        origin: {\n                            elementIndex: originElementIndex,\n                            index: originIndex,\n                            container: originContainer,\n                            itemsBeforeUpdate: originItemsBeforeUpdate,\n                            items: originItems\n                        },\n                        destination: {\n                            index: destinationIndex,\n                            elementIndex: destinationElementIndex,\n                            container: destinationContainer,\n                            itemsBeforeUpdate: destinationItemsBeforeUpdate,\n                            items: destinationItems\n                        },\n                        item: dragging\n                    }\n                }));\n            }\n        });\n        var debouncedDragOverEnter = debounce(function (sortableElement, element, pageX, pageY) {\n            if (!dragging) {\n                return;\n            }\n            // set placeholder height if forcePlaceholderSize option is set\n            if (options.forcePlaceholderSize) {\n                store(sortableElement).placeholder.style.height = draggingHeight + 'px';\n                store(sortableElement).placeholder.style.width = draggingWidth + 'px';\n            }\n            // if element the draggedItem is dragged onto is within the array of all elements in list\n            // (not only items, but also disabled, etc.)\n            if (Array.from(sortableElement.children).indexOf(element) > -1) {\n                var thisHeight = getElementHeight(element);\n                var thisWidth = getElementWidth(element);\n                var placeholderIndex = getIndex(store(sortableElement).placeholder, element.parentElement.children);\n                var thisIndex = getIndex(element, element.parentElement.children);\n                // Check if `element` is bigger than the draggable. If it is, we have to define a dead zone to prevent flickering\n                if (thisHeight > draggingHeight || thisWidth > draggingWidth) {\n                    // Dead zone?\n                    var deadZoneVertical = thisHeight - draggingHeight;\n                    var deadZoneHorizontal = thisWidth - draggingWidth;\n                    var offsetTop = offset(element).top;\n                    var offsetLeft = offset(element).left;\n                    if (placeholderIndex < thisIndex &&\n                        ((options.orientation === 'vertical' && pageY < offsetTop) ||\n                            (options.orientation === 'horizontal' && pageX < offsetLeft))) {\n                        return;\n                    }\n                    if (placeholderIndex > thisIndex &&\n                        ((options.orientation === 'vertical' && pageY > offsetTop + thisHeight - deadZoneVertical) ||\n                            (options.orientation === 'horizontal' && pageX > offsetLeft + thisWidth - deadZoneHorizontal))) {\n                        return;\n                    }\n                }\n                if (dragging.oldDisplay === undefined) {\n                    dragging.oldDisplay = dragging.style.display;\n                }\n                if (dragging.style.display !== 'none') {\n                    dragging.style.display = 'none';\n                }\n                // To avoid flicker, determine where to position the placeholder\n                // based on where the mouse pointer is relative to the elements\n                // vertical center.\n                var placeAfter = false;\n                try {\n                    var elementMiddleVertical = offset(element).top + element.offsetHeight / 2;\n                    var elementMiddleHorizontal = offset(element).left + element.offsetWidth / 2;\n                    placeAfter = (options.orientation === 'vertical' && (pageY >= elementMiddleVertical)) ||\n                        (options.orientation === 'horizontal' && (pageX >= elementMiddleHorizontal));\n                }\n                catch (e) {\n                    placeAfter = placeholderIndex < thisIndex;\n                }\n                if (placeAfter) {\n                    insertAfter(element, store(sortableElement).placeholder);\n                }\n                else {\n                    insertBefore(element, store(sortableElement).placeholder);\n                }\n                // get placeholders from all stores & remove all but current one\n                Array.from(stores.values())\n                    // remove empty values\n                    .filter(function (data) { return data.placeholder !== undefined; })\n                    // foreach placeholder in array if outside of current sorableContainer -> remove from DOM\n                    .forEach(function (data) {\n                    if (data.placeholder !== store(sortableElement).placeholder) {\n                        data.placeholder.remove();\n                    }\n                });\n            }\n            else {\n                // get all placeholders from store\n                var placeholders = Array.from(stores.values())\n                    .filter(function (data) { return data.placeholder !== undefined; })\n                    .map(function (data) {\n                    return data.placeholder;\n                });\n                // check if element is not in placeholders\n                if (placeholders.indexOf(element) === -1 && sortableElement === element && !filter(element.children, options.items).length) {\n                    placeholders.forEach(function (element) { return element.remove(); });\n                    element.appendChild(store(sortableElement).placeholder);\n                }\n            }\n        }, options.debounce);\n        // Handle dragover and dragenter events on draggable items\n        var onDragOverEnter = function (e) {\n            var element = e.target;\n            var sortableElement = element.isSortable === true ? element : findSortable(element, e);\n            element = findDragElement(sortableElement, element);\n            if (!dragging || !listsConnected(sortableElement, dragging.parentElement) || addData(sortableElement, '_disabled') === 'true') {\n                return;\n            }\n            var options = addData(sortableElement, 'opts');\n            if (parseInt(options.maxItems) && filter(sortableElement.children, addData(sortableElement, 'items')).length >= parseInt(options.maxItems) && dragging.parentElement !== sortableElement) {\n                return;\n            }\n            e.preventDefault();\n            e.stopPropagation();\n            e.dataTransfer.dropEffect = store(sortableElement).getConfig('copy') === true ? 'copy' : 'move';\n            debouncedDragOverEnter(sortableElement, element, e.pageX, e.pageY);\n        };\n        addEventListener(listItems.concat(sortableElement), 'dragover', onDragOverEnter);\n        addEventListener(listItems.concat(sortableElement), 'dragenter', onDragOverEnter);\n    });\n    return sortableElements;\n}\nsortable.destroy = function (sortableElement) {\n    destroySortable(sortableElement);\n};\nsortable.enable = function (sortableElement) {\n    enableSortable(sortableElement);\n};\nsortable.disable = function (sortableElement) {\n    disableSortable(sortableElement);\n};\n/* START.TESTS_ONLY */\nsortable.__testing = {\n    // add internal methods here for testing purposes\n    data: addData,\n    removeItemEvents: removeItemEvents,\n    removeItemData: removeItemData,\n    removeSortableData: removeSortableData,\n    removeContainerEvents: removeContainerEvents\n};\n\nmodule.exports = sortable;\n","/* global window, exports, define */\n\n!function() {\n    'use strict'\n\n    var re = {\n        not_string: /[^s]/,\n        not_bool: /[^t]/,\n        not_type: /[^T]/,\n        not_primitive: /[^v]/,\n        number: /[diefg]/,\n        numeric_arg: /[bcdiefguxX]/,\n        json: /[j]/,\n        not_json: /[^j]/,\n        text: /^[^\\x25]+/,\n        modulo: /^\\x25{2}/,\n        placeholder: /^\\x25(?:([1-9]\\d*)\\$|\\(([^)]+)\\))?(\\+)?(0|'[^$])?(-)?(\\d+)?(?:\\.(\\d+))?([b-gijostTuvxX])/,\n        key: /^([a-z_][a-z_\\d]*)/i,\n        key_access: /^\\.([a-z_][a-z_\\d]*)/i,\n        index_access: /^\\[(\\d+)\\]/,\n        sign: /^[+-]/\n    }\n\n    function sprintf(key) {\n        // `arguments` is not an array, but should be fine for this call\n        return sprintf_format(sprintf_parse(key), arguments)\n    }\n\n    function vsprintf(fmt, argv) {\n        return sprintf.apply(null, [fmt].concat(argv || []))\n    }\n\n    function sprintf_format(parse_tree, argv) {\n        var cursor = 1, tree_length = parse_tree.length, arg, output = '', i, k, ph, pad, pad_character, pad_length, is_positive, sign\n        for (i = 0; i < tree_length; i++) {\n            if (typeof parse_tree[i] === 'string') {\n                output += parse_tree[i]\n            }\n            else if (typeof parse_tree[i] === 'object') {\n                ph = parse_tree[i] // convenience purposes only\n                if (ph.keys) { // keyword argument\n                    arg = argv[cursor]\n                    for (k = 0; k < ph.keys.length; k++) {\n                        if (arg == undefined) {\n                            throw new Error(sprintf('[sprintf] Cannot access property \"%s\" of undefined value \"%s\"', ph.keys[k], ph.keys[k-1]))\n                        }\n                        arg = arg[ph.keys[k]]\n                    }\n                }\n                else if (ph.param_no) { // positional argument (explicit)\n                    arg = argv[ph.param_no]\n                }\n                else { // positional argument (implicit)\n                    arg = argv[cursor++]\n                }\n\n                if (re.not_type.test(ph.type) && re.not_primitive.test(ph.type) && arg instanceof Function) {\n                    arg = arg()\n                }\n\n                if (re.numeric_arg.test(ph.type) && (typeof arg !== 'number' && isNaN(arg))) {\n                    throw new TypeError(sprintf('[sprintf] expecting number but found %T', arg))\n                }\n\n                if (re.number.test(ph.type)) {\n                    is_positive = arg >= 0\n                }\n\n                switch (ph.type) {\n                    case 'b':\n                        arg = parseInt(arg, 10).toString(2)\n                        break\n                    case 'c':\n                        arg = String.fromCharCode(parseInt(arg, 10))\n                        break\n                    case 'd':\n                    case 'i':\n                        arg = parseInt(arg, 10)\n                        break\n                    case 'j':\n                        arg = JSON.stringify(arg, null, ph.width ? parseInt(ph.width) : 0)\n                        break\n                    case 'e':\n                        arg = ph.precision ? parseFloat(arg).toExponential(ph.precision) : parseFloat(arg).toExponential()\n                        break\n                    case 'f':\n                        arg = ph.precision ? parseFloat(arg).toFixed(ph.precision) : parseFloat(arg)\n                        break\n                    case 'g':\n                        arg = ph.precision ? String(Number(arg.toPrecision(ph.precision))) : parseFloat(arg)\n                        break\n                    case 'o':\n                        arg = (parseInt(arg, 10) >>> 0).toString(8)\n                        break\n                    case 's':\n                        arg = String(arg)\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 't':\n                        arg = String(!!arg)\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 'T':\n                        arg = Object.prototype.toString.call(arg).slice(8, -1).toLowerCase()\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 'u':\n                        arg = parseInt(arg, 10) >>> 0\n                        break\n                    case 'v':\n                        arg = arg.valueOf()\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 'x':\n                        arg = (parseInt(arg, 10) >>> 0).toString(16)\n                        break\n                    case 'X':\n                        arg = (parseInt(arg, 10) >>> 0).toString(16).toUpperCase()\n                        break\n                }\n                if (re.json.test(ph.type)) {\n                    output += arg\n                }\n                else {\n                    if (re.number.test(ph.type) && (!is_positive || ph.sign)) {\n                        sign = is_positive ? '+' : '-'\n                        arg = arg.toString().replace(re.sign, '')\n                    }\n                    else {\n                        sign = ''\n                    }\n                    pad_character = ph.pad_char ? ph.pad_char === '0' ? '0' : ph.pad_char.charAt(1) : ' '\n                    pad_length = ph.width - (sign + arg).length\n                    pad = ph.width ? (pad_length > 0 ? pad_character.repeat(pad_length) : '') : ''\n                    output += ph.align ? sign + arg + pad : (pad_character === '0' ? sign + pad + arg : pad + sign + arg)\n                }\n            }\n        }\n        return output\n    }\n\n    var sprintf_cache = Object.create(null)\n\n    function sprintf_parse(fmt) {\n        if (sprintf_cache[fmt]) {\n            return sprintf_cache[fmt]\n        }\n\n        var _fmt = fmt, match, parse_tree = [], arg_names = 0\n        while (_fmt) {\n            if ((match = re.text.exec(_fmt)) !== null) {\n                parse_tree.push(match[0])\n            }\n            else if ((match = re.modulo.exec(_fmt)) !== null) {\n                parse_tree.push('%')\n            }\n            else if ((match = re.placeholder.exec(_fmt)) !== null) {\n                if (match[2]) {\n                    arg_names |= 1\n                    var field_list = [], replacement_field = match[2], field_match = []\n                    if ((field_match = re.key.exec(replacement_field)) !== null) {\n                        field_list.push(field_match[1])\n                        while ((replacement_field = replacement_field.substring(field_match[0].length)) !== '') {\n                            if ((field_match = re.key_access.exec(replacement_field)) !== null) {\n                                field_list.push(field_match[1])\n                            }\n                            else if ((field_match = re.index_access.exec(replacement_field)) !== null) {\n                                field_list.push(field_match[1])\n                            }\n                            else {\n                                throw new SyntaxError('[sprintf] failed to parse named argument key')\n                            }\n                        }\n                    }\n                    else {\n                        throw new SyntaxError('[sprintf] failed to parse named argument key')\n                    }\n                    match[2] = field_list\n                }\n                else {\n                    arg_names |= 2\n                }\n                if (arg_names === 3) {\n                    throw new Error('[sprintf] mixing positional and named placeholders is not (yet) supported')\n                }\n\n                parse_tree.push(\n                    {\n                        placeholder: match[0],\n                        param_no:    match[1],\n                        keys:        match[2],\n                        sign:        match[3],\n                        pad_char:    match[4],\n                        align:       match[5],\n                        width:       match[6],\n                        precision:   match[7],\n                        type:        match[8]\n                    }\n                )\n            }\n            else {\n                throw new SyntaxError('[sprintf] unexpected placeholder')\n            }\n            _fmt = _fmt.substring(match[0].length)\n        }\n        return sprintf_cache[fmt] = parse_tree\n    }\n\n    /**\n     * export to either browser or node.js\n     */\n    /* eslint-disable quote-props */\n    if (typeof exports !== 'undefined') {\n        exports['sprintf'] = sprintf\n        exports['vsprintf'] = vsprintf\n    }\n    if (typeof window !== 'undefined') {\n        window['sprintf'] = sprintf\n        window['vsprintf'] = vsprintf\n\n        if (typeof define === 'function' && define['amd']) {\n            define(function() {\n                return {\n                    'sprintf': sprintf,\n                    'vsprintf': vsprintf\n                }\n            })\n        }\n    }\n    /* eslint-enable quote-props */\n}(); // eslint-disable-line\n","module.exports = jQuery;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// Load static resources\r\nimport './css/main.scss';\r\n\r\nimport $ from 'jquery';\r\n\r\n// Create JS cache object\r\nUncannyAutomator.cache = {\r\n\ttokens: {},\r\n};\r\n\r\nimport {\r\n\tcreateDataOnLoad,\r\n\tconsoleLogLabel,\r\n\treplaceCurlyBraces,\r\n\thandleFatalError\r\n}   from './components/Utilities.js';\r\n\r\nimport Publish            from './components/Publish.js';\r\nimport Triggers           from './components/Triggers.js';\r\nimport Actions            from './components/Actions.js';\r\nimport SendFeedback       from './components/SendFeedback.js';\r\nimport RecipeTypeSelector from './components/RecipeTypeSelector.js';\r\nimport RecipeTitle        from './components/RecipeTitle.js';\r\nimport Taxonomies         from './components/Taxonomies.js';\r\n\r\n// Create the data required to render Automator\r\ntry {\r\n\tcreateDataOnLoad(() => {\r\n\t\tconsoleLogLabel( 'Render the UI', false, { bgColor: '#579f49' });\r\n\r\n\t\t// Once ready, render the UI\r\n\t\tnew Triggers();\r\n\t\tnew Actions();\r\n\t\tnew Publish();\r\n\t\tnew SendFeedback();\r\n\t\tnew RecipeTitle();\r\n\t\tnew Taxonomies();\r\n\t});\r\n} catch ( error ){\r\n\thandleFatalError( error );\r\n}"],"sourceRoot":""}